'use strict';const screenDecodeBlob=URL.createObjectURL(new Blob(["(",function(){function d(b){myLoop=4*b.length;k=new Uint8ClampedArray(myLoop);for(let a=0;a<myLoop;a++)k[4*a]=36.5*(b[a]>>5),k[4*a+1]=36.5*((b[a]&28)>>2),k[4*a+2]=85*(b[a]&3),k[4*a+3]=255}function c(b,a,c,f,k){const d=g.width;let m=0;for(let n=a;n<f+a;n++)for(let a=b;a<c+b;a++){const b=4*(n*d+a);g.data[b]=k[m++];g.data[b+1]=k[m++];g.data[b+2]=k[m++];g.data[b+3]=k[m++]}}function a(a,c){a=b(a);c=b(c);return parseInt(a+c)}function b(b){b=
b.toString();if(1==b.length)return`0${b}`;if(2==b.length)return b}function f(b){let f=7;for(let g=0;g+7<=b.length;g=l+1)x=a(b[g+1],b[g+2]),y=a(b[g+3],b[g+4]),h=parseInt(b[g+5]),w=parseInt(b[g+6]),l=f+h*w-1,recmsg=b.subarray(f,l+1),d(recmsg),c(x,y,w,h,k),f=l+7+1;m&&clearTimeout(m);m=setTimeout(()=>{postMessage({globalImageData:g,dtype:"drgb"})},100)}let g={},k,m;onmessage=function(b){if(b.data.hasOwnProperty("dtype"))if("drgb"==b.data.dtype){var a=b.data.encodeArr;g=new ImageData(b.data.cw,b.data.ch);
b=4*a.length;for(let c=0;c<b;c++)g.data[4*c]=36.5*(a[c]>>5),g.data[4*c+1]=36.5*((a[c]&28)>>2),g.data[4*c+2]=85*(a[c]&3),g.data[4*c+3]=255;postMessage({globalImageData:g,dtype:"drgb",stype:"full"})}else f(b.data.data_pack)}}.toString(),")()"],{type:"application/javascript"})),sdworker=new Worker(screenDecodeBlob);const screenWorkerBlob=URL.createObjectURL(new Blob(["(",function(){function d(b,a){b=b.toString();let c;for(c=b.length;c<a;c++)b=`0${b}`;return b.match(/[\S]{1,2}/g)||[]}function c(c){0===k?b=a=0:(f=k%c.data.resB,g=Math.floor(k/c.data.resB),a=f*c.data.dw,b=g*c.data.dh);return{x:a,y:b,w:c.data.dw,h:c.data.dh}}let a,b,f,g,k,m=0,n,q,r,z,t=null,u=[];const p=function(b,a,c,f,g,k,d){k=new Uint8ClampedArray(c*f);let m=0;for(let n=a;n<f+a;n+=1)for(let a=b;a<c+b;a+=1){const b=n*g+a;k[m++]=d[b]}return k},
v=function(b,a,c){const f=a.length;let g;if(a.length!==b.length)return!1;for(g=0;g<f;g+=1){if(a[g]!==b[g])return!1;g+=c}for(g=0;g<f;--g)if(g+=c,a[g]!==b[g])return!1;for(g=0;g<f;g+=7)if(a[g]!==b[g])return!1;return!0};onmessage=function(b){if(b.data.hasOwnProperty("initPrevImg"))u=[],t=null;else if(b.data.hasOwnProperty("resize"))for(k=0;k<b.data.resA*b.data.resB;k++)r=c(b),u[k]=p(r.x,r.y,r.w,r.h,b.data.offsetWidth,b.data.offsetHeight,b.data.img);else{{var a=b.data.img,f=a.length/4;let c;var g;if(null===
t||t.length!==f)t=new Uint8ClampedArray(f);for(g=0;g<f;g++){var B=a[4*g];var H=a[4*g+1];c=a[4*g+2];B=(Math.round(B/36.5)<<5)+(Math.round(H/36.5)<<2)+Math.round(c/85);t[g]=B}}for(k=0;k<b.data.resA*b.data.resB;k++)if(r=c(b),z=p(r.x,r.y,r.w,r.h,b.data.offsetWidth,b.data.offsetHeight,t),"undefined"!==typeof u[k]){if(n=v(z,u[k],r.w),!n){if(u[k].length!==z.length)u[k]=z;else for(a=0;a<z.length;a++)u[k][a]=z[a];a=z;f=r;g=b.data.type;H=d(f.x,4);B=d(f.y,4);g=new Uint8ClampedArray(["ss"===g?103:203,H[0],H[1],
B[0],B[1],f.h,f.w]);f=new Uint8ClampedArray(a.length+g.length);f.set(g);f.set(a,g.length);a=f;null===q||void 0===q?q=a:(f=new Uint8ClampedArray(q.length+a.length),f.set(q),f.set(a,q.length),q=f)}}else u[k]=z,m=1;q?postMessage({masterSlice:q,needFullScreen:m},[q.buffer]):postMessage({masterSlice:null,needFullScreen:m});m=0;q=null}}}.toString(),")()"],{type:"application/javascript"})),sworker=new Worker(screenWorkerBlob);const dtConWorkerBlob=URL.createObjectURL(new Blob(["(",function(){const d=function(){function c(b,a){b=b.replace(/[^A-Za-z0-9\+\/]/g,"");const c=b.length;a=a?Math.ceil((3*c+1>>2)/a)*a:3*c+1>>2;const f=new Uint8Array(a);for(var d,n=0,q=0,r=0;r<c;r++){d=r&3;var z=b.charCodeAt(r);n|=(64<z&&91>z?z-65:96<z&&123>z?z-71:47<z&&58>z?z+4:43===z?62:47===z?63:0)<<6*(3-d);if(3===d||1===c-r){for(d=0;3>d&&q<a;d++,q++)f[q]=n>>>(16>>>d&24)&255;n=0}}return f}function a(b){return 26>b?b+65:52>b?b+71:62>b?b-4:62===
b?43:63===b?47:65}return{base64EncArrInt(b){const a=new Uint8Array(b.length);for(let c=0;c<b.length;c++)a[c]=0>b[c]?-1*b[c]+127:b[c];return this.base64EncArr(a)},base64EncArr(b){let c=2,g="";for(let f=b.length,d=0,n=0;n<f;n++)if(c=n%3,0<n&&0===4*n/3%76&&(g+="\r\n"),d|=b[n]<<(16>>>c&24),2===c||1===b.length-n)g+=String.fromCharCode(a(d>>>18&63),a(d>>>12&63),a(d>>>6&63),a(d&63)),d=0;return g.substr(0,g.length-2+c)+(2===c?"":1===c?"=":"==")},base64DecToArrInt(b){b=c(b);const a=new Int8Array(b.length);
for(let c=0;c<b.length;c++)a[c]=128<=b[c]?-1*(b[c]-127):b[c];return a},base64DecToArrclm(b){b=c(b);return new Uint8ClampedArray(b.buffer)}}}();onmessage=function(c){if(c.data.hasOwnProperty("dt")){if("a"==c.data.dt)var a=d.base64EncArrInt(c.data.msg);else"c"==c.data.dt&&(a=d.base64EncArr(c.data.msg));postMessage({dt:c.data.dt,msg:a})}}}.toString(),")()"],{type:"application/javascript"})),dtConWorker=new Worker(dtConWorkerBlob);/*
  2018 Suman Bogati  {@link http://vidyamantra.com}
 @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 This file sends/receives packet to/from  Server through websocket
*/
const workerIOBlob=URL.createObjectURL(new Blob(["(",function(){const d={workerAudioRec:!1,workerAudioSend:!1,binMsgQueue:[],recBinMsgQueue:[],packetQueue:[],init(c){this.cfg=c;this.wsconnect()},userauthenticate(){const c=`F-AH-${JSON.stringify({authuser:this.cfg.authuser,authpass:this.cfg.authpass})}`;this.finallySend(c)},addclient(){const c=`F-JR-${JSON.stringify({client:this.cfg.userid,roomname:this.cfg.room,user:this.cfg.userobj})}`;this.finallySend(c)},wsconnect(){console.log("member_added init for socket connect");
d.wsuri=this.cfg.rid;"undefined"!==typeof WebSocket?(console.log(`rid ${d.wsuri}`),this.sock=new WebSocket(d.wsuri)):(console.log("Browser does not support WebSocket!"),this.error=lang.wserror);const c=this;this.sock.onopen=function(){console.log(`member_added Connected to ${c.cfg.rid}`);c.userauthenticate();c.addclient();postMessage({cmd:"connectionopen",msg:{type:"connectionopen"}})};this.sock.binaryType="arraybuffer";this.sock.onmessage=function(a){if(a.data instanceof ArrayBuffer)d.onRecBinary(a);
else postMessage({cmd:"receivedJson",msg:a.data})};this.sock.onerror=function(a){c.error=a;console.log(`Error:${a}`);postMessage({cmd:"error",msg:a.reason})};this.sock.onclose=function(a){console.log("Connection Closed");postMessage({cmd:"close",msg:a.reason})}},disconnect(){this.sock.onclose=function(){};this.sock.close();console.log("i am closing this connection");postMessage({cmd:"iamclosing"})},onRecBinary(c){if(c.data instanceof ArrayBuffer){var a=new Uint8Array(c.data);if(0==a[1]){c=101==a[2]?
new Int8Array(a):new Uint8ClampedArray(a);postMessage({cmd:"stBinary",msg:c});a=a.subarray(2);var b=101==a[0]?new Int8Array(a):new Uint8ClampedArray(a);101==a[0]?this.workerAudioRec?this.workerAudioRec.postMessage({cmd:"ad",msg:a},[a.buffer]):(postMessage({cmd:"initAudioWorklet"}),console.log("workerAudioRec is not defined")):postMessage({cmd:"notaudio",msg:b.buffer})}else if(1==a[1])this.recBinMsgQueue=[],this.recBinMsgQueue[0]=a.subarray(2);else if(2==a[1])0<this.recBinMsgQueue.length&&this.recBinMsgQueue.push(a.subarray(2));
else if(3==a[1]&&0<this.recBinMsgQueue.length){this.recBinMsgQueue.push(a.subarray(2));for(c=b=0;c<this.recBinMsgQueue.length;c++)b+=this.recBinMsgQueue[c].length;b=101==a[0]?new Int8Array(b):new Uint8ClampedArray(b);for(a=c=0;c<this.recBinMsgQueue.length;c++)b.set(this.recBinMsgQueue[c],a),a+=this.recBinMsgQueue[c].length;postMessage({cmd:"endBinary",msg:b})}}},finallySend(c){this.sock.readyState&&this.sock.send(c)},sendBinary(c){if(this.sock.readyState&&c.length)if(6E5>=c.length){if(c.constructor===
Int8Array)var a=new Int8Array(c.length+2);else c.constructor===Uint8ClampedArray&&(a=new Uint8ClampedArray(c.length+2));a.set([c[0],0]);a.set(c,2);this.finallySend(a.buffer);postMessage({cmd:"stBinary",msg:a})}else{this.binMsgQueue=[];for(let b=0,f=0;b<c.length;f++)a=c.slice(b,b+55E4),c.constructor===Int8Array?this.binMsgQueue[f]=new Int8Array(a.length+2):c.constructor===Uint8ClampedArray&&(this.binMsgQueue[f]=new Uint8ClampedArray(a.length+2)),this.binMsgQueue[f].set([c[0],2]),this.binMsgQueue[f].set(a,
2),a.length&&(b+=a.length);this.binMsgQueue[0][1]=1;this.binMsgQueue[this.binMsgQueue.length-1][1]=3;for(c=0;c<this.binMsgQueue.length;c++)this.finallySend(this.binMsgQueue[c].buffer),postMessage({cmd:"stBinary",msg:this.binMsgQueue[c]});this.binMsgQueue=[]}},onMessage(c){switch(c.data.cmd){case "init":this.init(c.data.msg);break;case "wsconnect":this.wsconnect();break;case "disconnect":this.disconnect();break;case "sessionEndClose":this.sock&&this.sock.close();break;case "workerAudioRec":this.workerAudioRec=
c.ports[0];this.workerAudioRec.onmessage=function(a){a.data.hasOwnProperty("dest")&&"mainthread"==a.data.dest&&postMessage(a.data)};break;case "send":if(this.sock.readyState){if(0<d.packetQueue.length){for(let a=0;a<d.packetQueue.length;a++)this.finallySend(d.packetQueue[a]);d.packetQueue.length=0}this.finallySend(c.data.msg)}else d.packetQueue.push(c.data.msg);break;case "sendBinary":this.sendBinary(c.data.msg);break;case "workerAudioSend":this.workerAudioSend=c.ports[0];this.workerAudioSend.onmessage=
this.fromWorkerAudioSend.bind(this);break;case "onRecBinary":this.onRecBinary({data:c.data.msg});break;default:this.finallySend(c.data.msg)}},fromWorkerAudioSend(c){c.data.hasOwnProperty("cmd")&&this.sendBinary(c.data.msg)}};onmessage=function(c){d.onMessage(c)}}.toString(),")()"],{type:"application/javascript"})),workerIO=new Worker(workerIOBlob);/*
  2018 Suman Bogati  {@link http://vidyamantra.com}
 @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 This file receives the audio from workerio and
 decode the audio and send this to reciever audio worklert(worklet-audio-rec.js)
*/
const workerAudioRecBlob=URL.createObjectURL(new Blob(["(",function(){importScripts("https://live.congrea.net/virtualclass/build/src/audio-g711-and-resampler.min.js");const d={workletAudioRec:null,workerIO:null,samples:null,allAudioArr:{},audioToBePlay:{},gAudio:{},adSign:{},resamplerdecode:{},mergeAllAudioSend:[],allAudioSend:[],supportAudioWorklet:!1,sampleRate:null,extractData(c){c=new Int8Array(c);return[this.numValidateFour(c[1],c[2],c[3],c[4]),c.subarray(5,c.length)]},numValidateFour(c,a,b,
f){c=this.preNumValidateTwo(c);a=this.preNumValidateTwo(a);b=this.preNumValidateTwo(b);f=this.preNumValidateTwo(f);return parseInt(c+a+b+f)},numValidateTwo(c,a){c=this.preNumValidateTwo(c);a=this.preNumValidateTwo(a);return parseInt(c+a)},preNumValidateTwo(c){c=c.toString();if(1==c.length)return`0${c}`;if(2==c.length)return c},resample(c,a){this.audioToBePlay.hasOwnProperty(a)||(this.audioToBePlay[a]=[]);this.samples=G711.decode(c,{floating_point:!0,Eight:!0});"object"!==typeof this.resamplerdecode[a]&&
(this.resamplerdecode[a]=new Resampler(8E3,this.sampleRate,1,32768));return this.samples=this.resamplerdecode[a].resampler(this.samples)},onMessage(c){if(c.data.hasOwnProperty("cmd"))switch(c.data.cmd){case "workerIO":this.workerIO=c.ports[0];this.sampleRate=c.data.sampleRate;this.workerIO.onmessage=this.fromworkerIO.bind(this);break;case "workletAudioRec":this.workletAudioRec=c.ports[0],this.workletAudioRec.onmessage=this.fromworkletAudioRec.bind(this);case "audioWorklet":this.supportAudioWorklet=
c.data.msg;default:console.log("do nothing")}},fromworkletAudioRec(){console.log("from audio worklet")},fromworkerIO(c){if(c.data.hasOwnProperty("msg")){({msg:c}=c.data);var a=this.extractData(c);c=a[0];this.adSign.hasOwnProperty(c)||(this.adSign[c]={},this.adSign[c].ad=!0,this.workerIO.postMessage({cmd:"firstAudio",msg:{userId:c},dest:"mainthread"}));a=this.resample(a[1],c);this.supportAudioWorklet?this.workletAudioRec.postMessage({cmd:"audio",msg:{data:a,uid:c}}):postMessage({cmd:"noAudioWorklet",
msg:{data:a,uid:c}})}}};onmessage=function(c){d.onMessage(c)}}.toString(),")()"],{type:"application/javascript"})),workerAudioRec=new Worker(workerAudioRecBlob);/*
  2018 Suman Bogati  {@link http://vidyamantra.com}
 @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 This file recevied the audio from audio worker send (worker-audio-send),
 encode the audio and send it to io worker(worker-io.js)
*/
const workerAudioSendBlob=URL.createObjectURL(new Blob(["(",function(){importScripts("https://live.congrea.net/virtualclass/build/src/audio-g711-and-resampler.min.js");const d={audioWorkletSend:null,workerIO:null,gObjUid:null,audMouseDown:!1,precheck:!1,repMode:!1,minthreshold:65535,audioWasSent:0,preAvg:0,curAvg:0,maxthreshold:0,convertFloat32ToInt16(c){let a=c.length;const b=new Int16Array(a);for(;a--;)b[a]=32767*Math.min(1,c[a]);return b},encodeAudio(c){return G711.encode(c,{alaw:!0})},breakintobytes(c,
a){c=c.toString();for(let b=c.length;b<a;b++)c=`0${c}`;return c.match(/[\S]{1,2}/g)||[]},sendBinary(c){null!=this.workerIO&&this.workerIO.postMessage({cmd:"sendBinary",msg:c})},audioSend(c,a){if(this.audMouseDown&&!this.precheck){a=this.breakintobytes(this.gObjUid,8);a=new Int8Array([101,a[0],a[1],a[2],a[3]]);const b=new Int8Array(c.length+a.length);b.set(a);b.set(c,a.length);this.sendBinary(b)}},silenceDetection(c,a){let b,f=sum=rate=0;for(i=0;i<a.length;i++)b=Math.abs(a[i]),f<b&&(f=b),sum+=b;this.curAvg=
sum/a.length;rate=Math.abs(this.curAvg^2-this.preAvg^2);this.preAvg=this.curAvg;5>rate&&(this.minthreshold=f);this.minthreshold>f&&(this.minthreshold=f);this.maxthreshold<f&&(this.maxthreshold=f);20*this.minthreshold<this.maxthreshold&&(this.minthreshold*=5);this.maxthreshold/20>this.minthreshold&&(this.maxthreshold/=5);10<g&&(this.maxthreshold*=.8);var g=this.maxthreshold/this.minthreshold;a=f/this.minthreshold;0!==f&&postMessage({cmd:"unMuteAudio"});isFinite(g)&&20<=g||2<a||rate>this.minthreshold||
25<rate||f>2*this.minthreshold||4>=g?(this.audioSend(c,"sending"),this.audioWasSent=6):0<this.audioWasSent?(this.audioSend(c,"sending"),this.audioWasSent--):2>g?this.audioSend(c,"sending"):0===f&&postMessage({cmd:"muteAudio"});return c},recorderProcess(c){if(!this.repMode&&this.audMouseDown&&!this.precheck){c=this.resampler.resampler(c);c=this.convertFloat32ToInt16(c);const a=this.encodeAudio(c);this.silenceDetection(a,c)}},onMessage(c){switch(c.data.cmd){case "workerIO":this.workerIO=c.ports[0];
this.resampler=new Resampler(c.data.sampleRate,8E3,1,4096);this.workerIO.onmessage=function(a){console.log("From io lib")};this.gObjUid=c.data.uid;break;case "audioWorkletSend":this.audioWorkletSend=c.ports[0];this.repMode=c.data.msg.repMode;this.audioWorkletSend.onmessage=this.formAudioWorkletSend.bind(this);break;case "audioMouseDown":this.audMouseDown=c.data.msg.adMouseDown;break;case "precheck":this.precheck=c.data.msg.precheck;break;case "rawAudio":this.recorderProcess(c.data.msg);break;default:console.log("Do nothing")}},
formAudioWorkletSend(c){c.data.hasOwnProperty("cmd")&&"rawAudio"==c.data.cmd&&this.recorderProcess(c.data.msg)}};onmessage=function(c){d.onMessage(c)}}.toString(),")()"],{type:"application/javascript"})),workerAudioSend=new Worker(workerAudioSendBlob);/*
  2018 Suman Bogati  {@link http://vidyamantra.com}
 @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 This file(Audio worklet) plays the received Audio from received audio worker(worker-audio-rec.js)
*/
const workletAudioRecBlob=URL.createObjectURL(new Blob(["(",function(){function d(b){b.data.hasOwnProperty("cmd")&&"workerAudioRec"===b.data.cmd&&(m=b.ports[0],m.onmessage=c)}function c(b){if(b.data.hasOwnProperty("cmd")&&"audio"===b.data.cmd){var c=b.data.msg.data;b=b.data.msg.uid;null==a[b]&&(a[b]=[]);null==g[b]&&(g[b]=[]);for(let a=0;a<c.length;a++)g[b].push(c[a]);for(;128<=g[b].length;)c=g[b].splice(0,128),a[b].push(new Float32Array(c))}}const a={},b={};let f=0;const g={};let k,m;const n=[];let q=
0;class r extends AudioWorkletProcessor{constructor(){super();this.port.onmessage=d}process(c,g){q=n.length=0;for(k in a){b:{c=k;if(null!==a){if(288<=a[c].length){for(;96<=a[c].length;)a[c].shift();b[c]=!0;c=a[c].shift();break b}if(64<=a[c].length){b[c]=!0;c=a[c].shift();break b}if(0<a[c].length&&!0===b[c]){b[c]=!0;c=a[c].shift();break b}b[c]=!1;0===a[c].length&&delete a[c]}c=void 0}if(null!=c)if(q++,1===q)for(var d=0;128>d;d++)n[d]=c[d];else for(d=0;128>d;d++)n[d]+=c[d]}if(1===q)c=n;else if(1<q){for(c=
0;128>c;c++)n[c]/=q;c=n}else c=void 0;if(null!=c)g[0][0].set(c,0),f=c[127];else if(null!==f)for(c=0;128>c;c++)g[0][0][c]=f;return!0}}registerProcessor("worklet-audio-rec",r)}.toString(),")()"],{type:"application/javascript"}));/*
  2018 Suman Bogati  {@link http://vidyamantra.com}
 @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 This file gets audio continuously from getUserMedia, and
 send it to send audio worker (worker-audio-send.js)
*/
var workletAudioSendBlob=URL.createObjectURL(new Blob(["(",function(){console.log("== init audio worklet 1");class d extends AudioWorkletProcessor{constructor(){super();this.audios=new Float32Array(4096);this.position=0;const c=this;this.port.onmessage=function(a){a.data.hasOwnProperty("cmd")&&"workerAudioSend"==a.data.cmd&&(c.workerAudioSend=a.ports[0],c.workerAudioSend.onmessage=c.fromworkerAudioSend)}}fromworkerAudioSend(){console.log("This is from audio sender")}process(c,a){c=c[0][0];this.audios.set(c,
this.position);this.position+=c.length;4096<=this.position&&(this.hasOwnProperty("workerAudioSend")&&this.workerAudioSend.postMessage({cmd:"rawAudio",msg:this.audios}),this.audios=new Float32Array(4096),this.position=0);return!0}}registerProcessor("worklet-audio-send",d)}.toString(),")()"],{type:"application/javascript"}));const webpToPngBlob=URL.createObjectURL(new Blob(["(",function(){importScripts("https://live.congrea.net/virtualclass/build/src/video-libwebp-0.1.3.min.js");onmessage=function(d){if(d.data.hasOwnProperty("vdata")){{var c=d.data.vdata;d=d.data.canid;const g=new WebPDecoder;c=convertBinaryToArray(c);const k=g.WebPDecoderConfig;var a=k.output,b=k.input;if(g.WebPInitDecoderConfig(k)){k.options.no_fancy_upsampling=0;k.options.bypass_filtering=0;k.options.use_cropping=0;k.options.crop_left=0;k.options.crop_top=
0;k.options.crop_width=0;k.options.crop_height=0;var f=g.VP8StatusCode;if(0<c.length&&(b=g.WebPGetFeatures(c,c.length,b),b!=f.VP8_STATUS_OK&&alert("error"),a.colorspace=g.WEBP_CSP_MODE.MODE_RGBA,0<c.length))if(b=parseInt(g.WebPDecode(c,c.length,k),10),b!=f.VP8_STATUS_OK)alert("Decoding of %s failed.\n");else if(c=a.u.RGBA.rgba)f=a.height,a=a.width,c.pop(),postMessage({vdata:new Uint8ClampedArray(c),bh:f,bw:a,canid:d})}else alert("Library version mismatch!\n")}}}}.toString(),")()"],{type:"application/javascript"})),
webpToPng=new Worker(webpToPngBlob);/*
  2014 Suman Bogati, Pinky Sharma and Jai Gupta  {@link http://vidyamantra.com}
 @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
*/
var io={cfg:{},sock:null,wsuri:null,error:null,uniquesids:null,serial:null,globallock:!1,readyToSend:!1,globalmsgjson:[],packetQueue:[],binMsgQueue:[],jsnMsgQueue:[],recBinMsgQueue:[],recjsnMsgQueue:null,stockReadyState:!1,workerIOOnmessage:!1,sessionSet:!1,recordingSet:!1,init(d){this.cfg=d;"use strict";console.log("==== io init ");ioInit.sendToWorker({cmd:"init",msg:d})},send(d,c,a){d.hasOwnProperty("m")&&"all"==d.m.user&&alert("som packet are sending");d={cfun:c,arg:{msg:d}};a&&(d.arg.touser=a);
if(this.webSocketConnected()){if(0<io.packetQueue.length){for(a=0;a<io.packetQueue.length;a++)c=JSON.parse(io.packetQueue[a]),this.realSend(c);io.packetQueue.length=0}this.realSend(d)}else console.log("SOCKET is not ready."),a=JSON.stringify(d),io.packetQueue.push(a)},realSend(d){if("undefined"!==typeof d.arg.touser)if(null==io.uniquesids)console.log("uniqueid is null");else if(d.arg.touser=io.uniquesids[d.arg.touser],"undefined"===typeof d.arg.touser){console.log(`User is not connected.${d.arg.touser}`);
return}var c={userid:wbUser.id};switch(d.cfun){case "broadcastToAll":if("undefined"===typeof d.arg.touser)c={user:c,m:d.arg.msg},d=`F-BR-{"0${JSON.stringify(c)}`;else{c={user:c,m:d.arg.msg,userto:d.arg.touser};for({touser:d}=d.arg;12>d.length;)d=`0${d}`;d=`F-BRU-{"${d}{"0${JSON.stringify(c)}`}break;case "ping":c={type:"PONG",m:d.arg.msg};d=`F-PI-${JSON.stringify(c)}`;break;case "speed":d=`F-SPE-{"${d.arg.msg}`;break;case "session":d=`F-SS-{"${d.arg.msg}`;break;case "recording":d=`F-SR-{"${d.arg.msg}`;
break;default:d=JSON.stringify(d)}if(6E5>=d.length)workerIO.postMessage({cmd:"send",msg:d});else{if(this.jsnMsgQueue=this.chunkSubstr(d,55E4))for(d=0;d<this.jsnMsgQueue.length;d++)workerIO.postMessage({cmd:"send",msg:this.jsnMsgQueue[d]});this.jsnMsgQueue=[]}},chunkSubstr(d,c){if(d.startsWith('F-BR-{"0')){var a='F-BR-{"';d=d.replace('F-BR-{"0',"")}else if(d.startsWith('F-BRU-{"'))a=d.substring(0,22),d=d.substring(23,d.length);else return!1;const b=Math.ceil(d.length/c),f=Array(b);for(let g=0,k=0;g<
b;++g,k+=c)f[g]=d.substr(k,c),f[g]=0==g?`${a}1${f[g]}`:g<b-1?`${a}2${f[g]}`:`${a}3${f[g]}`;return f},cleanRecJson(d){if(!(d.startsWith('{"0{"')||d.startsWith('{"1{"')||d.startsWith('{"2')||d.startsWith('{"3')))return d;if(d.startsWith('{"0{"'))return d=d.replace('{"0{"','{"');if(d.startsWith('{"1{"'))this.recjsnMsgQueue=d.replace('{"1{"','{"');else if(d.startsWith('{"2'))0<this.recjsnMsgQueue.length&&(this.recjsnMsgQueue+=d.replace('{"2',""));else if(d.startsWith('{"3')){if(0<this.recjsnMsgQueue.length)return this.recjsnMsgQueue+=
d.replace('{"3',"")}else this.recjsnMsgQueue="";return!1},sendBinary(d){workerIO.postMessage({cmd:"sendBinary",msg:d})},onRecMessage(d){if(d.data instanceof ArrayBuffer)workerIO.postMessage({cmd:"onRecBinary",msg:d.data});else ioInit.onmessage({data:{cmd:"receivedJson",msg:d.data}})},webSocketConnected(){return roles.hasControls()&&!io.sessionSet||virtualclass.settings.recording.enableRecording&&!io.recordingSet||!io.readyToSend?!1:io.stockReadyState},onRecJson(d){if(!1===io.globallock)if(0<io.globalmsgjson.length)for(;0<
io.globalmsgjson.length&&!1===io.globallock;)d=io.globalmsgjson.shift(),io.onRecJsonIndividual(d);else if(null!=d&&!1===io.globallock&&0==io.globalmsgjson.length)io.onRecJsonIndividual(d);else null!=d&&io.globalmsgjson.push(d);else null!=d&&io.globalmsgjson.push(d)},onRecJsonIndividual(d){var c="";switch(d.type){case "joinroom":d.hasOwnProperty("users")?(ioAdapter.setRecording(),console.log("==== Member add, join room")):console.log("No users");io.readyToSend=!0;c=null;if(null!=io.uniquesids)for(var a in d.clientids)void 0==
io.uniquesids[a]&&(c=a);io.uniquesids=d.clientids;a={type:"member_added",newuser:c,joinUser:d.action};d.hasOwnProperty("users")?(a.message=d.users,a.users=!0):d.hasOwnProperty("user")&&(a.message=d.user,a.user=!0);(!virtualclass.vutil.isPlayMode()||d.hasOwnProperty("clientids")&&!virtualclass.hasOwnProperty("connectedUsers")||virtualclass.hasOwnProperty("connectedUsers")&&!d.hasOwnProperty("clientids"))&&virtualclass.ioEventApi.readyto_member_add(a);break;case "broadcastToAll":case "broadcast":null!==
d&&(void 0!=d.userto&&(c=d.userto),virtualclass.ioEventApi.newmessage({type:"newmessage",message:d.m,fromUser:d.user,toUser:virtualclass.vutil.getUserAllInfo(c,virtualclass.connectedUsers)}));break;case "userleft":if(null!=io.uniquesids)for(const b in d.action)console.log(`===== JOIN user left call ${b}`),delete io.uniquesids[b];virtualclass.ioEventApi.readyto_user_logout(d);break;case "Unauthenticated":console.log("Case:- unauthenticated");virtualclass.ioEventApi.authentication_failed({type:"authentication_failed",
message:"Authentication failed"});break;case "Multiple_login":console.log("Case:- Multiple_login");virtualclass.ioEventApi.Multiple_login({type:"Multiple_login"});break;case "PONG":virtualclass.ioEventApi.PONG({type:"PONG",message:d.m});break;case "Text_Limit_Exeed":virtualclass.ioEventApi.Text_Limit_Exeed({type:"Text_Limit_Exeed"});break;case "Binary_Limit_Exeed":virtualclass.ioEventApi.Binary_Limit_Exeed({type:"Binary_Limit_Exeed"});break;case "Max_rooms":virtualclass.ioEventApi.Max_rooms({type:"Max_rooms"});
break;case "Max_users":virtualclass.ioEventApi.Max_users({type:"Max_users"});break;case "setSession":roles.hasControls()&&ioAdapter.initSetSession(d.session)}},disconnect(){workerIO.postMessage({cmd:"disconnect"})}};workerIO.onmessage=function(d){ioInit.onmessage(d)};
var ioInit={sendToWorker(d){workerIO.postMessage(d)},onmessage(d){switch(d.data.cmd){case "connectionopen":io.stockReadyState=!0;virtualclass.ioEventApi.connectionopen(d.data.msg);break;case "receivedJson":var c=io.cleanRecJson(d.data.msg);if(c)if(d=JSON.parse(c),!d.hasOwnProperty("type")&&d.hasOwnProperty("user")&&(d.type="broadcastToAll","undefined"===typeof virtualclass.gObj.allUserObj[d.user.userid]&&(virtualclass.gObj.allUserObj[d.user.userid]={},virtualclass.gObj.allUserObj[d.user.userid].userid=
d.user.userid,virtualclass.gObj.allUserObj[d.user.userid].lname=" ",virtualclass.gObj.allUserObj[d.user.userid].name="student",virtualclass.gObj.allUserObj[d.user.userid].role="s"),virtualclass.gObj.allUserObj[d.user.userid].userid==d.user.userid&&(d.user.lname=virtualclass.gObj.allUserObj[d.user.userid].lname,d.user.name=virtualclass.gObj.allUserObj[d.user.userid].name,d.user.role=virtualclass.gObj.allUserObj[d.user.userid].role)),this.recjsnMsgQueue="",d.hasOwnProperty("m"))if(d.m.hasOwnProperty("serial"))ioMissingPackets.checkMissing(d);
else if(d.m.hasOwnProperty("reqMissPac"))virtualclass.recorder.hasOwnProperty("startUpload")||ioMissingPackets.sendMissedPackets(d);else if(d.m.hasOwnProperty("missedpackets"))console.log("Execute missed packets"),ioMissingPackets.fillExecutedStore(d);else if(d.m.hasOwnProperty("userSerial"))ioMissingPackets.userCheckMissing(d);else if(d.m.hasOwnProperty("userReqMissPac"))virtualclass.recorder.hasOwnProperty("startUpload")||ioMissingPackets.userSendMissedPackets(d);else if(d.m.hasOwnProperty("userMissedpackets"))ioMissingPackets.userFillExecutedStore(d);
else io.onRecJson(d);else io.onRecJson(d);break;case "onRecBinary":io.onRecBinary(d);break;case "iamclosing":io.stockReadyState=!1;io.sessionSet=!1;io.recordingSet=!1;break;case "error":io.stockReadyState=!1;io.sessionSet=!1;io.recordingSet=!1;virtualclass.ioEventApi.error({type:"error",message:d.data.msg});break;case "close":io.stockReadyState=!1;io.sessionSet=!1;io.recordingSet=!1;virtualclass.ioEventApi.connectionclose({type:"connectionclose",message:d.data.msg});setTimeout(()=>{virtualclass.gObj.hasOwnProperty("endSession")||
virtualclass.gObj.hasOwnProperty("downloadProgress")||virtualclass.recorder.uploadInProcess||virtualclass.gObj.hasOwnProperty("invalidlogin")&&virtualclass.gObj.invalidlogin||workerIO.postMessage({cmd:"wsconnect"})},5E3);break;case "initAudioWorklet":virtualclass.gObj.hasOwnProperty("isAudioContextReady")&&!virtualclass.gObj.audioRecWorkerReady&&(virtualclass.media.detectAudioWorklet()?virtualclass.media.audio.initPlay():virtualclass.media.audio.initPlayWithFallback());break;case "stBinary":d.data.hasOwnProperty("triggerBinRec")&&
virtualclass.ioEventApi.binrec({type:"binrec",message:d.data.msg.buffer});break;case "notaudio":virtualclass.ioEventApi.binrec({type:"binrec",message:d.data.msg});break;case "endBinary":({msg:d}=d.data);d.constructor===Int8Array?c=new Int8Array(d.length+2):d.constructor===Uint8ClampedArray&&(c=new Uint8ClampedArray(d.length+2));c[0]=d[0];c[1]=0;c.set(d,2);virtualclass.ioEventApi.binrec({type:"binrec",message:d.buffer});break;case "firstAudio":var a=virtualclass.user.control.updateUser(d.data.msg.userId,
"ad",!0);virtualclass.user.control.audioSign(a,"create");break;case "audioSign":virtualclass.user.control.audioSign(a,"create");break;default:console.log("Do nothing")}}};/*
 modernizr 3.5.0 (Custom Build) | MIT *
 https://modernizr.com/download/?-webp-setclasses ! */
!function(d,c,a){function b(b){let a=r.className;const c=n._config.classPrefix||"";if(z&&(a=a.baseVal),n._config.enableJSClass)a=a.replace(new RegExp(`(^|\\s)${c}no-js(\\s|$)`),`$1${c}js$2`);n._config.enableClasses&&(a+=` ${c}${b.join(` ${c}`)}`,z?r.className.baseVal=a:r.className=a)}function f(a,c){if("object"===typeof a)for(var g in a)q(a,g)&&f(g,a[g]);else{a=a.toLowerCase();g=a.split(".");let f=n[g[0]];if(2==g.length&&(f=f[g[1]]),"undefined"!==typeof f)return n;c="function"===typeof c?c():c;1==
g.length?n[g[0]]=c:(!n[g[0]]||n[g[0]]instanceof Boolean||(n[g[0]]=new Boolean(n[g[0]])),n[g[0]][g[1]]=c);b([(c&&0!=c?"":"no-")+g.join("-")]);n._trigger(a,c)}return n}var g=[],k=[];const m={_version:"3.5.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on(b,a){const c=this;setTimeout(()=>{a(c[b])},0)},addTest(b,a,c){k.push({name:b,fn:a,options:c})},addAsyncTest(b){k.push({name:null,fn:b})}};var n=function(){};n.prototype=m;n=new n;let q;var r=c.documentElement,z="svg"===
r.nodeName.toLowerCase();!function(){const b={}.hasOwnProperty;q="undefined"===typeof b||"undefined"===typeof b.call?function(b,a){return a in b&&"undefined"===typeof b.constructor.prototype[a]}:function(a,c){return b.call(a,c)}}();m._l={};m.on=function(b,a){this._l[b]||(this._l[b]=[]);this._l[b].push(a);n.hasOwnProperty(b)&&setTimeout(()=>{n._trigger(b,n[b])},0)};m._trigger=function(b,a){if(this._l[b]){const c=this._l[b];setTimeout(()=>{let b;for(b=0;b<c.length;b++)(0,c[b])(a)},0);delete this._l[b]}};
n._q.push(()=>{m.addTest=f});n.addAsyncTest(()=>{function b(b,a,c){function g(a){const g=a&&"load"===a.type?1==k.width:!1;f(b,"webp"===b&&g?new Boolean(g):g);c&&c(a)}var k=new Image;k.onerror=g;k.onload=g;k.src=a}const a=[{uri:"data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA=",name:"webp"},{uri:"data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAABBxAR/Q9ERP8DAABWUDggGAAAADABAJ0BKgEAAQADADQlpAADcAD++/1QAA==",name:"webp.alpha"},{uri:"data:image/webp;base64,UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA",
name:"webp.animation"},{uri:"data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",name:"webp.lossless"}],c=a.shift();b(c.name,c.uri,c=>{if(c&&"load"===c.type)for(c=0;c<a.length;c++)b(a[c].name,a[c].uri)})});(function(){let b,a;var c;let f;for(const m in k)if(k.hasOwnProperty(m)){if(b=[],a=k[m],a.name&&(b.push(a.name.toLowerCase()),a.options&&a.options.aliases&&a.options.aliases.length))for(c=0;c<a.options.aliases.length;c++)b.push(a.options.aliases[c].toLowerCase());c="function"===
typeof a.fn?a.fn():a.fn;for(f=0;f<b.length;f++){var d=b[f];d=d.split(".");1===d.length?n[d[0]]=c:(!n[d[0]]||n[d[0]]instanceof Boolean||(n[d[0]]=new Boolean(n[d[0]])),n[d[0]][d[1]]=c);g.push((c?"":"no-")+d.join("-"))}}})();b(g);delete m.addTest;delete m.addAsyncTest;for(c=0;c<n._q.length;c++)n._q[c]();d.Modernizr=n}(window,document);const roles={isTeacher(){return"t"===virtualclass.gObj.uRole},isStudent(){return"s"===virtualclass.gObj.uRole},isPresenter(){return"p"===virtualclass.gObj.uRole},isEducator(){return"e"===virtualclass.gObj.uRole},hasControls(){return"t"===virtualclass.gObj.uRole||"p"===virtualclass.gObj.uRole},hasAdmin(){return"t"===virtualclass.gObj.uRole||"e"===virtualclass.gObj.uRole},hasView(){return"s"===virtualclass.gObj.uRole||"e"===virtualclass.gObj.uRole}};var ioStorage={dataAdapterStore(d,c){"object"===typeof virtualclass.storage&&"object"===typeof virtualclass.storage.db?virtualclass.storage.dataAdapterAllStore(JSON.stringify(d),c):setTimeout(()=>{ioStorage.dataAdapterStore(d,c)},10)},dataUserAdapterMustData(d,c){"object"===typeof virtualclass.storage&&"object"===typeof virtualclass.storage.db?virtualclass.storage.dataUserAdapterAllStore(JSON.stringify(d),c):setTimeout(()=>{ioStorage.dataUserAdapterMustData(d,c)},10)},dataExecutedStoreAll(d,c){virtualclass.storage.dataExecutedStoreAll(JSON.stringify(d),
c)},dataExecutedUserStoreAll(d,c){virtualclass.storage.dataExecutedUserStoreAll(JSON.stringify(d),c)}};var ioMissingPackets={executedStore:[],executedSerial:null!=localStorage.getItem("executedSerial")?JSON.parse(localStorage.getItem("executedSerial")):{},missRequest:[],aheadPackets:[],missRequestFlag:0,executedUserStore:[],executedUserSerial:null!=localStorage.getItem("executedUserSerial")?JSON.parse(localStorage.getItem("executedUserSerial")):{},missUserRequest:[],aheadUserPackets:[],missUserRequestFlag:0,validateAllVariables(d){if("undefined"===typeof this.executedSerial||null==this.executedSerial)this.executedSerial=
{};"undefined"===typeof this.executedSerial[d]&&(this.executedSerial[d]=-1);"undefined"===typeof this.missRequest[d]&&(this.missRequest[d]=0);"undefined"===typeof this.executedStore[d]&&(this.executedStore[d]=[]);"undefined"===typeof this.aheadPackets[d]&&(this.aheadPackets[d]=[])},validateAllUserVariables(d){if("undefined"===typeof this.executedUserSerial||null==this.executedUserSerial)this.executedUserSerial={};"undefined"===typeof this.executedUserSerial[d]&&(this.executedUserSerial[d]=-1);"undefined"===
typeof this.missUserRequest[d]&&(this.missUserRequest[d]=0);"undefined"===typeof this.executedUserStore[d]&&(this.executedUserStore[d]=[]);"undefined"===typeof this.aheadUserPackets[d]&&(this.aheadUserPackets[d]=[])},checkMissing(d){if(virtualclass.isPlayMode)io.onRecJson(d);else{var c=d.user.userid;this.validateAllVariables(c);if("t"==d.user.role&&d.m.hasOwnProperty("ping")&&d.m.hasOwnProperty("session")){const a=localStorage.getItem("mySession");if(null!=a&&d.m.session!=a){virtualclass.isPlayMode?
virtualclass.config.setNewSession("thisismyplaymode"):(localStorage.removeItem("mySession"),virtualclass.config.endSession(),virtualclass.config.setNewSession(d.m.session),console.log("REFRESH SESSION"));console.log("Start session gracefully");return}}1==d.m.missedpackets?this.fillExecutedStore(d):"undefined"!==typeof d.m.serial&&null!=d.m.serial?d.m.serial==this.executedSerial[c]+1?(console.log(`UID ${c} Object with Serial ${d.m.serial}`),this.executedSerial[c]=d.m.serial,this.executedStore[c][d.m.serial]=
d,ioStorage.dataExecutedStoreAll(d,`${c}_${d.m.serial}`),io.onRecJson(d)):d.m.serial>this.executedSerial[c]+1?(console.log(`UID ${c} requst miss packet`),this.requestMissedPackets(this.executedSerial[c]+1,d.m.serial,d,c)):(console.log(`UID ${c} no action current packet ${this.executedSerial[c]} coming at ${d.m.serial}`),this.executedStore[c][d.m.serial]=d):console.log(`UID ${c} checkMissing should not be called without serial`)}},userCheckMissing(d){const c=d.user.userid;this.validateAllUserVariables(c);
1==d.m.missedpackets?this.fillExecutedStore(d):"undefined"!==typeof d.m.userSerial&&null!=d.m.userSerial?d.m.userSerial==this.executedUserSerial[c]+1?(console.log(`UID ${c} Object with userSerial ${d.m.userSerial}`),this.executedUserSerial[c]=d.m.userSerial,io.onRecJson(d),this.executedUserStore[c][d.m.userSerial]=d,ioStorage.dataExecutedStoreAll(d,`${c}_${d.m.userSerial}`)):d.m.userSerial>this.executedUserSerial[c]+1?(console.log(`UID ${c} requst miss packet`),this.userRequestMissedPackets(this.executedUserSerial[c]+
1,d.m.userSerial,d,c)):(console.log(`UID ${c} no action current packet ${this.executedUserSerial[c]} coming at ${d.m.userSerial}`),this.executedUserStore[c][d.m.userSerial]=d):console.log(`UID ${c} checkMissing should not be called without userSerial`)},requestMissedPackets(d,c,a,b){0>d&&(d=0);"use strict";0==this.missRequest[b]?(this.aheadPackets[b].unshift(a.m.serial),this.executedStore[b][a.m.serial]=a,c--,console.log(`UID ${b} request packet from ${d} to ${c}`),this.waitAndResetmissRequest(b),
ioAdapter.sendUser({reqMissPac:1,from:d,till:c},b)):(console.log(`UID ${b} ahead packet${a.m.serial}`),this.aheadPackets[b].unshift(a.m.serial),this.executedStore[b][a.m.serial]=a)},userRequestMissedPackets(d,c,a,b){0>d&&(d=0);"use strict";0==this.missUserRequest[b]?(this.aheadUserPackets[b].unshift(a.m.userSerial),this.executedUserStore[b][a.m.userSerial]=a,c--,console.log(`UID ${b} User request packet from ${d} to ${c}`),this.userWaitAndResetmissUserRequest(b),ioAdapter.sendUser({userReqMissPac:1,
from:d,till:c},b)):(console.log(`UID ${b} User ahead packet${a.m.userSerial}`),this.aheadUserPackets[b].unshift(a.m.userSerial),this.executedUserStore[b][a.m.userSerial]=a)},waitAndResetmissRequest(d){ioMissingPackets.missRequest[d]=1;ioMissingPackets.missRequestFlag=1;setTimeout(()=>{ioMissingPackets.missRequest[d]=0;ioMissingPackets.missRequestFlag=0},15E3)},userWaitAndResetmissUserRequest(d){ioMissingPackets.missUserRequest[d]=1;ioMissingPackets.missUserRequestFlag=1;setTimeout(()=>{ioMissingPackets.missUserRequest[d]=
0;ioMissingPackets.missUserRequestFlag=0},15E3)},sendMissedPackets(d){const c=d.user.userid;this.validateAllVariables(c);var {from:a}=d.m;0>a&&(a=0);a=ioAdapter.adapterMustData.slice(a,d.m.till+1);ioAdapter.sendUser({missedpackets:1,data:a},d.user.userid);console.log(`UID ${c} send packet total chunk length ${a.length}`)},userSendMissedPackets(d){const c=d.user.userid;this.validateAllUserVariables(c);var {from:a}=d.m;0>a&&(a=0);a=ioAdapter.userAdapterMustData[c].slice(a,d.m.till+1);ioAdapter.sendUser({userMissedpackets:1,
data:a},d.user.userid);console.log(`UID ${c} send packet total chunk length ${a.length}`)},fillExecutedStore2(d){const c=d.user.userid;this.validateAllVariables(c);const a=d.m.data.length;let b;for(b=0;b<a;b++)if(null!=d.m.data[b])if("undefined"!==typeof d.m.data[b].m.serial&&null!=d.m.data[b].m.serial){this.executedSerial[c]=d.m.data[b].m.serial;ioStorage.dataExecutedStoreAll(d.m.data[b],`${c}_${d.m.data[b].m.serial}`);d.m.data[b].user=d.user;this.executedStore[c][d.m.data[b].m.serial]=d.m.data[b];
try{console.log(`UID ${c} Object with Serial ${d.m.data[b].m.serial}`),io.onRecJson(d.m.data[b])}catch(f){console.log(`Error ${f}`)}}else console.log(`UID ${c} Received Packed missing serial`);for(this.aheadPackets[c]=this.aheadPackets[c].sort((b,a)=>a-b);d=this.aheadPackets[c].pop();)if("undefined"!==typeof d&&null!=d)if("undefined"!==typeof this.executedStore[c][d])this.executedSerial[c]=d,console.log(`UID ${c} Object with Serial ${this.executedStore[c][d].m.serial}`),ioStorage.dataExecutedStoreAll(this.executedStore[c][d],
`${c}_${this.executedStore[c][d].m.serial}`),io.onRecJson(this.executedStore[c][d]);else{console.log("fillExecutedStore undefined");return}else console.log(`UID ${c} ahead Packed missing serial`);this.missRequest[c]=0;ioMissingPackets.missRequestFlag=0;virtualclass.vutil.initCommonSortingChat()},fillExecutedStore(d){const c=d.user.userid;this.validateAllVariables(c);const a=d.m.data.length;let b;for(b=0;b<a;b++)if(null!=d.m.data[b])if("undefined"!==typeof d.m.data[b].m.serial&&null!=d.m.data[b].m.serial){this.executedSerial[c]=
d.m.data[b].m.serial;ioStorage.dataExecutedStoreAll(d.m.data[b],`${c}_${d.m.data[b].m.serial}`);d.m.data[b].user=d.user;this.executedStore[c][d.m.data[b].m.serial]=d.m.data[b];try{console.log(`UID ${c} Object with Serial ${d.m.data[b].m.serial}`),io.onRecJson(d.m.data[b])}catch(f){console.log(`Error ${f}`)}}else console.log(`UID ${c} Received Packed missing serial`);for(this.aheadPackets[c]=this.aheadPackets[c].sort((b,a)=>a-b);d=this.aheadPackets[c].pop();)if("undefined"!==typeof d&&null!=d)if("undefined"!==
typeof this.executedStore[c][d])this.executedSerial[c]=d,console.log(`UID ${c} Object with Serial ${this.executedStore[c][d].m.serial}`),ioStorage.dataExecutedStoreAll(this.executedStore[c][d],`${c}_${this.executedStore[c][d].m.serial}`),io.onRecJson(this.executedStore[c][d]);else{console.log("fillExecutedStore undefined");return}else console.log(`UID ${c} ahead Packed missing serial`);this.missRequest[c]=0;ioMissingPackets.missRequestFlag=0;virtualclass.vutil.initCommonSortingChat()},userFillExecutedStore(d){const c=
d.user.userid;this.validateAllUserVariables(c);0<d.m.data.length||console.log(`UID ${c} empty user data object`);const a=d.m.data.length;let b;for(b=0;b<a;b++)if(null!=d.m.data[b])if("undefined"!==typeof d.m.data[b].m.userSerial&&null!=d.m.data[b].m.userSerial){this.executedUserSerial[c]=d.m.data[b].m.userSerial;ioStorage.dataExecutedUserStoreAll(d.m.data[b],`${c}_${d.m.data[b].m.userSerial}`,d.m.data[b].m.userSerial);d.m.data[b].user=d.user;d.m.data[b].userto=d.userto;try{console.log(`UID ${c} Object with user Serial ${d.m.data[b].m.userSerial}`),
io.onRecJson(d.m.data[b])}catch(f){console.log(`Error ${f}`)}this.executedUserStore[c][d.m.data[b].m.userSerial]=d.m.data[b]}else console.log(`UID ${c} Received Packed missing User serial`);for(this.aheadUserPackets[c]=this.aheadUserPackets[c].sort((b,a)=>a-b);d=this.aheadUserPackets[c].pop();)"undefined"!==typeof d&&null!=d?(this.executedUserSerial[c]=d,console.log(`UID ${c} Object with Serial ${this.executedUserStore[c][d].m.userSerial}`),io.onRecJson(this.executedUserStore[c][d])):console.log(`UID ${c} ahead Packed missing serial`);
this.missUserRequest[c]=0;ioMissingPackets.missUserRequestFlag=0;virtualclass.vutil.initCommonSortingChat()}};var ioAdapter={adapterMustData:[],serial:-1,userSerial:[],userAdapterMustData:[],sendWithDelayIdentifier:{},validateAllVariables(d){if("undefined"===typeof this.userSerial||null==this.userSerial)this.userSerial=[];"undefined"===typeof this.userSerial[d]&&(this.userSerial[d]=-1);if("undefined"===typeof this.userAdapterMustData||null==this.userAdapterMustData)this.userAdapterMustData=[];"undefined"===typeof this.userAdapterMustData[d]&&(this.userAdapterMustData[d]=[])},sendWithDelayAndDrop(d,c,a,b,
f){null!=d&&null!=a&&(null==b&&(b=0),null==f&&(f=1E3),this.sendWithDelayIdentifier.hasOwnProperty(b)&&ioAdapter.sendWithDelayIdentifier[b]&&(console.log(`Cancelling send ${a} message ${d.cf}`),clearTimeout(ioAdapter.sendWithDelayIdentifier[b]),ioAdapter.sendWithDelayIdentifier[b]=0),ioAdapter.sendWithDelayIdentifier[b]=setTimeout(()=>{console.log(`Sending With Delay ${a} message ${d.cf}`);ioAdapter[a](d);ioAdapter.sendWithDelayIdentifier[b]=0},f))},mustSend(d){this.serial++;d.serial=this.serial;this.adapterMustData[this.serial]=
{type:"broadcast",m:d};this.send(d);ioStorage.dataAdapterStore({type:"broadcast",user:wbUser.id,m:d},this.serial)},send(d){io.send(d,"broadcastToAll",null)},mustSendAll(d){this.mustSendUser(d,virtualclass.gObj.uid);this.mustSend(d)},mustSendUser(d,c){this.validateAllVariables(c);"undefined"!==typeof d.serial&&d.serial&&(d.serial=null);this.userSerial[c]++;console.log(`USER s.n ${this.userSerial[c]} user ${c}`);d.userSerial=this.userSerial[c];this.userAdapterMustData[c][d.userSerial]={type:"broadcastToAll",
m:d};this.sendUser(d,c);ioStorage.dataUserAdapterMustData({type:"broadcastToAll",user:wbUser.id,m:d},`${c}_${d.userSerial}`)},sendUser(d,c){io.send(d,"broadcastToAll",c)},sendPing(d){io.send(d,"ping")},sendSpeed(d){ioAdapter.sendWithDelayAndDrop(d,null,"realSendSpeed","sendSpeed",1E3)},realSendSpeed(d){io.send(d,"speed")},sendBinary(d){io.sendBinary(d)},setRecording(){if(!virtualclass.isPlayMode&&virtualclass.settings.info.enableRecording&&(roles.hasControls()||virtualclass.settings.info.attendeerecording)){var d=
virtualclass.settings.recording.sendYesOrNo();io.realSend({cfun:"recording",arg:{msg:d}});io.recordingSet=!0;console.log(`==== Send Recording a/v ${d}`)}},setSession(d){io.realSend({cfun:"session",arg:{msg:d}})},initSetSession(d){const c=localStorage.getItem("serverSession");null===c?(localStorage.setItem("serverSession",d),io.sessionSet=!0):c!==d?this.setSession(c):io.sessionSet=!0},sync(d){io.send(d,"broadcastToAll",null)}};const ioPingPong={ping(d){"member_added"==d.type&&roles.hasAdmin()&&(d={ping:"ping",cf:"pong",session:this.sessionName()},ioAdapter.sendWithDelayAndDrop(d,null,"mustSend","pingAll",3E3),console.log("PING BROADCAST"))},pong(d){d.toUser?(console.log(`PONG TO ${d.toUser.userid} from ${d.fromUser.userid}`),ioAdapter.mustSendUser({ping:"pong",cf:"pongAck"},d.fromUser.userid),console.log(`PONG ACK TO ${d.fromUser.userid}`)):(console.log(`PONG BROADCAST from ${d.fromUser.userid}`),this.verifySession(d))},
pongAck(d){console.log(`PONG ACK FROM ${d.fromUser.userid}`)},sessionName(){let d=localStorage.getItem("mySession");null===d&&(d=this.setSession());return d},setSession(){const d=virtualclass.vutil.randomString(32);console.log("==== session, My session is created by setSession");virtualclass.config.setNewSession(d);return d},verifySession(d){const {session:c}=d.message,a=localStorage.getItem("mySession");null!=a?a!==c&&"t"===d.fromUser.role&&this.sessionDestroy(c,d):(console.log("==== session, start session"),
console.log("My session is created"),virtualclass.config.setNewSession(c))},sessionDestroy(d,c){virtualclass.isPlayMode?(console.log("==== session, end session"),console.log("My session is created"),virtualclass.config.setNewSession("thisismyplaymode")):(console.log("==== session, start session"),c=c.fromUser.userid,localStorage.removeItem("mySession"),virtualclass.config.endSession(),virtualclass.config.setNewSession(d),ioMissingPackets.validateAllVariables(c),console.log("REFRESH SESSION"))}};(function(d){d.virtualclass=function(){const c=""!=wbUser.virtualclassPlay?parseInt(wbUser.virtualclassPlay,10):0;let a=localStorage.getItem("studentSSstatus");a=null!=a?JSON.parse(localStorage.getItem("studentSSstatus")):{sharing:!1,mesharing:!1,shareToAll:!1};return{isPlayMode:c,apps:{wb:"Whiteboard",ss:"ScreenShare",yt:"Yts",er:"EditorRich",ec:"EditorCode",sp:"SharePresentation",poll:"Poll",vid:"Video",ds:"DocumentShare",quiz:"Quiz",mv:"MultiVideo"},appSessionEnd:"virtualclassSessionEnd",appAudioTest:"virtualclassAudioTest",
rWidgetConfig:{id:"virtualclassAppRightPanel"},wb:"",ss:"",wss:"",rw:"",poll:"",quiz:"",raiseHand:"",error:[],pdfRender:{},clearGlobalLock:"",queueCreatePrefetchLink:[],pqueueCreatePrefetchLink:[],countCreatePrefetchLink:0,gObj:{SCALE_FACTOR:1.02,next:{},uid:d.wbUser.id,uRole:d.wbUser.role,uName:d.wbUser.name,tempReplayObjs:{},commandToolsWrapperId:{},editorInitDone:0,resize:!1,has_ts_capability:!(1!=wbUser.ts&&1!=wbUser.ts),meetingMode:0,chromeExt:!1,pdfdebugg:!0,wbInitHandle:!1,wbCount:0,prvWindowSize:!1,
wIds:[0],wbRearrang:!1,currSlide:null!=localStorage.getItem("currSlide")?localStorage.getItem("currSlide"):0,currIndex:null!=localStorage.getItem("currIndex")?localStorage.getItem("currIndex"):1,uploadingFiles:[],docOrder:{},fetchedData:!1,wbNavtime:50,studentSSstatus:a,screenRh:60,isReadyForVideo:!0,defaultApp:"Whiteboard",tempQueue:{},chatIconColors:{},prevApp:null,myworker:null,requestToScriptNode:null,readyToCommunicate:!1,tempPrefix:"dest_temp/templates",allUserObj:{},docPdfFirstTime:!1,defalutStrk:"1",
defalutFont:"25",defalutFntOptn:"1",defaultcolor:"#0000ff",sendAudioStatus:!1,audioRecWorkerReady:!1,wbTool:{},fullScreenMode:!1,lastmousemovetime:null,CDTimer:null},enablePreCheck:!0,clearSession(){d.pageEnter=(new Date).getTime();"undefined"===typeof notSend&&virtualclass.vutil.beforeSend({sEnd:!0,cf:"sEnd"},null,!0);"object"===typeof virtualclass.videoUl&&"object"===typeof virtualclass.videoUl.player&&"undefined"!==typeof virtualclass.videoUl.player.dispose&&virtualclass.videoUl.player.dispose();
virtualclass.config.endSession();virtualclass.hasOwnProperty("prevScreen")&&virtualclass.prevScreen.hasOwnProperty("currentStream")&&virtualclass.prevScreen.unShareScreen();virtualclass.previrtualclass=`virtualclass${virtualclass.gObj.defaultApp}`},createPrefetchLink(b){if(b){for(let a=0;a<virtualclass.pqueueCreatePrefetchLink.length;a+=1)if(virtualclass.pqueueCreatePrefetchLink[a]===b)return;virtualclass.queueCreatePrefetchLink.push(b);virtualclass.pqueueCreatePrefetchLink.push(b)}if(0<virtualclass.queueCreatePrefetchLink.length){for(b=
0;b<virtualclass.queueCreatePrefetchLink.length;b+=1)if(20>virtualclass.countCreatePrefetchLink)virtualclass.createPrefetchLinkActual(virtualclass.queueCreatePrefetchLink.shift());else break;virtualclass.delaycreatePrefetchLink&&(clearTimeout(virtualclass.delaycreatePrefetchLink),virtualclass.delaycreatePrefetchLink=0);virtualclass.delaycreatePrefetchLink=setTimeout(()=>{document.getElementsByTagName("head")[0].appendChild(virtualclass.linkFragment);virtualclass.linkFragment=document.createDocumentFragment();
virtualclass.countCreatePrefetchLink=0;virtualclass.createPrefetchLink()},2E3)}},createPrefetchLinkActual(b){virtualclass.linkFragment||(virtualclass.linkFragment=document.createDocumentFragment());const a=document.createElement("link");a.setAttribute("rel","prefetch");a.setAttribute("crossOrigin","use-credentials");a.setAttribute("href",b);virtualclass.linkFragment.appendChild(a);virtualclass.countCreatePrefetchLink+=1},async init(b,a,c){b=document.getElementById("virtualclassCont");b.classList.add("loading");
const {wbUser:f}=d;virtualclass.uInfo={userid:f.id,sid:f.sid,rid:f.path,authuser:f.auth_user,authpass:f.auth_pass,userobj:{userid:f.id,name:f.name,lname:f.lname,img:f.imageurl,role:null!=localStorage.getItem("uRole")?localStorage.getItem("uRole"):f.role},room:f.room};this.gObj.congCourse=typeof("undefiend"!=d.congCourse)?d.congCourse:0;this.wbConfig={id:`virtualclass${virtualclass.apps.wb}`,classes:"appOptions"};this.ssConfig={id:`virtualclass${virtualclass.apps.ss}`,classes:"appOptions"};this.edConfig=
{id:`virtualclass${virtualclass.apps.er}`,classes:"appOptions"};this.edCodeConfig={id:`virtualclass${virtualclass.apps.ec}`,classes:"appOptions"};this.ptConfig={id:`virtualclass${virtualclass.apps.sp}`,classes:"appOptions"};this.plConfig={id:`virtualclass${virtualclass.apps.poll}`,classes:"appOptions"};this.viConfig={id:`virtualclass${virtualclass.apps.vid}`,classes:"appOptions"};this.dtsConfig={id:`virtualclass${virtualclass.apps.ds}`,classes:"appOptions"};this.qzConfig={id:`virtualclass${this.apps.quiz}`,
classes:"appOptions"};this.mvConfig={id:`virtualclass${this.apps.mv}`,classes:"appOptions"};this.sharePt=d.sharePt;this.fineUploader=d.fineUploader;this.converter=converter;this.clear="";this.currApp=this.vutil.capitalizeFirstLetter(a);this.dashBoard=dashBoard;this.multiVideo=d.MultiVideo;this.vutil.isChromeExtension();this.pageNavigation=d.pageIndexNav;this.modal=d.modal;this.zoom=d.zoomWhiteboard();virtualclass.pageIndexNav=d.pageIndexNav;"Quiz"!=this.currApp&&null!=virtualclass.gObj.CDTimer&&clearInterval(null!=
virtualclass.gObj.CDTimer);virtualclass.modernizr=Modernizr;this.system.webpInit();this.dirtyCorner=d.dirtyCorner;this.html.init(this);this.adapter=d.adapter;virtualclass.system.mybrowser.hasOwnProperty("name")||this.system.setBrowserDetails();virtualclass.api=api;virtualclass.vutil.initOnBeforeUnload(virtualclass.system.mybrowser.name);virtualclass.xhr=d.xhr;virtualclass.xhr.init();virtualclass.xhrn=d.xhrn;virtualclass.xhrn.init();virtualclass.xhrn.getAccess();virtualclass.vutil.isPlayMode()&&virtualclass.recorder.requestListOfFiles();
virtualclass.chat.init();virtualclass.dtCon=virtualclass.converter();virtualclass.pbar=progressBar;virtualclass.editorRich=d.editor("editorRich","virtualclassEditorRich","virtualclassEditorRichBody");virtualclass.editorCode=d.editor("editorCode","virtualclassEditorCode","virtualclassEditorCodeBody");virtualclass.poll=d.poll();virtualclass.quiz=d.quiz();virtualclass.videoUl=d.videoUl();virtualclass.videoHost=d.videoHost;virtualclass.precheck=preCheck;virtualclass.page=page;if(virtualclass.vutil.isSessionEnded())return!0;
console.log("==== session clear zoom object ready ");virtualclass.network=new Network;virtualclass.gesture=gesture;this.serverData=serverData;roles.hasControls()&&this.serverData.fetchAllData();null!=localStorage.uRole&&(virtualclass.gObj.uRole=localStorage.uRole,b.classList.add(virtualclass.vutil.getClassName(virtualclass.gObj.uRole)));"undefined"===typeof c||null==c?this.makeAppReady(a,"byclick"):this.makeAppReady(a,"byclick",c);this.system.check();this.vutil.isSystemCompatible();this.pageVisible=
virtualclass.vutil.pageVisible();a==virtualclass.apps.ss&&this.system.setAppDimension();virtualclass.vutil.createReclaimButtonIfNeed();virtualclass.user.assignRole(virtualclass.gObj.uRole,a);this.media=new d.media;a=localStorage.getItem("precheck");null!=a&&(a=JSON.parse(a));virtualclass.makePreCheckAvailable?virtualclass.precheck.init():(virtualclass.makeReadySocket(),virtualclass.isPlayMode||virtualclass.gesture.initClassJoin());b.classList.remove("loading");virtualclass.gObj.precheckScrn=!1;virtualclass.gObj.meetingMode||
virtualclass.videoHost.init(320,240);virtualclass.vutil.videoController();a=document.getElementById("precheckBtn");a.addEventListener("click",()=>{virtualclass.gObj.precheckScrn=!0;virtualclass.precheck.init(virtualclass.precheck)});this.raiseHand=d.raiseHand;this.raiseHand.init();this.appSetting=d.appSetting;this.appSetting.init();virtualclass.colorSelector=d.colorSelector;virtualclassSetting.theme.selectedColor&&this.colorSelector.makeThemeReady();a=document.getElementById("virtualclassCont");null!=
a&&a.classList.add(virtualclass.system.mybrowser.name);a=document.getElementById("fullScreenButton");null!=a&&a.addEventListener("click",virtualclass.vutil.Fullscreen);a=document.getElementById("fullScreenExitButton");null!=a&&a.addEventListener("click",virtualclass.vutil.closeFullscreen);document.onfullscreenchange=function(b){virtualclass.gObj.fullScreenMode?(document.querySelector("#fullScreenButton").style.display="block",document.querySelector("#fullScreenExitButton").style.display="none",virtualclass.gObj.fullScreenMode=
!1):(document.querySelector("#fullScreenButton").style.display="none",document.querySelector("#fullScreenExitButton").style.display="block",virtualclass.gObj.fullScreenMode=!0)}},makeReadySocket(){virtualclass.vutil.isPlayMode()||this.initSocketConn()},initSocketConn(){this.system.webSocket&&(io.init(virtualclass.uInfo),d.userdata=virtualclass.uInfo)},html:{id:"virtualclassCont",optionsClass:"appOptions",init(b){this.virtualclass=b},leftAppBar(){if(!(0<document.getElementsByClassName("appOptions").length)){document.querySelector("#virtualclassApp #virtualclassAppLeftPanel");
var b=virtualclass.getTemplate("appTools")();virtualclass.vutil.insertAppLayout(b);virtualclass.gObj.hasOwnProperty("errNotScreenShare")&&virtualclass.view.disableSSUI();virtualclass.gObj.hasOwnProperty("errAppBar")&&virtualclass.view.disableLeftAppBar()}},createDiv(b,a,c,d,m){const f=document.createElement("a");f.href="#";const g=document.createElement("div");g.id=b;"undefined "!==typeof d&&(g.className=d);d=document.createElement("span");d.className=`icon-${a}`;f.appendChild(d);f.dataset.title=
virtualclass.lang.getString(a);f.className="tooltip";"virtualclassWhiteboardTool"==b&&(f.dataset.doc=`${"_doc_0_"}${virtualclass.gObj.wbCount}`);g.appendChild(f);"undefined"!==typeof m?(m=document.getElementById("virtualclassScreenShareTool"),c.replaceChild(g,m)):c.appendChild(g)},createElement(b,a,c){b=document.createElement(b);"undefined"!==typeof a&&(b.id=a);if("undefined"!==typeof c&&1<c.length)for(a=0;a<c.length;a++)b.className+=`${c[a]} `;return b}},dispvirtualclassLayout(b){if("undefined"!==
typeof this.previous)if(this.previous.toUpperCase()!=`virtualclass${this.currApp}`.toUpperCase()){var a=document.getElementById(virtualclass.previous);null!=a&&(a.style.display="none");"undefined"!==typeof b?("EDITORRICH"==b.toUpperCase()?(a=document.getElementById("virtualclassEditorCode"),null!=a&&(a.style.display="none")):console.log(`EditorRich can not be display:none ${b}`),"EDITORCODE"==b.toUpperCase()?(a=document.getElementById("virtualclassEditorRich"),null!=a&&(a.style.display="none")):console.log(`EditorCode can not be display:none ${b}`)):
console.log(`appId ${b} undefined`)}else{a=document.getElementById("virtualclassCont").getElementsByClassName("virtualclass");for(let b=0;b<a.length;b++)a[b].style.display="none"}"undefined"!==typeof b&&(b=`virtualclass${b.charAt(0).toUpperCase()+b.slice(1)}`);a=document.getElementById(b);null!=a&&(a.style.display="block",console.log(`App ${b} block`))},async makeAppReady(b,a,c){virtualclass.dashBoard.close();console.log(`Application is ready${b}`);this.view=d.view;var f=virtualclass.vutil.capitalizeFirstLetter(b);
"ScreenShare"!=f&&(this.currApp=f);"DocumentShare"!=b&&(virtualclass.gObj.docPdfFirstTime=!1);console.log(`Current App init ${this.currApp}`);roles.hasControls()&&virtualclass.hasOwnProperty("previrtualclass")&&(b!=virtualclass.apps.ss||virtualclass.gObj.studentSSstatus.mesharing&&"ScreenShare"==virtualclass.apps.ss)&&virtualclass.vutil.makeActiveApp(`virtualclass${b}`,virtualclass.previrtualclass);"undefined"===typeof this.previous||"virtualclassEditorRich"!=this.previous&&"virtualclassEditorCode"!=
this.previous||(f=this.previous.split("virtualclass")[1],this.user.control.toggleDisplayEditorController(f,"none"));if(b!=virtualclass.apps.ss){this.dispvirtualclassLayout(b);f=document.getElementById("virtualclassCont");virtualclass.vutil.setCurrApp(f,this.currApp);var g=document.querySelector("#virtualclassApp");null!=g&&("DocumentShare"==this.currApp||"SharePresentation"==this.currApp||"Video"==this.currApp?virtualclass.vutil.setCurrApp(g,f.dataset.currapp):g.dataset.currapp="")}"undefined"!==
typeof this.prevScreen&&this.prevScreen.hasOwnProperty("currentStream")&&this.prevScreen.unShareScreen();if("SharePresentation"==b)`virtualclass${b}`!=virtualclass.previous&&this.appInitiator[b].apply(virtualclass,Array.prototype.slice.call(arguments));else if("DocumentShare"==b)this.appInitiator[b].apply(virtualclass,Array.prototype.slice.call(arguments)),roles.hasControls()&&(virtualclass.dts.firstRequest?virtualclass.vutil.triggerDashboard(b,"hidepopup"):virtualclass.vutil.triggerDashboard(b));
else if(f=localStorage.getItem("prevApp"),null!=f&&(g=JSON.parse(f),"SharePresentation"==g.name&&(g.name="",localStorage.setItem("prevApp",JSON.stringify(g)))),"Whiteboard"===b){var n=[];for(g=0;g<arguments.length;g++)n.push(arguments[g]);"undefined"===typeof a&&(n[1]=a);n[2]="undefined"!==typeof c?`_doc_${c}`:`_doc_0_${virtualclass.gObj.currSlide}`;n.push("virtualclassWhiteboard");this.appInitiator[b].apply(virtualclass,Array.prototype.slice.call(n));f=JSON.parse(f);virtualclass.gObj.wbRearrang||
null==f||null==localStorage.getItem("currSlide")||(n=localStorage.getItem("wIds"),null!==n&&(n=JSON.parse(n),0<n.length&&(virtualclass.wbCommon.readyElements(n),virtualclass.gObj.hasOwnProperty("currSlide")&&-1===n.indexOf(+virtualclass.gObj.currSlide)&&(console.log("wids, From virtualclass "),n.push(virtualclass.gObj.currSlide)),virtualclass.gObj.wbRearrang=!0,virtualclass.gObj.wIds=n)));virtualclass.wbCommon.initNav(virtualclass.gObj.wIds);virtualclass.gObj.wbRearrang&&roles.hasControls()&&(virtualclass.wbCommon.rearrange(virtualclass.wbCommon.order),
virtualclass.wbCommon.indexNav.addActiveNavigation(virtualclass.gObj.currWb));virtualclass.wbCommon.identifyFirstNote(virtualclass.gObj.currWb);virtualclass.wbCommon.identifyLastNote(virtualclass.gObj.currWb)}else f=Array.prototype.slice.call(arguments)[2],this.appInitiator[b].apply(virtualclass,Array.prototype.slice.call(arguments)),f&&f.init&&f.init.videoUrl&&f.fromReload&&(n=!0),roles.hasControls()&&"Video"==b&&(`virtualclass${b}`!=virtualclass.previous&&(f=document.querySelector("#dashboardnav button"),
null!=f&&(f.setAttribute("data-currapp","Video"),f.classList.contains("clicked")&&f.classList.remove("clicked"))),virtualclass.vutil.triggerDashboard(b,n));this.previrtualclass=this.previous;b!=virtualclass.apps.wb&&b!=virtualclass.apps.ss&&virtualclass.system.setAppDimension();if("Video"!=b&&virtualclass.hasOwnProperty("videoUl")){virtualclass.videoUl.videoId="";(n=document.getElementById("dispVideo_Youtube_api"))&&n.contentWindow&&n.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',
"*");if(n=document.querySelector(".congrea #dispVideo"))n.style.display="none",(n=document.querySelector(".congrea #dispVideo video"))&&n.setAttribute("src","");(n=document.querySelector("#listvideo .playing"))&&n.classList.remove("playing");(n=document.querySelector("#listvideo .removeCtr"))&&n.classList.remove("removeCtr");roles.hasControls()||(virtualclass.gObj.hasOwnProperty("videoPauseTime")&&clearTimeout(virtualclass.gObj.videoPauseTime),"object"===typeof virtualclass.videoUl.player&&null!=
virtualclass.videoUl.player.player_&&virtualclass.videoUl.player.paused()&&(console.log("==== Video is paused"),virtualclass.videoUl.player.pause()));"object"===typeof virtualclass.videoUl.player&&delete virtualclass.videoUl.player}roles.hasControls()&&(f=Array.prototype.slice.call(arguments)[2],"ScreenShare"==b||"SharePresentation"!=virtualclass.currApp&&"Video"!=virtualclass.currApp?"DocumentShare"!=virtualclass.currApp&&"SharePresentation"!=virtualclass.currApp&&virtualclass.vutil.removeDashboardNav():
(virtualclass.vutil.initDashboardNav(f),"Video"==virtualclass.currApp?console.log(`currApp ${virtualclass.currApp}`):virtualclass.sharePt.localStoragFlag||(f=document.querySelector("#dashboardnav button"),null!=f&&f.click())),"SharePresentation"!=virtualclass.currApp&&(n=document.querySelector("#listppt .playing"))&&n.classList.remove("playing"))},appInitiator:{async Whiteboard(b,a,c,k){"object"===typeof this.ss&&(this.ss.prevStream=!1);"undefined"!==typeof this.previous&&"undefined"!==typeof a&&
"byclick"==a&&roles.hasControls()&&"Whiteboard"==virtualclass.currApp&&(a=c.split("_doc_")[1],virtualclass.vutil.beforeSend({dispWhiteboard:!0,cf:"dispWhiteboard",d:a}));virtualclass.gObj.currWb=c;"object"!==typeof this.pdfRender[c]?this.pdfRender[c]=d.pdfRender():("Whiteboard"==virtualclass.currApp||"DocumentShare"==virtualclass.currApp)&&virtualclass.zoom.adjustScreenOnDifferentPdfWidth();roles.isStudent()&&"Whiteboard"==virtualclass.currApp&&virtualclass.wbCommon.setCurrSlideNumber(c);if("undefined"!==
typeof c){if("object"!==typeof this.wb[c])if("object"!==typeof this.wb&&(this.wb={}),virtualclass.gObj.commandToolsWrapperId[c]=`commandToolsWrapper${c}`,this.wb[c]={},virtualclass.gObj.tempReplayObjs[c]=[],this.wb[c]=new d.whiteboard(this.wbConfig,c),null!=this.gObj.tempQueue[c]&&(this.wb[c].gObj.queue=this.gObj.tempQueue[c].slice(),this.gObj.tempQueue[c]=null),"Whiteboard"==virtualclass.currApp?(a=document.querySelector("#virtualclassWhiteboard .whiteboardContainer"),virtualclass.gObj.wbInitHandle||
(virtualclass.wbCommon.initNavHandler(),virtualclass.gObj.wbInitHandle=!0)):a=document.getElementById(`cont${c}`),null!=a){if(null==document.querySelector(`vcanvas${c}`)){k=virtualclass.getTemplate("main","whiteboard");if("Whiteboard"==virtualclass.currApp){virtualclass.wbCommon.hideElement();const b=`note${c}`;var f=document.querySelector(`#${b}`);null!=f?(f.classList.add("canvasContainer","current"),k=k({cn:c,hasControl:roles.hasControls()}),f.innerHTML=k):(k=`<div id='${b}' data-wb-id='${c}' class='canvasContainer current'>${k({cn:c,
hasControl:roles.hasControls()})}</div>`,"_doc_0_0"!=c?a.insertAdjacentHTML("beforeend",k):(a.innerHTML=k,f=document.querySelector("#note_doc_0_0"),null!=f&&f.classList.add("current")))}else k=k({cn:c,hasControl:roles.hasControls()}),a.innerHTML=k;f=document.querySelector(`#canvas${c}`)}this.wb[c].utility=new d.utility;this.wb[c].alreadyReplay=!1;this.wb[c].packContainer=new d.packContainer;this.wb[c].draw_object=d.draw_object;this.wb[c].makeobj=d.makeobj;this.wb[c].readyFreeHandObj=d.readyFreeHandObj;
this.wb[c]._replay=_replay;this.wb[c].readyTextObj=d.readyTextObj;this.wb[c].bridge=d.bridge;this.wb[c].response=d.response;virtualclass.wb[c].utility.displayCanvas(c);({vcan:a}=virtualclass.wb[c]);roles.hasControls()&&(virtualclass.wb[c].utility.setOrginalTeacherContent(b),virtualclass.wb[c].attachToolFunction(virtualclass.gObj.commandToolsWrapperId[c],!0,c),b=a.utility.canvasCalcOffset(a.main.canid),console.log(`whietboard offset x=${b.x} `+` y=${b.y}`));"DocumentShare"==virtualclass.currApp?({currNote:b}=
virtualclass.dts.docs.note,virtualclass.pdfRender[c].init(f,b)):virtualclass.pdfRender[c].init(f);await virtualclass.storage.getWbData(c)}else alert("whiteboard container is null");else b=`commandToolsWrapper${c}`,null==document.getElementById(`commandToolsWrapper${c}`)&&roles.hasControls()&&virtualclass.wb[c].attachToolFunction(b,!0,c);({vcan:a}=virtualclass.wb[c]);null!=document.getElementById(`canvas${c}`)&&(a.utility.canvasCalcOffset(a.main.canid),0!==this.gObj.tempReplayObjs[c].length&&"nodata"!==
this.gObj.tempReplayObjs[c]||virtualclass.wb[c].utility.makeCanvasEnable());console.log(`==== previous set ${this.wbConfig.id}`);this.previous=this.wbConfig.id}else alert("id is undefined");console.log("==== SESSION CLEAR");virtualclass.zoom.init();b=localStorage.getItem("activeTool");null!=b&&(f=document.querySelector(`#${b}`),null!=f&&(f.classList.add("active"),virtualclass.wb[c].prvTool=b));roles.hasControls()&&d.addEventListener("mouseup",b=>{var a=document.querySelector("#virtualclassCont").dataset.currapp;
if(null!=a&&("Whiteboard"==a||"DocumentShare"==a))if(b.target.dataset.hasOwnProperty("stroke")||b.target.dataset.hasOwnProperty("font"))b=b.target.dataset.hasOwnProperty("stroke")?document.querySelector(`#t_strk${virtualclass.gObj.currWb} .strkSizeList`):document.querySelector(`#t_font${virtualclass.gObj.currWb} .fontSizeList`),virtualclass.wb[virtualclass.gObj.currWb].closeElem(b);else if(b.target.classList.contains("icon-color")||b.target.classList.contains("selected")||b.target.classList.contains("congtooltip"))virtualclass.wb[virtualclass.gObj.currWb].closeElem(document.querySelector(`#shapes${virtualclass.gObj.currWb}`));
else if(b.target.classList.contains("icon-rectangle")||b.target.classList.contains("icon-line")||b.target.classList.contains("icon-oval")||b.target.classList.contains("icon-triangle"))virtualclass.wb[virtualclass.gObj.currWb].closeElem(document.querySelector(`#shapes${virtualclass.gObj.currWb}`));else{a=document.querySelector(`#t_strk${virtualclass.gObj.currWb} .strkSizeList`);const c=document.querySelector(`#t_font${virtualclass.gObj.currWb} .fontSizeList`),f=document.querySelector(`#colorList${virtualclass.gObj.currWb}`);
null!=a&&a.classList.contains("open")&&!document.querySelector("#virtualclassApp").classList.contains("dashboard")?virtualclass.wb[virtualclass.gObj.currWb].closeElem(a):null!=c&&c.classList.contains("open")&&!document.querySelector("#virtualclassApp").classList.contains("dashboard")?virtualclass.wb[virtualclass.gObj.currWb].closeElem(c):null!=f&&f.classList.contains("open")&&!document.querySelector("#virtualclassApp").classList.contains("dashboard")&&virtualclass.wb[virtualclass.gObj.currWb].closeElem(f);
b.target.classList.contains("icon-shapes")||document.querySelector("#virtualclassApp").classList.contains("dashboard")||(b=document.querySelector(`#shapes${virtualclass.gObj.currWb}`),null!=b&&b.classList.contains("open")&&virtualclass.wb[virtualclass.gObj.currWb].closeElem(b))}});"undefined"===typeof virtualclass.wb.indexNav&&(virtualclass.wb.indexNav=new virtualclass.pageIndexNav("WB"))},ScreenShare(b){"object"!==typeof this.ss&&(this.ss=new d.screenShare(virtualclass.ssConfig));this.ss.init({type:"ss",
app:b})},Yts(b,a,c){"undefined"!==typeof c&&null!=c?virtualclass.yts.init(c,c.startFrom):null==document.querySelector("iframe#player")&&virtualclass.yts.init();this.previous=virtualclass.ytsConfig.id},EditorRich(b){this.appInitiator.editor.call(virtualclass,b)},EditorCode(b){this.appInitiator.editor.call(virtualclass,b)},SharePresentation(b,a){"object"===typeof this.ss&&(this.ss.prevStream=!1);this.sharePt=new d.sharePt;console.log(virtualclass.sharePt.pptUrl);this.sharePt.init(b,a);console.log(virtualclass.sharePt.pptUrl);
this.previous=virtualclass.ptConfig.id;virtualclass.sharePt.attachMessageEvent("message",virtualclass.sharePt.pptMessageEventHandler)},Poll(b){virtualclass.poll.init()},Quiz(b){virtualclass.quiz.init()},Video(b,a,c){"undefined"!==typeof c&&null!=c?"undefined"===typeof c.type?virtualclass.videoUl.init(c,c.startFrom):virtualclass.videoUl.init():virtualclass.videoUl.init()},editor(b){this.user.control.toggleDisplayEditorController(b.substring(b.indexOf("virtualclass"),b.length),"block");var a=[];b==
virtualclass.apps.er?(virtualclass.editorRich.init(0,a,"",""),this.previous=virtualclass.edConfig.id):(virtualclass.editorCode.init(0,a,"",""),this.previous=virtualclass.edCodeConfig.id);a=JSON.parse(localStorage.getItem(virtualclass.vutil.smallizeFirstLetter(b)));const c=virtualclass.vutil.smallizeFirstLetter(b);roles.hasAdmin()||(null==a?(this[c].cm.setOption("readOnly","nocursor"),this.user.control.toggleDisplayWriteModeMsgBox(b,!1),console.log(`message box is created ${b}`)):(this.user.control.toggleDisplayWriteModeMsgBox(b,
a),a?this[c].cm.setOption("readOnly",!1):this[c].cm.setOption("readOnly","nocursor")),virtualclass.vutil.setReadModeWhenTeacherIsDisConn(c))},makeReadyDsShare(b,a,c){virtualclass.dts.docs.hasOwnProperty("currDoc")?(roles.hasControls()&&(ioAdapter.mustSend({dts:{init:"studentlayout"},cf:"dts"}),console.log("doc share current"),virtualclass.dts.sendCurrentDoc(),virtualclass.dts.sendCurrentSlide()),b=virtualclass.dts.docs.currNote,"undefined"!==typeof b&&virtualclass.vutil.updateCurrentDoc(b)):"undefined"!==
typeof c?setTimeout(()=>{virtualclass.dts.init(c)},1E3):virtualclass.dts.init();virtualclass.previous=virtualclass.dtsConfig.id;console.log(`==== previous ${virtualclass.previous}`)},DocumentShare(b,a,c){virtualclass.hasOwnProperty("dts")&&null!=virtualclass.dts?(virtualclass.dts.firstRequest=!1,virtualclass.dts.indexNav.init()):virtualclass.dts=d.documentShare();const f=[];"undefined"!==typeof b&&f.push(b);"undefined"!==typeof a&&f.push(a);"undefined"!==typeof c&&f.push(c);"undefined"===typeof virtualclass.dts.indexNav&&
(virtualclass.dts.indexNav=new virtualclass.pageIndexNav("documentShare"));virtualclass.gObj.hasOwnProperty("docs")&&(virtualclass.appInitiator.makeReadyDsShare.apply(virtualclass.appInitiator,f),virtualclass.vutil.initDashboardNav(),virtualclass.dts.firstRequest||virtualclass.dts.noteExist()?(console.log("===== DOCUMENT EXIST"),virtualclass.zoom.adjustScreenOnDifferentPdfWidth()):(b=document.querySelector("#dashboardnav button"),null!=b&&b.click()),null!=virtualclass.gObj.currWb&&"undefined"!==typeof virtualclass.pdfRender[virtualclass.gObj.currWb]&&
"DocumentShare"==virtualclass.currApp&&virtualclass.pdfRender[virtualclass.gObj.currWb].hasOwnProperty("page")&&null!=virtualclass.pdfRender[virtualclass.gObj.currWb].page&&virtualclass.dts.order&&("undefined"===typeof virtualclass.dts.indexNav&&(virtualclass.dts.indexNav=new virtualclass.pageIndexNav("documentShare")),roles.hasControls()?virtualclass.dts.indexNav.createIndex():virtualclass.dts.indexNav.studentDocNavigation(virtualclass.dts.docs.currNote)));(b=document.querySelector("#virtualclassAppLeftPanel .zoomControler .reloadNote span"))&&
b.setAttribute("data-title",virtualclass.lang.getString("reloadDoc"))},MultiVideo(){const b=this;b.multiVideo.hasOwnProperty("initDone")?b.multiVideo._init():setTimeout(()=>{b.appInitiator.MultiVideo.apply(virtualclass)},2E3);this.previous=virtualclass.mvConfig.id}},attachFunction(){const b=document.getElementsByClassName("appOptions");for(let c=0;c<b.length;c++){const f=b[c].getElementsByTagName("a")[0];if("virtualclassEditorCodeTool"!=b[c].id){var a=this;f.onclick=function(){a.initlizer(this)}}}},
initlizer(b){b=b.parentNode.id.split("virtualclass")[1];"SessionEndTool"===b?virtualclass.popup.confirmInput(virtualclass.lang.getString("startnewsession"),b=>{b?(virtualclass.gObj.endSession=!0,virtualclass.gObj.hasOwnProperty("beTeacher")&&roles.isTeacher()&&localStorage.setItem("uRole","t"),localStorage.clear(),(new Promise((b,a)=>{virtualclass.gObj.sessionEndResolve=b;virtualclass.clearSession()})).then(()=>{delete virtualclass.gObj.sessionEndResolve;virtualclass.popup.sesseionEndWindow()},b=>
{console.log(`ERRROR ${b}`)})):console.log("Not start new session")}):(b=b.substring(0,b.indexOf("Tool")),this.PrvAndCurrIsWss(this.previous,b)?alert(virtualclass.lang.getString("screensharealready")):("DocumentShare"==virtualclass.currApp&&(virtualclass.gObj.screenRh=160),this.makeAppReady(b,"byclick"),setTimeout(()=>{virtualclass.gObj.screenRh=60},1500)));"ScreenShare"!=b&&virtualclass.vutil.removeClass("audioWidget","fixed")},PrvAndCurrIsWss(b,a){return!("virtualclassWholeScreenShare"!=b||a!=virtualclass.apps.yt)},
setPrvUser(){const b={id:wbUser.id,room:wbUser.room,role:wbUser.role,settings:virtualclassSetting.settings};console.log("previosu user");localStorage.setItem("prvUser",JSON.stringify(b))},registerPartial(){const b={whiteboardPath},a="precheck teacherVideo audioWidget appTools popupCont appToolsMeeting appSettingDetail joinclass".split(" "),c={hasControl:roles.hasControls()};let d;for(let f=0;f<a.length;f++){d=null;if("precheck"==a[f]||"popupCont"==a[f])d=b;else if("audioWidget"==a[f])d=virtualclassSetting,
d.isControl=roles.hasControls(),d.isMettingMode=virtualclass.gObj.meetingMode&&roles.isStudent();else if("teacherVideo"==a[f]||"appTools"==a[f]||"appSettingDetail"==a[f])d=c;this.makeReadyTemplate(a[f],d)}Handlebars.registerPartial({docNotesMain:this.getTemplate("notesMain","documentSharing"),whiteboardToolbar:this.getTemplate("toolbar","whiteboard"),rightBar:this.getTemplate("rightBar"),recordingControl:this.getTemplate("recordingControl"),leftBar:this.getTemplate("leftBar"),main:this.getTemplate("main"),
whiteboard:this.getTemplate("main","whiteboard"),dashboardCont:this.getTemplate("dashboardCont"),multiVideo:this.getTemplate("multiVideo")})},registerHelper(){Handlebars.registerHelper("getString",b=>virtualclass.lang.getString(b));Handlebars.registerHelper("debug",function(b){console.log("Current Context");console.log("====================");console.log(this);b&&(console.log("Value"),console.log("===================="),console.log(b))});Handlebars.registerHelper("getVideoType",b=>virtualclass.gObj.meetingMode?
"multiVideo":"teacherVideo")},createMainContainer(){const b=document.querySelector(`#${virtualclass.html.id}`);this.registerHelper();this.registerPartial();var a=this.getTemplate("main");const c={isPlay:virtualclass.isPlayMode,hasControls:roles.hasControls(),meetingMode:virtualclass.gObj.meetingMode};a=a(c);b.insertAdjacentHTML("afterbegin",a)},makeReadyTemplate(b,a){Handlebars.registerPartial(b,(0,JST[`${virtualclass.gObj.tempPrefix}/${b}.hbs`])(a))},getTemplate(b,a){return"undefined"===typeof a?
JST[`${virtualclass.gObj.tempPrefix}/${b}.hbs`]:JST[`${virtualclass.gObj.tempPrefix}/${a}/${b}.hbs`]},isMiniFileIncluded(b){b=new RegExp(`${b}.js?=\*([0-9]*)`);const a=document.getElementsByTagName("script");for(let c=0;c<a.length;c++)if(b.test(a[c].src))return!0;return!1},removeSharingClass(){const b=document.querySelector("#virtualclassCont");""!=b&&(b.classList.remove("studentScreenSharing"),document.querySelector("#chat_div").classList.remove("studentScreenSharing"))},clearAllChat(){localStorage.removeItem(virtualclass.gObj.uid);
localStorage.clear("chatroom");null!=virtualclass.chat&&(virtualclass.chat.idList.length=0);clearAllChatBox();const b=document.getElementById("chatWidget").getElementsByClassName("ui-chatbox-msg");if(0<b.length)for(;null!=b[0];)b[0].parentNode.removeChild(b[0])}}}})(window);(function(d,c){d.Vcan=function(){var a={create(b){if("#"==b.charAt(0)){const c=b.substring(1,b.length);a.utility.canvasCalcOffset(c);return new a.main(b)}console.log("there is a problem with canvas id");console.log("there is a problem with canvas id")},main:function(b){a.main.children=[];a.main.id=0;a.main.uid=0;a.main.canvas=c.querySelector(b);a.main.canid=b.substring(1,b.length);a.main.currentTransform="";a.main.replayObjs=[];a.main.dragMode=!1;a.main.scaleMode=!1;a.main.usrCurrAction="";a.main.currObj=
"";a.main.textObj=!1;a.main.action="create";a.wb={};a.wb.sentPack=!1;a.activMouse=new a.mouse;a.activMouse.init()},extend(b,a){if("object"===typeof b&&"object"===typeof a){for(const c in a)b[c]=a[c];return b}console.log("it seems that the arguments you passed are not object")},transform(b,a,c){b.translate(a.x,a.y);b.rotate(a.theta);c||b.scale(a.scaleX*(a.flipX?-1:1),a.scaleY*(a.flipY?-1:1))},getStates(b){return a.main[b]},setValInMain(b,c){return a.main[b]=c},ArrayIndexOf(b,a){if(!a||"function"!==
typeof a||!b||!b.length||1>b.length)return-1;for(let c=0;c<b.length;c++)if(a(b[c]))return c;return-1},renderAll(b){"object"!==typeof b&&(b=a.main.canvas.getContext("2d"));a.clearContext(b);this.displayPdfWhiteboard()},normalDisplay(b){console.log(`Whiteboard index ${b}`);"freeDrawing"==a.main.children[b].type?a.fhdRender(ctx,a.main.children[b]):a.render(ctx,a.main.children[b])},displayPdfWhiteboard(){const {length:b}=a.main.children;if(b){const c=a.main.canvas.getContext("2d");for(let f=0;f<b;++f)"pdf"==
a.main.children[f].type?console.log("Pdf, Render the data, that should not be a"):"freeDrawing"==a.main.children[f].type?a.fhdRender(c,a.main.children[f]):a.render(c,a.main.children[f])}},clearContext(b){const c=a.main.canvas;b.clearRect(0,0,c.width,c.height);return c},deactivateAll(){const b=a.main.children;let c=0;const g=b.length;for(;c<g;c++)b[c].setActive(!1)},makeDispObject:function(b){return{coreObj:b,bind(b,a){this.addEventListener(`on${b}`,a)}}},remove:function(b){var c=a.main.canvas,g=a.ArrayIndexOf(a.main.children,
a=>a.id==b.id&&(a.mt==b.mt||1==b.multiuser));0<=g&&a.main.children.splice(g,1);({height:g}=c);const {width:d}=c;c=c.getContext("2d");c.beginPath();c.clearRect(0,0,d,g);c.closePath();a.renderAll()},render:function(b,c,g,d){b.beginPath();b.save();b.lineWidth=void 0!==b.lineWidth?c.lineWidth:2;g||a.transform(b,c,d);b.strokeStyle=void 0!=c.borderColor?c.borderColor:"#000000";"rectangle"==c.type?a.objRect.draw(b,c,g):"line"==c.type?a.objLine.draw(b,c,g):"oval"==c.type?a.objOval.draw(b,c,g):"triangle"==
c.type?a.objTri.draw(b,c,g):"text"==c.type&&a.objTxt.draw(b,c,g);c.active&&!g&&(c.drawBorders(b),c.hideCorners||c.drawCorners(b));b.closePath();b.restore()},fhdRender:function(b,c,g){b.save();var f=c.transformMatrix;f&&b.transform(f[0],f[1],f[2],f[3],f[4],f[5]);g||a.transform(b,c);c.overlayFill?b.fillStyle=c.overlayFill:c.fill&&(b.fillStyle=c.fill);c.stroke&&(b.strokeStyle=c.stroke);b.beginPath();{const a=-(c.width/2),g=-(c.height/2);for(let k=0,m=c.path.length;k<m;++k){var d=c.path[k];switch(d[0]){case "L":f=
d[1];d=d[2];b.lineTo(f+a,d+g);break;case "M":f=d[1],d=d[2],b.moveTo(f+a,d+g)}}}c.fill&&b.fill();c.stroke&&(b.strokeStyle=c.stroke,b.lineWidth=c.strokeWidth,b.lineCap=b.lineJoin="round",b.stroke());!g&&c.active&&(c.drawBorders(b),c.hideCorners||c.drawCorners(b));b.restore()},makeStackObj:function(b,a,c,d){return{mt:b,ac:a,x:c,y:d}}};return a}})(window,document);(function(d,c){d.whiteboard=function(a,b){console.log("Whiteboard new one");const f=a.hasOwnProperty("id")?a.id:"appWhitebaordCont";a=a.hasOwnProperty("class");"object"!==typeof virtualclass.wb[b].vcan&&(virtualclass.wb[b].vcan=new d.Vcan,d.vcanUtility(b),d.vcanMain(b),d.Events(b),d.Virtualbox(b),d.Interact(b),d.Rectangle(b),d.Oval(b),d.Triangle(b),d.Text(b),d.Line(b),d.FreeHandDrawing(b),d.Path(b),d.Mouse(b),d.Optimize(b));return{id:f,classes:a,tool:"",obj:{},prvObj:"",replayTime:0,uid:0,lt:"",view:{},
lang:{},system:{},user:{},gObj:{myrepObj:[],replayObjs:[],myArr:[],displayedObjId:0,packQueue:[],queue:[],virtualWindow:!1},vcan:virtualclass.wb[b].vcan,init(b){var {vcan:a}=virtualclass.wb[b];virtualclass.wb[b].canvas=a.create(`#canvas${b}`);a=a.main.canvas;a.className+=" whiteboards";a.setAttribute("tabindex","0");const f=c.createElement("canvas");f.id=`canvas${b}_pdf`;f.className="pdfs";f.width=a.width;f.height=a.height;virtualclass.vutil.insertAfter(f,a);d.onkeydown=virtualclass.wb[b].utility.keyOperation;
virtualclass.system.setAppDimension(b);"undefined"!==typeof Storage&&(d.virtualclass.wb[b]=virtualclass.wb[b]);this.arrowInit();this._init(b)},_init(b){virtualclass.wb[b].oTeacher=roles.hasAdmin();virtualclass.vutil.chkValueInLocalStorage("rcvdPackId")?virtualclass.wb[b].gObj.rcvdPackId=parseInt(localStorage.rcvdPackId):virtualclass.wb[b].gObj.rcvdPackId=0;d.addEventListener("click",()=>{virtualclass.view.disappearBox("WebRtc");virtualclass.view.disappearBox("Canvas");virtualclass.view.disappearBox("drawArea")});
virtualclass.wb[b].utility.crateCanvasDrawMesssage(b)},UI:{mainContainer(b,a){b=c.querySelector(`#${b}`);if(null!=b){const f=c.createElement("div");f.id=`vcanvas${a}`;f.className="vcanvas";f.dataset.wbId=a;const g=c.createElement("div");g.id=`containerWb${a}`;g.className="containerWb";f.appendChild(g);b.appendChild(f)}else alert("container is null")}},arrowInit(){this.arrImg=new Image;this.arrImg.src="https://cdn.congrea.net/resources/images/arrow.png";this.arrImgDraw=!1;const b=this;this.arrImg.onload=
function(){b.arrImgDraw=!0}},createCommand(b,a){if((b=virtualclass.wb[a].utility.alreadyExistToolBar(a))||null!=localStorage.getItem("educator"))return!0;b=virtualclass.getTemplate("toolbar","whiteboard")({cn:a});a=c.getElementById(`containerWb${a}`);null!=a&&a.insertAdjacentHTML("afterbegin",b)},createCommandWrapper(){const b=c.createElement("div");b.id=virtualclass.gObj.commandToolsWrapperId;const a=c.getElementById(vcan.canvasWrapperId);null!=a?c.getElementById("containerWb").insertBefore(b,a):
c.getElementById("containerWb").appendChild(b);return b},createCanvas(b){({vcan:b}=virtualclass.wb[b]);b.canvasWrapperId=cmdToolsWrapper.id},initActiveElement(b,a){b=c.querySelector(b);"undefined"===typeof virtualclass.gObj.wbTool[virtualclass.gObj.currWb]&&(virtualclass.gObj.wbTool[virtualclass.gObj.currWb]={});"undefined"===typeof virtualclass.gObj.wbTool[virtualclass.gObj.currWb][a.type]&&(b.addEventListener("click",this.activeElementHandler.bind(this,a)),virtualclass.gObj.wbTool[virtualclass.gObj.currWb][a.type]=
!0)},activeElementHandler(b,a){this.activeElement(a,b)},activeElement(b,a){var f=c.querySelector(`#t_${a.type}${virtualclass.gObj.currWb} .selected`);null!=f&&f.classList.remove("selected");f=b.target.dataset[a.prop];null!=f&&(b.target.classList.add("selected"),virtualclass.wb[virtualclass.gObj.currWb].changeToolProperty(a.type,f))},objInit(b){const a=virtualclass.vutil.getWhiteboardId(this.parentNode);if(b.target.classList.contains("icon-shapes")||b.target.parentNode.classList.contains("shapes_icon")){var f=
c.querySelector(`#shapes${a}`);f.classList.contains("open")?(f.classList.remove("open"),f.classList.add("close")):(f.classList.contains("close")&&f.classList.remove("close"),f.classList.add("open"),virtualclass.wb[a].closeElem(c.querySelector(`#t_strk${a} .strkSizeList`)),virtualclass.wb[a].closeElem(c.querySelector(`#t_font${a} .fontSizeList`)))}else if(this.parentNode.id==`t_color${a}`)virtualclass.wb[a].closeElem(c.querySelector(`#shapes${virtualclass.gObj.currWb}`)),virtualclass.wb[a].closeElem(c.querySelector(`#t_strk${a} .strkSizeList`)),
virtualclass.wb[a].closeElem(c.querySelector(`#t_font${a} .fontSizeList`)),virtualclass.wb[a].toggleDisplay(this.parentNode.id,a),virtualclass.wb[a].initActiveElement(`#colorList${a}`,{type:"color",prop:"color"});else if(this.parentNode.id==`t_strk${a}`)virtualclass.wb[a].closeElem(c.querySelector(`#shapes${virtualclass.gObj.currWb}`)),virtualclass.wb[a].toggleDisplay(this.parentNode.id,a),virtualclass.wb[a].initActiveElement(`#t_strk${a} ul`,{type:"strk",prop:"stroke"});else if(this.parentNode.id==
`t_font${a}`)virtualclass.wb[a].closeElem(c.querySelector(`#shapes${virtualclass.gObj.currWb}`)),virtualclass.wb[a].toggleDisplay(this.parentNode.id,a),virtualclass.wb[a].initActiveElement(`#t_font${a} ul`,{type:"font",prop:"font"});else{"undefined"!==typeof virtualclass.wb[virtualclass.gObj.currWb]&&""!=virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj&&"undefined"!==typeof virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj&&0>this.parentNode.id.indexOf("t_text")&&0<c.querySelectorAll(".canvasWrapper .textBoxContainer").length&&
virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.finalizeTextIfAny();({vcan:b}=virtualclass.wb[a]);roles.hasControls()&&this.parentNode.id!=`t_clearall${a}`&&virtualclass.wb[a].utility.makeActiveTool(this.parentNode.id);this.parentNode.id==`t_replay${a}`?(virtualclass.wb[a].utility.clearAll(!1),virtualclass.vutil.beforeSend({replayAll:!0,cf:replayAll})):virtualclass.wb[a].toolInit(this.parentNode.id,a);if(this.parentNode.id==`t_rectangle${a}`||this.parentNode.id==`t_line${a}`||this.parentNode.id==
`t_oval${a}`||this.parentNode.id==`t_triangle${a}`){const b=this.parentNode.id.slice(2,this.parentNode.id.split(/_doc_*/)[0].length);c.querySelector(`#tool_wrapper${a}`).dataset.currtool=this.parentNode.dataset.tool;c.querySelector(`#shapeIcon${a} a`).dataset.title=b.charAt(0).toUpperCase()+b.slice(1)}else c.querySelector(`#tool_wrapper${a}`).dataset.currtool="shapes",c.querySelector(`#shapeIcon${a} a`).dataset.title="Shapes",virtualclass.wb[a].closeElem(c.querySelector(`#shapes${virtualclass.gObj.currWb}`)),
virtualclass.wb[a].closeElem(c.querySelector(`#t_strk${virtualclass.gObj.currWb} .strkSizeList`)),virtualclass.wb[a].closeElem(c.querySelector(`#t_font${virtualclass.gObj.currWb} .fontSizeList`)),virtualclass.wb[a].closeElem(c.querySelector(`#colorList${virtualclass.gObj.currWb}`));this.parentNode.id!=`t_replay${a}`&&this.parentNode.id!=`t_clearall${a}`&&this.parentNode.id!=`t_reclaim${a}`&&this.parentNode.id!=`t_assign${a}`&&(f=(new Date).getTime(),virtualclass.wb[a].lt=this.parentNode.id,f={cmd:this.parentNode.id.split(/_doc_*/)[0],
mt:f},virtualclass.wb[a].uid++,f.uid=virtualclass.wb[a].uid,b.main.replayObjs.push(f),virtualclass.storage.store(JSON.stringify(b.main.replayObjs)),virtualclass.vutil.beforeSend({repObj:[f],cf:"repObj"}));this.parentNode.id!=`t_clearall${a}`&&(virtualclass.wb[a].prvTool=this.parentNode.id,virtualclass.wb[a].prvToolInfo=f);f=c.querySelector(`#t_font${a}`);b=c.querySelector(`#t_strk${a}`);this.parentNode.id==`t_text${a}`?(f.classList.contains("hide")&&(f.classList.remove("hide"),f.classList.add("show")),
b.classList.add("hide")):(b.classList.contains("hide")&&(b.classList.remove("hide"),b.classList.add("show")),f.classList.add("hide"))}},toggleDisplay(b,a){const f=c.querySelector(`#colorList${a}`);if(b==`t_color${a}`)f.classList.contains("open")?(f.classList.remove("open"),f.classList.add("close")):(f.classList.contains("close")&&f.classList.remove("close"),f.classList.add("open"));else if(b==`t_strk${a}`||b==`t_font${a}`)virtualclass.wb[a].closeElem(f),b=b==`t_strk${a}`?c.querySelector(`#${b} .strkSizeList`):
c.querySelector(`#${b} .fontSizeList`),b.classList.contains("open")?(b.classList.remove("open"),b.classList.add("close")):(b.classList.contains("close")&&b.classList.remove("close"),b.classList.add("open"))},changeToolProperty(b,a){const f=(new Date).getTime();if("color"==b){var g=c.querySelector(`#colorList${virtualclass.gObj.currWb} .selected`).id;virtualclass.wb[virtualclass.gObj.currWb].activeToolColor=a;c.querySelector(`#t_color${virtualclass.gObj.currWb} .disActiveColor`).style.backgroundColor=
virtualclass.wb[virtualclass.gObj.currWb].activeToolColor;g={color:a,elem:g,mt:f}}else"strk"==b?(g=c.querySelector(`#t_strk${virtualclass.gObj.currWb} .selected`).id,virtualclass.wb[virtualclass.gObj.currWb].currStrkSize=a,g={strkSize:a,elem:g,mt:f}):"font"==b&&(g=c.querySelector(`#t_font${virtualclass.gObj.currWb} .selected`).id,virtualclass.wb[virtualclass.gObj.currWb].textFontSize=a,g={fontSize:a,elem:g,mt:f});({vcan:a}=virtualclass.wb[virtualclass.gObj.currWb]);virtualclass.wb[virtualclass.gObj.currWb].uid++;
g.uid=virtualclass.wb[virtualclass.gObj.currWb].uid;a.main.replayObjs.push(g);virtualclass.storage.store(JSON.stringify(a.main.replayObjs));virtualclass.vutil.beforeSend({repObj:[g],cf:"repObj"})},closeElem(b){b.classList.contains("open")&&(b.classList.remove("open"),b.classList.add("close"))},attachToolFunction(b,a,f){virtualclass.wb[f].createCommand(a,f);b=c.getElementById(b).getElementsByTagName("div");for(a=0;a<b.length;a++)b[a].getElementsByTagName("a")[0].addEventListener("click",virtualclass.wb[f].objInit)},
toolInit(b,a,f,d){const g=virtualclass.gObj.currWb;-1>=b.indexOf("_doc_")&&(b+=g);const {vcan:k}=virtualclass.wb[g];"object"===typeof virtualclass.wb[g].obj.drawTextObj&&1==virtualclass.wb[g].obj.drawTextObj.wmode&&k.main.canvas.getContext("2d");0<k.getStates("children").length?b!=`t_clearall${g}`&&("undefined"!==typeof f&&b==`t_replay${g}`||virtualclass.wb[g].utility.deActiveFrmDragDrop(),1!=f&&"t_replay"!=b&&k.renderAll()):k.main.action="create";virtualclass.wb[g].utility.IsObjEmpty(virtualclass.wb[g].obj.freeDrawObj&&
0==f)||(virtualclass.wb[g].obj.freeDrawObj.freesvg=!1);k.main.currUserCommand=`${b}Init`;if(b==`t_activeall${g}`)console.log("command active"),virtualclass.wb[g].utility.t_activeallInit();else if(b==`t_replay${g}`)"undefined"===typeof f&&k.setValInMain("id",0),"undefined"!==typeof d?virtualclass.wb[g].t_replayInit(a,d):virtualclass.wb[g].t_replayInit(a);else if(b==`t_clearall${g}`){if("Whiteboard"==virtualclass.currApp)var m=virtualclass.lang.getString("clearAllWarnMessageW");else"DocumentShare"==
virtualclass.currApp&&(m=virtualclass.lang.getString("clearAllWarnMessageD"));virtualclass.popup.confirmInput(m,a=>{if(!a)return!0;console.log(`Whiteboard clear init ${g}`);virtualclass.wb[g].utility.t_clearallInit();virtualclass.wb[g].utility.makeDefaultValue(b);virtualclass.storage.wbDataRemove(g);virtualclass.vutil.beforeSend({clearAll:!0,cf:"clearAll"});delete virtualclass.gObj.wbTool[virtualclass.gObj.currWb];roles.hasControls()&&(virtualclass.wb[g].currStrkSize=virtualclass.gObj.defalutStrk,
virtualclass.wb[g].textFontSize=virtualclass.gObj.defalutFont,virtualclass.wb[g].activeToolColor=virtualclass.gObj.defaultcolor,c.querySelector(`#t_color${g} .disActiveColor`).style.backgroundColor=virtualclass.wb[g].activeToolColor,a=c.querySelector(`#tool_wrapper${g}`).dataset.currtool,"triangle"!=a&&"line"!=a&&"oval"!=a&&"rectangle"!=a||delete c.querySelector(`#tool_wrapper${g}`).dataset.currtool,c.querySelector(`#shapeIcon${g} a`),a=c.querySelector(`#t_strk${g}`),null!=a&&a.classList.remove("show"),
a=c.querySelector(`#t_font${g}`),null!=a&&a.classList.remove("show"),a=c.querySelector(`#colorList${virtualclass.gObj.currWb} .selected`),null!=a&&a.classList.remove("selected"),a=c.querySelector(`#t_strk${virtualclass.gObj.currWb} .selected`),null!=a&&(a.classList.remove("selected"),c.querySelector(`.strkSizeList #strk-1${g}`).classList.add("selected")),a=c.querySelector(`#t_font${virtualclass.gObj.currWb} .selected`),null!=a&&(a.classList.remove("selected"),c.querySelector(`.fontSizeList #font-1${g}`).classList.add("selected")),
c.querySelector(`#tool_wrapper${virtualclass.gObj.currWb}.shapesToolbox`).classList.remove("active"),localStorage.removeItem("activeTool"))})}else b==`t_assign${g}`?(a=localStorage.getItem("toolHeight"),null!=a?virtualclass.vutil.beforeSend({assignRole:!0,toolHeight:a,socket:virtualclass.wb[g].socketOn}):virtualclass.vutil.beforeSend({assignRole:!0,socket:virtualclass.wb[g].socketOn,cf:"assignRole"})):"t_reclaim"==b&&virtualclass.wb[g].utility._reclaimRole();b!=`t_replay${g}`&&b!=`t_clearallInit${g}`&&
b!=`t_assign${g}`&&b!=`t_reclaim${g}`&&(virtualclass.wb[g].tool=new virtualclass.wb[g].tool_obj(b),virtualclass.wb[g].utility.attachEventHandlers(g))},tool_obj:function(b){if(-1<b.indexOf("_doc_")){var a=c.querySelector(`#${b}`);a=null==a?virtualclass.gObj.currWb:virtualclass.vutil.getWhiteboardId(a)}else a=virtualclass.gObj.currWb,b+=a;this.cmd=b;b!=`t_freeDrawing${a}`&&(virtualclass.wb[a].obj.freeDrawObj="");b==`t_text${a}`||virtualclass.vutil.exitTextWrapper()||(virtualclass.wb[a].obj.drawTextObj=
"");b==`t_freeDrawing${a}`?(virtualclass.wb[a].obj.freeDrawObj=new virtualclass.wb[a].readyFreeHandObj("#424240","3"),virtualclass.wb[a].obj.freeDrawObj.init()):b==`t_text${a}`&&(virtualclass.wb[a].obj.drawTextObj=new virtualclass.wb[a].readyTextObj,virtualclass.wb[a].obj.drawTextObj.init(`canvasWrapper${a}`));b=b.slice(2,b.length);-1<b.indexOf("_doc_")&&(b=b.substring(0,b.indexOf("_")));virtualclass.wb[a].draw_object(b,virtualclass.wb[a].canvas,this)},t_replayInit(b,a){const c=virtualclass.gObj.currWb;
"fromFile"==b?(virtualclass.gObj.chat.removeAllChat(),virtualclass.wb[c].recordAudio=!0,virtualclass.recorder.init()):(virtualclass.wb[c].replay=virtualclass.wb[c]._replay(),"undefined"!==typeof a?(virtualclass.wb[c].replay.init(b,a),virtualclass.wb[c].replay.renderObj(a)):(virtualclass.wb[c].replay.init(b),virtualclass.wb[c].replay.renderObj()))}}}})(window,document);(function(d){d.utility=function(){return{userIds:[],isObjExistRE(c){var a=virtualclass.gObj.currWb;if(0<=virtualclass.wb[a].replay.removeElements.length&&(a=virtualclass.wb[a].vcan.ArrayIndexOf(virtualclass.wb[a].replay.removeElements,b=>b.id==c.id),0<=a))return a},IsObjEmpty(c){for(const a in c)if(c.hasOwnProperty(a))return!1;return!0},stringToNumber(c){" "==c[c.length-1]&&(c=c.substring(0,c.length-1));return c=Number(c)},clickOutSidebox(c){return 1!=c%2},keyOperation(c){var a=virtualclass.gObj.currWb;
8==c.keyCode||46==c.keyCode?({vcan:c}=virtualclass.wb[a],""!=c.main.currObj&&roles.hasControls()&&(console.log("Delete whiteboard obj:- Invoke the command"),a=virtualclass.wb[a].utility.removeSelectedItem(c.main.currObj),virtualclass.vutil.beforeSend({repObj:[a],cf:"repObj"}))):27==c.keyCode&&("Whiteborad"!=virtualclass.currApp&&"DocumentShare"!=virtualclass.currApp||"object"!==typeof virtualclass.wb[a]||virtualclass.wb[a].obj.drawTextObj.finalizeTextIfAny())},removeSelectedItem(c,a,b){const f=virtualclass.gObj.currWb,
{vcan:g}=virtualclass.wb[f];virtualclass.wb[f].canvas.removeObject(g.main.currObj);c={mt:(new Date).getTime(),ac:"del"};"undefined"===typeof a&&virtualclass.wb[f].uid++;c.uid=virtualclass.wb[f].uid;roles.hasControls()?"undefined"===typeof b&&(console.log(`Delete:- Saving the delete command with id ${c.uid}`),g.main.replayObjs.push(c),virtualclass.storage.store(JSON.stringify(g.main.replayObjs))):virtualclass.storage.store(JSON.stringify(virtualclass.wb[f].gObj.replayObjs));g.main.currObj="";console.log("Delete:- Removing the whitboard object");
return c},attachEventHandlers(c){virtualclass.wb[c].canvas.bind("mousedown",virtualclass.wb[c].utility.ev_canvas);virtualclass.wb[c].canvas.bind("mousemove",virtualclass.wb[c].utility.ev_canvas);virtualclass.wb[c].canvas.bind("mouseup",virtualclass.wb[c].utility.ev_canvas);virtualclass.wb[c].canvas.bind("touchstart",virtualclass.wb[c].utility.ev_canvas);virtualclass.wb[c].canvas.bind("touchmove",virtualclass.wb[c].utility.ev_canvas);virtualclass.wb[c].canvas.bind("touchend",virtualclass.wb[c].utility.ev_canvas)},
t_clearallInit(){virtualclass.wb[virtualclass.gObj.currWb].currStrkSize=virtualclass.gObj.defalutStrk;virtualclass.wb[virtualclass.gObj.currWb].textFontSize=virtualclass.gObj.defalutFont;virtualclass.wb[virtualclass.gObj.currWb].activeToolColor=virtualclass.gObj.defaultcolor;virtualclass.wb[virtualclass.gObj.currWb].utility.clearAll(!0)},clearAll(c,a){a=virtualclass.gObj.currWb;console.log(`Whiteboard clear ${a}`);virtualclass.wb[a].uid=0;virtualclass.wb[a].lt="";const {vcan:b}=virtualclass.wb[virtualclass.gObj.currWb];
for(;0<b.main.children.length;)virtualclass.wb[a].canvas.removeObject(b.main.children[0]);1==c&&b.main.replayObjs.splice(0,b.main.replayObjs.length);void 0!=virtualclass.wb[a].replay&&(virtualclass.wb[a].replay.objNo=0);"move"==b.getStates("action")&&b.setValInMain("action","create");c=document.getElementById("sendPackCont");if(null!=c&&(c=c.getElementsByClassName("numbers"),0<c.length))for(a=0;a<c.length;a++)c[a].innerHTML=0;c=document.getElementById("serverErrorCont");null!=c&&(c.parentNode.removeChild(c),
console.log("Some ERROR removed."));virtualclass.vutil.removeAllTextWrapper();virtualclass.wb[virtualclass.gObj.currWb].currStrkSize=virtualclass.gObj.defalutStrk;virtualclass.wb[virtualclass.gObj.currWb].textFontSize=virtualclass.gObj.defalutFont;virtualclass.wb[virtualclass.gObj.currWb].activeToolColor=virtualclass.gObj.defaultcolor},deActiveFrmDragDrop(){var {vcan:c}=virtualclass.wb[virtualclass.gObj.currWb];const a=c.main.children;if("move"==c.getStates("action")){c.setValInMain("action","create");
for(c=0;c<a.length;c++)a[c].dragDrop(!1),a[c].setActive(!1);return!0}return!1},getOffset(c){let a=c.target,b=y=0;for(;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)b+=a.offsetLeft-a.scrollLeft,y+=a.offsetTop-a.scrollTop,a=a.offsetParent;b=c.clientX-b;y=c.clientY-y;return{x:b,y}},ev_canvas(c){var a=virtualclass.gObj.currWb;const b=virtualclass.wb[a].vcan.utility.getReltivePoint(c);c.currX=b.x;c.currY=b.y;if(a=virtualclass.wb[a].tool[c.type])return a(c),this.ev_canvas},t_activeallInit(){var {vcan:c}=
virtualclass.wb[virtualclass.gObj.currWb];const a=c.getStates("children");if(1<=a.length)for(c.setValInMain("action","move"),c=0;c<a.length;c++)a[c].dragDrop(!0)},drawArrowImg(c,a){const {vcan:b}=virtualclass.wb[virtualclass.gObj.currWb],f=b.main.canvas.getContext("2d");f.clearRect(0,0,b.main.canvas.width,b.main.canvas.height);b.renderAll();f.save();f.beginPath();f.translate(a.mp.x,a.mp.y);f.drawImage(c,-3,-3,18,24);f.closePath();f.restore()},assignRole(c){const a=virtualclass.gObj.currWb;virtualclass.wb[a].tool=
"";"move"==vcan.main.action&&virtualclass.wb[a].utility.deActiveFrmDragDrop();if("undefined"!==typeof c)roles.isEducator()&&(c=document.getElementById(virtualclass.gObj.commandToolsWrapperId),c.parentNode.removeChild(c)),virtualclass.gObj.uRole="p",localStorage.setItem("uRole",virtualclass.gObj.uRole),virtualclass.user.assignRole(virtualclass.gObj.uRole,virtualclass.currApp),vcan.utility.canvasCalcOffset(vcan.main.canid),"Yts"==virtualclass.currApp&&(virtualclass.yts.UI.inputURL(),virtualclass.yts.seekChangeInterval());
else{"Yts"==virtualclass.currApp&&(virtualclass.yts.UI.removeinputURL(),virtualclass.yts.hasOwnProperty("tsc")&&clearInterval(virtualclass.yts.tsc));virtualclass.gObj.uRole="s";c=document.getElementById(virtualclass.gObj.commandToolsWrapperId);if(null!=c)for(;c.hasChildNodes();)c.removeChild(c.lastChild);virtualclass.wb[a].utility.makeCanvasDisable();roles.hasAdmin()?(virtualclass.vutil.createReclaimButton(c),virtualclassCont=document.getElementById("virtualclassCont"),virtualclassCont.className+=
" educator"):null!=c&&c.parentNode.removeChild(c);localStorage.setItem("uRole",virtualclass.gObj.uRole);virtualclass.wb[a].utility.uniqueArrOfObjsToStudent()}},reclaimRole(){const c=virtualclass.gObj.currWb;virtualclass.gObj.controlAssign=!1;virtualclass.wb[c].response.assignRole(virtualclass.gObj.uid,virtualclass.gObj.uid,!0)},dispQueuePacket(c){c=virtualclass.gObj.currWb;(roles.hasControls()||roles.isEducator())&&virtualclass.wb[c].utility.toolWrapperEnable();virtualclass.wb[c].drawMode=!1;roles.hasControls()&&
(virtualclass.wb[c].utility.makeCanvasEnable(),virtualclass.wb[c].utility.enableAppsBar())},makeCanvasDisable(){const {vcan:c}=virtualclass.wb[virtualclass.gObj.currWb];c.main.canvas.style.pointerEvents="none"},makeCanvasEnable(){const c=virtualclass.gObj.currWb,{vcan:a}=virtualclass.wb[c];!roles.hasControls()||virtualclass.wb[c].hasOwnProperty("canvasDisable")&&virtualclass.wb[c].canvasDisable||(a.main.canvas.style.pointerEvents="visible")},removeToolBox(c){c=document.getElementById(`commandToolsWrapper${c}`);
c.parentNode.removeChild(c)},createReclaimButton(c){const a=virtualclass.gObj.currWb;virtualclass.vutil.createDiv("t_reclaim","reclaim",c);document.getElementById("t_reclaim").getElementsByTagName("a")[0].addEventListener("click",virtualclass.wb[a].objInit)},chkValueInLocalStorage(c){return null===localStorage.getItem(c)?!1:localStorage[c]},uniqueArrOfObjsToStudent(){const c=virtualclass.gObj.currWb,{vcan:a}=virtualclass.wb[c];let b;virtualclass.wb[c].gObj.replayObjs=[];for(let f=0;f<a.main.replayObjs.length;f++)b=
a.extend({},a.main.replayObjs[f]),virtualclass.wb[c].gObj.replayObjs.push(b)},uniqueArrOfObjsToTeacher(){const c=virtualclass.gObj.currWb,{vcan:a}=virtualclass.wb[c];a.main.replayObjs=[];let b;for(let f=0;f<virtualclass.wb[c].gObj.replayObjs.length;f++)b=a.extend({},virtualclass.wb[c].gObj.replayObjs[f]),a.main.replayObjs.push(b)},makeDefaultValue(c){const a=virtualclass.gObj.currWb;"undefined"!==typeof c&&"t_clearall"==c||virtualclass.wb[a].utility.makeDeActiveTool();virtualclass.wb[a].gObj.myrepObj=
[];virtualclass.wb[a].gObj.replayObjs=[];virtualclass.wb[a].gObj.rcvdPackId=0;virtualclass.wb[a].gObj.displayedObjId=0;virtualclass.wb[a].gObj.packQueue=[];virtualclass.wb[a].gObj.queue=[];virtualclass.wb[a].uid=0;localStorage.setItem("rcvdPackId",0);virtualclass.vutil.chkValueInLocalStorage("wbrtcMsg");virtualclass.vutil.chkValueInLocalStorage("canvasDrwMsg");virtualclass.vutil.chkValueInLocalStorage("toolHeight");JSON.parse(virtualclass.vutil.chkValueInLocalStorage("prvUser"));JSON.parse(virtualclass.vutil.chkValueInLocalStorage("tc"));
virtualclass.media.audio.bufferSize=0;virtualclass.media.audio.encMode="alaw";virtualclass.media.audio.rec="";virtualclass.media.audio.audioNodes=[];({vcan:c}=virtualclass.wb[a]);"undefined"!==typeof c.objTxt&&c.objTxt.removeTextNode();"undefined"!==typeof c.main.currentTransform&&(c.main.currentTransform="");virtualclass.media.audio.updateInfo()},clearCurrentTool(){const c=virtualclass.gObj.currWb;virtualclass.wb[c].hasOwnProperty("tool")&&(virtualclass.wb[c].tool="")},setOrginalTeacherContent(){localStorage.setItem("canvasDrwMsg",
!0)},checkWebRtcConnected(){return"undefined"===typeof cthis||!cthis.pc[0].hasOwnProperty("iceConnectionState")&&"undefined"===typeof cthis.pc[0].iceConnectionState?!1:!0},createVirtualWindow(c){var a=virtualclass.gObj.currWb;virtualclass.wb[a].gObj.virtualWindow=!0;const b=document.createElement("div");virtualclass.wb[a].utility.removeVirtualWindow("virtualWindow");b.setAttribute("id","virtualWindow");b.style.width=`${c.width}px`;"undefined"!==typeof assignRoleAtStudent?a=0:(a=parseInt(localStorage.getItem("toolHeight")),
a=null!=a?a:0);roles.hasAdmin()?b.style.height=`${c.height+a}px`:roles.hasControls()?b.style.height=`${c.height}px`:b.style.height=`${c.height-a}px`;c=document.getElementById("containerWb");c.insertBefore(b,c.firstChild)},removeVirtualWindow(c){const a=virtualclass.gObj.currWb;c=document.getElementById(c);null!=c&&(virtualclass.wb[a].gObj.virtualWindow=!1,c.parentNode.removeChild(c))},getWideValueAppliedByCss(c,a){c=document.getElementById(c);if(null!=c){a=d.getComputedStyle(c);if("undefined"!==typeof a.marginTop){var b=
parseInt(a.marginTop.match(/\d+/));null==b&&(b=0)}return c.clientHeight+b}return!1},isNumber(c){return isNaN(+c)?!1:+c},setCommandToolHeights(c,a){const b=document.getElementById("virtualWindow");if(null!=b){const f=parseInt(b.style.height.match(/\d+/));b.style.height="decrement"==a?`${f-parseInt(c)}px`:`${f+parseInt(c)}px`}},setClass(c,a){c=document.getElementById(c);const b=c.classList;var f="";0<b.length&&(f=2>f.length?`${b[0]} `:`${b.join(" ")} `);c.setAttribute("class",f+a)},setStyleUserConnetion(c,
a,b){c=document.getElementsByClassName(c)[0];null!=c&&c.setAttribute("class",`${a} controlCmd`)},existUserLikeMe(c){if(c.fromUser.userid!=wbUser.id){if(c.message.checkUser.hasOwnProperty("role")){const {role:b}=c.message.checkUser;if(b){if(null==localStorage.getItem("otherRole")){var a=[];if(b!=virtualclass.gObj.uRole)a.push(b);else return existUser=!0}else a=JSON.parse(localStorage.getItem("otherRole")),-1==a.indexOf(b)&&a.push(b);"undefined"!==typeof a&&(localStorage.setItem("otherRole",JSON.stringify(a)),
console.log(`Other Browser ${b} ${c.fromUser.userid}`))}return virtualclass.gObj.uRole==b}}else{if("undefined"!==typeof existUser)return!0;c=JSON.parse(localStorage.getItem("otherRole"));if(null!=c){for(a=0;a<c.length;a++)if(virtualclass.gObj.uRole==c[a])return!0;return!1}}},existUserWithSameId(c){const a=virtualclass.gObj.currWb;this.userIds.push(c.fromUser.userid);if(1<this.userIds.length&&virtualclass.wb[a].utility.arrayContainsSameValue(this.userIds[0],this.userIds))return!0},makeUserAvailable(){const c=
virtualclass.gObj.currWb;null==localStorage.getItem("repObjs")&&(virtualclass.wb[c].utility.toolWrapperEnable(),null!=vcan.main.canvas&&virtualclass.wb[c].utility.makeCanvasEnable())},displayCanvas(c){const {vcan:a}=virtualclass.wb[c];a.canvasWrapperId=`canvasWrapper${c}`;null==document.getElementById(`canvas${c}`)&&virtualclass.wb[c].createCanvas(c);d.virtualclass.wb[c].init(c);virtualclass.wb[c].utility.makeCanvasDisable();virtualclass.wb[c].utility.toolWrapperDisable();roles.hasControls()||roles.hasAdmin();
roles.hasControls()||"Whiteboard"!=virtualclass.currApp||"undefined"!==typeof virtualclass.wbCommon.indexNav&&virtualclass.wbCommon.indexNav.studentWBPagination(virtualclass.gObj.currSlide)},removeWhiteboardMessage(){const c=document.getElementById("whiteBoardMsg");null!=c&&c.parentNode.removeChild(c)},createWhiteboardMessage(){if(null==document.getElementById("whiteBoardMsg")){const c=document.createElement("div");c.id="whiteBoardMsg";c.innerHTML=virtualclass.lang.getString("msgForWhiteboard");const a=
document.getElementById(`canvasWrapper${virtualclass.gObj.currWb}`);null!=a&&a.appendChild(c)}},initAll(c){c=virtualclass.gObj.currWb;roles.hasControls()&&virtualclass.wb[c].utility.makeCanvasDisable();virtualclass.system.measureResoultion({width:d.outerWidth,height:d.innerHeight})},alreadyExistToolBar(c){c=document.getElementById(`t_rectangle${c}`);return null!=c?4<=c.parentNode.getElementsByClassName("tool").length:!1},toolWrapperDisable(c){var a=document.getElementById("commandToolsWrapper");if(null!=
a)if("undefined"!==typeof c)for(c=a.getElementsByTagName("a"),a=0;a<c.length;a++)c[a].style.pointerEvents="none";else a=document.getElementById("commandToolsWrapper"),null!=a&&(a.style.pointerEvents="none")},toolWrapperEnable(c){var a=document.getElementById("commandToolsWrapper");if(null!=a)if("undefined"!==typeof c)for(c=a.getElementsByTagName("a"),a=0;a<c.length;a++)c[a].style.pointerEvents="visible";else null==a||virtualclass.gObj.hasOwnProperty("errNotDesktop")||(a.style.pointerEvents="visible")},
replayFromLocalStroage(c){console.log("PDF, Whiteboard is intializing");const a=virtualclass.gObj.currWb;"undefined"!==typeof Storage&&(virtualclass.wb[a].utility.clearAll(!1,"dontClear"),virtualclass.wb[a].gObj.tempRepObjs=c,0<c.length&&(virtualclass.wb[a].utility.makeCanvasDisable(),virtualclass.wb[a].utility.toolWrapperDisable(),virtualclass.wb[a].gObj.displayedObjId=0,virtualclass.wb[a].utility.replayObjsByFilter(c,"fromBrowser")))},setUserStatus(c,a){const b=virtualclass.gObj.currWb;c||a?virtualclass.wb[b].utility.setClass("vcanvas",
"teacher"):(virtualclass.wb[b].utility.removeToolBox(b),virtualclass.wb[b].utility.setClass("vcanvas","student"))},crateCanvasDrawMesssage(c){roles.hasControls()&&null==localStorage.getItem("canvasDrwMsg")&&(localStorage.canvasDrwMsg=!0)},arrayContainsSameValue(c,a){for(let b=0;b<a.length;b++)if(a[b]!==c)return!1;return!0},actionAfterRemovedUser(){const c=virtualclass.gObj.currWb;virtualclass.wb[c].utility.makeCanvasDisable();virtualclass.wb[c].utility.setStyleUserConnetion("con","coff");virtualclass.wb[c].utility.removeVirtualWindow("virtualWindow");
virtualclass.wb[c].user.connected=!1;wb[c];localStorage.removeItem("otherRole");"undefined"!==typeof cthis&&(tempIsInitiaor=!0,cthis.isStarted&&cthis.handleRemoteHangup())},sendRequest(){virtualclass.vutil.beforeSend({reclaimRole:!0,cf:"reclaimRole"})},updateSentInformation(c,a){if(roles.hasAdmin()){c=JSON.parse(c);a="undefined"!==typeof a?c:c.repObj[0];c="";for(const b in a)c+=`${b} : ${a[b]} <br />`;null!=document.getElementById("sentMsgInfo")&&(document.getElementById("sentMsgInfo").innerHTML=
c)}},beforeSend(c,a){const b=virtualclass.gObj.currWb;if(c.hasOwnProperty("createArrow")){var f=JSON.stringify(c);virtualclass.wb[b].vcan.optimize.sendPacketWithOptimization(f,300)}else{if(c.hasOwnProperty("repObj")){if("undefined"===typeof c.repObj[c.repObj.length-1])return;virtualclass.wb[b].gObj.rcvdPackId=c.repObj[c.repObj.length-1].uid;virtualclass.wb[b].gObj.displayedObjId=virtualclass.wb[b].gObj.rcvdPackId}f=JSON.stringify(c);io.webSocketConnected()&&("undefined"===typeof a?ioAdapter.mustSend(c):
ioAdapter.mustSendUser(c,a));JSON.parse(f).hasOwnProperty("repObj")&&virtualclass.wb[b].utility.updateSentInformation(f)}},checkCanvasHasParents(){let c=document.getElementById("vcanvas");for(;"BODY"!=c.parentNode.tagName;)"vcanvas"!=c.id&&(c.style.margin="0",c.style.padding="0"),c=c.parentNode;"vcanvas"!=c.id&&(c.style.margin="0",c.style.padding="0")},lockvirtualclass(){var c=virtualclass.gObj.currWb;d.earlierWidth!=d.innerWidth&&(virtualclass.wb[c].canvasDisable=!0,virtualclass.wb[c].utility.makeCanvasDisable(),
virtualclass.wb[c].utility.toolWrapperDisable(),virtualclass.vutil.disableAppsBar(),null==document.getElementById("divForReloadMsg")&&(c=roles.hasControls()?"msgForReload":"msgStudentForReload",d.virtualclass.view.displayMsgBox("divForReloadMsg",c),d.earlierWidth=d.innerWidth))},getElementRightOffSet(c){var a=20;null!=c.parentNode&&(c=c.parentNode,a=vcan.utility.getElementOffset(c),a=d.innerWidth-(c.clientWidth+(a.x-0)));return a},objPutInContainer(c){vcan.main.replayObjs.push(c);virtualclass.storage.store(JSON.stringify(vcan.main.replayObjs))},
makeActiveTool(c){const a=virtualclass.gObj.currWb,b=document.getElementById(c);let f;virtualclass.wb[a].hasOwnProperty("prvTool")&&virtualclass.wb[a].prvTool!=`t_reclaim${a}`?(f=virtualclass.vutil.removeClassFromElement(virtualclass.wb[a].prvTool,"active"),document.getElementById(virtualclass.wb[a].prvTool).className=f):f=b.className;virtualclass.wb[a].utility.themeColorShapes(c);b.className=`${f} active`;localStorage.activeTool=b.id},themeColorShapes(c){c=c.split(/_doc_*/)[0];const a=document.querySelector(`#tool_wrapper${virtualclass.gObj.currWb}.shapesToolbox`);
"t_line"==c||"t_oval"==c||"t_rectangle"==c||"t_triangle"==c?a.classList.add("active"):a.classList.remove("active")},makeDeActiveTool(){virtualclass.wb[virtualclass.gObj.currWb].tool="";document.getElementById("commandToolsWrapper");const c=document.getElementsByClassName("tool active");0<c.length&&c[0].classList.remove("active")},createAudioTransmitIcon(c){const a=document.cteateElement("div");a.id=`audioTransmit${uuserId}`;a.className="audioTransmit";document.getElementById(`${c}ControlContainer`)},
_reclaimRole(){const c=virtualclass.gObj.currWb;virtualclass.wb[c].utility.reclaimRole();virtualclass.wb[c].utility.sendRequest();virtualclass.user.control.changeAttrToAssign("enable")},enableAppsBar(){const c=document.getElementById("virtualclassOptionsCont");null!=c&&(c.style.pointerEvents="visible")},replayObjsByFilter(c,a){const b=virtualclass.gObj.currWb;for(let f=0;f<c.length;f++){virtualclass.wb[b].bridge.makeQueue(c[f]);if(c[f].hasOwnProperty("cmd")){if(roles.hasControls()){const a=c[f].cmd.slice(2,
c[f].cmd.length),d=document.querySelector(`${"#tool_wrapper"}${b}`),m=document.querySelector(`#tool_wrapper${virtualclass.gObj.currWb}.shapesToolbox`);"triangle"==a||"line"==a||"oval"==a||"rectangle"==a?(document.querySelector(`#shapeIcon${b} a`).dataset.title=a.charAt(0).toUpperCase()+a.slice(1),d.dataset.currtool=a,m.classList.add("active")):(document.querySelector(`#shapeIcon${b} a`).dataset.title="Shapes",d.dataset.currtool="shapes",m.classList.remove("active"))}}else c[f].hasOwnProperty("color")?
(virtualclass.wb[b].activeToolColor=c[f].color,roles.hasControls()&&(document.querySelector(`#t_color${b} .disActiveColor`).style.backgroundColor=virtualclass.wb[b].activeToolColor,virtualclass.wb[b].utility.selectElem(`#colorList${b}`,c[f].elem))):c[f].hasOwnProperty("strkSize")?(virtualclass.wb[b].currStrkSize=c[f].strkSize,roles.hasControls()&&(document.querySelector(`#t_strk${b} ul`).dataset.stroke=virtualclass.wb[b].currStrkSize,virtualclass.wb[b].utility.selectElem(`#t_strk${b}`,c[f].elem))):
c[f].hasOwnProperty("fontSize")&&(virtualclass.wb[b].textFontSize=c[f].fontSize,roles.hasControls()&&(document.querySelector(`#t_font${b} ul`).dataset.font=virtualclass.wb[b].textFontSize,virtualclass.wb[b].utility.selectElem(`#t_font${b}`,c[f].elem)));c[f].uid==virtualclass.wb[b].gObj.displayedObjId+1&&(virtualclass.wb[b].uid=c[f].uid,this.executeWhiteboardData(c[f]),"undefined"!==typeof a&&(virtualclass.wb[b].gObj.rcvdPackId=virtualclass.wb[b].uid))}0<virtualclass.wb[b].gObj.replayObjs.length&&
virtualclass.storage.store(JSON.stringify(virtualclass.wb[b].gObj.replayObjs));roles.hasControls()&&(c=document.querySelector(`#t_font${b}`),a=document.querySelector(`#t_strk${b}`),virtualclass.wb[b].tool.cmd==`t_text${b}`?(c.classList.contains("hide")&&(c.classList.remove("hide"),c.classList.add("show")),a.classList.add("hide")):c.classList.contains("hide")||c.classList.add("hide"))},selectElem(c,a){const b=document.querySelector(`${c} .selected`);null!=b&&b.classList.remove("selected");c=document.querySelector(`${c} #${a}`);
null!=c&&c.classList.add("selected")},executeWhiteboardData(c){const a=virtualclass.gObj.currWb;virtualclass.wb[a].gObj.replayObjs.push(c);virtualclass.wb[a].response.replayObj([c]);this.checkNextQueue(c)},checkNextQueue(c){(c=this.findPacketInQueue(c))&&this.executeWhiteboardData(c)},findPacketInQueue(c){const a=virtualclass.gObj.currWb;c.hasOwnProperty("color")?virtualclass.wb[a].activeToolColor=c.color:c.hasOwnProperty("strkSize")?virtualclass.wb[a].currStrkSize=c.strkSize:c.hasOwnProperty("fontSize")&&
(virtualclass.wb[a].textFontSize=c.fontSize);return virtualclass.wb[a].gObj.queue.hasOwnProperty(c.uid+1)?virtualclass.wb[a].gObj.queue[c.uid+1]:!1},putScrollWithCevent(c){return c=this.scaleCordinate(c)},scaleCordinate(c){c.detail.cevent.x*=virtualclass.zoom.canvasScale;c.detail.cevent.y*=virtualclass.zoom.canvasScale;return c},scaleMoveCordinate(c){c.x=ev.detail.cevent.x/virtualclass.zoom.canvasScale;c.y=ev.detail.cevent.y/virtualclass.zoom.canvasScale;return c}}}})(window);(function(d){d.message={ActiveAll:"Active all",Addoption:"Add option",addnew:"Add new",adminusr:"Admin user",appPrerequites:"Validate app prerequisites",assign:"Assign",assignDisable:"Reclaim controls",askplayMessage:'<span id="askplaymsg"> Should we start playing the session?</span><br /><span id="remaingmsg">Remaining data will be downloaded in the background.</span>',askplaymsg:'<span id="askplaymsg"> "Downloading in progress, click Play to begin </span>"',audioInput:"Audio input",audiolatency:"Audio latency",
audioOutput:"Audio output",audioDisable:"Unmute",audioEnable:"Mute",audioTest:"Your voice will be recorded and played back to you. \n Press Ok and speak something for few seconds.",Back:"Back",bandfast:"Bandwidth is high",bandmedium:"Bandwidth is medium",bandslow:"Bandwidth is low",becomeTeacher:"Become teacher",Binary_Limit_Exeed:"Warning: High BN usage",bulkUserActions:"Bulk user actions",ByInstructor:"By instructor",ByTimer:"By timer",cancel:"Cancel",canvasDrawMsg:"You can click on any tool for drawingclick and hold the left mouse button to draw",
canvasmissing:"Canvas is missing in your browser. Please update your browser to the latest version.",chatEnable:"Disable chat",Chatroom:"Chatroom",ClearAll:"Clear all",clickheretoplay:"Click Here To Play",clicktoplay:"Play",chatDisable:"Enable chat",chFireBrowsersIssue:"Your browser {virtualclass1} {virtualclass2} needs updation, Congrea support Chrome 40+ and Firefox 35+.",clearAllWarnMessageW:"Do you really want to clear this whiteboard?",clearAllWarnMessageD:"Do you really want to clear this drawings?",
closedsDbheading:"Close document dashboard",closeSharePresentationdbHeading:"Close presentation dashboard",closevideoDashboard:"Close video dashboard",closeVoting:"Close voting",cnmissing:"Chunk number is missing",CodeEditor:"Code editor",cof:"Connection off",collaborate:"Collaborate",commonChat:"Common chat",commonBrowserIssue:"Your browser {virtualclass1} {virtualclass2} is not supported, Congrea support Chrome and Firefox.",congreainchrome:"Your browser is compatible.",confirmCancel:"No",confirmOk:"Yes",
Controls:"Controls",coursePoll:"Course level poll",Cpoll:"Course poll",Cquiz:"Close quiz",createnewpoll:"Create new poll",Creator:"Creator",dap:"false",delete:"Delete",delblank:"Remove the blank option",Delete:"Delete",DevicesNotFoundError:"Webcam is not available, or not connected properly.",deletepopup:"Are you sure to delete ?",disable:"Disable",disabled:"disabled",disableAllVideo:"Disable all video",dltDisabled:"Can be deleted  by creator of the poll",documentShare:"Share document",DocumentSharing:"Document sharing",
DocumentSharedbHeading:"Document dashboard",docUploadSuccess:"Document uploaded successfully",download:"Download",downloadFile:"Download file",downloadsession:"Please wait while the recording is downloaded",drawArea:"Draw area",dropfilehere:"Drop files here",duplicateUploadMsg:"This file already exists, please upload new file.",edit:"Edit",editorCode:"Code editor",edittitle:"Edit title",editorRichDisable:"Write mode",editorRichEnable:"Read only",educator:"Educator",EHTMLPresentUrl:"Enter HTML5 presentation URL",
enable:"Enable",enablehistory:'"Browser history" should be enabled during the session.',enableAllVideo:"Enable all video",enteryouryoutubeurl:"Enter YouTube/online video URL",etDisabledA:"Can\u2019t edit, poll attempted",etDisabledCr:"Can be edited by creator of the poll",ETime:"Elapsed time",FF2:"Fast forward 2",FF8:"Fast forward 8",filenotsave:"Your file could not be saved.",filetsaveTS:"The session is ready to save.",Finish:"Finish",fitToScreen:"Fit to screen",Freehand:"Free hand",general:"General",
Greport:"Grade report",highBandWidthSpeed:"Your bandwidth is good enough.",httpsmissing:"Only secure origins(https) are allowed for screen sharing.",ieBrowserIssue:"Internet Explorer is not supported, Congrea fully support Chrome  and Firefox.",ios7support:"For Apple, Virtual Class supports iOS 8 and higher versions.",iosAudEnable:"Tap here to enable the audio",InternalError:"Please ensure that same webcam is not being used <br /> in multiple browsers or multiple applications. ",invalidcmid:"Invalid course module Id.",
invalidurl:"Invalid URL",indvprogress:"Current task",InsertimageURL:"Insert image URL",JoinClassMsg:"Join ClassRoom",JoinSession:"Join session",keymissing:"Your software(LMS/CMS)'s key is is missing",Line:"Line",lowBandWidthSpeed:"Your bandwidth is too low, we are stopping video playback. You will still be able to hear audio and view screen.",maxCommonChat:"Show chat window",Max_rooms:"Error: Max rooms limit reached",Max_users:"Error: Max users limit reached",media:"Media",mediumBandWidthSpeed:"Your bandwidth is limited, we are reducing video quality based on your available bandwidth.",
minCommonChat:"Hide chat window",minoption:"Enter at least two options",mictesting:"Microphone is working, if above audio bar fluctuates <br />and you are able to hear your own voice, while you speak",minute:"Minute",ModeclosingPoll:"Mode of closing Poll :",msgForDownloadStart:"Unable to save data. <br /> Preparing data for download",msgForReload:"Please reload this page to continue editing.",msgForWhiteboard:"Empty whiteboard.",msgStudentForReload:"Please reload this page.",Multiple_login:"Error: Access denied, multiple logins",
muteAll:"Mute all",muteAllAudio:"Mute all audio",mybsharedoc:"Document will shared shortly",NAME:"NAME",Next:"Next",nomdlroot:"There is no url for momodle root.",noResultStd:"You are not permitted to see the result",NotAllowedError:"Webcam is disabled",NotFoundError:"Webcam is not available, or not connected properly.",NotReadableError:"Please ensure that same webcam is not being used <br /> in multiple browsers or multiple applications.",notSupportBrowser:"Firefox {virtualclass1} does not support Screen sharing.",
notsupportbrowser:"{virtualclass1} is not fully compatible. For the best experience, use Google Chrome.",NotSupportedError:"Only secure origins(https) are allowed for audio and video",notSupportIphone:"Sorry. Virtual class doesn't support mobile phones.",noPoll:"There is no question available for poll. Go to \u2018Add new\u2019 to create question.",noPollNoAdmin:"There is no question available for site poll .Only admin can create site level poll.",noQuiz:"No quiz available. Congrea supports only mutliple choice questions",
Novote:"No vote received for this poll",nowebcam:"Webcam is not available, or not connected properly.",offcollaboration:"Collaboration off",oncollaboration:"Collaboration on",opendsDbheading:"Document dashboard",openSharePresentationdbHeading:"Presentation dashboard",openvideoDashboard:"Video dashboard",operaBrowserIssue:"Your browser {virtualclass1} {virtualclass2} is partially supported. You will not be able to share your screen, Congrea fully support chrome and Firefox",Options:"Options",optselectd:"OPTION SELECTED",
Oval:"Oval",overallprogress:"Overall progress",Pause:"Pause",pclosetag:"<span>Are you sure to close this poll?  </span>",pclose:"Are you sure to close voting?",Pclosed:"Poll closed",pdfnotrender:"There is problem with loading window, please reload browser.",Pdsuccess:"Poll deleted successfully",PEdit:"Poll edit",PermissionDeniedError:"Webcam access has been denied.",PERMISSION_DENIED:"You denied access to your Webcam(camera/microphone).",Play:"Play",playsessionmsg:"Click \u2018play\u2019 to start the session.",
pleasewaitWhSynNewCont:"Please wait a while. Syncing new content.",plswaitwhile:"Please wait....",poll:"Poll",pollblank:"Question can not be left blank",pollCancel:"Close",pollDel:"Are you sure to delete this poll?",pollHead:"Vote this poll",pollmaybeshown:"Poll will be published",pollmybpublish:"Poll will be published shortly",pollresult:"Previous result",ppoll:"Publish poll",PQuestions:"Poll questions",PQuiz:"Publish quiz",Precheck:"Precheck",precheckStart:"Start",prechkcmplt:"Precheck complete",
Presult:"Poll result",preWllBshortly:"Presentation will be shared shortly",Prev:"Prev",proposedspeed:"Proposed speed",PSetting:"Poll setting",Publish:"Publish",QClosed:"Quiz closed",Question:"Question",Quiz:"Quiz","Quiz/page":"Quiz / page",Quizes:"Quizzes",quizmayshow:"Get ready for a quiz",quizreviewpublish:"Review & publish quiz",RaiseHandStdDisabled:"Undo raise hand",RaiseHandEnable:"Hand raised",raiseHandNotify:"Student(s) raised hand",RaiseHandStdEnabled:"Raise hand",readonlymode:"Read only",
receivedVotes:"Received votes",reclaim:"Reclaim",Rectangle:"Rectangle",rejected:"Another application on your computer might be using your webcam. Kindly close all other applications",reload:"Reload",reloadDoc:"Reload document",replay:"Re-play",Replay:"Replay from start.",replay_message:"Thanks for watching.",requestScreenShare:"Request screen share",Reset:"Reset",Rtime:"Remaining time",rusureCquiz:"<span>Are you sure to close this quiz? </span>",rvtu:"Votes received/ total users",safariBrowserIssue:"Your browser Safari {virtualclass1} is not supported, We fully support Chrome  and Firefox",
Save:"Save",savesession:"Do you want to save current session?",savesessionTechSupport:"Do you want to save current session? <br /> Once you download the session, Updates won't be available on re-downloading of same session.",screensharealready:"The screen is being shared.",ScreenShare:"Screen share",screensharemsg:"The above screen is being shared.",second:"Second",selfview:"Self view",SetTimer:"Set timer",sesseionkeymissing:"Session key is missing from Front End.",sentPackets:"Sent <br/><span>Packets</span>",
SessionEnd:"Session end",sessionexpired:"Session Expired",sessionendmsg:"Session has been closed. You may now close your browser.",setting:"Setting",Searchuser:"Search user",share:"Share",ShareVideo:"Share video",shareAnotherYouTubeVideo:"Share another YouTube video",SharePresentation:"Share presentation",SharePresentationdbHeading:"Presentation dashboard",sharetoall:"Share to all",Showresulttostudents:"Show result to students",sitePoll:"Site level poll",Skip:"Close",someproblem:"There is some problem in uploading file. Please try again.",
SourceUnavailableError:"Please ensure that same webcam is not being used in multiple browsers or multiple applications.",speakerTest:"If you can hear music, speakers are working.",Spoll:"Site poll",ssBtn:"Stop sharing",ssStop:"Stop screen sharing",startnewsession:"Do you really want to end this session?",status:"Status",stdPublish:"stdPublish",stdscreenshare:"Do you want to share your screen ?",studentAudEnable:"Student audio enabled",studentSafariBrowserIssue:"Your browser {virtualclass1} {virtualclass2} cannot  share your webcam with other users, Congrea fully support Chrome  and Firefox.",
supportDesktop:"Virtual Class does not support tablets or mobiles. To present please use a desktop.",supportDesktopOnly:"Sorry, presenter mode only supports desktops. Tablets and Mobile devices are not supported.",teacherSafariBrowserIssue:"Safari does not support presenter functionality. Please switch to Chrome or Firefox.",techsupport:"Tech support",testingbrowser:"Testing browser compatibility",testinginternetspeed:"Testing internet speed",testingmichrophone:"Testing microphone",testingspeaker:"Testing speaker",
testingwebcam:"Testing webcam",Text:"Text",Text_Limit_Exeed:"Warning: High TX usage",TextEditor:"Text editor",Time:"Time",Tmyclose:"Teacher may close this poll at any time",total:"Total",totalprogress:"Total progress",tpAudioTest:"Test audio",transferControls:"Transfer controls",Triangle:"Triangle",Udocument:"Upload document",Unauthenticated:"Error: Access invalid",unmuteAll:"Unmute all",uploadsession:"Please wait until processing is complete",uploadvideo:"Upload video",uploadedsession:"Your session has ended. You may now close the window  or close this popup to start a new session.",
usermissing:"User is missing",userList:"User's list",validateurlmsg:"Invalid URL",VCE2:"No permission to recording session",VCE4:"Record data is missing",VCE5:"Unable to Record Data.",VCE6:"Course module is missing.",VideodbHeading:"Video dashboard",videoInput:"Video input",videooff:"Video off",videoon:"Video on",videoquality:"Video quality",VotedSoFar:"Votes received so far",votesuccess:"Your vote has been submitted successfully. Result will be displayed shortly.",votesuccessPbt:"Vote submitted successfully, you are not permitted to see the result.",
Vwllbshrshortly:"Video will be shared shortly",waitmsgconnect:"Please wait a while. Application is trying to connect.",watstdrespo:"Waiting for student\u2019s response",wbrtcMsgChrome:"You can click the deny button for not sharing your microphone and camera  with Congrea.or click allow button to share them.",wbrtcMsgFireFox:'You can click on  "Share Selected Devices" to share your mic and camera feed with other users',webcamerainfo:"If video is visible, webcam is working.",Whiteboard:"Whiteboard",
writemode:"Write mode",youtubeshare:"YouTube video share",youTubeUrl:"Enter YouTube video URL",zoomIn:"Zoom in",zoomOut:"Zoom out",noain:"No audio input",noaout:"No audio output",novideo:"No video",enableAllAudio:"Unmute All",disableAllAudio:"Mute All",colorSelector:"Color",strk:"Stroke size",font:"Font size",black:"black","dark-gray-4":"dark gray 4","dark-gray-3":"dark gray 3","dark-gray-2":"dark gray 2","dark-gray-1":"dark gray 1",gray:"gray","light-gray-1":"light gray 1","light-gray-2":"light gray 2",
"light-gray-3":"light gray 3",white:"white","red-berry":"red berry",red:"red",orange:"orange",yellow:"yellow",green:"green",cyan:"cyan","cornflower-blue":"cornflower blue",blue:"blue",purple:"purple",magenta:"magenta","light-red-berry-3":"light red berry 3","light-red-berry-2":"light red berry 2","light-red-berry-1":"light red berry 1","dark-red-berry-1":"dark red berry 1","dark-red-berry-2":"dark red berry 2","dark-red-berry-3":"dark red berry 3","light-red-3":"light red 3","light-red-2":"light red 2",
"light-red-1":"light red 1","dark-red-1":"dark red 1","dark-red-2":"dark red 2","dark-red-3":"dark red 3","light-orange-3":"light orange 3","light-orange-2":"light orange 2","light-orange-1":"light orange 1","dark-orange-1":"dark orange 1","dark-orange-2":"dark orange 2","dark-orange-3":"dark orange 3","light-yellow-3":"light yellow 3","light-yellow-2":"light yellow 2","light-yellow-1":"light yellow 1","dark-yellow-1":"dark yellow 1","dark-yellow-2":"dark yellow 2","dark-yellow-3":"dark yellow 3",
"light-green-3":"light green 3","light-green-2":"light green 2","light-green-1":"light green 1","dark-green-1":"dark green 1","dark-green-2":"dark green 2","dark-green-3":"dark green 3","light-cyan-3":"light cyan 3","light-cyan-2":"light cyan 2","light-cyan-1":"light cyan 1","dark-cyan-1":"dark cyan 1","dark-cyan-2":"dark cyan 2","dark-cyan-3":"dark cyan 3","light-cornflower-blue-3":"light cornflower blue 3","light-cornflower-blue-2":"light cornflower blue 2","light-cornflower-blue-1":"light cornflower blue 1",
"dark-cornflower-blue-1":"dark cornflower blue 1","dark-cornflower-blue-2":"dark cornflower blue 2","dark-cornflower-blue-3":"dark cornflower blue 3","light-blue-3":"light blue 3","light-blue-2":"light blue 2","light-blue-1":"light blue 1","dark-blue-1":"dark blue 1","dark-blue-2":"dark blue 2","dark-blue-3":"dark blue 3","light-purple-3":"light purple 3","light-purple-2":"light purple 2","light-purple-1":"light purple 1","dark-purple-1":"dark purple 1","dark-purple-2":"dark purple 2","dark-purple-3":"dark purple 3",
"light-magenta-3":"light magenta 3","light-magenta-2":"light magenta 2","light-magenta-1":"light magenta 1","dark-magenta-1":"dark magenta 1","dark-magenta-2":"dark magenta 2","dark-magenta-3":"dark magenta 3",Shapes:"Shapes",disableAllChat:"Disable private chat",enableAllChat:"Enable private chat",disableAllGroupChat:"Disable common chat",enableAllGroupChat:"Enable common chat",PermissionDeniedErrorExt:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top right of the screen <br /> Click on "Always allow..." option and select the camera option <br />  Click on done and refresh the screen  </div> <div class="screenImages"> <figure class="chrome" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-video.png" > <figcaption>Chrome</figcaption> </figure></div>',
SecurityErrorExt:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top right of the screen <br /> Click on "Always allow..." option and select the camera option <br />  Click on done and refresh the screen  </div> <div class="screenImages"> <figure class="chrome" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-video.png" > <figcaption>Chrome</figcaption> </figure></div>',nopermissionExt:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top right of the screen <br /> Click on "Always allow..." option and select the camera option <br />  Click on done and refresh the screen  </div> <div class="screenImages"> <figure class="chrome" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-video.png" > <figcaption>Chrome</figcaption> </figure></div>',
chromeExtMiss:"Congrea needs 'Desktop Selector' plugin to share the Screen.<br />You can download this from <a href='https://chrome.google.com/webstore/detail/desktop-selector/ijhofagnokdeoghaohcekchijfeffbjl' target='_blank'>HERE.</a>",PermissionDeniedErrorExtFF:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top left of the screen <br /> Click on "Share Selected Device." option.<div class="screenImages"><figure class="firefox" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-screnshare.png" > <figcaption>Chrome</figcaption> </figure></div>',
screensharereload:"Screen is not being shared. Please reload for the sharing.",SecurityErrorExtFF:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top left of the screen <br /> Click on "Share Selected Device." option.<div class="screenImages"><figure class="firefox" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-screnshare.png" > <figcaption>Chrome</figcaption> </figure></div>',nopermissionExtFF:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top left of the screen <br /> Click on "Share Selected Device." option.<div class="screenImages"><figure class="firefox" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-screnshare.png" > <figcaption>Chrome</figcaption> </figure></div>',
TypeError:"Your webcam is not initialized properly. Please reload the page.",newPage:"Insert page"}})(window);(function(d){d.getString=function(c,a){c=d.virtualclass.lang.message[c];if("undefined"!==typeof a&&0<a.length)for(let b=0;b<a.length;b++)c=c.replace(new RegExp(`{virtualclass${b+1}}`),a[b]);return c}})(window);(function(d){let c,a={init(){this.msgBoxClass="msgBox";this.window={};this.virtualWindow={};return this},displayMessage(b,a,c,d,m,n){b="undefined"===typeof m?this.createMsgBox(b,a,c):this.createMsgBox(b,a,c,m);a=document.getElementById(`vcanvas${n}`);"undefined"!==typeof d?document.getElementById(d+n).appendChild(b):a.insertBefore(b,a.childNodes[0])},createErrorMsg(b,a,c,d){let f="error";var g=document.getElementById(a);if(null==g)g=document.createElement("div"),g.id=a;else if(null!=d&&d.hasOwnProperty("className")){const b=
document.querySelector(`#${a}.${d.className}`);null!=b&&b.parentNode.removeChild(b);f+=` ${d.className}`}g.innerHTML=`<span className="${f}">${b}</span>`;b=document.querySelector("#closeMsg");null==b&&(b=document.createElement("span"),b.id="closeMsg",b.innerHTML="X",g.appendChild(b));b.onclick=function(){const b=document.querySelector(`#${a}`);b.parentNode.removeChild(b)};c=document.getElementById(c);c.parentNode.insertBefore(g,c);return g.id},removeErrorMsg(b,a){b=document.getElementById(b);if("undefined"!==
typeof a&&(a=b.innerHTML.split(/<br>|<br\\>/),1<a.length)){a.shift();b.innerHTML=a.join();return}b.parentNode.removeChild(b)},removeErrorContainer(b){b=document.getElementById(b);b.parentNode.removeChild(b)},customCreateElement(b,a,c){b=document.createElement(b);"undefined"!==typeof a&&""!=a&&(b.id=a);"undefined"!==typeof c&&(b.className=c);return b},createMsgBox(b,a,c,d){const f=this.customCreateElement("div",a,c);"undefined"===typeof d&&(c=this.customCreateElement("div",`${a}img`,`${c}img`),f.appendChild(c));
a=this.customCreateElement("p",`${a}Para`);a.innerHTML=b;f.appendChild(a);return f},disappearBox(b){b=document.getElementsByClassName(this.msgBoxClass+b);null!=b[0]&&b[0].parentNode.removeChild(b[0])},multiMediaMsg(b){"Firefox"==virtualclass.system.mybrowser.name?virtualclass.lang.getString("wbrtcMsgFireFox"):"Chrome"==virtualclass.system.mybrowser.name&&virtualclass.lang.getString("wbrtcMsgChrome")},canvasDrawMsg(b,a){document.getElementById(`vcanvas${a}`).classList.add("canvasMsgBoxParent");if("Firefox"==
virtualclass.system.mybrowser.name){var c=virtualclass.lang.getString("canvasDrawMsg");this.displayMessage(c,"canvasDrawMsgContFirefox",this.msgBoxClass+b,"containerWb")}else"Chrome"==virtualclass.system.mybrowser.name&&(c=virtualclass.lang.getString("canvasDrawMsg"),this.displayMessage(c,"canvasDrawMsgContChrome",this.msgBoxClass+b,"containerWb",null,a))},drawLabel(b,a){const c=virtualclass.lang.getString("drawArea");this.displayMessage(c,"canvasDrawArea",this.msgBoxClass+b,"containerWb",!1,a)},
displayMsgBox(b,a){const c=this.customCreateElement("div",b),f=this.customCreateElement("p",`${b}Para`);f.innerHTML=virtualclass.lang.getString(a);c.appendChild(f);a=this.customCreateElement("a",`${b}Anchor`);a.href="#";a.innerHTML=virtualclass.lang.getString("reload");a.onclick=function(){d.location.reload()};c.appendChild(a);b=document.getElementById("divForReloadMsg"==b?"virtualclassCont":"virtualclassAppLeftPanel");b.insertBefore(c,b.firstChild)},displayServerError(b,a){b=this.customCreateElement("div",
b);b.innerHTML=a;a=document.getElementById("vcanvas");a.parentNode.insertBefore(b,a)},removeElement(b){b=document.getElementById(b);null!=b&&b.parentNode.removeChild(b)},disableSSUI(){const b=document.getElementById("virtualclassScreenShareTool");null!=b&&(b.style.opacity="0.5",b.style.pointerEvents="none")},disableLeftAppBar(){const b=document.getElementById("virtualclassOptionsCont");null!=b&&(b.style.opacity="0.5",b.style.pointerEvents="none")}};a=a.init();a.window.resizeFinished=function(){let b=
0;return function(a,c){clearTimeout(b);b=setTimeout(a,c)}}();a.window.resize=function(b){b=virtualclass.system.measureResoultion({width:d.innerWidth,height:d.innerHeight});"DocumentShare"==virtualclass.currApp&&(b.width-=10,roles.hasControls()?b.height-=100:b.height-=40);virtualclass.vutil.setContainerWidth(b,virtualclass.currApp);b=virtualclass.gObj.currWb;"undefined"!==typeof b&&"undefined"!==typeof virtualclass.wb[b]&&virtualclass.wb[b].hasOwnProperty("vcan")&&virtualclass.wb[b].vcan.renderAll();
a.windowResizeFinished()};a.windowResizeFinished=function(){clearTimeout(c);c=setTimeout(()=>{a._windowResizeFinished()},100)};a._windowResizeFinished=function(){"mobTab"==virtualclass.system.device&&vhCheck();"Whiteboard"!=virtualclass.currApp&&"DocumentShare"!=virtualclass.currApp||null==virtualclass.gObj.currWb||"undefined"===typeof virtualclass.gObj.currWb||(virtualclass.gObj.hasOwnProperty("fitToScreenOnResize")&&clearTimeout(virtualclass.gObj.fitToScreenOnResize),virtualclass.gObj.fitToScreenOnResize=
setTimeout(()=>{const b=document.querySelector(".zoomControler .fitScreen");null!=b&&b.click()},700))};a.virtualWindow.manupulation=function(b){const a=b.message.virtualWindow;if(a.hasOwnProperty("removeVirtualWindow"))b.fromUser.userid!=wbUser.id&&virtualclass.wb[virtualclass.gObj.currWb].utility.removeVirtualWindow("virtualWindow");else if(a.hasOwnProperty("createVirtualWindow"))a.hasOwnProperty("toolHeight")&&localStorage.setItem("toolHeight",a.toolHeight),b.fromUser.userid!=wbUser.id&&virtualclass.wb[virtualclass.gObj.currWb].utility.createVirtualWindow(a.createVirtualWindow);
else if(a.hasOwnProperty("shareBrowserWidth")){a.hasOwnProperty("toolHeight")&&localStorage.setItem("toolHeight",a.toolHeight);if(roles.hasControls()){var c=virtualclass.wb[virtualclass.gObj.currWb].utility.getWideValueAppliedByCss("commandToolsWrapper");localStorage.setItem("toolHeight",c)}b.fromUser.userid!=wbUser.id?(roles.hasControls()&&virtualclass.wb[virtualclass.gObj.currWb].utility.makeCanvasEnable(),otherBrowser=a.browserRes):myBrowser=virtualclass.system.measureResoultion({width:d.outerWidth,
height:d.innerHeight});"object"===typeof myBrowser&&"object"===typeof otherBrowser&&(myBrowser.width>otherBrowser.width?virtualclass.wb[virtualclass.gObj.currWb].gObj.virtualWindow||(virtualclass.wb[virtualclass.gObj.currWb].utility.createVirtualWindow(otherBrowser),virtualclass.wb[virtualclass.gObj.currWb].gObj.virtualWindow=!0):myBrowser.width<otherBrowser.width&&!virtualclass.wb[virtualclass.gObj.currWb].gObj.virtualWindow&&(b=document.getElementById("vcanvas"),b=virtualclass.wb[virtualclass.gObj.currWb].utility.getElementRightOffSet(b),
roles.hasControls()?virtualclass.vutil.beforeSend({virtualWindow:{createVirtualWindow:myBrowser-b,toolHeight:c}}):virtualclass.vutil.beforeSend({virtualWindow:{createVirtualWindow:myBrowser-b}})))}};d.view=a})(window);(function(d){var c={init(){this.wbRtc={};this.wbRtc.className="webrtcCont";this.mybrowser={};return this},isCanvasSupport(a,b,c){console.log("is canvas support");console.log(a);console.log(b);return"MSIE"==b?9==c:!!d.CanvasRenderingContext2D},isWebSocketSupport(a,b,c){return"undefined"===typeof d.WebSocket||"function"!==typeof d.WebSocket&&"object"!==typeof d.WebSocket||!d.WebSocket.hasOwnProperty("OPEN")?!1:!0},isLocalStorageSupport(){return void 0!==Storage},isGetUserMediaSupport(a,b){navigator.getUserMedia=
navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return!!navigator.getUserMedia},isIndexedDbSupport(){return!!(d.indexedDB||d.webkitIndexedDB||d.mozIndexedDB||d.msIndexedDB)},isWorkerSupport(){return!!d.Worker},isAudioApiSupport(){return!(!d.AudioContext&&!d.webkitAudioContext)},isTypedArraySupport(){return!!("ArrayBuffer"in d)},isScreenShareSupport(a,b){return"Firefox"==a?34<=b:"Chrome"==a?39<=b:!1},setValue(a,b){this[a]=b},checkBrowserFunctions(a,
b){this.setValue("canvas",this.isCanvasSupport());this.setValue("webSocket",this.isWebSocketSupport());this.setValue("getusermedia",this.isGetUserMediaSupport());this.setValue("indexeddb",this.isIndexedDbSupport());this.setValue("webworker",this.isWorkerSupport());this.setValue("webaudio",this.isAudioApiSupport());this.setValue("typedarray",this.isTypedArraySupport());this.setValue("screenshare",this.isScreenShareSupport(a,b));this.setValue("localstorage",this.isLocalStorageSupport())},measureResoultion(a){if(!virtualclass.gObj.hasOwnProperty("measureDimension")){var b=
document.getElementById("virtualclassCont");b=virtualclass.vutil.getElementOffset(b);const c=b.x;virtualclass.gObj.measureDimension={width:1024>a.width?1024-(c+10):a.width-(c+350),height:a.height-b.y}}return virtualclass.gObj.measureDimension},setAppDimension(a,b){},setDocCanvasDimension(a,b,c){c=document.querySelector(`#canvas${c}`);null!=c&&(c.width=a,c.height=b)},setCanvasDimension(a,b){if("object"===typeof virtualclass.wb[b]){const {vcan:f}=virtualclass.wb[b];if("undefined"!==typeof f.main.canvas){const {canvas:g}=
f.main;ctx=f.main.canvas.getContext("2d");g.width=a.width;const d=document.querySelector(`#canvasWrapper${virtualclass.gObj.currWb}`);d.style.width=`${g.width}px`;var c=virtualclass.isPlayMode?85:15;c=roles.hasControls()||roles.hasAdmin()?100:"Whiteboard"==virtualclass.currApp?c+30:c;g.height=a.height-c;d.style.height=`${g.height-30}px`;console.log(`canvasWrapper height${d.style.height}`);console.log(`canvas width ${g.width}`);a=f.utility.getElementOffset(document.getElementById(`canvas${b}`));f.main.offset.x=
a.x;console.log(`canvas offset x=${f.main.offset.x} canvas offset y=${a.y}`)}}},setCanvasWrapperDimension(a,b){console.log("Width of canvas wrapper, not seeting ")},getResoultion(a){const b={};1280>a?(b.width=1024,b.height=768):1280<=a&&1366>a?(b.width=1280,b.height=1024):1366<=a&&1920>a?(b.width=1366,b.height=768):1920<=a&&(b.width=1920,b.height=1080);return b},reportBrowser(a){a=this.getErrors(a);1<a.length?virtualclass.error.push(`${a.join(",")} are disabled in your browser.`):1==a.length&&virtualclass.error.push(`${a} is disabled in your browser.`)},
getErrors(a){const b=[],c="canvas webSocket getusermedia webaudio indexeddb localstorage typedarray".split(" ");"t"!=a&&"e"!=a||c.push("webworker","screenshare");for(a=0;a<c.length;a++)this[c[a]]||("screenshare"==c[a]&&(virtualclass.gObj.errNotScreenShare=!0),b.push(virtualclass.lang.getString(`err${c[a]}`)));return b},isiOSDevice(){return parseFloat(`${(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]}`.replace("undefined","3_2").replace("_",".").replace("_",
""))||!1},isAndroid(){return-1<navigator.userAgent.toLowerCase().indexOf("android")},isIPad(){return/(iPad)/g.test(navigator.userAgent)},setBrowserDetails(){var a=this.isiOSDevice();this.device="desktop";if(a){var b="iOS";this.device="mobTab"}else a=this.mybrowser.detection(),b=a[0],a=parseFloat(a[1]);this.mybrowser.name=b;this.mybrowser.version=a},check(){var a=this.isiOSDevice();this.device="desktop";const b=document.getElementById("virtualclassCont");if(a){var c="iOS";this.device="mobTab"}else{var g=
this.isAndroid();a=this.mybrowser.detection();c=a[0];a=parseFloat(a[1])}this.mybrowser.name=c;this.mybrowser.version=a;this.checkBrowserFunctions(c,a);"undefined"!==typeof g&&g?(this.device="mobTab",b.setAttribute("device","mobile"),b.classList.add("android"),g&&("Chrome"==c?40>a?(virtualclass.error.push(virtualclass.error.push(virtualclass.lang.getString("chFireBrowsersIssue",[c,a]))),virtualclass.vutil.initDisableVirtualClass()):40<=a&&67>a&&virtualclass.vutil.initDisableAudVid():(virtualclass.error.push(virtualclass.error.push(virtualclass.lang.getString("chFireBrowsersIssue",
[c,a]))),virtualclass.vutil.initDisableVirtualClass()))):"Chrome"==c&&40<=a||"Firefox"==c&&35<=a||roles.isStudent()&&c=="OPR">a>=26?this.reportBrowser(virtualclass.gObj.uRole):"Chrome"==c&&40>a||"Firefox"==c&&35>a||roles.isStudent()&&"OPR"==c&&26>a?(this.reportBrowser(virtualclass.gObj.uRole),virtualclass.error.push(virtualclass.lang.getString("chFireBrowsersIssue",[c,a]))):"OPR"==c&&26<=a?(this.reportBrowser(virtualclass.gObj.uRole),roles.hasControls()&&virtualclass.error.push(virtualclass.lang.getString("operaBrowserIssue",
[c,a]))):"SafarisupportedOld"==c?8<=a?roles.hasControls()?(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("teacherSafariBrowserIssue",[c,a]))):(virtualclass.vutil.initDisableAudVid(),virtualclass.error.push(virtualclass.lang.getString("studentSafariBrowserIssue",[c,a])),virtualclass.user.control.mediaWidgetDisable()):(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("safariBrowserIssue",[c,a]))):"iOS"==
c?(b.setAttribute("device","mobile"),b.classList.add("ios"),this.isIPad()&&roles.isStudent()&&(8<=a?console.log("do nothing"):(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("ios7support"))))):this.mybrowser.detectIE()&&(virtualclass.gObj.errIE=!0,virtualclass.error.push(virtualclass.lang.getString("ieBrowserIssue")),virtualclass.vutil.initDisableVirtualClass())},mediaDevices:{webcamErr:[],async getMediaDeviceInfo(){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&
(navigator.enumerateDevices=async function(){return await navigator.mediaDevices.enumerateDevices()});let a=[];const b="https:"===location.protocol;let c=!1;"undefined"!==typeof MediaStreamTrack&&"getSources"in MediaStreamTrack?c=!0:navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(c=!0);let g=this.hasWebcam=this.hasSpeakers=this.hasMicrophone=!1,k=!1;const m=this;if(c)if(!navigator.enumerateDevices&&d.MediaStreamTrack&&d.MediaStreamTrack.getSources&&(navigator.enumerateDevices=d.MediaStreamTrack.getSources.bind(d.MediaStreamTrack)),
!navigator.enumerateDevices&&navigator.enumerateDevices&&(navigator.enumerateDevices=navigator.enumerateDevices.bind(navigator)),navigator.enumerateDevices){a=[];try{var n=await navigator.enumerateDevices()}catch(q){console.log(q)}n.forEach(c=>{const f={};for(const b in c)f[b]=c[b];"audio"===f.kind&&(f.kind="audioinput");"video"===f.kind&&(f.kind="videoinput");let d;a.forEach(b=>{b.id===f.id&&b.kind===f.kind&&(d=!0)});d||(f.deviceId||(f.deviceId=f.id),f.id||(f.id=f.deviceId),f.label?("videoinput"!==
f.kind||k||(k=!0),"audioinput"!==f.kind||g||(g=!0)):(f.label="Please invoke getUserMedia once.",b||(f.label=`HTTPs is required to get label of this ${f.kind} device.`)),"audioinput"===f.kind&&(m.hasMicrophone=!0),"audiooutput"===f.kind&&(m.hasSpeakers=!0),"videoinput"===f.kind&&(m.hasWebcam=!0),a.push(f))})}else callback&&callback()}},webpInit(){virtualclass.modernizr.on("webp",a=>{virtualclass.system.webpSupport="Firefox"===virtualclass.system.mybrowser.name||"Edge"===virtualclass.system.mybrowser.name?
!1:!!a})},initResize(){virtualclass.gObj.hasOwnProperty("measureDimension")&&delete virtualclass.gObj.measureDimension;virtualclass.gObj.hasOwnProperty("initResize")&&clearTimeout(virtualclass.gObj.initResize);virtualclass.gObj.initResize=setTimeout(()=>{virtualclass.vutil.addClass("virtualclassCont","resizeWindow");c.setAppDimension(null,"resize");virtualclass.view.window.resize()},50)},_initResize(){virtualclass.vutil.addClass("virtualclassCont","resizeWindow");c.setAppDimension(null,"resize");
virtualclass.view.window.resize()}};c=c.init();d.addEventListener("resize",()=>{c.initResize()});c.mybrowser.detectIE=function(){const a=d.navigator.userAgent;var b=a.indexOf("MSIE ");if(0<b)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);if(0<a.indexOf("Trident/"))return b=a.indexOf("rv:"),parseInt(a.substring(b+3,a.indexOf(".",b)),10);b=a.indexOf("Edge/");return 17<=b?!1:parseInt(a.substring(b+5,a.indexOf(".",b)),10)};c.mybrowser.detection=function(){let a;const b=navigator.userAgent;let c,
g=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];/trident/i.test(g[1])&&(c=/\brv[ :]+(\d+)/g.exec(b)||[],a={name:"IE",version:c[1]||""});"Chrome"===g[1]&&(c=b.match(/\b(OPR|Edge)\/(\d+)/),null!=c&&(a={name:c[1].replace("OPR","Opera"),version:c[2]}));g=g[2]?[g[1],g[2]]:[navigator.appName,navigator.appVersion,"-?"];null!=(c=b.match(/version\/(\d+)/i))&&(g.splice(1,1,c[1]),a={name:g[0],version:g[1]});return"undefined"!==typeof a?[a.name,a.version]:g};d.system=c})(window);(function(d){d.packContainer=function(){return{createPacketContDiv(c,a){const b=document.createElement("div");"undefined"!==typeof c&&(b.id=c);"undefined"!==typeof a&&(b.clasName=a);return b},togglePacketCont(c){const a=this.className.split(" ");for(let b=0;b<a.length;b++)if("display"==a[b]){this.className="hide";this.innerHTML="+";c._togglePacketCont(a[b]);break}else if("hide"==a[b]){this.className="display";this.innerHTML="-";c._togglePacketCont(a[b]);break}},_togglePacketCont(c){c="display"==c?
"none":"block";document.getElementById("dataInfoHeading").style.display=c;var a=document.getElementById("packetContainer");a.style.display=c;a=document.getElementById("informationCont");a.style.display=c}}}})(window);(function(d){d.draw_object=function(c,a,b){const f=this;b.started=!1;let g,d,m=[];const {vcan:n}=virtualclass.wb[virtualclass.gObj.currWb];b.mousedown=function(a,c){b._mousedown(a,c)};b.mousemove=function(a,c){b._mousemove(a,c)};b.mouseup=function(a,c){b._mouseup(a,c)};b.touchstart=function(a,c){b._mousedown(a,c);a.preventDefault()};b.touchmove=function(a,c){b._mousemove(a,c);a.preventDefault()};b.touchend=function(a,c){b._mouseup(a,c);a.preventDefault()};b._mousedown=function(a,g){var d=virtualclass.gObj.currWb;
(new Date).getTime();a.detail.hasOwnProperty("cevent")&&(a=virtualclass.wb[virtualclass.gObj.currWb].utility.scaleCordinate(a),a.clientX=a.detail.cevent.x+f.vcan.main.offset.x,a.clientY=a.detail.cevent.y+f.vcan.main.offset.y,a.x=a.detail.cevent.x+f.vcan.main.offset.x,a.y=a.detail.cevent.y+f.vcan.main.offset.y,a.pageX=a.detail.cevent.x+f.vcan.main.offset.x,a.pageY=a.detail.cevent.y+f.vcan.main.offset.y,a.currX=a.detail.cevent.x,a.currY=a.detail.cevent.y);({vcan:g}=f);virtualclass.gObj.lastmousemovetime=
null;b.startPosX=a.currX;b.startPosY=a.currY;virtualclass.wb[d].gObj.spx=b.startPosX;virtualclass.wb[d].gObj.spy=b.startPosY;if("create"==g.getStates("action")){const k=(new Date).getTime();if("text"!=c&&f.tool.cmd!=`t_clearall${d}`){if(d=g.getStates("currentTransform"),""==d||null==d)a.detail.hasOwnProperty("cevent")||g.optimize.calculatePackets(k,"d",b.startPosX,b.startPosY),b.started=!0}else f.obj.drawTextObj.muser=!1,a.detail.hasOwnProperty("cevent")||f.tool.cmd==`t_clearall${d}`?f.obj.drawTextObj.muser=
!0:f.utility.clickOutSidebox(f.obj.drawTextObj.textWriteMode)&&({vcan:g}=virtualclass.wb[virtualclass.gObj.currWb],void 0!=g.main.currentTransform&&""!=g.main.currentTransform?g.optimize.calculatePackets(k,"d",b.startPosX,b.startPosY,"foundtext"):g.optimize.calculatePackets(k,"d",b.startPosX,b.startPosY)),a.detail.hasOwnProperty("cevent")?a.detail.cevent.hasOwnProperty("mtext")?f.obj.drawTextObj.textUtility(b.startPosX,b.startPosY,a.detail.cevent.mtext):f.obj.drawTextObj.textUtility(b.startPosX,b.startPosY):
"object"===typeof f.obj.drawTextObj&&f.obj.drawTextObj.textUtility(b.startPosX,b.startPosY)}"freeDrawing"==c&&1==f.obj.freeDrawObj.freesvg&&f.obj.freeDrawObj.drawStart(a)};b._mousemove=function(a,k){a.detail.hasOwnProperty("cevent")&&(a=virtualclass.wb[virtualclass.gObj.currWb].utility.scaleCordinate(a),a.clientX=a.detail.cevent.x+f.vcan.main.offset.x,a.clientY=a.detail.cevent.y+f.vcan.main.offset.y,a.x=a.detail.cevent.x+f.vcan.main.offset.x,a.y=a.detail.cevent.y+f.vcan.main.offset.y,a.pageX=a.detail.cevent.x+
f.vcan.main.offset.x,a.pageY=a.detail.cevent.y+f.vcan.main.offset.y,a.currX=a.detail.cevent.x,a.currY=a.detail.cevent.y);if(b.started&&"t_clearall"!=f.tool.cmd)if(void 0!=f.obj.freeDrawObj&&1==f.obj.freeDrawObj.freesvg){if(f.obj.freeDrawObj.fdObj.isCurrentlyDrawing&&(f.obj.freeDrawObj.wb_draw(a),!a.detail.hasOwnProperty("cevent")||a.detail.hasOwnProperty("cevent")&&a.detail.hasOwnProperty("broadCast"))){"undefined"!==typeof k||"undefined"!==typeof virtualclass.gObj.lastmousemovetime&&null!=virtualclass.gObj.lastmousemovetime||
(virtualclass.gObj.lastmousemovetime=(new Date).getTime(),n.optimize.calculatePackets(virtualclass.gObj.lastmousemovetime,"m",a.currX,a.currY));var q=(new Date).getTime();a=n.makeStackObj(q,"m",a.currX/virtualclass.zoom.canvasScale,a.currY/virtualclass.zoom.canvasScale);m.push(a);if("undefined"===typeof k&&(virtualclass.gObj.presentmousemovetime=(new Date).getTime(),2E3<=virtualclass.gObj.presentmousemovetime-virtualclass.gObj.lastmousemovetime)){for(a=0;a<m.length;a++)f.uid++,m[a].uid=f.uid,n.main.replayObjs.push(m[a]);
virtualclass.vutil.beforeSend({repObj:m,cf:"repObj"});virtualclass.storage.store(JSON.stringify(n.main.replayObjs));m=[];virtualclass.gObj.lastmousemovetime=(new Date).getTime()}}}else{g=a.currX;d=a.currY;""!=f.prvObj&&f.canvas.removeObject(f.prvObj);k=f.makeobj(b.startPosX,b.startPosY,g,d,c);k=f.canvas.readyObject(k);f.canvas.addObject(k);k.coreObj.usrCurrAction="create";q=(new Date).getTime();if("undefined"===typeof virtualclass.gObj.lastmousemovetime||null==virtualclass.gObj.lastmousemovetime)virtualclass.gObj.lastmousemovetime=
(new Date).getTime(),(!a.detail.hasOwnProperty("cevent")||a.detail.hasOwnProperty("cevent")&&a.detail.hasOwnProperty("broadCast"))&&"text"!=c&&"t_clearall"!=f.tool.cmd&&n.optimize.calculatePackets(q,"m",g,d);virtualclass.gObj.presentmousemovetime=(new Date).getTime();2E3<=virtualclass.gObj.presentmousemovetime-virtualclass.gObj.lastmousemovetime&&((!a.detail.hasOwnProperty("cevent")||a.detail.hasOwnProperty("cevent")&&a.detail.hasOwnProperty("broadCast"))&&"text"!=c&&"t_clearall"!=f.tool.cmd&&n.optimize.calculatePackets(q,
"m",g,d),virtualclass.gObj.lastmousemovetime=(new Date).getTime());f.prvObj=k.coreObj}else"move"==f.vcan.main.action&&(""!=n.main.currentTransform&&null!=n.main.currentTransform||"move"!=f.vcan.main.action)||virtualclass.vutil.beforeSend({createArrow:!0,x:a.currX/virtualclass.zoom.canvasScale,y:a.currY/virtualclass.zoom.canvasScale,cf:"createArrow"})};b._mouseup=function(a,k){a.detail.hasOwnProperty("cevent")&&(a.clientX=a.detail.cevent.x+f.vcan.main.offset.x,a.clientY=a.detail.cevent.y+f.vcan.main.offset.y,
a.x=a.detail.cevent.x+f.vcan.main.offset.x,a.y=a.detail.cevent.y+f.vcan.main.offset.y,a.pageX=a.detail.cevent.x+f.vcan.main.offset.x,a.pageY=a.detail.cevent.y+f.vcan.main.offset.y,a.currX=a.detail.cevent.x,a.currY=a.detail.cevent.y);g=a.currX;d=a.currY;virtualclass.gObj.lastmousemovetime=null;if(b.started&&"text"!=c){b.mousemove(a,"up");(!a.detail.hasOwnProperty("cevent")||a.detail.hasOwnProperty("cevent")&&a.detail.hasOwnProperty("broadCast"))&&"freeDrawing"!=c&&(k=(new Date).getTime(),n.optimize.calculatePackets(k,
"u",g,d));if(void 0!=f.obj.freeDrawObj&&1==f.obj.freeDrawObj.freesvg&&(f.obj.freeDrawObj.fdObj.isCurrentlyDrawing&&f.obj.freeDrawObj.finalizeDraw(a),(!a.detail.hasOwnProperty("cevent")||a.detail.hasOwnProperty("cevent")&&a.detail.hasOwnProperty("broadCast"))&&0<m.length)){k=(new Date).getTime();a=n.makeStackObj(k,"u",g/virtualclass.zoom.canvasScale,d/virtualclass.zoom.canvasScale);m.push(a);for(a=0;a<m.length;a++)f.uid++,m[a].uid=f.uid,n.main.replayObjs.push(m[a]);virtualclass.vutil.beforeSend({repObj:m,
cf:"repObj"});virtualclass.storage.store(JSON.stringify(n.main.replayObjs));m=[]}""!=f.prvObj&&(f.prvObj="");f.prvObj="";b.started=!1}f.vcan.wb.sentPack&&(f.vcan.wb.sentPack=!1)}}})(window);(function(d){d.makeobj=function(c,a,b,f,g){const d={mp:{}};d.mp.x=b;d.mp.y=f;const m=2*virtualclass.zoom.canvasScale;if(c>b){const g=b,k=f;b=c;f=a;c=g;a=k;d.dRoad="b2t"}else d.dRoad="t2b";d.type=g;if("rectangle"==g||"triangle"==g)d.sx=c,d.sy=a,d.ex=b,d.ey=f;if("line"==g)d.lineColor="#424240",d.lineWidth=m,d.start={x:c,y:a},d.end={x:b,y:f};else if("rectangle"==g)d.width=b-c,d.height=f-a,d.borderColor="#424240",d.lineWidth=m;else if("oval"==g)d.lineWidth=m,d.borderColor="#424240",d.width=b-c,d.height=
f-a,d.x=b-d.width/2,d.y=f-d.height/2,d.rx=d.width/2,d.ry=d.height/2;else if("triangle"==g)d.lineWidth=m,d.borderColor="#424240";else if("text"==g)return;return d}})(window);let newScrollVal=0;
(function(d){d.vcanUtility=function(c){const {vcan:a}=virtualclass.wb[c];a.utility={canvasCalcOffset(b){const c=a.main;b=document.getElementById(b);b=a.utility.getElementOffset(b);roles.hasControls()&&0==b.x&&(b.x=53,b.y=48);return c.offset=b},getElementOffset(a){let b=0,c=0;do b+=a.offsetTop||0,c+=a.offsetLeft||0,a=a.offsetParent;while(a);return{x:c,y:b}},setVal(b,c,g){("scaleX"===c||"scaleY"===c)&&g<b.MIN_SCALE_LIMIT&&(g=b.MIN_SCALE_LIMIT);if("object"===typeof c)for(const f in c)a.utility.setVal(b,f,
c[f]);else"angle"===c?a.utility.setAngle(b,g):b[c]=g;return b},getVal(a,c){return a[c]},setAngle(a,c){a.theta=c/180*Math.PI;a.angle=c;return a},actualPointer(b){var c=0,g=0;null!=virtualclass.gObj.currWb&&(c="undefined"===typeof virtualclass.pdfRender[virtualclass.gObj.currWb].topPosY?0:virtualclass.pdfRender[virtualclass.gObj.currWb].topPosY,g="undefined"===typeof virtualclass.pdfRender[virtualclass.gObj.currWb].leftPosX?0:virtualclass.pdfRender[virtualclass.gObj.currWb].leftPosX);return{x:a.utility.pointerX(b)+
g,y:a.utility.pointerY(b)+c}},pointerX(a){const b=0<=a.type.indexOf("touch")?"touch":"mouse",c=document.documentElement,d=document.body||{scrollLeft:0};if("mouse"==b)return("undefined"!==typeof a.clientX?a.clientX:0)+(c.scrollLeft||d.scrollLeft)-(c.clientLeft||0);a.type="touchend";return(a.changedTouches[0]&&"undefined"!==typeof a.changedTouches[0].clientX?a.changedTouches[0].clientX:0)+(c.scrollLeft||d.scrollLeft)-(c.clientLeft||0)},pointerYOld(a){const b=document.documentElement,c=document.body||
{scrollTop:0};return("unknown"!==typeof a.clientY?a.clientY:0)+(b.scrollTop||c.scrollTop)-(b.clientTop||0)},pointerY(a){const b=0<=a.type.indexOf("touch")?"touch":"mouse",c=document.documentElement,d=document.body||{scrollTop:0};newScrollVal=(c.scrollTop||d.scrollTop)-(c.clientTop||0);if("mouse"==b)return("undefined"!==typeof a.clientY?a.clientY:0)+newScrollVal;a.type="touchend";return(a.changedTouches[0]&&"undefined"!==typeof a.changedTouches[0].clientY?a.changedTouches[0].clientY:0)+newScrollVal},
getReltivePoint(b){const {offset:c}=a.main;b=a.utility.actualPointer(b);return{x:b.x-c.x,y:b.y-c.y}},degreesToRadians(a){return Math.PI/180*a},setActiveObject(b){a.main.activeObject&&a.main.activeObject.setActive(!1);a.main.activeObject=b;b.setActive(!0);return b},updateObj(a){const b={};for(prop in a)"oCoords"!=prop?b[prop]=a[prop]:(b.start={},b.end={},b.start.x=a[prop].tl.x,b.start.y=a[prop].tl.y,b.end.x=a[prop].br.x,b.end.y=a[prop].br.y);return b},setCursorFromEvent(a,c,g){const b=a.upperCanvasEl.style;
if(!g)return b.cursor=this.defaultCursor,!1;if(c=g.findTargetCorner(c))if(c in a.cursorMap)b.cursor=a.cursorMap[c];else if("mtr"===c&&g.hasRotatingPoint)b.cursor=a.rotationCursor;else return b.cursor=this.defaulCursor,!1;else b.cursor=a.hoverCursor;return!0},getChildren(){return a.main.children},isCeventExist(a){return a.hasOwnProperty("detail")?a.hasOwnProperty("cevent"):!1},updateCordinate(b){b=a.utility.actualPointer(b);const c={detail:{}};c.clientX=b.x;c.clientY=b.y;return c}}}})(window);(function(d){d.vcanMain=function(c){const {vcan:a}=virtualclass.wb[c];a.main.prototype={addObject(b){if("object"===typeof b.coreObj){"freehand"!=b.coreObj.type&&a.main.children.push(b.coreObj);const c=a.main.canvas.getContext("2d");a.render(c,b.coreObj)}},removeObject(b){a.remove(b)},bind(b,c){a.events().bind(a.main.canvas,b,c)},readyObject(b,c){b=a.extend({},b);c||void 0!=b.id||(a.main.id++,b.id=a.main.id);b.rotatingPointOffset=40;b.selectable=!0;b.downObj=!1;b.active=!1;b.cornersize=12;b.padding=
0;b.hasControls=!0;b.cornerColor="rgba(102,153,255,0.5)";void 0==b.borderColor&&(b.borderColor="#000");b.flipX=!1;b.flipY=!1;b.draggable=!1;b.hasBorders=!0;b.hasRotatingPoint=!1;b.hideCorners=!1;b.lockRotation=!1;b.MIN_SCALE_LIMIT=.1;b.borderOpacityWhenMoving=.4;b.color=void 0==virtualclass.wb[virtualclass.gObj.currWb].activeToolColor?virtualclass.gObj.defaultcolor:virtualclass.wb[virtualclass.gObj.currWb].activeToolColor;b.stroke=void 0==virtualclass.wb[virtualclass.gObj.currWb].currStrkSize?virtualclass.gObj.defalutStrk:
virtualclass.wb[virtualclass.gObj.currWb].currStrkSize;b.fontSize=void 0==virtualclass.wb[virtualclass.gObj.currWb].textFontSize?virtualclass.gObj.defalutFont:virtualclass.wb[virtualclass.gObj.currWb].textFontSize;b.hasOwnProperty("theta")||(b.theta=0);b.hasOwnProperty("scaleX")||(b.scaleX=1);b.hasOwnProperty("scaleY")||(b.scaleY=1);"line"==b.type?(a.objLine=new a.line,a.objLine.init(b)):"rectangle"==b.type?(a.objRect=new a.rectangle,a.objRect.init(b)):"oval"==b.type?(a.objOval=new a.oval,a.objOval.init(b)):
"triangle"==b.type?(a.objTri=new a.triangle,a.objTri.init(b)):"text"==b.type&&(a.objTxt=new a.text,a.objTxt.init(b));b.getWidth=function(){return this.width*this.scaleX};b.getHeight=function(){return this.height*this.scaleY};b.setCoords=function(){this.currentWidth=this.width*this.scaleX;this.currentHeight=this.height*this.scaleY;this.hypotenuse=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));this.angle=Math.atan(this.currentHeight/this.currentWidth);this.theta=this.theta;
var {theta:c}=this;const f=Math.sin(c);c=Math.cos(c);const d={x:this.x-Math.cos(this.angle+this.theta)*this.hypotenuse,y:this.y-Math.sin(this.angle+this.theta)*this.hypotenuse},n={x:d.x+this.currentWidth*c,y:d.y+this.currentWidth*f},q={x:d.x-this.currentHeight*f,y:d.y+this.currentHeight*c};this.oCoords={tl:d,tr:n,br:{x:n.x-this.currentHeight*f,y:n.y+this.currentHeight*c},bl:q,ml:{x:d.x-this.currentHeight/2*f,y:d.y+this.currentHeight/2*c},mt:{x:d.x+this.currentWidth/2*c,y:d.y+this.currentWidth/2*f},
mr:{x:n.x-this.currentHeight/2*f,y:n.y+this.currentHeight/2*c},mb:{x:q.x+this.currentWidth/2*c,y:q.y+this.currentWidth/2*f},mtr:{x:d.x+this.currentWidth/2*c,y:d.y+this.currentWidth/2*f}};this.setCornerCoords();b.findTargetCorner=function(c){var {offset:f}=a.main;if(!this.hasControls)return!1;var g=a.utility.actualPointer(c);c=g.x-f.x;f=g.y-f.y;for(const d in this.oCoords){if("mtr"===d&&!this.hasRotatingPoint)break;g=a.virtual_box.getImageLines(this.oCoords[d].corner,d);g=a.virtual_box.findCrossPoints(c,
f,g);if(1==g%2&&0!=g)return b.corner=d}return!1};return this};b.drawBorders=function(a){if(this.hasBorders){var {padding:b}=this,c=2*b;a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;var f=1/(this.scaleX<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleX),g=1/(this.scaleY<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleY);a.lineWidth=1/this.borderScaleFactor;a.scale(f,g);f=this.getWidth();g=this.getHeight();a.strokeRect(~~(-(f/2)-b)+.5,~~(-(g/
2)-b)+.5,~~(f+c),~~(g+c));!this.hasRotatingPoint||this.hideCorners||this.lockRotation||(b=(this.flipY?g:-g)/2,a.beginPath(),a.moveTo(0,b),a.lineTo(0,b+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),a.closePath(),a.stroke());a.restore();return this}};b.drawCorners=function(a){if(this.hasControls){var b=8*virtualclass.zoom.canvasScale,c=b/2,{padding:f}=this,g=-(this.width/2),d=-(this.height/2),z=b/this.scaleX,t=b/this.scaleY,u=(f+c)/this.scaleY,p=(f+c)/this.scaleX,v=(f+c-b)/this.scaleX;
c=(f+c-b)/this.scaleY;({height:f}=this);a.save();a.fillStyle=this.cornerColor;a.fillRect(g-p,d-u,z,t);b=g+this.width-p;a.fillRect(b,d-u,z,t);a.fillRect(g-p,d+f+c,z,t);b=g+this.width+v;a.fillRect(b,d+f+c,z,t);b=g+this.width/2-p;a.fillRect(b,d-u,z,t);b=g+this.width/2-p;a.fillRect(b,d+f+c,z,t);b=g+this.width+v;a.fillRect(b,d+f/2-u,z,t);a.fillRect(g-p,d+f/2-u,z,t);this.hasRotatingPoint&&(b=g+this.width/2-p,g=this.flipY?d+f+this.rotatingPointOffset/this.scaleY-t/2:d-this.rotatingPointOffset/this.scaleY-
t/2,a.fillRect(b,g,z,t));a.restore();return this}};b.setActive=function(a){this.active=!!a;return this};b.dragDrop=function(a){this.draggable=void 0!=a?a:!1};b.setCornerCoords=function(){const b=this.oCoords;var c=a.utility.degreesToRadians(45-this.getAngle()),f=Math.sqrt(2*Math.pow(this.cornersize,2))/2;const d=f*Math.cos(c);c=f*Math.sin(c);f=Math.sin(this.theta);const q=Math.cos(this.theta);b.tl.corner={tl:{x:b.tl.x-c,y:b.tl.y-d},tr:{x:b.tl.x+d,y:b.tl.y-c},bl:{x:b.tl.x-d,y:b.tl.y+c},br:{x:b.tl.x+
c,y:b.tl.y+d}};b.tr.corner={tl:{x:b.tr.x-c,y:b.tr.y-d},tr:{x:b.tr.x+d,y:b.tr.y-c},br:{x:b.tr.x+c,y:b.tr.y+d},bl:{x:b.tr.x-d,y:b.tr.y+c}};b.bl.corner={tl:{x:b.bl.x-c,y:b.bl.y-d},bl:{x:b.bl.x-d,y:b.bl.y+c},br:{x:b.bl.x+c,y:b.bl.y+d},tr:{x:b.bl.x+d,y:b.bl.y-c}};b.br.corner={tr:{x:b.br.x+d,y:b.br.y-c},bl:{x:b.br.x-d,y:b.br.y+c},br:{x:b.br.x+c,y:b.br.y+d},tl:{x:b.br.x-c,y:b.br.y-d}};b.ml.corner={tl:{x:b.ml.x-c,y:b.ml.y-d},tr:{x:b.ml.x+d,y:b.ml.y-c},bl:{x:b.ml.x-d,y:b.ml.y+c},br:{x:b.ml.x+c,y:b.ml.y+d}};
b.mt.corner={tl:{x:b.mt.x-c,y:b.mt.y-d},tr:{x:b.mt.x+d,y:b.mt.y-c},bl:{x:b.mt.x-d,y:b.mt.y+c},br:{x:b.mt.x+c,y:b.mt.y+d}};b.mr.corner={tl:{x:b.mr.x-c,y:b.mr.y-d},tr:{x:b.mr.x+d,y:b.mr.y-c},bl:{x:b.mr.x-d,y:b.mr.y+c},br:{x:b.mr.x+c,y:b.mr.y+d}};b.mb.corner={tl:{x:b.mb.x-c,y:b.mb.y-d},tr:{x:b.mb.x+d,y:b.mb.y-c},bl:{x:b.mb.x-d,y:b.mb.y+c},br:{x:b.mb.x+c,y:b.mb.y+d}};b.mtr.corner={tl:{x:b.mtr.x-c+f*this.rotatingPointOffset,y:b.mtr.y-d-q*this.rotatingPointOffset},tr:{x:b.mtr.x+d+f*this.rotatingPointOffset,
y:b.mtr.y-c-q*this.rotatingPointOffset},bl:{x:b.mtr.x-d+f*this.rotatingPointOffset,y:b.mtr.y+c-q*this.rotatingPointOffset},br:{x:b.mtr.x+c+f*this.rotatingPointOffset,y:b.mtr.y+d-q*this.rotatingPointOffset}}};b.getAngle=function(){return 180*this.theta/Math.PI};b.setZindex=function(){for(let c=0;c<a.main.children.length;c++)if(this.id==a.main.children[c].id){var b=a.main.children[c];a.main.children.splice(c,1);break}return" "!=b?(a.main.children.push(b),!0):!1};b.setupCurrentTransform=function(b){const c=
a.main;let f="drag";const g=a.utility.actualPointer(b);if(b=this.findTargetCorner(b))f="ml"===b||"mr"===b?"scaleX":"mt"===b||"mb"===b?"scaleY":"mtr"===b?"rotate":this.hasRotatingPoint?"scale":"rotate";c.currentTransform={target:this,action:f,scaleX:this.scaleX,scaleY:this.scaleY,offsetX:g.x-this.x,offsetY:g.y-this.y,ex:g.x,ey:g.y,x:this.x,y:this.y,theta:this.theta,width:this.width*this.scaleX};c.currentTransform.original={x:this.x,y:this.y}};"text"!=b.type&&b.setCoords();return a.makeDispObject(b)}}}})(window);(function(d){d.Events=function(c){const {vcan:a}=virtualclass.wb[c];a.events=function(){return{bind(a,c,g){a[`on${c}`]=g},findTarget(b){let c;const g=a.main.children;for(let f=g.length;f--;)if(g[f]&&a.virtual_box.containsPoint(b,g[f])){c=g[f];break}if(c&&c.selectable)return c}}}}})(window);(function(d){d.Virtualbox=function(c){const {vcan:a}=virtualclass.wb[c];a.virtual_box={findCrossPoints(a,c,g){let b;let f=0;for(const k in g){var d=g[k];if(!(d.o.y<c&&d.d.y<c||d.o.y>=c&&d.d.y>=c)){if(d.o.x==d.d.x&&d.o.x>=a)var q=d.o.x;else q=(d.d.y-d.o.y)/(d.d.x-d.o.x),b=c-0*a,d=d.o.y-q*d.o.x,q=-(b-d)/(0-q);q>=a&&(f+=1);if(2==f)break}}return f},getImageLines(a,c){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},containsPoint(b,c){var f=
a.utility.getReltivePoint(b),{x:d}=f;({y:f}=f);const m=a.virtual_box.getImageLines(c.oCoords);return(d=a.virtual_box.findCrossPoints(d,f,m))&&1===d%2||c.findTargetCorner(b)?!0:!1}}}})(window);(function(d){d.Interact=function(c){const {vcan:a}=virtualclass.wb[c];a.interact={rotateObject(b,c){const f=a.main.currentTransform,d=a.main.offset;f.target.lockRotation||a.utility.setVal(f.target,"theta",Math.atan2(c-f.y-d.y,b-f.x-d.x)-Math.atan2(f.ey-f.y-d.y,f.ex-f.x-d.x)+f.theta)},scaleObject(b,c,g){const f=a.main.currentTransform,{offset:d}=a.main,n=f.target;if(!n.lockScalingX||!n.lockScalingY){var q=Math.sqrt(Math.pow(f.ey-f.y-d.y,2)+Math.pow(f.ex-f.x-d.x,2));b=Math.sqrt(Math.pow(c-f.y-d.y,2)+
Math.pow(b-f.x-d.x,2));n.scaling=!0;g?"x"!==g||n.lockUniScaling?"y"!==g||n.lockUniScaling||n.lockScalingY||a.utility.setVal(n,"scaleY",f.scaleY*b/q):n.lockScalingX||a.utility.setVal(n,"scaleX",f.scaleX*b/q):(n.lockScalingX||a.utility.setVal(n,"scaleX",f.scaleX*b/q),n.lockScalingY||a.utility.setVal(n,"scaleY",f.scaleY*b/q))}},translateObject(b,c){const {target:f}=a.main.currentTransform;f.lockMovementX||a.utility.setVal(f,"x",b-a.main.currentTransform.offsetX);f.lockMovementY||a.utility.setVal(f,"y",
c-a.main.currentTransform.offsetY);return f}}}})(window);(function(d){d.Rectangle=function(c){({vcan:c}=virtualclass.wb[c]);c.rectangle=function(){return{type:"rectangle",init(a){void 0==a.x&&(a.x=a.ex-a.width/2);void 0==a.y&&(a.y=a.ey-a.height/2);return a},draw(a,b,c){c=-b.width/2;const f=-b.height/2,d=b.width,m=b.height;a.beginPath();a.strokeStyle=void 0!=b.borderColor?`"${b.strokeColor}"`:"#000";a.moveTo(c,f);a.stroke();a.strokeStyle=b.color;a.stroke();a.lineWidth=b.stroke;a.stroke();a.lineTo(c+d,f);a.stroke();a.lineTo(c+d,f+m);a.stroke();a.lineTo(c,
f+m);a.stroke();a.lineTo(c,f);a.stroke();a.fillStyle=void 0!=b.fillColor?b.fillColor:" ";a.closePath();a.stroke();void 0!=b.fillColor&&(a.fillStyle=b.fillColor,a.fill())}}}}})(window);(function(d){d.Oval=function(c){({vcan:c}=virtualclass.wb[c]);c.oval=function(){return{type:"oval",init(a){void 0==a.width&&(a.width=2*a.rx);void 0==a.height&&(a.height=2*a.ry);void 0==a.borderColor&&(a.borderColor="#000000");void 0!=a.fillColor&&(a.fillStyle=a.fillColor);return a},draw(a,b,c){a.beginPath();a.save();const f=2*Math.PI;a.lineWidth=b.stroke;let d=b.ry/b.rx;d=d.toFixed(3);0==d&&(d=.01);a.transform(1,0,0,d,0,0);a.arc(c?b.x:0,c?b.y:0,b.rx,0,f,!1);a.strokeStyle=b.color;a.closePath();void 0!=
b.fillStyle&&(a.fillStyle=b.fillStyle,a.fill());void 0!=b.borderColor&&(a.fillStyle=b.borderColor,a.stroke());a.restore()}}}}})(window);(function(d){d.Triangle=function(c){({vcan:c}=virtualclass.wb[c]);c.triangle=function(){return{type:"triangle",init(a){a.fillStyle=a.fillColor;void 0==a.dRoad&&(a.dRoad="ltr");void 0==a.width&&(a.width=a.ex-a.sx);void 0==a.height&&(a.height=a.ey-a.sy);void 0==a.x&&(a.x=a.ex-a.width/2);void 0==a.y&&(a.y=a.ey-a.height/2);return a},draw(a,b,c){a.beginPath();if("t2b"==b.dRoad){c=b.width/2;var f=b.height/2}else c=-b.width/2,f=-b.height/2;a.lineWidth=b.lineWidth;void 0!=b.borderColor&&(a.strokeStyle=b.borderColor);
a.moveTo(-c,f);a.lineTo(0,-f);a.lineTo(c,f);a.lineWidth=b.stroke;a.strokeStyle=b.color;a.closePath();void 0!=b.fillStyle&&(a.fillStyle=b.fillStyle,a.fill());a.stroke()}}}}})(window);(function(d){d.Line=function(c){({vcan:c}=virtualclass.wb[c]);c.line=function(){return{type:"line",init(a){const b=a.start.x,c=a.start.y,g=a.end.x,d=a.end.y;void 0==a.width&&(a.width=g-b,a.height=d-c);a.x=b+(g-b)/2;a.y=c+(d-c)/2;return a},draw(a,b,c){a.beginPath();c=1===b.width?0:b.width/2;const f=1===b.height?0:b.height/2;a.moveTo(1===b.width?0:-b.width/2,1===b.height?0:-b.height/2);a.lineTo(c,f);a.lineWidth=b.stroke;void 0!=b.lineColor&&(a.strokeStyle=b.lineColor);a.strokeStyle=b.color;a.closePath();
a.stroke()}}}}})(window);(function(d){d.Text=function(c){({vcan:c}=virtualclass.wb[c]);c.text=function(){return{type:"text",init(a){a.lineHeight=1.3;void 0==a.fontSize&&(a.fontSize=30);a.fontSize*=virtualclass.zoom.canvasScale;a.font=`${a.fontSize}px Times New Roman`;return a},draw(a,b,c){({fontSize:c}=b);a.font=`${c}px Times New Roman`;a.fillStyle=b.color;c=b.text.split(/\r?\n/);b.height=this.getTextHeight(a,c,b);b.width=this.getTextWidth(a,c);a.beginPath();for(let f=0,d=c.length;f<d;f++)a.fillText(c[f],-b.width/2,-b.height/
2+f*b.fontSize*b.lineHeight+b.fontSize);a.closePath();b.setCoords()},getTextWidth(a,b){let c=a.measureText(b[0]).width;for(let f=1,d=b.length;f<d;f++){const g=a.measureText(b[f]).width;g>c&&(c=g)}return c},getTextHeight(a,b,c){return c.fontSize*b.length*c.lineHeight},removeTextNode(){const a=document.getElementsByClassName("textBoxContainer");for(let b=0;b<a.length;b++)a[b].parentNode.removeChild(a[b])}}}}})(window);(function(d){d.FreeHandDrawing=function(c){const {vcan:a}=virtualclass.wb[c];a.main.freeHandDrawing=function(b){return{type:"freeDrawing",init(){this.contextTop={};this.isCurrentlyDrawing=!1;this.freeDrawingXPoints=[];this.freeDrawingYPoints=[];this.mdTime=[];this.freeDrawingColor=void 0==b.borderColor?"#0000ff":void 0!=virtualclass.wb[virtualclass.gObj.currWb].activeToolColor?virtualclass.wb[virtualclass.gObj.currWb].activeToolColor:"#0000ff";this.freeDrawingLineWidth=virtualclass.wb[virtualclass.gObj.currWb].currStrkSize*
virtualclass.zoom.canvasScale;return this},fhdStart(a,b,c){c=(new Date).getTime();this.contextTop=a;this.isCurrentlyDrawing=!0;this.freeDrawingXPoints.push(b.x);this.freeDrawingYPoints.push(b.y);this.contextTop.beginPath();this.contextTop.save();this.contextTop.moveTo(b.x,b.y);this.mdTime.push(c);this.contextTop.strokeStyle=this.freeDrawingColor;this.contextTop.lineWidth=this.freeDrawingLineWidth;this.contextTop.lineCap=this.contextTop.lineJoin="round"},fhRendering(a,b){b=(new Date).getTime();this.freeDrawingXPoints.push(a.x);
this.freeDrawingYPoints.push(a.y);this.contextTop.lineTo(a.x,a.y);this.contextTop.stroke();this.mdTime.push(b)},finalizeDrawingPath(c,g,d){(new Date).getTime();this.contextTop.closePath();this.isCurrentlyDrawing=!1;const f=this.utility.min(this.freeDrawingXPoints);g=this.utility.min(this.freeDrawingYPoints);const k=this.utility.max(this.freeDrawingXPoints);d=this.utility.max(this.freeDrawingYPoints);let q=[];var r,z,t;const u=this.freeDrawingXPoints,p=this.freeDrawingYPoints,v=this.mdTime;q.push("M ",
u[0]-f," ",p[0]-g," ",v[0]," ");for(let a=1;r=u[a],z=p[a],t=v[a];a++)q.push("L ",r-f," ",z-g," ",t," ");q=q.join("");if("M 0 0 L 0 0 "!==q)return r=this.freeDrawingXPoints[this.freeDrawingXPoints.length-1],z=this.freeDrawingYPoints[this.freeDrawingYPoints.length-1],t=new a.Path(q,this),t.mp={},t.mp.x=r,t.mp.y=z,t.init(q),t=c.readyObject(t),t.coreObj.type="freeDrawing",t=t.coreObj,t.fill=null,t.stroke=this.freeDrawingColor,t.strokeWidth=this.freeDrawingLineWidth,t.minX=f,t.minY=g,this.utility.objAdd(t),
c=a.utility.setVal(t,"x",f+(k-f)/2),c=a.utility.setVal(c,"y",g+(d-g)/2),c.setCoords(),"object"===typeof b&&this.contextTop.restore(),a.renderAll(this.contextTop),c},utility:{max(a,b){if(a&&0!==a.length){var c=a.length-1,f=b?a[c][b]:a[c];if(b)for(;c--;)a[c][b]>=f&&(f=a[c][b]);else for(;c--;)a[c]>=f&&(f=a[c]);return f}},min(a,b){if(a&&0!==a.length){var c=a.length-1,f=b?a[c][b]:a[c];if(b)for(;c--;)a[c][b]<f&&(f=a[c][b]);else for(;c--;)a[c]<f&&(f=a[c]);return f}},objAdd(b){a.main.children.push(b);return this}}}}}})(window);(function(d){d.Path=function(c){const {vcan:a}=virtualclass.wb[c];a.Path=function(b,c){return{objectType:"path",init(a,b){b=b||{};this.commandLengths={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7};if(!a)throw Error("`path` argument is required");if(this.path=a.match&&a.match(/[a-zA-Z][^a-zA-Z]*/g))return this.initializeFromArray(b),this},initializeFromArray(a){const b="width"in a,c="height"in a;this.path=this._parsePath();b&&c||(this.utility.extend(this,this._parseDimensions()),b&&(this.width=a.width),c&&
(this.height=a.height))},_render(a){let b;const c=-(this.width/2),f=-(this.height/2);for(let d=0,k=this.path.length;d<k;++d){var g=this.path[d];switch(g[0]){case "L":b=g[1];g=g[2];a.lineTo(b+c,g+f);break;case "M":b=g[1],g=g[2],a.moveTo(b+c,g+f)}}},replay_render(a,b,c,f){let g=y=0;switch(b[0]){case "L":g+=b[1];y+=b[2];a.lineTo(g+c,y+f);a.stroke();break;case "M":g+=b[1],y+=b[2],a.moveTo(g+c,y+f)}},render(b,c){b.save();const f=this.transformMatrix;f&&b.transform(f[0],f[1],f[2],f[3],f[4],f[5]);c||a.transform(b,
this);this.overlayFill?b.fillStyle=this.overlayFill:this.fill&&(b.fillStyle=this.fill);this.stroke&&(b.strokeStyle=this.stroke);b.beginPath();this._render(b);this.fill&&b.fill();this.stroke&&(b.strokeStyle=this.stroke,b.lineWidth=this.strokeWidth,b.lineCap=b.lineJoin="round",b.stroke());!c&&this.active&&(this.drawBorders(b),this.hideCorners||this.drawCorners(b));b.restore()},_parsePath(){const a=[];let b;for(var c=0,f,d=this.path.length;c<d;c++){const g=/\d+\s$/.exec(this.path[c]);if(null!=g){var r=
this.path[c].indexOf(g);this.path[c]=this.path[c].substring(0,r)}r=this.path[c];var z=r.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/);r=[r.charAt(0)];f=0;for(var t=z.length;f<t;f++)b=parseFloat(z[f]),isNaN(b)||r.push(b);z=r[0].toLowerCase();z=this.commandLengths[z];if(r.length-1>z)for(let b=1,c=r.length;b<c;b+=z)null==g?a.push([r[0]].concat(r.slice(b,b+z))):(a.push([r[0]].concat(r.slice(b,b+z))),r.push(g),a.push(r));else null!=g&&r.push(g[0]),a.push(r)}return a},_parseDimensions(){const a=
[],b=[];let f,d,q=!1,r,z;this.path.forEach(function(c,g){if(" "!=c[3])var k=c.splice(3);"H"!==c[0]&&(f=0===g?this.utility.getX(c):this.utility.getX(this.path[g-1]));"V"!==c[0]&&(d=0===g?this.utility.getY(c):this.utility.getY(this.path[g-1]));c[0]===c[0].toLowerCase()&&(q=!0);r=q?f+this.utility.getX(c):"V"===c[0]?f:this.utility.getX(c);z=q?d+this.utility.getY(c):"H"===c[0]?d:this.utility.getY(c);g=parseInt(r,10);isNaN(g)||a.push(g);g=parseInt(z,10);isNaN(g)||b.push(g);void 0!=k&&1<=k.length&&c.push(k[0])},
this);var t=c.utility.min(a);t={y:c.utility.min(b)-0,x:t-0,bottom:c.utility.max(b)-0,right:c.utility.max(a)-0};t.width=t.right-t.x;t.height=t.bottom-t.y;return t},utility:{getX(a){return"H"===a[0]?a[1]:a[a.length-2]},getY(a){return"V"===a[0]?a[1]:a[a.length-1]},extend(a,b){for(const c in b)a[c]=b[c];return a}}}}}})(window);(function(d){d.Mouse=function(c){let a;const {vcan:b}=virtualclass.wb[c];b.mouse=function(){return{init(){this.bindHandlers()},bindHandlers(){console.log("Whiteboard ");a=b.main.canvas;const c={mousedown:"mousedown",mousemove:"mousemove",mouseup:"mouseup",touchstart:"touchstart",touchmove:"touchmove",touchend:"touchend"};for(const b in c)"mousedown"==b?a.addEventListener(b,this._mousedown,!1):"mousemove"==b?a.addEventListener(b,this._mousemove,!1):"mouseup"==b?a.addEventListener(b,this._mouseup,!1):
"touchstart"==b?a.addEventListener(b,this._touchstart,!1):"touchmove"==b?a.addEventListener(b,this._touchmove,!1):"touchend"==b&&a.addEventListener(b,this._touchend,!1)},_mousedown(a,c){b.activMouse.mousedown(a,c)},_mousemove(a){b.activMouse.mousemove(a)},_mouseup(a){b.activMouse.mouseup(a)},_touchstart(a,c){b.activMouse.mousedown(a,c);a.preventDefault()},_touchmove(a){b.activMouse.mousemove(a);a.preventDefault()},_touchend(a){b.activMouse.mouseup(a);a.preventDefault()},mousedown(a,c){document.getElementById("congrealogo").classList.add("disbaleOnmousedown");
a.detail.hasOwnProperty("cevent")&&"create"!=b.main.action&&(a=virtualclass.wb[virtualclass.gObj.currWb].utility.putScrollWithCevent(a),a.clientX=b.main.offset.x+a.detail.cevent.x,a.clientY=b.main.offset.y+a.detail.cevent.y,a.x=b.main.offset.x+a.detail.cevent.x,a.y=b.main.offset.y+a.detail.cevent.y,a.pageX=b.main.offset.x+a.detail.cevent.x,a.pageY=b.main.offset.y+a.detail.cevent.y,a.currX=a.detail.cevent.x,a.currY=a.detail.cevent.y);virtualclass.gObj.lastmousemovetime=null;this.moveChunk=[];"move"==
b.main.action?b.main.currentTransform||((c=b.events().findTarget(a))?(0<b.main.children.length&&c.setZindex(),c.downObj=!0,c.setupCurrentTransform(a),b.utility.setActiveObject(c),b.main.currObj=c):b.deactivateAll(),void 0!=c&&b.renderAll(),a.detail.hasOwnProperty("cevent")||(roles.hasControls()&&(a=b.utility.updateCordinate(a)),c=(new Date).getTime(),a=b.makeStackObj(c,"d",a.clientX-b.main.offset.x,a.clientY-b.main.offset.y),a.x/=virtualclass.zoom.canvasScale,a.y/=virtualclass.zoom.canvasScale,virtualclass.wb[virtualclass.gObj.currWb].uid++,
console.log(`uid ${virtualclass.wb[virtualclass.gObj.currWb].uid}`),a.uid=virtualclass.wb[virtualclass.gObj.currWb].uid,b.main.replayObjs.push(a),virtualclass.vutil.beforeSend({repObj:[a],cf:"repObj"}))):"create"==b.main.action&&(a.detail.hasOwnProperty("cevent")&&(a.detail.hasOwnProperty("foundText")&&(a=virtualclass.wb[virtualclass.gObj.currWb].utility.putScrollWithCevent(a)),a.clientX=a.detail.cevent.x+virtualclass.wb[virtualclass.gObj.currWb].vcan.main.offset.x,a.clientY=a.detail.cevent.y+virtualclass.wb[virtualclass.gObj.currWb].vcan.main.offset.y,
a.x=a.detail.cevent.x+virtualclass.wb[virtualclass.gObj.currWb].vcan.main.offset.x,a.y=a.detail.cevent.x+virtualclass.wb[virtualclass.gObj.currWb].vcan.main.offset.y,a.pageX=a.detail.cevent.x+virtualclass.wb[virtualclass.gObj.currWb].vcan.main.offset.x,a.pageY=a.detail.cevent.y+virtualclass.wb[virtualclass.gObj.currWb].vcan.main.offset.y,a.currX=a.detail.cevent.x,a.currY=a.detail.cevent.y),(c=b.events().findTarget(a))&&"text"==c.type&&virtualclass.wb[virtualclass.gObj.currWb].tool.cmd==`t_text${virtualclass.gObj.currWb}`&&
c.setupCurrentTransform(a))},mousemove(a){a.detail.hasOwnProperty("cevent")&&("move"==b.main.action&&(a=virtualclass.wb[virtualclass.gObj.currWb].utility.putScrollWithCevent(a)),a.clientX=b.main.offset.x+a.detail.cevent.x,a.clientY=b.main.offset.y+a.detail.cevent.y,a.x=b.main.offset.x+a.detail.cevent.x,a.y=b.main.offset.y+a.detail.cevent.y,a.pageX=b.main.offset.x+a.detail.cevent.x,a.pageY=b.main.offset.y+a.detail.cevent.y,a.currX=a.detail.cevent.x,a.currY=a.detail.cevent.y);if("move"==b.main.action){const g=
b.main;if(g.currentTransform){var c=b.utility.actualPointer(a),{x:f}=c;({y:c}=c);g.currentTransform.target.isMoving=!0;"rotate"===g.currentTransform.action?(b.interact.rotateObject(f,c),g.currentTransform.target.hasRotatingPoint||b.interact.scaleObject(f,c),a.detail.hasOwnProperty("cevent")||b.optimize.doOptiMize(a)):"scale"===g.currentTransform.action?(a.detail.hasOwnProperty("cevent")||b.optimize.doOptiMize(a),b.interact.scaleObject(f,c)):"scaleX"===g.currentTransform.action?(a.detail.hasOwnProperty("cevent")||
b.optimize.doOptiMize(a),b.interact.scaleObject(f,c,"x")):"scaleY"===g.currentTransform.action?(a.detail.hasOwnProperty("cevent")||b.optimize.doOptiMize(a),b.interact.scaleObject(f,c,"y")):g.currentTransform.target.draggable&&(b.extend({},b.main.currentTransform.target),(new Date).getTime(),1==g.currentTransform.target.downObj&&(b.main.dragMode=!0,g.currentTransform.target.downObj=!1),f=b.interact.translateObject(f,c),a.detail.hasOwnProperty("cevent")||b.optimize.doOptiMize(a),f.setActive(!0),f.setCoords());
if("scaleX"===g.currentTransform.action||"scaleY"===g.currentTransform.action||"rotate"===g.currentTransform.action&&!g.currentTransform.target.hasRotatingPoint)b.main.scaleMode=!0,(new Date).getTime(),g.currentTransform.target.downObj&&(g.currentTransform.target.downObj=!1),f=b.extend({},b.main.currentTransform.target),f.setCoords();b.renderAll()}}},mouseup(a){document.getElementById("congrealogo").classList.remove("disbaleOnmousedown");a.detail.hasOwnProperty("cevent")&&(a.clientX=b.main.offset.x+
a.detail.cevent.x,a.clientY=b.main.offset.y+a.detail.cevent.y,a.x=b.main.offset.x+a.detail.cevent.x,a.y=b.main.offset.y+a.detail.cevent.y,a.pageX=b.main.offset.x+a.detail.cevent.x,a.pageY=b.main.offset.y+a.detail.cevent.y,a.currX=a.detail.cevent.x,a.currY=a.detail.cevent.y);virtualclass.gObj.lastmousemovetime=null;if("move"==b.main.action){b.activMouse.mousemove(a);const g=b.main;if(g.currentTransform){var {target:c}=g.currentTransform;c.scaling&&(c.scaling=!1);for(c=g.children.length;c--;)g.children[c].setCoords()}g.currentTransform=
null;b.renderAll();if(1==b.main.dragMode||1==b.main.scaleMode){roles.hasControls()&&(a=b.utility.updateCordinate(a));var f=(new Date).getTime();(!a.detail.hasOwnProperty("cevent")||a.detail.hasOwnProperty("cevent")&&a.detail.hasOwnProperty("broadCast"))&&b.optimize.calculatePackets(f,"u",a.clientX-b.main.offset.x,a.clientY-b.main.offset.y);b.main.dragMode&&(b.main.dragMode=!1);b.main.scaleMode&&(b.main.scaleMode=!1)}else!a.detail.hasOwnProperty("cevent")&&a.detail.hasOwnProperty("cevent")&&a.detail.hasOwnProperty("broadCast")&&
b.optimize.calculatePackets(f,"u",a.clientX-b.main.offset.x,a.clientY-b.main.offset.y);b.wb.sentPack=!0}}}}}})(window);(function(d){d.readyFreeHandObj=function(c,a){return{init(){this.freesvg=!0;this.fdObj={};this.borderColor=c;this.freeDrawingLineWidth=a},drawStart(a){const {vcan:b}=virtualclass.wb[virtualclass.gObj.currWb];if(1==virtualclass.wb[virtualclass.gObj.currWb].obj.freeDrawObj.freesvg){const c=b.main.canvas.getContext("2d");this.fdObj=b.main.freeHandDrawing({borderColor:this.borderColor,lineWidth:this.freeDrawingLineWidth});this.fdObj.init();this.fdObj.fhdStart(c,b.utility.getReltivePoint(a))}},wb_draw(a){const {vcan:b}=
virtualclass.wb[virtualclass.gObj.currWb];a=b.utility.getReltivePoint(a);this.fdObj.fhRendering(a)},finalizeDraw(a){({vcan:a}=virtualclass.wb[virtualclass.gObj.currWb]);virtualclass.wb[virtualclass.gObj.currWb].prvObj=this.fdObj.finalizeDrawingPath(virtualclass.wb[virtualclass.gObj.currWb].canvas);a.main.children[a.main.children.length-1].mt=virtualclass.wb[virtualclass.gObj.currWb].utility.stringToNumber(virtualclass.wb[virtualclass.gObj.currWb].prvObj.path[virtualclass.wb[virtualclass.gObj.currWb].prvObj.path.length-
1][3])}}}})(window);(function(d){d._replay=function(){return{init(c,a){const {vcan:b}=virtualclass.wb[virtualclass.gObj.currWb];this.objs="undefined"!==typeof a?b.getStates("replayObjs"):recorder.items;this.objNo=0;this.repMode=c;this.callBkfunc="";this.rendering=!1},makeCustomEvent(c,a){c=c.hasOwnProperty("mtext")?{detail:{cevent:{x:c.x,y:c.y,mtext:c.mtext}}}:{detail:{cevent:{x:c.x,y:c.y}}};"undefined"!==typeof a&&(c.detail.broadCast=!0);a=new CustomEvent(event,c);vcan.main.canvas.dispatchEvent(a)},renderObj(c){const {vcan:a}=
virtualclass.wb[virtualclass.gObj.currWb];if("undefined"===typeof this.objs[this.objNo])console.log(`${this.objs}is undefined cannot continue play.`);else{this.rendering=virtualclass.wb[virtualclass.gObj.currWb].drawMode=!0;"undefined"!==typeof c&&(this.callBkfunc=c);if(this.objs[this.objNo].hasOwnProperty("cmd"))virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId=this.objs[this.objNo].uid,virtualclass.wb[virtualclass.gObj.currWb].toolInit(this.objs[this.objNo].cmd,"fromFile",!0);else{let b=
"";if("del"==this.objs[this.objNo].ac)""!=a.main.currObj&&(virtualclass.wb[virtualclass.gObj.currWb].utility.removeSelectedItem(a.main.currObj,!0,!0),console.log("Whiteboard Delete:-  Performing delete operation:-"));else{"d"==this.objs[this.objNo].ac?b="mousedown":"m"==this.objs[this.objNo].ac?b="mousemove":"u"==this.objs[this.objNo].ac&&(b="mouseup");const f=this.objs[this.objNo];f.hasOwnProperty("mtext")?c={detail:{cevent:{x:f.x,y:f.y,mtext:f.mtext}}}:(c={detail:{cevent:{x:f.x,y:f.y}}},f.hasOwnProperty("scy")&&
(c.detail.cevent.scy=f.scy),f.hasOwnProperty("scx")&&(c.detail.cevent.scx=f.scx));f.hasOwnProperty("foundText")&&(c.detail.foundText=!0);c=new CustomEvent(b,c);a.main.canvas.dispatchEvent(c)}virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId=this.objs[this.objNo].uid}this.objs[this.objs.length-1].uid==virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId&&("function"===typeof this.callBkfunc&&this.callBkfunc("callBkfunc"),this.rendering=!1);roles.hasControls()&&virtualclass.wb[virtualclass.gObj.currWb].gObj.tempRepObjs[virtualclass.wb[virtualclass.gObj.currWb].gObj.tempRepObjs.length-
1].uid==virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId&&(a.main.replayObjs=virtualclass.wb[virtualclass.gObj.currWb].gObj.tempRepObjs);if("object"===typeof this.objs[this.objNo+1]){virtualclass.wb[virtualclass.gObj.currWb].replayTime="undefined"!==typeof this.repMode&&"fromBrowser"==this.repMode?0:0==this.objNo?0:this.objs[this.objNo+1].mt-this.objs[this.objNo].mt;this.objNo++;const a=this;setTimeout(()=>{a.renderObj.call(a)},virtualclass.wb[virtualclass.gObj.currWb].replayTime)}}}}}})(window);(function(d){d.readyTextObj=function(){return{init(c){this.currTextObjWrapper=this.prevTextObj="";this.currObject={};this.prvModTextObj={};this.prvCurrTransform={};this.totalBox=this.textWriteMode=0;this.boxContainer=c;this.muser=!1},textUtility(c,a,b){console.log(`Text position x=${c} y=${a}`);this.startPosX=c;this.startPosY=a;const {vcan:f}=virtualclass.wb[virtualclass.gObj.currWb],g=f.main.canvas.getContext("2d");this.textWriteMode++;this.wmode=!0;void 0!=f.main.currentTransform&&""!=f.main.currentTransform?
(this.currObject=f.main.currentTransform.target,void 0!=this.currObject&&"text"==this.currObject.type&&(c={width:300,height:100,x:this.currObject.oCoords.tl.x,y:this.currObject.oCoords.tl.y,text:this.currObject.text},virtualclass.wb[virtualclass.gObj.currWb].utility.clickOutSidebox(this.textWriteMode)||virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.drawTextBoxWrapper(c,this.currObject.id),f.main.currentTransform=""),virtualclass.wb[virtualclass.gObj.currWb].utility.clickOutSidebox(this.textWriteMode)&&
virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.renderText(this.prvCurrTransform,this.prvModTextObj,g),void 0!=this.currObject&&"text"==this.currObject.type&&(this.prvModTextObj={prvObjId:this.currObject.id,prvText:this.currObject.text,x:this.currObject.x,y:this.currObject.y},this.prvTextObj=this.currObject),this.prvCurrTransform=this.currObject):virtualclass.wb[virtualclass.gObj.currWb].utility.clickOutSidebox(this.textWriteMode)?"undefined"!==typeof b?virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.renderText(this.currObject,
this.prvModTextObj,g,b):virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.renderText(this.currObject,this.prvModTextObj,g):(this.totalBox++,c={x:c,y:a,width:300,height:100},"undefined"===typeof b?virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.drawTextBoxWrapper(c,this.totalBox):virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.drawTextBoxWrapper(c,this.totalBox,b))},drawTextBoxWrapper(c,a,b){virtualclass.vutil.removeAllTextWrapper();b=document.createElement("div");b.id=
`box${a}`;b.className="textBoxContainer";b.style.position="absolute";b.style.left=`${c.x-virtualclass.leftPosX}px`;b.style.top=`${c.y-virtualclass.topPosY}px`;if(void 0!=c.x){var f=document.createElement("textarea");f.id=`${b.id}textarea`;f.className="whiteBoardTextBox";f.rows=8;f.cols=41;void 0!=c.text&&""!=c.text&&(f.value=c.text);b.appendChild(f);document.getElementById(this.boxContainer).appendChild(b)}this.prevTextObj=b;this.currTextObjWrapper=c;this.prevTextObj.measure=c;virtualclass.wb[virtualclass.gObj.currWb].utility.toolWrapperDisable(!0);
roles.hasControls()||(f.style.display="none",roles.hasAdmin()&&virtualclass.wb[virtualclass.gObj.currWb].utility.toolWrapperEnable(!0));console.log("Text Command:- Create text wrapper box")},renderText(c,a,b,f){const {vcan:g}=virtualclass.wb[virtualclass.gObj.currWb];if(""!=this.prevTextObj){if(!virtualclass.wb[virtualclass.gObj.currWb].utility.IsObjEmpty(c))for(let a=0;a<g.main.children.length;a++)if(c.id==g.main.children[a].id){g.main.children.splice(a,1);this.currObject="";break}virtualclass.wb[virtualclass.gObj.currWb].utility.IsObjEmpty(c)?
"undefined"!==typeof f?this.finalizeText(b,this.prevTextObj,"undefined",f):this.finalizeText(b,this.prevTextObj):"undefined"!==typeof f?this.finalizeText(b,this.prevTextObj,a,f):this.finalizeText(b,this.prevTextObj,a);virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.wmode=!1}},finalizeText(c,a,b,f){({vcan:b}=virtualclass.wb[virtualclass.gObj.currWb]);const g=document.getElementById(a.id);var d="";if("undefined"===typeof f){f=g.getElementsByTagName("textarea");for(var m=0;m<f.length;m++)if(f[m].id==
`${g.id}textarea`){d=f[m].value;break}}else d=f;c.font="20px Times New Roman";c.fillStyle=this.prvCurrTransform.color;const n=d.split(/\r?\n/);var q=c.measureText(n[0]).width+20;f=15;for(m=1;m<n.length;m++){f+=15;const a=c.measureText(n[m]).width;a>q&&(q=a)}q/=2;m=(new Date).getTime();c={type:"text",text:d,x:a.measure.x+q*virtualclass.zoom.canvasScale,y:a.measure.y+f*virtualclass.zoom.canvasScale,fontSize:20,fontWidth:c.measureText(d).width,mp:{x:a.measure.x,y:a.measure.y}};0==virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.muser&&
(d={mt:m,ac:"d",x:this.startPosX,y:this.startPosY,mtext:c.text},virtualclass.wb[virtualclass.gObj.currWb].uid++,d.uid=virtualclass.wb[virtualclass.gObj.currWb].uid,b.main.replayObjs.push(d),virtualclass.storage.store(JSON.stringify(b.main.replayObjs)),virtualclass.vutil.beforeSend({repObj:[d],cf:"repObj"}));c=virtualclass.wb[virtualclass.gObj.currWb].canvas.readyObject(c);console.log(`Whiteboard text ${c}`);virtualclass.wb[virtualclass.gObj.currWb].canvas.addObject(c);b.main.children[b.main.children.length-
1].mt=m;g.parentNode.removeChild(a);b.renderAll();virtualclass.wb[virtualclass.gObj.currWb].utility.toolWrapperEnable(!0)},finalizeTextIfAny(c){const a=document.getElementById(`canvasWrapper${virtualclass.gObj.currWb}`);null!=a&&0<a.getElementsByClassName("whiteBoardTextBox").length&&("undefined"===typeof c||"undefined"!==typeof c&&0!=virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.textWriteMode%2)&&virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.textUtility()}}}})(window);(function(d){d.keyBoard={prvTool:"",skey:!1,triggerActiveAll(c){c.shiftKey&&(virtualclass.wb[virtualclass.gObj.currWb].keyBoard.skey=!0,virtualclass.wb[virtualclass.gObj.currWb].keyBoard.prvTool=virtualclass.wb[virtualclass.gObj.currWb].tool.cmd,virtualclass.wb[virtualclass.gObj.currWb].toolInit("t_activeall"),c={cmd:"t_activeall",mt:(new Date).getTime()},vcan.main.replayObjs.push(c),virtualclass.vutil.beforeSend({repObj:[c],cf:"repObj"}),virtualclass.wb[virtualclass.gObj.currWb].vcan.main.action=
"move")},triggerdeActiveAll(c){virtualclass.wb[virtualclass.gObj.currWb].keyBoard.skey&&(c=(new Date).getTime(),virtualclass.wb[virtualclass.gObj.currWb].utility.deActiveFrmDragDrop(),virtualclass.wb[virtualclass.gObj.currWb].toolInit(virtualclass.wb[virtualclass.gObj.currWb].keyBoard.prvTool),c={cmd:virtualclass.wb[virtualclass.gObj.currWb].keyBoard.prvTool,mt:c},vcan.main.replayObjs.push(c),virtualclass.vutil.beforeSend({repObj:[c],cf:"repObj"}))}}})(window);(function(d){(function(c){"object"===typeof exports&&"undefined"!==typeof module?module.exports=c():"function"===typeof define&&define.amd?define([],c):("undefined"!==typeof d?d:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).adapter=c()})(()=>function g(a,b,f){function d(k,q){if(!b[k]){if(!a[k]){const a="function"===typeof require&&require;if(!q&&a)return a(k,!0);if(m)return m(k,!0);q=Error(`Cannot find module '${k}'`);throw q.code="MODULE_NOT_FOUND",q;}q=b[k]={exports:{}};
a[k][0].call(q.exports,b=>d(a[k][1][b]||b),q,q.exports,g,a,b,f)}return b[k].exports}var m="function"===typeof require&&require;for(let a=0;a<f.length;a++)d(f[a]);return d}({1:[function(a,b,f){function g(a,b,f,g,d){b=p.writeRtpDescription(a.kind,b);b+=p.writeIceParameters(a.iceGatherer.getLocalParameters());b+=p.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===f?"actpass":d||"active");b+=`a=mid:${a.mid}\r\n`;b=a.rtpSender&&a.rtpReceiver?b+"a=sendrecv\r\n":a.rtpSender?b+"a=sendonly\r\n":
a.rtpReceiver?b+"a=recvonly\r\n":b+"a=inactive\r\n";a.rtpSender&&(f=`msid:${g.id} ${a.rtpSender.track.id}\r\n`,b+=`a=${f}`,b+=`a=ssrc:${a.sendEncodingParameters[0].ssrc} ${f}`,a.sendEncodingParameters[0].rtx&&(b+=`a=ssrc:${a.sendEncodingParameters[0].rtx.ssrc} ${f}`,b+=`a=ssrc-group:FID ${a.sendEncodingParameters[0].ssrc} ${a.sendEncodingParameters[0].rtx.ssrc}\r\n`));b+=`a=ssrc:${a.sendEncodingParameters[0].ssrc} cname:${p.localCName}\r\n`;a.rtpSender&&a.sendEncodingParameters[0].rtx&&(b+=`a=ssrc:${a.sendEncodingParameters[0].rtx.ssrc} cname:${p.localCName}\r\n`);
return b}function k(a,b){let f=!1;a=JSON.parse(JSON.stringify(a));return a.filter(a=>{if(a&&(a.urls||a.url)){let g=a.urls||a.url;a.url&&!a.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");const d="string"===typeof g;d&&(g=[g]);g=g.filter(a=>0!==a.indexOf("turn:")||-1===a.indexOf("transport=udp")||-1!==a.indexOf("turn:[")||f?0===a.indexOf("stun:")&&14393<=b&&-1===a.indexOf("?transport=udp"):f=!0);delete a.url;a.urls=d?g[0]:g;return!!g.length}})}function m(a,b){const f={codecs:[],
headerExtensions:[],fecMechanisms:[]},g=function(a,b){a=parseInt(a,10);for(let f=0;f<b.length;f++)if(b[f].payloadType===a||b[f].preferredPayloadType===a)return b[f]},d=function(a,b,f,d){a=g(a.parameters.apt,f);b=g(b.parameters.apt,d);return a&&b&&a.name.toLowerCase()===b.name.toLowerCase()};a.codecs.forEach(g=>{for(let k=0;k<b.codecs.length;k++){let m=b.codecs[k];if(g.name.toLowerCase()===m.name.toLowerCase()&&g.clockRate===m.clockRate&&("rtx"!==g.name.toLowerCase()||!g.parameters||!m.parameters.apt||
d(g,m,a.codecs,b.codecs))){m=JSON.parse(JSON.stringify(m));m.numChannels=Math.min(g.numChannels,m.numChannels);f.codecs.push(m);m.rtcpFeedback=m.rtcpFeedback.filter(a=>{for(let b=0;b<g.rtcpFeedback.length;b++)if(g.rtcpFeedback[b].type===a.type&&g.rtcpFeedback[b].parameter===a.parameter)return!0;return!1});break}}});a.headerExtensions.forEach(a=>{for(let g=0;g<b.headerExtensions.length;g++){const d=b.headerExtensions[g];if(a.uri===d.uri){f.headerExtensions.push(d);break}}});return f}function n(a,b,
f){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[b][a].indexOf(f)}function q(a,b){const f=a.getRemoteCandidates().find(a=>b.foundation===a.foundation&&b.ip===a.ip&&b.port===a.port&&b.priority===a.priority&&b.protocol===a.protocol&&b.type===a.type);f||a.addRemoteCandidate(b);return!f}function r(a,
b){b.addTrack(a);const f=new Event("addtrack");f.track=a;b.dispatchEvent(f)}function z(a,b){b.removeTrack(a);const f=new Event("removetrack");f.track=a;b.dispatchEvent(f)}function t(a,b,f,g){const k=new Event("track");k.track=b;k.receiver=f;k.transceiver={receiver:f};k.streams=g;d.setTimeout(()=>{a._dispatchEvent("track",k)})}function u(a,b){b=Error(b);b.name=a;return b}const p=a("sdp");b.exports=function(a,b){const f=function(f){const g=this,d=document.createDocumentFragment();["addEventListener",
"removeEventListener","dispatchEvent"].forEach(a=>{g[a]=d[a].bind(d)});this.canTrickleIceCandidates=null;this.needNegotiation=!1;this.localStreams=[];this.remoteStreams=[];this.remoteDescription=this.localDescription=null;this.signalingState="stable";this.iceGatheringState=this.iceConnectionState="new";f=JSON.parse(JSON.stringify(f||{}));this.usingBundle="max-bundle"===f.bundlePolicy;if("negotiate"===f.rtcpMuxPolicy)throw u("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");f.rtcpMuxPolicy||
(f.rtcpMuxPolicy="require");switch(f.iceTransportPolicy){case "all":case "relay":break;default:f.iceTransportPolicy="all"}switch(f.bundlePolicy){case "balanced":case "max-compat":case "max-bundle":break;default:f.bundlePolicy="balanced"}f.iceServers=k(f.iceServers||[],b);this._iceGatherers=[];if(f.iceCandidatePoolSize)for(let b=f.iceCandidatePoolSize;0<b;b--)this._iceGatherers=new a.RTCIceGatherer({iceServers:f.iceServers,gatherPolicy:f.iceTransportPolicy});else f.iceCandidatePoolSize=0;this._config=
f;this.transceivers=[];this._sdpSessionId=p.generateSessionId();this._sdpSessionVersion=0;this._dtlsRole=void 0;this._isClosed=!1};f.prototype.onicecandidate=null;f.prototype.onaddstream=null;f.prototype.ontrack=null;f.prototype.onremovestream=null;f.prototype.onsignalingstatechange=null;f.prototype.oniceconnectionstatechange=null;f.prototype.onicegatheringstatechange=null;f.prototype.onnegotiationneeded=null;f.prototype.ondatachannel=null;f.prototype._dispatchEvent=function(a,b){if(!this._isClosed&&
(this.dispatchEvent(b),"function"===typeof this[`on${a}`]))this[`on${a}`](b)};f.prototype._emitGatheringStateChange=function(){const a=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",a)};f.prototype.getConfiguration=function(){return this._config};f.prototype.getLocalStreams=function(){return this.localStreams};f.prototype.getRemoteStreams=function(){return this.remoteStreams};f.prototype._createTransceiver=function(a){var b=0<this.transceivers.length;a={track:null,
iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:a,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};this.usingBundle&&b?(a.iceTransport=this.transceivers[0].iceTransport,a.dtlsTransport=this.transceivers[0].dtlsTransport):(b=this._createIceAndDtlsTransports(),a.iceTransport=b.iceTransport,a.dtlsTransport=b.dtlsTransport);this.transceivers.push(a);
return a};f.prototype.addTrack=function(b,f){if(this.transceivers.find(a=>a.track===b))throw u("InvalidAccessError","Track already exists.");if("closed"===this.signalingState)throw u("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");let g;for(let a=0;a<this.transceivers.length;a++)this.transceivers[a].track||this.transceivers[a].kind!==b.kind||(g=this.transceivers[a]);g||(g=this._createTransceiver(b.kind));this._maybeFireNegotiationNeeded();-1===this.localStreams.indexOf(f)&&
this.localStreams.push(f);g.track=b;g.stream=f;g.rtpSender=new a.RTCRtpSender(b,g.dtlsTransport);return g.rtpSender};f.prototype.addStream=function(a){const f=this;if(15025<=b)a.getTracks().forEach(b=>{f.addTrack(b,a)});else{const b=a.clone();a.getTracks().forEach((a,f)=>{const g=b.getTracks()[f];a.addEventListener("enabled",a=>{g.enabled=a.enabled})});b.getTracks().forEach(a=>{f.addTrack(a,b)})}};f.prototype.removeTrack=function(b){if(!(b instanceof a.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");
const f=this.transceivers.find(a=>a.rtpSender===b);if(!f)throw u("InvalidAccessError","Sender was not created by this connection.");const {stream:g}=f;f.rtpSender.stop();f.rtpSender=null;f.track=null;f.stream=null;-1===this.transceivers.map(a=>a.stream).indexOf(g)&&-1<this.localStreams.indexOf(g)&&this.localStreams.splice(this.localStreams.indexOf(g),1);this._maybeFireNegotiationNeeded()};f.prototype.removeStream=function(a){const b=this;a.getTracks().forEach(a=>{const f=b.getSenders().find(b=>b.track===
a);f&&b.removeTrack(f)})};f.prototype.getSenders=function(){return this.transceivers.filter(a=>!!a.rtpSender).map(a=>a.rtpSender)};f.prototype.getReceivers=function(){return this.transceivers.filter(a=>!!a.rtpReceiver).map(a=>a.rtpReceiver)};f.prototype._createIceGatherer=function(b,f){const g=this;if(f&&0<b)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();const d=new a.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});
Object.defineProperty(d,"state",{value:"new",writable:!0});this.transceivers[b].candidates=[];this.transceivers[b].bufferCandidates=function(a){const f=!a.candidate||0===Object.keys(a.candidate).length;d.state=f?"completed":"gathering";null!==g.transceivers[b].candidates&&g.transceivers[b].candidates.push(a.candidate)};d.addEventListener("localcandidate",this.transceivers[b].bufferCandidates);return d};f.prototype._gather=function(b,f){const g=this,{iceGatherer:d}=this.transceivers[f];if(!d.onlocalcandidate){var {candidates:k}=
this.transceivers[f];this.transceivers[f].candidates=null;d.removeEventListener("localcandidate",this.transceivers[f].bufferCandidates);d.onlocalcandidate=function(a){if(!(g.usingBundle&&0<f)){var k=new Event("icecandidate");k.candidate={sdpMid:b,sdpMLineIndex:f};var m=a.candidate;if(a=!m||0===Object.keys(m).length){if("new"===d.state||"gathering"===d.state)d.state="completed"}else"new"===d.state&&(d.state="gathering"),m.component=1,k.candidate.candidate=p.writeCandidate(m);m=p.splitSections(g.localDescription.sdp);
m[k.candidate.sdpMLineIndex+1]=a?m[k.candidate.sdpMLineIndex+1]+"a=end-of-candidates\r\n":m[k.candidate.sdpMLineIndex+1]+`a=${k.candidate.candidate}\r\n`;g.localDescription.sdp=m.join("");m=g.transceivers.every(a=>a.iceGatherer&&"completed"===a.iceGatherer.state);"gathering"!==g.iceGatheringState&&(g.iceGatheringState="gathering",g._emitGatheringStateChange());a||g._dispatchEvent("icecandidate",k);m&&(g._dispatchEvent("icecandidate",new Event("icecandidate")),g.iceGatheringState="complete",g._emitGatheringStateChange())}};
a.setTimeout(()=>{k.forEach(a=>{const b=new Event("RTCIceGatherEvent");b.candidate=a;d.onlocalcandidate(b)})},0)}};f.prototype._createIceAndDtlsTransports=function(){const b=this,f=new a.RTCIceTransport(null);f.onicestatechange=function(){b._updateConnectionState()};const g=new a.RTCDtlsTransport(f);g.ondtlsstatechange=function(){b._updateConnectionState()};g.onerror=function(){Object.defineProperty(g,"state",{value:"failed",writable:!0});b._updateConnectionState()};return{iceTransport:f,dtlsTransport:g}};
f.prototype._disposeIceAndDtlsTransports=function(a){var {iceGatherer:b}=this.transceivers[a];b&&(delete b.onlocalcandidate,delete this.transceivers[a].iceGatherer);({iceTransport:b}=this.transceivers[a]);b&&(delete b.onicestatechange,delete this.transceivers[a].iceTransport);({dtlsTransport:b}=this.transceivers[a]);b&&(delete b.ondtlsstatechange,delete b.onerror,delete this.transceivers[a].dtlsTransport)};f.prototype._transceive=function(a,f,g){const d=m(a.localCapabilities,a.remoteCapabilities);
f&&a.rtpSender&&(d.encodings=a.sendEncodingParameters,d.rtcp={cname:p.localCName,compound:a.rtcpParameters.compound},a.recvEncodingParameters.length&&(d.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),a.rtpSender.send(d));g&&a.rtpReceiver&&0<d.codecs.length&&("video"===a.kind&&a.recvEncodingParameters&&15019>b&&a.recvEncodingParameters.forEach(a=>{delete a.rtx}),a.recvEncodingParameters.length&&(d.encodings=a.recvEncodingParameters),d.rtcp={compound:a.rtcpParameters.compound},a.rtcpParameters.cname&&
(d.rtcp.cname=a.rtcpParameters.cname),a.sendEncodingParameters.length&&(d.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),a.rtpReceiver.receive(d))};f.prototype.setLocalDescription=function(a){const b=this;if(!n("setLocalDescription",a.type,this.signalingState)||this._isClosed)return Promise.reject(u("InvalidStateError",`Can not set local ${a.type} in state ${b.signalingState}`));let f,g;if("offer"===a.type)f=p.splitSections(a.sdp),g=f.shift(),f.forEach((a,f)=>{a=p.parseRtpParameters(a);b.transceivers[f].localCapabilities=
a}),this.transceivers.forEach((a,f)=>{b._gather(a.mid,f)});else if("answer"===a.type){f=p.splitSections(b.remoteDescription.sdp);g=f.shift();const a=0<p.matchPrefix(g,"a=ice-lite").length;f.forEach((f,d)=>{const k=b.transceivers[d],{iceGatherer:n}=k,{iceTransport:q}=k,{dtlsTransport:C}=k,{localCapabilities:u}=k,{remoteCapabilities:v}=k;if(!(p.isRejected(f)&&0===p.matchPrefix(f,"a=bundle-only").length||k.isDatachannel)){const F=p.getIceParameters(f,g);f=p.getDtlsParameters(f,g);a&&(f.role="server");
b.usingBundle&&0!==d||(b._gather(k.mid,d),"new"===q.state&&q.start(n,F,a?"controlling":"controlled"),"new"===C.state&&C.start(f));d=m(u,v);b._transceive(k,0<d.codecs.length,!1)}})}this.localDescription={type:a.type,sdp:a.sdp};switch(a.type){case "offer":this._updateSignalingState("have-local-offer");break;case "answer":this._updateSignalingState("stable");break;default:throw new TypeError(`unsupported type "${a.type}"`);}return Promise.resolve()};f.prototype.setRemoteDescription=function(f){const g=
this;if(!n("setRemoteDescription",f.type,this.signalingState)||this._isClosed)return Promise.reject(u("InvalidStateError",`Can not set remote ${f.type} in state ${g.signalingState}`));const d={};this.remoteStreams.forEach(a=>{d[a.id]=a});const k=[],m=p.splitSections(f.sdp),C=m.shift(),v=0<p.matchPrefix(C,"a=ice-lite").length,F=0<p.matchPrefix(C,"a=group:BUNDLE ").length;this.usingBundle=F;const B=p.matchPrefix(C,"a=ice-options:")[0];this.canTrickleIceCandidates=B?0<=B.substr(14).split(" ").indexOf("trickle"):
!1;m.forEach((m,n)=>{var u=p.splitLines(m),t=p.getKind(m),B=p.isRejected(m)&&0===p.matchPrefix(m,"a=bundle-only").length,G=u[0].substr(2).split(" ")[2];u=p.getDirection(m,C);const D=p.parseMsid(m);var H=p.getMid(m)||p.generateIdentifier();if("application"===t&&"DTLS/SCTP"===G)g.transceivers[n]={mid:H,isDatachannel:!0};else{var A=p.parseRtpParameters(m);if(!B){var I=p.getIceParameters(m,C);var O=p.getDtlsParameters(m,C);O.role="client"}G=p.parseRtpEncodingParameters(m);var M=p.parseRtcpParameters(m),
N=0<p.matchPrefix(m,"a=end-of-candidates",C).length,L=p.matchPrefix(m,"a=candidate:").map(a=>p.parseCandidate(a)).filter(a=>1===a.component);("offer"===f.type||"answer"===f.type)&&!B&&F&&0<n&&g.transceivers[n]&&(g._disposeIceAndDtlsTransports(n),g.transceivers[n].iceGatherer=g.transceivers[0].iceGatherer,g.transceivers[n].iceTransport=g.transceivers[0].iceTransport,g.transceivers[n].dtlsTransport=g.transceivers[0].dtlsTransport,g.transceivers[n].rtpSender&&g.transceivers[n].rtpSender.setTransport(g.transceivers[0].dtlsTransport),
g.transceivers[n].rtpReceiver&&g.transceivers[n].rtpReceiver.setTransport(g.transceivers[0].dtlsTransport));if("offer"!==f.type||B)"answer"!==f.type||B||(E=g.transceivers[n],K=E.iceGatherer,t=E.iceTransport,H=E.dtlsTransport,J=E.rtpReceiver,B=E.sendEncodingParameters,m=E.localCapabilities,g.transceivers[n].recvEncodingParameters=G,g.transceivers[n].remoteCapabilities=A,g.transceivers[n].rtcpParameters=M,L.length&&"new"===t.state&&(!v&&!N||F&&0!==n?L.forEach(a=>{q(E.iceTransport,a)}):t.setRemoteCandidates(L)),
F&&0!==n||("new"===t.state&&t.start(K,I,"controlling"),"new"===H.state&&H.start(O)),g._transceive(E,"sendrecv"===u||"recvonly"===u,"sendrecv"===u||"sendonly"===u),!J||"sendrecv"!==u&&"sendonly"!==u?delete E.rtpReceiver:(u=J.track,D?(d[D.stream]||(d[D.stream]=new a.MediaStream),r(u,d[D.stream]),k.push([u,J,d[D.stream]])):(d.default||(d.default=new a.MediaStream),r(u,d.default),k.push([u,J,d.default]))));else{var E=g.transceivers[n]||g._createTransceiver(t);E.mid=H;E.iceGatherer||(E.iceGatherer=g._createIceGatherer(n,
F));L.length&&"new"===E.iceTransport.state&&(!N||F&&0!==n?L.forEach(a=>{q(E.iceTransport,a)}):E.iceTransport.setRemoteCandidates(L));m=a.RTCRtpReceiver.getCapabilities(t);15019>b&&(m.codecs=m.codecs.filter(a=>"rtx"!==a.name));B=E.sendEncodingParameters||[{ssrc:1001*(2*n+2)}];I=!1;if("sendrecv"===u||"sendonly"===u){I=!E.rtpReceiver;var J=E.rtpReceiver||new a.RTCRtpReceiver(E.dtlsTransport,t);if(I){u=J.track;if(!D||"-"!==D.stream)if(D){d[D.stream]||(d[D.stream]=new a.MediaStream,Object.defineProperty(d[D.stream],
"id",{get(){return D.stream}}));Object.defineProperty(u,"id",{get(){return D.track}});var K=d[D.stream]}else d.default||(d.default=new a.MediaStream),K=d.default;K&&(r(u,K),E.associatedRemoteMediaStreams.push(K));k.push([u,J,K])}}else E.rtpReceiver&&E.rtpReceiver.track&&(E.associatedRemoteMediaStreams.forEach(a=>{const b=a.getTracks().find(a=>a.id===E.rtpReceiver.track.id);b&&z(b,a)}),E.associatedRemoteMediaStreams=[]);E.localCapabilities=m;E.remoteCapabilities=A;E.rtpReceiver=J;E.rtcpParameters=
M;E.sendEncodingParameters=B;E.recvEncodingParameters=G;g._transceive(g.transceivers[n],!1,I)}}});void 0===this._dtlsRole&&(this._dtlsRole="offer"===f.type?"active":"passive");this.remoteDescription={type:f.type,sdp:f.sdp};switch(f.type){case "offer":this._updateSignalingState("have-remote-offer");break;case "answer":this._updateSignalingState("stable");break;default:throw new TypeError(`unsupported type "${f.type}"`);}Object.keys(d).forEach(b=>{const f=d[b];if(f.getTracks().length){if(-1===g.remoteStreams.indexOf(f)){g.remoteStreams.push(f);
const b=new Event("addstream");b.stream=f;a.setTimeout(()=>{g._dispatchEvent("addstream",b)})}k.forEach(a=>{f.id===a[2].id&&t(g,a[0],a[1],[f])})}});k.forEach(a=>{a[2]||t(g,a[0],a[1],[])});a.setTimeout(()=>{g&&g.transceivers&&g.transceivers.forEach(a=>{a.iceTransport&&"new"===a.iceTransport.state&&0<a.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),a.iceTransport.addRemoteCandidate({}))})},4E3);return Promise.resolve()};
f.prototype.close=function(){this.transceivers.forEach(a=>{a.iceTransport&&a.iceTransport.stop();a.dtlsTransport&&a.dtlsTransport.stop();a.rtpSender&&a.rtpSender.stop();a.rtpReceiver&&a.rtpReceiver.stop()});this._isClosed=!0;this._updateSignalingState("closed")};f.prototype._updateSignalingState=function(a){this.signalingState=a;a=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",a)};f.prototype._maybeFireNegotiationNeeded=function(){const b=this;"stable"===this.signalingState&&
!0!==this.needNegotiation&&(this.needNegotiation=!0,a.setTimeout(()=>{if(!1!==b.needNegotiation){b.needNegotiation=!1;var a=new Event("negotiationneeded");b._dispatchEvent("negotiationneeded",a)}},0))};f.prototype._updateConnectionState=function(){const a={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(b=>{a[b.iceTransport.state]++;a[b.dtlsTransport.state]++});a.connected+=a.completed;var b="new";if(0<a.failed)b="failed";else if(0<
a.connecting||0<a.checking)b="connecting";else if(0<a.disconnected)b="disconnected";else if(0<a.new)b="new";else if(0<a.connected||0<a.completed)b="connected";b!==this.iceConnectionState&&(this.iceConnectionState=b,b=new Event("iceconnectionstatechange"),this._dispatchEvent("iceconnectionstatechange",b))};f.prototype.createOffer=function(f){const d=this;if(this._isClosed)return Promise.reject(u("InvalidStateError","Can not call createOffer after close"));let k=this.transceivers.filter(a=>"audio"===
a.kind).length,m=this.transceivers.filter(a=>"video"===a.kind).length;if(f){if(f.mandatory||f.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==f.offerToReceiveAudio&&(k=!0===f.offerToReceiveAudio?1:!1===f.offerToReceiveAudio?0:f.offerToReceiveAudio);void 0!==f.offerToReceiveVideo&&(m=!0===f.offerToReceiveVideo?1:!1===f.offerToReceiveVideo?0:f.offerToReceiveVideo)}for(this.transceivers.forEach(a=>{"audio"===a.kind?(k--,0>k&&(a.wantReceive=!1)):"video"===
a.kind&&(m--,0>m&&(a.wantReceive=!1))});0<k||0<m;)0<k&&(this._createTransceiver("audio"),k--),0<m&&(this._createTransceiver("video"),m--);let n=p.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.transceivers.forEach((f,g)=>{const {track:k}=f,{kind:m}=f;var n=p.generateIdentifier();f.mid=n;f.iceGatherer||(f.iceGatherer=d._createIceGatherer(g,d.usingBundle));n=a.RTCRtpSender.getCapabilities(m);15019>b&&(n.codecs=n.codecs.filter(a=>"rtx"!==a.name));n.codecs.forEach(a=>{"H264"===
a.name&&void 0===a.parameters["level-asymmetry-allowed"]&&(a.parameters["level-asymmetry-allowed"]="1")});g=f.sendEncodingParameters||[{ssrc:1001*(2*g+1)}];k&&15019<=b&&"video"===m&&!g[0].rtx&&(g[0].rtx={ssrc:g[0].ssrc+1});f.wantReceive&&(f.rtpReceiver=new a.RTCRtpReceiver(f.dtlsTransport,m));f.localCapabilities=n;f.sendEncodingParameters=g});"max-compat"!==this._config.bundlePolicy&&(n+=`a=group:BUNDLE ${this.transceivers.map(a=>a.mid).join(" ")}\r\n`);n+="a=ice-options:trickle\r\n";this.transceivers.forEach((a,
b)=>{n+=g(a,a.localCapabilities,"offer",a.stream,d._dtlsRole);n+="a=rtcp-rsize\r\n";!a.iceGatherer||"new"===d.iceGatheringState||0!==b&&d.usingBundle||(a.iceGatherer.getLocalCandidates().forEach(a=>{a.component=1;n+=`a=${p.writeCandidate(a)}\r\n`}),"completed"===a.iceGatherer.state&&(n+="a=end-of-candidates\r\n"))});f=new a.RTCSessionDescription({type:"offer",sdp:n});return Promise.resolve(f)};f.prototype.createAnswer=function(){const f=this;if(this._isClosed)return Promise.reject(u("InvalidStateError",
"Can not call createAnswer after close"));let d=p.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.usingBundle&&(d+=`a=group:BUNDLE ${this.transceivers.map(a=>a.mid).join(" ")}\r\n`);const k=p.splitSections(this.remoteDescription.sdp).length-1;this.transceivers.forEach((a,n)=>{if(!(n+1>k))if(a.isDatachannel)d+=`${"m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"}${a.mid}\r\n`;else{if(a.stream){let f;"audio"===a.kind?f=a.stream.getAudioTracks()[0]:"video"===a.kind&&
(f=a.stream.getVideoTracks()[0]);f&&15019<=b&&"video"===a.kind&&!a.sendEncodingParameters[0].rtx&&(a.sendEncodingParameters[0].rtx={ssrc:a.sendEncodingParameters[0].ssrc+1})}n=m(a.localCapabilities,a.remoteCapabilities);!n.codecs.filter(a=>"rtx"===a.name.toLowerCase()).length&&a.sendEncodingParameters[0].rtx&&delete a.sendEncodingParameters[0].rtx;d+=g(a,n,"answer",a.stream,f._dtlsRole);a.rtcpParameters&&a.rtcpParameters.reducedSize&&(d+="a=rtcp-rsize\r\n")}});const n=new a.RTCSessionDescription({type:"answer",
sdp:d});return Promise.resolve(n)};f.prototype.addIceCandidate=function(a){if(a&&""!==a.candidate)if(void 0!==a.sdpMLineIndex||a.sdpMid)if(this.remoteDescription){var {sdpMLineIndex:b}=a;if(a.sdpMid)for(var f=0;f<this.transceivers.length;f++)if(this.transceivers[f].mid===a.sdpMid){b=f;break}var g=this.transceivers[b];if(g){if(g.isDatachannel)return Promise.resolve();f=0<Object.keys(a.candidate).length?p.parseCandidate(a.candidate):{};if("tcp"===f.protocol&&(0===f.port||9===f.port)||f.component&&1!==
f.component)return Promise.resolve();if((0===b||0<b&&g.iceTransport!==this.transceivers[0].iceTransport)&&!q(g.iceTransport,f))return Promise.reject(u("OperationError","Can not add ICE candidate"));g=a.candidate.trim();0===g.indexOf("a=")&&(g=g.substr(2));a=p.splitSections(this.remoteDescription.sdp);a[b+1]+=`a=${f.type?g:"end-of-candidates"}\r\n`;this.remoteDescription.sdp=a.join("")}else return Promise.reject(u("OperationError","Can not add ICE candidate"))}else return Promise.reject(u("InvalidStateError",
"Can not add ICE candidate without a remote description"));else throw new TypeError("sdpMLineIndex or sdpMid required");else for(b=0;b<this.transceivers.length&&(this.transceivers[b].isDatachannel||(this.transceivers[b].iceTransport.addRemoteCandidate({}),a=p.splitSections(this.remoteDescription.sdp),a[b+1]+="a=end-of-candidates\r\n",this.remoteDescription.sdp=a.join(""),!this.usingBundle));b++);return Promise.resolve()};f.prototype.getStats=function(){const a=[];this.transceivers.forEach(b=>{["rtpSender",
"rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(f=>{b[f]&&a.push(b[f].getStats())})});return new Promise(b=>{const f=new Map;Promise.all(a).then(a=>{a.forEach(a=>{Object.keys(a).forEach(b=>{var g=a[b];a[b].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[g.type]||g.type;f.set(b,a[b])})});b(f)})})};let d=["createOffer","createAnswer"];d.forEach(a=>{const b=f.prototype[a];
f.prototype[a]=function(){const a=arguments;return"function"===typeof a[0]||"function"===typeof a[1]?b.apply(this,[arguments[2]]).then(b=>{"function"===typeof a[0]&&a[0].apply(null,[b])},b=>{"function"===typeof a[1]&&a[1].apply(null,[b])}):b.apply(this,arguments)}});d=["setLocalDescription","setRemoteDescription","addIceCandidate"];d.forEach(a=>{const b=f.prototype[a];f.prototype[a]=function(){const a=arguments;return"function"===typeof a[1]||"function"===typeof a[2]?b.apply(this,arguments).then(()=>
{"function"===typeof a[1]&&a[1].apply(null)},b=>{"function"===typeof a[2]&&a[2].apply(null,[b])}):b.apply(this,arguments)}});["getStats"].forEach(a=>{const b=f.prototype[a];f.prototype[a]=function(){const a=arguments;return"function"===typeof a[1]?b.apply(this,arguments).then(()=>{"function"===typeof a[1]&&a[1].apply(null)}):b.apply(this,arguments)}});return f}},{sdp:2}],2:[function(a,b,f){const g={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};g.localCName=g.generateIdentifier();
g.splitLines=function(a){return a.trim().split("\n").map(a=>a.trim())};g.splitSections=function(a){return a.split("\nm=").map((a,b)=>`${(0<b?`m=${a}`:a).trim()}\r\n`)};g.matchPrefix=function(a,b){return g.splitLines(a).filter(a=>0===a.indexOf(b))};g.parseCandidate=function(a){a=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" ");const b={foundation:a[0],component:parseInt(a[1],10),protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],port:parseInt(a[5],10),
type:a[7]};for(let f=8;f<a.length;f+=2)switch(a[f]){case "raddr":b.relatedAddress=a[f+1];break;case "rport":b.relatedPort=parseInt(a[f+1],10);break;case "tcptype":b.tcpType=a[f+1];break;case "ufrag":b.ufrag=a[f+1];b.usernameFragment=a[f+1];break;default:b[a[f]]=a[f+1]}return b};g.writeCandidate=function(a){const b=[];b.push(a.foundation);b.push(a.component);b.push(a.protocol.toUpperCase());b.push(a.priority);b.push(a.ip);b.push(a.port);const {type:f}=a;b.push("typ");b.push(f);"host"!==f&&a.relatedAddress&&
a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort));a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType));a.ufrag&&(b.push("ufrag"),b.push(a.ufrag));return`candidate:${b.join(" ")}`};g.parseIceOptions=function(a){return a.substr(14).split(" ")};g.parseRtpMap=function(a){a=a.substr(9).split(" ");const b={payloadType:parseInt(a.shift(),10)};a=a[0].split("/");b.name=a[0];b.clockRate=parseInt(a[1],10);b.numChannels=3===a.length?
parseInt(a[2],10):1;return b};g.writeRtpMap=function(a){let b=a.payloadType;void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType);return`a=rtpmap:${b} ${a.name}/${a.clockRate}${1!==a.numChannels?`/${a.numChannels}`:""}\r\n`};g.parseExtmap=function(a){a=a.substr(9).split(" ");return{id:parseInt(a[0],10),direction:0<a[0].indexOf("/")?a[0].split("/")[1]:"sendrecv",uri:a[1]}};g.writeExtmap=function(a){return`a=extmap:${a.id||a.preferredId}${a.direction&&"sendrecv"!==a.direction?`/${a.direction}`:
""} ${a.uri}\r\n`};g.parseFmtp=function(a){const b={},f=a.substr(a.indexOf(" ")+1).split(";");for(let g=0;g<f.length;g++)a=f[g].trim().split("="),b[a[0].trim()]=a[1];return b};g.writeFmtp=function(a){let b="",f=a.payloadType;void 0!==a.preferredPayloadType&&(f=a.preferredPayloadType);if(a.parameters&&Object.keys(a.parameters).length){const g=[];Object.keys(a.parameters).forEach(b=>{g.push(`${b}=${a.parameters[b]}`)});b+=`a=fmtp:${f} ${g.join(";")}\r\n`}return b};g.parseRtcpFb=function(a){a=a.substr(a.indexOf(" ")+
1).split(" ");return{type:a.shift(),parameter:a.join(" ")}};g.writeRtcpFb=function(a){let b="",f=a.payloadType;void 0!==a.preferredPayloadType&&(f=a.preferredPayloadType);a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(a=>{b+=`a=rtcp-fb:${f} ${a.type}${a.parameter&&a.parameter.length?` ${a.parameter}`:""}\r\n`});return b};g.parseSsrcMedia=function(a){const b=a.indexOf(" "),f={ssrc:parseInt(a.substr(7,b-7),10)},g=a.indexOf(":",b);-1<g?(f.attribute=a.substr(b+1,g-b-1),f.value=a.substr(g+
1)):f.attribute=a.substr(b+1);return f};g.getMid=function(a){if(a=g.matchPrefix(a,"a=mid:")[0])return a.substr(6)};g.parseFingerprint=function(a){a=a.substr(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1]}};g.getDtlsParameters=function(a,b){return{role:"auto",fingerprints:g.matchPrefix(a+b,"a=fingerprint:").map(g.parseFingerprint)}};g.writeDtlsParameters=function(a,b){let f=`a=setup:${b}\r\n`;a.fingerprints.forEach(a=>{f+=`a=fingerprint:${a.algorithm} ${a.value}\r\n`});return f};g.getIceParameters=
function(a,b){a=g.splitLines(a);a=a.concat(g.splitLines(b));return{usernameFragment:a.filter(a=>0===a.indexOf("a=ice-ufrag:"))[0].substr(12),password:a.filter(a=>0===a.indexOf("a=ice-pwd:"))[0].substr(10)}};g.writeIceParameters=function(a){return`a=ice-ufrag:${a.usernameFragment}\r\n`+`a=ice-pwd:${a.password}\r\n`};g.parseRtpParameters=function(a){const b={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},f=g.splitLines(a)[0].split(" ");for(let k=3;k<f.length;k++){const m=f[k];var d=g.matchPrefix(a,
`a=rtpmap:${m} `)[0];if(d){d=g.parseRtpMap(d);const f=g.matchPrefix(a,`a=fmtp:${m} `);d.parameters=f.length?g.parseFmtp(f[0]):{};d.rtcpFeedback=g.matchPrefix(a,`a=rtcp-fb:${m} `).map(g.parseRtcpFb);b.codecs.push(d);switch(d.name.toUpperCase()){case "RED":case "ULPFEC":b.fecMechanisms.push(d.name.toUpperCase())}}}g.matchPrefix(a,"a=extmap:").forEach(a=>{b.headerExtensions.push(g.parseExtmap(a))});return b};g.writeRtpDescription=function(a,b){let f="";f+=`m=${a} `;f+=0<b.codecs.length?"9":"0";f+=" UDP/TLS/RTP/SAVPF ";
f+=`${b.codecs.map(a=>void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType).join(" ")}\r\n`;f+="c=IN IP4 0.0.0.0\r\n";f+="a=rtcp:9 IN IP4 0.0.0.0\r\n";b.codecs.forEach(a=>{f+=g.writeRtpMap(a);f+=g.writeFmtp(a);f+=g.writeRtcpFb(a)});let d=0;b.codecs.forEach(a=>{a.maxptime>d&&(d=a.maxptime)});0<d&&(f+=`a=maxptime:${d}\r\n`);f+="a=rtcp-mux\r\n";b.headerExtensions.forEach(a=>{f+=g.writeExtmap(a)});return f};g.parseRtpEncodingParameters=function(a){const b=[],f=g.parseRtpParameters(a),
d=-1!==f.fecMechanisms.indexOf("RED"),k=-1!==f.fecMechanisms.indexOf("ULPFEC");var z=g.matchPrefix(a,"a=ssrc:").map(a=>g.parseSsrcMedia(a)).filter(a=>"cname"===a.attribute);const t=0<z.length&&z[0].ssrc;let u;z=g.matchPrefix(a,"a=ssrc-group:FID").map(a=>{a=a.split(" ");a.shift();return a.map(a=>parseInt(a,10))});0<z.length&&1<z[0].length&&z[0][0]===t&&(u=z[0][1]);f.codecs.forEach(a=>{"RTX"===a.name.toUpperCase()&&a.parameters.apt&&(a={ssrc:t,codecPayloadType:parseInt(a.parameters.apt,10),rtx:{ssrc:u}},
b.push(a),d&&(a=JSON.parse(JSON.stringify(a)),a.fec={ssrc:u,mechanism:k?"red+ulpfec":"red"},b.push(a)))});0===b.length&&t&&b.push({ssrc:t});let p=g.matchPrefix(a,"b=");p.length&&(p=0===p[0].indexOf("b=TIAS:")?parseInt(p[0].substr(7),10):0===p[0].indexOf("b=AS:")?950*parseInt(p[0].substr(5),10)-16E3:void 0,b.forEach(a=>{a.maxBitrate=p}));return b};g.parseRtcpParameters=function(a){const b={};var f=g.matchPrefix(a,"a=ssrc:").map(a=>g.parseSsrcMedia(a)).filter(a=>"cname"===a.attribute)[0];f&&(b.cname=
f.value,b.ssrc=f.ssrc);f=g.matchPrefix(a,"a=rtcp-rsize");b.reducedSize=0<f.length;b.compound=0===f.length;a=g.matchPrefix(a,"a=rtcp-mux");b.mux=0<a.length;return b};g.parseMsid=function(a){const b=g.matchPrefix(a,"a=msid:");if(1===b.length)return a=b[0].substr(7).split(" "),{stream:a[0],track:a[1]};a=g.matchPrefix(a,"a=ssrc:").map(a=>g.parseSsrcMedia(a)).filter(a=>"msid"===a.attribute);if(0<a.length)return a=a[0].value.split(" "),{stream:a[0],track:a[1]}};g.generateSessionId=function(){return Math.random().toString().substr(2,
21)};g.writeSessionBoilerplate=function(a,b){b=void 0!==b?b:2;return`${"v=0\r\no=thisisadapterortc "}${a?a:g.generateSessionId()} ${b} IN IP4 127.0.0.1\r\n`+"s=-\r\nt=0 0\r\n"};g.writeMediaSection=function(a,b,f,d){b=g.writeRtpDescription(a.kind,b);b+=g.writeIceParameters(a.iceGatherer.getLocalParameters());b+=g.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===f?"actpass":"active");b+=`a=mid:${a.mid}\r\n`;b=a.direction?b+`a=${a.direction}\r\n`:a.rtpSender&&a.rtpReceiver?b+"a=sendrecv\r\n":
a.rtpSender?b+"a=sendonly\r\n":a.rtpReceiver?b+"a=recvonly\r\n":b+"a=inactive\r\n";a.rtpSender&&(f=`msid:${d.id} ${a.rtpSender.track.id}\r\n`,b+=`a=${f}`,b+=`a=ssrc:${a.sendEncodingParameters[0].ssrc} ${f}`,a.sendEncodingParameters[0].rtx&&(b+=`a=ssrc:${a.sendEncodingParameters[0].rtx.ssrc} ${f}`,b+=`a=ssrc-group:FID ${a.sendEncodingParameters[0].ssrc} ${a.sendEncodingParameters[0].rtx.ssrc}\r\n`));b+=`a=ssrc:${a.sendEncodingParameters[0].ssrc} cname:${g.localCName}\r\n`;a.rtpSender&&a.sendEncodingParameters[0].rtx&&
(b+=`a=ssrc:${a.sendEncodingParameters[0].rtx.ssrc} cname:${g.localCName}\r\n`);return b};g.getDirection=function(a,b){a=g.splitLines(a);for(let b=0;b<a.length;b++)switch(a[b]){case "a=sendrecv":case "a=sendonly":case "a=recvonly":case "a=inactive":return a[b].substr(2)}return b?g.getDirection(b):"sendrecv"};g.getKind=function(a){return g.splitLines(a)[0].split(" ")[0].substr(2)};g.isRejected=function(a){return"0"===a.split(" ",2)[1]};g.parseMLine=function(a){a=g.splitLines(a)[0].split(" ");return{kind:a[0].substr(2),
port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}};"object"===typeof b&&(b.exports=g)},{}],3:[function(a,b,f){f="undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof d?d:{};a=a("./adapter_factory.js");b.exports=a({window:f.window})},{"./adapter_factory.js":4}],4:[function(a,b,f){const g=a("./utils");b.exports=function(b,f){b=b&&b.window;const d={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var k in f)hasOwnProperty.call(f,k)&&(d[k]=f[k]);
f=g.log;k=g.detectBrowser(b);const m=a("./chrome/chrome_shim")||null,z=a("./edge/edge_shim")||null,t=a("./firefox/firefox_shim")||null,u=a("./safari/safari_shim")||null,p=a("./common_shim")||null,v={browserDetails:k,commonShim:p,extractVersion:g.extractVersion,disableLog:g.disableLog,disableWarnings:g.disableWarnings};switch(k.browser){case "chrome":if(!m||!m.shimPeerConnection||!d.shimChrome){f("Chrome shim is not included in this adapter release.");break}f("adapter.js shimming chrome.");v.browserShim=
m;p.shimCreateObjectURL(b);m.shimGetUserMedia(b);m.shimMediaStream(b);m.shimSourceObject(b);m.shimPeerConnection(b);m.shimOnTrack(b);m.shimAddTrackRemoveTrack(b);m.shimGetSendersWithDtmf(b);p.shimRTCIceCandidate(b);p.shimMaxMessageSize(b);p.shimSendThrowTypeError(b);break;case "firefox":if(!t||!t.shimPeerConnection||!d.shimFirefox){f("Firefox shim is not included in this adapter release.");break}f("adapter.js shimming firefox.");v.browserShim=t;p.shimCreateObjectURL(b);t.shimGetUserMedia(b);t.shimSourceObject(b);
t.shimPeerConnection(b);t.shimOnTrack(b);t.shimRemoveStream(b);p.shimRTCIceCandidate(b);p.shimMaxMessageSize(b);p.shimSendThrowTypeError(b);break;case "edge":if(!z||!z.shimPeerConnection||!d.shimEdge){f("MS edge shim is not included in this adapter release.");break}f("adapter.js shimming edge.");v.browserShim=z;p.shimCreateObjectURL(b);z.shimGetUserMedia(b);z.shimPeerConnection(b);z.shimReplaceTrack(b);p.shimMaxMessageSize(b);p.shimSendThrowTypeError(b);break;case "safari":if(!u||!d.shimSafari){f("Safari shim is not included in this adapter release.");
break}f("adapter.js shimming safari.");v.browserShim=u;p.shimCreateObjectURL(b);u.shimRTCIceServerUrls(b);u.shimCallbacksAPI(b);u.shimLocalStreamsAPI(b);u.shimRemoteStreamsAPI(b);u.shimTrackEventTransceiver(b);u.shimGetUserMedia(b);u.shimCreateOfferLegacy(b);p.shimRTCIceCandidate(b);p.shimMaxMessageSize(b);p.shimSendThrowTypeError(b);break;default:f("Unsupported browser!")}return v}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":10,"./safari/safari_shim":12,
"./utils":13}],5:[function(a,b,f){const g=a("../utils.js"),d=g.log;b.exports={shimGetUserMedia:a("./getusermedia"),shimMediaStream(a){a.MediaStream=a.MediaStream||a.webkitMediaStream},shimOnTrack(a){if("object"!==typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype)"RTCRtpTransceiver"in a||g.wrapPeerConnectionEvent(a,"track",a=>{a.transceiver||(a.transceiver={receiver:a.receiver});return a});else{Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},
set(a){this._ontrack&&this.removeEventListener("track",this._ontrack);this.addEventListener("track",this._ontrack=a)}});const b=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){const f=this;f._ontrackpoly||(f._ontrackpoly=function(b){b.stream.addEventListener("addtrack",g=>{let d;d=a.RTCPeerConnection.prototype.getReceivers?f.getReceivers().find(a=>a.track&&a.track.id===g.track.id):{track:g.track};const k=new Event("track");k.track=g.track;
k.receiver=d;k.transceiver={receiver:d};k.streams=[b.stream];f.dispatchEvent(k)});b.stream.getTracks().forEach(g=>{let d;d=a.RTCPeerConnection.prototype.getReceivers?f.getReceivers().find(a=>a.track&&a.track.id===g.id):{track:g};const k=new Event("track");k.track=g;k.receiver=d;k.transceiver={receiver:d};k.streams=[b.stream];f.dispatchEvent(k)})},f.addEventListener("addstream",f._ontrackpoly));return b.apply(f,arguments)}}},shimGetSendersWithDtmf(a){if("object"===typeof a&&a.RTCPeerConnection&&!("getSenders"in
a.RTCPeerConnection.prototype)&&"createDTMFSender"in a.RTCPeerConnection.prototype){const b=function(a,b){return{track:b,get dtmf(){void 0===this._dtmf&&(this._dtmf="audio"===b.kind?a.createDTMFSender(b):null);return this._dtmf},_pc:a}};if(!a.RTCPeerConnection.prototype.getSenders){a.RTCPeerConnection.prototype.getSenders=function(){this._senders=this._senders||[];return this._senders.slice()};const f=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,g){let d=
f.apply(this,arguments);d||(d=b(this,a),this._senders.push(d));return d};const g=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){g.apply(this,arguments);const b=this._senders.indexOf(a);-1!==b&&this._senders.splice(b,1)}}const f=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){const g=this;g._senders=g._senders||[];f.apply(g,[a]);a.getTracks().forEach(a=>{g._senders.push(b(g,a))})};const g=a.RTCPeerConnection.prototype.removeStream;
a.RTCPeerConnection.prototype.removeStream=function(a){const b=this;b._senders=b._senders||[];g.apply(b,[a]);a.getTracks().forEach(a=>{const f=b._senders.find(b=>b.track===a);f&&b._senders.splice(b._senders.indexOf(f),1)})}}else if("object"===typeof a&&a.RTCPeerConnection&&"getSenders"in a.RTCPeerConnection.prototype&&"createDTMFSender"in a.RTCPeerConnection.prototype&&a.RTCRtpSender&&!("dtmf"in a.RTCRtpSender.prototype)){const b=a.RTCPeerConnection.prototype.getSenders;a.RTCPeerConnection.prototype.getSenders=
function(){const a=this,f=b.apply(a,[]);f.forEach(b=>{b._pc=a});return f};Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get(){void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null);return this._dtmf}})}},shimSourceObject(a){const b=a&&a.URL;"object"===typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get(){return this._srcObject},set(a){const f=this;this._srcObject=
a;this.src&&b.revokeObjectURL(this.src);a?(this.src=b.createObjectURL(a),a.addEventListener("addtrack",()=>{f.src&&b.revokeObjectURL(f.src);f.src=b.createObjectURL(a)}),a.addEventListener("removetrack",()=>{f.src&&b.revokeObjectURL(f.src);f.src=b.createObjectURL(a)})):this.src=""}}))},shimAddTrackRemoveTrackWithNative(a){a.RTCPeerConnection.prototype.getLocalStreams=function(){const a=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};return Object.keys(this._shimmedLocalStreams).map(b=>
a._shimmedLocalStreams[b][0])};const b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,f){if(!f)return b.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const g=b.apply(this,arguments);this._shimmedLocalStreams[f.id]?-1===this._shimmedLocalStreams[f.id].indexOf(g)&&this._shimmedLocalStreams[f.id].push(g):this._shimmedLocalStreams[f.id]=[f,g];return g};const f=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=
function(a){const b=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};a.getTracks().forEach(a=>{if(b.getSenders().find(b=>b.track===a))throw new DOMException("Track already exists.","InvalidAccessError");});const g=b.getSenders();f.apply(this,arguments);const d=b.getSenders().filter(a=>-1===g.indexOf(a));this._shimmedLocalStreams[a.id]=[a].concat(d)};const g=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||
{};delete this._shimmedLocalStreams[a.id];return g.apply(this,arguments)};const d=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){const b=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};a&&Object.keys(this._shimmedLocalStreams).forEach(f=>{const g=b._shimmedLocalStreams[f].indexOf(a);-1!==g&&b._shimmedLocalStreams[f].splice(g,1);1===b._shimmedLocalStreams[f].length&&delete b._shimmedLocalStreams[f]});return d.apply(this,arguments)}},shimAddTrackRemoveTrack(a){function b(a,
b){let {sdp:f}=b;Object.keys(a._reverseStreams||[]).forEach(b=>{b=a._reverseStreams[b];f=f.replace(new RegExp(a._streams[b.id].id,"g"),b.id)});return new RTCSessionDescription({type:b.type,sdp:f})}function f(a,b){let {sdp:f}=b;Object.keys(a._reverseStreams||[]).forEach(b=>{b=a._reverseStreams[b];f=f.replace(new RegExp(b.id,"g"),a._streams[b.id].id)});return new RTCSessionDescription({type:b.type,sdp:f})}const d=g.detectBrowser(a);if(a.RTCPeerConnection.prototype.addTrack&&65<=d.version)return this.shimAddTrackRemoveTrackWithNative(a);
const k=a.RTCPeerConnection.prototype.getLocalStreams;a.RTCPeerConnection.prototype.getLocalStreams=function(){const a=this,b=k.apply(this);a._reverseStreams=a._reverseStreams||{};return b.map(b=>a._reverseStreams[b.id])};const m=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(b){const f=this;f._streams=f._streams||{};f._reverseStreams=f._reverseStreams||{};b.getTracks().forEach(a=>{if(f.getSenders().find(b=>b.track===a))throw new DOMException("Track already exists.",
"InvalidAccessError");});if(!f._reverseStreams[b.id]){const g=new a.MediaStream(b.getTracks());f._streams[b.id]=g;f._reverseStreams[g.id]=b;b=g}m.apply(f,[b])};const u=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};u.apply(this,[this._streams[a.id]||a]);delete this._reverseStreams[this._streams[a.id]?this._streams[a.id].id:a.id];delete this._streams[a.id]};a.RTCPeerConnection.prototype.addTrack=
function(b,f){const g=this;if("closed"===g.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var d=[].slice.call(arguments,1);if(1!==d.length||!d[0].getTracks().find(a=>a===b))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(g.getSenders().find(a=>a.track===b))throw new DOMException("Track already exists.","InvalidAccessError");
g._streams=g._streams||{};g._reverseStreams=g._reverseStreams||{};(d=g._streams[f.id])?(d.addTrack(b),Promise.resolve().then(()=>{g.dispatchEvent(new Event("negotiationneeded"))})):(d=new a.MediaStream([b]),g._streams[f.id]=d,g._reverseStreams[d.id]=f,g.addStream(d));return g.getSenders().find(a=>a.track===b)};["createOffer","createAnswer"].forEach(f=>{const g=a.RTCPeerConnection.prototype[f];a.RTCPeerConnection.prototype[f]=function(){const a=this,f=arguments;return arguments.length&&"function"===
typeof arguments[0]?g.apply(a,[function(g){g=b(a,g);f[0].apply(null,[g])},function(a){f[1]&&f[1].apply(null,a)},arguments[2]]):g.apply(a,arguments).then(f=>b(a,f))}});const p=a.RTCPeerConnection.prototype.setLocalDescription;a.RTCPeerConnection.prototype.setLocalDescription=function(){if(!arguments.length||!arguments[0].type)return p.apply(this,arguments);arguments[0]=f(this,arguments[0]);return p.apply(this,arguments)};const v=Object.getOwnPropertyDescriptor(a.RTCPeerConnection.prototype,"localDescription");
Object.defineProperty(a.RTCPeerConnection.prototype,"localDescription",{get(){const a=v.get.apply(this);return""===a.type?a:b(this,a)}});a.RTCPeerConnection.prototype.removeTrack=function(a){const b=this;if("closed"===b.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!a._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(a._pc!==b)throw new DOMException("Sender was not created by this connection.",
"InvalidAccessError");b._streams=b._streams||{};let f;Object.keys(b._streams).forEach(g=>{b._streams[g].getTracks().find(b=>a.track===b)&&(f=b._streams[g])});f&&(1===f.getTracks().length?b.removeStream(b._reverseStreams[f.id]):f.removeTrack(a.track),b.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection(a){const b=g.detectBrowser(a);if(!a.RTCPeerConnection&&a.webkitRTCPeerConnection)a.RTCPeerConnection=function(b,f){d("PeerConnection");b&&b.iceTransportPolicy&&(b.iceTransports=b.iceTransportPolicy);
return new a.webkitRTCPeerConnection(b,f)},a.RTCPeerConnection.prototype=a.webkitRTCPeerConnection.prototype,a.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get(){return a.webkitRTCPeerConnection.generateCertificate}});else{const b=a.RTCPeerConnection;a.RTCPeerConnection=function(a,f){if(a&&a.iceServers){const b=[];for(let f=0;f<a.iceServers.length;f++){let d=a.iceServers[f];!d.hasOwnProperty("urls")&&d.hasOwnProperty("url")?(g.deprecated("RTCIceServer.url",
"RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,b.push(d)):b.push(a.iceServers[f])}a.iceServers=b}return new b(a,f)};a.RTCPeerConnection.prototype=b.prototype;Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get(){return b.generateCertificate}})}const f=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,b,g){const d=this,k=arguments;if(0<arguments.length&&"function"===typeof a)return f.apply(this,arguments);if(0===f.length&&(0===
arguments.length||"function"!==typeof arguments[0]))return f.apply(this,[]);const m=function(a){const b={};a.result().forEach(a=>{const f={id:a.id,timestamp:a.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};a.names().forEach(b=>{f[b]=a.stat(b)});b[f.id]=f});return b},n=function(a){return new Map(Object.keys(a).map(b=>[b,a[b]]))};return 2<=arguments.length?f.apply(this,[function(a){k[1](n(m(a)))},arguments[0]]):(new Promise((a,b)=>{f.apply(d,[function(b){a(n(m(b)))},
b])})).then(b,g)};51>b.version&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(b=>{const f=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){const a=arguments,b=this,g=new Promise((g,d)=>{f.apply(b,[a[0],g,d])});return 2>a.length?g:g.then(()=>{a[1].apply(null,[])},b=>{3<=a.length&&a[2].apply(null,[b])})}});52>b.version&&["createOffer","createAnswer"].forEach(b=>{const f=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){const a=
this;if(1>arguments.length||1===arguments.length&&"object"===typeof arguments[0]){const b=1===arguments.length?arguments[0]:void 0;return new Promise((g,d)=>{f.apply(a,[g,d,b])})}return f.apply(this,arguments)}});["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(b=>{const f=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){arguments[0]=new ("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]);return f.apply(this,arguments)}});
const k=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?k.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}},{"../utils.js":13,"./getusermedia":6}],6:[function(a,b,f){const g=a("../utils.js"),d=g.log;b.exports=function(a){const b=g.detectBrowser(a),f=a&&a.navigator,k=function(a){if("object"!==typeof a||a.mandatory||a.optional)return a;const b={};Object.keys(a).forEach(f=>{if("require"!==f&&
"advanced"!==f&&"mediaSource"!==f){var g="object"===typeof a[f]?a[f]:{ideal:a[f]};void 0!==g.exact&&"number"===typeof g.exact&&(g.min=g.max=g.exact);var d=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==g.ideal){b.optional=b.optional||[];let a={};"number"===typeof g.ideal?(a[d("min",f)]=g.ideal,b.optional.push(a),a={},a[d("max",f)]=g.ideal):a[d("",f)]=g.ideal;b.optional.push(a)}void 0!==g.exact&&"number"!==typeof g.exact?(b.mandatory=b.mandatory||
{},b.mandatory[d("",f)]=g.exact):["min","max"].forEach(a=>{void 0!==g[a]&&(b.mandatory=b.mandatory||{},b.mandatory[d(a,f)]=g[a])})}});a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced));return b},m=function(a,g){if(61<=b.version)return g(a);if((a=JSON.parse(JSON.stringify(a)))&&"object"===typeof a.audio){var m=function(a,b,f){b in a&&!(f in a)&&(a[f]=a[b],delete a[b])};a=JSON.parse(JSON.stringify(a));m(a.audio,"autoGainControl","googAutoGainControl");m(a.audio,"noiseSuppression","googNoiseSuppression");
a.audio=k(a.audio)}if(a&&"object"===typeof a.video){let n=a.video.facingMode;n=n&&("object"===typeof n?n:{ideal:n});m=66>b.version;if(!(!n||"user"!==n.exact&&"environment"!==n.exact&&"user"!==n.ideal&&"environment"!==n.ideal||f.mediaDevices.getSupportedConstraints&&f.mediaDevices.getSupportedConstraints().facingMode&&!m)){delete a.video.facingMode;let b;if("environment"===n.exact||"environment"===n.ideal)b=["back","rear"];else if("user"===n.exact||"user"===n.ideal)b=["front"];if(b)return f.mediaDevices.enumerateDevices().then(f=>
{f=f.filter(a=>"videoinput"===a.kind);let m=f.find(a=>b.some(b=>-1!==a.label.toLowerCase().indexOf(b)));!m&&f.length&&-1!==b.indexOf("back")&&(m=f[f.length-1]);m&&(a.video.deviceId=n.exact?{exact:m.deviceId}:{ideal:m.deviceId});a.video=k(a.video);d(`chrome: ${JSON.stringify(a)}`);return g(a)})}a.video=k(a.video)}d(`chrome: ${JSON.stringify(a)}`);return g(a)},t=function(a){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",
ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[a.name]||a.name,message:a.message,constraint:a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};f.getUserMedia=function(a,b,g){m(a,a=>{f.webkitGetUserMedia(a,b,a=>{g&&g(t(a))})})};const u=function(a){return new Promise((b,g)=>{f.getUserMedia(a,b,g)})};f.mediaDevices||(f.mediaDevices={getUserMedia:u,
enumerateDevices(){return new Promise(b=>{const f={audio:"audioinput",video:"videoinput"};return a.MediaStreamTrack.getSources(a=>{b(a.map(a=>({label:a.label,kind:f[a.kind],deviceId:a.id,groupId:""})))})})},getSupportedConstraints(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}});if(f.mediaDevices.getUserMedia){const a=f.mediaDevices.getUserMedia.bind(f.mediaDevices);f.mediaDevices.getUserMedia=function(b){return m(b,b=>a(b).then(a=>{if(b.audio&&!a.getAudioTracks().length||
b.video&&!a.getVideoTracks().length)throw a.getTracks().forEach(a=>{a.stop()}),new DOMException("","NotFoundError");return a},a=>Promise.reject(t(a))))}}else f.mediaDevices.getUserMedia=function(a){return u(a)};"undefined"===typeof f.mediaDevices.addEventListener&&(f.mediaDevices.addEventListener=function(){d("Dummy mediaDevices.addEventListener called.")});"undefined"===typeof f.mediaDevices.removeEventListener&&(f.mediaDevices.removeEventListener=function(){d("Dummy mediaDevices.removeEventListener called.")})}},
{"../utils.js":13}],7:[function(a,b,f){const g=a("sdp"),d=a("./utils");b.exports={shimRTCIceCandidate(a){if(!(a.RTCIceCandidate&&"foundation"in a.RTCIceCandidate.prototype)){var b=a.RTCIceCandidate;a.RTCIceCandidate=function(a){"object"===typeof a&&a.candidate&&0===a.candidate.indexOf("a=")&&(a=JSON.parse(JSON.stringify(a)),a.candidate=a.candidate.substr(2));const f=new b(a);a=g.parseCandidate(a.candidate);const d=Object.assign(f,a);d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,
sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}};return d};d.wrapPeerConnectionEvent(a,"icecandidate",b=>{b.candidate&&Object.defineProperty(b,"candidate",{value:new a.RTCIceCandidate(b.candidate),writable:"false"});return b})}},shimCreateObjectURL(a){const b=a&&a.URL;if("object"===typeof a&&a.HTMLMediaElement&&"srcObject"in a.HTMLMediaElement.prototype&&b.createObjectURL&&b.revokeObjectURL){var f=b.createObjectURL.bind(b),g=b.revokeObjectURL.bind(b),k=new Map,m=0;b.createObjectURL=
function(a){if("getTracks"in a){const b=`polyblob:${++m}`;k.set(b,a);d.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream");return b}return f(a)};b.revokeObjectURL=function(a){g(a);k.delete(a)};var u=Object.getOwnPropertyDescriptor(a.HTMLMediaElement.prototype,"src");Object.defineProperty(a.HTMLMediaElement.prototype,"src",{get(){return u.get.apply(this)},set(a){this.srcObject=k.get(a)||null;return u.set.apply(this,[a])}});var p=a.HTMLMediaElement.prototype.setAttribute;a.HTMLMediaElement.prototype.setAttribute=
function(){2===arguments.length&&"src"===`${arguments[0]}`.toLowerCase()&&(this.srcObject=k.get(arguments[1])||null);return p.apply(this,arguments)}}},shimMaxMessageSize(a){if(!a.RTCSctpTransport&&a.RTCPeerConnection){var b=d.detectBrowser(a);"sctp"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp}});var f=function(a){a=g.splitSections(a.sdp);a.shift();return a.some(a=>(a=g.parseMLine(a))&&"application"===
a.kind&&-1!==a.protocol.indexOf("SCTP"))},k=function(a){a=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===a||2>a.length)return-1;a=parseInt(a[1],10);return a!==a?-1:a},m=function(a){let f=65536;"firefox"===b.browser&&(f=57>b.version?-1===a?16384:2147483637:57===b.version?65535:65536);return f},t=function(a,f){let d=65536;"firefox"===b.browser&&57===b.version&&(d=65535);a=g.matchPrefix(a.sdp,"a=max-message-size:");0<a.length?d=parseInt(a[0].substr(19),10):"firefox"===b.browser&&-1!==f&&(d=
2147483637);return d},u=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){this._sctp=null;if(f(arguments[0])){var a=k(arguments[0]),b=m(a);a=t(arguments[0],a);let f;f=0===b&&0===a?Number.POSITIVE_INFINITY:0===b||0===a?Math.max(b,a):Math.min(b,a);b={};Object.defineProperty(b,"maxMessageSize",{get(){return f}});this._sctp=b}return u.apply(this,arguments)}}},shimSendThrowTypeError(a){const b=a.RTCPeerConnection.prototype.createDataChannel;
a.RTCPeerConnection.prototype.createDataChannel=function(){const a=this,f=b.apply(a,arguments),g=f.send;f.send=function(){const b=arguments[0];if((b.length||b.size||b.byteLength)>a.sctp.maxMessageSize)throw new DOMException(`Message too large (can send a maximum of ${a.sctp.maxMessageSize} bytes)`,"TypeError");return g.apply(this,arguments)};return f}}}},{"./utils":13,sdp:2}],8:[function(a,b,f){const g=a("../utils"),d=a("rtcpeerconnection-shim");b.exports={shimGetUserMedia:a("./getusermedia"),shimPeerConnection(a){const b=
g.detectBrowser(a);if(a.RTCIceGatherer&&(a.RTCIceCandidate||(a.RTCIceCandidate=function(a){return a}),a.RTCSessionDescription||(a.RTCSessionDescription=function(a){return a}),15025>b.version)){const b=Object.getOwnPropertyDescriptor(a.MediaStreamTrack.prototype,"enabled");Object.defineProperty(a.MediaStreamTrack.prototype,"enabled",{set(a){b.set.call(this,a);const f=new Event("enabled");f.enabled=a;this.dispatchEvent(f)}})}!a.RTCRtpSender||"dtmf"in a.RTCRtpSender.prototype||Object.defineProperty(a.RTCRtpSender.prototype,
"dtmf",{get(){void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new a.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null));return this._dtmf}});a.RTCPeerConnection=d(a,b.version)},shimReplaceTrack(a){!a.RTCRtpSender||"replaceTrack"in a.RTCRtpSender.prototype||(a.RTCRtpSender.prototype.replaceTrack=a.RTCRtpSender.prototype.setTrack)}}},{"../utils":13,"./getusermedia":9,"rtcpeerconnection-shim":1}],9:[function(a,b,f){b.exports=function(a){a=a&&a.navigator;const b=function(a){return{name:{PermissionDeniedError:"NotAllowedError"}[a.name]||
a.name,message:a.message,constraint:a.constraint,toString(){return this.name}}},f=a.mediaDevices.getUserMedia.bind(a.mediaDevices);a.mediaDevices.getUserMedia=function(a){return f(a).catch(a=>Promise.reject(b(a)))}}},{}],10:[function(a,b,f){const g=a("../utils");b.exports={shimGetUserMedia:a("./getusermedia"),shimOnTrack(a){"object"!==typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},
set(a){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly));this.addEventListener("track",this._ontrack=a);this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.getTracks().forEach(b=>{const f=new Event("track");f.track=b;f.receiver={track:b};f.transceiver={receiver:f.receiver};f.streams=[a.stream];this.dispatchEvent(f)})}.bind(this))}});"object"===typeof a&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&
!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})},shimSourceObject(a){"object"===typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get(){return this.mozSrcObject},set(a){this.mozSrcObject=a}}))},shimPeerConnection(a){const b=g.detectBrowser(a);if("object"===typeof a&&(a.RTCPeerConnection||a.mozRTCPeerConnection)){a.RTCPeerConnection||
(a.RTCPeerConnection=function(f,g){if(38>b.version&&f&&f.iceServers){const a=[];for(let b=0;b<f.iceServers.length;b++){const g=f.iceServers[b];if(g.hasOwnProperty("urls"))for(let b=0;b<g.urls.length;b++){const f={url:g.urls[b]};0===g.urls[b].indexOf("turn")&&(f.username=g.username,f.credential=g.credential);a.push(f)}else a.push(f.iceServers[b])}f.iceServers=a}return new a.mozRTCPeerConnection(f,g)},a.RTCPeerConnection.prototype=a.mozRTCPeerConnection.prototype,a.mozRTCPeerConnection.generateCertificate&&
Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get(){return a.mozRTCPeerConnection.generateCertificate}}),a.RTCSessionDescription=a.mozRTCSessionDescription,a.RTCIceCandidate=a.mozRTCIceCandidate);["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(b=>{const f=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){arguments[0]=new ("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]);return f.apply(this,arguments)}});
var f=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?f.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var d=function(a){const b=new Map;Object.keys(a).forEach(f=>{b.set(f,a[f]);b[f]=a[f]});return b},k={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},z=a.RTCPeerConnection.prototype.getStats;
a.RTCPeerConnection.prototype.getStats=function(a,f,g){return z.apply(this,[a||null]).then(a=>{48>b.version&&(a=d(a));if(53>b.version&&!f)try{a.forEach(a=>{a.type=k[a.type]||a.type})}catch(B){if("TypeError"!==B.name)throw B;a.forEach((b,f)=>{a.set(f,Object.assign({},b,{type:k[b.type]||b.type}))})}return a}).then(f,g)}}},shimRemoveStream(a){!a.RTCPeerConnection||"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){const b=this;g.deprecated("removeStream",
"removeTrack");this.getSenders().forEach(f=>{f.track&&-1!==a.getTracks().indexOf(f.track)&&b.removeTrack(f)})})}}},{"../utils":13,"./getusermedia":11}],11:[function(a,b,f){const g=a("../utils"),d=g.log;b.exports=function(a){const b=g.detectBrowser(a),f=a&&a.navigator;a=a&&a.MediaStreamTrack;const k=function(a){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[a.name]||a.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[a.message]||
a.message,constraint:a.constraint,toString(){return this.name+(this.message&&": ")+this.message}}},m=function(a,g,m){const n=function(a){if("object"!==typeof a||a.require)return a;const b=[];Object.keys(a).forEach(f=>{if("require"!==f&&"advanced"!==f&&"mediaSource"!==f){var g=a[f]="object"===typeof a[f]?a[f]:{ideal:a[f]};void 0===g.min&&void 0===g.max&&void 0===g.exact||b.push(f);void 0!==g.exact&&("number"===typeof g.exact?g.min=g.max=g.exact:a[f]=g.exact,delete g.exact);if(void 0!==g.ideal){a.advanced=
a.advanced||[];const b={};b[f]="number"===typeof g.ideal?{min:g.ideal,max:g.ideal}:g.ideal;a.advanced.push(b);delete g.ideal;Object.keys(g).length||delete a[f]}}});b.length&&(a.require=b);return a};a=JSON.parse(JSON.stringify(a));38>b.version&&(d(`spec: ${JSON.stringify(a)}`),a.audio&&(a.audio=n(a.audio)),a.video&&(a.video=n(a.video)),d(`ff37: ${JSON.stringify(a)}`));return f.mozGetUserMedia(a,g,a=>{m(k(a))})},t=function(a){return new Promise((b,f)=>{m(a,b,f)})};f.mediaDevices||(f.mediaDevices={getUserMedia:t,
addEventListener(){},removeEventListener(){}});f.mediaDevices.enumerateDevices=f.mediaDevices.enumerateDevices||function(){return new Promise(a=>{a([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})};if(41>b.version){const a=f.mediaDevices.enumerateDevices.bind(f.mediaDevices);f.mediaDevices.enumerateDevices=function(){return a().then(void 0,a=>{if("NotFoundError"===a.name)return[];throw a;})}}if(49>b.version){const a=f.mediaDevices.getUserMedia.bind(f.mediaDevices);
f.mediaDevices.getUserMedia=function(b){return a(b).then(a=>{if(b.audio&&!a.getAudioTracks().length||b.video&&!a.getVideoTracks().length)throw a.getTracks().forEach(a=>{a.stop()}),new DOMException("The object can not be found here.","NotFoundError");return a},a=>Promise.reject(k(a)))}}if(!(55<b.version&&"autoGainControl"in f.mediaDevices.getSupportedConstraints())){const b=function(a,b,f){b in a&&!(f in a)&&(a[f]=a[b],delete a[b])},g=f.mediaDevices.getUserMedia.bind(f.mediaDevices);f.mediaDevices.getUserMedia=
function(a){"object"===typeof a&&"object"===typeof a.audio&&(a=JSON.parse(JSON.stringify(a)),b(a.audio,"autoGainControl","mozAutoGainControl"),b(a.audio,"noiseSuppression","mozNoiseSuppression"));return g(a)};if(a&&a.prototype.getSettings){const f=a.prototype.getSettings;a.prototype.getSettings=function(){const a=f.apply(this,arguments);b(a,"mozAutoGainControl","autoGainControl");b(a,"mozNoiseSuppression","noiseSuppression");return a}}if(a&&a.prototype.applyConstraints){const f=a.prototype.applyConstraints;
a.prototype.applyConstraints=function(a){"audio"===this.kind&&"object"===typeof a&&(a=JSON.parse(JSON.stringify(a)),b(a,"autoGainControl","mozAutoGainControl"),b(a,"noiseSuppression","mozNoiseSuppression"));return f.apply(this,[a])}}}f.getUserMedia=function(a,d,k){if(44>b.version)return m(a,d,k);g.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia");f.mediaDevices.getUserMedia(a).then(d,k)}}},{"../utils":13}],12:[function(a,b,f){const g=a("../utils");b.exports={shimLocalStreamsAPI(a){if("object"===
typeof a&&a.RTCPeerConnection){"getLocalStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getLocalStreams=function(){this._localStreams||(this._localStreams=[]);return this._localStreams});"getStreamById"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getStreamById=function(a){let b=null;this._localStreams&&this._localStreams.forEach(f=>{f.id===a&&(b=f)});this._remoteStreams&&this._remoteStreams.forEach(f=>{f.id===a&&(b=f)});return b});if(!("addStream"in a.RTCPeerConnection.prototype)){const b=
a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addStream=function(a){this._localStreams||(this._localStreams=[]);-1===this._localStreams.indexOf(a)&&this._localStreams.push(a);const f=this;a.getTracks().forEach(g=>{b.call(f,g,a)})};a.RTCPeerConnection.prototype.addTrack=function(a,f){f&&(this._localStreams?-1===this._localStreams.indexOf(f)&&this._localStreams.push(f):this._localStreams=[f]);return b.call(this,a,f)}}"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=
function(a){this._localStreams||(this._localStreams=[]);const b=this._localStreams.indexOf(a);if(-1!==b){this._localStreams.splice(b,1);var f=this,g=a.getTracks();this.getSenders().forEach(a=>{-1!==g.indexOf(a.track)&&f.removeTrack(a)})}})}},shimRemoteStreamsAPI(a){"object"===typeof a&&a.RTCPeerConnection&&("getRemoteStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in a.RTCPeerConnection.prototype||
Object.defineProperty(a.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(a){const b=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly));this.addEventListener("addstream",this._onaddstream=a);this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(a=>{b._remoteStreams||(b._remoteStreams=[]);if(!(0<=b._remoteStreams.indexOf(a))){b._remoteStreams.push(a);var f=
new Event("addstream");f.stream=a;b.dispatchEvent(f)}})})}}))},shimCallbacksAPI(a){if("object"===typeof a&&a.RTCPeerConnection){({prototype:a}=a.RTCPeerConnection);var {createOffer:b}=a,{createAnswer:f}=a,{setLocalDescription:g}=a,{setRemoteDescription:d}=a,{addIceCandidate:k}=a;a.createOffer=function(a,f){const g=b.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);if(!f)return g;g.then(a,f);return Promise.resolve()};a.createAnswer=function(a,b){const g=f.apply(this,[2<=arguments.length?
arguments[2]:arguments[0]]);if(!b)return g;g.then(a,b);return Promise.resolve()};var t=function(a,b,f){a=g.apply(this,[a]);if(!f)return a;a.then(b,f);return Promise.resolve()};a.setLocalDescription=t;t=function(a,b,f){a=d.apply(this,[a]);if(!f)return a;a.then(b,f);return Promise.resolve()};a.setRemoteDescription=t;t=function(a,b,f){a=k.apply(this,[a]);if(!f)return a;a.then(b,f);return Promise.resolve()};a.addIceCandidate=t}},shimGetUserMedia(a){const b=a&&a.navigator;b.getUserMedia||(b.webkitGetUserMedia?
b.getUserMedia=b.webkitGetUserMedia.bind(b):b.mediaDevices&&b.mediaDevices.getUserMedia&&(b.getUserMedia=function(a,f,g){b.mediaDevices.getUserMedia(a).then(f,g)}))},shimRTCIceServerUrls(a){const b=a.RTCPeerConnection;a.RTCPeerConnection=function(a,f){if(a&&a.iceServers){const b=[];for(let f=0;f<a.iceServers.length;f++){let d=a.iceServers[f];!d.hasOwnProperty("urls")&&d.hasOwnProperty("url")?(g.deprecated("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,
b.push(d)):b.push(a.iceServers[f])}a.iceServers=b}return new b(a,f)};a.RTCPeerConnection.prototype=b.prototype;"generateCertificate"in a.RTCPeerConnection&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get(){return b.generateCertificate}})},shimTrackEventTransceiver(a){"object"===typeof a&&a.RTCPeerConnection&&"receiver"in a.RTCTrackEvent.prototype&&!a.RTCTransceiver&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})},shimCreateOfferLegacy(a){const b=
a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(a){if(a){var f=this.getTransceivers().find(a=>a.sender.track&&"audio"===a.sender.track.kind);!1===a.offerToReceiveAudio&&f?"sendrecv"===f.direction?f.setDirection?f.setDirection("sendonly"):f.direction="sendonly":"recvonly"===f.direction&&(f.setDirection?f.setDirection("inactive"):f.direction="inactive"):!0!==a.offerToReceiveAudio||f||this.addTransceiver("audio");f=this.getTransceivers().find(a=>a.sender.track&&
"video"===a.sender.track.kind);!1===a.offerToReceiveVideo&&f?"sendrecv"===f.direction?f.setDirection("sendonly"):"recvonly"===f.direction&&f.setDirection("inactive"):!0!==a.offerToReceiveVideo||f||this.addTransceiver("video")}return b.apply(this,arguments)}}}},{"../utils":13}],13:[function(a,b,f){function g(a,b,f){return(a=a.match(b))&&a.length>=f&&parseInt(a[f],10)}let k=!0,m=!0;b.exports={extractVersion:g,wrapPeerConnectionEvent:function(a,b,f){if(a.RTCPeerConnection){a=a.RTCPeerConnection.prototype;
var g=a.addEventListener;a.addEventListener=function(a,d){if(a!==b)return g.apply(this,arguments);const k=function(a){d(f(a))};this._eventMap=this._eventMap||{};this._eventMap[d]=k;return g.apply(this,[a,k])};var d=a.removeEventListener;a.removeEventListener=function(a,f){if(a!==b||!this._eventMap||!this._eventMap[f])return d.apply(this,arguments);const g=this._eventMap[f];delete this._eventMap[f];return d.apply(this,[a,g])};Object.defineProperty(a,`on${b}`,{get(){return this[`_on${b}`]},set(a){this[`_on${b}`]&&
(this.removeEventListener(b,this[`_on${b}`]),delete this[`_on${b}`]);a&&this.addEventListener(b,this[`_on${b}`]=a)}})}},disableLog(a){return"boolean"!==typeof a?Error(`Argument type: ${typeof a}. Please use a boolean.`):(k=a)?"adapter.js logging disabled":"adapter.js logging enabled"},disableWarnings(a){if("boolean"!==typeof a)return Error(`Argument type: ${typeof a}. Please use a boolean.`);m=!a;return`adapter.js deprecation warnings ${a?"disabled":"enabled"}`},log(){"object"!==typeof d||k||"undefined"!==
typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)},deprecated(a,b){m&&console.warn(`${a} is deprecated, please use ${b} instead.`)},detectBrowser(a){const b=a&&a.navigator,f={browser:null,version:null};if("undefined"===typeof a||!a.navigator)return f.browser="Not a browser.",f;b.mozGetUserMedia?(f.browser="firefox",f.version=g(b.userAgent,/Firefox\/(\d+)\./,1)):b.webkitGetUserMedia?(f.browser="chrome",f.version=g(b.userAgent,/Chrom(e|ium)\/(\d+)\./,2)):b.mediaDevices&&
b.userAgent.match(/Edge\/(\d+).(\d+)$/)?(f.browser="edge",f.version=g(b.userAgent,/Edge\/(\d+).(\d+)$/,2)):b.mediaDevices&&b.userAgent.match(/AppleWebKit\/(\d+)\./)?(f.browser="safari",f.version=g(b.userAgent,/AppleWebKit\/(\d+)\./,1)):f.browser="Not a supported browser.";return f}}},{}]},{},[3])(3));d.adapter=function(){return{RTCPeerConnection:null,webrtcDetectedBrowser:null,init(c){virtualclass.system.getusermedia&&(c.mozGetUserMedia?this.attachMediaStream=function(a,b){this.videoAdd=!0;const c=
d.URL||d.webkitURL;a.src=c?c.createObjectURL(b):b;a.play()}:c.webkitGetUserMedia?(console.log("This appears to be Chrome"),this.attachMediaStream=function(a,b){const c=d.URL||d.webkitURL;a.src=c?c.createObjectURL(b):b;a.play();this.videoAdd=!0},webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=
function(){return this.localStreams},webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})):c.mediaDevices?this.attachMediaStream=function(a,b){const c=d.URL||d.webkitURL;a.src=c?c.createObjectURL(b):b;a.play()}:console.log("Browser does not appear to be WebRTC-capable"));return c}}}})(window);function Resampler(d,c,a,b,f){this.fromSampleRate=d;this.toSampleRate=c;this.channels=a|0;this.outputBufferSize=b;this.noReturn=!!f;this.initialize()}
Resampler.prototype.initialize=function(){if(0<this.fromSampleRate&&0<this.toSampleRate&&0<this.channels)this.fromSampleRate==this.toSampleRate?(this.resampler=this.bypassResampler,this.ratioWeight=1):(this.fromSampleRate<this.toSampleRate?(this.compileLinearInterpolationFunction(),this.lastWeight=1):(this.compileMultiTapFunction(),this.tailExists=!1,this.lastWeight=0),this.ratioWeight=this.fromSampleRate/this.toSampleRate,this.initializeBuffers());else throw Error("Invalid settings specified for the resampler.");
};Resampler.prototype.compileLinearInterpolationFunction=function(){let d=`var bufferLength = buffer.length;\
	var outLength = this.outputBufferSize;\
	if ((bufferLength % ${this.channels}) == 0) {\
		if (bufferLength > 0) {\
			var ratioWeight = this.ratioWeight;\
			var weight = this.lastWeight;\
			var firstWeight = 0;\
			var secondWeight = 0;\
			var sourceOffset = 0;\
			var outputOffset = 0;\
			var outputBuffer = this.outputBuffer;\
			for (; weight < 1; weight += ratioWeight) {\
				secondWeight = weight % 1;\
				firstWeight = 1 - secondWeight;`;for(var c=0;c<this.channels;++c)d+=`outputBuffer[outputOffset++] = (this.lastOutput[${c}] * firstWeight) + (buffer[${c}] * secondWeight);`;d+=`}\
			weight -= 1;\
			for (bufferLength -= ${this.channels}, sourceOffset = Math.floor(weight) * ${this.channels}; outputOffset < outLength && sourceOffset < bufferLength;) {\
				secondWeight = weight % 1;\
				firstWeight = 1 - secondWeight;`;for(c=0;c<this.channels;++c)d+=`outputBuffer[outputOffset++] = (buffer[sourceOffset${0<c?` + ${c}`:""}] * firstWeight) + (buffer[sourceOffset + ${this.channels+c}] * secondWeight);`;d+=`weight += ratioWeight;\
				sourceOffset = Math.floor(weight) * ${this.channels};\
			}`;for(c=0;c<this.channels;++c)d+=`this.lastOutput[${c}] = buffer[sourceOffset++];`;this.resampler=Function("buffer",d+'this.lastWeight = weight % 1;\t\t\treturn this.bufferSlice(outputOffset);\t\t}\t\telse {\t\t\treturn (this.noReturn) ? 0 : [];\t\t}\t}\telse {\t\tthrow(new Error("Buffer was of incorrect sample length."));\t}')};Resampler.prototype.compileMultiTapFunction=function(){let d=`var bufferLength = buffer.length;\
	var outLength = this.outputBufferSize;\
	if ((bufferLength % ${this.channels}) == 0) {\
		if (bufferLength > 0) {\
			var ratioWeight = this.ratioWeight;\
			var weight = 0;`;for(var c=0;c<this.channels;++c)d+=`var output${c} = 0;`;d+="var actualPosition = 0;\t\t\tvar amountToNext = 0;\t\t\tvar alreadyProcessedTail = !this.tailExists;\t\t\tthis.tailExists = false;\t\t\tvar outputBuffer = this.outputBuffer;\t\t\tvar outputOffset = 0;\t\t\tvar currentPosition = 0;\t\t\tdo {\t\t\t\tif (alreadyProcessedTail) {\t\t\t\t\tweight = ratioWeight;";for(c=0;c<this.channels;++c)d+=`output${c} = 0;`;d+="}\t\t\t\telse {\t\t\t\t\tweight = this.lastWeight;";for(c=0;c<
this.channels;++c)d+=`output${c} = this.lastOutput[${c}];`;d+="alreadyProcessedTail = true;\t\t\t\t}\t\t\t\twhile (weight > 0 && actualPosition < bufferLength) {\t\t\t\t\tamountToNext = 1 + actualPosition - currentPosition;\t\t\t\t\tif (weight >= amountToNext) {";for(c=0;c<this.channels;++c)d+=`output${c} += buffer[actualPosition++] * amountToNext;`;d+="currentPosition = actualPosition;\t\t\t\t\t\tweight -= amountToNext;\t\t\t\t\t}\t\t\t\t\telse {";for(c=0;c<this.channels;++c)d+=`output${c} += buffer[actualPosition${0<
c?` + ${c}`:""}] * weight;`;d+="currentPosition += weight;\t\t\t\t\t\tweight = 0;\t\t\t\t\t\tbreak;\t\t\t\t\t}\t\t\t\t}\t\t\t\tif (weight == 0) {";for(c=0;c<this.channels;++c)d+=`outputBuffer[outputOffset++] = output${c} / ratioWeight;`;d+="}\t\t\t\telse {\t\t\t\t\tthis.lastWeight = weight;";for(c=0;c<this.channels;++c)d+=`this.lastOutput[${c}] = output${c};`;this.resampler=Function("buffer",d+'this.tailExists = true;\t\t\t\t\tbreak;\t\t\t\t}\t\t\t} while (actualPosition < bufferLength && outputOffset < outLength);\t\t\treturn this.bufferSlice(outputOffset);\t\t}\t\telse {\t\t\treturn (this.noReturn) ? 0 : [];\t\t}\t}\telse {\t\tthrow(new Error("Buffer was of incorrect sample length."));\t}')};
Resampler.prototype.bypassResampler=function(d){return this.noReturn?(this.outputBuffer=d,d.length):d};Resampler.prototype.bufferSlice=function(d){if(this.noReturn)return d;try{return this.outputBuffer.subarray(0,d)}catch(c){try{return this.outputBuffer.length=d,this.outputBuffer}catch(a){return this.outputBuffer.slice(0,d)}}};
Resampler.prototype.initializeBuffers=function(){try{this.outputBuffer=new Float32Array(this.outputBufferSize),this.lastOutput=new Float32Array(this.channels)}catch(d){this.outputBuffer=[],this.lastOutput=[]}};(function(d){let c,a,b,f,g;const k={},m={},n={};let q,r=[],z=0,t,u,p,v=c=!1,B;d.media=function(){return{isChannelReady:"",isStarted:"",pc:[],cn:0,ba:!1,bb:!1,bc:!1,bNotRender:!1,remoteStream:"",turnReady:"",videoControlId:"videoContainer",videoContainerId:"videos",CONFIG:{width:{max:268},height:{max:142},frameRate:{max:6}},audioPlayerNode:null,audioCreatorNode:null,util:{imageReplaceWithVideo(a,b){var c=chatContainerEvent.elementFromShadowDom(`#ml${a}`);chatContainerEvent.elementFromShadowDom(`#ml${a}`)&&
c.classList.remove("userImg");if(null!=c){a=c.getElementsByTagName("a")[0];c=a.getElementsByTagName("span")[0]||a.getElementsByTagName("img")[0];a.classList.contains("hasVideo")||(a.className+=" hasVideo");const f=a.querySelector(".videoWrapper");null==c&&void 0==c&&null!=f?(a.removeChild(f),a.appendChild(b)):a.replaceChild(b,c)}else console.log("chatUser is Null")}},audioVisual:{init(){this.audioCtx=new (d.AudioContext||d.webkitAudioContext);this.analyser=this.audioCtx.createAnalyser();this.analyser.minDecibels=
-90;this.analyser.maxDecibels=-10;this.analyser.smoothingTimeConstant=.85;this.distortion=this.audioCtx.createWaveShaper();this.gainNode=this.audioCtx.createGain();this.biquadFilter=this.audioCtx.createBiquadFilter();this.convolver=this.audioCtx.createConvolver()},readyForVisual(a){this.source=this.audioCtx.createMediaStreamSource(a);this.source.connect(this.analyser);this.analyser.connect(this.distortion);this.distortion.connect(this.biquadFilter);this.biquadFilter.connect(this.convolver);this.convolver.connect(this.gainNode);
this.gainNode.connect(this.audioCtx.destination)}},workerAudioSendOnmessage(){workerAudioSend.onmessage=function(a){a.data.hasOwnProperty("cmd")&&("muteAudio"===a.data.cmd?g.audio.notifiyMuteAudio():"unMuteAudio"===a.data.cmd&&g.audio.notifiyUnmuteAudio())}},audio:{audioStreamArr:[],tempAudioStreamArr:[],recordingLength:0,bufferSize:0,encMode:"alaw",recordAudio:!1,rec:"",otherSound:!1,audioNodes:[],sdElem:"silenceDetect",snode:[],workletAudioRec:!1,aChunksPlay:!1,audioContextReady:!1,init(){const a=
document.getElementById("speakerPressOnce").dataset.audioPlaying;virtualclass.gObj.audMouseDown="true"==a;this.graph={height:56,width:4,average:0,display(){const a=g.video;roles.hasControls()&&this._display(a.tempVidCont,this.height-this.height*this.average/100)},_display(a,b){a.beginPath();a.moveTo(this.width,this.height);a.lineTo(this.width,b);a.lineWidth=this.width;a.strokeStyle="rgba(32, 37, 247, 0.8)";a.closePath();a.stroke()}};this.attachFunctionsToAudioWidget()},initAudiocontext(){this.hasOwnProperty("Html5Audio")||
virtualclass.gObj.meetingMode||(this.Html5Audio={audioContext:new (d.AudioContext||d.webkitAudioContext)},null==virtualclass.media.audio.Html5Audio.audioContext&&alert("audio context is null"),this.resampler=new Resampler(virtualclass.media.audio.Html5Audio.audioContext.sampleRate,8E3,1,4096),this.audioContextReady=virtualclass.gObj.isAudioContextReady=!0,virtualclass.system.mediaDevices.hasMicrophone&&!virtualclass.isPlayMode&&null!=g.video.tempStream&&(virtualclass.media.stream=g.video.tempStream,
virtualclass.media.audio._maniPulateStream()))},initScriptNode(){for(let a=0;a<this.snode.length;a++)this._playWithFallback(this.snode[a]);this.snode=[]},attachAudioStopHandler(a){a=a.getAudioTracks()[0];null!=a&&(a.onended=this.notifiyMuteAudio,a.onmute=this.notifiyMuteAudio,a.onunmute=this.notifiyUnmuteAudio)},notifiyMuteAudio(){this.notifyAudioMute=!0;virtualclass.gObj.audMouseDown&&(virtualclass.gObj.mutedomop?virtualclass.gObj.hasOwnProperty("mutedomopto")&&null!==virtualclass.gObj.mutedomopto||
(virtualclass.gObj.mutedomopto=setTimeout(()=>{g.audio.notifiyMuteAudioDom()},2E3)):g.audio.notifiyMuteAudioDom())},notifiyUnmuteAudio(){this.notifyAudioMute=!1;virtualclass.gObj.mutedomop=!0;virtualclass.gObj.hasOwnProperty("mutedomopto")&&(clearTimeout(virtualclass.gObj.mutedomopto),virtualclass.gObj.mutedomopto=null);g.audio.notifiyUnmuteAudioDom()},notifiyUnmuteAudioDom(){this.hasOwnProperty("speakerPressOnce")&&null!=this.speakerPressOnce&&this.speakerPressOnce.classList.contains("audioMute")&&
this.speakerPressOnce.classList.remove("audioMute")},notifiyMuteAudioDom(){this.hasOwnProperty("speakerPressOnce")||(this.speakerPressOnce=document.querySelector("#speakerPressOnce"));null==this.speakerPressOnce||this.speakerPressOnce.classList.contains("audioMute")||this.speakerPressOnce.classList.add("audioMute")},muteButtonToogle(){const a=document.querySelector("#speakerPressOnce");null!=a&&a.dataset.audioPlaying&&"true"==a.dataset.audioPlaying&&a.click()},audioSend(a,b){if(virtualclass.gObj.audMouseDown&&
io.webSocketConnected()){var c=virtualclass.vutil.breakintobytes(virtualclass.gObj.uid,8);c=new Int8Array([101,c[0],c[1],c[2],c[3]]);const f=new Int8Array(a.length+c.length);f.set(c);f.set(a,c.length);ioAdapter.sendBinary(f);virtualclass.media.audio.setAudioStatus(b)}else virtualclass.media.audio.setAudioStatus("stop")},setAudioStatus(a){if("undefined"===typeof b)var b=document.getElementById("audioWidget").getElementsByClassName(this.sdElem)[0];b.setAttribute("data-silence-detect",a)},makeIconNotDraggable(a,
b){const c=document.getElementById(a,b).getContext("2d"),f=new Image;f.onload=function(){c.drawImage(f,0,0)};f.src=`${d.whiteboardPath}images/${b}`},attachFunctionsToAudioWidget(){const a=document.getElementById("audioWidget").getElementsByClassName("audioTool");for(let b=0;b<a.length;b++)"speakerPressOnce"!==a[b].id&&"speakerPressing"===a[b].id&&this.attachSpeakToStudent(a[b].id),"speakerPressing"!==a[b].id&&a[b].addEventListener("click",this.audioToolInit)},audioToolInit(){if(virtualclass.gObj.meetingMode){var a=
document.getElementById(this.id);"false"==a.getAttribute("data-audio-playing")&&"undefined"===typeof alwaysDisable?(virtualclass.vutil.audioStatus(a,"true"),a=!0):(virtualclass.vutil.audioStatus(a,"false"),a=!1);virtualclass.multiVideo.setAudioStatus(a)}else a=virtualclass.media.audio,"speakerPressOnce"===this.id?a.clickOnceSpeaker(this.id):"silenceDetect"===this.id&&(this.getElementsByTagName("a"),a.sd?(a.sd=!1,this.className=`${this.className} sdDisable`):(a.sd=!0,this.className=`${this.className} sdEnable`))},
attachSpeakToStudent(a){const b=this,c=document.getElementById(a);let f=!1;c.addEventListener("mousedown",()=>{if(!virtualclass.gObj.audMouseDown){b.studentSpeak(c);f=!0;var a=document.getElementById("speakerPressonceLabel");null!=a&&virtualclass.vutil.elemHasAnyClass("speakerPressonceLabel")&&a.classList.contains("silenceDetect")&&(a.removeAttribute("data-silence-detect"),a.classList.remove("silenceDetect"),0>=a.classList.length&&a.removeAttribute("class"),a=a.getElementsByTagName("i")[0],null!=
a&&(a.setAttribute("data-silence-detect","stop"),a.className+=" silenceDetect"))}});c.addEventListener("mouseup",()=>{if(f){b.studentNotSpeak(c);f=!1;const a=document.getElementById("speakerPressonceLabel"),g=a.getElementsByTagName("i")[0];"undefined"!==typeof g.classList&&g.classList.contains("silenceDetect")&&(g.classList.remove("silenceDetect"),0>=g.classList.length&&g.removeAttribute("class"),a.removeAttribute("data-silence-detect"));null!==a&&(a.setAttribute("data-silence-detect","stop"),a.className=
`${g.className} silenceDetect`)}})},attachAudioPressOnce(){const a=document.getElementById("speakerPressOnce");a.setAttribute("data-audio-playing","false");const b=this;a.addEventListener("click",()=>{b.clickOnceSpeaker.call(b,a.id)})},clickOnceSpeaker(a,b){a=document.getElementById(a);document.getElementById("speakerPressing");const c=a.getElementsByClassName("congtooltip")[0];"false"===a.getAttribute("data-audio-playing")&&"undefined"===typeof b?(this.studentSpeak(),a.setAttribute("data-audio-playing",
"true"),c.setAttribute("data-title",virtualclass.lang.getString("audioEnable")),a.className="audioTool active"):(this.studentNotSpeak(),a.setAttribute("data-audio-playing","false"),c&&c.setAttribute("data-title",virtualclass.lang.getString("audioDisable")),a.className="audioTool deactive")},initProcessorEvent(){virtualclass.gObj.hasOwnProperty("initProcessorTime")&&clearInterval(virtualclass.gObj.initProcessorTime);virtualclass.gObj.initProcessorTime=setInterval(()=>{g.audio.notifyAudioMute&&g.audio.notifiyMuteAudio()},
2E3)},studentSpeak(a){this.notifyAudioMute=!0;this.initProcessorEvent();"undefined"!==typeof a&&(document.getElementById(`${a.id}Button`),a.classList.remove("deactive"),a.classList.add("active"));virtualclass.gObj.audMouseDown=!0;workerAudioSend.postMessage({cmd:"audioMouseDown",msg:{adMouseDown:virtualclass.gObj.audMouseDown}});virtualclass.vutil.beforeSend({sad:!0,cf:"sad"})},studentNotSpeak(a){virtualclass.gObj.hasOwnProperty("audMouseDown")&&virtualclass.gObj.audMouseDown&&("undefined"!==typeof a&&
(document.getElementById(`${a.id}Button`),a.classList.remove("active"),a.classList.add("deactive")),a=document.getElementById("speakerPressOnce"),a.setAttribute("data-audio-playing","false"),a.className="audioTool deactive",virtualclass.gObj.audMouseDown=!1,workerAudioSend.postMessage({cmd:"audioMouseDown",msg:{audMouseDown:virtualclass.gObj.audMouseDown}}),virtualclass.media.audio.setAudioStatus("stop"),virtualclass.vutil.beforeSend({sad:!1,cf:"sad"},null,!0))},ab2str(a){return String.fromCharCode.apply(null,
new Int8Array(a))},str2ab(a){var b=new ArrayBuffer(a.length);b=new Int8Array(b);for(let c=0,f=a.length;c<f;c++)b[c]=a.charCodeAt(c);return b},recorderProcess(b){(new Date).getTime();if(!c&&(this.recordAudio||(this.recordingLength+=this.bufferSize),virtualclass.gObj.audMouseDown&&io.webSocketConnected())){b=this.resampler.resampler(b);l=b.length;for(a=new Int16Array(l);l--;)a[l]=32767*Math.min(1,b[l]);b=a;const c=this.encodeAudio(b);this.silenceDetection(c,b)}},recorderProcessFallback(a){workerAudioSend.postMessage({cmd:"rawAudio",
msg:a.inputBuffer.getChannelData(0)})},encodeAudio(a){return G711.encode(a,{alaw:"alaw"===this.encMode})},audioForTesting(a){a=G711.encode(a,{alaw:"alaw"===this.encMode});virtualclass.gObj.audioForTest.push(a);virtualclass.gObj[virtualclass.gObj.uid]=!1},initPlayWithFallback(){this.hasOwnProperty("Html5Audio")||this.Html5Audio||(this.Html5Audio={audioContext:new (d.AudioContext||d.webkitAudioContext)});if(!v){const a=new MessageChannel;workerIO.postMessage({cmd:"workerAudioRec"},[a.port1]);workerAudioRec.postMessage({cmd:"workerIO",
sampleRate:this.Html5Audio.audioContext.sampleRate},[a.port2]);workerAudioRec.postMessage({cmd:"audioWorklet",msg:!1});workerAudioRec.onmessage=function(a){switch(a.data.cmd){case "noAudioWorklet":virtualclass.media.audio.queueWithFalback(a.data.msg.data,a.data.msg.uid);virtualclass.media.audio.playWithFallback(a.data.msg.uid);break;default:console.log("do nothing")}};v=!0;virtualclass.gObj.audioRecWorkerReady=!0}},initPlay(){this.hasOwnProperty("Html5Audio")||this.Html5Audio||(this.Html5Audio={audioContext:new (d.AudioContext||
d.webkitAudioContext)});"object"!==typeof u&&g.audio.Html5Audio.audioContext.audioWorklet.addModule(workletAudioRecBlob).then(()=>{if("undefined"===typeof p){u=new AudioWorkletNode(g.audio.Html5Audio.audioContext,"worklet-audio-rec");g.audio.Html5Audio.MediaStreamDest=g.audio.Html5Audio.audioContext.createMediaStreamDestination();u.connect(g.audio.Html5Audio.audioContext.destination);"Chrome"===virtualclass.system.mybrowser.name&&(console.log("==== Chrome after change"),g.audio.bug_687574_callLocalPeers());
var a=new MessageChannel;workerIO.postMessage({cmd:"workerAudioRec"},[a.port1]);workerAudioRec.postMessage({cmd:"workerIO",sampleRate:g.audio.Html5Audio.audioContext.sampleRate},[a.port2]);a=new MessageChannel;workerAudioRec.postMessage({cmd:"workletAudioRec"},[a.port1]);u.port.postMessage({cmd:"workerAudioRec"},[a.port2]);workerAudioRec.postMessage({cmd:"audioWorklet",msg:!0});p=!0;virtualclass.gObj.audioRecWorkerReady=!0}})},playWithFallback(a){"suspended"===this.Html5Audio.audioContext.state?this.hasOwnProperty("audioSuspendTime")||
(this.audioSuspendTime=setTimeout(()=>{"suspended"===this.Html5Audio.audioContext.state&&(this.snode.push(a),null===virtualclass.gObj.requestToScriptNode&&(this.Html5Audio.audioContext.resume(),virtualclass.gesture.initAudioResume(a),virtualclass.gObj.requestToScriptNode=!0),delete this.audioSuspendTime)},2E3)):(this._playWithFallback(),this.audioSuspendTime&&delete this.audioSuspendTime)},_playWithFallback(){const a=this;if(null===virtualclass.media.audioPlayerNode||"closed"===virtualclass.media.audioPlayerNode.context.state)console.log("script processor node is created"),
null!==virtualclass.media.audioPlayerNode&&virtualclass.media.audioPlayerNode.disconnect(),virtualclass.media.audioPlayerNode=this.Html5Audio.audioContext.createScriptProcessor(4096,1,1),B=0,virtualclass.media.audioPlayerNode.onaudioprocess=function(b){b=b.outputBuffer.getChannelData(0);const c=a.getMergedAudio();if(null!==c&&void 0!==c){for(var f=0;f<c.length;f++)b[f]=c[f];B=c[4095]}else for(f=0;f<b.length;f++)b[f]=B},virtualclass.media.audioPlayerNode.connect(this.Html5Audio.audioContext.destination)},
queueWithFalback(a,b){null==k[b]&&(k[b]=[]);null==n[b]&&(n[b]=[]);for(let c=0;c<a.length;c++)n[b].push(a[c]);for(;4096<=n[b].length;)a=n[b].splice(0,4096),k[b].push(new Float32Array(a))},getMergedAudio(){r=[];z=0;for(q in k){var a=this.getAudioChunks(q);if(null!=a)if(z++,1===z)for(var b=0;4096>b;b++)r[b]=a[b];else for(b=0;4096>b;b++)r[b]+=a[b]}if(1===z)return r;if(1<z){for(a=0;4096>a;a++)r[a]/=z;return r}},getAudioChunks(a){if(null!==k){if(9<=k[a].length){for(;3<=k[a].length;)k[a].shift();m[a]=!0;
return k[a].shift()}if(2<=k[a].length||0<k[a].length&&!0===m[a])return m[a]=!0,k[a].shift();m[a]=!1;0===k[a].length&&delete k[a]}},_maniPulateStream(){console.log("Manipulate stream");this.triggermaniPulateStream=!0;const a=virtualclass.media;setTimeout(()=>{a.detectAudioWorklet()?a.audio.maniPulateStream():a.audio.maniPulateStreamWithFallback()},1E3)},maniPulateStream(){const {stream:a}=g;"undefined"!==typeof t&&t.disconnect();"undefined"!==typeof a&&null!=a&&(console.log("Audio worklet init add module"),
g.audio.Html5Audio.audioContext.audioWorklet.addModule(workletAudioSendBlob).then(()=>{console.log("== init audio worklet 3");var b=g.audio.Html5Audio.audioContext.createMediaStreamSource(a);const f=g.audio.Html5Audio.audioContext.createBiquadFilter();f.type="lowpass";f.frequency.value=2E3;b.connect(f);t=new AudioWorkletNode(g.audio.Html5Audio.audioContext,"worklet-audio-send");t.onprocessorerror=function(a){g.audio.notifiyMuteAudio()};f.connect(t);t.connect(g.audio.Html5Audio.audioContext.destination);
b=new MessageChannel;workerAudioSend.postMessage({cmd:"workerIO",sampleRate:this.Html5Audio.audioContext.sampleRate,uid:virtualclass.gObj.uid},[b.port1]);workerIO.postMessage({cmd:"workerAudioSend"},[b.port2]);b=new MessageChannel;workerAudioSend.postMessage({cmd:"audioWorkletSend",msg:{repMode:c}},[b.port1]);t.port.postMessage({cmd:"workerAudioSend"},[b.port2]);g.workerAudioSendOnmessage();console.log("Audio worklet ready audio worklet module")}).catch(a=>{g.audio.notifiyMuteAudio()}))},maniPulateStreamWithFallback(){if("undefined"!==
typeof g.stream&&null!=g.stream){var {stream:a}=g;a=g.audio.Html5Audio.audioContext.createMediaStreamSource(a);g.audio.bufferSize=4096;virtualclass.media.audioCreatorNode=g.audio.Html5Audio.audioContext.createScriptProcessor(g.audio.bufferSize,1,1);virtualclass.media.audioCreatorNode.onaudioprocess=g.audio.recorderProcessFallback.bind(g.audio);const b=g.audio.Html5Audio.audioContext.createBiquadFilter();b.type="lowpass";b.frequency.value=2E3;a.connect(b);b.connect(virtualclass.media.audioCreatorNode);
virtualclass.media.audioCreatorNode.connect(g.audio.Html5Audio.audioContext.destination);a=new MessageChannel;workerAudioSend.postMessage({cmd:"workerIO",uid:virtualclass.gObj.uid,sampleRate:g.audio.Html5Audio.audioContext.sampleRate},[a.port1]);workerIO.postMessage({cmd:"workerAudioSend"},[a.port2]);g.workerAudioSendOnmessage()}else console.log("No stream is found")},updateInfo(){this.audioStreamArr=[];c=this.recordAudio=!1},extractData(a){a=new Int8Array(a);return[virtualclass.vutil.numValidateFour(a[1],
a[2],a[3],a[4]),a.subarray(5,a.length)]},removeAudioFromLocalStorage(){console.log("Remove audio from local storage");localStorage.removeItem("audEnable")},async bug_687574_callLocalPeers(){function a(a,b){if("connected"===b.currentTarget.connectionState)try{console.log("PEER connected webrtc"),u.disconnect(g.audio.Html5Audio.audioContext.destination),u.connect(g.audio.Html5Audio.MediaStreamDest)}catch(N){}else if("disconnected"===b.currentTarget.connectionState){console.log("PEER disconnected");
k.close();m.close();m=k=null;try{u.disconnect(g.audio.Html5Audio.MediaStreamDest),u.connect(g.audio.Html5Audio.audioContext.destination),console.log("PEER connected normal audio api")}catch(N){}g.audio.bug_687574_callLocalPeers()}}async function b(a){try{await k.setLocalDescription(a),await m.setRemoteDescription(a)}catch(M){d()}try{const a=await m.createAnswer();await c(a)}catch(M){d()}}async function c(a){try{await m.setLocalDescription(a),await k.setRemoteDescription(a)}catch(M){d()}}async function f(a,
b){if(b.candidate&&"host"===b.candidate.type)try{await (a===k?m:k).addIceCandidate(b.candidate)}catch(N){d()}}function d(){console.log("PEER fallback");try{u.connect(g.audio.Html5Audio.audioContext.destination),k.close(),m.close(),m=k=null}catch(O){m=k=null}}let k,m;k=new RTCPeerConnection;k.count=0;k.addEventListener("icecandidate",a=>f(k,a));k.addEventListener("connectionstatechange",b=>a(k,b));m=new RTCPeerConnection;m.count=0;m.addEventListener("icecandidate",a=>f(m,a));m.addEventListener("connectionstatechange",
b=>a(m,b));m.addEventListener("track",function(a){const b=document.createElement("audio");b.srcObject=a.streams[0];b.autoplay=!0});g.audio.Html5Audio.MediaStreamDest.stream.getTracks().forEach(a=>k.addTrack(a,g.audio.Html5Audio.MediaStreamDest.stream));try{const a=await k.createOffer();await b(a)}catch(O){d()}}},video:{width:75,height:56,tempVid:"",tempVidCont:"",myVideo:"",remoteVid:"",remoteVidCont:"",maxHeight:250,init(){this.videoCont=document.getElementById("allVideosCont");null!=this.videoCont&&
(this.videoCont.style.maxHeight=`${this.maxHeight}px`)},calcDimension(){this.myVideo.width=this.width;this.myVideo.height=this.height},removeUser(a){a=document.getElementById(`user${a}`);null!=a&&a.parentNode.removeChild(a)},createElement(a){const c=document.createElement("div");c.className="videoWrapper";const f=document.createElement("div");f.className="videoSubWrapper";f.id=`user${a.id}`;c.appendChild(f);b=a.id;const g=document.createElement("canvas");g.id=`video${b}`;g.className="userVideos";
g.width=this.width;g.height=this.height;g.muted="muted";f.appendChild(g);virtualclass.media.util.imageReplaceWithVideo(a.id,c)},updateHightInSideBar(a){const b=document.getElementById("widgetRightSide").offsetHeight;document.getElementById("chatContainer").style.height=`${b-a}px`},sendInBinary(a){const b={name:virtualclass.gObj.uName,id:virtualclass.gObj.uid};io.webSocketConnected()&&(virtualclass.vutil.beforeSend({videoByImage:b,cf:"videoByImage"},null,!0),ioAdapter.sendBinary(a))},send(){function a(){b.tempVidCont.clearRect(0,
0,b.tempVid.width,b.tempVid.height);b.tempVidCont.drawImage(b.myVideo,0,0,b.width,b.height);roles.hasControls();if(virtualclass.system.webpSupport){var d=b.tempVid.toDataURL("image/webp",.6);var k=1}else d=b.tempVid.toDataURL("image/jpeg",.3),k=0;d=virtualclass.videoHost.convertDataURIToBinary(d);if(!virtualclass.videoHost.gObj.stdStopSmallVid&&!roles.hasControls()||roles.hasControls()&&virtualclass.videoHost.gObj.videoSwitch){var m=virtualclass.gObj.uid.toString();for(let a=m.length;8>a;a++)m=`0${m}`;
m=m.match(/[\S]{1,2}/g)||[];k=new Uint8ClampedArray([11,m[0],m[1],m[2],m[3],k]);m=new Uint8ClampedArray(d.length+k.length);m.set(k);m.set(d,k.length);g.sendInBinary(m)}clearInterval(virtualclass.media.smallVid);if(virtualclass.hasOwnProperty("connectedUsers"))if(d=f+2500*virtualclass.connectedUsers.length,c!=virtualclass.connectedUsers.length){c=virtualclass.connectedUsers.length;k=-1;for(m=0;m<virtualclass.connectedUsers.length;m++)virtualclass.connectedUsers[0].userid==virtualclass.gObj.uid&&(k=
m);m=d/c;0>k&&(k=0);virtualclass.media.smallVid=setInterval(a,d+k*m)}else virtualclass.media.smallVid=setInterval(a,d)}virtualclass.media.hasOwnProperty("smallVid")&&clearInterval(virtualclass.media.smallVid);const b=this;f=Math.floor(5001*Math.random()+3E3);let c=-1;const g=this;virtualclass.media.smallVid=setInterval(a,f)},startToStream(){g.video.calcDimension();g.video.send()},playWithoutSlice(a,b,c){this.remoteVid=document.getElementById(`video${a}`);null!=this.remoteVid&&(this.remoteVidCont=
this.remoteVid.getContext("2d"),this.remoteVidCont.putImageData(imgData,0,0))},drawReceivedImage(a,b,c,f){this.remoteVid=chatContainerEvent.elementFromShadowDom(`#video${f}`);if(null!=this.remoteVid)if(this.remoteVidCont=this.remoteVid.getContext("2d"),virtualclass.system.webpSupport||"jpeg"===b){const b=new Image,f=this;b.onload=function(){f.remoteVidCont.drawImage(b,c.x,c.y)};b.src=a}else loadfile(a,this.remoteVid,this.videoPartCont)},justForDemo(){let a=0,b=document.getElementById("allVideosCont");
b.style.maxHeight="250px";setInterval(()=>{if(20>=++a){b=document.getElementById("allVideosCont");const c=document.createElement("div");c.className="videoWrapper";const f=document.createElement("div");f.className="videoSubWrapper";f.setAttribute("data-uname",+a);c.appendChild(f);const g=document.createElement("video");g.className="userVideo";g.muted="muted";g.src="http://html5demos.com/assets/dizzy.mp4";f.appendChild(g);b.appendChild(c);250<=b.offsetHeight&&"undefined"!=b.style.overflowY&&"scroll"!=
b.style.overflowY&&(b.style.overflowY="scroll",document.getElementById(virtualclass.gObj.chat.mainChatBoxId).style.borderTop="3px solid #bbb")}},200)},createVideoElement(){const a=document.createElement("div");a.className="videoWrapper";const b=document.createElement("div");b.className="videoSubWrapper";a.appendChild(b);const c=document.createElement("video");c.id=`video${virtualclass.gObj.uid}`;c.autoplay=!0;b.appendChild(c);return a},insertTempVideo(a){const b=document.createElement("canvas");b.id=
"tempVideo";a.parentNode.insertBefore(b,a)},tempVideoInit(){g.video.tempVid=chatContainerEvent.elementFromShadowDom("#tempVideo");g.video.tempVid.width=g.video.width;g.video.tempVid.height=g.video.height;g.video.tempVidCont=g.video.tempVid.getContext("2d")},process(a){var b=new Uint8ClampedArray(a);a=virtualclass.vutil.numValidateFour(b[1],b[2],b[3],b[4]);var c=b.subarray(6,b.length);1===b[5]?(b=`data:image/webp;base64,${btoa(virtualclass.videoHost.Uint8ToString(c))}`,c="webp"):(b=`data:image/jpeg;base64,${btoa(virtualclass.videoHost.Uint8ToString(c))}`,
c="jpeg");virtualclass.media.video.drawReceivedImage(b,c,{x:0,y:0},a)}},sessionConstraints(){var a=!!virtualclass.system.mediaDevices.hasWebcam;virtualclass.gObj.meetingMode&&a&&(a="mobTab"===virtualclass.system.device&&"iOS"===virtualclass.system.mybrowser.name||"Firefox"===virtualclass.system.mybrowser.name||"Safari"===virtualclass.system.mybrowser.name?!0:{width:{max:268},height:{max:142},frameRate:{max:6}});return[a,{video:a,audio:virtualclass.system.mediaDevices.hasMicrophone?{echoCancellation:!0,
autoGainControl:!0,channelCount:1,noiseSuppression:!0}:!1}]},async init(){console.log("Video second, normal video");g=this;virtualclass.gesture.classJoin&&(virtualclass.gesture.attachHandler(),delete virtualclass.gesture.classJoin);let a,b;[a,b]=this.sessionConstraints();g.video.init();virtualclass.user.control.audioDisable();virtualclass.user.control.videoDisable();if(!virtualclass.vutil.isPlayMode()){null==virtualclass.adpt&&(virtualclass.adpt=new virtualclass.adapter);if(null!=virtualclass.media.video.tempStream){var c=
virtualclass.media.video.tempStream.getTracks();for(var f=0;f<c.length;f++)c[f].stop()}c=virtualclass.adpt.init(navigator);f=null;try{f=await c.mediaDevices.getUserMedia(b)}catch(H){this.handleUserMediaError(H)}null!==f&&this.handleUserMedia(f)}virtualclass.system.wbRtc.peerCon&&"undefined"===typeof localStorage.wbrtcMsg&&(virtualclass.view.multiMediaMsg("WebRtc"),localStorage.wbrtcMsg=!0);0==a&&(virtualclass.user.control.videoDisable(),virtualclass.vutil.addClass("virtualclassCont","nowebcam"))},
handleUserMedia(a){localStorage.removeItem("dvid");document.getElementById("audioWidget");var b=localStorage.getItem("audEnable");if(roles.isStudent()&&virtualclass.system.mediaDevices.hasMicrophone)virtualclass.settings.userAudioIcon();else if(virtualclass.system.mediaDevices.hasMicrophone)if(null!=b)if(b=JSON.parse(b),"false"===b.ac||!1===b.ac)virtualclass.gObj.audioEnable=!1,virtualclass.user.control.audioDisable(!0);else{if("true"===b.ac||!0===b.ac)virtualclass.gObj.audioEnable=!0,virtualclass.user.control.audioWidgetEnable(!0)}else"undefined"!==
typeof a&&virtualclass.user.control.audioWidgetEnable(!0);else virtualclass.user.control.audioDisable();b=a.getVideoTracks()[0];"undefined"!==typeof b?b.onended=function(){virtualclass.system.mediaDevices.webcamErr.push("webcambusy")}:virtualclass.system.mediaDevices.webcamErr.push("nopermission");g.video.tempStream=a;g.audio.init();g.audio.attachAudioStopHandler(a);b=chatContainerEvent.elementFromShadowDom(`#ml${virtualclass.gObj.uid}`);null!=b&&null!=b.getElementsByTagName("video")&&g._handleUserMedia(virtualclass.gObj.uid);
roles.hasAdmin()&&virtualclass.videoHost.isDomReady(()=>{virtualclass.videoHost.renderSelfVideo(a)});virtualclass.settings.userVideoIcon();null==localStorage.getItem("prevApp")&&(roles.hasControls()?virtualclass.vutil.videoHandler("off"===virtualclass.vutil.selfVideoStatus()?"on":"off"):virtualclass.gObj.meetingMode&&virtualclass.vutil.videoHandler("off"));g.audio.audioContextReady&&!g.audio.hasOwnProperty("triggermaniPulateStream")&&(g.stream=g.video.tempStream,g.audio._maniPulateStream())},addUserRole(a,
b){a.dataset.role=b;if("undefined"!==typeof b){var c="s"===b?"student":"teacher";a.classList.add(c)}else a.classList.add("student");"t"===virtualclass.gObj.uRole&&"student"===c&&document.getElementById("virtualclassCont").classList.remove("student")},_handleUserMedia(a){if("undefined"!==typeof g){if(a=g.video.tempStream,"undefined"!==typeof a&&virtualclass.system.mediaDevices.hasWebcam){const b=g.video.createVideoElement();virtualclass.media.util.imageReplaceWithVideo(virtualclass.gObj.uid,b);g.video.insertTempVideo(b);
g.video.tempVideoInit();g.video.myVideo=chatContainerEvent.elementFromShadowDom(`#video${virtualclass.gObj.uid}`);virtualclass.adpt.attachMediaStream(g.video.myVideo,a);g.video.myVideo.muted=!0;g.stream=g.video.tempStream;g.video.myVideo.onloadedmetadata=function(){g.video.startToStream()}}}else console.log("Media: it seems media is not ready")},updateVideoContHeight(){console.log("Updating User");var a=document.getElementById("virtualclassCont");virtualclass.vutil.getElementOffset(a);a=virtualclass.chat.boxHeight;
const b=document.getElementById("chat_div");b.scrollHeight>=a+1&&(b.style.overflowY="scroll");b.style.maxHeight=`${a}px`;console.log(`Chat height ${b.offsetHeight}`);console.log(`Max height ${b.style.maxHeight}`);virtualclass.isPlayMode&&(b.style.maxHeight=`${a+64}px`)},close(){virtualclass.media.hasOwnProperty("smallVid")&&clearInterval(virtualclass.media.smallVid)},dispAllVideo(a){setTimeout(()=>{var b=document.getElementById(a);if(null!=b){b=b.getElementsByTagName("video");for(let a=0;a<b.length;a++)b[a].play()}},
1040)},existVideoContainer(a){const b=chatContainerEvent.elementFromShadowDom(".userVideos","all");for(let c=0;c<b.length;c++)if(b[c].id===`video${a.id}`)return!0;return!1},handleUserMediaError(a){const b="object"===typeof a?virtualclass.lang.getString(a.name):virtualclass.lang.getString(a);null==b?virtualclass.view.createErrorMsg(a,"errorContainer","chatWidget"):virtualclass.view.createErrorMsg(b,"errorContainer","chatWidget");virtualclass.user.control.mediaWidgetDisable("vd");virtualclass.view.disappearBox("WebRtc");
localStorage.setItem("dvid",!0);console.log("navigator.getUserMedia error: ",a);switch(a.name){case "NotFoundError":case "DevicesNotFoundError":a="nowebcam";break;case "SourceUnavailableError":a="webcambusy";break;case "PermissionDeniedError":case "SecurityError":a="nopermission";virtualclass.gObj.disableCamByUser=!0;break;case "NotAllowedError":a="nopermission";virtualclass.gObj.disableCamByUser=!0;break;default:a="rejected"}virtualclass.system.mediaDevices.webcamErr.push(a);g.audio.notifiyMuteAudio()},
detectAudioWorklet:()=>{if("undefined"===typeof OfflineAudioContext)return!1;const a=new OfflineAudioContext(1,1,44100);return!(!a.audioWorklet||"function"!==typeof a.audioWorklet.addModule)}}}})(window);(function(d){d.sharePt=function(){let c=!1;return{pptUrl:"",state:{},urlValue:"",localStoragFlag:!1,eventsObj:[],autoSlideTime:0,viewFlag:0,controlFlag:0,autoSlideFlag:0,autoSlideResumed:0,studentPpt:0,startFromFlag:0,startFrom:0,currId:"",order:[],init(a,b){this.pages={};this.order=[];this.autoSlideResumed=this.autoSlideTime=this.autoSlideFlag=0;"undefined"!==typeof virtualclass.previous&&"undefined"!==typeof b&&"byclick"==b&&roles.hasControls()&&virtualclass.vutil.beforeSend({ppt:!0,init:"makeAppReady",
cf:"ppt"});a=document.getElementById("virtualclassSharePresentation");null!=a&&a.parentNode.removeChild(a);this.UI.container();a=document.getElementById("pptMessageLayout");roles.hasControls()?(b=document.getElementById("urlcontainer"),null!=a&&(a.style.display="none"),b&&(b.style.display="block"),virtualclass.vutil.requestOrder("presentation",a=>{console.log(a);virtualclass.vutil.isResponseAvailable(a)?virtualclass.sharePt.order=a:console.log("Order response is not available")})):roles.hasView()&&
(b=document.getElementById("urlcontainer"),this.UI.messageDisplay(),a&&(a.style.display="block"),b&&(b.style.display="none"));this.findInStorage();roles.hasControls()&&!c&&(this.getPptList(),c=!0);virtualclass.sharePt.attachMessageEvent("message",virtualclass.sharePt.pptMessageEventHandler)},createPageModule(){virtualclass.sharePt.ppts&&virtualclass.sharePt.ppts.length&&virtualclass.sharePt.ppts.forEach((a,b)=>{virtualclass.sharePt.pages[a.fileuuid]=new virtualclass.page("pptListContainer","ppt",
"virtualclassSharePresentation","sharePt",a.status)})},findInStorage(){var a=localStorage.getItem("prevApp");console.log(`test pApp${typeof a}`);console.log(a);null!=a&&(a=JSON.parse(a),"SharePresentation"==a.name&&(a=a.metaData,null!=a&&a.init&&(this.localStoragFlag=!0,this.pptUrl=JSON.parse(localStorage.getItem("pptUrl")),null!=a.startFrom&&(virtualclass.sharePt.stateLocalStorage=a.startFrom),null!=a.currId&&(virtualclass.sharePt.currId=a.currId)),this.localStoragFlag&&this.fromLocalStorage(virtualclass.sharePt.state)));
virtualclass.previrtualclass=`virtualclass${virtualclass.currApp}`},fromLocalStorage(a){null==document.getElementById("iframecontainer")&&this.UI.createIframe();document.getElementById("iframecontainer").style.display="block";a=document.getElementById("pptiframe");const b=0>this.pptUrl.search("postMessage")?`${this.pptUrl}?postMessage=true&postMessageEvents=true`:this.pptUrl;a.setAttribute("src",b);this.setAutoSlideConfig();a=document.getElementById("pptMessageLayout");null!=a&&(console.log("message block"),
a.style.display="none");a=document.getElementById(this.UI.id);a.classList.contains("pptSharing")||a.classList.add("pptSharing")},_rearrange(a){this.order=a;this.reArrangeElements(a);virtualclass.vutil.sendOrder("presentation",a)},sendOrder(a){virtualclass.vutil.xhrSendWithForm({content_order:a.toString(),content_order_type:"3",live_class_id:virtualclass.gObj.congCourse},"congrea_page_order")},reArrangeElements(a){const b=document.getElementById("listppt"),c=document.createElement("div");c.id="listppt";
c.className="ppts";let g=!1;for(var d=0;d<virtualclass.sharePt.activeppts.length;d++)-1>=a.indexOf(virtualclass.sharePt.activeppts[d].fileuuid)&&(a.push(virtualclass.sharePt.activeppts[d].fileuuid),g=!0);for(d=0;d<a.length;d++){const b=document.getElementById(`linkppt${a[d]}`);b&&c.appendChild(b)}b.parentNode.replaceChild(c,b);g&&(virtualclass.sharePt.order=a,virtualclass.vutil.sendOrder("presentation",virtualclass.sharePt.order))},_delete(a){const b=this;virtualclass.xhrn.vxhrn.post(virtualclass.api.UpdateDocumentStatus,
{uuid:a,action:"delete",page:0}).then(c=>{b.afterDeletePtCallback(c.data,a)})},afterDeletePtCallback(a,b){"ERROR"!=a&&(a=document.getElementById(`linkppt${b}`))&&(a.parentNode.removeChild(a),virtualclass.sharePt.ppts.length&&(virtualclass.sharePt.ppts.forEach((a,c)=>{a.fileuuid==b&&(c=virtualclass.sharePt.ppts.indexOf(a),0<=c&&(virtualclass.sharePt.ppts.splice(c,1),console.log(virtualclass.sharePt.ppts)))}),a=virtualclass.sharePt.order.indexOf(b),0<=a&&(virtualclass.sharePt.order.splice(a,1),console.log(virtualclass.sharePt.order),
virtualclass.vutil.sendOrder("presentation",virtualclass.sharePt.order)),(a=document.querySelector(".congrea #pptiframe"))&&a.getAttribute("src")?virtualclass.vutil.showFinishBtn():virtualclass.vutil.removeFinishBtn()),virtualclass.sharePt.currId==b&&(a=document.querySelector("#pptiframe")))&&(a.removeAttribute("src"),ioAdapter.mustSend({pptMsg:"deletePrt",cf:"ppt",currId:virtualclass.sharePt.currId}),virtualclass.sharePt.currId=null,virtualclass.sharePt.pptUrl=null,virtualclass.vutil.removeFinishBtn())},
_delete1(a){const b=this;virtualclass.xhrn.vxhrn.post(virtualclass.api.UpdateDocumentStatus,{uuid:a,action:"delete",page:0}).then(c=>{b.afterDeleteCallback(c.data,a)})},pptMessageEventHandler(a){if("SharePresentation"==virtualclass.currApp){var b=document.getElementById("pptiframe"),c=a.data;c="string"===typeof c?JSON.parse(a.data):a.data;"undefined"!==typeof c&&(c.hasOwnProperty("namespace")&&"reveal"==c.namespace&&(virtualclass.sharePt.state=c.state),"ready"==c.eventName&&(virtualclass.sharePt.localStoragFlag&&
!virtualclass.sharePt.startFromFlag?(a=virtualclass.sharePt.stateLocalStorage,b.contentWindow.postMessage(JSON.stringify({method:"slide",args:[a.indexh,a.indexv,a.indexf]}),"*"),virtualclass.sharePt.localStoragFlag=0):virtualclass.sharePt.startFromFlag&&b.contentWindow.postMessage(JSON.stringify({method:"slide",args:virtualclass.sharePt.startFrom}),"*"),setTimeout(()=>{null!=b&&null!=b.contentWindow&&b.contentWindow.postMessage(JSON.stringify({method:"toggleAutoSlide"}),"*")},1500)),roles.hasView()?
"ready"==c.eventName&&(setTimeout(()=>{virtualclass.sharePt.removeControls()},100),virtualclass.sharePt.studentPpt&&(virtualclass.sharePt.setSlideState(virtualclass.sharePt.studentPpt),virtualclass.sharePt.studentPpt=0)):roles.hasControls()&&(console.log(c.eventName),"undefined"!==typeof c.eventName&&(virtualclass.sharePt[c.eventName].call(virtualclass.sharePt,c),virtualclass.sharePt.state=c.state)))}else null!=b&&b.removeAttribute("src")},setAutoSlideConfig(){localStorage.getItem("autoSlideTime")&&
(virtualclass.sharePt.autoSlideTime=JSON.parse(localStorage.getItem("autoSlideTime")),virtualclass.sharePt.autoSlideFlag=JSON.parse(localStorage.getItem("autoSlideFlag")))},onmessage(a){a.hasOwnProperty("autoSlide")&&(this.autoSlideTime=a.autoSlide);"undefined"!==typeof virtualclass.sharePt&&(virtualclass.system.setAppDimension(virtualclass.currApp),this.onPptMsgReceive(a),a=document.getElementById(virtualclass.sharePt.UI.id),a.classList.contains("pptSharing")||a.classList.add("pptSharing"))},ready(a){console.log("teacher ready for ppt ");
ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},slidechanged(a){this.autoSlideFlag&&this.autoSlideResumed&&!this.autoSlideTime&&this.calculateAutoSlideTime(a);ioAdapter.mustSend({pptMsg:a,cf:"ppt",autoSlide:this.autoSlideTime,cfpt:"setPEvent"})},calculateAutoSlideTime(a){this.eventsObj.push({name:a.eventName,time:Date.now()});2<=this.eventsObj.length&&("slidechanged"==this.eventsObj[0].name&&"slidechanged"==this.eventsObj[1].name?(this.autoSlideTime=this.eventsObj[1].time-this.eventsObj[0].time,
console.log(`auto slide time withoutpause${this.autoSlideTime}`)):"autoslideresumed"==this.eventsObj[0].name&&"slidechanged"==this.eventsObj[1].name&&(this.autoSlideTime=this.eventsObj[1].time-this.eventsObj[0].time,console.log(`withpause${this.autoSlideTime}`)),console.log(this.eventsObj),console.log(this.autoSlideTime))},autoslidepaused(a){this.autoSlideFlag=1;this.autoSlideResumed=0;console.log(this.pause);ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},autoslideresumed(a){this.autoSlideResumed=
this.autoSlideFlag=1;this.eventsObj=[];this.eventsObj.push({name:a.eventName,time:Date.now()});ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},fragmentshown(a){ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},fragmenthidden(a){ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},overviewshown(a){ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},overviewhidden(a){ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},paused(a){ioAdapter.mustSend({pptMsg:a,cf:"ppt",
cfpt:"setPEvent"})},resumed(a){ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},removeControls(){setTimeout(()=>{document.getElementById("pptiframe").contentWindow.postMessage(JSON.stringify({method:"configure",args:[{controls:!1,autoSlide:0,keyboard:!1,progress:!1,touch:!1}]}),"*")},100)},cfpt:{displayFrame(){this.displayFrame()},setUrl(a){virtualclass.sharePt.localStoragFlag=0;virtualclass.sharePt.stateLocalStorage={};virtualclass.sharePt.state={indexh:0,indexv:0,indexf:0};this.setSlideUrl(a);
const b=document.getElementById("pptiframe");b.onload=function(){roles.hasView()&&null!=b.contentWindow&&"undefined"!==typeof a.pptMsg.state&&b.contentWindow.postMessage(JSON.stringify({method:"setState",args:[a.pptMsg.state]}),"*")}},setPEvent(a){null!=document.getElementById("pptiframe")&&virtualclass.sharePt.setSlideState(a.pptMsg);this.state=a.pptMsg.state}},onPptMsgReceive(a){if("undefined"!==typeof a.ppt&&"undefined"!==typeof a.ppt.startFrom){virtualclass.sharePt.startFromFlag=1;var b=document.getElementById("pptiframe");
null!=b&&(0>a.ppt.init.search("postMessage")?b.setAttribute("src",`${a.ppt.init}?postMessage=true&postMessageEvents=true`):b.setAttribute("src",a.ppt.init),virtualclass.sharePt.startFrom=[a.ppt.startFrom.indexh,a.ppt.startFrom.indexv,a.ppt.startFrom.indexf])}if("undefined"!==typeof a.pptMsg){if("deletePrt"==a.pptMsg){var c=document.querySelector("#pptiframe");c&&(c.removeAttribute("src"),virtualclass.sharePt.currId=null,virtualclass.sharePt.pptUrl=null,c=document.querySelector("#virtualclassCont.congrea #virtualclassSharePresentation #pptMessageLayout"))&&
(c.style.display="block")}else{b=document.getElementById("pptiframe");var g=document.getElementById("pptMessageLayout");null!=b&&(b.onload=function(){roles.hasView()&&null!=b.contentWindow&&"undefined"!==typeof a.pptMsg.state&&b.contentWindow.postMessage(JSON.stringify({method:"setState",args:[a.pptMsg.state]}),"*")})}null!=g&&(g.style.display="none");a.hasOwnProperty("cfpt")&&"undefined"!==typeof a.cfpt&&"undefined"!==typeof virtualclass.sharePt.cfpt[a.cfpt]&&virtualclass.sharePt.cfpt[a.cfpt].call(virtualclass.sharePt,
a)}},displayFrame(){virtualclass.system.setAppDimension(virtualclass.currApp);const a=document.getElementById(virtualclass.sharePt.UI.id);a.classList.contains("pptSharing")||a.classList.add("pptSharing")},setSlideUrl(a){if(null!=a.pptMsg&&""!=a.pptMsg){virtualclass.sharePt.studentPpt=0;console.log("PPT:- invoke setSlideUrl");this.autoSlideTime=this.autoSlideFlag=this.viewFlag=0;var b=document.getElementById("pptiframe");null!=b&&b.parentNode.removeChild(b);console.log("create iframe from setslide url");
this.UI.createIframe();document.getElementById("iframecontainer").style.display="block";b=document.getElementById("pptiframe");b.setAttribute("src",0>a.pptMsg.search("postMessage")?`${a.pptMsg}?postMessage=true&postMessageEvents=true`:a.pptMsg);console.log("test url is set");this.pptUrl=a.pptMsg}virtualclass.sharePt.localStoragFlag=0;virtualclass.sharePt.startFromFlag=0},setSlideState(a){const b=document.getElementById("pptiframe").contentWindow,c=[a.state.indexh,a.state.indexv,a.state.indexf],g=
[a.state];switch(a.eventName){case "ready":b.postMessage(JSON.stringify({method:"setState",args:g}),"*");break;case "slidechanged":virtualclass.sharePt.studentPpt=a;console.log("test PPt:-  changed");b.postMessage(JSON.stringify({method:"slide",args:c}),"*");break;case "autoslidepaused":this.autoSlideFlag=1;b.postMessage(JSON.stringify({method:"toggleAutoSlide"}),"*");break;case "autoslideresumed":this.autoSlideFlag=1;b.postMessage(JSON.stringify({method:"toggleAutoSlide"}),"*");break;case "fragmentshown":b.postMessage(JSON.stringify({method:"slide",
args:c}),"*");break;case "fragmenthidden":b.postMessage(JSON.stringify({method:"slide",args:c}),"*");break;case "overviewshown":b.postMessage(JSON.stringify({method:"setState",args:g}),"*");break;case "overviewhidden":b.postMessage(JSON.stringify({method:"setState",args:g}),"*"),b.postMessage(JSON.stringify({method:"slide",args:c}),"*");default:console.log("There is no event is occured")}},toProtocolRelativeUrl(){const a=virtualclass.sharePt.urlValue;return 0<=a.indexOf("http")?a.replace(/http:\/\/|https:\/\//,
"//"):`//${a}`},validUrl(){return virtualclass.sharePt.isUrlip(virtualclass.sharePt.urlValue)?virtualclass.sharePt.cleanupUrl(virtualclass.sharePt.urlValue):0<virtualclass.sharePt.urlValue.search("<iframe")?virtualclass.sharePt.extractUrl(virtualclass.sharePt.urlValue):virtualclass.sharePt.validURLWithDomain(virtualclass.sharePt.urlValue)?virtualclass.sharePt.completeUrl(virtualclass.sharePt.cleanupUrl(virtualclass.sharePt.urlValue)):!1},initNewPpt(){virtualclass.sharePt.urlValue=document.getElementById("presentationurl").value;
virtualclass.sharePt.urlValue=virtualclass.sharePt.toProtocolRelativeUrl();const a=virtualclass.sharePt.validUrl();a?(virtualclass.sharePt.savePptUrl(a),document.getElementById("presentationurl").value=""):virtualclass.popup.validateurlPopup("presentation")},savePptUrl(a){const b=virtualclass.vutil.createHashString(a)+virtualclass.vutil.randomString(32).slice(1,-1),c={};c.uuid=b;c.URL=a;c.title=a;a=virtualclass.api.addURL;c.type="presentation";const g=this;virtualclass.xhrn.vxhrn.post(a,c).then(()=>
{if(virtualclass.sharePt.hasOwnProperty("activeppts")){const a=virtualclass.sharePt.activeppts.map(a=>a.fileuuid);a.length!=virtualclass.sharePt.order.length&&(virtualclass.sharePt.order=a)}virtualclass.sharePt.order.push(c.uuid);virtualclass.vutil.sendOrder("presentation",virtualclass.sharePt.order);virtualclass.sharePt.getPptList();g.fetchAllData()})},fetchAllData(){virtualclass.serverData.fetchAllData(()=>{virtualclass.sharePt.awsPresentationList(virtualclass.serverData.rawData.ppt)})},awsPresentationList(a){virtualclass.sharePt.ppts=
[];virtualclass.sharePt.ppts=a;document.querySelector("#SharePresentationDashboard .dbContainer")&&(virtualclass.sharePt.createPageModule(),virtualclass.sharePt.showPpts(),virtualclass.vutil.requestOrder("presentation",a=>{virtualclass.vutil.isResponseAvailable(a)?(virtualclass.sharePt.order=a,virtualclass.sharePt.order&&0<virtualclass.sharePt.order.length&&virtualclass.sharePt.reArrangeElements(virtualclass.sharePt.order)):console.log("Order response is not available")}))},afterPptSaved(a){var b=
a.fileuuid;a.hasOwnProperty("disabled")?a.status=0:a.status=1;this.pages[b]=new virtualclass.page("pptListContainer","ppt","virtualclassSharePresentation","sharePt",a.status);this.pages[b].init(b,a.URL);this.pptClickHandler(a);b=document.getElementById(`linkppt${a.fileuuid}`);const c=document.getElementById(`pptTitle${a.fileuuid}`);var g=this.extractTitle(a.URL);c&&(g?c.innerHTML=g:(g=a.URL,g=`https:${g}`,g=g.match(/^(?:https?:\/\/)?(?:w{3}\.)?([a-z\d\.-]+)\.(?:[a-z\.]{2,10})(?:[/\w\.-]*)*/)[1],c.innerHTML=
g));c.setAttribute("data-toogle","tooltip");c.setAttribute("data-placement","bottom");c.setAttribute("title",a.URL);a.hasOwnProperty("disabled")?(this._disable(a.fileuuid),b&&b.classList.add("disable")):(this._enable(a.fileuuid),b&&b.classList.add("enable"));virtualclass.sharePt.currId==a.fileuuid&&b.classList.add("playing")},extractTitle(a){return-1<a.indexOf("//")?a.split("/")[4]:a.split("/")[2]},pptClickHandler(a){const b=document.getElementById(`mainpppt${a.fileuuid}`);b&&b.addEventListener("click",
()=>{virtualclass.sharePt.playPptUrl(a.URL,a.fileuuid);virtualclass.dashBoard.close();virtualclass.sharePt.currId=a.fileuuid;virtualclass.sharePt.activePrs(a.fileuuid)})},activePrs(a){const b=document.querySelectorAll("#virtualclassCont.congrea .linkppt");for(let a=0;a<b.length;a++)b[a].classList.contains("playing")&&b[a].classList.remove("playing");(a=document.querySelector(`#virtualclassCont.congrea #linkppt${a}`))&&!a.classList.contains("playing")&&a.classList.add("playing")},_disable(a){var b=
document.getElementById(`mainpppt${a}`);b.style.opacity=.3;b.style.pointerEvents="none";b=document.querySelector(`#linkppt${a}`);b.classList.contains("enable")&&b.classList.remove("enable");b.classList.add("disable");virtualclass.sharePt.ppts&&virtualclass.sharePt.ppts.length&&virtualclass.sharePt.ppts.forEach((b,c)=>{b.fileuuid==a&&(b.disabled=0,b.status=0)})},_enable(a){var b=document.querySelector(`#linkppt${a}`);b.classList.contains("disable")&&b.classList.remove("diable");b.classList.add("enable");
if(b=document.getElementById(`mainpppt${a}`))b.style.opacity=1,b.style.pointerEvents="auto",virtualclass.sharePt.ppts&&virtualclass.sharePt.ppts.length&&virtualclass.sharePt.ppts.forEach((b,c)=>{b.fileuuid==a&&(delete b.disabled,b.status=1)})},getPptList(){virtualclass.gObj.fetchedData?virtualclass.sharePt.awsPresentationList(virtualclass.serverData.rawData.ppt):this.fetchAllData()},showPpts(a){if(a=document.getElementById("listppt"))for(let b=0;b<a.childNodes.length-1;b++)a.childNodes[b].parentNode.removeChild(a.childNodes[b]);
virtualclass.sharePt.ppts&&virtualclass.sharePt.ppts.length&&(virtualclass.sharePt.activeppts=[],virtualclass.sharePt.ppts.forEach((a,c)=>{a.hasOwnProperty("deleted")||(virtualclass.sharePt.activeppts.push(a),c=document.querySelector(`#linkppt${a.fileuuid}`),null!=c&&c.classList.remove("noPpt"),virtualclass.sharePt.afterPptSaved(a))}),virtualclass.vutil.sendOrder("presentation",virtualclass.sharePt.order));(a=document.querySelector(".congrea #pptiframe"))&&a.getAttribute("src")&&virtualclass.vutil.showFinishBtn();
virtualclass.vutil.makeElementActive("#listvideo")},retrieveOrder(){const a=new FormData;a.append("live_class_id",virtualclass.gObj.congCourse);a.append("content_order_type","3");this.requestOrder(a)},requestOrder(a){virtualclass.vutil.requestOrder("presentation",a=>{console.log(a);virtualclass.vutil.isResponseAvailable(a)&&(virtualclass.sharePt.order=a,0<virtualclass.sharePt.order.length&&virtualclass.sharePt.reArrangeElements(virtualclass.sharePt.order))})},playPptUrl(a){virtualclass.sharePt.autoSlideTime=
0;virtualclass.sharePt.autoSlideFlag=0;virtualclass.sharePt.localStoragFlag=0;virtualclass.sharePt.startFromFlag=0;virtualclass.sharePt.eventsObj=[];virtualclass.sharePt.state={indexh:0,indexv:0,indexf:0};virtualclass.sharePt.stateLocalStorage={};localStorage.removeItem("autoSlideTime");localStorage.removeItem("autoSlideFlag");null==document.getElementById("iframecontainer")&&(console.log("call of iframe creater from onclick event handler"),virtualclass.sharePt.UI.createIframe());const b=document.getElementById(virtualclass.sharePt.UI.id);
b.classList.contains("pptSharing")||b.classList.add("pptSharing");virtualclass.sharePt.setPptUrl(a);virtualclass.system.setAppDimension()},cleanupUrl(a){const b=a.search("#");0<b&&(a=a.slice(0,b));return a},setPptUrl(a){console.log("test+set ppt url function");document.getElementById("iframecontainer").style.display="block";const b=document.getElementById("pptiframe");console.log(`completeurl${a}`);virtualclass.sharePt.pptUrl=`${a}?postMessage=true&postMessageEvents=true`;b.setAttribute("src",virtualclass.sharePt.pptUrl);
ioAdapter.mustSend({pptMsg:"displayframe",cf:"ppt",user:"all",cfpt:"displayframe"});ioAdapter.mustSend({pptMsg:a,cf:"ppt",user:"all",cfpt:"setUrl"});b.style.display="visible";document.querySelector(".congrea  #dashboardContainer .modal-header button.enable")||virtualclass.vutil.showFinishBtn()},validURLWithDomain(a){return/^(?:\w+:)?\/\/([^\s\.]+\.\S{2}|localhost[:?\d]*)\S*$/.test(a)},completeUrl(a){0<a.search("slides.com")&&0>a.search("embed")&&(a+="/embed");return a},extractUrl(a){if(0<a.search("src")){const b=
a.match(/"(.*?)"/);if(0<b.length)return JSON.parse(b[0])}return a},isUrlip(a){a.slice(0,2);return/(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)/.test(a)},saveIntoLocalStorage(a){if(this.validURLWithDomain(a.metaData.init)||this.isUrlip(a.metaData.init))localStorage.setItem("prevApp",JSON.stringify(a)),console.log("ppt_state",a.metaData.startFrom),localStorage.setItem("ppt_state",JSON.stringify(a.metaData.startFrom)),
console.log("savinlocal"),localStorage.setItem("pptUrl",JSON.stringify(a.metaData.init)),localStorage.setItem("autoSlideTime",JSON.stringify(virtualclass.sharePt.autoSlideTime)),localStorage.setItem("autoSlideFlag",JSON.stringify(virtualclass.sharePt.autoSlideFlag))},initTeacherLayout(){var a=document.getElementById("pptiframe");if(null!=document.getElementById("pptiframe")){const b={controls:!0,keyboard:!0,progress:!0,touch:!0};let c;virtualclass.sharePt.autoSlideTime&&virtualclass.sharePt.autoSlideFlag?
c=virtualclass.sharePt.autoSlideTime:virtualclass.sharePt.autoSlideFlag&&(c=6E3);"undefined"!==typeof c&&1E3<c&&(b.autoSlide=c);a.contentWindow.postMessage(JSON.stringify({method:"configure",args:[b]}),"*");a.contentWindow.postMessage(JSON.stringify({method:"toggleAutoSlide"}),"*")}a=document.getElementById("pptMessageLayout");null!=a&&(a.style.display="none");document.getElementById("urlcontainer")&&(document.getElementById("urlcontainer").style.display="block");virtualclass.sharePt.eventsObj=[]},
initStudentLayout(){const a=document.getElementById("pptiframe");virtualclass.sharePt.eventsObj=[];virtualclass.sharePt.UI.messageDisplay();null!=document.getElementById("pptiframe")?(""!=a.src&&virtualclass.sharePt.hideElement("pptMessageLayout"),a.contentWindow.postMessage(JSON.stringify({method:"configure",args:[{controls:!1,autoSlide:0,autoSlideStoppable:!0,keyboard:!1,progress:!1,touch:!1}]}),"*")):virtualclass.sharePt.displayElement("pptMessageLayout");virtualclass.sharePt.hideElement("urlcontainer")},
hideElement(a){a=document.getElementById(a);null!=a&&(a.style.display="none")},displayElement(a){a=document.getElementById(a);null!=a&&(a.style.display="block")},attachEvent(a,b,c){document.getElementById(a);a=document.getElementById(a);null!=a&&a.addEventListener(b,c)},attachMessageEvent(a,b){d.addEventListener(a,b)},UI:{id:"virtualclassSharePresentation",class:"virtualclass",container(){const a={control:!!roles.hasControls()},b=virtualclass.getTemplate("ppt","ppt");virtualclass.vutil.insertAppLayout(b(a))},
createIframe(){var a=document.getElementById("iframecontainer");null!=a&&a.parentNode.removeChild(a);a=virtualclass.getTemplate("pptiframe","ppt");document.querySelector("#virtualclassSharePresentation").insertAdjacentHTML("beforeend",a())},messageDisplay(){var a=document.getElementById("pptMessageLayout");a&&a.parentNode.removeChild(a);a=virtualclass.getTemplate("mszdisplay","ppt");document.querySelector("#virtualclassSharePresentation").insertAdjacentHTML("beforeend",a())},removeIframe(){const a=
document.getElementById("pptiframe");a&&a.parentNode.removeChild(a)}}}}})(window);(function(d){var c={requestPackets(a){1<a.length&&(virtualclass.wb[virtualclass.gObj.currWb].gObj.myArr=a);virtualclass.wb[virtualclass.gObj.currWb].sentReq=!0;return[0==virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId?0:virtualclass.wb[virtualclass.gObj.currWb].gObj.rcvdPackId,a[0].uid]},makeQueue(a){virtualclass.wb[virtualclass.gObj.currWb].gObj.queue[a.uid]=a},sendPackets(a,b){if(0==a.message.getMsPckt[0])var c=-1;else for(c=0;c<virtualclass.wb[virtualclass.gObj.currWb].gObj.myrepObj.length&&
a.message.getMsPckt[0]!=virtualclass.wb[virtualclass.gObj.currWb].gObj.myrepObj[c].uid;c++);for(c+=1;c<a.message.getMsPckt[1];c++)b.push(virtualclass.wb[virtualclass.gObj.currWb].gObj.myrepObj[c]);return b},handleMissedPackets(a,b,f){f=this.removeDupObjs(f);virtualclass.wb[virtualclass.gObj.currWb].gObj.replayObjs=virtualclass.wb[virtualclass.gObj.currWb].gObj.replayObjs.concat(f);c.sortingReplyObjs();a!=b&&virtualclass.storage.store(JSON.stringify(virtualclass.wb[virtualclass.gObj.currWb].gObj.replayObjs));
this.containsIfQueuePacks(a,b,virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId,f)},removeDupObjs(a){0<virtualclass.wb[virtualclass.gObj.currWb].gObj.myArr.length&&(a[a.length-1].uid==virtualclass.wb[virtualclass.gObj.currWb].gObj.myArr[0].uid&&(virtualclass.wb[virtualclass.gObj.currWb].gObj.myArr[0].hasOwnProperty("cmd")||virtualclass.wb[virtualclass.gObj.currWb].gObj.myArr.shift()),a=a.concat(virtualclass.wb[virtualclass.gObj.currWb].gObj.myArr),virtualclass.wb[virtualclass.gObj.currWb].gObj.myArr=
[]);return a},containsIfQueuePacks(a,b,c,g){a!=b&&c+1!=g[0].uid&&0<virtualclass.wb[virtualclass.gObj.currWb].gObj.packQueue.length&&g[g.length-1].uid==virtualclass.wb[virtualclass.gObj.currWb].gObj.packQueue[0].uid&&(virtualclass.wb[virtualclass.gObj.currWb].gObj.packQueue=g.concat(virtualclass.wb[virtualclass.gObj.currWb].gObj.packQueue))},sortingReplyObjs(){virtualclass.wb[virtualclass.gObj.currWb].gObj.replayObjs=virtualclass.wb[virtualclass.gObj.currWb].gObj.replayObjs.sort((a,b)=>a.uid-b.uid)}};
d.bridge=c})(window);(function(d){d.Optimize=function(c){const {vcan:a}=virtualclass.wb[c];a.optimize={sendPacketWithOptimization(a,c){const b=virtualclass.gObj.currWb;"undefined"===typeof this.lastarrowtime&&(this.lastarrowtime=(new Date).getTime(),io.webSocketConnected()&&virtualclass.vutil.beforeSend(JSON.parse(a)),virtualclass.wb[b].utility.updateSentInformation(a,!0));this.presentarrowtime=(new Date).getTime();this.presentarrowtime-this.lastarrowtime>=c&&(io.webSocketConnected()&&(c=JSON.parse(a),c.hasOwnProperty("createArrow")?
ioAdapter.send(c):ioAdapter.mustSend(c)),virtualclass.wb[b].utility.updateSentInformation(a,!0),this.lastarrowtime=(new Date).getTime())},doOptiMize(b){"move"==a.main.action&&roles.hasControls()&&(b=a.utility.updateCordinate(b));if("undefined"===typeof virtualclass.gObj.lastmousemovetime||null==virtualclass.gObj.lastmousemovetime)virtualclass.gObj.lastmousemovetime=(new Date).getTime(),b.detail.hasOwnProperty("cevent")||a.optimize.calculatePackets(virtualclass.gObj.lastmousemovetime,"m",b.clientX-
a.main.offset.x,b.clientY-a.main.offset.y);virtualclass.gObj.presentmousemovetime=(new Date).getTime();2E3<=virtualclass.gObj.presentmousemovetime-virtualclass.gObj.lastmousemovetime&&((new Date).getTime(),b.detail.hasOwnProperty("cevent")||a.optimize.calculatePackets(virtualclass.gObj.lastmousemovetime,"m",b.clientX-a.main.offset.x,b.clientY-a.main.offset.y),a.optimize.calculatePackets(virtualclass.gObj.lastmousemovetime,"m",b.clientX-a.main.offset.x,b.clientY-a.main.offset.y),virtualclass.gObj.lastmousemovetime=
(new Date).getTime())},calculatePackets(b,c,g,d,m){g/=virtualclass.zoom.canvasScale;d/=virtualclass.zoom.canvasScale;const f=virtualclass.gObj.currWb;b=a.makeStackObj(b,c,g,d);"undefined"!==typeof m&&(b.foundText=!0);virtualclass.wb[f].uid++;b.uid=virtualclass.wb[f].uid;a.main.replayObjs.push(b);virtualclass.vutil.beforeSend({repObj:[b],cf:"repObj"});virtualclass.storage.store(JSON.stringify(a.main.replayObjs))}}}})(window);(function(d){d.response={reclaimRole(c,a){c!=a&&(virtualclass.user.control._assign(a,"notsent",c),virtualclass.user.displayStudentSpeaker(!0),null!=localStorage.getItem("aId")&&localStorage.removeItem("aId"),virtualclass.user.control.removeAudioFromParticipate(c),"mobTab"==virtualclass.system.device&&((virtualclass.system.mybrowser.name=8<=virtualclass.system.mybrowser.version)&&/(iPad)/g.test(navigator.userAgent)&&virtualclass.vutil.enableVirtualClass(),virtualclass.view.removeErrorMsg("errorContainer",
!0)))},assignRole(c,a,b){if(c!=a||"undefined"!==typeof b)if(virtualclass.vutil.assignRole(a),virtualclass.wb[virtualclass.gObj.currWb].utility.uniqueArrOfObjsToTeacher(),roles.hasAdmin())c=document.getElementById("chat_div").getElementsByClassName("currTeacher")[0],null!=c&&virtualclass.user.control.removeCurrTeacherFromControl(c.id),virtualclass.user.control.changeAttrToAssign("enable");else{virtualclass.vutil.removeSessionTool();a=chatContainerEvent.elementFromShadowDom(`#ml${c}`);b=["assign"];
const f=document.getElementById(`${c}ControlContainer`);null!=f?virtualclass.user.createAssignControl(f,c,!0):(b=virtualclass.user.createControl(c,b),a.appendChild(b));localStorage.setItem("aId",c)}virtualclass.vutil.attachClickOutSideCanvas();"mobTab"==virtualclass.system.device&&(virtualclass.vutil.disableVirtualClass(),virtualclass.view.createErrorMsg(virtualclass.lang.getString("supportDesktop"),"errorContainer","chatWidget"))},clearAll(c,a,b,f){c!=a&&(virtualclass.wb[virtualclass.gObj.currWb].tool=
new virtualclass.wb[virtualclass.gObj.currWb].tool_obj("t_clearall"),virtualclass.wb[virtualclass.gObj.currWb].utility.t_clearallInit(),virtualclass.wb[virtualclass.gObj.currWb].utility.makeDefaultValue(),virtualclass.storage.wbDataRemove(virtualclass.gObj.currWb))},replayAll(){d.virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs=virtualclass.wb[virtualclass.gObj.currWb].gObj.replayObjs;virtualclass.wb[virtualclass.gObj.currWb].utility.clearAll(!1);virtualclass.wb[virtualclass.gObj.currWb].toolInit("t_replay",
"fromFile")},createArrow(c){const a=virtualclass.gObj.currWb,b=virtualclass.wb[a].arrImg,f={};f.mp={x:c.x*virtualclass.zoom.canvasScale,y:c.y*virtualclass.zoom.canvasScale};document.querySelector(`#canvasWrapper${a}`);virtualclass.posY=f.mp.y;virtualclass.posX=f.mp.x;virtualclass.wb[virtualclass.gObj.currWb].utility.drawArrowImg(b,f);null!=virtualclass.pdfRender[a].scroll.Y&&virtualclass.pdfRender[a].customMoustPointer({y:virtualclass.posY},"Y",virtualclass.posY);null!=virtualclass.pdfRender[a].scroll.X&&
virtualclass.pdfRender[a].customMoustPointer({x:virtualclass.posX},"X",virtualclass.posX)},replayObj2(c){d.virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs=[];0<c.length&&(virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId+1==c[0].uid?(d.virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs=c,console.log(`Whiteboard:-  recieved ${c[c.length-1].uid}`),virtualclass.wb[virtualclass.gObj.currWb].toolInit("t_replay","fromBrowser",!0,virtualclass.wb[virtualclass.gObj.currWb].utility.dispQueuePacket)):
console.log(`Whiteboard:- Problem between display id ${virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId} and recived first packet${c[0].uid}`))},replayObj(c){d.virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs=[];0<c.length&&(d.virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs=c,virtualclass.wb[virtualclass.gObj.currWb].toolInit("t_replay","fromBrowser",!0,virtualclass.wb[virtualclass.gObj.currWb].utility.dispQueuePacket))},chunk(c,a,b){virtualclass.wb[virtualclass.gObj.currWb].bridge.handleMissedPackets(c,
a,b)},repObjForMissedPkts(c){(0!==virtualclass.wb[virtualclass.gObj.currWb].gObj.rcvdPackId||0<virtualclass.wb[virtualclass.gObj.currWb].uid&&0===virtualclass.wb[virtualclass.gObj.currWb].gObj.rcvdPackId)&&("object"===typeof c||c instanceof Array)&&c[0].hasOwnProperty("uid")&&!c.hasOwnProperty("chunk")&&(Number(virtualclass.wb[virtualclass.gObj.currWb].gObj.rcvdPackId+1)<Number(c[0].uid)||virtualclass.wb[virtualclass.gObj.currWb].gObj.rcvdPackId!=virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId)&&
(c=virtualclass.wb[virtualclass.gObj.currWb].bridge.requestPackets(c),virtualclass.vutil.beforeSend({getMsPckt:c,cf:"getMsPckt"}))}}})(window);var LZString={_f:String.fromCharCode,_keyStrBase64:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_keyStrUriSafe:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",_getBaseValue(d,c){LZString._baseReverseDic||(LZString._baseReverseDic={});if(!LZString._baseReverseDic[d]){LZString._baseReverseDic[d]={};for(let a=0;a<d.length;a++)LZString._baseReverseDic[d][d[a]]=a}return LZString._baseReverseDic[d][c]},compressToBase64(d){if(null==d)return"";d=LZString._compress(d,
6,c=>LZString._keyStrBase64.charAt(c));switch(d.length%4){default:case 0:return d;case 1:return`${d}===`;case 2:return`${d}==`;case 3:return`${d}=`}},decompressFromBase64(d){return null==d?"":""==d?null:LZString._decompress(d.length,32,c=>LZString._getBaseValue(LZString._keyStrBase64,d.charAt(c)))},compressToUTF16(d){return null==d?"":`${LZString._compress(d,15,c=>String.fromCharCode(c+32))} `},decompressFromUTF16(d){return null==d?"":""==d?null:LZString._decompress(d.length,16384,c=>d.charCodeAt(c)-
32)},compressToUint8Array(d){d=LZString.compress(d);const c=new Uint8Array(2*d.length);for(let a=0,b=d.length;a<b;a++){const b=d.charCodeAt(a);c[2*a]=b>>>8;c[2*a+1]=b%256}return c},decompressFromUint8Array(d){if(null===d||void 0===d)return LZString.decompress(d);const c=Array(d.length/2);for(let a=0,f=c.length;a<f;a++)c[a]=256*d[2*a]+d[2*a+1];const a=[];c.forEach(b=>{a.push(String.fromCharCode(b))});return LZString.decompress(a.join(""))},compressToEncodedURIComponent(d){return null==d?"":LZString._compress(d,
6,c=>LZString._keyStrUriSafe.charAt(c))},decompressFromEncodedURIComponent(d){if(null==d)return"";if(""==d)return null;d=d.replace(/ /g,"+");return LZString._decompress(d.length,32,c=>LZString._getBaseValue(LZString._keyStrUriSafe,d.charAt(c)))},compress(d){return LZString._compress(d,16,c=>String.fromCharCode(c))},_compress(d,c,a){if(null==d)return"";let b,f;const g={},k={};let m,n,q="",r=2,z=3,t=2;const u=[];let p=0,v=0,B;for(B=0;B<d.length;B+=1)if(m=d[B],Object.prototype.hasOwnProperty.call(g,
m)||(g[m]=z++,k[m]=!0),n=q+m,Object.prototype.hasOwnProperty.call(g,n))q=n;else{if(Object.prototype.hasOwnProperty.call(k,q)){if(256>q.charCodeAt(0)){for(b=0;b<t;b++)p<<=1,v==c-1?(v=0,u.push(a(p)),p=0):v++;f=q.charCodeAt(0);for(b=0;8>b;b++)p=p<<1|f&1,v==c-1?(v=0,u.push(a(p)),p=0):v++,f>>=1}else{f=1;for(b=0;b<t;b++)p=p<<1|f,v==c-1?(v=0,u.push(a(p)),p=0):v++,f=0;f=q.charCodeAt(0);for(b=0;16>b;b++)p=p<<1|f&1,v==c-1?(v=0,u.push(a(p)),p=0):v++,f>>=1}r--;0==r&&(r=Math.pow(2,t),t++);delete k[q]}else for(f=
g[q],b=0;b<t;b++)p=p<<1|f&1,v==c-1?(v=0,u.push(a(p)),p=0):v++,f>>=1;r--;0==r&&(r=Math.pow(2,t),t++);g[n]=z++;q=String(m)}if(""!==q){if(Object.prototype.hasOwnProperty.call(k,q)){if(256>q.charCodeAt(0)){for(b=0;b<t;b++)p<<=1,v==c-1?(v=0,u.push(a(p)),p=0):v++;f=q.charCodeAt(0);for(b=0;8>b;b++)p=p<<1|f&1,v==c-1?(v=0,u.push(a(p)),p=0):v++,f>>=1}else{f=1;for(b=0;b<t;b++)p=p<<1|f,v==c-1?(v=0,u.push(a(p)),p=0):v++,f=0;f=q.charCodeAt(0);for(b=0;16>b;b++)p=p<<1|f&1,v==c-1?(v=0,u.push(a(p)),p=0):v++,f>>=1}r--;
0==r&&(r=Math.pow(2,t),t++);delete k[q]}else for(f=g[q],b=0;b<t;b++)p=p<<1|f&1,v==c-1?(v=0,u.push(a(p)),p=0):v++,f>>=1;r--;0==r&&t++}f=2;for(b=0;b<t;b++)p=p<<1|f&1,v==c-1?(v=0,u.push(a(p)),p=0):v++,f>>=1;for(;;)if(p<<=1,v==c-1){u.push(a(p));break}else v++;return u.join("")},decompress(d){return null==d?"":""==d?null:LZString._decompress(d.length,32768,c=>d.charCodeAt(c))},_decompress(d,c,a){const b=[];let f=4,g=4,k=3;const m=[];var n;let q,r,z,t;const u=LZString._f;var p=a(0),v=c,B=1;for(n=0;3>n;n+=
1)b[n]=n;q=0;z=Math.pow(2,2);for(t=1;t!=z;)r=p&v,v>>=1,0==v&&(v=c,p=a(B++)),q|=(0<r?1:0)*t,t<<=1;switch(q){case 0:q=0;z=Math.pow(2,8);for(t=1;t!=z;)r=p&v,v>>=1,0==v&&(v=c,p=a(B++)),q|=(0<r?1:0)*t,t<<=1;var C=u(q);break;case 1:q=0;z=Math.pow(2,16);for(t=1;t!=z;)r=p&v,v>>=1,0==v&&(v=c,p=a(B++)),q|=(0<r?1:0)*t,t<<=1;C=u(q);break;case 2:return""}n=b[3]=C;for(m.push(C);;){if(B>d)return"";q=0;z=Math.pow(2,k);for(t=1;t!=z;)r=p&v,v>>=1,0==v&&(v=c,p=a(B++)),q|=(0<r?1:0)*t,t<<=1;switch(C=q){case 0:q=0;z=Math.pow(2,
8);for(t=1;t!=z;)r=p&v,v>>=1,0==v&&(v=c,p=a(B++)),q|=(0<r?1:0)*t,t<<=1;b[g++]=u(q);C=g-1;f--;break;case 1:q=0;z=Math.pow(2,16);for(t=1;t!=z;)r=p&v,v>>=1,0==v&&(v=c,p=a(B++)),q|=(0<r?1:0)*t,t<<=1;b[g++]=u(q);C=g-1;f--;break;case 2:return m.join("")}0==f&&(f=Math.pow(2,k),k++);if(b[C])C=b[C];else if(C===g)C=n+n[0];else return null;m.push(C);b[g++]=n+C[0];f--;n=C;0==f&&(f=Math.pow(2,k),k++)}}};"undefined"!==typeof module&&null!=module&&(module.exports=LZString);window.addEventListener("message",d=>{if(d.origin==window.location.origin)if("gotScreen"==d.data.type){let c;if(""===d.data.sourceId){d=Error("NavigatorUserMediaError");d.name="PERMISSION_DENIED";if(virtualclass.hasOwnProperty("ss"))virtualclass.ss.onError(d);if("SharePresentation"==virtualclass.currApp||"DocumentShare"==virtualclass.currApp)d=document.querySelector("#dashboardnav button"),null!=d&&d.click();roles.hasControls()&&virtualclass.vutil.initDefaultApp()}else c=c||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",
chromeMediaSourceId:d.data.sourceId,maxWidth:1440,maxHeight:9999},optional:[{maxFrameRate:3},{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},virtualclass.adpt=new virtualclass.adapter,virtualclass.adpt.init(navigator).getUserMedia(c,a=>{virtualclass.ss._init();virtualclass.ss.initializeRecorder.call(virtualclass.ss,a)},a=>{virtualclass.ss.onError.call(virtualclass.ss,a)});if(d=document.querySelector("#virtualclassScreenShareLocalSmall"))d.style.display="block"}else"getScreenPending"==d.data.type?
window.clearTimeout(d.data.id):"yes"==d.data.type&&(virtualclass.gObj.ext=!0)});(function(d){d.dirtyCorner={decodeRGB(c,a,b){a=a.createImageData(b.width,b.height);for(b=0;b<4*c.length;b++)a.data[4*b]=36.5*(c[b]>>5),a.data[4*b+1]=36.5*((c[b]&28)>>2),a.data[4*b+2]=85*(c[b]&3),a.data[4*b+3]=255;return a},decodeRGBSlice(c,a,b){a=a.createImageData(b.w,b.h);for(b=0;b<4*c.length;b++)a.data[4*b]=36.5*(c[b]>>5),a.data[4*b+1]=36.5*((c[b]&28)>>2),a.data[4*b+2]=85*(c[b]&3),a.data[4*b+3]=255;return a},encodeRGB(c){const a=c.length/4,b=new Uint8ClampedArray(a);let f,g;for(let k=0;k<a;k++){var d=
c[4*k];f=c[4*k+1];g=c[4*k+2];d=(Math.round(d/36.5)<<5)+(Math.round(f/36.5)<<2)+Math.round(g/85);b[k]=d}return b},str2ImageData(c,a){a=context2.createImageData(a.w,a.h);var b=new ArrayBuffer(c.length);a.data=new Uint8Array(b);for(b=0;b<strLen;b++)a.data[b]=c.charCodeAt(b);return a},doClearCanvas(){context2.clearRect(0,0,canvas2.width,canvas2.height)}}})(window);(function(d){d.vutil={createDOM(c,a,b){c=document.createElement(c);"undefined"!==typeof a&&(c.id=a);if("undefined"!==typeof b){a="";if(0<b.length)for(let c=0;c<b.length;c++)a+=`${b[c]} `;c.className=a}return c},ab2str(c){return String.fromCharCode.apply(null,new Uint8ClampedArray(c))},str2ab(c){var a=new ArrayBuffer(c.length);a=new Uint8ClampedArray(a);for(let b=0,f=c.length;b<f;b++)a[b]=c.charCodeAt(b);return a},sidebarHeightInit(){document.getElementById("widgetRightSide").style.height=`${d.innerHeight}px`},
isSystemCompatible(){if(0<virtualclass.error.length){const c=1<virtualclass.error.length?virtualclass.error.join("<br />"):virtualclass.error[0];virtualclass.view.createErrorMsg(c,"errorContainer","chatWidget");virtualclass.gObj.hasOwnProperty("errIE")&&virtualclass.vutil.disableVirtualClass();virtualclass.gObj.hasOwnProperty("audIntDisable")&&virtualclass.user.control.mediaWidgetDisable();virtualclass.gObj.hasOwnProperty("errNotDesktop")&&(virtualclass.user.control.mediaWidgetDisable(),virtualclass.vutil.disableVirtualClass())}else(virtualclass.gObj.hasOwnProperty("audIntDisable")||
virtualclass.gObj.hasOwnProperty("vidIntDisable"))&&virtualclass.user.control.mediaWidgetDisable()},chkValueInLocalStorage(c){return null===localStorage.getItem(c)?!1:localStorage[c]},setContainerWidth(c,a){},setScreenInnerTagsWidth(c){document.getElementById(c);document.getElementById(`${c}Local`);document.getElementById(`${c}LocalVideo`)},makeActiveApp(c,a){if(c!=a&&"undefined"!==typeof a)a+="Tool",document.getElementById(a).className=virtualclass.vutil.removeClassFromElement(a,"active");else{a=
document.getElementsByClassName("appOptions");for(let b=0;b<a.length;b++)a[b].classList.contains("active")&&a[b].classList.remove("active")}document.getElementById(`${c}Tool`).className+=" active"},initInstallChromeExt(c){"EXTENSION_UNAVAILABLE"==c.name&&(console.log("ask for inline installation"),this._inlineChomeExtensionStore())},_inlineChomeExtensionStore(){chrome.webstore.install("https://chrome.google.com/webstore/detail/ijhofagnokdeoghaohcekchijfeffbjl",c=>{d.location.reload()},c=>{alert(c)})},
removeAppPanel(){const c=document.getElementById("virtualclassOptionsCont");null!=c&&c.parentNode.removeChild(c)},removeTempVideo(c){c=document.getElementById(c);c.parentNode.removeChild(c)},createLocalTempVideo(c,a){if("string"===typeof c||"String"===typeof c)c=document.getElementById(c);const b=virtualclass.vutil.createDOM("div",a);a=virtualclass.vutil.createDOM("canvas",`${a}Video`);b.appendChild(a);c.appendChild(b)},initLocCanvasCont(c){let a;a="ScreenShare"==virtualclass.currApp?"ss":"wss";virtualclass[a].localtempCanvas=
document.getElementById(c);console.log(virtualclass[a].localtempCanvas);virtualclass[a].localtempCont=virtualclass[a].localtempCanvas.getContext("2d")},videoTeacher2Student(c,a){let b=c;const f=document.getElementById(`virtualclass${c}LocalVideo`);if(null!=f&&"VIDEO"==f.tagName){const g=document.createElement("canvas");g.id=f.id;g.width=f.offsetWidth;g.height=f.offsetHeight;f.parentNode.replaceChild(g,f);"ScreenShare"==b&&(b="ss");"undefined"!==typeof a||"undefined"===typeof b||"ss"!=b&&"wss"!=b||
(virtualclass[b].localCanvas=g,virtualclass[b].localCont=virtualclass[b].localCanvas.getContext("2d"),a=virtualclass[b].localtempCont.getImageData(0,0,virtualclass[b].localtempCanvas.width,virtualclass[b].localtempCanvas.height),virtualclass[b].localCont.putImageData(a,0,0));virtualclass.vutil.removeTempVideo(`virtualclass${c}LocalTemp`)}},clickOutSideCanvas(){this.exitTextWrapper()&&virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.textUtility(virtualclass.wb[virtualclass.gObj.currWb].gObj.spx,
virtualclass.wb[virtualclass.gObj.currWb].gObj.spy)},exitTextWrapper(){return 0<document.getElementsByClassName("textBoxContainer").length},attachClickOutSideCanvas(){function c(a){a=document.getElementById(a);null!=a&&(a.onclick=function(){roles.hasControls()&&virtualclass.vutil.clickOutSideCanvas()})}c("commandToolsWrapper");c("virtualclassOptionsCont");c("audioWidget");c("chatWidget")},dimensionMatch(c,a){c=document.getElementById(c).offsetWidth;const b=document.getElementById("virtualclassOptionsCont").offsetWidth;
a=document.getElementById(a);return null!=a?a.offsetWidth+b==c:!1},disableAppsBar(){const c=document.getElementById("virtualclassOptionsCont");null!=c&&(c.style.pointerEvents="none")},isObjectEmpty(c){for(const a in c)if(c.hasOwnProperty(a))return!1;return!0},removeSessionTool(){if(!roles.hasAdmin()){const c=document.getElementById("virtualclassSessionEndTool");null!=c&&c.parentNode.removeChild(c)}},Fullscreen(){const c=document.getElementById("virtualclassCont");c.requestFullscreen?c.requestFullscreen():
c.mozRequestFullScreen?c.mozRequestFullScreen():c.webkitRequestFullscreen?c.webkitRequestFullscreen():c.msRequestFullscreen&&c.msRequestFullscreen();c.classList.add("fullScreenMode")},closeFullscreen(){const c=document.getElementById("virtualclassCont");document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen();c.classList.remove("fullScreenMode")},
addClass(c,a){const b=document.getElementById(c);virtualclass.vutil.elemHasAnyClass(c)?b.classList.add(a):b.className=a},removeClass(c,a){const b=document.getElementById(c);virtualclass.vutil.elemHasAnyClass(c)&&b.classList.contains(a)&&b.classList.remove(a)},breakIntoBytes(c,a){c=c.toString();for(let b=c.length;b<a;b++)c=`0${c}`;return c.match(/[\S]{1,2}/g)||[]},numValidateFour(c,a,b,f){c=this.preNumValidateTwo(c);a=this.preNumValidateTwo(a);b=this.preNumValidateTwo(b);f=this.preNumValidateTwo(f);
return parseInt(c+a+b+f)},numValidateTwo(c,a){c=this.preNumValidateTwo(c);a=this.preNumValidateTwo(a);return parseInt(c+a)},preNumValidateTwo(c){c=c.toString();if(1==c.length)return`0${c}`;if(2==c.length)return c},elemHasAnyClass(c){c=document.getElementById(c);return null!=c?"undefined"!==typeof c.classList:!1},userIsOrginalTeacher(c){return roles.hasAdmin()},isUserTeacher(c){return roles.hasControls()},initDisableAudVid(){virtualclass.gObj.audIntDisable=!0;virtualclass.gObj.vidIntDisable=!0},initDisableVirtualClass(){this.initDisableAudVid();
virtualclass.gObj.errNotDesktop=!0;virtualclass.gObj.errNotScreenShare=!0;virtualclass.gObj.errAppBar=!0},disableVirtualClass(){const c=document.getElementById("virtualclassCont");c.style.opacity=.6;c.style.pointerEvents="none"},enableVirtualClass(){const c=document.getElementById("virtualclassCont");c.style.opacity=1;c.style.pointerEvents="visible"},firstiOSaudioCall(){virtualclass.gObj.hasOwnProperty("audioPlayMessage")&&(virtualclass.gObj.iosIpadbAudTrue=!0,virtualclass.media.audio.receivedAudioProcess(virtualclass.gObj.audioPlayMessage))},
beforeLoad:async function(){if(virtualclass.isPlayMode)console.log("==== Clear Session PlayMode");else{if("DocumentShare"===virtualclass.currApp){if(!roles.hasControls()){var c=document.querySelector("#virtualclassCont.congrea #icHr").getAttribute("data-action");if("disable"==c){const a=virtualclass.vutil.whoIsTeacher();ioAdapter.sendUser({data:{user:wbUser.id,action:c},cf:"raiseHand"},a)}}io.disconnect()}virtualclass.gObj.windowLoading=!0;if(virtualclass.recorder.hasOwnProperty("doSessionClear"))virtualclass.clearSession();
else if(0==localStorage.length)virtualclass.storage.clearStorageData();else{console.log("screen-detail init");localStorage.setItem("executedSerial",JSON.stringify(ioMissingPackets.executedSerial));localStorage.setItem("executedUserSerial",JSON.stringify(ioMissingPackets.executedUserSerial));"undefined"!==typeof virtualclass.gObj.audioEnable&&localStorage.setItem("audEnable",JSON.stringify({ac:virtualclass.gObj.audioEnable}));localStorage.removeItem("otherRole");virtualclass.gObj.hasOwnProperty("audIntDisable")||
virtualclass.media.audio.studentNotSpeak();virtualclass.vutil.clickOutSideCanvas();localStorage.setItem(wbUser.sid,JSON.stringify(virtualclass.chat.vmstorage));virtualclass.hasOwnProperty("editorRich")&&"object"===typeof virtualclass.editorRich.vcAdapter&&virtualclass.editorRich.saveIntoLocalStorage();virtualclass.hasOwnProperty("editorCode")&&"object"===typeof virtualclass.editorCode.vcAdapter&&virtualclass.editorCode.saveIntoLocalStorage();c={name:virtualclass.vutil.capitalizeFirstLetter(virtualclass.currApp)};
console.log(virtualclass.currApp);if("ScreenShare"==virtualclass.currApp){c.name=virtualclass.gObj.defaultApp;var a=virtualclass.vutil.whoIsTeacher();virtualclass.gObj.studentSSstatus.mesharing?ioAdapter.mustSendUser({cf:"rmStdScreen"},a):roles.hasControls()&&!virtualclass.gObj.studentSSstatus.mesharing&&virtualclass.vutil.beforeSend({unshareScreen:!0,st:"ss",cf:"unshareScreen"});if(roles.isStudent()&&!virtualclass.gObj.studentSSstatus.mesharing||roles.hasControls())console.log("screen-detail is saving into storage"),
localStorage.setItem("studentSSstatus",JSON.stringify(virtualclass.gObj.studentSSstatus))}else"Yts"==virtualclass.currApp?"undefined"!==typeof virtualclass.yts.videoId&&"object"===typeof virtualclass.yts.player&&(c.metaData={init:virtualclass.yts.videoId,startFrom:virtualclass.yts.player.getCurrentTime()}):"SharePresentation"==virtualclass.currApp?"undefined"!==typeof virtualclass.sharePt&&"object"===typeof virtualclass.sharePt&&virtualclass.sharePt.pptUrl?(console.log(`beforeloadS${virtualclass.sharePt.pptUrl}`),
c.metaData={init:virtualclass.sharePt.pptUrl,startFrom:virtualclass.sharePt.state,currId:virtualclass.sharePt.currId},console.log(`start From${virtualclass.sharePt.state}`),virtualclass.sharePt.saveIntoLocalStorage(c)):c.metaData=null:"Poll"==virtualclass.currApp?(virtualclass.poll.saveInLocalStorage(),console.log("currAppPoll")):"Video"==virtualclass.currApp?(virtualclass.videoUl.player&&(a=virtualclass.videoUl.player.currentTime()),c.metaData={init:{videoId:virtualclass.videoUl.videoId,videoUrl:virtualclass.videoUl.videoUrl,
yts:virtualclass.videoUl.yts,online:virtualclass.videoUl.online,isPaused:virtualclass.videoUl.isPaused},startFrom:a,isAutoplay:virtualclass.videoUl.autoPlayFlag},console.log(c)):"DocumentShare"==virtualclass.currApp?(console.log(`previous app success ${virtualclass.currApp}`),virtualclass.dts.docs.hasOwnProperty("currDoc")?({currDoc:a}=virtualclass.dts.docs,console.log(`currentDocument ${a}`),c.metaData=0<virtualclass.dts.order.length?{init:a,slideNumber:virtualclass.dts.docs.note.currNote,order:JSON.stringify(virtualclass.dts.order)}:
{init:"layout",slideNumber:null}):c.metaData={init:"layout",slideNumber:null},0<Object.keys(virtualclass.dts.pages).length&&(c.metaData.docs=virtualclass.dts.pages)):"Quiz"===virtualclass.currApp?(virtualclass.quiz.saveInLocalStorage(),console.log("quiz data saved")):"Whiteboard"===virtualclass.currApp&&(c={name:"Whiteboard",wbn:virtualclass.gObj.wbCount});0<virtualclass.gObj.wIds.length&&localStorage.setItem("wIds",JSON.stringify(virtualclass.gObj.wIds));roles.hasControls()&&localStorage.setItem("wbOrder",
JSON.stringify(virtualclass.wbCommon.order));null!=virtualclass.zoom.canvasScale&&(a=+virtualclass.zoom.canvasScale,console.log(`Canvas pdf scale ${a}`),virtualclass.vutil.isNumeric(a),virtualclass.zoom.hasOwnProperty("canvasDimension")&&localStorage.setItem("canvasDimension",JSON.stringify(virtualclass.zoom.canvasDimension)));roles.hasView()&&"Yts"==virtualclass.currApp&&(c={name:"Yts",metaData:null});virtualclass.hasOwnProperty("dts")&&null!=virtualclass.dts&&virtualclass.dts.upateInStorage();localStorage.setItem("currSlide",
virtualclass.gObj.currSlide);localStorage.setItem("currIndex",virtualclass.gObj.currIndex);roles.hasControls()||(a=document.querySelector("#virtualclassCont.congrea #congHr.disable"))&&a.click();console.dir(`Previous object ${c}`);localStorage.setItem("prevApp",JSON.stringify(c));roles.hasControls()?localStorage.setItem("videoSwitch",virtualclass.videoHost.gObj.videoSwitch):(localStorage.setItem("stdVideoSwitch",virtualclass.videoHost.gObj.stdStopSmallVid),localStorage.setItem("allStdVideoOff",virtualclass.videoHost.gObj.allStdVideoOff));
localStorage.setItem("chatWindow",virtualclass.chat.chatWindow);this.saveWbOrder();virtualclass.isPlayMode&&localStorage.clear();"DocumentShare"!=virtualclass.currApp&&io.disconnect()}}},initOnBeforeUnload(c){"iOS"==c?document.body.onunload=function(){virtualclass.vutil.beforeLoad()}:d.onbeforeunload=function(){const a=virtualclass.vutil.smallizeFirstLetter(virtualclass.currApp);virtualclass.vutil.beforeLoad();if(("editorRich"==a||"editorCode"==a)&&"Synchronized"!=virtualclass[a].cmClient.state.constructor.name)return virtualclass.lang.getString("editorinsync")}},
isPlayMode(){return 1==d.wbUser.virtualclassPlay},progressBar(c,a,b,f){a>c&&(a=c,document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("playsessionmsg"));c=0==c&&0==a?0:Math.round(100*a/c);document.getElementById(b).style.width=`${c}%`;document.getElementById(f).innerHTML=`${c}%`},hidePrevIcon(c){const a=document.getElementById(virtualclass.previous);null!=a&&(a.style.display="none",console.log(`Hide previous screen with display new ${c}`),"ss"==c?"object"===typeof virtualclass[c]&&
(document.getElementById(virtualclass[c].id).style.display="block"):document.getElementById(virtualclass[c].id).style.display="block")},getUserInfo(c,a,b){for(let f=0;f<b.length;f++)if(b[f].userid==a)return b[f][c]},getUserAllInfo(c,a){if("undefined"!==typeof c&&"undefined"!==typeof a){for(let b=0;b<a.length;b++)if(a[b].userid==c)return a[b];return!1}console.log("Error user is not found");return!1},smallizeFirstLetter(c){return c.charAt(0).toLowerCase()+c.slice(1)},capitalizeFirstLetter(c){return c.charAt(0).toUpperCase()+
c.slice(1)},removeClassFromElement(c,a){c=document.getElementById(c);if(null!==c&&0<c.classList.length)return c.classList.remove(a),c.className},beforeSend(c,a,b){const f=virtualclass.gObj.currWb;if(c.hasOwnProperty("createArrow"))c=JSON.stringify(c),virtualclass.wb[f].vcan.optimize.sendPacketWithOptimization(c,300);else{if(c.hasOwnProperty("repObj")){if("undefined"===typeof c.repObj[c.repObj.length-1])return;virtualclass.wb[f].gObj.rcvdPackId=c.repObj[c.repObj.length-1].uid;virtualclass.wb[f].gObj.displayedObjId=
virtualclass.wb[f].gObj.rcvdPackId}JSON.stringify(c);"undefined"!==typeof b&&!0===b?"undefined"===typeof a||!1===a||null===a?ioAdapter.send(c):ioAdapter.sendUser(c,a):"undefined"===typeof a||!1===a||null===a?ioAdapter.mustSend(c):ioAdapter.mustSendUser(c,a)}},breakintobytes(c,a){c=c.toString();for(let b=c.length;b<a;b++)c=`0${c}`;return c.match(/[\S]{1,2}/g)||[]},createReclaimButton(c){this.createDiv("t_reclaim","educator",c);const a=this;document.getElementById("t_reclaim").getElementsByTagName("a")[0].addEventListener("click",
()=>{a._reclaimRole()})},createDiv(c,a,b,f){const g=a;a=virtualclass.lang.getString(a);const d=document.createElement("a");d.href="#";const m=document.createElement("div");m.id=c;"undefined"!==typeof f&&(m.className=f);m.dataset.tool=g;f=document.createElement("span");f.className=`icon-${g}`;d.appendChild(f);d.dataset.title=a;d.className="tooltip";m.appendChild(d);"t_reclaim"==c?(c=document.getElementById("virtualclassAppLeftPanel"),b.appendChild(m),c.insertBefore(b,c.firstChild)):b.appendChild(m)},
assignRole(c){if("object"===typeof virtualclass.wb){var {vcan:a}=virtualclass.wb[virtualclass.gObj.currWb];virtualclass.wb[virtualclass.gObj.currWb].tool="";"move"==a.main.action&&virtualclass.wb[virtualclass.gObj.currWb].utility.deActiveFrmDragDrop()}if("undefined"!==typeof c){if(roles.isEducator()){var b=document.getElementById("commandToolsWrapper_doc_0_0");b.parentNode.removeChild(b);virtualclass.vutil.removeClass("virtualclassCont","educator")}else virtualclass.vutil.addClass("virtualclassCont",
"presenter");virtualclass.gObj.uRole=roles.hasAdmin()?"t":"p";localStorage.setItem("uRole",virtualclass.gObj.uRole);virtualclass.user.assignRole(virtualclass.gObj.uRole,virtualclass.vutil.capitalizeFirstLetter(virtualclass.currApp),c);"object"===typeof virtualclass.wb&&a.utility.canvasCalcOffset(a.main.canid);"Yts"==virtualclass.currApp?(c=document.getElementById("virtualclassYts"),null!=c?null==document.getElementById("player")&&virtualclass.yts.UI.createPlayerTag(c):virtualclass.yts.UI.container(),
virtualclass.yts.UI.inputURL(),"object"===typeof virtualclass.yts.player?virtualclass.yts.seekChangeInterval():console.log("Player object is not ready")):"SharePresentation"==virtualclass.currApp&&(null!=document.getElementById("virtualclassSharePresentation")?null==document.getElementById("iframecontainer")&&virtualclass.sharePt.UI.createIframe():virtualclass.sharePt.UI.container(),roles.hasControls()&&virtualclass.sharePt.initTeacherLayout(),roles.hasView()&&(virtualclass.sharePt.eventsObj=[]),
virtualclass.sharePt.attachEvent("submitpurl","click",virtualclass.sharePt.initNewPpt),virtualclass.sharePt.attachMessageEvent("message",virtualclass.sharePt.pptMessageEventHandler))}else{"Yts"==virtualclass.currApp&&(virtualclass.yts.UI.removeinputURL(),virtualclass.yts.hasOwnProperty("tsc")&&clearInterval(virtualclass.yts.tsc));"SharePresentation"==virtualclass.currApp&&(roles.hasControls()&&virtualclass.sharePt.initStudentLayout(),roles.hasView()&&(virtualclass.sharePt.eventsObj=[],virtualclass.sharePt.hideElement("pptMessageLayout"),
virtualclass.sharePt.UI.createUrlContainer(),virtualclass.sharePt.displayElement("urlcontainer")),virtualclass.sharePt.attachEvent("submitpurl","click",virtualclass.sharePt.initNewPpt),virtualclass.sharePt.attachMessageEvent("message",virtualclass.sharePt.pptMessageEventHandler));virtualclass.gObj.uRole=roles.hasAdmin()?"e":"s";b=document.getElementById("commandToolsWrapper_doc_0_0");if(null!=b)for(;b.hasChildNodes();)b.removeChild(b.lastChild);else b=virtualclass.vutil.createRoleWrapper();"object"===
typeof virtualclass.wb&&virtualclass.wb[virtualclass.gObj.currWb].utility.makeCanvasDisable();roles.hasAdmin()?(document.getElementById("virtualclassCont"),virtualclass.vutil.createReclaimButton(b),virtualclass.vutil.addClass("virtualclassCont","educator")):(virtualclass.vutil.removeClass("virtualclassCont","presenter"),b=document.querySelector("#commandToolsWrapper_doc_0_0"),null!=b&&b.parentNode.removeChild(b));localStorage.setItem("uRole",virtualclass.gObj.uRole);"object"===typeof virtualclass.wb&&
virtualclass.wb[virtualclass.gObj.currWb].utility.uniqueArrOfObjsToStudent()}virtualclass.system.setAppDimension();virtualclass.vutil.renderWhiteboardObjectsIfAny();roles.hasAdmin()?virtualclass.uInfo.userobj.role=virtualclass.gObj.uRole:(io.disconnect(),setTimeout(()=>{virtualclass.uInfo.userobj.role=virtualclass.gObj.uRole;io.init(virtualclass.uInfo)},500))},renderWhiteboardObjectsIfAny(){"object"===typeof virtualclass.wb&&0<virtualclass.wb[virtualclass.gObj.currWb].vcan.main.children.length&&virtualclass.wb[virtualclass.gObj.currWb].vcan.renderAll()},
createCommandWrapper(c){var {vcan:a}=virtualclass.wb[c];const b=document.createElement("div");b.id=virtualclass.gObj.commandToolsWrapperId[c];b.className="commandToolsWrapper";a=document.getElementById(a.canvasWrapperId);null!=a?document.getElementById(`containerWb${c}`).insertBefore(b,a):document.getElementById(`containerWb${c}`).appendChild(b);return b},createRoleWrapper(){const c=document.createElement("div");c.id="commandToolsWrapper_doc_0_0";c.className="commandToolsWrapper";return c},_reclaimRole(){virtualclass.vutil.beforeSend({reclaimRole:!0,
cf:"reclaimRole"});const c=document.getElementById("t_reclaim");c.style.pointerEvents="none";c.style.opacity="0.5";const a=this;setTimeout(()=>{a.reclaimRole();virtualclass.user.control.changeAttrToAssign("enable")},2E3)},reclaimRole(){virtualclass.gObj.controlAssign=!1;this.vcResponseAssignRole(virtualclass.gObj.uid,virtualclass.gObj.uid,!0)},vcResponseAssignRole(c,a,b){if(c!=a||"undefined"!==typeof b)if(virtualclass.vutil.assignRole(a),"object"===typeof virtualclass.wb&&virtualclass.wb[virtualclass.gObj.currWb].utility.uniqueArrOfObjsToTeacher(),
roles.hasAdmin())c=document.getElementById("chat_div").getElementsByClassName("currTeacher")[0],null!=c&&virtualclass.user.control.removeCurrTeacherFromControl(c.id),virtualclass.user.control.changeAttrToAssign("enable");else{virtualclass.vutil.removeSessionTool();a=chatContainerEvent.elementFromShadowDom(`#ml${c}`);b=["assign"];const f=document.getElementById(`${c}ControlContainer`);null!=f?virtualclass.user.createAssignControl(f,c,!0):(b=virtualclass.user.createControl(c,b),a.appendChild(b));localStorage.setItem("aId",
c)}virtualclass.vutil.attachClickOutSideCanvas();"mobTab"==virtualclass.system.device&&(virtualclass.vutil.disableVirtualClass(),virtualclass.view.createErrorMsg(virtualclass.lang.getString("supportDesktop"),"errorContainer","chatWidget"))},vcResponseAReclaimRole(c,a){console.log("Reclaim role :- Init");if(c!=a){if("object"===typeof virtualclass.wb){var b=virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs[virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs.length-1];if("object"===
typeof b&&"del"==b.ac)console.log("Delete command:- Transferring the delete command"),virtualclass.vutil.beforeSend({repObj:[b],cf:"repObj"});else if("t_text"==virtualclass.wb[virtualclass.gObj.currWb].tool.cmd&&"create"==virtualclass.wb[virtualclass.gObj.currWb].vcan.main.action)virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.finalizeTextIfAny(!0),console.log("Text command:- Transferring text command");else if(virtualclass.wb[virtualclass.gObj.currWb].tool.hasOwnProperty("started")&&1==
virtualclass.wb[virtualclass.gObj.currWb].tool.started||"move"==virtualclass.wb[virtualclass.gObj.currWb].vcan.main.action)b=vcan.extend({},virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs[virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs.length-1]),b.ac="u",b=b.hasOwnProperty("mtext")?{detail:{cevent:{x:b.x,y:b.y,mtext:b.mtext}}}:{detail:{cevent:{x:b.x,y:b.y}}},b.detail.broadCast=!0,b=new CustomEvent("mouseup",b),vcan.main.canvas.dispatchEvent(b),console.log("Whiteboard:- Transfering the assign role to Teacher");
console.log("Role assign with reclaim")}virtualclass.user.control._assign(a,"notsent",c);console.log("Reclaim role :- peforme");virtualclass.user.displayStudentSpeaker(!0);null!=localStorage.getItem("aId")&&localStorage.removeItem("aId");virtualclass.user.control.removeAudioFromParticipate(c);"mobTab"==virtualclass.system.device&&((virtualclass.system.mybrowser.name=8<=virtualclass.system.mybrowser.version)&&/(iPad)/g.test(navigator.userAgent)&&virtualclass.vutil.enableVirtualClass(),virtualclass.view.removeErrorMsg("errorContainer",
!0))}},createReclaimButtonIfNeed(){if(roles.isEducator()){const c=virtualclass.vutil.createRoleWrapper();virtualclass.vutil.createReclaimButton(c);return!0}return!1},whoIsTeacher(){if(virtualclass.hasOwnProperty("connectedUsers"))for(let c=0;c<virtualclass.connectedUsers.length;c++)if("t"==virtualclass.connectedUsers[c].role||"e"==virtualclass.connectedUsers[c].role)return virtualclass.connectedUsers[c].userid;return 0},getMySelf(){if(virtualclass.hasOwnProperty("connectedUsers"))for(let c=0;c<virtualclass.connectedUsers.length;c++)if(virtualclass.connectedUsers[c].userid==
virtualclass.gObj.uid)return virtualclass.connectedUsers[c]},enablePresentatorEditors(c){c={toUser:c,status:!0};virtualclass.user.control.received_editorRich(c);virtualclass.user.control.received_editorCode(c)},getClassName(c){let a;"t"==c?a="teacher":"e"==c?a="educator":"s"==c?a="student":"p"==c&&(a="presenter");return a},isPresenterExist(){for(let c=0;c<virtualclass.connectedUsers.length;c++)if("p"==virtualclass.connectedUsers[c].role)return!0;return!1},setReadModeWhenTeacherIsDisConn(c){if(!roles.hasAdmin()){let a=
localStorage.getItem("oTDisconn");null!=a&&((a=JSON.parse(a))?virtualclass.hasOwnProperty(c)?"object"===typeof virtualclass[c].cm?virtualclass[c].cm.setOption("readOnly","nocursor"):console.log(`Editor CM is notvutil defined for editor ${c}`):console.log(`Editor type ${c} is not ready.`):console.log("Teacher is connected."))}},setReadModeWhenTeacherIsConn(c){localStorage.removeItem("oTDisconn");const a=document.getElementById(`${virtualclass.vutil.capitalizeFirstLetter(c)}writeModeBox`);null!=a?"true"==
a.getAttribute("data-write-mode")?virtualclass[c].cm.setOption("readOnly",!1):virtualclass[c].cm.setOption("readOnly","nocursor"):console.log(`Editor:- writemode element is not found for ${c}`)},isTeacherAlreadyExist(c){if(virtualclass.hasOwnProperty("connectedUsers"))for(let a=0;a<virtualclass.connectedUsers.length;a++)if(("t"==virtualclass.connectedUsers[a].role||"e"==virtualclass.connectedUsers[a].role)&&virtualclass.connectedUsers[a].userid!=c)return console.log(`joni Id ${c}`),!0;return!1},getPresenterId(){if(virtualclass.hasOwnProperty("connectedUsers"))for(let c=
0;c<virtualclass.connectedUsers.length;c++)if("p"==virtualclass.connectedUsers[c].role)return virtualclass.connectedUsers[c].userid;return!1},isEducatorAlreadyExist(c){if(virtualclass.hasOwnProperty("connectedUsers"))for(let a=0;a<virtualclass.connectedUsers.length;a++)if("e"==virtualclass.connectedUsers[a].role&&virtualclass.connectedUsers[a].userid!=c)return console.log(`joniId ${c}`),!0;return!1},isOrginalTeacherExist(c){if(virtualclass.hasOwnProperty("connectedUsers"))for(let a=0;a<virtualclass.connectedUsers.length;a++)if("t"==
virtualclass.connectedUsers[a].role&&virtualclass.connectedUsers[a].userid!=c)return console.log(`joniId ${c}`),!0;return!1},createBecomeTeacherWidget(){if(null==document.getElementById("beTeacher")){const a=document.createElement("div");a.id="beTeacher";var c=document.createElement("a");c.id=`${a.id}Anchor`;c.innerHTML=virtualclass.lang.getString("becomeTeacher");a.appendChild(c);c=document.getElementById("virtualclassCont");c.insertBefore(a,c.firstChild);a.addEventListener("click",virtualclass.vutil.initTeacherRole);
a.style.pointerEvents="none";a.style.opacity="0.5";setTimeout(()=>{a.style.pointerEvents="visible";a.style.opacity="1"},6E4)}},removeBecomeTeacherWidget(){const c=document.getElementById("beTeacher");null!=c&&c.parentNode.removeChild(c)},initTeacherRole(){ioAdapter.send({cf:"bt"});virtualclass.vutil.removeBecomeTeacherWidget();setTimeout(()=>{virtualclass.vutil.isOrginalTeacherExist(virtualclass.jId)?console.log("Already connected teacher"):(virtualclass.vutil.overrideRoles("t"),localStorage.setItem("beTeacher",
!0),console.log("connected teacher"));d.location.reload()},virtualclass.gObj.mySetTime)},overrideRoles(c){virtualclass.uInfo.userobj.role=c;virtualclass.gObj.uRole=virtualclass.uInfo.userobj.role;wbUser.role=virtualclass.uInfo.userobj.role;const a=document.getElementById("virtualclassCont");virtualclass.vutil.overrideRolesFromElem(a,c)},overrideRolesFromElem(c,a){"s"==a?(c.classList.remove("teacher"),c.classList.remove("orginalTeacher"),c.classList.remove("presenter"),c.classList.remove("educator"),
virtualclassCont.classList.add("student")):"p"==a?(c.classList.remove("teacher"),c.classList.remove("orginalTeacher"),c.classList.remove("educator"),virtualclassCont.classList.add("student"),virtualclassCont.classList.add("presenter")):"e"==a?(c.classList.add("teacher"),c.classList.remove("student"),c.classList.remove("presenter"),c.classList.add("educator"),c.classList.add("orginalTeacher")):"t"==a&&(c.classList.remove("student"),c.classList.remove("educator"),c.classList.remove("presenter"),c.classList.add("teacher"),
c.classList.add("orginalTeacher"),console.log("add Teacher"))},sesionEndMsgBoxIsExisting(){const c=document.getElementById("sessionEndMsgCont");return c.hasAttribute("data-displaying")&&"true"==c.dataset.displaying},removeVideoHostContainer(){const c=document.getElementById("videoHostContainer");null!=c&&c.parentNode.removeChild(c)},createDummyUser(c){c||(c=5E3);let a,b=0,f=31;var g=setInterval(()=>{b>c?clearInterval(g):(f+=b,a={joinUser:{key:f},message:[{lname:" ",name:`User${f}`,role:"s",userid:f}],
newuser:null,type:"member_added",user:!0},b++,virtualclass.ioEventApi.readyto_member_add(a))},1)},getVisibleHeightElem(c){var a=$(c);c=$(d).scrollTop();const b=c+$(d).height(),f=a.offset().top;a=f+a.outerHeight();return(a>b?b:a)-(f<c?c:f)},applyHeight(c){c=document.getElementById("virtualclassAppRightPanel");const a=this.getVisibleHeightElem("virtualclassCont");c.style.height=a!=nul1?a:d.innerHeight},insertIntoLeftBar(c){const a=document.querySelector("#virtualclassApp #virtualclassAppLeftPanel");
null!=a?a.appendChild(c):alert("Error:- There is no Element to insert it.")},getWhiteboardId(c){c=c.closest(".vcanvas");if(null!=c)return c.dataset.wbId;alert("doc element is null")},getElementOffset(c){let a=0,b=0;do a+=c.offsetTop||0,b+=c.offsetLeft||0,c=c.offsetParent;while(c);return{x:b,y:a}},updateCurrentDoc(c){virtualclass.gObj.currWb=`_doc_${c}_${c}`},getParentTag(c,a){return c.closest(a)},attachEventToUploadTab(c,a,b){c=document.getElementById("newDocBtn");null!=c&&(c.removeEventListener("click",
virtualclass.vutil._attachEventToUploadTab),c.addEventListener("click",virtualclass.vutil._attachEventToUploadTab))},_attachEventToUploadTab(){var c=document.querySelector("#DocumentShareDashboard .qq-upload-button-selector.qq-upload-button input");if(null!=c){if(c.click(),c=document.querySelector("#DocumentShareDashboard .qq-upload-list-selector.qq-upload-list"))c.style.display="block"}else alert("Element is null")},attachEventToUpload(c,a,b){c=document.getElementById("uploadVideo");null!=c&&c.addEventListener("click",
()=>{const a=document.querySelector("#VideoDashboard .qq-upload-button-selector.qq-upload-button input");null!=a?a.click():alert("Element is null")})},modalPopup(c,a){const b={};if("video"==c){const a=document.querySelector("#listvideo .playing");a&&(this.currPlaying=a.getAttribute("data-rid"));b.validation="mp4 avi wmv mov webm mkv vob mpeg".split(" ");b.cb=virtualclass.videoUl.afterUploadVideo;b.cthis="video";b.maxSize=512E6;b.requesteEndPoint=`${d.webapi}&methodname=file_save&live_class_id=${virtualclass.gObj.congCourse}&status=1&content_type_id=2&user=${virtualclass.gObj.uid}`}else b.validation=
"doc docx txt html csv pdf ppt pptx xls xlsx xlt png jpg gif svg tiff rtf xpm".split(" "),b.cb=virtualclass.dts.onAjaxResponse,b.cthis="docs",b.maxSize=24E6,b.requesteEndPoint=`${d.webapi}&methodname=congrea_image_converter&live_class_id=${virtualclass.gObj.congCourse}&status=1&content_type_id=1&user=${virtualclass.gObj.uid}`;b.multiple=!1;b.wrapper=document.getElementById(a[0]);virtualclass.fineUploader.uploaderFn(b);"video"!=c&&(c=document.querySelector("#DocumentShareDashboard #docsUploadMsz"),
a=document.createElement("div"),c&&c.appendChild(a))},async xhrSendWithForm(c,a){const b=new FormData;for(const a in c)b.append(a,c[a]);return await this.vxhr.post("undefined"===typeof a?d.webapi:`${d.webapi}&methodname=${a}&user=${virtualclass.gObj.uid}`,b)},createSaveButton(){const c=document.createElement("div");c.id="tech_support_save";const a=document.createElement("span");a.innerHTML="Save Session";c.appendChild(a);return c},setChatContHeight(c){},setChatHeight(c){},alreadyConnected(c){return 0<
virtualclass.connectedUsers.length?0<virtualclass.connectedUsers.filter(a=>a.userid==c).length:!1},UTCtoLocalTime(c){var a=new Date(c);c=a.getHours();a=`0${a.getMinutes()}`;return`${c}:${a.substr(-2)}`},UTCtoLocalTimeToSeconds(c){return c=(new Date(c)).getTime()},appIsForEducator(c){for(const a in virtualclass.apps)if(virtualclass.apps[a]==c)return!1;return!0},initDashboardNav(c){if(roles.hasControls()){var a=document.querySelector("#dashboardnav button");null==a&&(a=virtualclass.getTemplate("dashboardNav")({app:virtualclass.currApp}),
document.querySelector("#virtualclassAppOptionsCont").insertAdjacentHTML("beforeend",a),a=document.querySelector("#dashboardnav button"),null!=a&&(a.addEventListener("click",function(){const a=document.querySelector(".congrea #virtualclassApp");this.classList.contains("clicked")?(virtualclass.dashBoard.close(),a&&a.classList.contains("dashboard")&&a.classList.remove("dashboard")):(a&&(a.classList.contains("dashboard")||a.classList.add("dashboard")),virtualclass.vutil.initDashboard(virtualclass.currApp),
this.classList.add("clicked"),virtualclass.dashBoard.dashBoardClickTooltip("close"),"DocumentShare"==virtualclass.currApp&&virtualclass.hasOwnProperty("dts")&&(virtualclass.dts.moveProgressbar(),null!=virtualclass.dts.docs.currNote&&virtualclass.dts.setCurrentNav(virtualclass.dts.docs.currNote),document.querySelector(".dbContainer #listnotes .linknotes")?document.querySelector(".congrea.teacher  #dashboardContainer .modal-header button.enable")||virtualclass.vutil.showFinishBtn():virtualclass.vutil.removeFinishBtn()))}),
c&&virtualclass.vutil.readyDashboard(c)));"DocumentShare"==virtualclass.currApp?virtualclass.dts.noteExist()?(virtualclass.dts.isUploaderExist()||virtualclass.vutil.modalPopup("docs",["docsuploadContainer"]),document.getElementById("dashboardnav").setAttribute("data-title",virtualclass.lang.getString("DocumentSharedbHeading"))):this.readyDashboard():"Video"==virtualclass.currApp?("undefined"===typeof c&&this.readyDashboard(),(c=document.querySelector(".congrea #listvideo .linkvideo.playing"))||virtualclass.vutil.removeFinishBtn()):
(this.readyDashboard(),(c=document.querySelector(".congrea #listppt .linkppt.playing"))||virtualclass.vutil.removeFinishBtn(),document.querySelector(".congrea .pptSharing")&&virtualclass.modal.hideModal())}},modalCloseHandler(){const c=document.querySelector(".congrea .dashboardContainer .modal-header .close");c&&c.addEventListener("click",()=>{const a=document.querySelector(".congrea #virtualclassApp");a.classList.contains("dashboard")&&a.classList.remove("dashboard");c.setAttribute("data-dismiss",
"modal");virtualclass.modal.hideModal()})},readyDashboard(c){console.log("Ready Dashboard");var {currApp:a}=virtualclass;if(null==document.querySelector("#congdashboard")){var b=virtualclass.getTemplate("dashboard")({app:a});document.querySelector("#dashboardContainer").innerHTML=b}this.modalCloseHandler();if("DocumentShare"==a){var f=document.getElementById("dashboardnav");f.setAttribute("data-title",virtualclass.lang.getString("DocumentSharedbHeading"));if(null==document.querySelector(`#${a}Dashboard`)){b=
document.createElement("div");var g=document.querySelector("#congdashboard .modal-body");g.appendChild(b);b.id=`${a}Dashboard`}(f=document.querySelector("#docsDbCont"))&&f.parentNode.removeChild(f);document.querySelector(`#${a}Dashboard`).innerHTML=this.getDocsDashBoard(a);virtualclass.dts.init();virtualclass.vutil.attachEventToUploadTab();virtualclass.dts.isUploaderExist()||virtualclass.vutil.modalPopup("docs",["docsuploadContainer"]);virtualclass.vutil.makeElementActive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery");
virtualclass.vutil.makeElementActive("#listnotes")}else"Video"==a?(document.getElementById("dashboardnav"),null==document.querySelector(`#${a}Dashboard`)&&(b=document.createElement("div"),g=document.querySelector("#congdashboard .modal-body"),g.appendChild(b),b.id=`${a}Dashboard`),document.querySelector("#videoPopup")||(b=virtualclass.getTemplate("popup","videoupload")(),document.querySelector("#VideoDashboard").insertAdjacentHTML("beforeend",b),(a=document.querySelector("#videoPopup  #uploadMsz div"))&&
a.parentNode.removeChild(a),virtualclass.vutil.attachEventToUpload(),virtualclass.videoUl.UI.inputUrl()),virtualclass.videoUl.UI.popup(c),virtualclass.vutil.makeElementActive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery"),virtualclass.vutil.makeElementActive("#listvideo"),c&&c.init.videoUrl&&(f=!0),a=document.querySelector("#dashboardnav button"),null==a||f||virtualclass.vutil.isDashboardOpened()||a.click()):"SharePresentation"==a&&(f=document.getElementById("dashboardnav"),f.setAttribute("data-title",
virtualclass.lang.getString("SharePresentationdbHeading")),null==document.querySelector(`#${a}Dashboard`)&&(b=document.createElement("div"),g=document.querySelector("#congdashboard .modal-body"),g.appendChild(b),b.id=`${a}Dashboard`))},initDashboard(c,a){document.querySelector("#mainContainer");"SharePresentation"!=c||document.querySelector("#pptDbCont")||(null==document.querySelector(".docsDbCont")&&(document.querySelector("#SharePresentationDashboard").innerHTML=virtualclass.vutil.getPptDashBoard("SharePresentation")),
virtualclass.sharePt.attachEvent("submitpurl","click",virtualclass.sharePt.initNewPpt),virtualclass.sharePt.ppts&&virtualclass.sharePt.ppts.length&&(virtualclass.sharePt.showPpts(virtualclass.sharePt.ppts),virtualclass.sharePt.retrieveOrder()));const b=document.querySelectorAll("#congdashboard .dbContainer");for(let a=0;a<b.length;a++)b[a].style.display=b[a].dataset.app==virtualclass.currApp?"block":"none";console.log(`Dashboard is created for ${virtualclass.currApp}`);"DocumentShare"==c?("undefined"===
typeof a&&(virtualclass.modal.showModal(),virtualclass.dashBoard.clickCloseButton()),virtualclass.dts.noteExist()&&virtualclass.vutil.hideUploadMsg("docsuploadContainer")):"Video"==c?"undefined"===typeof a&&virtualclass.modal.showModal():virtualclass.modal.showModal();virtualclass.dashBoard.actualCloseHandler();a=document.querySelector("#congdashboard .modal-header h4");null!=a&&(a.innerHTML=virtualclass.lang.getString(`${c}dbHeading`))},getDocsDashBoard(c){const a=virtualclass.getTemplate("dashboard",
"documentSharing");c={app:c,hasControls:roles.hasControls()};return a(c)},getPptDashBoard(c){const a=virtualclass.getTemplate("dashboard","ppt");c={app:c,hasControls:roles.hasControls()};return a(c)},removeDashboardNav(){const c=document.querySelector("#dashboardnav");null!=c&&c.parentNode.removeChild(c)},makeElementDeactive(c){console.log(`drag drop Deactive element ${c}`);c=document.querySelector(c);null!=c&&(c.style.pointerEvents="none")},makeElementActive(c){console.log(`drag drop Active element ${c}`);
c=document.querySelector(c);null!=c&&(c.style.pointerEvents="visible")},initCommonSortingChat(){setTimeout(()=>{sortCommonChat()},800)},triggerDashboard(c,a){"DocumentShare"==c?null==document.querySelector("#screen-docs .note.current")&&("undefined"===typeof a?virtualclass.vutil.initDashboard(c):virtualclass.vutil.initDashboard(c,a)):"Video"==c?"undefined"===typeof a?virtualclass.vutil.initDashboard(c):virtualclass.vutil.initDashboard(c,a):virtualclass.vutil.initDashboard(c)},trimExtension(c){return c.replace(/\.[^/.]+$/,
"")},hideUploadMsg(c){c=document.querySelector(`#${c} .qq-uploader-selector.qq-uploader.qq-gallery`);null!=c&&c.setAttribute("qq-drop-area-text","")},showUploadMsg(c){c=document.querySelector(`#${c} .qq-uploader-selector.qq-uploader.qq-gallery`);null!=c&&c.setAttribute("qq-drop-area-text",virtualclass.lang.getString("dropfilehere"))},audioStatus(c,a){const b=c.getElementsByClassName("congtooltip")[0];"true"==a?(c.setAttribute("data-audio-playing","true"),b.setAttribute("data-title",virtualclass.lang.getString("audioEnable")),
c.className="audioTool active"):(c.setAttribute("data-audio-playing","false"),b&&b.setAttribute("data-title",virtualclass.lang.getString("audioDisable")),c.className="audioTool deactive")},selfVideoStatus(){const c=document.querySelector(".congrea .videoSwitchCont #videoSwitch");if(c.classList.contains("off"))return"off";if(c.classList.contains("on"))return"on"},videoController(){const c=document.querySelector(".congrea .videoSwitchCont");c&&c.addEventListener("click",()=>{virtualclass.vutil.videoHandler("off"==
virtualclass.vutil.selfVideoStatus()?"on":"off")})},videoHandler(c,a){let b;var f=document.querySelector(".congrea .videoSwitchCont #videoSwitch");if("on"==c){f.classList.remove("off");f.classList.add("on");b="on";f=document.querySelector(".videoSwitchCont");f.dataset.title="Video off";roles.hasControls()?(virtualclass.videoHost.gObj.videoSwitch=1,console.log("videoswitch 1")):virtualclass.videoHost.gObj.stdStopSmallVid=!1;chatContainerEvent.elementFromShadowDom(`#ml${virtualclass.gObj.uid} .user-details a span`)||
chatContainerEvent.elementFromShadowDom(`#ml${virtualclass.gObj.uid} .user-details a img`)?virtualclass.videoHost.removeUserIcon(virtualclass.gObj.uid):virtualclass.gObj.delayVid="hide";roles.hasControls()&&virtualclass.videoHost.UI.displayTeacherVideo();const a=document.querySelector(`#ml${virtualclass.gObj.uid} video`);null!=a&&setTimeout(()=>{a.srcObject=virtualclass.media.stream},100)}else"off"==c&&(f.classList.remove("on"),f.classList.add("off"),b="off",f=document.querySelector(".videoSwitchCont"),
f.dataset.title="Video on",virtualclass.videoHost&&(roles.hasControls()?virtualclass.videoHost.gObj.videoSwitch=0:virtualclass.videoHost.gObj.stdStopSmallVid=!0),chatContainerEvent.elementFromShadowDom(`#ml${virtualclass.gObj.uid} .user-details a .videoWrapper`)?virtualclass.videoHost.setUserIcon(virtualclass.gObj.uid):virtualclass.gObj.delayVid="display",roles.hasControls()&&virtualclass.videoHost.UI.hideTeacherVideo());"undefined"===typeof a&&(virtualclass.gObj.meetingMode?virtualclass.multiVideo.setVideoStatus("off"!=
c):virtualclass.gObj.uid==virtualclass.vutil.whoIsTeacher()&&ioAdapter.mustSend({congCtr:{videoSwitch:b},cf:"congController"}),roles.hasControls()||ioAdapter.mustSend({stdVideoCtr:{videoSwitch:virtualclass.videoHost.gObj.stdStopSmallVid},cf:"stdVideoCtrl"}))},isChromeExtension(){d.postMessage({type:"isInstalled",id:1},"*");console.log("Chrome Extension:- Check");d.addEventListener("message",c=>{"yes"==c.data.type&&(virtualclass.gObj.chromeExt=!0)})},setWidth(c,a,b){a=document.querySelector(`#canvas${c}`);
a.width=b},setHeight(c,a,b){a=document.querySelector(`#canvas${c}`);a.height=b},getWidth(c){return c.width},getHeight(c){return c.height},getValueWithoutPixel(c){return parseInt(c,10)},removeDecimal(c){return c.toFixed(2)},getElemM(c,a){if("Y"==a)var b=document.querySelector(`#${c}`).offsetHeight;else"X"==a&&(b=document.querySelector(`#${c}`).offsetWidth);return this.getValueWithoutPixel(b)},getElemM2(c,a){if("Y"==a)var b=document.querySelector(`#${c}`).offsetHeight;else"X"==a&&(b=document.querySelector(`#${c}`).offsetWidth);
return this.getValueWithoutPixel(b)},getElemHeight(c){c=document.querySelector(`#${c}`).offsetHeight;return this.getValueWithoutPixel(c)},getElemWidth(c){c=document.querySelector(`#${c}`).offsetWidth;return this.getValueWithoutPixel(c)},visibleElementHeighOldt(c,a){let b=0;for(c=document.getElementById(c);c.offsetParent&&c.offsetParent.id!=a;)b+=c.offsetTop,c=c.offsetParent;return c.offsetHeight-b},elementIsVisible2(c){const a=c.getBoundingClientRect().top;c=c.getBoundingClientRect().bottom;return 0<=
a&&c<=d.innerHeight},elementIsVisible(c){c=c.getBoundingClientRect();const a=Math.max(document.documentElement.clientHeight,d.innerHeight);return!(0>c.bottom||0<=c.top-a)},getVisibleHeight(c){var a=$(`#${c}`);c=$(d).scrollTop();const b=c+$(d).height(),f=a.offset().top;a=f+a.outerHeight();return(a>b?b:a)-(f<c?c:f)},isNumeric(c){return!isNaN(parseFloat(c))&&isFinite(c)},setContainerDimension(c,a){},setDefaultScroll(){if(roles.hasControls()&&"Whiteboard"==virtualclass.currApp||"DocumentShare"==virtualclass.currApp){const c=
virtualclass.gObj.currWb;null!=c&&null!=virtualclass.pdfRender[c].canvasWrapper&&(virtualclass.pdfRender[c].canvasWrapper.scrollTop=1)}},async createWhiteBoard(c){await virtualclass.appInitiator.Whiteboard.apply(virtualclass,Array.prototype.slice.call(["Whiteboard","byclick",c]));const a=virtualclass.system.measureResoultion({width:d.innerWidth,height:d.innerHeight});virtualclass.system.setCanvasWrapperDimension(a,c)},createHashString(c){let a=0;const b=c.length;for(let f=0;f<b;f++)a=31*a+c.charCodeAt(f),
a&=a;return a},randomString(c){let a="";for(;0<c;--c)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.round(61*Math.random())];return a},isBulkDataFetched(){return 0<virtualclass.serverData.rawData.video.length||0<virtualclass.serverData.rawData.docs.length||0<virtualclass.serverData.rawData.ppt.length},sendOrder(c,a){virtualclass.gObj.docOrder[c]=a;c={order:JSON.stringify(virtualclass.gObj.docOrder)};virtualclass.xhrn.vxhrn.post(virtualclass.api.UpdateRoomMetaData,c)},saveWbOrder(c){c&&
localStorage.setItem("wbOrder",JSON.stringify(virtualclass.wbCommon.order))},requestOrder(c,a){virtualclass.xhrn.vxhrn.post(virtualclass.api.GetRoomMetaData,{noting:!0}).then(b=>{null!=b.data.Item&&b.data.Item.order.S&&virtualclass.vutil.IsJsonString(b.data.Item.order.S)&&(b=JSON.parse(b.data.Item.order.S),virtualclass.gObj.docOrder=b,a(b[c]))})},IsJsonString(c){try{JSON.parse(c)}catch(a){return!1}return!0},removeChildrens(c){console.log(`children selector ${c}`);c=document.querySelectorAll(c);for(let a=
0;a<c.length;a++)c[a].parentNode.removeChild(c[a])},initAcitveElement(){if("Video"==virtualclass.currApp)var c="#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery",a="#listvideo";else"DocumentShare"==virtualclass.currApp&&(c="#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery",a="#listdocs");const b=document.querySelector(`#${virtualclass.currApp}Dashboard`);null==b||b.classList.contains("uploading")?virtualclass.vutil.makeElementDeactive(c):(virtualclass.vutil.makeElementActive(c),
virtualclass.vutil.makeElementDeactive(a))},isResponseAvailable(c){return void 0!=c&&"undefined"!=c&&null!=c},navWhiteboard(c,a,b){virtualclass.vutil.isTextWrapperExist()&&virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.finalizeTextIfAny();"undefined"!==typeof b?a.call(c,b):a.call(c);console.log(`whiteboard nav time${virtualclass.gObj.wbNavtime}`)},removeAllTextWrapper(){const c=document.querySelectorAll(".canvasWrapper .textBoxContainer");for(let a=0;a<c.length;a++)c[a].parentNode.removeChild(c[a])},
isDashboardOpened(c){c=document.querySelector("#dashboardnav button");return null!=c&&c.classList.contains("clicked")},stopConnection(){io.webSocketConnected()&&io.disconnect();virtualclass.gObj.invalidlogin=!0},initDefaultApp:()=>{const c=document.querySelector(`#virtualclass${virtualclass.gObj.defaultApp}Tool a`);null!=c&&c.click(c)},initssSharing:c=>{virtualclass.gObj.whoIsSharing=c;c=chatContainerEvent.elementFromShadowDom(`#ml${c} .icon-stdscreenImg`);null!=c&&c.setAttribute("data-dcolor","green")},
removeSSsharing:()=>{const c=document.querySelector("#chat_div .controleCont.ssSharing");null!=c&&c.classList.remove("ssSharing");delete virtualclass.gObj.whoIsSharing},informIamSharing:()=>{const c=virtualclass.vutil.whoIsTeacher();roles.isStudent()&&virtualclass.gObj.studentSSstatus.mesharing&&ioAdapter.mustSendUser({cf:"sshare_user"},c)},resizeWindowIfBigger(){var {currWb:c}=virtualclass.gObj;c=document.querySelector(`#canvasWrapper${c}`);null!=c&&60<d.innerWidth-(c.offsetWidth+320)&&(console.log("Resize event is triggered"),
system.initResize())},isTextWrapperExist(){return 0<document.querySelectorAll(".canvasWrapper .textBoxContainer").length},insertAppLayout:c=>{document.querySelector("#virtualclassAppContainer");$("#virtualclassAppContainer").append(c)},prechkScrnShare(){document.getElementById("preCheckcontainer").style.display="none";document.getElementById("virtualclassApp").style.display="block";localStorage.getItem("precheck")?virtualclass.videoHost._resetPrecheck():(virtualclass.popup.waitMsg(),virtualclass.makeReadySocket(),
localStorage.setItem("precheck",!0),virtualclass.videoHost.afterSessionJoin());virtualclass.gObj.precheckScrn=!1},showFinishBtn(){var c=document.querySelector(".congrea #dashboardContainer .modal-header button");c&&c.classList.add("enable");"DocumentShare"==virtualclass.currApp&&(c=document.querySelector("#virtualclassAppLeftPanel"),c.classList.add("showZoom"),c.classList.remove("hideZoom"))},removeFinishBtn(){var c=document.querySelector(".congrea.teacher  #dashboardContainer .modal-header button.enable");
c&&c.classList.remove("enable");"DocumentShare"==virtualclass.currApp&&(c=document.querySelector("#virtualclassAppLeftPanel"),c.classList.add("hideZoom"),c.classList.remove("showZoom"))},addNoteClass(){if(roles.isStudent()){const c=document.querySelector("#docScreenContainer");null!=c&&(c.classList.add("noteDisplay"),console.log("add note display"))}},calcBrightness(c){c=chroma(c).rgb();c=Math.round((299*parseInt(c[0])+587*parseInt(c[1])+114*parseInt(c[2]))/1E3);console.log(`brightne${c}`);return c},
removeStudenScreenStatus(){const c=chatContainerEvent.elementFromShadowDom(".stdscreenImg","all");for(let a=0;a<c.length;a++)c[a].dataset.dcolor=""},insertAfter(c,a){a.parentNode.insertBefore(c,a.nextSibling)},triggerMouseEvent(c,a){if(null!=c){const b=document.createEvent("MouseEvents");b.initEvent(a,!0,!0);c.dispatchEvent(b)}},getCookie(c){return(c=document.cookie.match(RegExp(`(?:^|;\\s*)${c.replace(/([.*+?\^${}()|\[\]\/\\])/g,"\\$1")}=([^;]*)`)))?c[1]:null},sendCurrAppOnUserJoin(){if("object"===
typeof virtualclass.wb&&"Whiteboard"==virtualclass.currApp){const c=virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs;0<c.length?ioAdapter.sendWithDelayAndDrop({repObj:c,cf:"repObj"},null,"mustSend","repObj",1500):console.log("Could not send the whiteboard data")}},setCurrApp(c,a){c.dataset.currapp=a;console.log(`Data set curr app ${a}`);c=document.getElementById("chat_div");null!=c&&(c.dataset.currapp=a)},selfJoin(c){return c==virtualclass.gObj.uid?(ioAdapter.sendSpeed(virtualclass.videoHost.gObj.MYSPEED),
!0):!1},getUrlVars(c){const a=[],b=c.slice(c.indexOf("?")+1).split("&");for(let f=0;f<b.length;f++)c=b[f].split("="),a.push(c[0]),a[c[0]]=c[1];return a},clearSyncTimeInterval(){virtualclass.videoUl.hasOwnProperty("syncTimeInterval")&&clearInterval(virtualclass.videoUl.syncTimeInterval)},pageVisible(){let c,a;const b={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(c in b)if(c in document){a=b[c];break}return function(b){b&&
document.addEventListener(a,b);return!document[c]}},showZoom(){const c=document.querySelector("#virtualclassAppLeftPanel.hideZoom");c&&(c.classList.remove("hideZoom"),c.classList.add("showZoom"))},removeBackgroundVideoApp(){virtualclass.videoUl.videoId="";var c=document.getElementById("dispVideo_Youtube_api");c&&c.contentWindow&&c.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*");if(c=document.querySelector(".congrea #dispVideo"))c.style.display="none",(c=document.querySelector(".congrea #dispVideo video"))&&
c.setAttribute("src","");(c=document.querySelector("#listvideo .playing"))&&c.classList.remove("playing");(c=document.querySelector("#listvideo .removeCtr"))&&c.classList.remove("removeCtr");roles.hasControls()||(virtualclass.gObj.hasOwnProperty("videoPauseTime")&&clearTimeout(virtualclass.gObj.videoPauseTime),"object"===typeof virtualclass.videoUl.player&&null!=virtualclass.videoUl.player.player_&&virtualclass.videoUl.player.paused()&&(console.log("==== Video is paused"),virtualclass.videoUl.player.pause()));
"object"===typeof virtualclass.videoUl.player&&delete virtualclass.videoUl.player},removeSessionEndTool(){const c=document.getElementById("virtualclassSessionEndTool");null!=c&&c.parentNode.removeChild(c)},WebPDecodeAndDraw:function(c,a,b){d.Worker&&webpToPng.postMessage({vdata:c,canid:a.id});d.Worker&&(webpToPng.onmessage=function(a){var b="videoParticipate"==a.data.canid?document.querySelector(`#${a.data.canid}`):chatContainerEvent.elementFromShadowDom(`#${a.data.canid}`);const c=b.getContext("2d"),
f=c.createImageData(b.width,b.height);b.height=a.data.bh;b.width=a.data.bw;f.data.set(a.data.vdata);c.putImageData(f,0,0);virtualclass.gObj.isReadyForVideo=!0})},isSessionEnded(){if(!virtualclass.isPlayMode&&virtualclass.endSession)return localStorage.clear(),!0}}})(window);let globalImageData={},newCanvas;
(function(d){let c,a,b,f,g,k,m,n,q,r;const z=function(a){null==m&&(m=document.querySelector("#virtualclassScreenShareLocal"));null==n&&(n=document.createElement("canvas"),n.id="virtualclassScreenShareLocalVideoNew",m.appendChild(n),n=document.querySelector("#virtualclassScreenShareLocalVideoNew"));n.width=a.width;n.height=a.height;0>=virtualclass.studentScreen.base.width&&(virtualclass.studentScreen.base.width=n.width,virtualclass.studentScreen.base.height=n.height);null==q&&(q=document.querySelector("#virtualclassScreenShareLocalVideoNew").getContext("2d"));
q.putImageData(a,0,0);virtualclass.ss.localCont.save();virtualclass.ss.localCont.clearRect(0,0,d.innerWidth-300,d.innerHeight);virtualclass.ss.localCont.scale(virtualclass.studentScreen.scale,virtualclass.studentScreen.scale);virtualclass.ss.localCont.drawImage(n,0,0);virtualclass.ss.localCont.restore();"undefined"!==typeof stype&&(console.log(`Screen type width ${n.width}`),console.log(`Screen type height ${n.height}`))};d.Worker&&(sdworker.onmessage=function(a){"drgb"==a.data.dtype&&(r=globalImageData=
a.data.globalImageData,a.data.hasOwnProperty("stype")?(virtualclass.studentScreen.base.width=0,virtualclass.studentScreen.setDimension(),z(r),"full"==a.data.stype&&1==virtualclass.studentScreen.scale&&(virtualclass.studentScreen.scale=1,virtualclass.studentScreen.fitToScreen())):z(r,"full"))});d.studentScreen=function(){return{scale:1,SCALE_FACTOR:1.04,szoom:!1,base:{width:0,height:0},ssProcess(a,b,c,f){var g=a[0];a=new Uint8ClampedArray(b);let d,k;switch(g){case 102:case 202:g=virtualclass.vutil.numValidateTwo(a[1],
a[2]);b=virtualclass.vutil.numValidateTwo(a[3],a[4]);a=a.subarray(5,a.length);this.initStudentScreen(a,{w:g,h:b},c,f);break;case 103:case 203:"object"===typeof virtualclass.ss&&this.drawImageThroughWorker(a);break;case 104:case 204:b=virtualclass.vutil.numValidateTwo(a[1],a[2]),g=virtualclass.vutil.numValidateTwo(a[3],a[4]),d=virtualclass.vutil.numValidateTwo(a[5],a[6]),k=virtualclass.vutil.numValidateTwo(a[7],a[8]),a=a.subarray(9,a.length),b={d:{w:b,h:g},vc:{w:d,h:k}},this.initStudentScreen(a,b,
c,f)}},initStudentScreen(b,c,f,d){g=f;f=document.getElementById(`virtualclass${virtualclass.apps.ss}`);"object"!==typeof virtualclass[g]||null==f?("undefined"!==typeof vtype&&(virtualclass.recorder.recImgPlay=!0),virtualclass.makeAppReady("ScreenShare")):("ScreenShare"!=virtualclass.currApp&&virtualclass.vutil.hidePrevIcon(g),virtualclass.currApp=d,d=document.getElementById("virtualclassCont"),virtualclass.vutil.setCurrApp(d,virtualclass.currApp));if(c.hasOwnProperty("d"))virtualclass[g].dimensionStudentScreenResize(c),
k=!0;else{if("undefined"===typeof k||"undefined"!==typeof a&&a!=c.w&&!c.hasOwnProperty("x"))k=!0,virtualclass[g].dimensionStudentScreen(c.w,c.h),a=c.w;!c.hasOwnProperty("w")||virtualclass[g].localCanvas.width==c.w&&virtualclass[g].localCanvas.height==c.h||(virtualclass[g].localCanvas.width=c.w,virtualclass[g].localCanvas.height=c.h)}virtualclass[g].drawImages(b);virtualclass.previous=virtualclass[g].id;this.szoom||this.initZoom()},initZoom(){var a=virtualclass.getTemplate("zoomControl")({hasControls:roles.hasControls()}),
b=document.querySelector(`#virtualclass${virtualclass.currApp}`);if(null!=b){b.insertAdjacentHTML("beforeend",a);a=document.querySelector(`#virtualclass${virtualclass.currApp} .zoomIn`);b=document.querySelector(`#virtualclass${virtualclass.currApp} .zoomOut`);const f=document.querySelector(`#virtualclass${virtualclass.currApp} .fitScreen`);if(null!=a){var c=this;a.onclick=function(a){c.zoomIn()}}null!=b&&(c=this,b.onclick=function(){c.zoomOut()});null!=f&&(c=this,f.onclick=function(){c.fitToScreen()})}this.szoom=
!0},zoomIn(){virtualclass.ss.localCanvas.width=+virtualclass.ss.localCanvas.width*this.SCALE_FACTOR;virtualclass.ss.localCanvas.height=+virtualclass.ss.localCanvas.height*this.SCALE_FACTOR;this.scale*=this.SCALE_FACTOR;z(globalImageData);this.addScroll()},zoomOut(){this.scale/=this.SCALE_FACTOR;virtualclass.ss.localCanvas.width=1/this.SCALE_FACTOR*+virtualclass.ss.localCanvas.width;virtualclass.ss.localCanvas.height=1/this.SCALE_FACTOR*+virtualclass.ss.localCanvas.height;z(globalImageData);this.addScroll()},
addScroll(){let a=virtualclass.ss.localCanvas.width,b=virtualclass.ss.localCanvas.parentNode.style.width;a=virtualclass.vutil.getValueWithoutPixel(a);b=virtualclass.vutil.getValueWithoutPixel(b);a>b?virtualclass.ss.localCanvas.parentNode.classList.add("scrollX"):virtualclass.ss.localCanvas.parentNode.classList.remove("scrollX")},fitToScreen(){const a=this.setDimension();this.scale=virtualclass.ss.getScale(this.base.width,a.width);1<=this.scale?(this.scale=1,virtualclass.ss.localCanvas.width=globalImageData.width,
virtualclass.ss.localCanvas.height=globalImageData.height):(virtualclass.ss.localCanvas.width=a.width,virtualclass.ss.localCanvas.height=a.height);z(globalImageData);virtualclass.ss.localCanvas.parentNode.classList.remove("scrollX")},setDimension(){var a=this.getCanvasContainerDimension();let {width:b}=a;({height:a}=a);b=virtualclass.vutil.getValueWithoutPixel(b);a=virtualclass.vutil.getValueWithoutPixel(a);this.setCanvasContainerDimension(b,a);return{width:b,height:a}},getCanvasContainerDimension(){const a=
document.querySelector(`#virtualclass${virtualclass.currApp}`);let {width:b}=a.style,{height:c}=a.style;if(null==b||""==b||void 0==b)b=a.offsetWidth;if(null==c||""==c||void 0==c)c=a.offsetHeight;b=virtualclass.vutil.getValueWithoutPixel(b)-40;c=virtualclass.vutil.getValueWithoutPixel(c);return{width:b,height:c}},setCanvasContainerDimension(a,b){const c=document.querySelector("#virtualclassScreenShareLocal");c.style.width=`${a}px`;c.style.height=`${b}px`},drawImageThroughWorker(a){d.Worker&&sdworker.postMessage({data_pack:a,
dtype:"drgbs"},[a.buffer])}}};d.screenShare=function(a){virtualclass.getSceenFirefox=function(){const a=parseInt(d.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);33<=a?(null==virtualclass.adpt&&(virtualclass.adpt=new virtualclass.adapter),virtualclass.adpt.init(navigator).mediaDevices.getUserMedia({video:{mozMediaSource:"window",mediaSource:"window"}}).then(a=>{virtualclass.ss._init();if(roles.hasControls()&&!virtualclass.gObj.studentSSstatus.mesharing||virtualclass.gObj.studentSSstatus.mesharing){if(virtualclass.ss.initializeRecorder.call(virtualclass.ss,
a),"undefined"===typeof err){let c=a.currentTime;var b=d.setInterval(()=>{a||d.clearInterval(b);if(a.currentTime==c&&(d.clearInterval(b),a.onended))a.onended();c=a.currentTime},500)}}else console.log("Set previous app as current app if teacher reclaim role during screen share"),virtualclass.ss.setCurrentApp()}).catch(a=>{virtualclass.ss.setCurrentApp();if("Video"==virtualclass.currApp)var b=document.getElementById("virtualclassVideoTool");else"SharePresentation"==virtualclass.currApp?b=document.getElementById("virtualclassSharePresentationTool"):
"DocumentShare"==virtualclass.currApp&&(b=document.getElementById("virtualclassDocumentShareTool"));b=b.getElementsByTagName("a")[0];virtualclass.initlizer(b);"string"===typeof a?"PERMISSION_DENIED"===a&&d.open("https://addons.mozilla.org/en-US/firefox/addon/ff_screenshare/").focus():"object"===typeof a&&("PermissionDeniedError"===a.name||"SecurityError"==a.name)&&d.open("https://addons.mozilla.org/en-US/firefox/addon/ff_screenshare/").focus();roles.hasControls()&&("Video"==virtualclass.currApp||
"SharePresentation"==virtualclass.currApp||"DocumentShare"==virtualclass.currApp)&&virtualclass.ss.showDashboard()})):alert(virtualclass.lang.getString("notSupportBrowser",[a]))};return{prevStream:!1,init(a){this.type=a.type;this.ssByClick=!0;this.manualStop=!1;!roles.hasControls()||virtualclass.recorder.recImgPlay||virtualclass.gObj.studentSSstatus.mesharing?roles.isStudent()&&virtualclass.gObj.studentSSstatus.mesharing?this.readyTostart(a.app):this._init():this.readyTostart(a.app)},_init(){console.log("Init screen");
this.currApp=this.tempCurrApp;virtualclass.currApp=virtualclass.apps.ss;var b=document.getElementById("virtualclassCont");virtualclass.vutil.setCurrApp(b,virtualclass.currApp);virtualclass.previous!=a.id&&(document.getElementById(virtualclass.previous).style.display="none",virtualclass.previous=a.id);b=document.getElementById(a.id);null!=b&&(b.style.display="block");this.hasOwnProperty("id")||(this.dc=virtualclass.dirtyCorner,this.postFix="Cont",this.id=a.hasOwnProperty("id")?a.id:"virtualclassScreenShare",
this.className="virtualclass",this.label="Local",this.local=this.id+this.label,this.localTemp=`${this.id+this.label}Temp`,this.classes=a.hasOwnProperty("class")?a.classes:"",this.initPrevImage(),b=document.getElementById(this.id),null!=b&&b.parentNode.removeChild(b),this.html.UI.call(this,virtualclass.gObj.uRole),(roles.hasControls()&&!virtualclass.recorder.recImgPlay&&!virtualclass.gObj.studentSSstatus.mesharing||roles.isStudent()&&virtualclass.gObj.studentSSstatus.mesharing)&&virtualclass.vutil.initLocCanvasCont(`${this.localTemp}Video`))},
readyTostart(a){a==virtualclass.apps.ss&&this.getScreen()},onError(a){if(virtualclass.previous){const {previous:a}=virtualclass;virtualclass.currApp=a.split("virtualclass")[1];virtualclass.vutil.setCurrApp(document.getElementById("virtualclassCont"),virtualclass.currApp)}else virtualclass.hasOwnProperty("previousApp")&&"object"===typeof virtualclass.previousApp&&(virtualclass.currApp=virtualclass.previousApp.name,virtualclass.vutil.setCurrApp(document.getElementById("virtualclassCont"),virtualclass.currApp));
roles.hasControls()&&("Video"==virtualclass.currApp||"SharePresentation"==virtualclass.currApp||"DocumentShare"==virtualclass.currApp)&&virtualclass.ss.showDashboard();virtualclass.gObj.studentSSstatus.mesharing&&(virtualclass.gObj.studentSSstatus.mesharing=!1);console.log(`Error ${a}`)},showDashboard(){virtualclass.vutil.initDashboardNav();"Video"==virtualclass.currApp?(ioAdapter.mustSend({videoUl:{init:"destroyPlayer"},cf:"destroyPlayer"}),ioAdapter.mustSend({videoUl:{init:"studentlayout"},cf:"videoUl"})):
"SharePresentation"==virtualclass.currApp&&virtualclass.vutil.initDashboard()},getScreen(a){"Chrome"==virtualclass.system.mybrowser.name?virtualclass.gObj.hasOwnProperty("ext")&&virtualclass.gObj.ext?d.postMessage({type:"getScreen",id:1},"*"):(virtualclass.vutil.beforeSend({ext:!0,cf:"colorIndicator"}),virtualclass.popup.chromeExtMissing(),virtualclass.vutil.setCurrApp(document.getElementById("virtualclassCont"),virtualclass.currApp),roles.hasControls()&&("Video"==virtualclass.currApp||"SharePresentation"==
virtualclass.currApp||"DocumentShare"==virtualclass.currApp)&&virtualclass.ss.showDashboard()):"Firefox"==virtualclass.system.mybrowser.name?virtualclass.getSceenFirefox():"Edge"==virtualclass.system.mybrowser.name&&navigator.getDisplayMedia().then(a=>{virtualclass.ss._init();virtualclass.ss.initializeRecorder.call(virtualclass.ss,a)},a=>{console.log("Unable to acquire screen capture",a)})},unShareScreen(){console.log("Unshare the screen");this.video.src="";this.localtempCont.clearRect(0,0,this.localtempCanvas.width,
this.localtempCanvas.height);clearInterval(virtualclass.clear);this.initPrevImage();this.hasOwnProperty("currentStream")&&this.currentStream.getTracks()[0].stop();virtualclass.vutil.beforeSend({unshareScreen:!0,st:this.type,cf:"unshareScreen"});this.clearScreenShare()},clearScreenShare(){console.log("Clear the screen");"undefined"!==typeof virtualclass.prevScreen&&virtualclass.prevScreen.hasOwnProperty("currentStream")&&delete virtualclass.prevScreen.currentStream;virtualclass.gObj.studentSSstatus.mesharing=
!1;virtualclass.removeSharingClass();virtualclass.gObj.studentSSstatus.shareToAll=!1;virtualclass.gObj.studentSSstatus.sharing=!1;localStorage.setItem("studentSSstatus",JSON.stringify(virtualclass.gObj.studentSSstatus));const a=document.querySelector("#virtualclassScreenShare");null!=a&&a.parentNode.removeChild(a);virtualclass.vutil.removeSSsharing();delete virtualclass.ss;virtualclass.hasOwnProperty("studentScreen")&&delete virtualclass.studentScreen;virtualclass.zoom.removeZoomController();virtualclass.ss=
""},removeStream(){virtualclass.vutil.removeClass("audioWidget","fixed");this.localCont.clearRect(0,0,this.localCanvas.width,this.localCanvas.height);this.clearScreenShare()},initializeRecorder(a){c=1;this.prevStream&&(this.ssByClick=!1);"undefined"!==typeof virtualclass.prevScreen&&virtualclass.prevScreen.hasOwnProperty("currentStream")&&virtualclass.prevScreen.unShareScreen();this.video=document.getElementById(`${this.local}Video`);this.videoSmall=document.getElementById(`${this.local}Videosmall`);
if("VIDEO"!=this.video.tagName){var b=document.getElementById(`${this.local}video`);this.video.parentNode.replaceChild(b,this.video);this.video=document.getElementById(`${this.local}Video`);this.video.autoplay=!0;virtualclass.vutil.initLocCanvasCont(`${this.local}Temp`+"Video")}this.currentStream=a;var f=this;virtualclass.adpt.attachMediaStream(this.video,a);virtualclass.adpt.attachMediaStream(this.videoSmall,a);this.prevStream=!0;this.currentStream.getVideoTracks()[0].onended=function(a){if(f.ssByClick){if(a=
document.querySelector("#virtualclassScreenShareLocalSmall"))a.style.display="none";f.video.src="";f.localtempCont.clearRect(0,0,f.localtempCanvas.width,f.localtempCanvas.height);clearInterval(virtualclass.clear);f.initPrevImage();f.clearScreenShare();virtualclass.vutil.beforeSend({unshareScreen:!0,st:f.type,cf:"unshareScreen"});console.log(`Sending unshare screen with users ${virtualclass.gObj.totalUser}`);roles.hasControls()?virtualclass.gObj.hasOwnProperty("windowLoading")||virtualclass.vutil.initDefaultApp():
(a=virtualclass.vutil.whoIsTeacher(),ioAdapter.mustSendUser({cf:"rmStdScreen"},a));f.prevStream=!1;f.prevScreen="";virtualclass.prevScreen="";console.log("Stop by clicking")}else f.ssByClick=!0};a={};a.width=d.innerWidth;a.height=d.innerHeight-140;b=document.getElementById(this.local);const g=this.html.getDimension(a);b.style.width=`${Math.round(g.width)}px`;b.style.height=`${Math.round(g.height)}px`;f=this;this.video.onloadedmetadata=function(){f.width=g.width;f.height=g.height;f.localtempCanvas.width=
f.video.offsetWidth;f.localtempCanvas.height=f.video.offsetHeight;virtualclass.prevScreen=f;const a=virtualclass.system.measureResoultion({width:d.innerWidth,height:d.innerHeight});f.sharing();virtualclass.vutil.setContainerWidth(a,virtualclass.currApp);roles.hasControls()&&(virtualclass.vutil.makeActiveApp(f.id,virtualclass.previrtualclass),"virtualclassYts"==virtualclass.previrtualclass&&virtualclass.yts.destroyYT());virtualclass.previrtualclass=f.id}},sharing(){function a(a,b){a=a.toString();for(let c=
a.length;c<b;c++)a=`0${a}`;return a.match(/[\S]{1,2}/g)||[]}function g(){clearInterval(virtualclass.clear);if("undefined"!==typeof b&&"undefined"!==typeof f){if(b!=A.video.offsetWidth||f!=A.video.offsetHeight)c=1}else b=A.video.offsetWidth,f=A.video.offsetHeight;1==c?setTimeout(m,2E3):n(A.type)}function k(a){switch(!0){case 300>=a||"undefined"===typeof a:I=300;break;case 3E3>=a:I=a;break;case 5E3>=a:I=3E3;break;default:I=5E3}}function m(){console.log("RESIZE screen share");if(roles.hasControls()||
virtualclass.gObj.studentSSstatus.mesharing){b=A.video.offsetWidth;f=A.video.offsetHeight;5<A.localtempCanvas.width&&5<A.localtempCanvas.height?(q=Math.round(A.localtempCanvas.height/12),r=Math.round(A.localtempCanvas.width/12),t=q,z=r):(q=t,r=z);{var m=A.type;A.localtempCanvas.width=A.video.offsetWidth;A.localtempCanvas.height=A.video.offsetHeight;A.localtempCont.drawImage(A.video,0,0,A.video.offsetWidth,A.video.offsetHeight);var n=A.localtempCont.getImageData(0,0,A.localtempCanvas.width,A.localtempCanvas.height);
n=A.dc.encodeRGB(n.data);const c=Math.round(A.localtempCanvas.width/r),g=Math.round(A.localtempCanvas.height/q);let k,v;var p=A.getContainerDimension();if("undefined"!==typeof b&&"undefined"!==typeof f){var u=a(b,4);k=a(f,4)}else u=a(A.video.offsetWidth,4),k=a(A.video.offsetHeight,4);v=a(p.width,4);p=a(p.height,4);m=new Uint8ClampedArray(["ss"==m?104:204,u[0],u[1],k[0],k[1],v[0],v[1],p[0],p[1]]);u=new Uint8ClampedArray(n.length+m.length);u.set(m);u.set(n,m.length);d.Worker&&sworker.postMessage({img:n,
resize:1,resA:q,resB:r,dw:c,dh:g,offsetWidth:A.video.offsetWidth,offsetHeight:A.video.offsetHeight},[n.buffer]);n=u}virtualclass.vutil.informIamSharing();ioAdapter.sendBinary(n);k(n.length/128);c=0;clearInterval(virtualclass.clear);virtualclass.clear=setInterval(g,I)}}function n(a){A.localtempCanvas.width=A.video.offsetWidth;A.localtempCanvas.height=A.video.offsetHeight;A.localtempCont.drawImage(A.video,0,0,A.video.offsetWidth,A.video.offsetHeight);a=Math.round(A.localtempCanvas.width/r);const b=
Math.round(A.localtempCanvas.height/q),c=A.localtempCont.getImageData(0,0,A.video.offsetWidth,A.video.offsetHeight);d.Worker&&(sworker.postMessage({img:c.data,resA:q,resB:r,dw:a,dh:b,offsetWidth:A.video.offsetWidth,offsetHeight:A.video.offsetHeight,type:A.type},[c.data.buffer]),sworker.onmessage=function(a){if(1==a.data.needFullScreen){a=virtualclass.getDataFullScreen(A.type);virtualclass.vutil.informIamSharing();ioAdapter.sendBinary(a);var b=a.length/128}else null!=a.data.masterSlice&&(ioAdapter.sendBinary(a.data.masterSlice),
b=a.data.masterSlice.length/128);k(b);clearInterval(virtualclass.clear);virtualclass.clear=setInterval(g,I)});clearInterval(virtualclass.clear)}let q=Math.round(this.localtempCanvas.height/12),r=Math.round(this.localtempCanvas.width/12),t=q,z=r;const A=this;virtualclass.hasOwnProperty("wholeImage")&&clearInterval(virtualclass.wholeImage);virtualclass.hasOwnProperty("clear")&&clearInterval(virtualclass.clear);0==q&&0==r&&virtualclass.view.createErrorMsg("screensharereload","errorContainer","chatWidget");
let I=1E3;virtualclass.getDataFullScreen=function(b){A.localtempCanvas.width=A.video.offsetWidth;A.localtempCanvas.height=A.video.offsetHeight;A.localtempCont.drawImage(A.video,0,0,A.video.offsetWidth,A.video.offsetHeight);var c=A.localtempCont.getImageData(0,0,A.localtempCanvas.width,A.localtempCanvas.height);c=A.dc.encodeRGB(c.data);var f=a(A.localtempCanvas.height,4);const g=a(A.localtempCanvas.width,4);b=new Uint8ClampedArray(["ss"==b?102:202,g[0],g[1],f[0],f[1]]);f=new Uint8ClampedArray(c.length+
b.length);f.set(b);f.set(c,b.length);return f};clearInterval(virtualclass.clear);virtualclass.clear=setInterval(g,I)},getContainerDimension(){const a=document.getElementById(`${this.id}Local`);return{width:a.offsetWidth,height:a.offsetHeight}},drawImages(a){sdworker.postMessage({encodeArr:a,cw:virtualclass.ss.localCanvas.width,ch:virtualclass.ss.localCanvas.height,dtype:"drgb"},[a.buffer])},dimensionStudentScreen(a,b){this.localCanvas=document.getElementById(`${virtualclass[g].local}Video`);this.localCont=
virtualclass[g].localCanvas.getContext("2d");this.localCanvas.width=a;this.localCanvas.height=b;console.log(`normal width ${this.localCanvas.width}`)},dimensionStudentScreenResize(a,b){this.hasOwnProperty("vac")||(this.vac=!0,this.localCanvas=document.getElementById(`${virtualclass[g].local}Video`),this.localCont=virtualclass[g].localCanvas.getContext("2d"));a.hasOwnProperty("d")&&(this.localCont.clearRect(0,0,this.localCanvas.width,this.localCanvas.height),this.localCanvas.width=a.d.w,this.localCanvas.height=
a.d.h);a.hasOwnProperty("vc")&&(b=document.getElementById(virtualclass[g].local),b.style.width=`${a.vc.w}px`,b.style.height=`${a.vc.h}px`);"virtualclassScreenShare"==virtualclass.previous&&virtualclass.vutil.setScreenInnerTagsWidth(virtualclass.previous)},isAbleToScreenShare(){return roles.isStudent()&&virtualclass.gObj.studentSSstatus.mesharing||roles.hasControls()&&!virtualclass.gObj.studentSSstatus.mesharing?!0:!1},html:{UI(a){a=virtualclass.ss.isAbleToScreenShare();var b=roles.hasControls(),{recImgPlay:c}=
virtualclass.recorder;c=virtualclass.getTemplate("ssmainDiv")({control:a,recImg:c,scrctrl:b});virtualclass.vutil.insertAppLayout(c);roles.hasControls()&&!virtualclass.gObj.studentSSstatus.mesharing&&(c=document.querySelector("#virtualclassCont  #stopScreenShare"))&&c.addEventListener("click",()=>{virtualclass.vutil.initDefaultApp()});b&&this.html.initScreenController();b=document.querySelector(".congrea #virtualclassApp");a?b.classList.remove("zoomCtrAdd"):b.classList.contains("zoomCtr")||b.classList.add("zoomCtrAdd");
if(roles.hasControls()&&virtualclass.gObj.studentSSstatus.mesharing){const a=this;setTimeout(()=>{var b=document.querySelector("#screenController .share");virtualclass.gObj.studentSSstatus.shareToAll?(a.html.changeSsInfoSelf(b),b="sToAll"):(a.html.changeSsInfoShareToAll(b),b="sview");ioAdapter.mustSend({cf:b,firstSs:!0})},2E3);(c=document.querySelector("#virtualclassCont  #stopScreenShare"))&&c.addEventListener("click",()=>{virtualclass.vutil.initDefaultApp();const a=document.querySelector("#virtualclassCont.studentScreenSharing");
a&&(a.classList.remove("studentScreenSharing"),document.querySelector("#chat_div").classList.remove("studentScreenSharing"));virtualclass.vutil.removeStudenScreenStatus()})}},initScreenController(){const a=document.querySelector("#screenController .share");if(null!=a){const b=this;a.onclick=function(a){let c;const {classList:f}=a.currentTarget;f.contains("selfView")?(b.changeSsInfoSelf(a.currentTarget),c="sToAll"):f.contains("shareToAll")&&(b.changeSsInfoShareToAll(a.currentTarget),c="sview");ioAdapter.mustSend({cf:c})}}},
changeSsInfoSelf(a){a.classList.remove("selfView");a.classList.add("shareToAll");a.children[0].innerHTML=virtualclass.lang.getString("selfview");virtualclass.gObj.studentSSstatus.shareToAll=!0},changeSsInfoShareToAll(a){a.classList.remove("shareToAll");a.classList.add("selfView");a.children[0].innerHTML=virtualclass.lang.getString("sharetoall");virtualclass.gObj.studentSSstatus.shareToAll=!1},getDimension(a,b){return{height:a.height,width:a.width}}},initPrevImage(){sworker.postMessage({initPrevImg:!0})},
setCurrentApp(){virtualclass.hasOwnProperty("previous")&&"undefined"!==typeof virtualclass.previous&&(virtualclass.currApp=virtualclass.previous.slice(12),virtualclass.vutil.setCurrApp(document.getElementById("virtualclassCont"),virtualclass.currApp))},getScale(a,b){console.log(`Screen type base width ${a}`);return b/a},initShareScreen(a,b){"function"===typeof virtualclass.getDataFullScreen&&(virtualclass.gObj.hasOwnProperty("sendScreen")&&clearTimeout(virtualclass.gObj.sendScreen),virtualclass.gObj.sendScreen=
setTimeout(()=>{a=virtualclass.getDataFullScreen(a);const b=virtualclass.getDataFullScreen("ss");ioAdapter.sendBinary(b);virtualclass.vutil.informIamSharing();a=null;console.log("Send full-screen image")},b))}}}})(window);(function(d){d.recorder={playTime:150,tempPlayTime:150,items:[],objn:0,playTimeout:"",allFileFound:!1,playTimePreviousSeconds:0,waitServer:!1,waitPopup:!1,masterRecordings:[],alreadyAskForPlay:!1,playStart:!1,error:0,currentMin:0,importfilepath:d.importfilepath,exportfilepath:d.exportfilepath,uploadInProcess:!1,totalRecordingFiles:[],totalPlayTimeInMin:0,totalTimeInMiliSeconds:0,subRecordings:null,attachSeekHandler:!1,rawDataQueue:{},xhr:[],session:null,elapsedPlayTime:0,prevFile:null,refrenceTime:null,
totalElements:0,lastFileTime:null,lastRecordings:0,firstTimeRequest:!0,alreadyRequested:{},binarySyncMsg:null,msg:null,orginalTimes:[],startSeek:!1,initPlay:!1,isTrimRecordingNow:!1,joinRoomRecevied:!1,totalTrimTime:0,init(){if(!this.attachSeekHandler){this.attachSeekHandler=!0;const c=document.querySelector("#virtualclassCont"),a=document.querySelector("#downloadProgressBar"),b=document.querySelector("#playProgressBar");a.addEventListener("mousedown",this.seekHandler.bind(this));b.addEventListener("mousedown",
this.seekHandler.bind(this));c.addEventListener("mousemove",this.seekWithMouseMove.bind(this));d.addEventListener("mouseup",this.finalSeek.bind(this));c.addEventListener("touchmove",this.seekWithMouseMove.bind(this));c.addEventListener("touchend",this.finalSeek.bind(this));a.addEventListener("touchstart",this.seekHandler.bind(this));b.addEventListener("touchstart",this.seekHandler.bind(this));c.addEventListener("touchmove",this.seekWithMouseMove.bind(this));c.addEventListener("touchend",this.finalSeek.bind(this));
a.addEventListener("mousemove",this.handlerDisplayTime.bind(this));b.addEventListener("mousemove",this.handlerDisplayTime.bind(this));a.addEventListener("mouseleave",this.removeHandler.bind(this,a));b.addEventListener("mouseleave",this.removeHandler.bind(this,b));virtualclass.pageVisible(this.handlPageActiveness.bind(this))}this.hasOwnProperty("prvNum")||(this.masterIndex=this.subRecordingIndex=0,this.subRecordings=this.masterRecordings[this.masterIndex],this.play(),this.prvNum=this.masterIndex)},
handlPageActiveness(){virtualclass.pageVisible()?this.earlierPause||(this.controller._play(),delete this.earlierPause):(this.earlierPause=this.controller.pause,this.controller._pause())},removeHandler(c){c.removeEventListener("mousedown",this.seekHandler.bind(this));document.getElementById("timeInHover").style.display="none";document.querySelector("#virtualclassCont").classList.remove("recordSeeking")},replayFromStart(){console.log("Replay from start");this.tempPlayTime=this.playTime=150;const c=
this.masterRecordings;virtualclass.config.endSession();virtualclass.popup.closeElem();disCommonChatInput();this.playTimeout="";this.playStart=this.waitPopup=this.waitServer=!1;this.elapsedPlayTime=this.error=0;this.controller.ff=1;this.masterRecordings=c;this.playTimePreviousSeconds=0;this.playProgressBar(this.playTime);delete this.prvNum;this.init()},convertInto(c){if("string"===typeof c.data)return c;c.data=c.data.buffer;return c},playProgressBar(c){0<c?(virtualclass.pbar.renderProgressBar(this.totalTimeInMiliSeconds,
c,"playProgressBar",void 0),c=this.convertIntoReadable(c),document.getElementById("tillRepTime").innerHTML=`${c.h}:${c.m}:${c.s}`,this.alreadyCalcTotTime||(this.updateTotalTime(),this.alreadyCalcTotTime=!0)):virtualclass.pbar.renderProgressBar(1E3*this.lastTimeInSeconds,0,"playProgressBar",void 0)},updateTotalTime(){const c=this.convertIntoReadable(this.totalTimeInMiliSeconds);document.getElementById("totalRepTime").innerHTML=`${c.h}:${c.m}:${c.s}`},convertIntoReadable(c){c/=1E3;let a=0,b=Math.floor(c%
60);c=Math.floor(c/60);60<=c&&(a=Math.floor(c/60),c%=60);10>a&&(a=`0${a}`);10>c&&(c=`0${c}`);10>b&&(b=`0${b}`);return{h:a,m:c,s:b}},displayWaitPopupIfNot(){0==this.waitPopup&&(virtualclass.popup.sendBackOtherElems(),document.getElementById("recordingContainer").style.display="none",virtualclass.popup.waitBlockAction("block"),virtualclass.pbar.renderProgressBar(0,0,"downloadProgressBar","downloadProgressValue"),virtualclass.popup.waitBlock(),this.waitPopup=!0)},requestDataFromServer(c,a){if(this.isFileVcp(c))if(this.alreadyRequested[c]){if(console.log(`Already requested file ${c}`),
0<virtualclass.recorder.totalRecordingFiles.length){var b=virtualclass.recorder.totalRecordingFiles.shift();virtualclass.recorder.requestDataFromServer(b,a)}}else console.log(`requested file ${c}`),b=`https://recording.congrea.net/${wbUser.lkey}/${wbUser.room}/${virtualclass.recorder.session}/${c}`,!0!==virtualclass.gObj.readyToCommunicate?setTimeout(()=>{virtualclass.recorder.requestDataFromServer(c,a)},1E3):a.get(b).then(b=>{virtualclass.recorder.afterDownloading(c,b.data,a)}).catch(b=>{console.error("Request failed with error ",
b);setTimeout(()=>{virtualclass.recorder.requestDataFromServer(c,a)},1E3)})},afterDownloading(c,a,b){if(0<virtualclass.recorder.totalRecordingFiles.length){const a=virtualclass.recorder.totalRecordingFiles.shift();virtualclass.recorder.requestDataFromServer(a,b)}virtualclass.recorder.rawDataQueue[c]={file:c,data:a};this.formatRecording(c);this.alreadyRequested[c]=!0},isFirstPacket(c){c=virtualclass.recorder.orginalListOfFiles[c];return null!=c&&0==c.index},isPacketInSerial(c){if(null!=this.prevFile)return this.orginalListOfFiles[this.prevFile].next===
c||"end"===this.orginalListOfFiles[this.prevFile].next},formatRecording(c){if(this.isFirstPacket(c)||this.isPacketInSerial(c)&&0<Object.keys(this.rawDataQueue).length)c=this.rawDataQueue[c],null!=c&&(this.makeRecordingQueue(c.file,c.data),delete this.rawDataQueue[c.file],this.prevFile=c.file,c=this.orginalListOfFiles[c.file].next,"end"!==c&&this.formatRecording(c))},isFileVcp(c){return null!=c&&null!=c.match(/^.*\.(vcp)$/)},calculateNextTime(c,a){const b=a.substring(0,21);a.substring(22,a.length);
[a]=b.split(" ");a=Math.trunc(a/1E6);return a-c},insertPacketInto(c,a){a=Math.trunc(a/1E3);var b=0;if(!isNaN(a)&&1<=a){this.isTrimRecordingNow?this.updateTrimTime(1E3*a):b=1E3;b={playTime:b,recObjs:'{"0{"user":{"userid":"2"},"m":{"app":"nothing","cf":"sync"}} ',type:"J"};for(let f=0;f<a;f++)c.push(b)}return c},makeRecordingQueue(c,a){console.log(`File formatting ${c}`);var b=[],f=null;a=a.trim().split(/(?:\r\n|\r|\n)/g);for(let c=0;c<a.length;c++)if(null!=a[c]&&""!=a[c]){this.totalElements++;var g=
a[c].substring(0,21);var d=a[c].substring(22,a[c].length);let [k,m]=g.split(" ");this.tempTime=k;k=Math.trunc(k/1E6);null!=this.refrenceTime&&(f?(this.tempPlayTime=k-this.refrenceTime-f,f=null):this.tempPlayTime=k-this.refrenceTime);null!=d&&""!=d&&(!this.joinRoomRecevied&&-1<d.indexOf('"type":"joinroom"')&&(this.joinRoomRecevied=!0,d=JSON.parse(d),d.clientids=d.action,d=JSON.stringify(d)),this.lastFileTime&&0===c&&(g=Math.trunc(k-this.lastFileTime),b=this.insertPacketInto(b,g),this.tempPlayTime=
1E3<g?g%1E3:g),c===a.length-1&&(this.lastFileTime=k),virtualclass.settings.info.trimRecordings&&-1<d.indexOf('{"ac":21,"cf":"recs"')&&(console.log("Trim off, ==== index ",b.length,"master ",this.masterRecordings.length),this.isTrimRecordingNow=!1,this.totalTimeInMiliSeconds-=this.totalTrimTime),this.isTrimRecordingNow?(b.push({playTime:0,recObjs:d,type:m}),this.updateTrimTime(this.tempPlayTime),console.log("Trim on, ==== index ",c,"master ",this.masterRecordings.length)):virtualclass.settings.info.trimRecordings&&
-1<d.indexOf('{"ac":11,"cf":"recs"')?(this.isTrimRecordingNow=!0,this.updateTrimTime(this.tempPlayTime),b.push({playTime:0,recObjs:d,type:m}),console.log("Trim on, ==== index ",b.length,"master ",this.masterRecordings.length)):b.push({playTime:this.tempPlayTime,recObjs:d,type:m}),"undefined"!==typeof a[c+1]&&(d=this.calculateNextTime(k,a[c+1]),b=this.insertPacketInto(b,d,!0),1E3<=d&&(f=1E3*Math.trunc(d/1E3))),this.refrenceTime=k)}console.log(`totalTime in seconds ${this.totalTimeInMiliSeconds/1E3}`);
for(a=0;a<b.length;a++)"B"===b[a].type&&(f=virtualclass.dtCon.base64DecToArr(b[a].recObjs),b[a].recObjs=f);this.masterRecordings.push(b);b=virtualclass.recorder.getTimeFromFile(c);this.finishRequestDataFromServer(b);this.isTrimRecordingNow&&this.allFileFound&&(this.totalTimeInMiliSeconds-=this.totalTrimTime,this.isTrimRecordingNow=!1);this.UIdownloadProgress(c,b);this.updateTotalTime();(3<this.currentMin||this.lastFile===c)&&0<this.masterRecordings.length&&(this.playStart?this.startToPlay():this.alreadyAskForPlay||
(this.alreadyAskForPlay=!0,this.askToPlay()))},updateTrimTime(c){this.totalTrimTime+=c;console.log("==== total trim time",this.totalTrimTime)},handleStartToPlay(c){const a=document.querySelector(".rv-vanilla-modal-overlay.is-shown");null!=a&&a.removeEventListener("click",this.handleStartToPlay.bind(this));virtualclass.gesture.clickToContinue();console.log("===== Start to play");this.startToPlay();c.currentTarget.classList.remove("askToPlayCont")},startToPlay(){this.playStart?this.hasOwnProperty("isPausedByNotPresent")&&
(delete this.isPausedByNotPresent,this.subRecordingIndex=0,this.subRecordings=this.masterRecordings[this.masterIndex],this.controller._play(),virtualclass.popup.closeElem()):(this.playStart=!0,this.playInt(),virtualclass.popup.closeElem())},isDownloadedAllRecordings(c){return 9E5<this.sessionStartTime?c>=virtualclass.recorder.lastTimeInSeconds:!1},finishRequestDataFromServer(c){this.isDownloadedAllRecordings(c)&&(virtualclass.recorder.allFileFound=!0,virtualclass.recorder.alreadyAskForPlay&&(c=document.getElementById("askplayMessage"),
null!=c&&(c.innerHTML=virtualclass.lang.getString("playsessionmsg"))))},UIdownloadProgress(c,a){c=(a-this.firstTimeInSeconds)/60;c>this.currentMin&&(this.currentMin=c);console.log("=====  total trim time ",this.totalTrimTime);c=virtualclass.recorder.totalTimeInMiliSeconds/1E3/60;this.downloadInPercentage=100*this.currentMin/c;virtualclass.pbar.renderProgressBar(c,this.currentMin,"downloadProgressBar","downloadProgressValue");virtualclass.recorder.playStart&&!virtualclass.recorder.waitServer&&virtualclass.recorder.init()},
playInt(){console.log("=====Play init recording=====");virtualclass.popup.closeElem();virtualclass.recorder.init(virtualclass.recorder.masterRecordings);virtualclass.config.setNewSession("thisismyplaymode");virtualclass.recorder.initController();virtualclass.media.audio.initAudiocontext()},askToPlay(){document.querySelector("#loadingWindowCont .loading");document.querySelector("#loadingWindowCont .askToPlay");document.querySelector("#loadingWindowCont");const c=document.querySelector(".rv-vanilla-modal-overlay.is-shown");
c.addEventListener("click",this.handleStartToPlay.bind(this));const a=document.querySelector("#loadingWindowCont .askToPlay");null!=a&&a.addEventListener("click",this.handleStartToPlay.bind(this));document.getElementById("popupContainer").classList.add("playPopup");c.classList.add("askToPlayCont")},playProgressOutput(c){console.log("Offset ",c.offsetX)},getOffset(c){"touchend"==c.type?c=this.lastEvent:(c.offsetX=c.touches[0].pageX-c.touches[0].target.offsetLeft,c.offsetY=c.touches[0].pageY-c.touches[0].target.offsetTop);
return this.lastEvent=c},seekHandler(c){void 0==c.offsetX&&(c=this.getOffset(c));this.pauseBeforeSeek=this.controller.pause;if(this.startSeek)console.log("Earlier seek start is not end yet.");else{this.startSeek=!0;var a=document.querySelector("#virtualclassCont");null!=a&&a.classList.add("recordSeeking");a=c.offsetX;const b=this.getCustomWidth();this.seekValueInPercentage=a/b*100;console.log(`====Seek start ${this.seekValueInPercentage} ev current target=${c.currentTarget.id}`)}},getCustomWidth(){return document.getElementById("downloadProgress").clientWidth-
1},seek(c){virtualclass.videoHost.UI.hideTeacherVideo();c=this.getSeekPoint(c);(c.master<this.masterIndex||c.master==this.masterIndex&&c.sub<this.subRecordingIndex)&&this.replayFromStart();this._seek(c);console.log("seek is finished");this.triggerSynchPacket()},triggerSynchPacket(){this.triggerPlayProgress();this.binarySyncMsg&&(this.handleSyncPacket(),this.binarySyncMsg=null);this.handleSyncStringPacket()},_seek(c){this.controller._pause();let a;for(;;){a=null!=c?this.masterIndex!=c.master?this.masterRecordings[this.masterIndex].length:
c.sub:this.masterRecordings[this.masterIndex].length;for(let b=this.subRecordingIndex;b<a;b++){try{if("B"!=this.subRecordings[this.subRecordingIndex].type)this.msg=io.cleanRecJson(this.subRecordings[this.subRecordingIndex].recObjs),-1<this.msg.indexOf('"m":{"unshareScreen"')?this.binarySyncMsg=null:-1<this.msg.indexOf('},"m":{"poll":{"pollMsg":"stdPublish",')?virtualclass.poll.recordStartTime={app:"Poll",data:{masterIndex:this.masterIndex,subIndex:this.subRecordingIndex}}:-1<this.msg.indexOf('"m":{"videoUl":{"content_path"')?
virtualclass.videoUl.videoStartTime={app:"Video",data:{masterIndex:this.masterIndex,subIndex:this.subRecordingIndex}}:-1<this.msg.indexOf('"m":{"quiz":{"quizMsg":"stdPublish"')&&(virtualclass.quiz.quizStartTime={app:"Quiz",data:{masterIndex:this.masterIndex,subIndex:this.subRecordingIndex}}),io.onRecMessage(this.convertInto({data:this.msg}));else{this.msg=this.subRecordings[this.subRecordingIndex].recObjs;if(104==this.msg[0]||204==this.msg[0]||102==this.msg[0]||202==this.msg[0])if(0==this.msg[1]||
1==this.msg[1])this.binarySyncMsg={data:{masterIndex:this.masterIndex,subIndex:this.subRecordingIndex}};"ScreenShare"!=virtualclass.currApp||104!=this.msg[0]&&204!=this.msg[0]&&103!=this.msg[0]&&203!=this.msg[0]&&102!=this.msg[0]&&202!=this.msg[0]||(io.onRecMessage(this.convertInto({data:this.msg})),this.binarySyncMsg=null)}this.collectElapsedPlayTime()}catch(f){}this.subRecordingIndex++}this.elapsedRecTime=this.elapsedTime=this.elapsedPlayTime;if(void 0!=c&&this.masterIndex===c.master&&c.sub===this.subRecordingIndex)break;
else this.subRecordingIndex=0,this.masterIndex++,this.subRecordings=this.masterRecordings[this.masterIndex]}},handleSyncStringPacket(){if("Poll"===virtualclass.currApp&&"object"===typeof virtualclass.poll.pollState.data&&virtualclass.poll.hasOwnProperty("recordStartTime")){var c=this.getTotalTimeInMilSeconds(virtualclass.poll.recordStartTime.data.masterIndex,virtualclass.poll.recordStartTime.data.subIndex);virtualclass.poll.dataRec.setting.timer?this.pollUpdateTime(c,virtualclass.poll.pollState):
(c=this.convertIntoReadable(this.elapsedPlayTime-c),virtualclass.poll.dataRec.newTime.min=c.m,virtualclass.poll.dataRec.newTime.sec=c.s,virtualclass.poll.elapsedTimer())}else if("Video"===virtualclass.currApp&&"object"===typeof virtualclass.videoUl&&virtualclass.videoUl.hasOwnProperty("videoStartTime"))c=this.getTotalTimeInMilSeconds(virtualclass.videoUl.videoStartTime.data.masterIndex,virtualclass.videoUl.videoStartTime.data.subIndex),c=(this.elapsedPlayTime-c)/1E3,"object"===typeof virtualclass.videoUl.player?
virtualclass.videoUl.playVideo(c):(console.log("====Video init to play start"),virtualclass.videoUl.isPaused=this.pauseBeforeSeek?!0:!1,virtualclass.videoUl.startTime=c);else if("Quiz"===virtualclass.currApp&&"object"===typeof virtualclass.quiz){c=document.querySelector("#qztime");var a=this.getTotalTimeInMilSeconds(virtualclass.quiz.quizStartTime.data.masterIndex,virtualclass.quiz.quizStartTime.data.subIndex);0<+virtualclass.quiz.plugin.config.quizTime?(a=1E3*virtualclass.quiz.plugin.config.quizTime-
(this.elapsedPlayTime-a),virtualclass.quiz.plugin.method.startTimer(a/1E3,c,"desc","vmQuiz")):(a=(this.elapsedPlayTime-a)/1E3,virtualclass.quiz.plugin.method.startTimer(a,c,"asc","vmQuiz"))}},pollUpdateTime(c,a){c=this.convertIntoReadable(6E4*a.data.stdPoll.newTime.min+1E3*a.data.stdPoll.newTime.sec-(this.elapsedPlayTime-c));virtualclass.poll.newTimer.sec=c.s;virtualclass.poll.newTimer.min=c.m;virtualclass.poll.showTimer(virtualclass.poll.newTimer)},handleSyncPacket(){if(this.binarySyncMsg){console.log("Get full screen share");
var c=this.binarySyncMsg.data.subIndex;let a=this.binarySyncMsg.data.masterIndex;for(;a<=this.masterIndex;){console.log(`Start from master index ${a} from Subindex ${c}`);const b=this.masterRecordings[a];let f;for(f=this.masterIndex!=a?this.masterRecordings[this.masterIndex].length:this.subRecordingIndex;c<=f;c++){this.msg=b[c];try{if(null!=this.msg&&"B"==this.msg.type){if(this.msg=this.msg.recObjs,104==this.msg[0]||204==this.msg[0]||103==this.msg[0]||203==this.msg[0]||102==this.msg[0]||202==this.msg[0])io.onRecMessage(this.convertInto({data:this.msg}))}else console.log("Either this.msg is null or string")}catch(g){console.log(`PLAY ERROR ${g.errorCode}`)}}if(this.masterIndex==
a&&c==this.subRecordingIndex)break;else a++,c=0}console.log(`===== Elapsed time 2 ==== ${this.elapsedPlayTime}`);this.playProgressBar(this.elapsedPlayTime)}},getSeekPoint(c){c=Math.trunc(this.totalTimeInMiliSeconds*c/100);console.log(`Seek index ${c}`);let a=0;for(let b=0;b<this.masterRecordings.length;b++)for(let f=0;f<this.masterRecordings[b].length;f++){a+=this.masterRecordings[b][f].playTime;if(a==c)return{master:b,sub:f};if(a>=c)return 0<f?f--:(b--,f=0<=b?this.masterRecordings[b].length-1:0),
console.log(`Seek index i = ${b} j=${f} totalTime=${a}`),{master:b,sub:f}}},play(){this.controller.pause||(this.config(),this.isPlayFinished()?this.allFileFound?this.askAgainToPlay():(this.controller._pause(),this.initReplayWindow(),document.querySelector("#loadingWindowCont .loading").style.display="block",document.querySelector("#loadingWindowCont .askToPlay").style.display="none",this.isPausedByNotPresent=!0):this.executePacketToPlay())},config(){0==this.masterIndex&&0==this.subRecordingIndex&&
(this.startTime=performance.now(),this.reserveTime=this.playTimePreviousSeconds=this.elapsedRecTime=this.elapsedTime=0,document.getElementById("recPlay"),this.doControlActive(recPauseCont));"undefined"!==typeof this.playTimeout&&""!=this.playTimeout&&clearTimeout(this.playTimeout);this.hasOwnProperty("playTime")||(this.subRecordings=this.masterRecordings[this.masterIndex],io.cfg=JSON.parse(this.subRecordings[this.subRecordingIndex].recObjs),virtualclass.gObj.uRole="s")},executePacketToPlay(){this.calcPlayTime();
this.playTimeout=setTimeout(()=>{this.triggerPlayProgress();try{0>this.subRecordings[this.subRecordingIndex].recObjs.indexOf('"cf":"sync"')&&(io.onRecMessage(this.convertInto({data:this.subRecordings[this.subRecordingIndex].recObjs})),"Poll"===virtualclass.currApp&&-1<this.subRecordings[this.subRecordingIndex].recObjs.indexOf('},"m":{"poll":{"pollMsg":"stdPublish",')?virtualclass.poll.recordStartTime={app:"Poll",data:{masterIndex:this.masterIndex,subIndex:this.subRecordingIndex}}:"Video"===virtualclass.currApp&&
-1<this.subRecordings[this.subRecordingIndex].recObjs.indexOf('"m":{"videoUl":{"content_path"')?(virtualclass.videoUl.videoStartTime={app:"Video",data:{masterIndex:this.masterIndex,subIndex:this.subRecordingIndex}},console.log("Capture video")):"Quiz"===virtualclass.currApp&&-1<this.subRecordings[this.subRecordingIndex].recObjs.indexOf('"m":{"quiz":{"quizMsg":"stdPublish",')&&(virtualclass.quiz.quizStartTime={app:"Quiz",data:{masterIndex:this.masterIndex,subIndex:this.subRecordingIndex}}))}catch(c){console.log(`PLAY ERROR ${c.errorCode}`)}this.calcPlayTimeNext();
this.play()},this.playTime)},isPlayFinished(){return"undefined"===typeof this.masterRecordings[this.masterIndex]&&("undefined"===typeof this.subRecordings||"undefined"===typeof this.subRecordings[this.subRecordingIndex])||"undefined"!==typeof this.subRecordings&&"undefined"!==typeof this.subRecordings[this.subRecordingIndex]&&"J"==this.subRecordings[this.subRecordingIndex].type&&-1<this.subRecordings[this.subRecordingIndex].recObjs.indexOf('{"sEnd"')},triggerPauseVideo(){document.querySelector("#dispVideo");
virtualclass.videoUl&&virtualclass.videoUl.player&&(console.log("VIDEO IS PAUSED"),virtualclass.videoUl.player.pause(),virtualclass.videoUl.isPaused=!0)},triggerPlayVideo(){"Video"==virtualclass.currApp&&virtualclass.videoUl&&virtualclass.videoUl.player&&(console.log("VIDEO IS Played"),virtualclass.videoUl.player.play(),virtualclass.videoUl.isPaused=!1)},askAgainToPlay(){if(this.subRecordings&&0>this.subRecordings[this.subRecordingIndex].recObjs.indexOf("sEnd"))io.onRecMessage(this.convertInto({data:this.subRecordings[this.subRecordingIndex].recObjs}));
virtualclass.recorder.allFileFound?virtualclass.recorder.allFileFound&&this.initReplayWindow():(virtualclass.recorder.waitServer=!0,virtualclass.recorder.waitPopup=!1,this.displayWaitPopupIfNot())},initReplayWindow(){this.triggerPauseVideo();virtualclass.popup.replayWindow();virtualclass.popup.sendBackOtherElems();document.getElementById("replayClose").addEventListener("click",()=>{d.close()});document.getElementById("replayButton").addEventListener("click",()=>{virtualclass.recorder.controller.pause=
!1;virtualclass.recorder.replayFromStart.call(virtualclass.recorder)})},getCurrentPacket(){let c=0;if(0<this.masterIndex)for(let a=0;a<this.masterIndex;a++)c+=this.masterRecordings[a].length;return c+this.subRecordingIndex},collectElapsedPlayTime(){this.elapsedPlayTime+=this.subRecordings[this.subRecordingIndex].playTime},triggerPlayProgress(){this.collectElapsedPlayTime();0==this.masterIndex&&0==this.subRecordingIndex?this.playProgressBar(this.elapsedPlayTime):(this.playTimeNowSeconds=Math.round(this.elapsedPlayTime/
1E3),this.playTimeNowSeconds>this.playTimePreviousSeconds&&(this.playProgressBar(this.elapsedPlayTime),virtualclass.popup.sendBackOtherElems(),this.playTimePreviousSeconds=this.playTimeNowSeconds))},calcPlayTime(){"object"===typeof this.subRecordings[this.subRecordingIndex]&&(this.playTimePak=this.subRecordings[this.subRecordingIndex].playTime/this.controller.ff);this.timeNow=performance.now();this.diffTime=this.timeNow-this.startTime;this.startTime=this.timeNow;this.elapsedTime+=this.diffTime;this.playTime=
Math.round(this.playTimePak-(this.elapsedTime-this.elapsedRecTime));this.elapsedRecTime+=this.playTimePak;0>this.playTime&&(this.playTime=0)},calcPlayTimeNext(){this.subRecordingIndex+1==this.subRecordings.length?(this.masterIndex++,this.subRecordings=this.masterRecordings[this.masterIndex],this.subRecordingIndex=0):this.subRecordingIndex++},initController(){if(null!=document.getElementById("playControllerCont")){var c=this;const a=document.getElementsByClassName("ff");for(let b=0;b<a.length;b++)a[b].onclick=
function(){var a=this.id.split("ff")[1];c.controller.fastForward(parseInt(a,10));a=document.querySelector("#dispVideo");virtualclass.videoUl&&virtualclass.videoUl.player&&a.classList.contains("vjs-paused")&&virtualclass.videoUl.player.play();"replayFromStart"!=this.parentNode.id&&c.doControlActive(this)};c=this;const b=document.getElementById("recPause");b.addEventListener("click",()=>{b.parentNode.classList.contains("recordingPlay")?c.initRecPause():c.initRecPlay()})}},initRecPause(){const c=document.getElementById("recPause");
this.controller._pause();this.doControlActive(c);virtualclass.recorder.triggerPauseVideo();c.parentNode.classList.remove("recordingPlay");c.dataset.title="Play"},initRecPlay(){const c=document.getElementById("recPause");this.controller._play();this.doControlActive(c);virtualclass.videoUl&&virtualclass.videoUl.player&&virtualclass.videoUl.player.play();c.parentNode.classList.add("recordingPlay");c.dataset.title="Pause"},doControlActive(c){const a=document.getElementById("playControllerCont").getElementsByClassName("recButton");
for(let b=0;b<a.length;b++)a[b].classList.remove("controlActive");c.parentNode.classList.add("controlActive")},controller:{pause:!1,ff:1,_play(){virtualclass.recorder.startTime=performance.now();this.ff=1;this.pause=!1;virtualclass.recorder.play();console.log("====== Recording play")},_pause(){this.pause=!0;console.log("====== Recording pause")},fastForward(c){this.ff=c;this.pause=!1;virtualclass.recorder.play()}},sendData(c,a,b){this.cb=b;c=JSON.stringify(c);this.httpObj.open("POST",a);this.httpObj.setRequestHeader("x-api-key",
wbUser.lkey);this.httpObj.setRequestHeader("x-congrea-authuser",wbUser.auth_user);this.httpObj.setRequestHeader("x-congrea-authpass",wbUser.auth_pass);this.httpObj.setRequestHeader("x-congrea-room",wbUser.room);this.httpObj.setRequestHeader("Content-Type","application/json");this.httpObj.withCredentials=!1;this.httpObj.send(c)},sortingFiles(c){return c.sort(function(a,b){return a<b?-1:a>b?1:0})},setOrginalListOfFiles(c){const a={};for(let b=0;b<c.length;b++)a[c[b]]=null!=c[b+1]?{index:b,next:c[b+
1]}:{index:b,next:"end"};return a},triggerDownloader(){console.log("Init trigger time to request 1");this.tryNumberOfTimes=1;this.hasOwnProperty("triggerDownloaderTime")&&clearInterval(this.triggerDownloaderTime);this.hasOwnProperty("startTimeCounter")&&clearInterval(this.startTimeCounter);let c=0;this.startTimeCounter=setInterval(()=>{c++;console.log(`=====Timer ===${c}`)},1E3);this.triggerDownloaderTime=setInterval(()=>{console.log("Init trigger time to request 2");3<this.tryNumberOfTimes?(virtualclass.recorder.allFileFound=
!0,clearInterval(this.triggerDownloaderTime.triggerDownloaderTime),this.isPlayFinished()&&this.askAgainToPlay()):virtualclass.xhrn.vxhrn.post(virtualclass.api.recordingFiles,data).then(a=>{this.afterDownloadingList(a.data)});console.log("Time to request 180000")},18E4)},afterDownloadingList(c){if(null!=c&&c.hasOwnProperty("Item")){var a=+c.Item.time.N;this.sessionStartTime=(new Date).getTime()-a;a=[...new Set(c.Item.list.L.map(a=>a.S))];c=a.length;if(this.lastRecordings&&a.length==this.lastRecordings)this.tryNumberOfTimes=
this.tryNumberOfTimes?++this.tryNumberOfTimes:1;else{delete this.alreadyCalcTotTime;this.totalRecordingFiles=this.sortingFiles(a);this.lastFile=this.totalRecordingFiles[this.totalRecordingFiles.length-1];this.orginalListOfFiles=this.setOrginalListOfFiles(this.totalRecordingFiles);this.calculateTotalPlayTime();a=this.totalRecordingFiles.shift();this.firstxhr=axios.create({timeout:6E5,withCredentials:!0});this.requestDataFromServer(a,this.firstxhr);for(const a in this.totalRecordingFiles)virtualclass.createPrefetchLink(`https://recording.congrea.net/${wbUser.lkey}/${wbUser.room}/${virtualclass.recorder.session}/${this.totalRecordingFiles[a]}`);
9E5>this.sessionStartTime&&this.triggerDownloader()}this.lastRecordings=c}else this.tryNumberOfTimes=this.tryNumberOfTimes?++this.tryNumberOfTimes:1,this.triggerDownloader()},requestListOfFiles(){this.session=wbUser.session;virtualclass.popup.loadingWindow();virtualclass.xhrn.vxhrn.post(virtualclass.api.recordingFiles,{session:virtualclass.recorder.session}).then(c=>{this.afterDownloadingList(c.data)})},calculateTotalPlayTime(){const c=Math.trunc(+virtualclass.recorder.totalRecordingFiles[0].split("-")[0]/
1E6),a=Math.trunc(+virtualclass.recorder.totalRecordingFiles[virtualclass.recorder.totalRecordingFiles.length-1].split("-")[1].split(".")[0]/1E6);this.totalTimeInMiliSeconds=a-c;this.lastTimeInSeconds=Math.trunc(a/1E3);this.firstTimeInSeconds=Math.trunc(c/1E3)},getTimeFromFile(c){return+c.split("-")[1].split(".")[0]/1E9},totalPlayTime(){let c=0;for(let a=0;a<virtualclass.recorder.masterRecordings.length;a++)for(let b=0;b<virtualclass.recorder.masterRecordings[a].length;b++)c+=virtualclass.recorder.masterRecordings[a][b].playTime;
return c/1E3},getTotalTimeInMilSeconds(c,a){let b=0,f=0;for(;b<=c;){for(let g=0;g<virtualclass.recorder.masterRecordings[b].length&&(f+=virtualclass.recorder.masterRecordings[b][g].playTime,c!==b||a!==g);g++);b+=1}return f},getTempTotalTimeInMilSeconds(c,a){let b=0,f=0;for(;b<=c;){for(let g=0;g<this.orginalTimes[b].length&&(f+=this.orginalTimes[b][g],c!=b||a!=g);g++);b++}return f},getTotalElementLength(){let c=0;for(let a=0;a<virtualclass.recorder.masterRecordings.length;a++)c+=virtualclass.recorder.masterRecordings[a].length;
return c},seekWithMouseMove(c){void 0==c.offsetX&&(c=this.getOffset(c));this.startSeek&&(this.controller._pause(),this.seekValueInPercentage=this.getSeekValueInPercentage(c),this.downloadInPercentage<this.seekValueInPercentage&&(this.seekValueInPercentage=Math.trunc(this.downloadInPercentage)),this.setPlayProgressTime(this.seekValueInPercentage),virtualclass.pbar.renderProgressBar(this.totalTimeInMiliSeconds,6E4*this.seekTimeWithMove.m+1E3*this.seekTimeWithMove.s,"playProgressBar",void 0),document.querySelector("#tillRepTime").innerHTML=
`${this.seekTimeWithMove.h}:${this.seekTimeWithMove.m}:${this.seekTimeWithMove.s}`,this.displayTimeInHover(c,this.seekValueInPercentage))},getSeekValueInPercentage(c){const a=this.getCustomWidth();return c.offsetX/a*100},handlerDisplayTime(c){const a=this.getSeekValueInPercentage(c);this.displayTimeInHover(c,a)},displayTimeInHover(c,a){this.setPlayProgressTime(a);c=20>c.offsetX?3:5>d.innerWidth-c.offsetX?c.offsetX-65:30>d.innerWidth-c.offsetX?c.offsetX-60:40>d.innerWidth-c.offsetX?c.offsetX-35:c.offsetX-
25;a=document.getElementById("timeInHover");a.style.display="block";a.style.marginLeft=`${c}px`;document.getElementById("timeInHover").innerHTML=`${this.seekTimeWithMove.h}:${this.seekTimeWithMove.m}:${this.seekTimeWithMove.s}`;document.querySelector("#virtualclassCont").classList.add("recordSeeking")},setPlayProgressTime(c){this.seekTimeWithMove=this.convertIntoReadable(c*this.totalTimeInMiliSeconds/100)},finalSeek(c){c.offsetX||(c=this.getOffset(c));this.startSeek&&this.hasOwnProperty("seekValueInPercentage")&&
(console.log(`====Seek up ${this.seekValueInPercentage}`),this.downloadInPercentage<this.seekValueInPercentage&&(this.seekValueInPercentage=Math.trunc(this.downloadInPercentage)),0<this.seekValueInPercentage&&this.seek(this.seekValueInPercentage),this.pauseBeforeSeek?(console.log("=== Video pause "),this.controller._pause(),this.triggerPauseVideo()):(console.log("=== Video play "),this.controller._play(),this.triggerPlayVideo()),document.getElementById("timeInHover").style.display="none");document.querySelector("#virtualclassCont").classList.remove("recordSeeking");
console.log(c.offsetX);delete this.seekValueInPercentage;this.startSeek=!1;c=document.getElementById("congrealogo");null!=c&&c.classList.remove("disbaleOnmousedown")}}})(window);(function(d){let c,a=!1,b=!1,f=!1;d.storage={version:8,async init(){c=this;this.tables="wbData dataAdapterAll dataUserAdapterAll executedStoreAll executedUserStoreAll dstdata pollStorage quizData dstall".split(" ");this.db=await virtualclass.virtualclassIDBOpen("vidya_apps",c.dbVersion,{upgrade(a,b,f,d){c.onupgradeneeded(a)}});"object"===typeof this.db.objectStoreNames&&null!=this.db.objectStoreNames?await this.onsuccess():this.init()},onupgradeneeded(a){a.objectStoreNames.contains("wbData")||a.createObjectStore("wbData",
{keyPath:"did"});a.objectStoreNames.contains("dataAdapterAll")||a.createObjectStore("dataAdapterAll",{keyPath:"serialKey"});a.objectStoreNames.contains("dataUserAdapterAll")||a.createObjectStore("dataUserAdapterAll",{keyPath:"serialKey"});a.objectStoreNames.contains("executedStoreAll")||a.createObjectStore("executedStoreAll",{keyPath:"serialKey"});a.objectStoreNames.contains("executedUserStoreAll")||a.createObjectStore("executedUserStoreAll",{keyPath:"serialKey"});a.objectStoreNames.contains("dstdata")||
a.createObjectStore("dstdata",{keyPath:"timeStamp",autoIncrement:!0});a.objectStoreNames.contains("pollStorage")||a.createObjectStore("pollStorage",{keyPath:"timeStamp",autoIncrement:!0});a.objectStoreNames.contains("quizData")||a.createObjectStore("quizData",{keyPath:"quizkey"});a.objectStoreNames.contains("dstall")||a.createObjectStore("dstall",{keyPath:"timeStamp",autoIncrement:!0})},async onsuccess(){var a=this.tables.indexOf("wbData");-1<a?a=this.tables.slice(a+1):{tables:a}=this;await this.getAllObjs(a)},
store(a){const b=c.db.transaction("wbData","readwrite");b.store.put({repObjs:a,did:virtualclass.gObj.currWb,id:1});b.done.then(()=>{},()=>{console.log("failure")})},pollStore(a){const b=c.db.transaction("pollStorage","readwrite");b.store.add({pollResult:a,currTime:(new Date).getTime(),id:1});b.done.then(()=>{console.log("success")},()=>{console.log("failure")})},wbDataRemove(a){console.log("Whiteboard data remove");c.db.transaction(["wbData"],"readwrite").store.delete(a)},async dataExecutedStoreAll(a,
b){const f=c.db.transaction("executedStoreAll","readwrite");f.store.put({executedData:a,id:6,serialKey:b});f.done.then(()=>{console.log("success")},()=>{console.log("failure")})},dataAdapterAllStore(a,b){const f=c.db.transaction("dataAdapterAll","readwrite");f.store.put({adaptData:a,id:5,serialKey:b});f.done.then(()=>{},()=>{console.log("failure")})},dataUserAdapterAllStore(a,b){const f=c.db.transaction("dataUserAdapterAll","readwrite");f.store.put({adaptUserData:a,id:7,serialKey:b});f.done.then(()=>
{console.log("success")},()=>{console.log("failure")})},dataExecutedUserStoreAll(a,b){const f=c.db.transaction("executedUserStoreAll","readwrite");f.store.put({executedUserData:a,id:8,serialKey:b});f.done.then(()=>{console.log("success")},()=>{console.log("failure")})},quizStorage(a,b){const f=c.db.transaction("quizData","readwrite");f.store.put({qzData:b,quizkey:a});f.done.then(()=>{console.log("success")},()=>{console.log("failure")})},async getAllObjs(){await this.getDataFromTable("wbData");await this.getDataFromTable("dataAdapterAll");
await this.getDataFromTable("dataUserAdapterAll");await this.getDataFromTable("executedStoreAll");await this.getDataFromTable("executedUserStoreAll");await this.getDataFromTable("dstdata");await this.getDataFromTable("dstall")},async getDataFromTable(a){const b=await this.db.transaction(a).store.openCursor();await this[a].handleResult(b)},async getAllDataOfPoll(a,b){a=[];let f=await c.db.transaction("pollStorage").store.openCursor();for(;f;)console.log(f.key,f.value),a.push(f.value),f=await f.continue();
0<a.length?b(a):console.log("No data fetched from indexedDb")},wbData:{async handleResult(a){for(;a;)a.value.hasOwnProperty("repObjs")&&("object"===typeof virtualclass.wb?(console.log(`Total Whiteboard Length ${JSON.parse(a.value.repObjs).length} From indexeddb`),virtualclass.wb[virtualclass.gObj.currWb].utility.replayFromLocalStroage(JSON.parse(a.value.repObjs))):virtualclass.gObj.tempReplayObjs._doc_0_0=JSON.parse(a.value.repObjs),f=!0),a=await a.continue();f||"Whiteboard"!==virtualclass.currApp||
virtualclass.wb[virtualclass.gObj.currWb].utility.makeUserAvailable()}},dataAdapterAll:{async handleResult(a){for(;a;){if(a.value.hasOwnProperty("adaptData")){const b=JSON.parse(a.value.adaptData);parseInt(a.value.serialKey)>ioAdapter.serial&&(ioAdapter.serial=parseInt(a.value.serialKey));ioAdapter.adapterMustData[ioAdapter.serial]=b}a=await a.continue()}}},dataUserAdapterAll:{async handleResult(a){for(;a;){if(a.value.hasOwnProperty("adaptUserData")){const c=JSON.parse(a.value.adaptUserData);var b=
a.value.serialKey.split("_");const f=parseInt(b[0]);b=parseInt(b[1]);ioAdapter.validateAllVariables(f);b>ioAdapter.userSerial[f]&&(ioAdapter.userSerial[f]=b);ioAdapter.userAdapterMustData[f][b]=c}a=await a.continue()}}},executedStoreAll:{async handleResult(a){for(;a;){if(a.value.hasOwnProperty("executedData")){const c=JSON.parse(a.value.executedData);var b=a.value.serialKey.split("_");const f=parseInt(b[0]);b=parseInt(b[1]);ioMissingPackets.validateAllVariables(f);ioMissingPackets.executedStore[f][b]=
c}a=await a.continue()}}},executedUserStoreAll:{async handleResult(a){for(;a;){if(a.value.hasOwnProperty("executedUserData")){const c=JSON.parse(a.value.executedUserData);var b=a.value.serialKey.split("_");const f=parseInt(b[0]);b=parseInt(b[1]);ioMissingPackets.validateAllUserVariables(f);ioMissingPackets.executedUserStore[f][b]=c}a=await a.continue()}}},dstdata:{async handleResult(b){for(;b;)b.value.hasOwnProperty("alldocs")&&(console.log("document share store"),a=!0,virtualclass.gObj.docs=JSON.parse(b.value.alldocs)),
b=await b.continue();a||(virtualclass.gObj.docs="init",console.log("==== Docs init "))}},dstAllStore(a){const b=this.db.transaction("dstall","readwrite");b.store.clear();const c=JSON.stringify(virtualclass.dts.allNotes);b.store.add({dstalldocs:JSON.stringify(a),allNotes:c,timeStamp:(new Date).getTime(),id:10});b.done.then(()=>{console.log("success")},()=>{console.log("failure")})},dstall:{async handleResult(a){for(;a;)a.value.hasOwnProperty("dstalldocs")&&(console.log("document share store"),b=!0,
virtualclass.gObj.dstAll=JSON.parse(a.value.dstalldocs),virtualclass.gObj.dstAllNotes=JSON.parse(a.value.allNotes)),a=await a.continue();b||(console.log("document share store init"),virtualclass.gObj.dstAll="init")}},clearSingleTable(a,b){this.db.transaction(a,"readwrite").store.clear();"undefined"!==typeof b&&b();"dstdata"==a&&(virtualclass.gObj.docs="init",console.log("==== Docs init "));"dstall"==a&&(virtualclass.gObj.dstall="init")},clearStorageData(){ioAdapter.adapterMustData=[];ioAdapter.serial=
-1;ioAdapter.userSerial=[];ioAdapter.userAdapterMustData=[];ioMissingPackets.executedStore=[];ioMissingPackets.executedSerial={};ioMissingPackets.missRequest=[];ioMissingPackets.aheadPackets=[];ioMissingPackets.missRequestFlag=0;ioMissingPackets.executedUserStore=[];ioMissingPackets.executedUserSerial={};ioMissingPackets.missUserRequest=[];ioMissingPackets.aheadUserPackets=[];ioMissingPackets.missUserRequestFlag=0;for(let a=0;a<this.tables.length;a++)a+1==this.tables.length?this.clearSingleTable(this.tables[a],
this.clearLastTable):this.clearSingleTable(this.tables[a])},clearLastTable(){virtualclass.gObj.hasOwnProperty("sessionEndResolve")&&virtualclass.gObj.sessionEndResolve()},async getQuizData(a){const b=[];let c=await this.db.transaction("quizData").store.openCursor();for(;c;)b[c.value.quizkey]=c.value.qzData,c=await c.continue();a(b)},clearTableData(a){this.db.transaction(a,"readwrite").store.clear()},async getWbData(a){const b=await (await this.db.transaction("wbData","readwrite")).objectStore("wbData").get(a);
"undefined"!==typeof b?(console.log(`Whiteboard start store from local storage ${a}`),virtualclass.gObj.tempReplayObjs[a]=[],virtualclass.gObj.tempReplayObjs[a]=JSON.parse(b.repObjs)):virtualclass.gObj.tempReplayObjs[a]="nodata"}}})(window);(function(d,c){d.user=function(a){return{assignRole(a,c,g){roles.hasControls()&&(roles.isEducator()||virtualclass.html.leftAppBar(),virtualclass.attachFunction(),"Whiteboard"==c&&d.virtualclass.wb[virtualclass.gObj.currWb].attachToolFunction(virtualclass.gObj.commandToolsWrapperId[virtualclass.gObj.currWb],!0,virtualclass.gObj.currWb),virtualclass.hasOwnProperty("previrtualclass")?virtualclass.vutil.makeActiveApp(`virtualclass${c}`,virtualclass.previrtualclass):virtualclass.vutil.makeActiveApp(`virtualclass${c}`),
"object"===typeof virtualclass.wb&&virtualclass.wb[virtualclass.gObj.currWb].utility.makeCanvasEnable())},teacherIsAlreadyExist(){const a=c.getElementById("chat_div").getElementsByClassName("ui-memblist-usr");let f;for(let b=0;b<a.length;b++)if(f=a[b].getAttribute("data-role"),"t"==f||"e"==f)return!0;return!1},createControl(a,f){const b=c.createElement("div");b.id=`${a}ControlContainer`;b.className="controls";this.createControlDivs(b,a,f);return b},createControllerElement(a,f){const b=c.createElement("span");
b.id=`${a+f}Img`;const d=c.createElement("a");d.id=`${a+f}Anch`;d.className="congtooltip";d.appendChild(b);const m=c.createElement("div");m.id=`${a+f}Cont`;m.className="controleCont";m.appendChild(d);return[m,b]},createAssignControl(a,f,g,d){const b=this;var k=this.createControllerElement(f,"contrAssign");const q=k[0],r=k[1];k=c.getElementById(`${f}ControlContainer`);null!=k?0>=k.getElementsByClassName("controleCont").length?k.appendChild(q):k.insertBefore(q,k.firstChild):a.appendChild(q);virtualclass.user.control.changeAttribute(f,
r,g,"assign","aRole");"undefined"!==typeof d&&(r.className+=" currTeacher");r.addEventListener("click",()=>{b.control.init.call(b,r)})},createControlDivs(a,c,g){const b=this;let f=!1,d=localStorage.getItem(`virtualclass${c}`);if(null!=d&&(f=!0,d=JSON.parse(d),d.hasOwnProperty("currTeacher")))if(virtualclass.gObj[`${c}currTeacher`]={},1==d.currTeacher){var q=virtualclass.user.control.currTeacherAlready=!0;virtualclass.gObj[`${c}currTeacher`].ct=!0}else virtualclass.gObj[`${c}currTeacher`].ct=!1;const r=
!roles.isEducator(),z=virtualclass.vutil.userIsOrginalTeacher(c);virtualclass.vutil.isUserTeacher(c);for(let k=0;k<g.length;k++)if("assign"==g[k]&&z)"undefined"!==typeof q?this.createAssignControl(a,c,r,q):this.createAssignControl(a,c,r);else if("audio"==g[k]){var t=this.createControllerElement(c,"contrAud"),u=t[0],p=t[1];a.appendChild(u);u=f&&d.hasOwnProperty("aud")?!!d.aud:!0;virtualclass.user.control.changeAttribute(c,p,u,"audio","aud");z&&p.addEventListener("click",()=>{b.control.init.call(b,
p)});roles.hasAdmin()&&"false"===p.dataset.audioDisable&&(u=localStorage.getItem("allAudioAction"),null!=u&&"disable"===u&&p.click())}else if("chat"==g[k]){t=this.createControllerElement(c,"contrChat");u=t[0];var v=t[1];a.appendChild(u);z&&v.addEventListener("click",()=>{b.control.init.call(b,v)});var B=f&&d.hasOwnProperty("chat")?!!d.chat:!0;virtualclass.user.control.changeAttribute(c,v,B,"chat","chat")}else if("editorRich"==g[k]||"editorCode"==g[k]){if(roles.hasAdmin()){var C=f&&d.hasOwnProperty(g[k])?
!!d[g[k]]:!1;t=this.createControllerElement(c,`contr${g[k]}`);u=t[0];t=t[1];u.className+=` controller${g[k]}`;a.appendChild(u);virtualclass.currApp!=virtualclass.vutil.capitalizeFirstLetter(g[k])&&(u.style.display="none");virtualclass.user.control.changeAttribute(c,t,C,g[k],g[k]);z&&t.addEventListener("click",b.closureEditor(b,t))}}else"RaiseHand"==g[k]&&(f&&d.hasOwnProperty("raiseHand"),virtualclass.user.control.changeAttribute(c,v,B,"RaiseHand","RaiseHand"))},closureEditor(a,c){return function(){a.control.init.call(a,
c)}},control:{toggleDisplayWriteModeMsgBox(a,f){let b=c.getElementById(`${a}writeModeBox`);const d=f?virtualclass.lang.getString("writemode"):virtualclass.lang.getString("readonlymode"),m=c.getElementById(`virtualclass${a}Body`);null==b&&null!=m&&(b=c.createElement("div"),b.id=`${a}writeModeBox`,m.appendChild(b));null!=b&&(b.className="writeModeBox",b.dataset.writeMode=f,b.innerHTML=d);"EditorRich"==a&&this.tooglDisplayEditorToolBar(f)},tooglDisplayEditorToolBar(a){const b=c.getElementsByClassName("vceditor-toolbar"),
g=b[0];0<b.length&&(a?(g.style.pointerEvents="visible",g.style.opacity="1"):(g.style.pointerEvents="none",g.style.opacity="0.5"))},received_editorRich(a){let b;a.status?(virtualclass.gObj.uid==a.toUser?"object"!==typeof virtualclass.editorRich.cm||virtualclass.isPlayMode||virtualclass.editorRich.cm.setOption("readOnly",!1):this.enable(a.toUser,"editorRich","editorRich","editorRich"),virtualclass.isPlayMode&&virtualclass.editorRich.control.toggleDisplayWriteModeMsgBox(!1),b=!0):(virtualclass.gObj.uid==
a.toUser?"object"===typeof virtualclass.editorRich.cm&&virtualclass.editorRich.cm.setOption("readOnly","nocursor"):this.disable(a.toUser,"editorRich","editorRich","editorRich"),b=!1);localStorage.setItem("editorRich",b);roles.hasAdmin()||this.toggleDisplayWriteModeMsgBox("EditorRich",b);!roles.hasAdmin()&&"iOS"==virtualclass.system.mybrowser.name&&virtualclass.system.isIPad()&&(a.status?virtualclass.editorRich.enableEditorByOuterLayer():virtualclass.editorRich.disableEditorByOuterLayer());virtualclass.vutil.setReadModeWhenTeacherIsDisConn("editorRich")},
received_editorCode(a){let b;a.status?(virtualclass.gObj.uid==a.toUser?"object"!==typeof virtualclass.editorCode.cm||virtualclass.isPlayMode||virtualclass.editorCode.cm.setOption("readOnly",!1):this.enable(a.toUser,"editorCode","editorCode","editorCode"),virtualclass.isPlayMode&&virtualclass.editorCode.control.toggleDisplayWriteModeMsgBox(!1),b=!0):(virtualclass.gObj.uid==a.toUser?"object"===typeof virtualclass.editorCode.cm&&virtualclass.editorCode.cm.setOption("readOnly","nocursor"):this.disable(a.toUser,
"editorCode","editorCode","editorCode"),b=!1);localStorage.setItem("editorCode",b);roles.hasAdmin()||this.toggleDisplayWriteModeMsgBox("EditorCode",b);!roles.hasAdmin()&&"iOS"==virtualclass.system.mybrowser.name&&virtualclass.system.isIPad()&&(a.status?virtualclass.editorCode.enableEditorByOuterLayer():virtualclass.editorCode.disableEditorByOuterLayer());virtualclass.vutil.setReadModeWhenTeacherIsDisConn("editorCode")},onmessage(a){a.message.hasOwnProperty("toUser")||(a.message.toUser=virtualclass.gObj.uid);
this[`received_${a.message.control}`](a.message)},addCurrTeacherToControl(a){const b=c.getElementById(a);null!=b&&(virtualclass.vutil.elemHasAnyClass(a)?b.classList.add("currTeacher"):b.className="currTeacher")},removeCurrTeacherFromControl(a){var b=c.getElementById(a);virtualclass.vutil.elemHasAnyClass(a)&&(b.classList.remove("currTeacher"),b=a.indexOf("contr"),a=a.substring(0,b),virtualclass.user.control.updateUser(a,"currTeacher",!1))},removeAudioFromParticipate(a){a=c.getElementById(`${a}contrAssignCont`);
null!=a&&a.parentNode.removeChild(a)},disable(a,c,g,d){g=virtualclass.gObj.testChatDiv.shadowRoot.querySelector(`.${c}Control${a} `+" .contImg");null!=g&&virtualclass.user.control._disable(g,c,a,d)},_disable(a,c,g,d){a.parentNode.setAttribute("data-title",virtualclass.lang.getString(`${c}Disable`));a.setAttribute(`data-${c}-disable`,"true");a.className=`icon-${c}Img block`+` ${c}Img`;if("assign"==c)a.parentNode.classList.remove("tooltip"),this.addCurrTeacherToControl(a.id),a=localStorage.getItem(`virtualclass${g}`),
a=JSON.parse(a),virtualclass.gObj.hasOwnProperty(`${g}currTeacher`)?(virtualclass.gObj[`${g}currTeacher`].ct||virtualclass.gObj.hasOwnProperty("controlAssign")&&virtualclass.gObj.controlAssign&&a.currTeacher)&&virtualclass.user.control.updateUser(g,"currTeacher",!0):virtualclass.gObj.hasOwnProperty("controlAssign")&&virtualclass.gObj.controlAssignId==g&&virtualclass.user.control.updateUser(g,"currTeacher",!0);else if("audio"==c||"chat"==c)a.className=`icon-${c}DisImg block`+` ${c}DisImg`;virtualclass.user.control.updateUser(g,
d,!1)},enable(a,c,g,d){g=virtualclass.gObj.testChatDiv.shadowRoot.querySelector(`.${c}Control${a} .contImg`);null==g?console.log("Element is Null"):virtualclass.user.control._enable(g,c,a,d)},_enable(a,c,g,d){a.parentNode.setAttribute("data-title",virtualclass.lang.getString(`${c}Enable`));a.setAttribute(`data-${c}-disable`,"false");a.className=`icon-${c}Img enable`+` ${c}Img`;"RaiseHand"==c&&virtualclass.raiseHand._raiseHand(g);virtualclass.user.control.updateUser(g,d,!0)},changeAttribute(a,c,g,
d,m){g?virtualclass.user.control._enable(c,d,a,m):virtualclass.user.control._disable(c,d,a,m)},init(a,c,g,d){"undefined"===typeof g&&(g="Img");var b=a.id,f=b.indexOf("contr");f=b.substring(0,f);b=b.split("contr")[1];g=b.indexOf(g);g=b.substring(0,g);if("Assign"==g)virtualclass.vutil.appIsForEducator(virtualclass.currApp)&&(virtualclass.gObj.controlAssign=!0,virtualclass.gObj.controlAssignId=f,d="true"==a.getAttribute("data-assign-disable"),d||(this.control.changeAttribute(f,a,d,"assign","aRole"),
virtualclass.user.control._assign(f),virtualclass.user.control.changeAttrToAssign("block")),roles.hasAdmin()||virtualclass.user.control.removeAudioFromParticipate(f));else{let k;"stdscreen"==g?(roles.hasControls()&&"virtualclassScreenShare"==virtualclass.previous&&virtualclass.vutil.initDefaultApp(),this.control._stdscreen.call(this.control,f),"Video"==virtualclass.currApp&&virtualclass.videoUl.player&&(ioAdapter.mustSend({videoUl:{init:"destroyPlayer"},cf:"destroyPlayer"}),ioAdapter.mustSend({videoUl:{init:"studentlayout"},
cf:"videoUl"}),virtualclass.vutil.initDashboard(),virtualclass.vutil.removeBackgroundVideoApp())):("Chat"==g?(a.className="contrChatBlock",b="chat"):b="Aud"==g?"audio":g,"undefined"!==typeof c?c=(k="enable"==c)?"enable":"block":"true"==a.getAttribute(`data-${b}-disable`)?(c="enable",k=!0):(c="block",k=!1),this.control.changeAttribute(f,a,k,b,virtualclass.vutil.smallizeFirstLetter(g)),void 0==d&&this.control[`_${b}`].call(this.control,f,c))}},init_old(a){var b=a.id,c=b.indexOf("contr");c=b.substring(0,
c);b=b.split("contr")[1];const d=b.indexOf("Img");b=b.substring(0,d);"Assign"==b?(virtualclass.gObj.controlAssign=!0,virtualclass.gObj.controlAssignId=c,b="true"==a.getAttribute("data-assign-disable"),b||(this.control.changeAttribute(c,a,b,"assign","aRole"),virtualclass.user.control._assign(c),virtualclass.user.control.changeAttrToAssign("block")),roles.hasAdmin()||virtualclass.user.control.removeAudioFromParticipate(c)):"Chat"==b?("true"==a.getAttribute("data-chat-disable")?(a.className="contrChatBlock",
b="enable",this.control.changeAttribute(c,a,!0,"chat","chat")):(b="block",this.control.changeAttribute(c,a,!1,"chat","chat")),this.control._chat(c,b)):"Aud"==b&&("true"==a.getAttribute("data-audio-disable")?(b="enable",this.control.changeAttribute(c,a,!0,"audio","aud")):(b="block",this.control.changeAttribute(c,a,!1,"audio","aud")),this.control._audio(c,b))},_assign(a,f,g){virtualclass.vutil.assignRole();virtualclass.vutil.removeAppPanel();virtualclass.system.setAppDimension();virtualclass.vutil.renderWhiteboardObjectsIfAny();
if(!roles.hasAdmin()){var b=c.getElementById("vcanvas");b.className=b.className.replace(/\bteacher\b/," ");b.className="student"}localStorage.setItem("canvasDrwMsg",!0);b=c.getElementById("virtualclassScreenShareLocalVideo");null!=b&&"VIDEO"==b.tagName&&virtualclass.vutil.videoTeacher2Student("ScreenShare",!0);"ScreenShare"==virtualclass.currApp&&(virtualclass.ss.hasOwnProperty("currentStream")&&virtualclass.ss.currentStream.getTracks()[0].stop(),virtualclass.ss="");"undefined"===typeof f&&(console.log("role transfer"),
virtualclass.vutil.beforeSend({assignRole:!0,toUser:a,cf:"assignRole"},a),roles.hasAdmin()&&(f=c.getElementById(`${a}contreditorRichImg`),"true"==f.dataset.editorrichDisable&&virtualclass.user.control.init.call(virtualclass.user,f),f=c.getElementById(`${a}contreditorCodeImg`),"true"==f.dataset.editorcodeDisable&&virtualclass.user.control.init.call(virtualclass.user,f)));roles.hasAdmin()||("undefined"===typeof g&&(g=a),a=c.getElementById(`${g}ControlContainer`).getElementsByClassName("controleCont")[0],
a.removeChild(a.firstChild),localStorage.removeItem("aId"))},_chat(a,c){"enable"===c?virtualclass.settings.applySettings(!0,"studentpc",a):(virtualclass.user.control.updateUser(a,"chat",!1),virtualclass.settings.applySettings(!1,"studentpc",a))},_audioAll(a,c){"enable"==c?virtualclass.vutil.beforeSend({ena:!0,toUser:a,cf:"ena"},a):virtualclass.vutil.beforeSend({dia:!0,toUser:a,cf:"dia"},a)},_editorRich(a,c){"enable"==c?virtualclass.vutil.beforeSend({status:!0,control:"editorRich",toUser:a,cf:"control"},
a):virtualclass.vutil.beforeSend({status:!1,control:"editorRich",toUser:a,cf:"control"},a)},_editorCode(a,c){"enable"==c?virtualclass.vutil.beforeSend({status:!0,control:"editorCode",toUser:a,cf:"control"},a):virtualclass.vutil.beforeSend({status:!1,control:"editorCode",toUser:a,cf:"control"},a)},_audio(a,c){"enable"==c?virtualclass.settings.applySettings(!0,"studentaudio",a):virtualclass.settings.applySettings(!1,"studentaudio",a)},_RaiseHand(a,c){virtualclass.raiseHand.raisehand(a)},_stdscreen(a){virtualclass.vutil.beforeSend({reqscreen:!0,
toUser:a,cf:"reqscreen"},a)},audioWidgetEnable(a){console.log("Audio enable true");localStorage.setItem("audEnable",JSON.stringify({ac:"true"}));if(null==localStorage.getItem("dvid")){const b=c.getElementById("speakerPressOnce");null!==b&&("undefined"===typeof a&&(b.className="active"),b.style.opacity="1",b.style.pointerEvents="visible")}},mediaWidgetDisable(a){virtualclass.system.mediaDevices.hasWebcam=!1;const b={ac:"false"};let g=localStorage.getItem("audEnable");null!=g?(g=JSON.parse(g),"false"!=
g.ac&&"undefined"!==typeof a&&(b.r=a)):"unefined"!==typeof a&&(b.r=a);console.log(`audEnable ${b}`);a=c.getElementById("audioWidget");a.style.opacity="1";a.style.pointerEvents="visible";a.className="deactive";this.audioDisable();this.videoDisable();virtualclass.gObj.hasOwnProperty("video")&&(virtualclass.media.audio.studentNotSpeak(),virtualclass.media.audio.clickOnceSpeaker("speakerPressOnce","alwaysDisable"));virtualclass.vutil.addClass("virtualclassCont","nowebcam")},audioDisable(){const a=c.getElementById("speakerPressOnce");
null!=a&&(a.style.opacity="0.5",a.style.pointerEvents="none")},videoDisable(){const a=c.getElementById("congCtrBar");null!=a&&(a.style.opacity="0.5",a.style.pointerEvents="none")},videoEnable(){const a=c.getElementById("congCtrBar");null!=a&&(a.style.opacity="1",a.style.pointerEvents="visible")},disableCommonChat(){var a=c.getElementById("chatrm");null!=a&&(this.makeElemDisable(a),a.classList.add("chat_disable"));if(a=c.querySelector("#virtualclassCont.congrea #ta_chrm2"))a.classList.add("disable"),
a.disabled=!0},disbaleAllChatBox(){c.querySelector("#chat_div").classList.add("chat_disabled");const a=c.getElementById("stickybar").getElementsByClassName("ui-chatbox");for(let b=0;b<a.length;b++)this.makeElemDisable(a[b])},makeElemDisable(a){"chatrm"!=a.id&&(virtualclass.vutil.elemHasAnyClass(a.id)?(a.classList.remove("enable"),a.classList.add("disable")):a.className="disable");a=a.getElementsByClassName("ui-chatbox-input-box")[0];null!=a&&(a.disabled=!0)},allChatEnable(a){if("pc"===a){c.querySelector("#chat_div").classList.remove("chat_disabled");
var b=c.getElementById("stickybar").getElementsByClassName("ui-chatbox");for(a=0;a<b.length;a++)this.makeElemEnable(b[a])}else"gc"===a&&(a=c.getElementById("chatrm"),null!=a&&a.classList.remove("chat_disable"),a=c.querySelector("#virtualclassCont.congrea #ta_chrm2"))&&(a.classList.remove("disable"),a.disabled=!1);a=c.querySelector("#virtualclassCont #memlist.enable");b=c.querySelector("#virtualclassCont #chatrm.enable");const g=c.querySelector("#user_list"),d=c.querySelector("#chatroom_bt2");a&&!g.classList.contains("active")&&
(g.classList.contains("active")||g.classList.add("active"),d.classList.remove("active"),virtualclass.chat.chatWindow="private");b&&(d.classList.contains("active")||d.classList.add("active"),g.classList.remove("active"),virtualclass.chat.chatWindow="common")},resetmediaSetting(){if(roles.isStudent()){if(virtualclass.gObj.stdaudioEnable||virtualclass.user.control.audioDisable(),virtualclass.system.mediaDevices.hasWebcam&&virtualclass.videoHost)if(virtualclass.gObj.stdvideoEnable)virtualclass.vutil.videoHandler("off"),
virtualclass.videoHost.toggleVideoMsg("enable");else{virtualclass.videoHost.toggleVideoMsg("disable");var a=c.querySelector("#videoSwitch");null!=a&&a.classList.contains("on")&&(a.classList.remove("on"),a.classList.add("off"))}}else{(a=c.getElementById("contrAudioAllImg"))&&a.classList.contains("icon-all-audio-enable")&&(a.classList.remove("icon-all-audio-enable"),a.classList.add("icon-all-audio-disable"),a.setAttribute("data-title",virtualclass.lang.getString("muteAll")),"enable"==a.dataset.action&&
(a.dataset.action="disable"));a=c.getElementById("videoSwitch");if(null!=a&&virtualclass.system.mediaDevices.hasWebcam&&a.classList.contains("video")){const b=c.getElementById("rightCtlr");a.classList.contains("on")&&(virtualclass.vutil.videoHandler("off"),b.parentNode.setAttribute("data-title",virtualclass.lang.getString("videoon")))}this.mediaSliderSetting("audio");this.mediaSliderSetting("video")}roles.hasAdmin()&&(virtualclass.gObj.delayVid="display")},mediaSliderSetting(a){const b="audio"==a?
"Audio":"Video",g={action:("audio"==a?virtualclass.gObj.stdaudioEnable:virtualclass.gObj.stdvideoEnable)?"enable":"disable",enable:"disable",disable:"enable"};var d=c.querySelector(`.congrea #contr${b}All.${g.action}`);d&&(d.classList.remove(g.action),d.classList.add(g[g.action]),(d=c.querySelector(`.congrea #contr${b}All input`))&&d.removeAttribute("checked"));if(d=c.querySelector(`.congrea .slider.icon-all-${a}-${g.action}`))d.className=`slider round congtooltip icon-all-${a}-${g[g.action]}`,d.setAttribute("data-action",
g[g.action]),d.setAttribute("data-title",virtualclass.lang.getString(`${g[g.action]}All${b}`))},makeElemEnable(a){virtualclass.vutil.elemHasAnyClass(a.id)?(a.classList.remove("disable"),a.classList.add("enable")):a.className="enable";a=a.getElementsByClassName("ui-chatbox-input-box")[0];null!=a&&(a.disabled=!1)},toggleAllEditorController(a,c){a=virtualclass.vutil.smallizeFirstLetter(a);const b=chatContainerEvent.elementFromShadowDom(".controleCont","all");if(0<b.length)for(let g=0;g<b.length;g++)if(0<
b[g].id.indexOf(a)){var f=b[g].id.indexOf("Cont");0<f&&(f=b[g].id.substr(0,f),f=chatContainerEvent.elementFromShadowDom(`${f}Img`,null,!0),this.control.init.call(this,f,c,void 0,"actnotSend"))}"enable"==c?virtualclass.vutil.beforeSend({status:!0,control:"editorRich",cf:"control"}):virtualclass.vutil.beforeSend({status:!1,control:"editorRich",cf:"control"})},toggleDisplayEditorController(a,c){a=virtualclass.vutil.smallizeFirstLetter(a);if(virtualclass.gObj.hasOwnProperty("testChatDiv")){a=chatContainerEvent.elementFromShadowDom(`.controller${a}`,
"all");for(let b=0;b<a.length;b++)a[b].style.display=c}},updateUser(a,c,g){const b=localStorage.getItem(`virtualclass${a}`);let f={};null==b?f.id=a:f=JSON.parse(b);f[c]=g;localStorage[`virtualclass${f.id}`]=JSON.stringify(f);return f},audioSign2(a,f){if("create"==f){if(null==c.getElementById(`${a.id}AudEnableSign`)){f=c.createElement("div");f.id=`${a.id}AudEnableSign`;const b=c.createElement("img");b.id=`${a.id+"audioenable"}Img`;b.src=`${d.whiteboardPath}images/${"audioenable"}.png`;const k=c.createElement("a");
k.id=`${a.id+"audioenable"}Anch`;k.className="audEnableSign tooltip controleCont";k.setAttribute("data-title",virtualclass.lang.getString("studentAudEnable"));k.appendChild(b);f.appendChild(k);c.getElementById(`${a.id}ControlContainer`).appendChild(f)}}else a=c.getElementById(`${a.id}AudEnableSign`),a.parentNode.removeChild(a)},audioSign(a,c){"create"==c?this.iconAttrManupulate(a.id,"icon-audioEnaGreen"):a.aud?this.iconAttrManupulate(a.id,"icon-audioImg"):this.iconAttrManupulate(a.id,"icon-audioDisImg")},
iconAttrManupulate(a,c){a=virtualclass.gObj.testChatDiv.shadowRoot.querySelector(`#ml${a} .audioImg`);if(null!=a)for(let b=0;b<a.classList.length;b++)if("icon-"==a.classList[b].substring(0,5)){a.classList.remove(a.classList[b]);a.classList.add(c);break}},shouldApply(a){let b=localStorage.getItem(`virtualclass${a}`);null!=b&&(b=JSON.parse(b),b.ad&&virtualclass.user.control.audioSign({id:a},"create"))},changeAttrToAssign(a){const b=c.getElementById("chatWidget").getElementsByClassName("assignImg");
for(let c=0;c<b.length;c++)"enable"==a?(b[c].classList.remove("block"),b[c].classList.add("enable"),b[c].parentNode.classList.add("tooltip"),b[c].parentNode.setAttribute("data-title",virtualclass.lang.getString("transferControls")),b[c].setAttribute("data-assign-disable","false")):(b[c].classList.remove("enable"),b[c].classList.add("block"),b[c].parentNode.classList.remove("tooltip"),b[c].setAttribute("data-assign-disable","true"))}},displayStudentSpeaker(a){const b=c.getElementById("alwaysPress");
null!=b&&(b.style.display=a?"block":"none")},toggleAllUserListIcon(a,c){c="audio"===c?"Aud":"Chat";const b=chatContainerEvent.elementFromShadowDom(".controleCont","all");if(0<b.length)for(let g=0;g<b.length;g++)if(0<b[g].id.indexOf(c)){var f=b[g].id.indexOf("Cont");0<f&&(f=b[g].id.substr(0,f),f=chatContainerEvent.elementFromShadowDom(`${f}Img`,null,!0),this.control.init.call(this,f,a,void 0,"actnotSend"))}},toggleAllVideo(a){ioAdapter.mustSend({action:a,cf:"toggleVideo"})},mediaSliderUI(a){const b=
virtualclass.vutil.capitalizeFirstLetter(a);let g=c.querySelector(`.bulkUserActions #contr${b}AllImg`);var d=virtualclass.user.defaultSettings(a,virtualclass.settings.info);const m=c.querySelector(`.bulkUserActions #contr${b}All input`),n=c.querySelector(`.congrea #contr${b}All`),q="enable"===d?"disable":"enable";null!=d?(g.setAttribute("data-action",q),g.className=`slider round icon-all-${a}-${q} enable congtooltip cgIcon`,g.dataset.title=virtualclass.lang.getString(`${q}All${b}`),m.setAttribute("checked",
"true"),n.classList.add(q)):(d={action:d?"enable":"disable",enable:"disable",disable:"enable"},g=c.querySelector(`.bulkUserActions #contr${b}AllImg`),g.setAttribute("data-action",d[d.action]),g.className=`slider round icon-all-${a}-${d[d.action]} congtooltip cgIcon`,g.dataset.title=virtualclass.lang.getString(`${d[d.action]}All${b}`),m.removeAttribute("checked"),n.classList.add(d[d.action]));if(!virtualclass.isPlayMode){const b=this;g.addEventListener("click",()=>{let c;if("audio"===a||"video"===
a||"chat"===a||"groupChat"===a){const f=virtualclass.vutil.capitalizeFirstLetter(a);c=b.toogleIcon(a);virtualclass.settings.applySettings("enable"===c,`student${"chat"===a?"pc":"groupChat"===a?"gc":a}`);"undefined"!==typeof c&&(localStorage.setItem(`all${f}Action`,c),"audio"!==a&&"chat"!==a||b.toggleAllUserListIcon.call(virtualclass.user,c,a))}})}},defaultSettings(a,c){let b,f;for(const g in c)if(f=c[g],"audio"===a&&"studentaudio"===g||"video"===a&&"studentvideo"===g||"chat"===a&&"studentpc"===g||
"groupChat"===a&&"studentgc"===g)b=!0===f?"enable":"disable";return b},chatBoxesSwitch(){if(virtualclass.chat.chatroombox)toggleCommonChatBox();else if(0==$("div#chat_room").length){var a=c.createElement("ul");a.id="chat_room";c.body.appendChild(a);virtualclass.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:{name:"test"},title:lang.chatroom_header,offset:"20px",messageSent(a,b){$("#chat_room").chatroom("option","boxManager").addMsg(a.name,b)}});virtualclass.gObj.hasOwnProperty("chatEnable")&&
!virtualclass.gObj.chatEnable&&(a=c.getElementById("chatrm"),null!=a&&virtualclass.user.control.makeElemDisable(a));a=c.getElementById("cc_arrow_button");a.classList.add("icon-arrow-down");a.classList.remove("icon-arrow-up")}},toogleIcon(a){const b=virtualclass.vutil.capitalizeFirstLetter(a),g=c.querySelector(`.bulkUserActions #contr${b}AllImg`);if(null!=g){const f=g.dataset.action;"enable"===g.dataset.action?(g.dataset.action="disable",g.className=`slider round icon-all-${a}-disable congtooltip`,
g.dataset.title=virtualclass.lang.getString(`disableAll${b}`),a=c.querySelector(`.congrea .bulkUserActions #contr${b}All`),a.classList.add("disable"),a.classList.remove("enable")):(g.dataset.action="enable",g.className=`slider round icon-all-${a}-enable congtooltip`,g.dataset.title=virtualclass.lang.getString(`enableAll${b}`),a=c.querySelector(`.congrea .bulkUserActions #contr${b}All`),a.classList.add("enable"),a.classList.remove("disable"));return f}},changeRoleOnFooter(a,c){chatContainerEvent.elementFromShadowDom(`#ml${a}`).dataset.role=
c},initControlHandler(a){virtualclass.vutil.userIsOrginalTeacher(a);const b=chatContainerEvent.elementFromShadowDom(`#ml${a} .contImg`,"all");let g=!1,d=localStorage.getItem(`virtualclass${a}`);null!=d&&(g=!0,d=JSON.parse(d),d.hasOwnProperty("currTeacher")&&(virtualclass.gObj[`${a}currTeacher`]={},1==d.currTeacher?(virtualclass.user.control.currTeacherAlready=!0,virtualclass.gObj[`${a}currTeacher`].ct=!0):virtualclass.gObj[`${a}currTeacher`].ct=!1));for(let f=0;f<b.length;f++)if(-1<b[f].className.indexOf("chat")){var m=
g&&d.hasOwnProperty("chat")?virtualclass.settings.user.hasOwnProperty(a)?virtualclass.settings.parseSettings(virtualclass.settings.user[a]).studentpc:virtualclass.settings.info.studentpc:virtualclass.settings.info.studentpc;virtualclass.user.control.changeAttribute(a,b[f],m,"chat","chat")}else-1<b[f].className.indexOf("aud")?(g&&d.hasOwnProperty("aud")?m=virtualclass.settings.user.hasOwnProperty(a)?virtualclass.settings.parseSettings(virtualclass.settings.user[a]).studentaudio:virtualclass.settings.info.studentaudio:
(m=c.querySelector("#contrAudioAll"),null!=virtualclass.jId&&m.classList.contains("disable"),m=virtualclass.settings.info.studentaudio),virtualclass.user.control.changeAttribute(a,b[f],m,"audio","aud"),roles.hasAdmin()&&"false"===b[f].dataset.audioDisable&&localStorage.getItem("allAudioAction")):-1<b[f].className.indexOf("RaiseHand")?(m=g&&d.hasOwnProperty("raiseHand")?!!d.raiseHand:!1,virtualclass.user.control.changeAttribute(a,b[f],m,"RaiseHand","RaiseHand")):-1<b[f].className.indexOf("stdscreen")?
virtualclass.gObj.studentSSstatus.hasOwnProperty("whoIsSharing")&&virtualclass.vutil.initssSharing(virtualclass.gObj.whoIsSharing):-1<b[f].className.indexOf("editorRich")&&"EditorRich"==virtualclass.currApp?(c.querySelector("#alleditorRichContainerAnch"),m=g&&d.hasOwnProperty("editorRich")?!!d.editorRich:!1,virtualclass.user.control.changeAttribute(a,b[f],m,"editorRich","editorRich")):-1<b[f].className.indexOf("editorCode")&&(m=g&&d.hasOwnProperty("editorCode")?!!d.editorCode:!1,virtualclass.user.control.changeAttribute(a,
b[f],m,"editorCode","editorCode"))}}}})(window,document);(function(d){d.xhr={init(){this.vxhr=axios.create({timeout:1E4,withCredentials:!0,headers:{"Content-Type":"application/json",post:{"Content-Type":"application/json"},get:{"Content-Type":"application/json"}},onUploadProgress:c=>{virtualclass.xhr.onProgress(c)}})},onProgress(c){virtualclass.pbar.currVal=c.loaded;""!==virtualclass.pbar.prvVal&&"undefined"!==typeof virtualclass.pbar.prvVal||virtualclass.isPlayMode||virtualclass.pbar.progressInit();virtualclass.pbar.renderProgressBar(c.total,c.loaded,
"indProgressBar","indProgressValue")}}})(window);(function(d){d.xhrn={init(){this.vxhrn=axios.create({timeout:1E4,headers:{"Content-Type":"application/json","x-api-key":wbUser.lkey,"x-congrea-authuser":wbUser.auth_user,"x-congrea-authpass":wbUser.auth_pass,"x-congrea-room":wbUser.room,post:{"Content-Type":"application/json"},get:{"Content-Type":"application/json"}}})},getAccess(){this.vxhrn.get(virtualclass.api.access,{withCredentials:!0}).then(()=>{virtualclass.gObj.readyToCommunicate=!0}).catch(c=>{console.error("Request failed with error ",c);
setTimeout(()=>{virtualclass.xhrn.getAccess()},1E3)})}}})(window);const PopUp=function(d,c){function a(a){this.init(a);return this}function b(a,b){const c={};let f;for(f in a)Object.prototype.hasOwnProperty.call(a,f)&&(c[f]=a[f]);for(f in b)Object.prototype.hasOwnProperty.call(b,f)&&(c[f]=b[f]);return c}function f(a){const b=document.createElement("div");b.classList.add("rv-vanilla-modal-overlay");document.querySelector("body").appendChild(b);"function"===typeof a&&a()}"use strict";a.prototype.init=function(a){const c=this;this.settings=b({selector:"[data-rv-vanilla-modal]",
modalSelector:".rv-vanilla-modal",closeSelector:".rv-vanilla-modal-close",showModalClassName:"rv-vanilla-modal-is-open",showOverlay:!0},a);this.modalElements=document.querySelectorAll(this.settings.modalSelector);this.triggers=document.querySelectorAll(this.settings.selector);this.settings.showOverlay&&f(()=>{c.overlayElement=document.querySelector(".rv-vanilla-modal-overlay")})};a.prototype.close=function(a){a.classList.remove(this.settings.showModalClassName);document.getElementById("popupContainer").style.display=
"none";this.settings.showOverlay&&this.overlayElement.classList.remove("is-shown")};a.prototype.open=function(a){document.getElementById("popupContainer").style.display="block";this.sendBackOtherElems();this.closeShownModal();a.classList.add(this.settings.showModalClassName);this.settings.showOverlay&&this.overlayElement.classList.add("is-shown")};a.prototype.each=function(a){[].forEach.call(this.triggers,b=>{"function"===typeof a&&a(b)})};a.prototype.closeShownModal=function(){const {showModalClassName:a}=
this.settings;[].forEach.call(this.modalElements,b=>{b.classList.contains(a)&&b.classList.remove(a)})};a.prototype.closeElem=function(){document.getElementById("popupContainer").classList.remove("playPopup","loading");console.log("close popup");if(0==virtualclass.recorder.waitServer){var a=document.getElementById("virtualclassOptionsCont");null!=a&&(a.style.zIndex=100);a=document.getElementById("stickybar");null!=a&&(a.style.zIndex=1E3);a=document.getElementById("commandToolsWrapper");null!=a&&(a.style.pointerEvents=
"visible");a=document.getElementById("about-modal");null!=a&&virtualclass.popup.close(a);document.getElementById("sessionEndMsgCont").dataset.displaying="false";document.getElementById("uploadvideourl").dataset.displaying="false";document.getElementById("uploadppturl").dataset.displaying="false";a=document.getElementById("chatrm");null!=a&&(console.log("zIndex performing"),a.style.zIndex=1);document.querySelector("#networkStatusContainer").classList.remove("connecting-room");document.querySelector("#virtualclassApp").classList.remove("try-to-connect")}};
a.prototype.waitBlock=function(){const a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();document.getElementById("recordPlay").style.display="block";virtualclass.popup.replayWindowAction("none")};a.prototype.waitBlockAction=function(a){document.getElementById("recordPlay").style.display=a};a.prototype.sendBackOtherElems=function(a){a=document.getElementById("virtualclassOptionsCont");null!=a&&(a.style.zIndex=0);a=document.getElementById("commandToolsWrapper");
null!=a&&(a.style.pointerEvents="none");a=document.getElementById("stickybar");null!=a&&(a.style.zIndex=0);a=document.getElementById("chatrm");null==a||virtualclass.isPlayMode||(a.style.zIndex=0);a=document.getElementById("audioWidget");null!=a&&(a.style.zIndex=0);a=document.getElementById("audioWidget");null!=a&&(a.style.zIndex=0);a=document.getElementById("memlist");null!=a&&(a.style.zIndex=0)};a.prototype.openProgressBar=function(a){a=document.getElementById("about-modal");virtualclass.popup.open(a);
this.hideAllPopups();document.getElementById("recordingContainer").style.display="block"};a.prototype.replayWindow=function(){const a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();virtualclass.popup.replayWindowAction("block")};a.prototype.sesseionEndWindow=function(){var a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();a=document.getElementById("sessionEndMsgCont");a.style.display="block";a.dataset.displaying=!0;document.getElementById("sessionEndClose").addEventListener("click",
()=>{virtualclass.popup.closeElem();d.close()})};a.prototype.validateurlPopup=function(a){const b=document.getElementById("about-modal");virtualclass.popup.open(b);this.hideAllPopups();let c,f;"video"==a?(c=document.querySelector("#virtualclassCont.congrea #popupContainer #uploadvideourl"),f=document.querySelector("#virtualclassCont.congrea #popupContainer #vidPopupClose")):"presentation"==a?(c=document.querySelector("#virtualclassCont.congrea #popupContainer #uploadppturl"),f=document.querySelector("#virtualclassCont.congrea #popupContainer #pptPopupClose")):
console.log("popup works for video and presentation");c.style.display="block";c.dataset.displaying=!0;f.addEventListener("click",()=>{virtualclass.popup.closeElem()})};a.prototype.replayWindowAction=function(a){document.getElementById("replayContainer").style.display=a};a.prototype.progressBarAction=function(a){document.getElementById("recordingContainer").style.display=a};a.prototype.confirmInput=function(a,b,c,f,d,r){var g=document.getElementById("about-modal");virtualclass.popup.open(g);this.hideAllPopups();
g=document.getElementById("confirm");g.style.display="block";var k=g.getElementsByClassName("confirmChild");if(0<k.length)for(;1<=k.length;)k[0].parentNode.removeChild(k[0]);k=document.createElement("div");k.id="confirmMessage";k.className="confirmChild";k.innerHTML=a;g.appendChild(k);const m=this;a=function(){m.confirmInit(this.id,b,c,f,d,r)};k=document.createElement("div");k.id="confirmOk";k.className="confirmButton confirmChild";k.addEventListener("click",a);const n=document.createElement("button");
n.id="confirmOkButton";n.className="icon-check";n.innerHTML=virtualclass.lang.getString("confirmOk");k.appendChild(n);g.appendChild(k);k=document.createElement("div");k.id="confirmCancel";k.className="confirmButton confirmChild";k.addEventListener("click",a);a=document.createElement("button");a.id="confirmCancelButton";a.className="icon-close";a.innerHTML=virtualclass.lang.getString("confirmCancel");k.appendChild(a);g.appendChild(k)};a.prototype.pollPopUp=function(a,b){var c=document.getElementById("about-modal");
virtualclass.popup.open(c);this.hideAllPopups();c=document.getElementById("editPollCont");c.style.display="block";const f=this,d=function(){console.log(this.id);f.action(this.id,a,b)};if(null==document.getElementById("pollCancel")){const a=document.createElement("div");a.id="pollCancel";a.className="cancelBtn";a.addEventListener("click",d);const b=document.createElement("button");b.id="confirmCancelButton";b.className="icon-close";b.innerHTML=virtualclass.lang.getString("pollCancel");a.appendChild(b);
c.appendChild(a)}document.getElementById("resetPoll").addEventListener("click",d);document.getElementById("addMoreOption").addEventListener("click",d);document.getElementById("etSave").addEventListener("click",d);document.getElementById("saveNpublish").addEventListener("click",d)};a.prototype.action=function(a,b,c,f,d,r){b(a)};a.prototype.confirmInit=function(a,b,c,f,d,r){virtualclass.popup.closeElem();a="confirmOk"==a?virtualclass.popup.confirmOk():virtualclass.popup.confirmCancel();b(a,c,f,d,r)};
a.prototype.confirmCancel=function(){return!1};a.prototype.confirmOk=function(){return!0};a.prototype.waitMsg=function(a){let b=0;"undefined"!==typeof a&&(b=1300);setTimeout(()=>{virtualclass.network.netWorkElementIsReady()},b);"undefined"!==typeof virtualclass.vutil&&virtualclass.vutil.sesionEndMsgBoxIsExisting()||this.hideAllPopups()};a.prototype.chromeExtMissing=function(){const a=document.getElementById("about-modal");a.dataset.currPopup="chromeExt";virtualclass.popup.open(a);this.hideAllPopups();
document.getElementById("chromeExtMiss").style.display="block";document.getElementById("chromeExtClose").addEventListener("click",()=>{virtualclass.popup.closeElem();a.dataset.currPopup=""})};a.prototype.generalMsg=function(a){const b=document.getElementById("about-modal");virtualclass.popup.open(b);this.hideAllPopups();document.getElementById("generalMessage").style.display="block";document.querySelector("#generalMessageMsg").innerHTML=a;document.getElementById("generalMessageClose").addEventListener("click",
()=>{virtualclass.popup.closeElem()})};a.prototype.generalMsgButton=function(a){a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();a=document.querySelector("#generalMessageButton");null!=a&&(a.style.display="block;",document.querySelector("#generalMessageButton .button").addEventListener("click",()=>{virtualclass.popup.closeElem()}))};a.prototype.hideAllPopups=function(){const a=document.getElementsByClassName("popupWindow");for(let b=0;b<a.length;b++)a[b].style.display=
"none"};a.prototype.closePopup=function(){virtualclass.popup.closeElem();"true"==document.getElementById("sessionEndMsgCont").dataset.displaying&&this.sesseionEndWindow()};a.prototype.loadingWindow=function(){const a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();const b=document.querySelector("#loadingWindowCont");null!=b&&(b.style.display="block",a.parentNode.classList.add("loading"))};return a}(window);(function(d){d.converter=function(){function c(a){return 26>a?a+65:52>a?a+71:62>a?a-4:62===a?43:63===a?47:65}return{base64EncArrInt(a){const b=new Uint8Array(a.length);for(let c=0;c<a.length;c++)b[c]=0>a[c]?-1*a[c]+127:a[c];return this.base64EncArr(b)},base64EncArr(a){let b=2,f="";for(let d=a.length,k=0,m=0;m<d;m++)if(b=m%3,0<m&&0===4*m/3%76&&(f+="\r\n"),k|=a[m]<<(16>>>b&24),2===b||1===a.length-m)f+=String.fromCharCode(c(k>>>18&63),c(k>>>12&63),c(k>>>6&63),c(k&63)),k=0;return f.substr(0,f.length-
2+b)+(2===b?"":1===b?"=":"==")},base64DecToArrInt(a){a=base64DecToArr(a);const b=new Int8Array(a.length);for(let c=0;c<a.length;c++)b[c]=128<=a[c]?-1*(a[c]-127):a[c];return b},base64DecToArr(a,b){a=a.replace(/[^A-Za-z0-9\+\/]/g,"");const c=a.length;b=b?Math.ceil((3*c+1>>2)/b)*b:3*c+1>>2;const d=new Uint8Array(b);for(var k,m=0,n=0,q=0;q<c;q++){k=q&3;var r=a.charCodeAt(q);m|=(64<r&&91>r?r-65:96<r&&123>r?r-71:47<r&&58>r?r+4:43===r?62:47===r?63:0)<<6*(3-k);if(3===k||1===c-q){for(k=0;3>k&&n<b;k++,n++)d[n]=
m>>>(16>>>k&24)&255;m=0}}return d},base64DecToArrclm(a){a=base64DecToArr(a);return new Uint8ClampedArray(a.buffer)}}}})(window);let prvTimeout;
const progressBar={prvVal:"",currVal:"",progressInit(){const d=this;"undefined"!==typeof prvTimeout&&clearTimeout(prvTimeout);prvTimeout=setTimeout(()=>{d.prvVal==d.currVal&&virtualclass.gObj.hasOwnProperty("downloadProgress")?virtualclass.recorder.initMakeAvailDownloadFile():(d.prvVal=d.currVal,d.progressInit())},5E4)},renderProgressBar(d,c,a,b){c>d&&(c=d,document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("playsessionmsg"));d=0==d&&0==c?0:Math.round(100*c/d);a=document.getElementById(a);
null!=a&&(a.style.width=`${d}%`);100<=b&&(b=document.getElementById("recordingClose"),recordingClose.style.display="block",b.addEventListener("click",()=>{virtualclass.popup.closeElem()}))}};const Server=function(d){function c(a,b){this.document=a;this.operations=b||[]}c.prototype.receiveOperation=function(a,b){console.log(`Operations ${this.operations.length} Revision ${a}`);if(0>a||this.operations.length<a)return console.log(`operation revision ${a} not in history`),!1;a=this.operations.slice(a);const {transform:c}=b.constructor;for(let f=0;f<a.length;f++)b=c(b,a[f])[0];this.document=b.apply(this.document);this.operations.push(b);return b};return c}(this);
"object"===typeof module&&(module.exports=ot.Server);(function(d){const c={makeEventEmitter:function(a,b){a.prototype.allowedEvents_=b;a.prototype.on=function(a,b,c){this.validateEventType_(a);this.eventListeners_=this.eventListeners_||{};this.eventListeners_[a]=this.eventListeners_[a]||[];this.eventListeners_[a].push({callback:b,context:c})};a.prototype.off=function(a,b){this.validateEventType_(a);this.eventListeners_=this.eventListeners_||{};a=this.eventListeners_[a]||[];for(let c=0;c<a.length;c++)if(a[c].callback===b){a.splice(c,1);break}};a.prototype.trigger=
function(a){this.eventListeners_=this.eventListeners_||{};const b=this.eventListeners_[a]||[];for(let a=0;a<b.length;a++)b[a].callback.apply(b[a].context,Array.prototype.slice.call(arguments,1))};a.prototype.validateEventType_=function(a){if(this.allowedEvents_){let b=!1;for(let c=0;c<this.allowedEvents_.length;c++)if(this.allowedEvents_[c]===a){b=!0;break}if(!b)throw Error(`Unknown event "${a}"`);}}},elt:function(a,b,f){a=document.createElement(a);if("string"===typeof b)c.setTextContent(a,b);else if(b)for(let c=
0;c<b.length;++c)a.appendChild(b[c]);for(const b in f||{})a.setAttribute(b,f[b]);return a},setTextContent:function(a,b){a.innerHTML="";a.appendChild(document.createTextNode(b))},on:function(a,b,c,d){a.addEventListener?a.addEventListener(b,c,d||!1):a.attachEvent&&a.attachEvent(`on${b}`,c)},off:function(a,b,c,d){a.removeEventListener?a.removeEventListener(b,c,d||!1):a.detachEvent&&a.detachEvent(`on${b}`,c)},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(a){a.stopPropagation?
a.stopPropagation():a.cancelBubble=!0},stopEvent:function(a){c.preventDefault(a);c.stopPropagation(a)},stopEventAnd:function(a){return function(b){a(b);c.stopEvent(b);return!1}},trim:function(a){return a.replace(/^\s+/g,"").replace(/\s+$/g,"")},stringEndsWith:function(a,b){const c="string"===typeof b?[b]:b;for(let f=0;f<c.length;f++)if(b=c[f],-1!==a.indexOf(b,a.length-b.length))return!0;return!1},assert:function(a,b){if(!a)throw Error(b||"assertion error");},log:function(){if("undefined"!==typeof console&&
"undefined"!==typeof console.log){const a=["Vceditor:"];for(let b=0;b<arguments.length;b++)a.push(arguments[b]);console.log.apply(console,a)}}};d.utils=c})(window);(function(d){const c=function(a){function b(a){this.imageInsertionUI=a;this.element_=this.makeElement_()}const {utils:c}=d;c.makeEventEmitter(b,"bold italic underline strike font font-size color left center right unordered-list ordered-list todo-list indent-increase indent-decrease undo redo insert-image".split(" "));b.prototype.element=function(){return this.element_};b.prototype.makeButton_=function(a,b){const f=this;b=c.elt("a",[c.elt("span","",{class:`vceditor-tb-${b||a}`})],{class:"vceditor-btn"});
c.on(b,"click",c.stopEventAnd(()=>{f.trigger(a)}));return b};b.prototype.makeElement_=function(){var a=this.makeFontDropdown_(),b=this.makeFontSizeDropdown_();const f=this.makeColorDropdown_();a=[c.elt("div",[a],{class:"vceditor-btn-group"}),c.elt("div",[b],{class:"vceditor-btn-group"}),c.elt("div",[f],{class:"vceditor-btn-group"}),c.elt("div",[this.makeButton_("bold"),this.makeButton_("italic"),this.makeButton_("underline"),this.makeButton_("strike","strikethrough")],{class:"vceditor-btn-group"}),
c.elt("div",[this.makeButton_("unordered-list","list-2"),this.makeButton_("ordered-list","numbered-list"),this.makeButton_("todo-list","list")],{class:"vceditor-btn-group"}),c.elt("div",[this.makeButton_("indent-decrease"),this.makeButton_("indent-increase")],{class:"vceditor-btn-group"}),c.elt("div",[this.makeButton_("left","paragraph-left"),this.makeButton_("center","paragraph-center"),this.makeButton_("right","paragraph-right")],{class:"vceditor-btn-group"}),c.elt("div",[this.makeButton_("undo"),
this.makeButton_("redo")],{class:"vceditor-btn-group"})];this.imageInsertionUI&&a.push(c.elt("div",[this.makeButton_("insert-image")],{class:"vceditor-btn-group"}));a=c.elt("div",a,{class:"vceditor-toolbar-wrapper"});b=c.elt("div",null,{class:"vceditor-toolbar"});b.appendChild(a);return b};b.prototype.makeFontDropdown_=function(){const a="Arial;Comic Sans MS;Courier New;Impact;Times New Roman;Verdana".split(";"),b=[];for(let f=0;f<a.length;f++){const d=c.elt("span",a[f]);d.setAttribute("style",`font-family:${a[f]}`);
b.push({content:d,value:a[f]})}return this.makeDropdown_("Font","font",b)};b.prototype.makeFontSizeDropdown_=function(){const a=[9,10,12,14,18,24,32,42],b=[];for(let f=0;f<a.length;f++){const d=c.elt("span",a[f].toString());d.setAttribute("style",`font-size:${a[f]}px; line-height:${a[f]-6}px;`);b.push({content:d,value:a[f]})}return this.makeDropdown_("Size","font-size",b,"px")};b.prototype.makeColorDropdown_=function(){const a="black red green blue yellow cyan magenta grey".split(" "),b=[];for(let f=
0;f<a.length;f++){const d=c.elt("div");d.className="vceditor-color-dropdown-item";d.setAttribute("style",`background-color:${a[f]}`);b.push({content:d,value:a[f]})}return this.makeDropdown_("Color","color",b)};b.prototype.makeDropdown_=function(a,b,f,d){function g(){u&&(n.style.display="",c.off(document,"click",g,!0),u=!1);p=!0;setTimeout(()=>{p=!1},0)}function k(a,f){"object"!==typeof a&&(a=document.createTextNode(String(a)));a=c.elt("a",[a]);c.on(a,"click",c.stopEventAnd(()=>{g();m.trigger(b,f+
d)}));n.appendChild(a)}d=d||"";const m=this;a=c.elt("a",`${a} \u25be`,{class:"vceditor-btn vceditor-dropdown"});const n=c.elt("ul",[],{class:"vceditor-dropdown-menu"});a.appendChild(n);let u=!1,p=!1;for(let a=0;a<f.length;a++){const {content:b}=f[a],{value:c}=f[a];k(b,c)}c.on(a,"click",c.stopEventAnd(()=>{p||u||(n.style.display="block",c.on(document,"click",g,!0),u=!0)}));return a};return b}();d.RichTextToolbar=c})(window);(function(d){const c=function(){function a(a,c,d){this.type=a;this.attributes=this.text=this.chars=null;"insert"===a?(this.text=c,b.assert("string"===typeof this.text),this.attributes=d||{},b.assert("object"===typeof this.attributes)):"delete"===a?(this.chars=c,b.assert("number"===typeof this.chars)):"retain"===a&&(this.chars=c,b.assert("number"===typeof this.chars),this.attributes=d||{},b.assert("object"===typeof this.attributes))}const {utils:b}=d;a.prototype.isInsert=function(){return"insert"===
this.type};a.prototype.isDelete=function(){return"delete"===this.type};a.prototype.isRetain=function(){return"retain"===this.type};a.prototype.equals=function(a){return this.type===a.type&&this.text===a.text&&this.chars===a.chars&&this.attributesEqual(a.attributes)};a.prototype.attributesEqual=function(a){for(var b in this.attributes)if(this.attributes[b]!==a[b])return!1;for(b in a)if(this.attributes[b]!==a[b])return!1;return!0};a.prototype.hasEmptyAttributes=function(){let a=!0;for(const b in this.attributes){a=
!1;break}return a};return a}();d.TextOp=c})(window);(function(d){const c=function(){function a(){if(!this||this.constructor!==a)return new a;this.ops=[];this.targetLength=this.baseLength=0}function b(a){({ops:a}=a);switch(a.length){case 1:return a[0];case 2:return a[0].isRetain()?a[1]:a[1].isRetain()?a[0]:null;case 3:if(a[0].isRetain()&&a[2].isRetain())return a[1]}return null}function c(a){return a.ops[0].isRetain()?a.ops[0].chars:0}const {TextOp:g}=d,{utils:k}=d;a.prototype.equals=function(a){if(this.baseLength!==a.baseLength||this.targetLength!==
a.targetLength||this.ops.length!==a.ops.length)return!1;for(let b=0;b<this.ops.length;b++)if(!this.ops[b].equals(a.ops[b]))return!1;return!0};a.prototype.retain=function(a,b){if("number"!==typeof a||0>a)throw Error("retain expects a positive integer.");if(0===a)return this;this.baseLength+=a;this.targetLength+=a;b=b||{};const c=0<this.ops.length?this.ops[this.ops.length-1]:null;c&&c.isRetain()&&c.attributesEqual(b)?c.chars+=a:this.ops.push(new g("retain",a,b));return this};a.prototype.insert=function(a,
b){if("string"!==typeof a)throw Error("insert expects a string");if(""===a)return this;b=b||{};this.targetLength+=a.length;const c=0<this.ops.length?this.ops[this.ops.length-1]:null,f=1<this.ops.length?this.ops[this.ops.length-2]:null;c&&c.isInsert()&&c.attributesEqual(b)?c.text+=a:c&&c.isDelete()?f&&f.isInsert()&&f.attributesEqual(b)?f.text+=a:(this.ops[this.ops.length-1]=new g("insert",a,b),this.ops.push(c)):this.ops.push(new g("insert",a,b));return this};a.prototype.delete=function(a){"string"===
typeof a&&(a=a.length);if("number"!==typeof a||0>a)throw Error("delete expects a positive integer or a string");if(0===a)return this;this.baseLength+=a;const b=0<this.ops.length?this.ops[this.ops.length-1]:null;b&&b.isDelete()?b.chars+=a:this.ops.push(new g("delete",a));return this};a.prototype.isNoop=function(){return 0===this.ops.length||1===this.ops.length&&this.ops[0].isRetain()&&this.ops[0].hasEmptyAttributes()};a.prototype.clone=function(){const b=new a;for(let a=0;a<this.ops.length;a++)this.ops[a].isRetain()?
b.retain(this.ops[a].chars,this.ops[a].attributes):this.ops[a].isInsert()?b.insert(this.ops[a].text,this.ops[a].attributes):b.delete(this.ops[a].chars);return b};a.prototype.toString=function(){return(Array.prototype.map||function(a){const b=[];for(let c=0,f=this.length;c<f;c++)b[c]=a(this[c]);return b}).call(this.ops,a=>a.isRetain()?`retain ${a.chars}`:a.isInsert()?`insert '${a.text}'`:`delete ${a.chars}`).join(", ")};a.prototype.toJSON=function(){const a=[];for(let b=0;b<this.ops.length;b++)this.ops[b].hasEmptyAttributes()||
a.push(this.ops[b].attributes),"retain"===this.ops[b].type?a.push(this.ops[b].chars):"insert"===this.ops[b].type?a.push(this.ops[b].text):"delete"===this.ops[b].type&&a.push(-this.ops[b].chars);0===a.length&&a.push(0);return a};a.fromJSON=function(b){const c=new a;for(let a=0,f=b.length;a<f;a++){let f=b[a],d={};"object"===typeof f&&(d=f,a++,f=b[a]);"number"===typeof f?0<f?c.retain(f,d):c.delete(-f):(k.assert("string"===typeof f),c.insert(f,d))}return c};a.prototype.apply=function(a,b,c){b=b||[];c=
c||[];if(a.length!==this.baseLength)throw Error("The operation's base length must be equal to the string's length.");const f=[];let d=0,g,m,n=0;const {ops:q}=this;for(let r=0,p=q.length;r<p;r++){const p=q[r];if(p.isRetain()){if(n+p.chars>a.length)throw Error("Operation can't retain more characters than are left in the string.");f[d++]=a.slice(n,n+p.chars);for(g=0;g<p.chars;g++){var B=b[n+g]||{};const a={};for(m in B)a[m]=B[m],k.assert(!1!==a[m]);for(m in p.attributes)!1===p.attributes[m]?delete a[m]:
a[m]=p.attributes[m],k.assert(!1!==a[m]);c.push(a)}n+=p.chars}else if(p.isInsert())for(f[d++]=p.text,g=0;g<p.text.length;g++){B={};for(m in p.attributes)B[m]=p.attributes[m],k.assert(!1!==B[m]);c.push(B)}else n+=p.chars}if(n!==a.length)throw Error("The operation didn't operate on the whole string.");a=f.join("");k.assert(a.length===c.length);return a};a.prototype.invert=function(b){let c=0;const f=new a,{ops:d}=this;for(let a=0,g=d.length;a<g;a++){const g=d[a];g.isRetain()?(f.retain(g.chars),c+=g.chars):
g.isInsert()?f.delete(g.text.length):(f.insert(b.slice(c,c+g.chars)),c+=g.chars)}return f};a.prototype.compose=function(b){function c(a,b,c){const f={};let d;for(d in a)f[d]=a[d];for(d in b)c&&!1===b[d]?delete f[d]:f[d]=b[d];return f}if(this.targetLength!==b.baseLength)throw Error("The base length of the second operation has to be the target length of the first operation");const f=new a,d=this.clone().ops;b=b.clone().ops;let g=0,k=0,m=d[g++],p=b[k++],v;for(;"undefined"!==typeof m||"undefined"!==typeof p;)if(m&&
m.isDelete())f.delete(m.chars),m=d[g++];else if(p&&p.isInsert())f.insert(p.text,p.attributes),p=b[k++];else{if("undefined"===typeof m)throw Error("Cannot compose operations: first operation is too short.");if("undefined"===typeof p)throw Error("Cannot compose operations: first operation is too long.");if(m.isRetain()&&p.isRetain())v=c(m.attributes,p.attributes),m.chars>p.chars?(f.retain(p.chars,v),m.chars-=p.chars,p=b[k++]):m.chars===p.chars?(f.retain(m.chars,v),m=d[g++],p=b[k++]):(f.retain(m.chars,
v),p.chars-=m.chars,m=d[g++]);else if(m.isInsert()&&p.isDelete())m.text.length>p.chars?(m.text=m.text.slice(p.chars),p=b[k++]):m.text.length===p.chars?(m=d[g++],p=b[k++]):(p.chars-=m.text.length,m=d[g++]);else if(m.isInsert()&&p.isRetain())v=c(m.attributes,p.attributes,!0),m.text.length>p.chars?(f.insert(m.text.slice(0,p.chars),v),m.text=m.text.slice(p.chars),p=b[k++]):m.text.length===p.chars?(f.insert(m.text,v),m=d[g++],p=b[k++]):(f.insert(m.text,v),p.chars-=m.text.length,m=d[g++]);else if(m.isRetain()&&
p.isDelete())m.chars>p.chars?(f.delete(p.chars),m.chars-=p.chars,p=b[k++]):m.chars===p.chars?(f.delete(p.chars),m=d[g++],p=b[k++]):(f.delete(m.chars),p.chars-=m.chars,m=d[g++]);else throw Error(`This shouldn't happen: op1: ${JSON.stringify(m)}, op2: ${JSON.stringify(p)}`);}return f};a.prototype.shouldBeComposedWith=function(a){if(this.isNoop()||a.isNoop())return!0;const f=c(this),d=c(a),g=b(this);a=b(a);return g&&a?g.isInsert()&&a.isInsert()?f+g.text.length===d:g.isDelete()&&a.isDelete()?d+a.chars===
f||f===d:!1:!1};a.prototype.shouldBeComposedWithInverted=function(a){if(this.isNoop()||a.isNoop())return!0;const f=c(this),d=c(a),g=b(this);a=b(a);return g&&a?g.isInsert()&&a.isInsert()?f+g.text.length===d||f===d:g.isDelete()&&a.isDelete()?d+a.chars===f:!1:!1};a.transformAttributes=function(a,b){const c={},f={};let d;var g={};for(d in a)g[d]=!0;for(d in b)g[d]=!0;for(d in g){g=a[d];const m=b[d];k.assert(null!=g||null!=m);null==g?f[d]=m:null==m?c[d]=g:g!==m&&(c[d]=g)}return[c,f]};a.transform=function(b,
c){if(b.baseLength!==c.baseLength)throw Error("Both operations have to have the same base length");const f=new a,d=new a;b=b.clone().ops;c=c.clone().ops;let g=0,k=0,m=b[g++],n=c[k++];for(;"undefined"!==typeof m||"undefined"!==typeof n;)if(m&&m.isInsert())f.insert(m.text,m.attributes),d.retain(m.text.length),m=b[g++];else if(n&&n.isInsert())f.retain(n.text.length),d.insert(n.text,n.attributes),n=c[k++];else{if("undefined"===typeof m)throw Error("Cannot transform operations: first operation is too short.");
if("undefined"===typeof n)throw Error("Cannot transform operations: first operation is too long.");if(m.isRetain()&&n.isRetain()){const q=a.transformAttributes(m.attributes,n.attributes);if(m.chars>n.chars){var v=n.chars;m.chars-=n.chars;n=c[k++]}else m.chars===n.chars?(v=n.chars,m=b[g++],n=c[k++]):(v=m.chars,n.chars-=m.chars,m=b[g++]);f.retain(v,q[0]);d.retain(v,q[1])}else if(m.isDelete()&&n.isDelete())m.chars>n.chars?(m.chars-=n.chars,n=c[k++]):m.chars===n.chars?(m=b[g++],n=c[k++]):(n.chars-=m.chars,
m=b[g++]);else if(m.isDelete()&&n.isRetain())m.chars>n.chars?(v=n.chars,m.chars-=n.chars,n=c[k++]):m.chars===n.chars?(v=n.chars,m=b[g++],n=c[k++]):(v=m.chars,n.chars-=m.chars,m=b[g++]),f.delete(v);else if(m.isRetain()&&n.isDelete())m.chars>n.chars?(v=n.chars,m.chars-=n.chars,n=c[k++]):m.chars===n.chars?(v=m.chars,m=b[g++],n=c[k++]):(v=m.chars,n.chars-=m.chars,m=b[g++]),d.delete(v);else throw Error("The two operations aren't compatible");}return[f,d]};return a}();d.TextOperation=c})(window);(function(d){const c=function(a){function b(a,b){this.wrapped=a;this.meta=b}function c(a,b){for(const c in a)a.hasOwnProperty(c)&&(b[c]=a[c])}function d(a,b){return a&&"object"===typeof a&&"function"===typeof a.transform?a.transform(b):a}b.prototype.apply=function(){return this.wrapped.apply.apply(this.wrapped,arguments)};b.prototype.invert=function(){const {meta:a}=this;return new b(this.wrapped.invert.apply(this.wrapped,arguments),a&&"object"===typeof a&&"function"===typeof a.invert?a.invert.apply(a,
arguments):a)};b.prototype.compose=function(a){var f=this.wrapped.compose(a.wrapped);var d=this.meta;a=a.meta;if(d&&"object"===typeof d)if("function"===typeof d.compose)d=d.compose(a);else{var g={};c(d,g);c(a,g);d=g}else d=a;return new b(f,d)};b.transform=function(a,c){var {transform:f}=a.wrapped.constructor;f=f(a.wrapped,c.wrapped);return[new b(f[0],d(a.meta,c.wrapped)),new b(f[1],d(c.meta,a.wrapped))]};return b}();d.WrappedOperation=c})(window);(function(d){const c=function(){function a(a,c){this.position=a;this.selectionEnd=c}a.fromJSON=function(b){return new a(b.position,b.selectionEnd)};a.prototype.equals=function(a){return this.position===a.position&&this.selectionEnd===a.selectionEnd};a.prototype.compose=function(a){return a};a.prototype.transform=function(b){function c(a){let c=a;const {ops:f}=b;for(let d=0,g=b.ops.length;d<g&&!(f[d].isRetain()?a-=f[d].chars:f[d].isInsert()?c+=f[d].text.length:(c-=Math.min(a,f[d].chars),a-=f[d].chars),
0>a);d++);return c}const d=c(this.position);return this.position===this.selectionEnd?new a(d,d):new a(d,c(this.selectionEnd))};return a}();d.Cursor=c})(window);(function(d){const c=function(){function a(a){this.maxItems=a||50;this.state="normal";this.dontCompose=!1;this.undoStack=[];this.redoStack=[]}function b(a,b){const c=[],f=b.constructor;for(let d=a.length-1;0<=d;d--)b=f.transform(a[d],b),"function"===typeof b[0].isNoop&&b[0].isNoop()||c.push(b[0]),b=b[1];return c.reverse()}a.prototype.add=function(a,b){if("undoing"===this.state)this.redoStack.push(a),this.dontCompose=!0;else if("redoing"===this.state)this.undoStack.push(a),this.dontCompose=!0;else{const {undoStack:c}=
this;!this.dontCompose&&b&&0<c.length?c.push(a.compose(c.pop())):(c.push(a),c.length>this.maxItems&&c.shift());this.dontCompose=!1;this.redoStack=[]}};a.prototype.transform=function(a){this.undoStack=b(this.undoStack,a);this.redoStack=b(this.redoStack,a)};a.prototype.performUndo=function(a){this.state="undoing";if(0===this.undoStack.length)throw Error("undo not possible");a(this.undoStack.pop());this.state="normal"};a.prototype.performRedo=function(a){this.state="redoing";if(0===this.redoStack.length)throw Error("redo not possible");
a(this.redoStack.pop());this.state="normal"};a.prototype.canUndo=function(){return 0!==this.undoStack.length};a.prototype.canRedo=function(){return 0!==this.redoStack.length};a.prototype.isUndoing=function(){return"undoing"===this.state};a.prototype.isRedoing=function(){return"redoing"===this.state};return a}();d.UndoManager=c})(window);(function(d){const c=function(){function a(a){this.revision=a;this.state=k}function b(){}function c(a){this.outstanding=a}function d(a,b){this.outstanding=a;this.buffer=b}a.prototype.setState=function(a){this.state=a};a.prototype.applyClient=function(a){this.setState(this.state.applyClient(this,a))};a.prototype.applyServer=function(a){this.revision++;this.setState(this.state.applyServer(this,a))};a.prototype.serverAck=function(){this.revision++;this.setState(this.state.serverAck(this))};a.prototype.serverRetry=
function(){this.setState(this.state.serverRetry(this))};a.prototype.transformCursor=function(a){return this.state.transformCursor(a)};a.prototype.sendOperation=function(a){throw Error("sendOperation must be defined in child class");};a.prototype.applyOperation=function(a){throw Error("applyOperation must be defined in child class");};a.Synchronized=b;b.prototype.applyClient=function(a,b){a.sendOperation(a.revision,b);return new c(b)};b.prototype.applyServer=function(a,b){a.applyOperation(b);return this};
b.prototype.transformCursor=function(a){return a};b.prototype.serverAck=function(a){throw Error("There is no pending operation.");};b.prototype.serverRetry=function(a){throw Error("There is no pending operation.");};var k=new b;a.AwaitingConfirm=c;c.prototype.applyClient=function(a,b){return new d(this.outstanding,b)};c.prototype.applyServer=function(a,b){b=b.constructor.transform(this.outstanding,b);a.applyOperation(b[1]);return new c(b[0])};c.prototype.serverAck=function(a){return k};c.prototype.serverRetry=
function(a){a.sendOperation(this.outstanding);return this};c.prototype.transformCursor=function(a){return a.transform(this.outstanding)};a.AwaitingWithBuffer=d;d.prototype.applyClient=function(a,b){a=this.buffer.compose(b);return new d(this.outstanding,a)};d.prototype.applyServer=function(a,b){var {transform:c}=b.constructor;b=c(this.outstanding,b);c=c(this.buffer,b[1]);a.applyOperation(c[1]);return new d(b[0],c[0])};d.prototype.serverRetry=function(a){const b=this.outstanding.compose(this.buffer);
a.sendOperation(b);return new c(b)};d.prototype.serverAck=function(a){a.sendOperation(a.revision,this.buffer);return new c(this.buffer)};d.prototype.transformCursor=function(a){return a.transform(this.outstanding).transform(this.buffer)};return a}();d.Client=c})(window);(function(d){let c=0,a=0,b=null;"use strict";const f=function(){function f(a,b){this.cursorBefore=a;this.cursorAfter=b}function k(a,b){this.id=a;this.editorAdapter=b;this.li=document.createElement("li")}function m(a,b,c,f){q.call(this,a);this.serverAdapter=c;this.editorAdapter=f;this.undoManager=new z;this.clients={};const d=this;this.editorAdapter.registerCallbacks({change(a,b){d.onChange(a,b)},cursorActivity(){d.onCursorActivity()},blur(){d.onBlur()},focus(){d.onFocus()}});this.editorAdapter.registerUndo(()=>
{d.undo()});this.editorAdapter.registerRedo(()=>{d.redo()});this.serverAdapter.registerCallbacks({client_left(a){d.onClientLeft(a)},set_name(a,b){d.getClientObject(a).setName(b)},ack(){d.serverAck()},operation(a){d.applyServer(t.fromJSON(a))},cursor(a,b){b?d.getClientObject(a).updateCursor(d.transformCursor(r.fromJSON(b))):d.getClientObject(a).removeCursor()},clients(a){let b;for(b in d.clients)if(d.clients.hasOwnProperty(b)&&!a.hasOwnProperty(b))d.onClientLeft(b);for(b in a)if(a.hasOwnProperty(b)){var c=
d.getClientObject(b);a[b].name&&c.setName(a[b].name);({selection:c}=a[b]);c?d.clients[b].updateSelection(d.transformSelection(Selection.fromJSON(c))):d.clients[b].removeSelection()}},reconnect(){d.serverReconnect()}})}function n(a){return a[a.length-1]}const {Client:q}=d,{Cursor:r}=d,{UndoManager:z}=d,{TextOperation:t}=d,{WrappedOperation:u}=d;f.prototype.invert=function(){return new f(this.cursorAfter,this.cursorBefore)};f.prototype.compose=function(a){return new f(this.cursorBefore,a.cursorAfter)};
f.prototype.transform=function(a){return new f(this.cursorBefore?this.cursorBefore.transform(a):null,this.cursorAfter?this.cursorAfter.transform(a):null)};k.prototype.setColor=function(a){this.color=a};k.prototype.updateCursor=function(a){this.color="#86BA7D";this.removeCursor();this.cursor=a;this.mark=this.editorAdapter.setOtherCursor(a,this.color,this.id)};k.prototype.removeCursor=function(){this.mark&&this.mark.clear()};(function(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=
a})(m,q);m.prototype.getClientObject=function(a){const b=this.clients[a];return b?b:this.clients[a]=new k(a,this.editorAdapter)};m.prototype.applyUnredo=function(a){this.undoManager.add(this.editorAdapter.invertOperation(a));this.editorAdapter.applyOperation(a.wrapped);(this.cursor=a.meta.cursorAfter)&&this.editorAdapter.setCursor(this.cursor);this.applyClient(a.wrapped)};m.prototype.undo=function(){const a=this;this.undoManager.canUndo()&&this.undoManager.performUndo(b=>{a.applyUnredo(b)})};m.prototype.redo=
function(){const a=this;this.undoManager.canRedo()&&this.undoManager.performRedo(b=>{a.applyUnredo(b)})};m.prototype.onChange=function(a,b){var c=this.cursor;this.updateCursor();const d=0<this.undoManager.undoStack.length&&b.shouldBeComposedWithInverted(n(this.undoManager.undoStack).wrapped);c=new f(this.cursor,c);this.undoManager.add(new u(b,c),d);this.applyClient(a)};m.prototype.updateCursor=function(){this.cursor=this.editorAdapter.getCursor()};m.prototype.onCursorActivity=function(){const a=this.cursor;
this.updateCursor();!this.focused||a&&this.cursor.equals(a)||this.sendCursor(this.cursor)};m.prototype.onBlur=function(){this.cursor=null;this.sendCursor(null);this.focused=!1};m.prototype.onFocus=function(){this.focused=!0;this.onCursorActivity()};m.prototype.sendCursor=function(f){if(!(this.state instanceof q.AwaitingWithBuffer)){if(null!=f&&f.hasOwnProperty("position"))var d=f.position;if(null!=f&&f.hasOwnProperty("selectionEnd"))var {selectionEnd:g}=f;if(0===c)null!=d&&null!=g?(this.serverAdapter.sendCursor(f),
c=1):this.serverAdapter.sendCursor(f);else if(null!=d&&null!=g){null!=b&&clearTimeout(b);a=f;const c=this;b=setTimeout(()=>{c.serverAdapter.sendCursor(f);a=null},300)}else null!=a&&(this.serverAdapter.sendCursor(a),a=null),this.serverAdapter.sendCursor(f),c=0;g=d=null}};m.prototype.sendOperation=function(a,b){this.serverAdapter.sendOperation(a,b.toJSON(),this.cursor,this.editorAdapter.cm.options.keyMap)};m.prototype.applyOperation=function(a){this.editorAdapter.applyOperation(a);this.updateCursor();
this.undoManager.transform(new u(a,null))};m.prototype.emitStatus=function(){const a=this;setTimeout(()=>{a.trigger("synced",a.state instanceof q.Synchronized)},0)};return m}();d.EditorClient=f})(window);(function(d){const c=function(){function a(a,c){this.pos=a;this.length=c}a.prototype.end=function(){return this.pos+this.length};return a}();d.Span=c})(window);(function(d){const c=function(){function a(a,b){if(!a)throw Error(`AnnotationList assertion failed${b?`: ${b}`:""}`);}function b(a,b){this.pos=a;this.length=b.length;this.annotation=b.annotation;this.attachedObject_=b.attachedObject}function c(a,b){this.pos=a;this.length=b.length;this.annotation=b.annotation;this.node_=b}function g(a){this.head_=new k(0,n);this.changeHandler_=a}function k(a,b){this.length=a;this.annotation=b;this.next=this.attachedObject=null}const {Span:m}=d;b.prototype.getAttachedObject=
function(){return this.attachedObject_};c.prototype.attachObject=function(a){this.node_.attachedObject=a};const n={equals(){return!1}};g.prototype.insertAnnotatedSpan=function(b,c){this.wrapOperation_(new m(b.pos,0),(f,d)=>{a(!d||null===d.next);const g=new k(b.length,c);if(!d)return g;a(b.pos>f&&b.pos<f+d.length);const m=new k(0,n);m.next=new k(b.pos-f,d.annotation);m.next.next=g;g.next=new k(f+d.length-b.pos,d.annotation);return m.next})};g.prototype.removeSpan=function(b){0!==b.length&&this.wrapOperation_(b,
(c,f)=>{a(null!==f);const d=new k(0,n);let g=d;b.pos>c&&(g.next=new k(b.pos-c,f.annotation),g=g.next);for(;b.end()>c+f.length;)c+=f.length,f=f.next;c=c+f.length-b.end();0<c&&(g.next=new k(c,f.annotation));return d.next})};g.prototype.updateSpan=function(b,c){0!==b.length&&this.wrapOperation_(b,(f,d)=>{a(null!==d);const g=new k(0,n);let m=g;var q=f,r=b.pos-q;a(r<d.length);0<r&&(m.next=new k(r,d.annotation),m=m.next,q+=m.length);for(;null!==d&&b.end()>=f+d.length;)q=f+d.length-q,m.next=new k(q,c(d.annotation,
q)),m=m.next,f+=d.length,d=d.next,q=f;r=b.end()-q;0<r&&(a(r<d.length),m.next=new k(r,c(d.annotation,r)),m=m.next,q+=m.length,m.next=new k(f+d.length-q,d.annotation));return g.next})};g.prototype.wrapOperation_=function(a,f){if(0>a.pos)throw Error("Span start cannot be negative.");const d=[],g=[];a=this.getAffectedNodes_(a);if(null!==a.start){var m=a.end.next;a.end.next=null}else m=a.succ;var n=f(a.startPos,a.start);let q=!1;f=!1;if(n){this.mergeNodesWithSameAnnotations_(n);let b;a.pred&&a.pred.annotation.equals(n.annotation)?
(q=!0,n.length+=a.pred.length,a.beforePred.next=n,b=a.predPos):(a.beforeStart.next=n,b=a.startPos);for(;n.next;)g.push(new c(b,n)),b+=n.length,n=n.next;a.succ&&a.succ.annotation.equals(n.annotation)?(n.length+=a.succ.length,f=!0,n.next=a.succ.next):n.next=m;g.push(new c(b,n))}else a.pred&&a.succ&&a.pred.annotation.equals(a.succ.annotation)?(f=q=!0,n=new k(a.pred.length+a.succ.length,a.pred.annotation),a.beforePred.next=n,n.next=a.succ.next,g.push(new c(a.startPos-a.pred.length,n))):a.beforeStart.next=
m;q&&d.push(new b(a.predPos,a.pred));m=a.startPos;for(n=a.start;null!==n;)d.push(new b(m,n)),m+=n.length,n=n.next;f&&d.push(new b(m,a.succ));this.changeHandler_(d,g)};g.prototype.getAffectedNodes_=function(a){const b={};let c=null,f=this.head_,d=f.next,g=0;for(;null!==d&&a.pos>=g+d.length;)g+=d.length,c=f,f=d,d=d.next;if(null===d&&(0!==a.length||a.pos!==g))throw Error("Span start exceeds the bounds of the AnnotationList.");b.startPos=g;b.start=0===a.length&&a.pos===g?null:d;b.beforeStart=f;g===a.pos&&
0<g?(b.pred=f,b.predPos=g-f.length,b.beforePred=c):b.pred=null;for(;null!==d&&a.end()>g;)g+=d.length,f=d,d=d.next;if(a.end()>g)throw Error("Span end exceeds the bounds of the AnnotationList.");0===a.length&&a.end()===g?b.end=null:b.end=f;b.succ=g===a.end()?d:null;return b};g.prototype.mergeNodesWithSameAnnotations_=function(a){if(a)for(var b=null;a;)b&&b.annotation.equals(a.annotation)?(b.length+=a.length,b.next=a.next):b=a,a=a.next};g.prototype.forEach=function(a){let b=this.head_.next;for(;null!==
b;)a(b.length,b.annotation,b.attachedObject),b=b.next};g.prototype.getAnnotatedSpansForPos=function(a){let c=0,f=this.head_.next,d=null;for(;null!==f&&c+f.length<=a;)c+=f.length,d=f,f=f.next;if(null===f&&c!==a)throw Error("pos exceeds the bounds of the AnnotationList");const g=[];c===a&&d&&g.push(new b(c-d.length,d));f&&g.push(new b(c,f));return g};g.prototype.getAnnotatedSpansForSpan=function(a){if(0===a.length)return[];const b=[];var c=this.getAffectedNodes_(a);let f=c.startPos;for(c=c.start;null!==
c&&f<a.end();){var d=Math.max(f,a.pos);const g=Math.min(f+c.length,a.end());d=new m(d,g-d);d.annotation=c.annotation;b.push(d);f+=c.length;c=c.next}return b};g.prototype.count=function(){let b=0,c=this.head_.next,f=null;for(;null!==c;)f&&a(!f.annotation.equals(c.annotation)),f=c,c=c.next,b++;return b};k.prototype.clone=function(){const a=new k(this.spanLength,this.annotation);a.next=this.next;return a};return g}();d.AnnotationList=c})(window);(function(d){d.AttributeConstants={BOLD:"b",ITALIC:"i",UNDERLINE:"u",STRIKE:"s",FONT:"f",FONT_SIZE:"fs",COLOR:"c",BACKGROUND_COLOR:"bc",ENTITY_SENTINEL:"ent",LINE_SENTINEL:"l",LINE_INDENT:"li",LINE_ALIGN:"la",LIST_TYPE:"lt"}})(window);(function(d){const c=function(){function a(c){if(!(this instanceof a))return new a(c);this.attributes=c||{};this.attributes[b.LINE_SENTINEL]=!0}const b=d.AttributeConstants;a.LIST_TYPE={NONE:!1,ORDERED:"o",UNORDERED:"u",TODO:"t",TODOCHECKED:"tc"};a.prototype.cloneWithNewAttribute_=function(b,c){const f={};for(const a in this.attributes)f[a]=this.attributes[a];!1===c?delete f[b]:f[b]=c;return new a(f)};a.prototype.indent=function(a){return this.cloneWithNewAttribute_(b.LINE_INDENT,a)};a.prototype.align=
function(a){return this.cloneWithNewAttribute_(b.LINE_ALIGN,a)};a.prototype.listItem=function(a){vceditor.utils.assert(!1===a||"u"===a||"o"===a||"t"===a||"tc"===a);return this.cloneWithNewAttribute_(b.LIST_TYPE,a)};a.prototype.getIndent=function(){return this.attributes[b.LINE_INDENT]||0};a.prototype.getAlign=function(){return this.attributes[b.LINE_ALIGN]||0};a.prototype.getListItem=function(){return this.attributes[b.LIST_TYPE]||!1};return a}();d.LineFormatting=c})(window);(function(d){const c=function(){function a(a){return a===k.ORDERED?"</ol>":"</ul>"}function b(a,b){return a===b||a===k.TODO&&b===k.TODOCHECKED||a===k.TODOCHECKED&&b===k.TODO}const {utils:c}=d,g=d.AttributeConstants,{LIST_TYPE:k}=d.LineFormatting;return function(f,d){let m="",n=!0;const z=[];var t=!1;let u=!0;var p=!0;let v=0,B=f.ops[v],C=!1;for(;B;){c.assert(B.isInsert());const q=B.attributes;if(n){n=!1;var F=0,G=null,D="left";g.LINE_SENTINEL in q&&(F=q[g.LINE_INDENT]||0,G=q[g.LIST_TYPE]||null,D=
q[g.LINE_ALIGN]||"left");G&&(F=F||1);t?(m+="</li>",t=!1):u||(p&&(m+="<br/>"),m+="</div>");u=!1;for(c.assert(0<=F,"Indent must not be negative.");z.length>F||F===z.length&&null!==G&&!b(G,z[z.length-1]);)m+=a(z.pop());for(;z.length<F;)p=G||k.UNORDERED,C=G==k.TODO||G==k.TODOCHECKED||C,m+=p===k.ORDERED?"<ol>":p===k.UNORDERED?"<ul>":'<ul class="vceditor-todo">',z.push(p);p="left"!==D?` style="text-align:${D}"`:"";if(G){t="";switch(G){case k.TODOCHECKED:t=' class="vceditor-checked"';break;case k.TODO:t=
' class="vceditor-unchecked"'}m+=`<li${t}${p}>`;t=!0}else m+=`<div${p}>`;p=!0}if(g.LINE_SENTINEL in q){B=f.ops[++v];continue}if(g.ENTITY_SENTINEL in q){for(G=0;G<B.text.length;G++)F=vceditor.Entity.fromAttributes(q),F=d.exportToElement(F),m+=F.outerHTML;B=f.ops[++v];continue}F=G="";for(const a in q){D=q[a];var H;if(a===g.BOLD||a===g.ITALIC||a===g.UNDERLINE||a===g.STRIKE){c.assert(!0===D);var A=H=a}else a===g.FONT_SIZE?(A=`span style="font-size: ${D}`,A+="string"!==typeof D||-1===D.indexOf("px",D.length-
2)?'px"':'"',H="span"):a===g.FONT?(A=`span style="font-family: ${D}"`,H="span"):a===g.COLOR?(A=`span style="color: ${D}"`,H="span"):a===g.BACKGROUND_COLOR?(A=`span style="background-color: ${D}"`,H="span"):c.log(!1,`Encountered unknown attribute while rendering html: ${a}`);A&&(G+=`<${A}>`);H&&(F=`</${H}>${F}`)}({text:D}=B);const r=D.indexOf("\n");0<=r?(n=!0,B=r<D.length-1?new vceditor.TextOp("insert",D.substr(r+1),q):f.ops[++v],D=D.substr(0,r)):B=f.ops[++v];D=D.replace(/  +/g,a=>Array(a.length+1).join("\u00a0")).replace(/^ /,
"\u00a0").replace(/ $/,"\u00a0");0<D.length&&(p=!1);m+=G+D.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00a0/g,"&nbsp;")+F}t?m+="</li>":u||(p&&(m+="&nbsp;"),m+="</div>");for(;0<z.length;)m+=a(z.pop());C&&(m='<style>ul.vceditor-todo { list-style: none; margin-left: 0; padding-left: 0; } ul.vceditor-todo > li { padding-left: 1em; text-indent: -1em; } ul.vceditor-todo > li:before { content: "\\2610"; padding-right: 5px; } ul.vceditor-todo > li.vceditor-checked:before { content: "\\2611"; padding-right: 5px; }</style>\n'+
m);return m}}();d.SerializeHtml=c})(window);(function(d){const c=function(){function a(a,b,c){this.listType=a||m.UNORDERED;this.lineFormatting=b||vceditor.LineFormatting();this.textFormatting=c||vceditor.Formatting()}function b(){this.lines=[];this.currentLine=[];this.currentLineListItemType=null}function c(a,b,c){if(a.nodeType===q.ELEMENT_NODE){var f=n.fromElement(a);if(f){c.currentLine.push(new vceditor.Text(vceditor.sentinelConstants.ENTITY_SENTINEL_CHARACTER,new vceditor.Formatting(f.toAttributes())));return}}switch(a.nodeType){case q.TEXT_NODE:a=
a.nodeValue.replace(/[ \n\t]+/g," ");c.currentLine.push(vceditor.Text(a,b.textFormatting));break;case q.ELEMENT_NODE:switch(f=a.getAttribute("style")||"",b=k(b,f),a.nodeName.toLowerCase()){case "div":case "h1":case "h2":case "h3":case "p":c.newlineIfNonEmpty(b);g(a,b,c);c.newlineIfNonEmpty(b);break;case "center":b=b.withAlign("center");c.newlineIfNonEmpty(b);g(a,b.withAlign("center"),c);c.newlineIfNonEmpty(b);break;case "b":case "strong":g(a,b.withTextFormatting(b.textFormatting.bold(!0)),c);break;
case "u":g(a,b.withTextFormatting(b.textFormatting.underline(!0)),c);break;case "i":case "em":g(a,b.withTextFormatting(b.textFormatting.italic(!0)),c);break;case "s":g(a,b.withTextFormatting(b.textFormatting.strike(!0)),c);break;case "font":f=a.getAttribute("face");var d=a.getAttribute("color"),v=parseInt(a.getAttribute("size"));f&&(b=b.withTextFormatting(b.textFormatting.font(f)));d&&(b=b.withTextFormatting(b.textFormatting.color(d)));v&&(b=b.withTextFormatting(b.textFormatting.fontSize(v)));g(a,
b,c);break;case "br":c.newline(b);break;case "ul":c.newlineIfNonEmptyOrListItem(b);f="vceditor-todo"===a.getAttribute("class")?m.TODO:m.UNORDERED;g(a,b.withListType(f).withIncreasedIndent(),c);c.newlineIfNonEmpty(b);break;case "ol":c.newlineIfNonEmptyOrListItem(b);g(a,b.withListType(m.ORDERED).withIncreasedIndent(),c);c.newlineIfNonEmpty(b);break;case "li":c.newlineIfNonEmptyOrListItem(b);f="vceditor-checked"===a.getAttribute("class")?m.TODOCHECKED:b.listType;c.makeListItem(f);f=c.currentLine;g(a,
b,c);(f===c.currentLine||0<c.currentLine.length)&&c.newline(b);break;case "style":break;default:g(a,b,c)}}}function g(a,b,f){if(a.hasChildNodes())for(let d=0;d<a.childNodes.length;d++)c(a.childNodes[d],b,f)}function k(a,b){let {textFormatting:c}=a,{lineFormatting:f}=a;b=b.split(";");for(let a=0;a<b.length;a++){var d=b[a].split(":");if(2===d.length){var g=vceditor.utils.trim(d[0]).toLowerCase();d=vceditor.utils.trim(d[1]).toLowerCase();switch(g){case "text-decoration":g=0<=d.indexOf("underline");d=
0<=d.indexOf("line-through");c=c.underline(g).strike(d);break;case "font-weight":d="bold"===d||600<=parseInt(d);c=c.bold(d);break;case "font-style":c=c.italic("italic"===d||"oblique"===d);break;case "color":c=c.color(d);break;case "background-color":c=c.backgroundColor(d);break;case "text-align":f=f.align(d);break;case "font-size":g=null;vceditor.utils.stringEndsWith(d,"px pt % em xx-small x-small small medium large x-large xx-large smaller larger".split(" "))?g=d:parseInt(d)&&(g=`${parseInt(d)}px`);
g&&(c=c.fontSize(g));break;case "font-family":d=vceditor.utils.trim(d.split(",")[0]),d=d.replace(/['"]/g,""),d=d.replace(/\w\S*/g,a=>a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()),c=c.font(d)}}}return a.withLineFormatting(f).withTextFormatting(c)}const {LIST_TYPE:m}=d.LineFormatting;a.prototype.withTextFormatting=function(b){return new a(this.listType,this.lineFormatting,b)};a.prototype.withLineFormatting=function(b){return new a(this.listType,b,this.textFormatting)};a.prototype.withListType=
function(b){return new a(b,this.lineFormatting,this.textFormatting)};a.prototype.withIncreasedIndent=function(){const b=this.lineFormatting.indent(this.lineFormatting.getIndent()+1);return new a(this.listType,b,this.textFormatting)};a.prototype.withAlign=function(b){b=this.lineFormatting.align(b);return new a(this.listType,b,this.textFormatting)};b.prototype.newlineIfNonEmpty=function(a){this.cleanLine_();0<this.currentLine.length&&this.newline(a)};b.prototype.newlineIfNonEmptyOrListItem=function(a){this.cleanLine_();
(0<this.currentLine.length||null!==this.currentLineListItemType)&&this.newline(a)};b.prototype.newline=function(a){this.cleanLine_();({lineFormatting:a}=a);null!==this.currentLineListItemType&&(a=a.listItem(this.currentLineListItemType),this.currentLineListItemType=null);this.lines.push(vceditor.Line(this.currentLine,a));this.currentLine=[]};b.prototype.makeListItem=function(a){this.currentLineListItemType=a};b.prototype.cleanLine_=function(){if(0<this.currentLine.length){var a=this.currentLine.length-
1;this.currentLine[0].text=this.currentLine[0].text.replace(/^ +/,"");this.currentLine[a].text=this.currentLine[a].text.replace(/ +$/g,"");for(a=0;a<this.currentLine.length;a++)this.currentLine[a].text=this.currentLine[a].text.replace(/\u00a0/g," ")}1===this.currentLine.length&&""===this.currentLine[0].text&&(this.currentLine=[])};let n;var q=q||{ELEMENT_NODE:1,TEXT_NODE:3};return function(f,d){const g=(vceditor.document||document).createElement("div");g.innerHTML=f;n=d;f=new b;d=new a;c(g,d,f);return f.lines}}();
d.ParseHtml=c})(window);(function(d){const c=function(){function a(a){this.rtcm=a;this.cm=a.codeMirror;c(this,"onChange");c(this,"onAttributesChange");c(this,"onCursorActivity");c(this,"onFocus");c(this,"onBlur");this.rtcm.on("change",this.onChange);this.rtcm.on("attributesChange",this.onAttributesChange);this.cm.on("cursorActivity",this.onCursorActivity);this.cm.on("focus",this.onFocus);this.cm.on("blur",this.onBlur)}function b(a){const b=a.lineCount()-1;return a.indexFromPos({line:b,ch:a.getLine(b).length})}function c(a,
b){const c=a[b];a[b]=function(){c.apply(a,arguments)}}function g(a){for(const b in a)return!1;return!0}const {TextOperation:k}=d,{WrappedOperation:m}=d,{Cursor:n}=d;a.prototype.detach=function(){this.rtcm.off("change",this.onChange);this.rtcm.off("attributesChange",this.onAttributesChange);this.cm.off("cursorActivity",this.onCursorActivity);this.cm.off("focus",this.onFocus);this.cm.off("blur",this.onBlur)};a.operationFromCodeMirrorChanges=function(a,c){c=b(c);let f=(new k).retain(c),d=(new k).retain(c);
for(let b=a.length-1;0<=b;b--){const g=a[b],m=g.start,n=c-m-g.text.length;f=(new k).retain(m).delete(g.removed.length).insert(g.text,g.attributes).retain(n).compose(f);d=d.compose((new k).retain(m).delete(g.text.length).insert(g.removed,g.removedAttributes).retain(n));c+=g.removed.length-g.text.length}return[f,d]};a.operationFromAttributesChanges=function(a,c){c=b(c);const f=new k,d=new k;var g=0;for(let b=0;b<a.length;b++){const c=a[b];g=c.start-g;if(!(0<=g))throw Error("assertion error");f.retain(g);
d.retain(g);g=c.end-c.start;f.retain(g,c.attributes);d.retain(g,c.attributesInverse);g=c.start+g}f.retain(c-g);d.retain(c-g);return[f,d]};a.applyOperationToCodeMirror=function(a,b){10<a.ops.length&&b.codeMirror.getWrapperElement().setAttribute("style","display: none");const {ops:c}=a;let f=0;for(let a=0,k=c.length;a<k;a++){var d=c[a];d.isRetain()?(g(d.attributes)||b.updateTextAttributes(f,f+d.chars,a=>{for(const b in d.attributes)!1===d.attributes[b]?delete a[b]:a[b]=d.attributes[b]},"RTCMADAPTER",
!0),f+=d.chars):d.isInsert()?(b.insertText(f,d.text,d.attributes,"RTCMADAPTER"),f+=d.text.length):d.isDelete()&&b.removeText(f,f+d.chars,"RTCMADAPTER")}10<a.ops.length&&(b.codeMirror.getWrapperElement().setAttribute("style",""),b.codeMirror.refresh())};a.prototype.registerCallbacks=function(a){this.callbacks=a};a.prototype.onChange=function(b,c){"RTCMADAPTER"!==c[0].origin&&(b=a.operationFromCodeMirrorChanges(c,this.cm),this.trigger("change",b[0],b[1]))};a.prototype.onAttributesChange=function(b,
c){"RTCMADAPTER"!==c[0].origin&&(b=a.operationFromAttributesChanges(c,this.cm),this.trigger("change",b[0],b[1]))};a.prototype.onCursorActivity=function(){this.trigger("cursorActivity")};a.prototype.onFocus=function(){this.trigger("focus")};a.prototype.onBlur=function(){this.cm.somethingSelected()||this.trigger("blur")};a.prototype.getValue=function(){return this.cm.getValue()};a.prototype.getCursor=function(){var {cm:a}=this,b=a.getCursor();const c=a.indexFromPos(b);if(a.somethingSelected()){const c=
a.getCursor(!0);b=0===(b.line<c.line?-1:b.line>c.line?1:b.ch<c.ch?-1:b.ch>c.ch?1:0)?a.getCursor(!1):c;a=a.indexFromPos(b)}else a=c;return new n(c,a)};a.prototype.setCursor=function(a){this.cm.setSelection(this.cm.posFromIndex(a.position),this.cm.posFromIndex(a.selectionEnd))};a.prototype.addStyleRule=function(a){if("undefined"!==typeof document&&null!==document){if(!this.addedStyleRules){this.addedStyleRules={};const a=document.createElement("style");document.documentElement.getElementsByTagName("head")[0].appendChild(a);
this.addedStyleSheet=a.sheet}if(!this.addedStyleRules[a])return this.addedStyleRules[a]=!0,this.addedStyleSheet.insertRule(a,0)}};a.prototype.setOtherCursor=function(a,b,c){const f=this.cm.posFromIndex(a.position);if("string"===typeof b&&b.match(/^#[a-fA-F0-9]{3,6}$/)){var d=this.rtcm.end();if("object"===typeof a&&"number"===typeof a.position&&"number"===typeof a.selectionEnd&&!(0>a.position||a.position>d||0>a.selectionEnd||a.selectionEnd>d)){var g=this.cm.cursorCoords(f);d=document.createElement("span");
d.className="other-client";d.id=`cursorId${c}`;d.style.borderLeftWidth="3px";d.style.borderLeftStyle="solid";d.style.borderLeftColor=b;d.style.marginLeft=d.style.marginRight="-3px";d.style.height=`${.9*(g.bottom-g.top)}px`;d.setAttribute("data-clientname",virtualclass.vutil.getUserInfo("name",c,virtualclass.connectedUsers));d.setAttribute("data-clientid",c);d.style.position="relative";g=document.getElementById(`cursorId${c}`);null!=g&&g.parentNode.removeChild(g);if(c!=virtualclass.gObj.uid){if(a.position===
a.selectionEnd)return d.style.zIndex=0,this.cm.setBookmark(f,{widget:d,insertLeft:!0});this.cm.setBookmark(f,{widget:d,insertLeft:!0});c=`selection-${b.replace("#","")}`;this.addStyleRule(`.${c} { background: ${b}; }`);a.selectionEnd>a.position?(b=f,a=this.cm.posFromIndex(a.selectionEnd)):(b=this.cm.posFromIndex(a.selectionEnd),a=f);return this.cm.markText(b,a,{className:c})}}}};a.prototype.trigger=function(a){const b=Array.prototype.slice.call(arguments,1),c=this.callbacks&&this.callbacks[a];c&&
c.apply(this,b)};a.prototype.applyOperation=function(b){a.applyOperationToCodeMirror(b,this.rtcm)};a.prototype.registerUndo=function(a){this.cm.undo=a};a.prototype.registerRedo=function(a){this.cm.redo=a};a.prototype.invertOperation=function(a){let b=0;const c=this.rtcm.codeMirror;let f,d;const n=new k;for(let k=0;k<a.wrapped.ops.length;k++){const m=a.wrapped.ops[k];if(m.isRetain())if(g(m.attributes))n.retain(m.chars),b+=m.chars;else for(f=this.rtcm.getAttributeSpans(b,b+m.chars),d=0;d<f.length;d++){var v=
{};for(const a in m.attributes){var q=m.attributes[a];const b=f[d].attributes[a];!1===q?b&&(v[a]=b):q!==b&&(v[a]=b||!1)}n.retain(f[d].length,v);b+=f[d].length}else if(m.isInsert())n.delete(m.text.length);else if(m.isDelete()){v=c.getRange(c.posFromIndex(b),c.posFromIndex(b+m.chars));f=this.rtcm.getAttributeSpans(b,b+m.chars);for(d=q=0;d<f.length;d++)n.insert(v.substr(q,f[d].length),f[d].attributes),q+=f[d].length;b+=m.chars}}return new m(n,a.meta.invert())};return a}();d.Client=c})(window);const otAdapter=function(){function d(c,a){a=a.charAt(0).toLowerCase()+a.slice(1);const b=Vceditor.getvcEditor();c.operations&&c.revision>c.operations.length?(a=[],a[c.revision-c.operations.length-1]=null,this.operations=a.concat(c.operations)):this.operations=c.operations?c.operations:[];this.server=new b.Server(c.doc,this.operations);this.trigger=function(a){this.callbacks[a].apply(this,Array.prototype.slice.call(arguments,1))};this.teacherOT=function(a){a=this.doOT(a);"undefined"!==typeof a&&this.preSend(a,
!0)};this.doOT=function(a){if(1!==this.myOTrequestData)try{if("virtualclass-editor-operation"==a.eddata){const c=JSON.parse(a.data),f=new b.WrappedOperation(b.TextOperation.fromJSON(c.operation),c.cursor&&b.Cursor.fromJSON(c.cursor)),d=this.server.receiveOperation(c.revision,f);if(!d){console.log("there is some problem on revision of history");return}a.data=d.wrapped.toJSON();a.meta=d.meta}return a}catch(g){console.log(`ERROR ${g}`),roles.isTeacher()&&(this.myOTrequestData=1,virtualclass[a.et].responseToRequest())}};
this.processOp=function(a){if(1!==this.myrequestData&&1!==this.myOTrequestData)try{const b=a.message;b.hasOwnProperty("edFrom")&&(a.fromUser.userid=b.edFrom);b.hasOwnProperty("eddata")?"virtualclass-editor-cursor"==b.eddata?this.trigger("cursor",a.fromUser.userid,JSON.parse(b.data)):"selection"==b.eddata?this.trigger("selection",virtualclass.gObj.uid,b.data):"virtualclass-editor-operation"==b.eddata&&(this.trigger("operation",b.data),this.trigger("cursor",a.fromUser.userid,b.meta),this.storeOperationIfStudent(b)):
console.log("Editor : processOP - No EDDATA")}catch(g){roles.hasAdmin()?(this.myOTrequestData=1,virtualclass[a.message.et].responseToRequest(),console.log("Teacher : send whlole editor data ")):(this.removeOperations(a),virtualclass[a.message.et].requestData(),this.myrequestData=1,console.log("Student : send whlole editor data "))}};this.storeOperationIfStudent=function(a){if(!roles.hasAdmin()){const c={};c.wrapped=b.TextOperation.fromJSON(a.data);c.meta=a.meta;this.server.operations.push(c)}};this.receivedMessage=
function(a){if(!virtualclass.isPlayMode||"object"!==typeof a.toUser){var b=a.message;if("t"!=a.fromUser.role&&"e"!=a.fromUser.role||b.hasOwnProperty("edFrom"))if(b.hasOwnProperty("edFrom")||"t"==a.fromUser.role||"e"==a.fromUser.role)if(b.edFrom==virtualclass.gObj.uid){if("virtualclass-editor-operation"==b.eddata)try{this.trigger("ack"),this.storeOperationIfStudent(b)}catch(k){1===ioMissingPackets.missRequestFlag&&(virtualclass[b.et].cmClient.revision--,this.processOp(a),console.log("Failed Acknolwdgement processOp()")),
console.log(`ACK Too Late ${k}`)}}else this.processOp(a);else b=this.doOT(b),"undefined"!==typeof b&&(a.message=b,b.edFrom=a.fromUser.userid,this.preSend(b,!0));else if(roles.hasAdmin()){if("virtualclass-editor-operation"==b.eddata)try{this.trigger("ack")}catch(k){console.log(`ACK Too Late ${k}`)}}else this.processOp(a)}};this.removeOperations=function(a){({et:a}=a.message);this.server.operations=[];this.server.document="";virtualclass[a].cmClient.revision=0;if(null!=b){var b=document.getElementById("virtualclassEditorRichBody");
b.parentNode.removeChild(b)}}}d.myrequestData=0;d.myOTrequestData=0;d.prototype.sendOperation=function(c,a,b,f){if("undefined"!==typeof f)var d="richtext"==f?"editorRich":"editorCode";a={eddata:"virtualclass-editor-operation",data:JSON.stringify({revision:c,operation:a,cursor:b}),et:d,cf:"eddata"};console.log(`from send operation ${c}`);this.beforeSend(a);console.log("send operation")};d.prototype.sendSelection=function(c){this.beforeSend({eddata:"selection",data:JSON.stringify(c),cf:"eddata"})};
d.prototype.sendCursor=function(c){this.beforeSend({eddata:"virtualclass-editor-cursor",data:JSON.stringify(c),cf:"eddata"})};d.prototype.registerCallbacks=function(c){this.callbacks=c};d.prototype.beforeSend=function(c){if(1!=this.myrequestData)if(roles.hasAdmin())this.teacherOT(c);else{const a=virtualclass.vutil.whoIsTeacher();c=this.setEditorTypeOnPacket(c);ioAdapter.mustSendUser(c,a)}};d.prototype.setEditorTypeOnPacket=function(c){if(c.hasOwnProperty("eddata")&&"initVcEditor"!=c.eddata&&"virtualclass-editor-operation"!=
c.eddata)if("EditorRich"==virtualclass.currApp||"editorRich"==virtualclass.currApp)c.et="editorRich";else if("EditorCode"==virtualclass.currApp||"editorCode"==virtualclass.currApp)c.et="editorCode";return c};d.prototype.preSend=function(c,a){c=this.setEditorTypeOnPacket(c);"undefined"===typeof a||0==a||null==a?ioAdapter.mustSend(c):setTimeout(()=>{ioAdapter.mustSendAll(c)},300)};return d}();const Vceditor=function(d){var c=c||{};c.utils=d.utils;c=c||{};c.Span=d.Span;c.TextOp=d.TextOp;c.TextOperation=d.TextOperation;c.AnnotationList=d.AnnotationList;c.Cursor=d.Cursor;c.RichTextToolbar=d.RichTextToolbar;c.WrappedOperation=d.WrappedOperation;c.UndoManager=d.UndoManager;c.Client=d.Client;Client=c.Client;c.EditorClient=d.EditorClient;c.utils.makeEventEmitter(c.EditorClient,["synced"]);c.AttributeConstants=d.AttributeConstants;c.sentinelConstants={LINE_SENTINEL_CHARACTER:"\ue000",ENTITY_SENTINEL_CHARACTER:"\ue001"};
c.EntityManager=function(){function a(){this.entities_={};const a="src alt width height style class".split(" ");this.register("img",{render(a){b.assert(a.src,"image entity should have 'src'!");const c="src alt width height style class".split(" ");let f="<img ";for(let b=0;b<c.length;b++){const d=c[b];d in a&&(f+=` ${d}="${a[d]}"`)}return f+">"},fromElement(b){const c={};for(let f=0;f<a.length;f++){const d=a[f];b.hasAttribute(d)&&(c[d]=b.getAttribute(d))}return c}})}const {utils:b}=c;a.prototype.register=
function(a,b){c.utils.assert(b.render,"Entity options should include a 'render' function!");c.utils.assert(b.fromElement,"Entity options should include a 'fromElement' function!");this.entities_[a]=b};a.prototype.renderToElement=function(a,b){return this.tryRenderToElement_(a,"render",b)};a.prototype.exportToElement=function(a){const b=this.tryRenderToElement_(a,"export")||this.tryRenderToElement_(a,"getHtml")||this.tryRenderToElement_(a,"render");b.setAttribute("data-vceditor-entity",a.type);return b};
a.prototype.updateElement=function(a,b){const {type:c}=a;({info:a}=a);this.entities_[c]&&"undefined"!==typeof this.entities_[c].update&&this.entities_[c].update(a,b)};a.prototype.fromElement=function(a){let b=a.getAttribute("data-vceditor-entity");b||(b=a.nodeName.toLowerCase());if(b&&this.entities_[b])return a=this.entities_[b].fromElement(a),new c.Entity(b,a)};a.prototype.tryRenderToElement_=function(a,b,k){var {type:f}=a;({info:a}=a);if(this.entities_[f]&&this.entities_[f][b]&&(b=this.entities_[f][b](a,
k,c.document||d&&d.document))){if("string"===typeof b)return f=(c.document||document).createElement("div"),f.innerHTML=b,f.childNodes[0];if("object"===typeof b)return c.utils.assert("undefined"!==typeof b.nodeType,`Error rendering ${f} entity.  render() function`+" must return an html string or a DOM element."),b}};a.prototype.entitySupportsUpdate=function(a){return this.entities_[a]&&this.entities_[a].update};return a}();c=c||{};c.Entity=d.entity;c.Entity=function(){function a(b,c){if(!(this instanceof
a))return new a(b,c);this.type=b;this.info=c||{}}const b=c.AttributeConstants.ENTITY_SENTINEL,f=`${b}_`;a.prototype.toAttributes=function(){const a={};a[b]=this.type;for(const b in this.info)a[f+b]=this.info[b];return a};a.fromAttributes=function(c){const d=c[b],g={};for(const a in c)0===a.indexOf(f)&&(g[a.substr(f.length)]=c[a]);return new a(d,g)};return a}();c.RichTextCodeMirror=function(){function a(a,b,c){this.codeMirror=a;this.options_=c||{};this.entityManager_=b;this.currentAttributes_=null;
const f=this;this.annotationList_=new m((a,b)=>{f.onAnnotationsChanged_(a,b)});this.initAnnotationList_();k(this,"onCodeMirrorBeforeChange_");k(this,"onCodeMirrorChange_");k(this,"onCursorActivity_");if(/^4\./.test(CodeMirror.version))this.codeMirror.on("changes",this.onCodeMirrorChange_);else this.codeMirror.on("change",this.onCodeMirrorChange_);this.codeMirror.on("beforeChange",this.onCodeMirrorBeforeChange_);this.codeMirror.on("cursorActivity",this.onCursorActivity_);this.changeId_=0;this.outstandingChanges_=
{};this.dirtyLines_=[]}function b(a,b){return a.line-b.line||a.ch-b.ch}function f(a){if(0===a.length)return 0;let b=0;for(let c=0;c<a.length;c++)b+=a[c].length;return b+a.length-1}function d(a){this.attributes=a||{}}function k(a,b){const c=a[b];a[b]=function(){c.apply(a,arguments)}}const {AnnotationList:m}=c,{Span:n}=c,{utils:q}=c,r=c.AttributeConstants,z={c:"color",bc:"background-color",fs:"font-size",li(a){return`padding-left: ${40*a}px`}},t={};q.makeEventEmitter(a,["change","attributesChange",
"newLine"]);const u=c.sentinelConstants.LINE_SENTINEL_CHARACTER,p=c.sentinelConstants.ENTITY_SENTINEL_CHARACTER;a.prototype.detach=function(){this.codeMirror.off("beforeChange",this.onCodeMirrorBeforeChange_);this.codeMirror.off("change",this.onCodeMirrorChange_);this.codeMirror.off("changes",this.onCodeMirrorChange_);this.codeMirror.off("cursorActivity",this.onCursorActivity_);this.clearAnnotations_()};a.prototype.toggleAttribute=function(a,b){b=b||!0;if(this.emptySelection_()){const c=this.getCurrentAttributes_();
c[a]===b?delete c[a]:c[a]=b;this.currentAttributes_=c}else b=this.getCurrentAttributes_()[a]!==b?b:!1,this.setAttribute(a,b)};a.prototype.setAttribute=function(a,b){var c=this.codeMirror;this.emptySelection_()?(c=this.getCurrentAttributes_(),!1===b?delete c[a]:c[a]=b,this.currentAttributes_=c):(this.updateTextAttributes(c.indexFromPos(c.getCursor("start")),c.indexFromPos(c.getCursor("end")),c=>{!1===b?delete c[a]:c[a]=b}),this.updateCurrentAttributes_())};a.prototype.updateTextAttributes=function(a,
b,c,f,g){const k=[];let m=a;const q=this;this.annotationList_.updateSpan(new n(a,b-a),(a,b)=>{const n={};for(var v in a.attributes)n[v]=a.attributes[v];n[r.LINE_SENTINEL]&&!g||c(n);v={};const C={};q.computeChangedAttributes_(a.attributes,n,v,C);a:{for(const b in v){a=!1;break a}a=!0}a||k.push({start:m,end:m+b,attributes:v,attributesInverse:C,origin:f});m+=b;return new d(n)});0<k.length&&this.trigger("attributesChange",this,k)};a.prototype.computeChangedAttributes_=function(a,b,c,f){const d={};let g;
for(g in a)d[g]=!0;for(g in b)d[g]=!0;for(g in d)g in b?g in a?a[g]!==b[g]&&(c[g]=b[g],f[g]=a[g]):(c[g]=b[g],f[g]=!1):(c[g]=!1,f[g]=a[g])};a.prototype.toggleLineAttribute=function(a,b){const c=this.getCurrentLineAttributes_();this.setLineAttribute(a,a in c&&c[a]===b?!1:b)};a.prototype.setLineAttribute=function(a,b){this.updateLineAttributesForSelection(c=>{!1===b?delete c[a]:c[a]=b})};a.prototype.updateLineAttributesForSelection=function(a){var b=this.codeMirror,c=b.getCursor("start"),f=b.getCursor("end");
c=c.line;let d=f.line;b=b.getLine(d);f=this.areLineSentinelCharacters_(b.substr(0,f.ch));d>c&&f&&d--;this.updateLineAttributes(c,d,a)};a.prototype.updateLineAttributes=function(a,b,c){for(;a<=b;a++){var f=this.codeMirror.getLine(a);const b=this.codeMirror.indexFromPos({line:a,ch:0});f[0]!==u?(f={},f[r.LINE_SENTINEL]=!0,c(f),this.insertText(b,u,f)):this.updateTextAttributes(b,b+1,c,null,!0)}};a.prototype.replaceText=function(a,b,c,f,d){this.changeId_++;const g="cmrt-"+this.changeId_;this.outstandingChanges_[g]=
{origOrigin:d,attributes:f};f=this.codeMirror;a=f.posFromIndex(a);b="number"===typeof b?f.posFromIndex(b):null;f.replaceRange(c,a,b,g)};a.prototype.insertText=function(a,b,c,f){const d=this.codeMirror,g=d.getCursor(),k="RTCMADAPTER"==f&&!d.somethingSelected()&&a==d.indexFromPos(g);this.replaceText(a,null,b,c,f);k&&d.setCursor(g)};a.prototype.removeText=function(a,b,c){const f=this.codeMirror;f.replaceRange("",f.posFromIndex(a),f.posFromIndex(b),c)};a.prototype.insertEntityAtCursor=function(a,b,c){var f=
this.codeMirror;f=f.indexFromPos(f.getCursor("head"));this.insertEntityAt(f,a,b,c)};a.prototype.insertEntityAt=function(a,b,f,d){this.insertEntity_(a,new c.Entity(b,f),d)};a.prototype.insertEntity_=function(a,b,c){this.replaceText(a,null,p,b.toAttributes(),c)};a.prototype.getAttributeSpans=function(a,b){const c=[];a=this.annotationList_.getAnnotatedSpansForSpan(new n(a,b-a));for(b=0;b<a.length;b++)c.push({length:a[b].length,attributes:a[b].annotation.attributes});return c};a.prototype.end=function(){const a=
this.codeMirror.lineCount()-1;return this.codeMirror.indexFromPos({line:a,ch:this.codeMirror.getLine(a).length})};a.prototype.getRange=function(a,b){a=this.codeMirror.posFromIndex(a);b=this.codeMirror.posFromIndex(b);return this.codeMirror.getRange(a,b)};a.prototype.initAnnotationList_=function(){const a=this.end();0!==a&&this.annotationList_.insertAnnotatedSpan(new n(0,a),new d)};a.prototype.onAnnotationsChanged_=function(a,b){var c;const f={};this.tryToUpdateEntitiesInPlace(a,b);for(var d=0;d<a.length;d++)({attributes:c}=
a[d].annotation),r.LINE_SENTINEL in c&&(f[this.codeMirror.posFromIndex(a[d].pos).line]=!0),(c=a[d].getAttachedObject())&&c.clear();for(d=0;d<b.length;d++){({annotation:c}=b[d]);var g=r.LINE_SENTINEL in c.attributes;const k=r.ENTITY_SENTINEL in c.attributes;a=this.codeMirror.posFromIndex(b[d].pos);g?f[a.line]=!0:k?this.markEntity_(b[d]):(c=this.getClassNameForAttributes_(c.attributes),""!==c&&(g=this.codeMirror.posFromIndex(b[d].pos+b[d].length),c=this.codeMirror.markText(a,g,{className:c}),b[d].attachObject(c)))}for(const a in f)this.dirtyLines_.push(this.codeMirror.getLineHandle(Number(a))),
this.queueLineMarking_()};a.prototype.tryToUpdateEntitiesInPlace=function(a,b){let c=a.length;for(;c--;){const f=a[c];let d=b.length;for(;d--;){const g=b[d];if(f.pos==g.pos&&f.annotation.attributes.ent&&f.annotation.attributes.ent==g.annotation.attributes.ent&&this.entityManager_.entitySupportsUpdate(g.annotation.attributes.ent)){a.splice(c,1);b.splice(d,1);const k=f.getAttachedObject();k.update(g.annotation.attributes);g.attachObject(k)}}}};a.prototype.queueLineMarking_=function(){if(null==this.lineMarkTimeout_){var a=
this;this.lineMarkTimeout_=setTimeout(()=>{a.lineMarkTimeout_=null;const b=[];for(var c=0;c<a.dirtyLines_.length;c++){var f=a.codeMirror.getLineNumber(a.dirtyLines_[c]);b.push(Number(f))}a.dirtyLines_=[];b.sort((a,b)=>a-b);f=-1;for(c=0;c<b.length;c++){const d=b[c];d>f&&(f=a.markLineSentinelCharactersForChangedLines_(d,d))}},0)}};a.prototype.addStyleWithCSS_=function(a){const b=document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css";c.styleSheet?c.styleSheet.cssText=
a:c.appendChild(document.createTextNode(a));b.appendChild(c)};a.prototype.getClassNameForAttributes_=function(a){let b="";for(const g in a){var f=a[g];if(g===r.LINE_SENTINEL)c.utils.assert(!0===f,"LINE_SENTINEL attribute should be true if it exists.");else{let a=(this.options_.cssPrefix||"cmrt-")+g;if(!0!==f){g===r.FONT_SIZE&&"string"!==typeof f&&(f+="px");var d=f.toString().toLowerCase().replace(/[^a-z0-9-_]/g,"-");a+=`-${d}`;z[g]&&(t[g]||(t[g]={}),t[g][d]||(t[g][d]=!0,d=z[g],f="function"===typeof d?
d(f):`${d}: ${f}`,this.addStyleWithCSS_(`${g==r.LINE_INDENT?`pre.${a}`:`.${a}`} { ${f} }`)))}b=`${b} ${a}`}}return b};a.prototype.markEntity_=function(a){var {attributes:b}=a.annotation;b=c.Entity.fromAttributes(b);const f=this.codeMirror,d=this,g=[];for(let c=0;c<a.length;c++){var k=f.posFromIndex(a.pos+c);const d=f.posFromIndex(a.pos+c+1),m={collapsed:!0,atomic:!0,inclusiveLeft:!1,inclusiveRight:!1},n=this.createEntityHandle_(b,a.pos),q=this.entityManager_.renderToElement(b,n);q&&(m.replacedWith=
q);k=f.markText(k,d,m);g.push(k);n.setMarker(k)}a.attachObject({clear(){for(let a=0;a<g.length;a++)g[a].clear()},update(a){a=c.Entity.fromAttributes(a);for(let b=0;b<g.length;b++)d.entityManager_.updateElement(a,g[b].replacedWith)}});this.queueRefresh_()};a.prototype.queueRefresh_=function(){const a=this;this.refreshTimer_||(this.refreshTimer_=setTimeout(()=>{a.codeMirror.refresh();a.refreshTimer_=null},0))};a.prototype.createEntityHandle_=function(a,b){function f(){if(d){const a=d.find();return a?
g.codeMirror.indexFromPos(a.from):null}return b}let d=null;const g=this;return{find:f,remove:function(){const a=f();null!=a&&(g.codeMirror.focus(),g.removeText(a,a+1))},replace:function(b){const d=c.AttributeConstants.ENTITY_SENTINEL,k=`${d}_`,m=f();g.updateTextAttributes(m,m+1,c=>{for(const a in c)delete c[a];c[d]=a.type;for(const a in b)c[k+a]=b[a]})},setMarker:function(a){d=a}}};a.prototype.lineClassRemover_=function(a){const b=this.codeMirror,c=b.getLineHandle(a);return{clear(){b.removeLineClass(c,
"text",".*")}}};a.prototype.emptySelection_=function(){const a=this.codeMirror.getCursor("start"),b=this.codeMirror.getCursor("end");return a.line===b.line&&a.ch===b.ch};a.prototype.onCodeMirrorBeforeChange_=function(a,b){if("+input"===b.origin||"paste"===b.origin){a=[];for(let c=0;c<b.text.length;c++){let f=b.text[c];f=f.replace(new RegExp(`[${u}${p}]`,"g"),"");a.push(f)}b.update(b.from,b.to,a)}};a.prototype.onCodeMirrorChange_=function(a,b){if("object"===typeof b.from){for(a=[];b;)a.push(b),b=b.next;
b=a}a=this.convertCoordinateSystemForChanges_(b);const c=[];for(let b=0;b<a.length;b++){var f=a[b];const {start:g}=f,{text:k}=f,{removed:m}=f;let {origin:q}=f;if(0<m.length){const a=this.annotationList_.getAnnotatedSpansForSpan(new n(g,m.length));let b=0;for(let d=0;d<a.length;d++){const k=a[d];c.push({start:g,end:g+k.length,removedAttributes:k.annotation.attributes,removed:m.substr(b,k.length),attributes:{},text:"",origin:f.origin});b+=k.length}this.annotationList_.removeSpan(new n(g,m.length))}0<
k.length&&("+input"===f.origin||"paste"===f.origin?f=this.currentAttributes_||{}:q in this.outstandingChanges_?(f=this.outstandingChanges_[q].attributes,q=this.outstandingChanges_[q].origOrigin,delete this.outstandingChanges_[q]):f={},this.annotationList_.insertAnnotatedSpan(new n(g,k.length),new d(f)),c.push({start:g,end:g,removedAttributes:{},removed:"",text:k,attributes:f,origin:q}))}this.markLineSentinelCharactersForChanges_(b);0<c.length&&this.trigger("change",this,c)};a.prototype.convertCoordinateSystemForChanges_=
function(a){function c(a,c){return function(d){if(0>=b(d,c.from))return a(d);if(0>=b(c.to,d)){var g=d.line+c.text.length-1-(c.to.line-c.from.line);if(c.to.line<d.line)d=d.ch;else if(1>=c.text.length)d=d.ch-(c.to.ch-c.from.ch)+f(c.text);else{var k=c.text;d=d.ch-c.to.ch+k[k.length-1].length}return a({line:g,ch:d})+f(c.removed)-f(c.text)}return c.from.line===d.line?a(c.from)+d.ch-c.from.ch:a(c.from)+f(c.removed.slice(0,d.line-c.from.line))+1+d.ch}}const d=this;let g=function(a){return d.codeMirror.indexFromPos(a)};
const k=[];for(let b=a.length-1;0<=b;b--){const f=a[b];g=c(g,f);const d=g(f.from),m=f.removed.join("\n"),n=f.text.join("\n");k.unshift({start:d,end:d+m.length,removed:m,text:n,origin:f.origin})}return k};a.prototype.markLineSentinelCharactersForChanges_=function(a){let b=Number.MAX_VALUE,c=-1;for(let f=0;f<a.length;f++){const d=a[f],{line:g}=d.from;if(1<d.removed.length||0<=d.removed[0].indexOf(u))b=Math.min(b,g),c=Math.max(c,g);1<d.text.length?(b=Math.min(b,g),c=Math.max(c,g+d.text.length-1)):0<=
d.text[0].indexOf(u)&&(b=Math.min(b,g),c=Math.max(c,g))}c=Math.min(c,this.codeMirror.lineCount()-1);this.markLineSentinelCharactersForChangedLines_(b,c)};a.prototype.markLineSentinelCharactersForChangedLines_=function(a,b){if(a<Number.MAX_VALUE)for(;0<a&&this.lineIsListItemOrIndented_(a-1);)a--;if(-1<b)for(var c=this.codeMirror.lineCount();b+1<c&&this.lineIsListItemOrIndented_(b+1);)b++;c=[];const f=this.codeMirror;for(;a<=b;a++){const b=f.getLine(a);var d=f.getLineHandle(a);f.removeLineClass(d,"text",
".*");if(0<b.length)for(d=b.indexOf(u);0<=d;){const g=d;for(;d<b.length&&b[d]===u;){const b=f.findMarksAt({line:a,ch:d});for(let a=0;a<b.length;a++)b[a].isForLineSentinel&&b[a].clear();d++}this.markLineSentinelCharacters_(a,g,d,c);d=b.indexOf(u,d)}else c=[]}return b};a.prototype.markLineSentinelCharacters_=function(a,b,c,f){const d=this.codeMirror;let g=null;var k=null,m=function(){const a=k.find();return a?a.from.line:null};if(0===b){const b=this.getLineAttributes_(a),c=b[r.LIST_TYPE];let d=b[r.LINE_INDENT]||
0;for(c&&0===d&&(d=1);d>=f.length;)f.push(1);"o"===c?(g=this.makeOrderedListElement_(f[d]),f[d]++):"u"===c?(g=this.makeUnorderedListElement_(),f[d]=1):"t"===c?(g=this.makeTodoListElement_(!1,m),f[d]=1):"tc"===c&&(g=this.makeTodoListElement_(!0,m),f[d]=1);m=this.getClassNameForAttributes_(b);""!==m&&this.codeMirror.addLineClass(a,"text",m);f=f.slice(0,d+1)}f={inclusiveLeft:!0,collapsed:!0};g&&(f.replacedWith=g);k=d.markText({line:a,ch:b},{line:a,ch:c},f);k.isForLineSentinel=!0};a.prototype.makeOrderedListElement_=
function(a){return q.elt("div",`${a}.`,{class:"vceditor-list-left"})};a.prototype.makeUnorderedListElement_=function(){return q.elt("div","\u2022",{class:"vceditor-list-left"})};a.prototype.toggleTodo=function(a){const b=r.LIST_TYPE,c=this.getCurrentLineAttributes_();let f;b in c&&("t"===c[b]||"tc"===c[b])?"t"===c[b]?f="tc":"tc"===c[b]&&(f=a?"t":!1):f="t";this.setLineAttribute(b,f)};a.prototype.makeTodoListElement_=function(a,b){const c={type:"checkbox",class:"vceditor-todo-left"};a&&(c.checked=!0);
a=q.elt("input",!1,c);const f=this;q.on(a,"click",q.stopEventAnd(a=>{f.codeMirror.setCursor({line:b(),ch:1});f.toggleTodo(!0)}));return a};a.prototype.lineIsListItemOrIndented_=function(a){a=this.getLineAttributes_(a);return!1!==(a[r.LIST_TYPE]||!1)||0!==(a[r.LINE_INDENT]||0)};a.prototype.onCursorActivity_=function(){const a=this;clearTimeout(a.cursorTimeout);a.cursorTimeout=setTimeout(()=>{a.updateCurrentAttributes_()},1)};a.prototype.getCurrentAttributes_=function(){this.currentAttributes_||this.updateCurrentAttributes_();
return this.currentAttributes_};a.prototype.updateCurrentAttributes_=function(){var a=this.codeMirror,b=a.indexFromPos(a.getCursor("anchor"));const f=a.indexFromPos(a.getCursor("head"));a=f;if(b>f){for(;a<this.end();){b=this.getRange(a,a+1);if("\n"!==b&&b!==u)break;a++}a<this.end()&&a++}else for(;0<a;){b=this.getRange(a-1,a);if("\n"!==b&&b!==u)break;a--}b=this.annotationList_.getAnnotatedSpansForPos(a);this.currentAttributes_={};a={};0<b.length&&!(r.LINE_SENTINEL in b[0].annotation.attributes)?a=
b[0].annotation.attributes:1<b.length&&(c.utils.assert(!(r.LINE_SENTINEL in b[1].annotation.attributes),"Cursor can't be between two line sentinel characters."),a=b[1].annotation.attributes);for(const b in a)"l"!==b&&"lt"!==b&&"li"!==b&&0!==b.indexOf(r.ENTITY_SENTINEL)&&(this.currentAttributes_[b]=a[b])};a.prototype.getCurrentLineAttributes_=function(){var a=this.codeMirror;const b=a.getCursor("anchor");a=a.getCursor("head");let {line:c}=a;0===a.ch&&b.line<a.line&&c--;return this.getLineAttributes_(c)};
a.prototype.getLineAttributes_=function(a){const b={},f=this.codeMirror.getLine(a);if(0<f.length&&f[0]===u){a=this.codeMirror.indexFromPos({line:a,ch:0});a=this.annotationList_.getAnnotatedSpansForSpan(new n(a,1));c.utils.assert(1===a.length);for(const c in a[0].annotation.attributes)b[c]=a[0].annotation.attributes[c]}return b};a.prototype.clearAnnotations_=function(){this.annotationList_.updateSpan(new n(0,this.end()),(a,b)=>new d({}))};a.prototype.newline=function(){const a=this.codeMirror,b=this;
if(this.emptySelection_()){const c=a.getCursor("head").line,f=this.getLineAttributes_(c),d=f[r.LIST_TYPE];d&&1===a.getLine(c).length?this.updateLineAttributes(c,c,a=>{delete a[r.LIST_TYPE];delete a[r.LINE_INDENT]}):(a.replaceSelection("\n","end","+input"),this.updateLineAttributes(c+1,c+1,a=>{for(const b in f)a[b]=f[b];"tc"===d&&(a[r.LIST_TYPE]="t");b.trigger("newLine",{line:c+1,attr:a})}))}else a.replaceSelection("\n","end","+input")};a.prototype.deleteLeft=function(){const a=this.codeMirror,b=a.getCursor("head");
var c=this.getLineAttributes_(b.line);const f=c[r.LIST_TYPE];c=c[r.LINE_INDENT];const d=this.emptySelection_()&&1===b.ch;d&&f?this.updateLineAttributes(b.line,b.line,a=>{delete a[r.LIST_TYPE];delete a[r.LINE_INDENT]}):d&&c&&0<c?this.updateLineAttributes(b.line,b.line,a=>{a[r.LINE_INDENT]--}):a.deleteH(-1,"char")};a.prototype.deleteRight=function(){const a=this.codeMirror,b=a.getCursor("head");var c=a.getLine(b.line);c=this.areLineSentinelCharacters_(c);const f=b.line+1<a.lineCount()?a.getLine(b.line+
1):"";this.emptySelection_()&&c&&f[0]===u?a.replaceRange("",{line:b.line,ch:0},{line:b.line+1,ch:0},"+input"):a.deleteH(1,"char")};a.prototype.indent=function(){this.updateLineAttributesForSelection(a=>{const b=a[r.LIST_TYPE];a[r.LINE_INDENT]?a[r.LINE_INDENT]++:a[r.LINE_INDENT]=b?2:1})};a.prototype.unindent=function(){this.updateLineAttributesForSelection(a=>{const b=a[r.LINE_INDENT];b&&1<b?a[r.LINE_INDENT]=b-1:(delete a[r.LIST_TYPE],delete a[r.LINE_INDENT])})};a.prototype.getText=function(){return this.codeMirror.getValue().replace(new RegExp(u,
"g"),"")};a.prototype.areLineSentinelCharacters_=function(a){for(let b=0;b<a.length;b++)if(a[b]!==u)return!1;return!0};d.prototype.equals=function(a){if(!(a instanceof d))return!1;let b;for(b in this.attributes)if(a.attributes[b]!==this.attributes[b])return!1;for(b in a.attributes)if(a.attributes[b]!==this.attributes[b])return!1;return!0};return a}();c=c||{};c.RichTextCodeMirrorAdapter=c.Client;c=c||{};c.Formatting=function(){function a(b){if(!(this instanceof a))return new a(b);this.attributes=b||
{}}const b=c.AttributeConstants;a.prototype.cloneWithNewAttribute_=function(b,c){const f={};for(const a in this.attributes)f[a]=this.attributes[a];!1===c?delete f[b]:f[b]=c;return new a(f)};a.prototype.bold=function(a){return this.cloneWithNewAttribute_(b.BOLD,a)};a.prototype.italic=function(a){return this.cloneWithNewAttribute_(b.ITALIC,a)};a.prototype.underline=function(a){return this.cloneWithNewAttribute_(b.UNDERLINE,a)};a.prototype.strike=function(a){return this.cloneWithNewAttribute_(b.STRIKE,
a)};a.prototype.font=function(a){return this.cloneWithNewAttribute_(b.FONT,a)};a.prototype.fontSize=function(a){return this.cloneWithNewAttribute_(b.FONT_SIZE,a)};a.prototype.color=function(a){return this.cloneWithNewAttribute_(b.COLOR,a)};a.prototype.backgroundColor=function(a){return this.cloneWithNewAttribute_(b.BACKGROUND_COLOR,a)};return a}();c=c||{};c.Text=function(){function a(b,f){if(!(this instanceof a))return new a(b,f);this.text=b;this.formatting=f||c.Formatting()}return a}();c.LineFormatting=
d.LineFormatting;c.Line=function(){function a(b,f){if(!(this instanceof a))return new a(b,f);"[object Array]"!==Object.prototype.toString.call(b)&&(b="undefined"===typeof b?[]:[b]);this.textPieces=b;this.formatting=f||c.LineFormatting()}return a}();c.ParseHtml=d.ParseHtml;c.SerializeHtml=d.SerializeHtml;c.textPiecesToInserts=function(a,b){function f(b,f){b instanceof c.Text&&(f=b.formatting.attributes,b=b.text);k.push({string:b,attributes:f});a="\n"===b[b.length-1]}function d(b){a&&f(c.sentinelConstants.LINE_SENTINEL_CHARACTER,
b.formatting.attributes);for(let a=0;a<b.textPieces.length;a++)f(b.textPieces[a]);f("\n")}const k=[];for(let a=0;a<b.length;a++)b[a]instanceof c.Line?d(b[a]):f(b[a]);return k};c=c||{};c.Vceditor=function(a){function b(a,c,g,k){if(!(this instanceof b))return new b(a,c,g,k);if(!v&&!B)throw Error("Couldn't find CodeMirror or ACE.  Did you forget to include codemirror.js or ace.js?");if(v&&c instanceof v)this.codeMirror_=this.editor_=c,a=this.codeMirror_.getValue(),""!==a&&console.log("Can't initialize Vceditor with a CodeMirror instance that already contains text.");
else if(B&&c&&c.session instanceof B.EditSession){if(this.ace_=this.editor_=c,a=this.ace_.getValue(),""!==a)throw Error("Can't initialize Vceditor with an ACE instance that already contains text.");}else this.codeMirror_=this.editor_=new v(c);a=this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_.container;this.vcEditorWrapper_=p.elt("div",null,{class:"vceditor"});a.parentNode.replaceChild(this.vcEditorWrapper_,a);this.vcEditorWrapper_.appendChild(a);p.on(a,"dragstart",p.stopEvent);this.editor_.vceditor=
this;this.options_=g||{};this.getOption("richTextShortcuts",!1)&&(v.keyMap.richtext||this.initializeKeyMap_(),this.codeMirror_.setOption("keyMap","richtext"),this.vcEditorWrapper_.className+=" vceditor-richtext");this.imageInsertionUI=this.getOption("imageInsertionUI",!0);this.getOption("richTextToolbar",!1)&&(this.addToolbar_(),this.vcEditorWrapper_.className+=" vceditor-richtext vceditor-with-toolbar");this.addPoweredByLogo_();this.codeMirror_&&this.codeMirror_.refresh();this.getOption("userColor",
f("JqrwCaZm29-CLg-Pfz2"));this.entityManager_=new t;({revision:a}=k);c=[];this.codeMirror_?(this.richTextCodeMirror_=new n(this.codeMirror_,this.entityManager_,{cssPrefix:"vceditor-"}),this.editorAdapter_=new m(this.richTextCodeMirror_)):this.editorAdapter_=new r(this.ace_);g.hasOwnProperty("richTextToolbar")?(virtualclass.editorRich.vcAdapter=new otAdapter(k,"EditorRich"),virtualclass.editorRich.cmClient=new z(a,c,virtualclass.editorRich.vcAdapter,this.editorAdapter_)):(virtualclass.editorCode.vcAdapter=
new otAdapter(k,"EditorCode"),virtualclass.editorCode.cmClient=new z(a,c,virtualclass.editorCode.vcAdapter,this.editorAdapter_));"Microsoft Internet Explorer"==navigator.appName&&navigator.userAgent.match(/MSIE 8\./)&&(d.onload=function(){const a=document.getElementsByTagName("head")[0],b=document.createElement("style");b.type="text/css";b.styleSheet.cssText=":before,:after{content:none !important;}";a.appendChild(b);setTimeout(()=>{a.removeChild(b)},0)})}function f(a){let b=1;for(let c=0;c<a.length;c++)b=
17*(b+a.charCodeAt(c))%360;return k(b/360,1,.85)}function g(a,b,c){function f(a){a=Math.round(255*a).toString(16);return 1===a.length?`0${a}`:a}return`#${f(a)}${f(b)}${f(c)}`}function k(a,b,c){if(0===b)return g(c,c,c);const f=.5>c?c*(1+b):c+b-b*c,d=2*c-f;b=function(a){0>a&&(a+=1);1<a&&--a;return 1>6*a?d+6*(f-d)*a:1>2*a?f:2>3*a?d+6*(f-d)*(2/3-a):d};return g(b(a+1/3),b(a),b(a-1/3))}if(!c.RichTextCodeMirrorAdapter)throw Error("Oops! It looks like you're trying to include lib/vceditor.js directly.  This is actually one of many source files that make up vceditor.  You want dist/vceditor.js instead.");
const {RichTextCodeMirrorAdapter:m}=c,{RichTextCodeMirror:n}=c,{RichTextToolbar:q}=c,{ACEAdapter:r}=c,{EditorClient:z}=c,{EntityManager:t}=c,u=c.AttributeConstants,{utils:p}=c,{CodeMirror:v}=a,{ace:B}=a;p.makeEventEmitter(b);b.fromCodeMirror=b;b.fromACE=b;b.prototype.dispose=function(){this.zombie_=!0;const a=this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_.container;this.vcEditorWrapper_.removeChild(a);this.vcEditorWrapper_.parentNode.replaceChild(a,this.vcEditorWrapper_);this.editor_.vceditor=
null;this.codeMirror_&&"richtext"===this.codeMirror_.getOption("keyMap")&&this.codeMirror_.setOption("keyMap","default");this.vcAdapter.dispose();this.editorAdapter_.detach();this.richTextCodeMirror_&&this.richTextCodeMirror_.detach()};b.prototype.setUserId=function(a){this.vcAdapter.setUserId(a)};b.prototype.setUserColor=function(a){this.vcAdapter.setColor(a)};b.prototype.getText=function(){this.assertReady_("getText");return this.codeMirror_?this.richTextCodeMirror_.getText():this.ace_.getSession().getDocument().getValue()};
b.prototype.setText=function(a){if(this.ace_)return this.ace_.getSession().getDocument().setValue(a);this.codeMirror_.getWrapperElement().setAttribute("style","display: none");this.codeMirror_.setValue("");this.insertText(0,a);this.codeMirror_.getWrapperElement().setAttribute("style","");this.codeMirror_.refresh()};b.prototype.insertTextAtCursor=function(a){this.insertText(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),a)};b.prototype.insertText=function(a,b){p.assert(!this.ace_,"Not supported for ace yet.");
this.assertReady_("insertText");"[object Array]"!==Object.prototype.toString.call(b)&&(b=[b]);b=c.textPiecesToInserts(0===a,b);for(let c=0;c<b.length;c++){const {string:f}=b[c],{attributes:d}=b[c];this.richTextCodeMirror_.insertText(a,f,d);a+=f.length}};b.prototype.getOperationForSpan=function(a,b){const f=this.richTextCodeMirror_.getRange(a,b);a=this.richTextCodeMirror_.getAttributeSpans(a,b);b=0;const d=new c.TextOperation;for(let c=0;c<a.length;c++)d.insert(f.substr(b,a[c].length),a[c].attributes),
b+=a[c].length;return d};b.prototype.getHtml=function(){return this.getHtmlFromRange(null,null)};b.prototype.getHtmlFromSelection=function(){var a=this.codeMirror_.getCursor("start"),b=this.codeMirror_.getCursor("end");a=this.codeMirror_.indexFromPos(a);b=this.codeMirror_.indexFromPos(b);return this.getHtmlFromRange(a,b)};b.prototype.getHtmlFromRange=function(a,b){a=null!=a&&null!=b?this.getOperationForSpan(a,b):this.getOperationForSpan(0,this.codeMirror_.getValue().length);return c.SerializeHtml(a,
this.entityManager_)};b.prototype.insertHtml=function(a,b){b=c.ParseHtml(b,this.entityManager_);this.insertText(a,b)};b.prototype.insertHtmlAtCursor=function(a){this.insertHtml(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),a)};b.prototype.setHtml=function(a){a=c.ParseHtml(a,this.entityManager_);this.setText(a)};b.prototype.isHistoryEmpty=function(){this.assertReady_("isHistoryEmpty");return this.vcAdapter.isHistoryEmpty()};b.prototype.bold=function(){this.richTextCodeMirror_.toggleAttribute(u.BOLD);
this.codeMirror_.focus()};b.prototype.italic=function(){this.richTextCodeMirror_.toggleAttribute(u.ITALIC);this.codeMirror_.focus()};b.prototype.underline=function(){this.richTextCodeMirror_.toggleAttribute(u.UNDERLINE);this.codeMirror_.focus()};b.prototype.strike=function(){this.richTextCodeMirror_.toggleAttribute(u.STRIKE);this.codeMirror_.focus()};b.prototype.fontSize=function(a){this.richTextCodeMirror_.setAttribute(u.FONT_SIZE,a);this.codeMirror_.focus()};b.prototype.font=function(a){this.richTextCodeMirror_.setAttribute(u.FONT,
a);this.codeMirror_.focus()};b.prototype.color=function(a){this.richTextCodeMirror_.setAttribute(u.COLOR,a);this.codeMirror_.focus()};b.prototype.highlight=function(){this.richTextCodeMirror_.toggleAttribute(u.BACKGROUND_COLOR,"rgba(255,255,0,.65)");this.codeMirror_.focus()};b.prototype.align=function(a){if("left"!==a&&"center"!==a&&"right"!==a)throw Error('align() must be passed "left", "center", or "right".');this.richTextCodeMirror_.setLineAttribute(u.LINE_ALIGN,a);this.codeMirror_.focus()};b.prototype.orderedList=
function(){this.richTextCodeMirror_.toggleLineAttribute(u.LIST_TYPE,"o");this.codeMirror_.focus()};b.prototype.unorderedList=function(){this.richTextCodeMirror_.toggleLineAttribute(u.LIST_TYPE,"u");this.codeMirror_.focus()};b.prototype.todo=function(){this.richTextCodeMirror_.toggleTodo();this.codeMirror_.focus()};b.prototype.newline=function(){this.richTextCodeMirror_.newline()};b.prototype.deleteLeft=function(){this.richTextCodeMirror_.deleteLeft()};b.prototype.deleteRight=function(){this.richTextCodeMirror_.deleteRight()};
b.prototype.indent=function(){this.richTextCodeMirror_.indent();this.codeMirror_.focus()};b.prototype.unindent=function(){this.richTextCodeMirror_.unindent();this.codeMirror_.focus()};b.prototype.undo=function(){this.codeMirror_.undo()};b.prototype.redo=function(){this.codeMirror_.redo()};b.prototype.insertEntity=function(a,b,c){this.richTextCodeMirror_.insertEntityAtCursor(a,b,c)};b.prototype.insertEntityAt=function(a,b,c,f){this.richTextCodeMirror_.insertEntityAt(a,b,c,f)};b.prototype.registerEntity=
function(a,b){this.entityManager_.register(a,b)};b.prototype.getOption=function(a,b){return a in this.options_?this.options_[a]:b};b.prototype.assertReady_=function(a){if(!this.ready_)throw Error(`You must wait for the "ready" event before calling ${a}.`);if(this.zombie_)throw Error("You can't use a Vceditor after calling dispose()!");};b.prototype.makeImageDialog_=function(){this.makeDialog_("img",virtualclass.lang.getString("InsertimageURL"))};b.prototype.makeDialog_=function(a,b){const c=this;
b=p.elt("input",null,{class:"vceditor-dialog-input",id:a,type:"text",placeholder:b,autofocus:"autofocus"});var f=p.elt("a","Submit",{class:"vceditor-btn",id:"submitbtn"});p.on(f,"click",p.stopEventAnd(function(){const b=document.getElementById("overlay");b.style.visibility="hidden";const f=document.getElementById(a).value;f&&c.insertEntity(a,{src:f});c.vcEditorWrapper_.removeChild(b)}));const d=p.elt("a","Cancel",{class:"vceditor-btn"});p.on(d,"click",p.stopEventAnd(function(){const a=document.getElementById("overlay");
a.style.visibility="hidden";c.vcEditorWrapper_.removeChild(a)}));f=p.elt("div",[f,d],{class:"vceditor-btn-group"});b=p.elt("div",[b,f],{class:"vceditor-dialog-div"});b=p.elt("div",[b],{class:"vceditor-dialog",id:"overlay"});this.vcEditorWrapper_.appendChild(b)};b.prototype.addToolbar_=function(){this.toolbar=new q(this.imageInsertionUI);this.toolbar.on("undo",this.undo,this);this.toolbar.on("redo",this.redo,this);this.toolbar.on("bold",this.bold,this);this.toolbar.on("italic",this.italic,this);this.toolbar.on("underline",
this.underline,this);this.toolbar.on("strike",this.strike,this);this.toolbar.on("font-size",this.fontSize,this);this.toolbar.on("font",this.font,this);this.toolbar.on("color",this.color,this);this.toolbar.on("left",function(){this.align("left")},this);this.toolbar.on("center",function(){this.align("center")},this);this.toolbar.on("right",function(){this.align("right")},this);this.toolbar.on("ordered-list",this.orderedList,this);this.toolbar.on("unordered-list",this.unorderedList,this);this.toolbar.on("todo-list",
this.todo,this);this.toolbar.on("indent-increase",this.indent,this);this.toolbar.on("indent-decrease",this.unindent,this);this.toolbar.on("insert-image",this.makeImageDialog_,this);this.vcEditorWrapper_.insertBefore(this.toolbar.element(),this.vcEditorWrapper_.firstChild)};b.prototype.addPoweredByLogo_=function(){};b.prototype.initializeKeyMap_=function(){function a(a){return function(b){setTimeout(()=>{a.call(b.vceditor)},0)}}this.getOption("readOnly")?v.keyMap.richtext={fallthrough:["default"]}:
v.keyMap.richtext={"Ctrl-B":a(this.bold),"Cmd-B":a(this.bold),"Ctrl-I":a(this.italic),"Cmd-I":a(this.italic),"Ctrl-U":a(this.underline),"Cmd-U":a(this.underline),"Ctrl-H":a(this.highlight),"Cmd-H":a(this.highlight),Enter:a(this.newline),Delete:a(this.deleteRight),Backspace:a(this.deleteLeft),Tab:a(this.indent),"Shift-Tab":a(this.unindent),fallthrough:["default"]}};return b}(d);c.Vceditor.Formatting=c.Formatting;c.Vceditor.Text=c.Text;c.Vceditor.Entity=c.Entity;c.Vceditor.LineFormatting=c.LineFormatting;
c.Vceditor.Line=c.Line;c.Vceditor.TextOperation=c.TextOperation;c.Vceditor.RichTextCodeMirrorAdapter=c.RichTextCodeMirrorAdapter;c.Server=Server;c.Vceditor.getvcEditor=function(){return c};return c.Vceditor}(window);window.Vceditor=Vceditor;(function(d){var c=function(a){return a.map(a=>({operation:a.wrapped.toJSON()}))},a=function(a){const b=Vceditor.getvcEditor();return a.map(a=>new b.WrappedOperation(b.TextOperation.fromJSON(a.operation),a.cursor&&b.Cursor.fromJSON(a.cursor)))};d.editor=function(b,f,d){this.etype=b;if("editorRich"==b)var g={lineWrapping:!0},m={richTextToolbar:!0,richTextShortcuts:!0,readOnly:!1};else g={lineNumbers:!0,mode:"markdown",readOnly:!1},m={defaultText:"Markdown Editor "};return{etype:b,cm:"",vcAdapter:"",
initialised:!1,prvEdRev:0,dataReqTry:0,stroageData:localStorage.getItem(`${this.etype}_allEditorOperations`),tempstroageDataRev:localStorage.getItem(`${this.etype}_edOperationRev`),readonly:!1,veryInit(){if(null!=this.stroageData&&""!=this.stroageData){this.stroageDataRev=null==this.tempstroageDataRev?0:this.tempstroageDataRev;let a=JSON.parse(this.stroageData);a=JSON.parse(a.data);console.log(`Current Editor type ${virtualclass.currAppEditorType}`);virtualclass.hasOwnProperty("currAppEditor")?virtualclass.currAppEditorType==
this.etype?this.initialiseDataWithEditor(a,"displayEditor",virtualclass.currAppEditorType):this.initialiseDataWithEditor(a):this.initialiseDataWithEditor(a)}virtualclass.gObj.editorInitDone++},init(a,b,c,f){const d={};"undefined"!==typeof a&&(d.revision=a);"undefined"!==typeof b&&(d.clients=b);"undefined"!==typeof c&&(d.doc=c);"undefined"!==typeof f&&(d.operations=f);this.cm||"object"===typeof this.cm?virtualclass.dispvirtualclassLayout(virtualclass.currApp):(this.codemirrorWithLayout(g),this.createEditorClient(m,
d));roles.hasControls()?(roles.hasAdmin()&&this.createAllEditorController(),virtualclass.gObj.studentSSstatus.sharing||ioAdapter.mustSendAll({eddata:"init",et:this.etype,cf:"eddata"})):roles.hasAdmin()&&this.createAllEditorController()},createAllEditorController(){const a=this.etype,b=`all${a}Container`;if(null==document.getElementById(b)){console.log("For Enable all, Button is creating");let f;var c=virtualclass.getTemplate("edenableall","editor")({type1:a});document.querySelector(`#virtualclass${virtualclass.vutil.capitalizeFirstLetter(a)}Body`).insertAdjacentHTML("beforeend",
c);c=document.getElementById(`${b}Anch`);const d=localStorage.getItem(`${a}mode`);null!==d&&("editorRich"==a&&"disable"==d||"editorCode"==a&&"disable"==d)&&(c.dataset.action="disable");console.log(`Editor type ${a}`);c.addEventListener("click",()=>{console.log(`Editor type ${a} clicked`);const c=document.getElementById(`${b}Anch`);null!=c&&(f=c.dataset.action,"enable"==c.dataset.action?(c.dataset.action="disable",c.classList.remove("icon-collaboratecrose"),c.classList.add("icon-collaborate"),c.parentNode.setAttribute("data-title",
virtualclass.lang.getString("offcollaboration"))):(c.classList.remove("icon-collaborate"),c.classList.add("icon-collaboratecrose"),c.dataset.action="enable",c.parentNode.setAttribute("data-title",virtualclass.lang.getString("oncollaboration"))));localStorage.setItem(`${a}mode`,c.dataset.action);virtualclass.user.control.toggleAllEditorController.call(virtualclass.user,a,f)})}},removeScrollFromFireFox(a){a=virtualclass.vutil.capitalizeFirstLetter(a);setTimeout(()=>{const b=document.querySelector(`#virtualclass${a}Body .CodeMirror-vscrollbar`),
c=document.querySelector(`#virtualclass${a}Body .CodeMirror`),f=document.querySelector(`#virtualclass${a}Body .CodeMirror-code`);b.style.display=f.offsetHeight>c.offsetHeight-25?"block":""},20)},createEditorClient(a,b){roles.hasAdmin()&&(this.cm.setOption("readOnly",!1),this.createAllEditorController(),a.readOnly=!1);virtualclass.isPlayMode&&(this.readOnlyMode("enable","notCreateSyncBox"),this.cm.setOption("readOnly","nocursor"));Vceditor.fromCodeMirror({},this.cm,a,b);"Firefox"==virtualclass.system.mybrowser.detection()[0]&&
this.removeScrollFromFireFox(this.etype)},disableEditorByOuterLayer(){const a=document.querySelector(`#virtualclass${virtualclass.vutil.capitalizeFirstLetter(this.etype)}Body .CodeMirror.cm-s-default`);null!=a&&(a.style.pointerEvents="none");console.log("Disable editor for ios")},enableEditorByOuterLayer(){const a=document.querySelector(`#virtualclass${virtualclass.vutil.capitalizeFirstLetter(this.etype)}Body .CodeMirror.cm-s-default`);null!=a&&(a.style.pointerEvents="visible");console.log("Enable editor for ios")},
codemirrorWithLayout(a){this.UI.container(this.etype);document.getElementById(this.UI.edId);"object"!==typeof this.cm&&(console.log("Code mirror instance is created "),this.cm=CodeMirror(document.getElementById(this.UI.edId),a))},requestData(){const a=virtualclass.vutil.whoIsTeacher();this.readOnlyMode("enable");ioAdapter.mustSendUser({eddata:"requestForEditorData",et:this.etype,cf:"eddata"},a)},readOnlyMode(a,b){"object"===typeof this.cm&&("enable"==a?this.readonly||(this.cm.setOption("readOnly",
"nocursor"),"undefined"===typeof b&&this.UI.createSynchMessageBox(),this.readonly="nocursor"):this.readonly&&!virtualclass.isPlayMode&&(this.cm.setOption("readOnly",!1),this.readonly=!1,this.UI.hideSynchMessageBox()),virtualclass.vutil.setReadModeWhenTeacherIsDisConn(virtualclass.vutil.smallizeFirstLetter(this.etype)))},isVcAdapterIsReady(a){return virtualclass[a].hasOwnProperty("vcAdapter")&&"object"===typeof virtualclass[a].vcAdapter},receivedOperations:{currAppEditor(a){a.fromUser.userid!=virtualclass.gObj.userid&&
(console.log("curr app editor"),virtualclass.currAppEditor=!0,virtualclass.currAppEditorType=a.message.et,virtualclass.dispvirtualclassLayout(virtualclass.currAppEditorType))},init(a,b){"s"==a.fromUser.role||a.fromUser.userid==virtualclass.gObj.uid&&"1"!=wbUser.virtualclassPlay||virtualclass.makeAppReady(b)},initVcEditor(a){console.log("received whole data");roles.hasView()&&"function"===typeof virtualclass[a.message.et].vcAdapter.removeOperations&&virtualclass[a.message.et].vcAdapter.removeOperations(a);
if(!roles.hasControls()||roles.hasControls()&&a.fromUser.userid!=virtualclass.gObj.uid&&(a.message.hasOwnProperty("resFromUser")||a.message.hasOwnProperty("allEdData"))){const b=JSON.parse(a.message.data);a.message.hasOwnProperty("layoutEd")?this.initialiseDataWithEditor(b,a.message):this.initialiseDataWithEditor(b)}},requestForEditorData(a){a.fromUser.userid!=virtualclass.gObj.uid?"object"!==typeof this.vcAdapter||0==this.vcAdapter.operations.length?ioAdapter.mustSendAll({eddata:"noDataForEditor",
cf:"eddata"}):this.responseToRequest(a.fromUser.userid):console.log("Cannot send requestForEditorData to self")},noDataForEditor(){roles.hasControls()},"virtualclass-editor-operation":function(a){"object"===typeof this.vcAdapter&&(this.readOnlyMode("disable"),this.vcAdapter.receivedMessage(a))},"virtualclass-editor-cursor":function(a){"object"===typeof this.vcAdapter&&this.vcAdapter.receivedMessage(a)},select(){"object"===typeof this.vcAdapter&&this.vcAdapter.receivedMessage(e)}},onmessage(a,b){this.receivedOperations[a.message.eddata].call(this,
a,b);"object"!==typeof this.vcAdapter&&(roles.hasAdmin()&&"virtualclass-editor-operation"==a.message.eddata&&(virtualclass.makeAppReady(b),this.vcAdapter.receivedMessage(a,onmessage)),console.log("virtualclass adapter is not ready for editor"))},UI:{id:f,class:"vmApp virtualclass",edId:d,container(a){null==document.getElementById(this.id)&&(a=virtualclass.getTemplate("editorrich","editor")({type:virtualclass.vutil.capitalizeFirstLetter(a),class:a}),virtualclass.vutil.insertAppLayout(a))},createSynchMessageBox(){if(null!=
document.getElementById("synchMessageBox"))this.showSynchMessageBox();else{const a=virtualclass.getTemplate("messagebox","editor")();document.getElementById(this.id).insertAdjacentHTML("afterbegin",a)}},showSynchMessageBox(){const a=document.getElementById("synchMessageBox");null!=a&&(a.style.display="block")},hideSynchMessageBox(){const a=document.getElementById("synchMessageBox");null!=a&&(a.style.display="none")}},responseToRequest(a){const b=this.getWrappedOperations(!0);b.layoutEd="1";roles.isTeacher()&&
(b.capp=virtualclass.currApp);b.et=this.etype;a?(b.resFromUser=!0,ioAdapter.mustSendUser(b,a),console.log(`Sending responseToRequest to ${a}`)):(b.allEdData=!0,ioAdapter.mustSend(b),console.log("Sending responseToRequest to all"),virtualclass[b.et].vcAdapter.removeOperations({message:{et:b.et}}),a=JSON.parse(b.data),virtualclass[b.et].initialiseDataWithEditor(a),virtualclass[b.et].vcAdapter.myOTrequestData=0)},isEidtorWithTeacher(){return roles.hasControls()&&("EditorRich"==virtualclass.currApp||
"EditorCode"==virtualclass.currApp)},getWrappedOperations(a){a=this.vcAdapter&&this.vcAdapter.operations?c(this.vcAdapter.operations):[];return{eddata:"initVcEditor",data:JSON.stringify({operations:a}),et:this.etype,cf:"eddata"}},getStudentAllText(){return this.cm.getValue("\n")},removeCodeMirror(){this.readonly=!1;const a=document.getElementById(this.UI.id);null!=a&&a.parentNode.removeChild(a);this.cm=""},setReadMode(){var a=JSON.parse(localStorage.getItem(this.etype));roles.hasAdmin()||(null!=a?
a?(this.cm.setOption("readOnly",!1),a=!0):(this.cm.setOption("readOnly","nocursor"),a=!1):(this.cm.setOption("readOnly","nocursor"),a=!1),virtualclass.user.control.toggleDisplayWriteModeMsgBox(virtualclass.vutil.capitalizeFirstLetter(this.etype),a),virtualclass.vutil.setReadModeWhenTeacherIsDisConn(virtualclass.vutil.smallizeFirstLetter(this.etype)),"iOS"==virtualclass.system.mybrowser.name&&virtualclass.system.isIPad()&&(a?this.enableEditorByOuterLayer():this.disableEditorByOuterLayer()))},writeBulkDocs(b){const c=
a(b.operations);b.revision=0;if(this.cm){if(this.cm.getValue()!==b.str||""==b.str)this.vcAdapter=this.cmClient="",b.operations=[],b.doc="";this.createEditorClient(m,b);this.prvEdRev=b.revision}for(b=0;b<c.length;b++)virtualclass[this.etype].vcAdapter.server.receiveOperation(b,c[b]),this.vcAdapter.trigger("operation",c[b].wrapped.toJSON())},initialiseDataWithEditor(b,c){a(b.operations);"undefined"!==typeof c&&c.hasOwnProperty("capp")&&(virtualclass.currApp=virtualclass.vutil.capitalizeFirstLetter(c.capp));
this.removeCodeMirror();this.codemirrorWithLayout(g);virtualclass.dispvirtualclassLayout(virtualclass.currApp);this.writeBulkDocs(b);this.cm.refresh();this.setReadMode();b=virtualclass.vutil.capitalizeFirstLetter(virtualclass.currApp);"EditorRich"==b||"EditorCode"==b?(virtualclass.previous=`virtualclass${virtualclass.currApp}`,virtualclass.system.setAppDimension(virtualclass.currApp)):(b=document.getElementById("virtualclassEditorRich"),null!=b&&(b.style.display="none"),b=document.getElementById("virtualclassEditorCode"),
null!=b&&(b.style.display="none"));b=document.getElementById("virtualclassEditorTool");null!=b&&(b.style.pointerEvents="visible");otAdapter.myrequestData=0},removeEditorData(){"object"===typeof this.cm&&("object"===typeof this.vcAdapter&&(this.vcAdapter.operations.length=0),this.removeCodeMirror(),localStorage.removeItem(`${this.etype}_allEditorOperations`),localStorage.removeItem(`${this.etype}_edOperationRev`))},saveIntoLocalStorage(){if("object"===typeof this.vcAdapter&&0<this.vcAdapter.operations.length){const a=
this.getWrappedOperations();localStorage.removeItem(`${this.etype}_allEditorOperations`);localStorage.setItem(`${this.etype}_allEditorOperations`,JSON.stringify(a));localStorage.setItem(`${this.etype}_edOperationRev`,this.cmClient.revision)}},undoManager(a){setTimeout(()=>{90==a?document.querySelector(".vceditor-tb-undo").parentNode.click():89==a&&document.querySelector(".vceditor-tb-redo").parentNode.click()},0)}}}})(window);(function(d,c){d.Chat=function(){let a;return{userList:[],init(){this.chatroombox=null;this.chatWindow="private";this.counter=0;this.idList=[];this.commonChat=[];c.htab=[];c.htabIndex=[];this.vmstorage={};c("body").footerbar();"false"==localStorage.getItem("init")&&(c("#stickybar").removeClass("maximize").addClass("minimize"),c("#hide_bar input").removeClass("close").addClass("expand"));a=c("#tabs").tabs({cache:!0,activeOnAdd:!0});0==browserSupportsLocalStorage()?alert(lang.sterror):(this.history(),
this.UI.privateChatBox.init(),c("ul.tabs").on("click, focus","li",function(){c(`li[aria-controls='${c(this).attr("id")}']`).removeClass("ui-state-highlight")}),console.log("chat local storage start "),roles.isStudent()&&(virtualclass.settings.studentpc(virtualclass.settings.info.studentpc),virtualclass.settings.studentgc(virtualclass.settings.info.studentgc)))},fetchChatUsers(){console.log("FetchUser congrea_get_enrolled_users");const a=new FormData;a.append("action","fetchUser");virtualclass.xhr.vxhr.post(`${d.webapi}&user=${virtualclass.gObj.uid}&methodname=congrea_get_enrolled_users`,
a).then(a=>{virtualclass.chat.userList=a.data;updateOnlineUserText()}).catch(a=>{console.error("Request failed with error ",a)})},setChatDisplay(){const a=document.querySelector("#virtualclassCont.congrea  #ta_chrm2");var c=document.querySelector("#virtualclassCont.congrea #congreaUserSearch"),d=localStorage.getItem("chatWindow");if(null!=d&&"common"==d)if(virtualclass.chat.chatWindow="common",d=document.getElementById("chatrm")){d.classList.add("enable");d.classList.remove("disable");document.getElementById("chatroom_bt2").classList.add("active");
if(d=document.getElementById("memlist"))d.classList.remove("enable"),d.classList.contains("disable")||d.classList.add("disable"),d=document.getElementById("user_list"),d.classList.remove("active");if(c=document.querySelector("#virtualclassCont.congrea #congreaUserSearch"))c.style.display="none"}else{if(d=document.getElementById("memlist"))d.classList.add("enable"),d.classList.remove("disable"),d=document.getElementById("user_list"),d.classList.add("active")}else if(null!=d&&"support"==d)(d=document.getElementById("congreaSupport"))&&
d.classList.add("active");else{if(d=document.getElementById("memlist"))d.classList.add("enable"),d=document.getElementById("user_list"),d.classList.add("active"),virtualclass.chat.chatWindow="private";a&&(a.style.display="none")}document.querySelector("#virtualclassCont.congrea  .vmchat_bar_button").classList.contains("active")?(a&&(a.style.display="none"),c&&(c.style.display="block")):(a&&(a.style.display="block"),c&&(c.style.display="none"))},showChatListUsers(){const a=virtualclass.chat.userList;
0<a.length&&(this._showChatUserList(a),displayChatOfflineUserList(a),document.querySelector("div#memlist").classList.add("enable"))},_showChatUserList(a){if(!document.getElementById("chat_div")){const a=document.createElement("div");a.id="chat_div";document.body.appendChild(a)}c("#chat_div").memberlist({id:"chat_div",user:a,offset:"-1px",title:lang.online,userSent(a){return c("#chat_div").memberlist("option","boxManager").addUsr(a)}})},history(){var a=null;null!=localStorage.getItem(wbUser.sid)&&
(a=JSON.parse(localStorage.getItem(wbUser.sid)),displayPvtChatHistory(a),a=localStorage.getItem("chatEnable"),null!=a&&"false"==a&&virtualclass.user.control.disbaleAllChatBox(),this.vmstorage=JSON.parse(localStorage.getItem(wbUser.sid)));0<localStorage.length&&(displaycomChatHistory(),virtualclass.chat.removeChatHighLight("chatrm"),null!=a&&"false"==a&&virtualclass.user.control.disableCommonChat())},exportCommonChat(a){const b=[],c=virtualclass.chat.commonChat;for(let f=0;f<c.length;f++)a<=c[f].time&&
b.push(c[f]);return b},UI:{privateChatBox:{init(){c("#tabs").delegate("span.icon-close","click",this.close);c("#tabs").on("click","li a",this.toggle)},close(){var a=c(this).closest("li").attr("id").substring(5);c(`#${a}`).chatbox("option").boxClosed(a);c(`div#cb${a}.ui-widget`).hide();a=c(this).closest("li").remove().attr("aria-controls");c(`#${a}`).remove()},toggle(){const a=c(this).closest("li").attr("id").substring(5);c(`#${a}`).chatbox("toggleContentbox");"hidden"==localStorage.getItem(a)?localStorage.removeItem(a):
localStorage.setItem(a,"hidden")}}},removedPrvLoggedInDetail(){c(".ui-memblist").remove();c(".ui-chatbox").remove();c("div#chatrm").remove();virtualclass.chat.chatroombox=null;console.log("Chat box is  null");for(const a in io.uniquesids)a!=io.cfg.userid&&(chatboxManager.delBox(a),c(`li#tabcb${a}`).remove());this.idList=0;c("#stickybar").removeClass("maximize").addClass("minimize");a.tabs("refresh")},removeCookieUserInfo(a){document.cookie="auth_user=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";
document.cookie="auth_pass=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";document.cookie="path=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";display_error(a.message)},makeUserListEmpty(){c("#user_list .inner_bt #usertab_icon").css({background:`url(${d.whiteboardPath}images/offline.png)no-repeat top left`});c("#chatroom_bt .inner_bt #chatroom_text").text(`${lang.chatroom} (0)`);c("div#memlist").removeClass("enable")},removeChatHighLight(a){if(virtualclass.gObj.hasOwnProperty("testChatDiv")){a=
chatContainerEvent.elementFromShadowDom(".ui-state-highlight","all");for(let b=0;b<a.length;b++)a[b].classList.remove("ui-state-highlight")}},openChatBox(){const a=document.querySelector("#memlist");null!=a&&(0<a.offsetWidth||0<a.offsetHeight||c("#chat_div").memberlist("option","boxManager").toggleBox())},enableTechSupport(a){const b=document.querySelector("#congreaSupport");b.setAttribute("data-tsid",a);b.classList.remove("notavailable");b.classList.add("available")},disableTechSupport(a){const b=
document.querySelector("#congreaSupport");b.classList.add("notavailable");b.classList.remove("available");a=document.querySelector(`#tabcb${a} .icon-close`);null!=a&&a.click()},isTechSupportExist(a){const b=document.querySelector("#congreaSupport");if(null!=b)return+b.dataset.tsid==+a},removeCommonChatNodes(){const a=document.getElementById("chat_room");if(null!==a)for(;a.firstChild;)a.removeChild(a.firstChild)}}}})(window,$);(function(d){d.widget("ui.footerbar",{options:{id:null,offset:0,width:"100%",barscroll:d(window).width()-430,supportId:"7",boxClosed(c){}},init(c){this.elem=c},widget(){return this.uiFooterbar},_create(){function c(){const b=[];virtualclass.connectedUsers.forEach(a=>{a.userid!=virtualclass.gObj.uid&&(a={id:a.userid,name:a.name.toLowerCase()},b.push(a))});const c=document.getElementById("congreaUserSearch").value;a(b,c.toLowerCase())}function a(a,b){a.forEach((a,c)=>{c=chatContainerEvent.elementFromShadowDom(`ml${a.id}`,
null,!0);-1!=a.name.indexOf(b)?c.style.display="block":c.style.display="none"})}const b=roles.hasAdmin(),f=virtualclass.getTemplate("stickycont","chat");d("#stickycontainer").append(f({control:b}));const g=document.getElementById("chatroom_bt2"),k=document.getElementById("user_list"),m=document.querySelector("#appSettingCtrl"),n=document.querySelector("#virtualclassCont.congrea #appSettingDetail"),q=document.querySelector("#virtualclassCont.congrea #chatWidget");d("#chatroom_bt2 .inner_bt").click(()=>
{document.querySelector("#chatwidget .vmchat_room_bt");g.classList.add("active");k.classList.remove("active");m.classList.contains("settingActive")&&(m.classList.remove("settingActive"),m.classList.add("chatActive"));q.classList.remove("deactive");q.classList.contains("active")||q.classList.add("active");n.classList.remove("active");n.classList.contains("deactive")||n.classList.add("deactive");d("#chatroom_bt2").removeClass("ui-state-highlight");virtualclass.chat.chatWindow="common";if(0==d("ul#chat_room").length){var a=
document.createElement("ul");a.id="chat_room";document.body.appendChild(a);virtualclass.chat.chatroombox=d("#chat_room").chatroom({id:"chat_room",user:{name:"test"},title:lang.chatroom_header,messageSent(a,b){const c=a.userid||virtualclass.gObj.uid;d("#chat_room").chatroom("option","boxManager").addMsg(a.name,b,c)}});virtualclass.gObj.hasOwnProperty("chatEnable")&&!virtualclass.gObj.chatEnable&&(a=document.getElementById("chatrm"),null!=a&&virtualclass.user.control.makeElemDisable(a))}if(a=document.getElementById("ta_chrm2"))a.style.display=
"block";if(a=document.getElementById("memlist"))a.classList.remove("enable"),a.classList.contains("disable")||a.classList.add("disable");if(a=document.getElementById("congreaUserSearch"))a.style.display="none";if(a=document.getElementById("chatrm"))a.classList.contains("enable")||a.classList.add("enable"),a.classList.remove("disable")});d("#user_list").click(function(){g.classList.remove("active");k.classList.add("active");var a=document.getElementById("appSettingCtrl");const b=document.getElementById("chatWidget"),
c=document.getElementById("appSettingDetail");a.classList.contains("settingActive")&&(a.classList.remove("settingActive"),a.classList.add("chatActive"));b.classList.remove("deactive");b.classList.contains("active")||b.classList.add("active");c.classList.remove("active");c.classList.contains("deactive")||c.classList.add("deactive");virtualclass.chat.chatWindow="private";this.classList.add("active");if(a=document.getElementById("chatrm"))a.classList.remove("enable"),a.classList.contains("disable")||
a.classList.add("disable");if(a=document.getElementById("ta_chrm2"))a.style.display="none";if(a=document.getElementById("congreaUserSearch"))a.style.display="block";if(a=document.getElementById("memlist"))a.classList.remove("disable"),a.classList.contains("enable")||a.classList.add("enable")});d("#congreaUserSearch").keyup(function(){c(this.value)});this._setWidth(this.options.width);this.init(this)},destroy(){this.element.remove();this._destroy()},_setWidth(c){}})})(jQuery);
(function(d){d.fn.clickToggle=function(c,a){const b=[c,a];this.data("toggleclicked",0);this.click(function(){const a=d(this).data(),c=a.toggleclicked;d.proxy(b[c],this)();a.toggleclicked=(c+1)%2});return this}})(jQuery);(function(d){let c;d.widget("ui.memberlist",{options:{id:null,title:null,user:null,hidden:!1,offset:0,width:320,userSent(a){"7"!=a.userid&&this.boxManager.addUsr(a.name)},boxClosed(a){},boxManager:{init(a){this.elem=a},addUsr(a){if(null!=chatContainerEvent.elementFromShadowDom(`#ml${a.userid}`))return!0;document.createElement("div");document.createDocumentFragment("div").id="tempId";a.userid!=wbUser.id&&(a.notSelf=!0);roles.hasControls()&&(a.isTeacher=!0);"t"==a.role?a.rl="teacher":"s"==a.role&&(a.rl=
"student");a.chatIconColors=virtualclass.gObj.chatIconColors[a.userid];console.log(`Chat add user ${a.userid}`);return virtualclass.getTemplate("chatuser","chat")({peer:a})},highlightBox(){const a=this;a.elem.uiChatboxTitlebar.effect("highlight",{},300);a.elem.uiChatbox.effect("bounce",{times:3},300,()=>{a.highlightLock=!1;a._scrollToBottom()})},toggleBox(){},_scrollToBottom(){}}},toggleContent(a){this.uiChatboxContent.toggle();this.uiChatboxContent.is(":visible")},widget(){return this.uiChatbox},
_create(){const a=(this.uiChatbox=d("<div></div>")).appendTo(document.getElementById("congreaChatCont")).addClass("ui-widget ui-corner-top ui-memblist").attr("id","memlist");c=(this.uiChatboxContent=d("<div></div>")).addClass("ui-widget-content ui-memblist-content ").appendTo(a);(this.uiChatboxLog=this.element).addClass("ui-widget-content ui-memblist-log").appendTo(c).focusin(function(){const a=d(this).parent().prev();a.scrollTop(a.scrollHeight)});this._setWidth(this.options.width);this._position(this.options.offset);
this.options.boxManager.init(this);roles.hasAdmin()&&(virtualclass.user.mediaSliderUI("audio"),virtualclass.user.mediaSliderUI("video"),virtualclass.user.mediaSliderUI("chat"),virtualclass.user.mediaSliderUI("groupChat"))},_setOption(a,b){if(null!=b)switch(a){case "hidden":b?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(b);break;case "width":this._setWidth(b)}d.Widget.prototype._setOption.apply(this,arguments)},_setWidth(a){this.uiChatboxLog.width(`${a}px`)},_position(a){this.uiChatbox.css("right",
a)}})})(jQuery);(function(d){d.widget("ui.chatbox",{options:{id:null,title:null,user:null,hidden:!1,offset:0,width:230,messageSent(c,a,b){this.boxManager.addMsg(a.name,b)},boxClosed(c){},boxManager:{init(c){this.elem=c},addMsg(c,a){var b=this.elem.uiChatboxLog;const f=document.createElement("div");b.append(f);b=!1;if(c){const a=document.createElement("b");d(a).text(`${c}: `);f.appendChild(a)}else b=!0;c=document.createElement(b?"i":"span");d(c).text(a);f.appendChild(c);d(f).addClass("ui-chatbox-msg");d(f).fadeIn();
this._scrollToBottom();this.elem.uiChatboxTitlebar.hasClass("ui-state-focus")||this.highlightLock||(this.highlightLock=!0,this.highlightBox())},highlightBox(){},toggleBox(){this.elem.uiChatbox.toggle()},_scrollToBottom(){const c=this.elem.uiChatboxLog;c.scrollTop(c.get(0).scrollHeight)}}},toggleContent(c){},toggleContentbox(c){this.uiChatboxContent.is(":visible")?(this.uiChatboxInputBox.focus(),d(d(`#tabs ul li[id = "tabcb${this.options.id}"]`)).removeClass("ui-state-active")):d(d(`#tabs ul li[id="tabcb${this.options.id}"]`)).addClass("ui-state-active");
this.uiChatbox.toggle("slide",{direction:"down"},1E3)},widget(){return this.uiChatbox},_create(){createTab(this.options.id,this.options.title);const c=this;var {options:a}=c,b=a.title||"No Title";const f=(c.uiChatbox=d("<div></div>")).appendTo(document.body).addClass("ui-widget ui-corner-top ui-chatbox").attr("id",`cb${c.options.id}`).focusin(()=>{c.uiChatboxTitlebar.addClass("ui-state-focus")}).focusout(()=>{c.uiChatboxTitlebar.removeClass("ui-state-focus")});a=(c.uiChatboxTitlebar=d("<div></div>")).addClass("ui-widget-header ui-corner-top ui-chatbox-titlebar ui-dialog-header").click(a=>
{}).appendTo(f);(c.uiChatboxTitle=d('<span class="cgText"></span>')).html(b).appendTo(a);var g=(c.uiChatboxTitlebarClose=d('<a href="#"></a>')).addClass("ui-chatbox-icon ").attr("role","button").hover(()=>{g.addClass("ui-state-hover")},()=>{g.removeClass("ui-state-hover")}).click(a=>{delete virtualclass.chat.vmstorage[c.options.id][0].box;f.hide();c.options.boxClosed(c.options.id);d(`#tabcb${c.options.id}`).remove();virtualclass.chat.idList&&virtualclass.chat.idList.length&&(a=virtualclass.chat.idList.indexOf(c.options.id),
-1<a&&virtualclass.chat.idList.splice(a,1));return!1}).appendTo(a);d("<span ></span>").addClass("ui-icon icon-close cgIcon ").text("").appendTo(g);var k=(c.uiChatboxTitlebarMinimize=d('<a href = "#"></a>')).addClass("ui-chatbox-icon").attr("role","button").hover(()=>{k.addClass("ui-state-hover")},()=>{k.removeClass("ui-state-hover")}).click(a=>{c.toggleContentbox(a);"hidden"==localStorage.getItem(c.options.id)?localStorage.removeItem(c.options.id):localStorage.setItem(c.options.id,"hidden");return!1}).appendTo(a);
d("<span></span>").addClass("ui-icon icon-minus").text("").appendTo(k);b=(c.uiChatboxContent=d("<div></div>")).addClass("ui-widget-content ui-chatbox-content ").appendTo(f);(c.uiChatboxLog=c.element).addClass("ui-widget-content ui-chatbox-log").appendTo(b);const m=(c.uiChatboxInput=d("<div></div>")).addClass("ui-widget-content ui-chatbox-input").click(a=>{}).appendTo(b);var n=(c.uiChatboxInputBox=d("<textarea></textarea>")).addClass("ui-widget-content ui-chatbox-input-box ").prop("id",`ta${c.options.id}`).appendTo(m).keypress(function(a){if(a.keyCode&&
a.keyCode==d.ui.keyCode.ENTER){a=d.trim(d(this).val());if(0<a.length){ioAdapter.mustSendUser({msg:a,cf:"msg"},c.options.id);d(`li[aria-controls='tabcb${c.options.id}']`).removeClass("ui-state-highlight");d(this).val("");d(`#${c.options.id}`).chatbox("option").messageSent(c.options.id,{name:io.cfg.userobj.name},a);const b=c.options.id;"undefined"===typeof virtualclass.chat.vmstorage[b]&&(virtualclass.chat.vmstorage[b]=[]);const f=(new Date).getTime();virtualclass.chat.vmstorage[b].push({userid:io.cfg.userid,
name:io.cfg.userobj.name,msg:a,time:f})}return!1}}).focusin(function(){n.addClass("ui-chatbox-input-focus");const a=d(this).parent().prev();a.scrollTop(a.get(0).scrollHeight)}).focusout(()=>{n.removeClass("ui-chatbox-input-focus")});a.find("*").add(a).disableSelection();b.children().click(()=>{c.uiChatboxInputBox.focus()});c._setWidth(c.options.width);c._position(c.options.offset);c.options.boxManager.init(c);c.options.hidden||f.show();d(d(`#tabs ul li[id = "tabcb${c.options.id}"]`)).append(f)},_setOption(c,
a){if(null!=a)switch(c){case "hidden":a?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(a);break;case "width":this._setWidth(a)}d.Widget.prototype._setOption.apply(this,arguments)},_setWidth(c){this.uiChatbox.width(`${c}px`);this.uiChatboxInputBox.css("width",`${c-11}px`)},_position(c){}})})(jQuery);let uiChatboxContent,uiChatboxLog,uiChatboxInputBox,msg;
(function(d){d.widget("ui.chatroom",{options:{id:null,title:null,user:null,hidden:!1,offset:6,width:311,messageSent(c,a){this.boxManager.addMsg(c.name,a)},boxClosed(c){},boxManager:{init(c){this.elem=c},addMsg(c,a,b){"undefined"===typeof virtualclass.gObj.chatIconColors[b]&&groupChatImgColor(c,b);const f=virtualclass.vutil.UTCtoLocalTime(a.time);var {msg:g}=a,k=this.elem.uiChatboxLog;const m=document.createElement("li");m.className="left clearfix";k.append(m);k=document.createElement("div");k.className=
"chat-user-icon pull-left";m.appendChild(k);if(virtualclass.gObj.chatIconColors[b]){k.style.backgroundColor=virtualclass.gObj.chatIconColors[b].bgColor;k.style.color=virtualclass.gObj.chatIconColors[b].textColor;var n=document.createElement("span");n.className="chat-img ";n.innerHTML=virtualclass.gObj.chatIconColors[b].initial}k.appendChild(n);n=!1;b=document.createElement("div");b.className="commonChatCon chat-body clearfix";c?(k=document.createElement("a"),k.className="primary-font",d(k).text(c),
b.appendChild(k)):n=!0;c=document.createElement(n?"i":"p");c.className="text";d(c).text(g);g=document.createElement("span");g.className="text-muted";g.innerHTML=f;b.appendChild(c);b.appendChild(g);m.appendChild(b);b.appendChild(c);m.dataset.msgtime=a.time;d(m).addClass("ui-chatbox-msg");d(m).fadeIn();this._scrollToBottom()},groupChatImgColor(c,a){let b;const f=this.getInitials(c);c=this.stringToHslColor(a.toString()+c,60,35);b=125<virtualclass.vutil.calcBrightness(c)?"black":"white";virtualclass.gObj.chatIconColors[a]=
{bgColor:c,textColor:b,initial:f}},stringToHslColor(c,a,b){let f=0;for(let a=0;a<c.length;a++)f=c.charCodeAt(a)+((f<<5)-f);return`hsl(${f%360}, ${a}%, ${b}%)`},getInitials(c){c=c.split(" ");let a=c[0].substring(0,1).toUpperCase();1<c.length&&(a+=c[c.length-1].substring(0,1).toUpperCase());return a},highlightBox(){this.elem.uiChatboxTitlebar.addClass("ui-state-highlight");this.highlightLock=!1;this._scrollToBottom()},toggleBox(){this.elem.uiChatbox.toggle("slide",{direction:"down"},1E3)},_scrollToBottom(){const c=
this.elem.uiChatboxLog;c.scrollTop(c.get(0).scrollHeight)}}},toggleContent(c){this.uiChatboxContent.toggle();this.uiChatboxContent.is(":visible")&&this.uiChatboxInputBox.focus()},widget(){return this.uiChatbox},_create(){var c=!0===virtualclass.settings.info.studentgc?"enable":"disable";const a=this;c=(a.uiChatbox=d("<div></div>")).appendTo(document.getElementById("congreaChatCont")).addClass(`${"ui-widget ui-corner-top ui-chatroom "}${c}`).prop("id","chatrm");uiChatboxContent=(a.uiChatboxContent=
d("<div></div>")).addClass("ui-widget-content ui-chatbox-content ").appendTo(c);uiChatboxLog=(a.uiChatboxLog=a.element).addClass("ui-widget-content ui-chatbox-log").appendTo(uiChatboxContent);uiChatboxInputBox=(a.uiChatboxInputBox=d("<input></input>")).addClass("ui-widget-content ui-chatbox-input-box ").prop("id","ta_chrm2").prop("placeholder","Send message...").appendTo(document.querySelector(".congrea #congchatBarInput")).keydown(function(b){if(b.keyCode&&b.keyCode==d.ui.keyCode.ENTER){msg=d.trim(d(this).val());
b=(new Date).getTime();var c={receiver:"chatroom",msg,cf:"msg",time:b};0<msg.length&&(ioAdapter.mustSend(c),d(this).val(""),a.options.messageSent({name:io.cfg.userobj.name},{msg,time:b}),null!=localStorage.getItem("chatroom")?(c=JSON.parse(localStorage.getItem("chatroom")),b={userid:io.cfg.userid,name:io.cfg.userobj.name,msg,time:b},c.push(b),localStorage.setItem("chatroom",JSON.stringify(c))):(b={userid:io.cfg.userid,name:io.cfg.userobj.name,msg,time:b},localStorage.setItem("chatroom",JSON.stringify([b]))),
virtualclass.chat.commonChat.push(b));return!1}}).focusin(()=>{uiChatboxInputBox.addClass("ui-chatbox-input-focus")}).focusout(()=>{uiChatboxInputBox.removeClass("ui-chatbox-input-focus")});uiChatboxContent.children().click(()=>{a.uiChatboxInputBox.focus()});a._setWidth(a.options.width);a._position(a.options.offset);a.options.boxManager.init(a);roles.isStudent()&&virtualclass.settings.studentgc(virtualclass.settings.info.studentgc);a.options.hidden||(c.show(),virtualclass.vutil.isPlayMode()&&disCommonChatInput())},
_setOption(c,a){if(null!=a)switch(c){case "hidden":a?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(a);break;case "width":this._setWidth(a)}d.Widget.prototype._setOption.apply(this,arguments)},_setWidth(c){this.uiChatbox.width(`${c}px`)},_position(c){this.uiChatbox.css("left",c)}})})(jQuery);Array.indexOf||(Array.prototype.indexOf=function(d){for(let c=0;c<this.length;c++)if(this[c]==d)return c;return-1});
const chatboxManager=function(){let d=[],c=[];const a={width:230,gap:20,maxBoxes:5,messageSent(a,b,c){$(`#${a}`).chatbox("option","boxManager").addMsg(b,c)}},b=function(b){var f=c.indexOf(b);if(-1!=f){c.splice(f,1);d.splice(f,1);b=a.width+a.gap;for(let a=f;a<c.length;a++)f=$(`#${c[a]}`).chatbox("option","offset"),$(`#${c[a]}`).chatbox("option","offset",f-b)}else alert(`There is some error: ${b}`)};var f=function(b,c,f){d.indexOf(c.userid);a.messageSent(b,c,f)};return{init:function(b){$.extend(a,b)},
addBox:function(g,k,m){m=c.indexOf(g);const n=d.indexOf(g);-1!=m?console.log("Do nothing"):-1!=n?($(`#${g}`).chatbox("option","offset",285+(a.width+a.gap)*c.length),$(`#${g}`).chatbox("option","boxManager").toggleBox(),c.push(g),m=$("#tabs li").index($(`#tabcb${g}`)),$($(".tabs li")[m]).css("display","list-item"),$("#tabs").tabs("option","active",m),$("#tabs").tabs("show")):(void 0==k.last_name&&(k.last_name=""),m=document.createElement("div"),m.setAttribute("id",g),$(m).chatbox({id:g,user:k,title:`${k.first_name} ${k.last_name}`,
hidden:!1,width:a.width,offset:285+(a.width+a.gap)*c.length,messageSent:f,boxClosed:b}),d.push(g),c.push(g));"support"==k.class?0==$(`#cb${g}.support`).length&&$(`#cb${g}`).addClass("support").removeClass("privateChat"):"privateChat"==k.class&&0==$(`#cb${g}.privateChat`).length&&$(`#cb${g}`).addClass("privateChat").removeClass("support");virtualclass.chat.vmstorage.hasOwnProperty(g)&&(virtualclass.chat.vmstorage[g][0].box="opened")},delBox:function(a){c=$.grep(c,b=>a!=b);d=$.grep(d,b=>a!=b)},dispatch:function(a,
b){$(`#${a.userid}`).chatbox("option","boxManager").addMsg(a.name,b)}}}();let tabId;const myChatBoxOpen=!1,chatResults=[];let myDivResult="";const checkChatDisabled=!1;let tmpmyDivResult;
function displayChatUserList(d){virtualclass.gObj.hasOwnProperty("insertUser")||(virtualclass.gObj.insertUser=!0,virtualclass.gObj.userToBeDisplay=500);var c=d;if(virtualclass.gObj.insertUser){if(virtualclass.jId==virtualclass.gObj.uid&&virtualclass.gObj.userToBeDisplay<d.length){c=[];c.push(virtualclass.vutil.getMySelf());for(let a=0;a<virtualclass.gObj.userToBeDisplay;a++)d[a].userid!=virtualclass.gObj.uid&&c.push(d[a])}for(d=0;d<c.length;d++)"undefined"===typeof virtualclass.gObj.chatIconColors[c[d].userid]&&
groupChatImgColor(c[d].name,c[d].userid),virtualclass.gObj.chatIconColors[c[d].userid].savedImg="noimage"==c[d].img?!1:c[d].img,null==document.getElementById(`video${c[d].userid}`)&&(tmpmyDivResult=$("#chat_div").memberlist("option").userSent(c[d])),"boolean"!==typeof tmpmyDivResult&&void 0!=tmpmyDivResult&&(myDivResult+=tmpmyDivResult);"undefined"===typeof chat_div&&(chat_div=document.querySelector("#chat_div"));null!=myDivResult&&void 0!=myDivResult&&""!=myDivResult&&"boolean"!==typeof myDivResult&&
(" "==chat_div.shadowRoot.innerHTML||""==chat_div.shadowRoot.innerHTML?(d=roles.hasControls()?"teacher":"student",chat_div.shadowRoot.innerHTML=virtualclass.isPlayMode?`<link rel='stylesheet' type='text/css' href='${whiteboardPath}css/modules/chat-container.css'> <div id='subchat' class='playMode ${d}'>${myDivResult}</div>`:`<link rel='stylesheet' type='text/css' href='${whiteboardPath}css/modules/chat-container.css'> <div id='subchat' class='${d}'>${myDivResult}</div>`):chat_div.shadowRoot.querySelector("#subchat").insertAdjacentHTML("beforeend",
myDivResult));myDivResult="";if(virtualclass.gObj.uid==virtualclass.vutil.whoIsTeacher())for(d=0;d<c.length;d++)virtualclass.gObj.uid!=c[d].userid&&virtualclass.user.initControlHandler(c[d].userid)}virtualclass.gObj.insertUser=!(virtualclass.connectedUsers.length>=virtualclass.gObj.userToBeDisplay)}
function displayChatOfflineUserList(d){alert("display chat offline user");var c=document.querySelector("#melistcontainer");null==c&&(c=document.createDocumentFragment("div"),c.id="melistcontainer");for(let a=0;a<d.length;a++)virtualclass.vutil.alreadyConnected(d[a].userid)||d[a].userid==virtualclass.gObj.uid||null!=document.getElementById(`video${d[a].userid}`)||(myDivResult=$("#chat_div").memberlist("option").userSent(d[a]),virtualclass.media.addUserRole(myDivResult,d[a].role),c.appendChild(myDivResult));
console.log("display offline user");document.querySelector("#chat_div").appendChild(c)}
function updateOnlineUserText(){if(roles.hasAdmin())if(0<virtualclass.chat.userList.length){document.querySelector("#usertab_text").innerHTML="";var d=roles.hasAdmin()?`Users (${virtualclass.connectedUsers.length}/${virtualclass.chat.userList.length})`:` Users (${count})`;const c=document.querySelector("#onlineusertext");null==c?document.querySelector("#usertab_text").innerHTML=`<span id='onlineusertext' class='cgText'>${d}</span>`:c.innerHTML=d}else document.querySelector("#user_list .inner_bt #usertab_text").innerHTML=
`${"<span class='cgText' id='onlineusertext'>Users ("}${virtualclass.connectedUsers.length})</span>`;else document.querySelector("#user_list .inner_bt #usertab_text").innerHTML=`${"<span class='cgText' id='onlineusertext'>Users ("}${virtualclass.connectedUsers.length})</span>`}
function memberUpdate(d,c){if("removed"==c)c=virtualclass.gObj.testChatDiv.shadowRoot.querySelector(`#ml${d.removeUser}`),null!=c&&c.parentNode.removeChild(c),updateOnlineUserText();else{d=virtualclass.gObj.memberlistpending;virtualclass.gObj.memberlistpending=[];console.log("member list pending(memberlistpending) empty ");if(0<d.length){virtualclass.chat._showChatUserList(d);virtualclass.jId==virtualclass.gObj.uid&&(virtualclass.chat.openChatBox(),virtualclass.media.dispAllVideo("chat_div"),console.log("chat box is opened"));
displayChatUserList(d);for(var a=0;a<d.length;a++)if(d[a].userid==io.cfg.userid&&"undefined"!==typeof c&&"removed"!=c){var b=document.getElementById(`video${virtualclass.gObj.uid}`);virtualclass.gObj.hasOwnProperty("audIntDisable")||virtualclass.gObj.hasOwnProperty("vidIntDisable")||null!=b||(console.log("Media _handleUserMedia"),virtualclass.media._handleUserMedia(virtualclass.gObj.uid));b=chatContainerEvent.elementFromShadowDom(`#ml${virtualclass.gObj.uid}`);null!=b&&b.classList.add("mySelf")}virtualclass.raiseHand.moveUpInList()}else $("div#memlist").length&&
(console.log(`member remove memlist ${$("div#memlist").length} addType=${c}`),$("div#memlist").remove());roles.hasAdmin()&&virtualclass.jId==virtualclass.gObj.uid?(virtualclass.chat.openChatBox(),"added"==c?virtualclass.chat.fetchChatUsers():virtualclass.chat.showChatListUsers(),virtualclass.chat.setChatDisplay()):virtualclass.jId==virtualclass.gObj.uid&&virtualclass.chat.setChatDisplay();d=document.querySelector("#memlist");c=document.querySelector("#chatrm");null!=d&&null==document.querySelector("#chatroom_bt2.active")?
(d.classList.add("enable"),d.classList.remove("disable"),null!=c&&(c.classList.remove("enable"),c.classList.add("disable"))):(d.classList.remove("enable"),d.classList.add("disable"),d=document.querySelector("#user_list"),a=document.querySelector("#chatroom_bt2"),c&&(a.classList.contains("active")||a.classList.add("active"),d.classList.remove("active")));c=document.querySelector("#virtualclassCont.congrea  .vmchat_bar_button");d=document.querySelector("#virtualclassCont.congrea #congreaUserSearch");
a=document.querySelector("#virtualclassCont.congrea  #ta_chrm2");c.classList.contains("active")?(a&&(a.style.display="none"),d&&(d.style.display="block")):(a&&(a.style.display="block"),d&&(d.style.display="none"));updateOnlineUserText();virtualclass.connectedUsers.forEach(a=>{$(`#ml${a.userid}`).addClass("online").removeClass("offline")});c=document.querySelector("#chat_div .ui-memblist-usr.mySelf .videoSubWrapper video");null!=c&&c.play()}"display"==virtualclass.gObj.delayVid&&setTimeout(()=>{virtualclass.videoHost.setUserIcon(virtualclass.gObj.uid)},
200);virtualclass.gObj.delayVid=""}
function messageUpdate(d){var c=$.isPlainObject(d.message)?d.message.msg:d.message;const a=d.toUser,b=d.fromUser,f=io.cfg.userid,g=(new Date).getTime();if("chatroom"==d.message.receiver&&(""==a||void 0==a))c={msg:c,time:d.message.time},virtualclass.chat.chatroombox||0!=$("ul#chat_room").length||(d=document.createElement("ul"),d.id="chat_room",document.body.appendChild(d),virtualclass.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:b,title:lang.chatroom_header,messageSent(a,b){const c=
a.userid||virtualclass.gObj.uid;$("#chat_room").chatroom("option","boxManager").addMsg(a.name,b,c)}})),$("#chat_room").chatroom("option").messageSent(b,c),d=localStorage.getItem("chatroom"),null!=d?(d=JSON.parse(d),c={userid:b.userid,name:b.name,msg:c,time:g},d.push(c),localStorage.setItem("chatroom",JSON.stringify(d))):(c={userid:b.userid,name:b.name,msg:c,time:g},localStorage.setItem("chatroom",JSON.stringify([c]))),virtualclass.chat.commonChat.push(c),0==$("#chatroom_bt2.active").length&&($("#chatroom_bt2").addClass("ui-state-highlight"),
$("#chatrm").removeClass("enable"));else if(void 0!=a&&""!=a){if(f==a.userid&&b.userid!=f){-1==$.inArray(b.userid,virtualclass.chat.idList)&&(virtualclass.chat.counter++,virtualclass.chat.idList.push(b.userid),virtualclass.chat.vmstorage.hasOwnProperty(b.userid)||(virtualclass.chat.vmstorage[b.userid]=[],virtualclass.chat.vmstorage[b.userid].push({userid:b.userid,name:`${b.name} ${b.lname}`})));null==document.querySelector(`#cb${b.userid}`)&&(chatboxManager.addBox(b.userid,{dest:`dest${virtualclass.chat.counter}`,
title:`box${virtualclass.chat.counter}`,first_name:b.name,last_name:b.lname}),virtualclass.chat.vmstorage.hasOwnProperty(b.userid)&&1<virtualclass.chat.vmstorage[b.userid].length&&displayUserSinglePvtChatHistory(b.userid));chatboxManager.init({user:b,messageSent(a,b,c){$(`#${a}`).chatbox("option","boxManager").addMsg(b.name,c)}});roles.isStudent()&&virtualclass.settings.studentpc(virtualclass.settings.info.studentpc);$(`#${b.userid}`).chatbox("option").messageSent(b.userid,b,c);$(`li[aria-controls='tabcb${b.userid}']`).addClass("ui-state-highlight");
var k=b.userid}virtualclass.chat.vmstorage[k].push({userid:b.userid,name:b.name,msg:c,time:g})}}function statusUpdate(d,c,a){$(`#${d.userid}`).length&&($(`#${d.userid}`).chatbox("option").messageSent(d.userid,d,c),$(`#ta${d.userid}`).prop("disabled",a))}function common_chatbox_update(d,c){$("ul#chat_room").length&&$("#chat_room").chatroom("option").messageSent(d,c)}
function newStatus(d){$.each(d.message,(c,a)=>{null!=d.newuser&&a.userid==d.newuser&&(statusUpdate(a,"Online",!1),common_chatbox_update(a,"Online"))})}function createTab(d,c){const a=$("#tabs").tabs(),b=$("div#tabs ul li").length;tabId=`tabcb${d}`;addTab(a,tabId,b,c)}
function addTab(d,c,a,b){const f=$("#tab_content");a=b||`Tab ${a}`;c=$(`<li id = '${c}' class = 'ui-state-default ui-corner-bottom ui-tabs-active ui-state-active' aria-controls = '${c}'><a href = '#{href}' class = 'ui-tabs-anchor'>#{label}</a> <a href = '#' role = 'button'class = 'ui-corner-all ui-chatbox-icon'><span class = 'ui-icon icon-close'></span></a></li>`.replace(/#\{href\}/g,`#${c}`).replace(/#\{label\}/g,a));f.val();d.find(".ui-tabs-nav").append(c)}
function browserSupportsLocalStorage(){return"localStorage"in window&&null!=window.localStorage}
function displaycomChatHistory(){var d=localStorage.getItem("chatroom");if(null!=d){const c=document.createElement("ul");c.id="chat_room";document.body.appendChild(c);d=JSON.parse(d);virtualclass.chat.commonChat=d;$.each(d,(a,b)=>{1>a&&(virtualclass.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:b,title:"Common chat",messageSent(a,b){const c=a.userid||virtualclass.gObj.uid;$("#chat_room").chatroom("option","boxManager").addMsg(a.name,b,c)}}));"object"===typeof b.msg?$("#chat_room").chatroom("option").messageSent(b,
b.msg):$("#chat_room").chatroom("option").messageSent(b,{msg:b.msg,time:b.time})})}"hidden"==localStorage.getItem("chatroom_status")&&$("#chatrm").hide()}
function displayPvtChatHistory(d){let c=!1;console.log(d);$.each(d,(a,b)=>{virtualclass.chat.counter++;virtualclass.chat.idList.push(a);$.each(b,(b,d)=>{1>b?(d.hasOwnProperty("box")&&(c=!0),c&&(a==virtualclass.chat.supportId&&(d.name="support"),chatboxManager.addBox(a,{dest:`dest${virtualclass.chat.counter}`,title:`box${virtualclass.chat.counter}`,first_name:d.name}),chatboxManager.init({messageSent(a,b,c){$(`#${a}`).chatbox("option","boxManager").addMsg(b.name,c)}}))):c&&$(`#${a}`).chatbox("option").messageSent(a,
d,d.msg)});c=!1;a==virtualclass.chat.supportId&&(b=document.getElementById(`cb${virtualclass.chat.supportId}`))&&b.classList.add("support");"hidden"==localStorage.getItem(a)&&($(`#cb${a}`).hide(),$(`#tabcb${a}`).removeClass("ui-state-active"))})}function display_error(d){virtualclass.view.createErrorMsg(d,"errorContainer","chatWidget",{className:"Unauthenticated"})}function clearAllChatBox(){$("#chatWidget .icon-close").trigger("click")}
function disCommonChatInput(){const d=document.getElementById("ta_chrm");null!=d&&(d.disabled=!0)}
function toggleCommonChatBox(){var d=$("#chatroom_bt2");"hidden"==localStorage.getItem("chatroom_status")?(localStorage.removeItem("chatroom_status"),d.attr("data-title",virtualclass.lang.getString("minCommonChat"))):(localStorage.setItem("chatroom_status","hidden"),d.attr("data-title",virtualclass.lang.getString("maxCommonChat")));d=document.getElementById("cc_arrow_button");null!=d&&(virtualclass.vutil.elemHasAnyClass("cc_arrow_button")?d.classList.contains("icon-arrow-up")?(d.classList.add("icon-arrow-down"),
d.classList.remove("icon-arrow-up")):(d.classList.add("icon-arrow-up"),d.classList.remove("icon-arrow-down")):d.className="icon-arrow-up");virtualclass.chat.chatroombox.chatroom("option","boxManager").toggleBox()}function sortUserList(d,c){return d.name<c.name?-1:d.name>c.name?1:0}function sortCommonChat(){const d=$("#chat_room");d.find(".ui-chatbox-msg").sort((c,a)=>+c.dataset.msgtime-+a.dataset.msgtime).appendTo(d)}
function displayUserSinglePvtChatHistory(d){$(`#${d} .ui-chatbox-msg`).remove();const c=virtualclass.chat.vmstorage[d];1<c.length&&$.each(c,(a,b)=>{0<a&&$(`#${d}`).chatbox("option").messageSent(d,b,b.msg)})}function groupChatImgColor(d,c){let a;const b=getInitials(d);d=stringToHslColor(c.toString()+d,60,35);a=125<virtualclass.vutil.calcBrightness(d)?"black":"white";virtualclass.gObj.chatIconColors[c]={bgColor:d,textColor:a,initial:b}}
function stringToHslColor(d,c,a){let b=0;for(let a=0;a<d.length;a++)b=d.charCodeAt(a)+((b<<5)-b);return`hsl(${b%360}, ${c}%, ${a}%)`}function getInitials(d){d=d.split(" ");let c=d[0].substring(0,1).toUpperCase();1<d.length&&(c+=d[d.length-1].substring(0,1).toUpperCase());return c};const lang={online:"Online users",whos:"Who's online",chatroom:"Chatroom",chatroom_header:"Common chat",error:"Something bad happend. Sorry!",wserror:"Browser does not support WebSocket",sterror:"This browser doesn't support Web Storage standard"};var preCheck={currTest:"",playTestAudio:!1,session:null,cNavigator:null,handlers:[],videoAction:!1,donePrecheck:!1,init(){var d=document.querySelector("#myModal");d&&(d.className="modal in");roles.hasControls()?this.videoAction=virtualclass.videoHost.gObj.videoSwitch:virtualclass.videoHost.gObj.hasOwnProperty("stdStopSmallVid")?this.videoAction=!virtualclass.videoHost.gObj.stdStopSmallVid:this.videoAction=!1;this.totalTest=["browser","bandWidth","webcam","speaker","mic"];this.currTest="browser";d=
document.querySelector("#virtualclassCont #preCheckcontainer");null!=d&&(d.style.display="block");d=document.querySelector("#virtualclassCont #virtualclassApp");null!=d&&(d.style.display="none");this.startToCheckWholeSytem();console.log("Precheck init skip");if(d=document.querySelector("#preCheckcontainer .skip"))d.removeEventListener("click",this.initSkip),d.addEventListener("click",this.initSkip);virtualclass.precheck.donePrecheck=!0;null!=workerAudioSend&&workerAudioSend.postMessage({cmd:"precheck",
msg:{precheck:virtualclass.precheck.donePrecheck}})},initSkip(){console.log("Skip clicked");micTesting.makeAudioEmpty();if(localStorage.getItem("precheck")){var d=document.getElementById("preCheckcontainer");d.style.display="none";d=document.getElementById("virtualclassApp");d.style.display="block"}else virtualclass.popup.waitMsg(),virtualclass.makeReadySocket(),d=document.getElementById("preCheckcontainer"),d.style.display="none",d=document.getElementById("virtualclassApp"),d.style.display="block",
localStorage.setItem("precheck",!0),virtualclass.videoHost.afterSessionJoin();if(d=document.getElementById("vcSpeakerCheckAudio"))d.pause(),d.currentTime=0;virtualclass.gObj.precheckScrn=!1;virtualclass.precheck.afterComplete()},cancelAudioGraph(){null!=this.graph&&void 0!=this.graph&&this.graph.microphone.stop()},startToCheckWholeSytem(){this[this.totalTest[0]].perform()},_next(d,c){console.log("Clicked next");"browser"==d&&virtualclass.media.audio.initAudiocontext();virtualclass.precheck.cancelAudioGraph();
micTesting.makeAudioEmpty();const a=this[d].next;virtualclass.precheck.currTest=a;virtualclass.precheck.updateProgressBar(a);!this[a].hasOwnProperty("alreadyDone")||this[a].hasOwnProperty("alreadyDone")&&"bandwidth"==a?this[a].perform():(virtualclass.precheck.display(`#preCheckcontainer .precheck.${a}`),"speaker"==a?this[a]._play():"mic"==a?this[a].audioOperation():"webcam"==a&&(virtualclass.precheck.webcam.initHandler(),virtualclass.precheck.webcam.createVideo()));virtualclass.precheck.hide(`#preCheckcontainer .precheck.${d}`);
"undefined"!==typeof c&&c();this[a].alreadyDone=!0},_prev(d,c){virtualclass.precheck.cancelAudioGraph();micTesting.makeAudioEmpty();const a=this[d].prev;virtualclass.precheck.hide(`#preCheckcontainer .precheck.${d}`);virtualclass.precheck.display(`#preCheckcontainer .precheck.${a}`);document.querySelector(`#preCheckcontainer  #preCheckProgress .${d}`).classList.remove("active","current");document.querySelector(`#preCheckcontainer  #preCheckProgress .${a}`).classList.add("current");"speaker"==a?this[a]._play():
"mic"==a?(micTesting.playAudio=!0,this[a].audioOperation()):"webcam"==a&&virtualclass.precheck.webcam.initHandler();"undefined"!==typeof c&&c()},display(d){document.querySelector(d).style.display="block"},hide(d){document.querySelector(d).style.display="none"},createMessage(d,c,a){const b=document.createElement("div");b.className=a;b.innerHTML=c;document.querySelector(d).appendChild(b)},initHandler(d,c,a){console.log("initHandler next/prev");const b=document.querySelector(d);null!=b&&(c=this.triggerInitHandler.bind(b,
d,c,a),b.addEventListener("click",c),this.handlers.push({id:d,handler:c}))},removeAllListener(){for(let d=0;d<this.handlers.length;d++)document.querySelector(this.handlers[d].id).removeEventListener("click",this.handlers[d].handler);this.handlers=[]},triggerInitHandler(d,c,a){this.classList.contains("next")?(virtualclass.precheck._next(c),console.log("Trigger handle Next")):this.classList.contains("prev")&&(virtualclass.precheck._prev(c),console.log("Trigger handle previous"));"undefined"!==typeof a&&
null!=a&&a()},browser:{curr:"browser",next:"bandwidth",perform(){virtualclass.precheck.display(`${"#preCheckcontainer .precheck"}.${this.curr}`);if(0<virtualclass.error.length){var d=1<virtualclass.error.length?virtualclass.error.join("<br />"):virtualclass.error[0];virtualclass.precheck.createMessage("#preCheckcontainer .precheck .result",d,"error")}d=virtualclass.lang.getString("congreainchrome");virtualclass.precheck.createMessage("#preCheckcontainer .precheck .result",d,"information");virtualclass.precheck.initHandler(`${"#preCheckcontainer .precheck"} #${this.curr}Buttons .next`,
this.curr)}},bandwidth:{prev:"browser",curr:"bandwidth",next:"speaker",perform(){virtualclass.precheck.display(`#preCheckcontainer .precheck.${this.curr}`);var d=this;const c=`#preCheckcontainer .precheck.${this.curr} .result`;this.imageAddr="https://dl.congrea.com/bandwidth.jpg";this.downloadSize=1E6;d=this;this.measureConnectionSpeed(a=>{document.querySelector(c).innerHTML="";a=d.bandWidthInWords(a);a=virtualclass.lang.getString(`${a}BandWidthSpeed`);virtualclass.precheck.createMessage(c,a,"information");
virtualclass.precheck.initHandler(`${"#preCheckcontainer .precheck"} #${d.curr}Buttons .prev`,d.curr);virtualclass.precheck.initHandler(`${"#preCheckcontainer .precheck"} #${d.curr}Buttons .next`,d.curr)});const a=virtualclass.media.sessionConstraints();virtualclass.precheck.session=a[1];null==virtualclass.adpt&&(virtualclass.adpt=new virtualclass.adapter);virtualclass.precheck.cNavigator=virtualclass.adpt.init(navigator);virtualclass.precheck.cNavigator.mediaDevices.getUserMedia(virtualclass.precheck.session).then(a=>
{console.log("GEtting stream");virtualclass.precheck.mediaStream=a})},bandWidthInWords(d){console.log(`bandwidth speed ${d}`);600<d?(d="high",virtualclass.videoHost.gObj.MYSPEED=1):400<d?(d="medium",virtualclass.videoHost.gObj.MYSPEED=2):(virtualclass.videoHost.gObj.MYSPEED=3,d="low");ioAdapter.sendSpeed(virtualclass.videoHost.gObj.MYSPEED);return d},measureConnectionSpeed(d){const c=new Image,a=this;c.onload=function(){a.endTime=(new Date).getTime();const b=a.calculateSpeed();console.log("Download speed is occurred");
d(b)};c.onerror=function(a,c){alert("Invalid image, or error downloading")};this.startTime=(new Date).getTime();c.src=this.imageAddr+`?nnn=${this.startTime}`},calculateSpeed(){const d=((8*this.downloadSize/((this.endTime-this.startTime)/1E3)).toFixed(2)/1024).toFixed(2);return Math.round(d)}},speaker:{prev:"bandwidth",curr:"speaker",next:"mic",perform(){const d=document.createElement("div");d.innerHTML=virtualclass.lang.getString("speakerTest");document.querySelector(`${`#preCheckcontainer .precheck.${this.curr}`} .result`).appendChild(d);
this._play()},_play(){virtualclass.precheck.display(`#preCheckcontainer .precheck.${this.curr}`);document.querySelector("#vcSpeakerCheckAudio source");const d=document.getElementById("vcSpeakerCheckAudio");d.loop=!0;d.play();this.playTestAudio||(virtualclass.precheck.initHandler(`${"#preCheckcontainer .precheck"} #${this.curr}Buttons .prev`,this.curr,()=>{d.pause();d.currentTime=0}),virtualclass.precheck.initHandler(`${"#preCheckcontainer .precheck"} #${this.curr}Buttons .next`,this.curr,()=>{d.pause();
d.currentTime=0}),this.playTestAudio=!0);virtualclass.precheck.cancelAudioGraph()}},mic:{prev:"speaker",curr:"mic",next:"webcam",graphProcessor:null,graph:null,perform(){micTesting.manipulateStreamFallback(virtualclass.precheck.mediaStream);virtualclass.precheck.display(`${"#preCheckcontainer .precheck"}.${this.curr}`);this.visualize();if(null==document.querySelector("#micTest")){const d=document.createElement("div");d.id="micTest";d.innerHTML=virtualclass.lang.getString("mictesting");document.querySelector(`${`${"#preCheckcontainer .precheck"}.${this.curr}`} .result`).appendChild(d)}if("safari"==
virtualclass.system.mybrowser.name||"iOS"==virtualclass.system.mybrowser.name)this.graphContext=new (window.AudioContext||window.webkitAudioContext),this.graphProcessor=this.graphContext.createScriptProcessor(1024,1,1);this.initAudioGraph()},initAudioGraph(){if(this.hasOwnProperty("graph")&&null!=this.graph){const d=document.querySelector("#audioGraph wave");null!=d&&d.parentNode.removeChild(d)}this.graph=WaveSurfer.create({container:"#audioGraph",waveColor:"green",interact:!1,cursorWidth:0,audioContext:this.graphContext||
null,audioScriptProcessor:this.graphProcessor||null,plugins:[WaveSurfer.microphone.create()],height:50,maxCanvasWidth:500});this.graph.microphone.on("deviceReady",()=>{console.info("Device ready!")});this.graph.microphone.on("deviceError",d=>{console.warn(`Device error: ${d}`)})},audioOperation(){micTesting.playAudio=!0;this.visualize()},visualize(){virtualclass.precheck.initHandler(`#preCheckcontainer .precheck #${this.curr}Buttons .prev`,this.curr);virtualclass.precheck.initHandler(`#preCheckcontainer .precheck #${this.curr}Buttons .next`,
this.curr)}},webcam:{test:{1:"noWebCam",2:"nopermission",3:"webcambuys"},prev:"mic",curr:"webcam",perform(){const d=`#preCheckcontainer .precheck.${this.curr}`;var c=document.createElement("div");let a,b;if(virtualclass.system.mediaDevices.hasWebcam)if(0<virtualclass.system.mediaDevices.webcamErr.length){a=virtualclass.system.mediaDevices.webcamErr[virtualclass.system.mediaDevices.webcamErr.length-1];if("PermissionDeniedError"==a||"SecurityError"==a||"nopermission"==a)a+="Ext","Firefox"==virtualclass.system.mybrowser.name&&
(a+="FF");a=virtualclass.lang.getString(a);b=`${c.className} error`}else b=`${c.className} general`,c=document.createElement("div"),a=virtualclass.lang.getString("webcamerainfo");else b=`${c.className} error`,a=virtualclass.lang.getString("nowebcam");c.className=b;c.innerHTML=a;document.querySelector(`${d} .result`).appendChild(c);virtualclass.precheck.display(d);c.classList.contains("error")?document.getElementById("webcamTempVideo").className="novideo":this.createVideo();this.initHandler()},initHandler(){virtualclass.precheck.initHandler("#preCheckcontainer .precheck #joinSession .prev",
this.curr);var d=document.querySelector("#joinSession .next");null!=d?(d.removeEventListener("click",this.joinSession.bind(this)),d.addEventListener("click",this.joinSession.bind(this))):(d=document.querySelector("#joinSession .precheckComplete"),null!=d&&(d.removeEventListener("click",this.initHidePrecheck.bind(this)),d.addEventListener("click",this.initHidePrecheck.bind(this))))},initHidePrecheck(){document.getElementById("preCheckcontainer").style.display="none";document.getElementById("virtualclassApp").style.display=
"block";virtualclass.videoHost._resetPrecheck();virtualclass.precheck.afterComplete()},joinSession(){virtualclass.popup.waitMsg();virtualclass.makeReadySocket();var d=document.getElementById("preCheckcontainer");d.style.display="none";d=document.getElementById("preCheckcontainer");d.style.display="none";document.getElementById("virtualclassApp").style.display="block";localStorage.setItem("precheck",!0);virtualclass.videoHost.afterSessionJoin();virtualclass.precheck.afterComplete()},createVideo(){if(virtualclass.system.mediaDevices.hasWebcam&&
"undefined"!==typeof virtualclass.precheck.mediaStream){const d=document.getElementById("webcamTempVideo");"mobTab"==virtualclass.system.device?(d.width=320,d.height=100):(d.width=320,d.height=240);virtualclass.adpt.attachMediaStream(d,virtualclass.precheck.mediaStream);d.muted=!0;d.play()}}},startSession(){document.getElementById("virtualclassApp").style.display="block";const d=document.getElementById("virtualclassPreCheck");null!=d&&d.parentNode.removeChild(d)},updateProgressBar(d){document.querySelector(`#progressbarScreen .${d}`);
const c=document.querySelectorAll("#preCheckProgress .progressbar li");for(let a=0;a<c.length;a++)if(c[a].classList.add("active"),c[a].classList.contains(d)){0<a&&c[a-1].classList.remove("current");c[a].classList.add("current");break}},async afterComplete(){virtualclass.precheck.hasOwnProperty("mediaStream")&&null!=virtualclass.precheck.mediaStream&&virtualclass.precheck.mediaStream.getTracks()[0].stop();virtualclass.videoHost._resetPrecheck();micTesting.destroyAudioNode();virtualclass.precheck.removeAllListener();
"undefined"!==typeof workletAudioSend?workletAudioSend.disconnect():null!=virtualclass.gObj.audioPlayerNode&&(virtualclass.gObj.audioPlayerNode.disconnect(virtualclass.media.audio.Html5Audio.audioContext.destination),virtualclass.gObj.audioPlayerNode=null);"undefined"!==typeof virtualclass.media.audioCreatorNode&&null!=virtualclass.media.audioCreatorNode&&(virtualclass.media.audioCreatorNode.disconnect(virtualclass.media.audio.Html5Audio.audioContext.destination),virtualclass.media.audioCreatorNode=
null);("iOS"==virtualclass.system.mybrowser.name||"Firefox"==virtualclass.system.mybrowser.name||"Safari"==virtualclass.system.mybrowser.name)&&virtualclass.media.audio.hasOwnProperty("Html5Audio")&&virtualclass.media.audio.Html5Audio.hasOwnProperty("audioContext")&&null!=virtualclass.media.audio.Html5Audio.audioContext&&virtualclass.media.audio.Html5Audio.audioContext.close();virtualclass.media.audio.hasOwnProperty("Html5Audio")&&delete virtualclass.media.audio.Html5Audio;console.log("Fetching media stream");
await virtualclass.media.init();virtualclass.vutil.videoHandler(this.videoAction?"on":"off","notSendStatus");virtualclass.media.audio.initAudiocontext();virtualclass.precheck.speaker.playTestAudio=!1;virtualclass.precheck.donePrecheck=!1;null!=workerAudioSend&&workerAudioSend.postMessage({cmd:"precheck",msg:{precheck:virtualclass.precheck.donePrecheck}})}};eval(function(d,c,a,b,f,g){f=function(a){return(a<c?"":f(parseInt(a/c)))+(35<(a%=c)?String.fromCharCode(a+29):a.toString(36))};if(!"".replace(/^/,String)){for(;a--;)g[f(a)]=b[a]||f(a);b=[function(a){return g[a]}];f=function(){return"\\w+"};a=1}for(;a--;)b[a]&&(d=d.replace(new RegExp(`\\b${f(a)}\\b`,"g"),b[a]));return d}('(v(){o d="H+/";o e=I J(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,K,-1,-1,-1,L,M,N,O,P,Q,R,S,T,U,w,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,V,W,X,Y,Z,1a,-1,-1,-1,-1,-1,-1,1b,1c,1d,1e,1f,1g,1h,1i,1j,1k,1l,1m,1n,1o,1p,1q,1r,1s,1t,1u,1v,1w,1x,1y,1z,1A,-1,-1,-1,-1,-1);v A(a){o b,i,g;o c,h,f;g=a.B;i=0;b="";p(i<g){c=a.n(i++)&r;j(i==g){b+=d.k(c>>2);b+=d.k((c&x)<<4);b+="==";q}h=a.n(i++);j(i==g){b+=d.k(c>>2);b+=d.k(((c&x)<<4)|((h&C)>>4));b+=d.k((h&D)<<2);b+="=";q}f=a.n(i++);b+=d.k(c>>2);b+=d.k(((c&x)<<4)|((h&C)>>4));b+=d.k(((h&D)<<2)|((f&1B)>>6));b+=d.k(f&1C)}s b}v E(a){o b,h,f,l;o i,g,m;g=a.B;i=0;m="";p(i<g){t{b=e[a.n(i++)&r]}p(i<g&&b==-1);j(b==-1)q;t{h=e[a.n(i++)&r]}p(i<g&&h==-1);j(h==-1)q;m+=y.z((b<<2)|((h&1D)>>4));t{f=a.n(i++)&r;j(f==w)s m;f=e[f]}p(i<g&&f==-1);j(f==-1)q;m+=y.z(((h&1E)<<4)|((f&1F)>>2));t{l=a.n(i++)&r;j(l==w)s m;l=e[l]}p(i<g&&l==-1);j(l==-1)q;m+=y.z(((f&1G)<<6)|l)}s m}j(!u.F)u.F=A;j(!u.G)u.G=E})();',
62,105,"               c3 len c2  if charAt c4 out charCodeAt var while break 0xff return do window function 61 0x3 String fromCharCode base64encode length 0xF0 0xF base64decode btoa atob ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 new Array 62 63 52 53 54 55 56 57 58 59 60 20 21 22 23 24           25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 0xC0 0x3F 0x30 0XF 0x3C 0x03".split(" "),0,{}));let vType;function createRequestObject(){return"Microsoft Internet Explorer"==navigator.appName?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}const http=createRequestObject();function convertResponseBodyToText(d){const c={};for(var a=0;256>a;a++)for(let b=0;256>b;b++)c[String.fromCharCode(a+256*b)]=String.fromCharCode(a)+String.fromCharCode(b);a=IEBinaryToArray_ByteStr(d);d=IEBinaryToArray_ByteStr_Last(d);return a.replace(/[\s\S]/g,a=>c[a])+d}const IEBinaryToArray_ByteStr_Script="\x3c!-- IEBinaryToArray_ByteStr --\x3e\r\n<script type='text/vbscript'>\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n\tIEBinaryToArray_ByteStr = CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n\tDim lastIndex\r\n\tlastIndex = LenB(Binary)\r\n\tif lastIndex mod 2 Then\r\n\t\tIEBinaryToArray_ByteStr_Last = Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n\tElse\r\n\t\tIEBinaryToArray_ByteStr_Last = \"\"\r\n\tEnd If\r\nEnd Function\r\n\x3c/script>\r\n";
document.write(IEBinaryToArray_ByteStr_Script);
function loadfile(d,c,a){"undefined"===typeof vType&&(vType="dec");if("dec"===vType){const b=new Image;b.src=d;http.open("get",b.src);http.overrideMimeType?http.overrideMimeType("text/plain; charset=x-user-defined"):http.setRequestHeader("Accept-Charset","x-user-defined");http.onreadystatechange=function(){if(4==http.readyState){var b="undefined"===typeof http.responseBody?http.responseText.split("").map(a=>String.fromCharCode(a.charCodeAt(0)&255)).join(""):convertResponseBodyToText(http.responseBody);
"dec"===vType&&virtualclass.gObj.meetingMode&&WebPDecDemo(c.id);virtualclass.vutil.WebPDecodeAndDraw(b,c,a)}};http.send(null)}};function WebPDecDemo(d){document.getElementById(d).getContext("2d");document.createElement("img")};const BASE64_MARKER=";base64,";
var videoPartCont,sampleRate,videoHost={gObj:{},setDefaultValue(d){virtualclass.videoHost.gObj.MYSPEED=d||1;virtualclass.videoHost.gObj.teacherVideoQuality=this.getTeacherVideoQuality()},init(d,c){this.sl=0;this.width=d;this.height=c;this.gObj.videoSwitch=1;console.log("videoSwitch 1");this.allStdVideoOff=this.domReady=this.gObj.stdStopSmallVid=!1;roles.hasAdmin()?(this._init(),d=document.createElement("canvas"),d.id="dummyCanvas",d.width=40,d.height=40,document.querySelector("#virtualclassApp").appendChild(d),WebPDecDemo("dummyCanvas"),
this.domReady=!0):(this.setCanvasAttr("videoPartCan","videoParticipate"),WebPDecDemo("videoParticipate"),virtualclass.videoHost.UI.hideTeacherVideo());d=document.querySelector("#virtualclassAppRightPanel");if(null!=d)if(c=localStorage.getItem("tvideo"),null==c&&(c="show"),d.classList.add(c),roles.hasControls())(d=localStorage.getItem("videoSwitch"))&&"0"==d&&(virtualclass.connectedUsers&&virtualclass.connectedUsers.length?virtualclass.videoHost.setUserIcon(virtualclass.gObj.uid):virtualclass.gObj.delayVid=
"display",virtualclass.videoHost.UI.hideTeacherVideo());else{if(d=JSON.parse(localStorage.getItem("stdVideoSwitch")))virtualclass.connectedUsers&&virtualclass.connectedUsers.length?virtualclass.videoHost.setUserIcon(virtualclass.gObj.uid):virtualclass.gObj.delayVid="display",virtualclass.videoHost.UI.hideTeacherVideo();console.log(d)}},renderSelfVideo(d){"undefined"===typeof virtualclass.media.tempStream&&(console.log("Media attached stream"),this.getMediaStream(d))},isDomReady(d){const c=this;this.domReady?
(null!=this.domreadyCheck&&clearTimeout(this.domreadyCheck),d()):this.domreadyCheck=setTimeout(()=>{c.isDomReady(d)},1E3)},_init(){this.setCanvasAttr("vidHost","videoHost");this.setCanvasAttr("vidHostSlice","videoHostSlice");this.vidHostSlice.globalAlpha=.5;this.vidHostSlice.globalCompositeOperation="multiply"},onmessage(d){"on"===d?(virtualclass.videoHost.gObj.videoSwitch=1,console.log("videoSwitch 1"),this.UI.displayTeacherVideo(),localStorage.tvideo="show"):"off"===d&&(virtualclass.videoHost.gObj.videoSwitch=
0,this.UI.hideTeacherVideo(),localStorage.tvideo="hide")},stdVideoCtrlMsg(d){const {userid:c}=d.fromUser;d.message.stdVideoCtr.videoSwitch?this.setUserIcon(c):this.removeUserIcon(c)},toggleVideoMsg(d){const c=document.querySelector("#congCtrBar");"enable"==d?(c.style.pointerEvents="visible",c.style.opacity="1",virtualclass.videoHost.gObj.allStdVideoOff=!1):(c.style.pointerEvents="none",c.style.opacity="0.5",virtualclass.videoHost.gObj.allStdVideoOff=!0)},toggleStdVideoIcon(d){const c=document.querySelector(".congrea .videoSwitchCont"),
a=document.querySelector(".congrea #rightCtlr #videoSwitch");"enable"==d?(a.setAttribute("data-action","disable"),a.className="video on",c.setAttribute("data-title","Video off")):(a.setAttribute("data-action","enable"),a.className="video off",c.setAttribute("data-title","Video on"))},setUserIcon(d){var c=chatContainerEvent.elementFromShadowDom(`#ml${d} .user-details a .videoWrapper`);c&&c.parentNode.removeChild(c);c=chatContainerEvent.elementFromShadowDom(`#ml${d} .user-details a`);if(chatContainerEvent.elementFromShadowDom(`#ml${d} .user-details a span`)||
chatContainerEvent.elementFromShadowDom(`#ml${d} .user-details a img`)||null==c)console.log("Image container is null");else{if(virtualclass.gObj.chatIconColors[d]&&!virtualclass.gObj.chatIconColors[d].savedImg){var a=document.createElement("span");a.innerHTML=virtualclass.gObj.chatIconColors[d].initial;a.style.backgroundColor=virtualclass.gObj.chatIconColors[d].bgColor;a.style.color=virtualclass.gObj.chatIconColors[d].textColor;a.dataset.event="ub";a.classList.add("chat-img","media-object");c.appendChild(a)}else virtualclass.gObj.chatIconColors[d]&&
virtualclass.gObj.chatIconColors[d].savedImg&&(a=document.createElement("img"),a.setAttribute("src",virtualclass.gObj.chatIconColors[d].savedImg),a.classList.add("chat-img","media-object"),c.appendChild(a));console.log("set User icon")}},removeUserIcon(d){let c=virtualclass.media;console.log("Remove User icon");virtualclass.gObj.uid==d&&(d=c.video.createVideoElement(),virtualclass.media.util.imageReplaceWithVideo(virtualclass.gObj.uid,d),chatContainerEvent.elementFromShadowDom(`#ml${virtualclass.gObj.uid} #tempVideo`)||
(c.video.insertTempVideo(d),c.video.tempVideoInit()),c.video.myVideo=chatContainerEvent.elementFromShadowDom(`#video${virtualclass.gObj.uid}`),c.video.myVideo.muted=!0,virtualclass.adpt.attachMediaStream(c.video.myVideo,c.video.tempStream))},fromLocalStorage(){let d="";if(roles.hasControls())d=localStorage.getItem("videoSwitch"),localStorage.removeItem("videoSwitch");else{var c=localStorage.getItem("stdVideoSwitch");c=null!=c&&"undefined"!=c?JSON.parse(c):!1;localStorage.removeItem("stdVideoSwitch");
var a=localStorage.getItem("allStdVideoOff");a=null!=a&&"undefined"!=a?JSON.parse(a):!1;virtualclass.videoHost.gObj.allStdVideoOff=a;localStorage.removeItem("stdVideoSwitch")}if("undefined"!==typeof d&&d)if(virtualclass.videoHost.gObj.videoSwitch=+d,roles.hasControls()){if(a=document.getElementById("videoSwitch"))+d?a.classList.contains("off")&&(a.classList.add("on"),a.classList.remove("off"),console.log("Video controller on")):a.classList.contains("on")&&(console.log("Video controller off"),a.classList.add("off"),
a.classList.remove("on"),virtualclass.gObj.meetingMode&&virtualclass.multiVideo.setVideoStatus(!1))}else virtualclass.gObj.meetingMode||(+d?virtualclass.videoHost.UI.displayTeacherVideo():virtualclass.videoHost.UI.hideTeacherVideo());roles.hasControls()||("undefined"!==typeof c&&c&&((virtualclass.videoHost.gObj.stdStopSmallVid=c)?(virtualclass.videoHost.toggleStdVideoIcon("disable"),virtualclass.multiVideo.setVideoStatus(!1)):virtualclass.videoHost.toggleStdVideoIcon("enable")),virtualclass.videoHost.gObj.allStdVideoOff||
!virtualclass.system.mediaDevices.hasWebcam?virtualclass.videoHost.toggleVideoMsg("disable"):virtualclass.gObj.videoEnable?virtualclass.videoHost.toggleVideoMsg("enable"):virtualclass.videoHost.toggleStdVideoIcon("disable"))},setCanvasAttr(d,c){this[d]=document.getElementById(c);this[d].width=this.width;this[d].height=this.height;this[`${d}Con`]=this[d].getContext("2d")},getMediaStream(d){this.videoHostSrc=document.getElementById("videoHostSource");this.videoHostSrc.width=this.width;this.videoHostSrc.height=
this.height;virtualclass.adpt.attachMediaStream(this.videoHostSrc,d);const c=this;setTimeout(()=>{c.shareVideo()},2E3)},shareVideo(){this.imageSlices=this.getImageSlices(1,1);const d=this;videoHost.gObj.hasOwnProperty("shareVideoInterval")&&clearInterval(videoHost.gObj.shareVideoInterval);videoHost.gObj.shareVideoInterval=setInterval(()=>{d.gObj.videoSwitch&&io.webSocketConnected()&&virtualclass.system.mediaDevices.hasWebcam&&d._shareVideo(d,1,1)},120)},_shareVideo(d,c,a){for(d.sl=0;d.sl<c*a;d.sl++){d.vidHostCon.drawImage(d.videoHostSrc,
0,0,d.width,d.height);var b=d.imageSlices[d.sl];const a=d.vidHostCon.getImageData(b.x,b.y,b.w,b.h);d.vidHostSliceCon.putImageData(a,b.x,b.y)}d.sl==c*a&&(virtualclass.system.webpSupport?(a=d.vidHostSlice.toDataURL("image/webp",.6),c=1):(a=d.vidHostSlice.toDataURL("image/jpeg",.3),c=0),d.vidHostSliceCon.clearRect(0,0,d.width,d.height),d.sendInBinary(a,c))},sendInBinary(d,c){d=this.convertDataURIToBinary(d);c=new Int8Array([21,c]);const a=new Int8Array(d.length+c.length);a.set(c);a.set(d,c.length);ioAdapter.sendBinary(a)},
convertDataURIToBinary(d){var c=d.indexOf(BASE64_MARKER)+BASE64_MARKER.length;d=d.substring(c);d=window.atob(d);c=d.length;const a=new Uint8Array(new ArrayBuffer(c));for(let b=0;b<c;b++)a[b]=d.charCodeAt(b);return a},drawReceivedImage(d,c,a){"undefined"===typeof vid0eoPartCont&&(this.videoPartCan=document.getElementById("videoParticipate"),this.videoPartCont=this.videoPartCan.getContext("2d"),videoPartCont=!0);const b=this;"undefined"!==typeof virtualclass.media.audio.Html5Audio?sampleRate=virtualclass.media.audio.Html5Audio.audioContext.sampleRate:
"undefined"===typeof sampleRate&&(sampleRate=(new (window.AudioContext||window.webkitAudioContext)).sampleRate);virtualclass.gObj.isReadyForVideo&&document.querySelector("#virtualclassCont.congrea #videoHostContainer.hide")&&virtualclass.videoHost.UI.displayTeacherVideo();setTimeout(()=>{if(virtualclass.isPlayMode||3>virtualclass.videoHost.gObj.MYSPEED)if(virtualclass.system.webpSupport||"jpeg"==c){const c=new Image;c.onload=function(){b.videoPartCont.drawImage(c,a.x,a.y)};c.src=d}else virtualclass.gObj.isReadyForVideo&&
(virtualclass.gObj.isReadyForVideo=!1,loadfile(d,b.videoPartCan,b.videoPartCont))},260)},onError(d){console.log(`MediaStream Error ${d}`)},getImageSlices(d,c){const a=[],b=d*c,f=Math.floor(this.vidHost.width/c),g=Math.floor(this.vidHost.height/d);for(let k=0;k<b;k++){const b=this._getSingleSliceImg(k,f,g,d,c);a.push(b)}return a},_getSingleSliceImg(d,c,a,b,f){0==d?f=d=0:(b=Math.floor(d/f),d=d%f*c,f=b*a);return{x:d,y:f,w:c,h:a}},Uint8ToString(d){const c=[];for(let a=0;a<d.length;a+=32768)c.push(String.fromCharCode.apply(null,
d.subarray(a,a+32768)));return c.join("")},getTeacherVideoQuality(){virtualclass.videoHost.gObj.teacherVideoQuality=16;const d=document.querySelector("#virtualclassCont.teacher #videoHostSource");null!=d&&""==d.src&&(virtualclass.videoHost.gObj.teacherVideoQuality=0);return virtualclass.videoHost.gObj.teacherVideoQuality},afterSessionJoin(){const d=roles.hasAdmin()?1:virtualclass.videoHost.gObj.MYSPEED;this.setDefaultValue(d);virtualclass.network.initToPing(1E4);this.fromLocalStorage();this.resetPrecheck()},
resetPrecheck(){this._resetPrecheck();var d=document.querySelector("#joinSession .next");if(null!=d){const c=document.createElement("button");d.parentNode.appendChild(c);d.parentNode.removeChild(d);c.classList.add("precheckComplete","btn","btn-default");c.innerHTML=virtualclass.lang.getString("prechkcmplt")}(d=document.querySelector("#preCheckcontainer .skip"))&&d.addEventListener("click",()=>{micTesting.makeAudioEmpty();document.getElementById("preCheckcontainer").style.display="none";document.getElementById("virtualclassApp").style.display=
"block";virtualclass.videoHost._resetPrecheck()})},_resetPrecheck(){var d=document.querySelectorAll("#congProgressbar .active");for(let c=0;c<d.length;c++)0<c&&d[c].classList.remove("active");0<d.length&&(d=document.querySelectorAll("#myModal .precheck"),[].slice.call(d,0).forEach(c=>{c.style.display="none"}),(d=document.querySelector("#vcBrowserCheck .information"))&&d.parentNode.removeChild(d),virtualclass.precheck.totalTest&&virtualclass.precheck.totalTest.forEach(c=>{"undefined"!==typeof virtualclass.precheck[c]&&
virtualclass.precheck[c].hasOwnProperty("alreadyDone")&&"mic"==c&&delete virtualclass.precheck[c].alreadyDone}))},UI:{displayTeacherVideo(){if(!virtualclass.gObj.meetingMode){var d=document.querySelector(".congrea #videoHostContainer");d.classList.add("show");d.classList.remove("hide");d=document.querySelector(".congrea #virtualclassAppRightPanel");d.classList.add("vidShow");d.classList.remove("vidHide")}},hideTeacherVideo(){if(!virtualclass.gObj.meetingMode){var d=document.querySelector(".congrea #videoHostContainer");
d.classList.remove("show");d.classList.add("hide");d=document.querySelector(".congrea #virtualclassAppRightPanel");d.classList.add("vidHide");d.classList.remove("vidShow")}}}};(function(d){"use strtic";var c=function(){return{coursePoll:[],sitePoll:[],setting:{showResult:!0,timer:!0,time:{digit:"2",unit:"minut"}},uid:0,currQid:0,currOption:{},dataToStd:{},count:{},save:0,newUserTime:{},list:[],listPoll:{},currResultView:"bar",tStamp:[],pollState:{},exportfilepath:d.exportfilepath,uniqueUsers:[],init(){this.pollState={};virtualclass.previrtualclass="virtualclassPoll";virtualclass.previous="virtualclassPoll";this.cmid=virtualclass.vutil.getUrlVars(exportfilepath).cmid;this.timer&&
clearInterval(this.timer);!roles.hasAdmin()||roles.isEducator()?roles.isStudent()?this.UI.defaultLayoutForStudent():(this.UI.container(),roles.hasControls()?ioAdapter.mustSend({poll:{pollMsg:"init"},cf:"poll"}):this.UI.defaultLayoutForStudent()):(this.UI.container(),ioAdapter.mustSend({poll:{pollMsg:"init"},cf:"poll"}));const a=JSON.parse(localStorage.getItem("pollState"));var b;if(b=a){a:{for(const c in a)if(a.hasOwnProperty(c)){b=!1;break a}b=!0}b=!b}b?(console.log("storeddata if block"),this.storedDataHandle(a)):
roles.hasControls()&&(console.log("fetchlist"),this.interfaceToFetchList(this.cmid));localStorage.removeItem("pollState")},interfaceToSave(a,b){const c=this;b=new FormData;b.append("dataToSave",JSON.stringify(a));b.append("user",virtualclass.gObj.uid);virtualclass.xhr.vxhr.post(`${d.webapi}&methodname=poll_save`,b).then(a=>{a=a.data;const {options:b}=a,f={},d={};b.forEach(a=>{d[a.optid]=a.options});a.copied?(a.options=d,f.questionid=a.qid,f.category=a.category,f.createdby=a.createdby,f.questiontext=
a.question,f.creatorname=a.creatorname,f.options=a.options,c.publishPoll(f),c.interfaceToFetchList(f.category)):c.updatePollList(a);c.currQid=a.qid;c.currOption=d}).catch(a=>{console.error("Request failed with error ",a)})},interfaceToEdit(a){const b=this,c=new FormData;c.append("editdata",JSON.stringify(a));c.append("user",virtualclass.gObj.uid);virtualclass.xhr.vxhr.post(`${d.webapi}&methodname=poll_update`,c).then(a=>{a=a.data;console.log(a);b.updatePollList(a)}).catch(a=>{console.error("Request failed with error ",
a)})},updatePollList(a){const {options:b}=a,c={},d={};b.forEach(a=>{d[a.id]=a.options});c.questionid=a.qid;c.category=a.category;c.createdby=a.createdby;c.questiontext=a.question;c.creatorname=a.creatorname;c.options=d;this.currQid=a.qid;this.currOption=d;(c.category?this.coursePoll:this.sitePoll).push(c);this.interfaceToFetchList(c.category)},interfaceToFetchList(a){const b=this,c=new FormData;c.append("category",JSON.stringify(a));c.append("user",virtualclass.gObj.uid);virtualclass.recorder.items=
[];virtualclass.xhr.vxhr.post(`${d.webapi}&methodname=poll_data_retrieve`,c).then(c=>{c=c.data;for(let a=0;a<=c.length-1;a++){const {options:b}=c[a];for(var f in b)c[a].options[f]=b[f].options,console.log(`getContent ${c[a]}`)}console.log(c);f=c.pop();JSON.parse(a)?(b.coursePoll=c,b.displaycoursePollList()):(b.sitePoll=c,b.displaysitePollList(f))}).catch(a=>{console.error("Request failed with error ",a)})},interfaceToDelete(a){const b=this,c=new FormData;c.append("qid",JSON.stringify(a));c.append("user",
virtualclass.gObj.uid);virtualclass.xhr.vxhr.post(`${d.webapi}&methodname=poll_delete`,c).then(a=>{b.interfaceToFetchList(a.data)}).catch(a=>{console.error("Request failed with error ",a)})},interfaceToDelOption(a){const b=new FormData;b.append("id",JSON.stringify(a));b.append("user",virtualclass.gObj.uid);virtualclass.xhr.vxhr.post(`${d.webapi}&methodname=poll_option_drop`,b).then(()=>{}).catch(a=>{console.error("Request failed with error ",a)})},interfaceToSaveResult(a){const b=this,c=new FormData;
c.append("saveResult",JSON.stringify(a));c.append("user",virtualclass.gObj.uid);virtualclass.xhr.vxhr.post(`${d.webapi}&methodname=poll_result`,c).then(a=>{a&&b.interfaceToFetchList(a.data)}).catch(a=>{console.error("Request failed with error ",a)})},storedDataHandle(a){"displaycoursePollList"==a.currScreen?this.reloadPollList(a,"course"):"displaysitePollList"==a.currScreen?this.reloadPollList(a,"site"):"stdPublish"==a.currScreen?this.reloadStdPublish(a):"teacherPublish"==a.currScreen?this.loadTeacherScrn(a):
"voted"==a.currScreen?(this.reloadVotedScrn(a),setTimeout(()=>{const a=document.querySelector("#virtualclassCont.congrea.student #navigator #pollResult");a&&(a.style.display="none")},700)):"stdPublishResult"==a.currScreen&&this.reloadStdResult(a);localStorage.removeItem("pollState")},reloadPollList(a,b){const c=document.getElementById("coursePollTab"),d=document.getElementById("sitePollTab");let k=0;"course"==b?(d.classList.remove("active"),c.classList.add("active"),k=this.cmid):(c.classList.remove("active"),
d.classList.add("active"));this.interfaceToFetchList(k);a.currScreen==`display${b}PollList`},reloadStdPublish(a){this.dataRec=a.data.stdPoll;this.dataRec.newTime=a.data.timer;this.stdPublish();a={stdPoll:this.dataRec,timer:this.newUserTime};this.pollState.currScreen="stdPublish";this.pollState.data=a},reloadVotedScrn(a){this.dataRec=a.data.stdPoll;this.dataRec.newTime=a.data.timer;(a=document.getElementById("stdPollMszLayout"))&&a.parentNode.removeChild(a);a=this.dataRec.setting.showResult?virtualclass.lang.getString("votesuccess"):
virtualclass.lang.getString("votesuccessPbt");this.showMsg("mszBoxPoll",a,"alert-success");a={stdPoll:this.dataRec,timer:this.newUserTime};this.pollState.currScreen="voted";this.pollState.data=a},reloadStdResult(a){const b=document.getElementById("mszBoxPoll");b&&(b.style.display="none");if(this.dataRec=a.data.stdPoll)this.dataRec.newTime=a.data.timer;this.count=a.data.count;this.currResultView=a.data.view;this.stdPublishResult(this.count);"bar"==this.currResultView?this.updateBarGraph():"pi"==this.currResultView&&
(this.createPiChart(),this.updatePiChart());a={stdPoll:this.dataRec,timer:this.newUserTime,count:this.count,view:this.currResultView};this.pollState.currScreen="stdPublishResult";this.pollState.data=a},loadTeacherScrn(a){console.log("currentscreenpublish");this.dataToStd.question=a.data.question;this.dataToStd.options=a.data.options;this.dataToStd.qId=a.data.qId;this.setting=a.data.setting;this.nTimer=this.newTime=this.newUserTime=a.data.newTime;this.count=a.data.count;this.currResultView=a.data.view;
this.uniqueUsers=a.data.users;var {pollType:b}=a.data;const c=document.getElementById("coursePollTab"),d=document.getElementById("sitePollTab");let k=0;"course"==b?(d.classList.remove("active"),c.classList.add("active"),k=this.cmid):(c.classList.remove("active"),d.classList.add("active"));this.interfaceToFetchList(k);this.list=a.data.list;b={question:this.dataToStd.question,options:this.dataToStd.options,setting:this.setting,newTime:this.nTimer,count:this.count,view:this.currResultView,list:this.list,
totalUsers:a.data.totalUsers,users:this.uniqueUsers,pollType:b,qId:a.data.qId};"yes"!=a.pollClosed&&this.reloadTeacherPublish(a);"undefined"!==typeof a.data.pollClosed&&"yes"!=a.pollClosed&&(this.UI.pollClosedUI(),a=virtualclass.lang.getString("Pclosed"),this.showMsg("resultLayoutHead",a,"alert-success"),this.timer&&clearInterval(this.timer),this.testNoneVoted(),(a=document.getElementById("pollResultMsz"))&&a.parentNode.removeChild(a),b.pollClosed="yes",this.pollState.pollClosed="yes");this.pollState.data=
b;this.pollState.currScreen="teacherPublish";localStorage.removeItem("pollState")},reloadTeacherPublish(a){const {pollType:b}=a.data;virtualclass.modal.closeModalHandler("editPollModal");var c=this.setting.timer;this.UI.resultView(c,b);this.list=a.data.list;this.count=a.data.count;this.currResultView=a.data.view;var {totalUsers:d}=a.data;this.reloadGraph();this.noOfVotes(d);if(c)if({min:c}=this.nTimer,{sec:d}=this.nTimer,c||1<d){var k=document.getElementById("timerWrapper");if(k){var m=document.createElement("div");
m.id="timerCont";k.appendChild(m)}this.showTimer(virtualclass.poll.nTimer,0)}else{if(c||1>=d){if(k=document.getElementById("timerWrapper"))m=document.createElement("div"),m.id="timerCont",k.appendChild(m);m.innerHTML=`${10>c?`0${c}`:c}:${10>d?"00":d}`;this.testNoneVoted();(m=document.getElementById("pollResultMsz"))&&m.parentNode.removeChild(m)}}else({min:c}=a.data.newTime),{sec:d}=a.data.newTime,this.elapsedTimer(c,d);if(m=document.getElementById("modalClose"))m.removeAttribute("data-dismiss"),m.addEventListener("click",
()=>{virtualclass.poll.pollModalClose(b)});this.count=a.data.count;this.pollState.currScreen="teacherPublish"},pollModalClose(a){roles.hasControls()&&virtualclass.poll.pollState.currScreen&&"teacherPublish"==virtualclass.poll.pollState.currScreen&&(virtualclass.poll.pollState.currScreen="course"==a?"displaycoursePollList":"displaysitePollList");const b=virtualclass.lang.getString("pclosetag");virtualclass.popup.confirmInput(b,this.resultCloseConfirm,a)},resultCloseConfirm(a){if(a){(a=document.querySelector("#editPollModal"))&&
a.remove();if(virtualclass.poll.timer){ioAdapter.mustSend({poll:{pollMsg:"stdPublishResult",data:virtualclass.poll.count},cf:"poll"});virtualclass.poll.resultToStorage();var b={qid:virtualclass.poll.dataToStd.qId,list:virtualclass.poll.list}}virtualclass.poll.timer&&(virtualclass.poll.interfaceToSaveResult(b),clearInterval(virtualclass.poll.timer),virtualclass.poll.timer=0);if(b=document.getElementById("congreaPollVoters"))b.innerHTML=virtualclass.lang.getString("receivedVotes");virtualclass.poll.count=
{}}},resultToStorage(){var a=roles.hasControls()?this.dataToStd:this.dataRec;a&&(a={result:this.count,qid:a.qId,pollData:a},this.uid++,a.uid=this.uid,roles.hasControls()||virtualclass.storage.pollStore(JSON.stringify(a)))},reloadGraph(){"bar"==this.currResultView?(this.showGraph(),this.updateBarGraph()):"pi"==this.currResultView?(this.createPiChart(),this.updatePiChart()):"list"==this.currResultView&&this.listView();var a=document.getElementsByClassName("emptyList"),b=document.getElementById("chart");
if(0<this.list.length)for(b=0;b<a.length;b++)a[b].style.display="none";else b.style.display="none";if(a=document.querySelectorAll("#chartMenuCont button"))for(b=0;b<a.length;b++)a[b].classList.remove("disabled")},saveInLocalStorage(){console.log(`pollinlocalstorage${this.pollState}`);console.log(this.pollState.data);console.log(this.pollState);localStorage.setItem("pollState",JSON.stringify(this.pollState))},onmessage(a,b){"stdPublish"==a.poll.pollMsg&&(this.dataRec=a.poll.data);console.log(`student side ${a.poll.pollMsg}`);
virtualclass.poll[a.poll.pollMsg].call(this,a.poll.data,b);"stdPublishResult"==a.poll.pollMsg&&this.resultToStorage()},pollPopUp(a,b,c){const f=function(){console.log(this.id);virtualclass.poll.action(this.id,a,b,c);"goBack"!=this.id&&"cacelSetting"!=this.id||virtualclass.modal.removeModal()},d=(document.getElementById("editPollModal")?document.getElementById("editPollModal"):document.getElementById("qnPopup")).querySelectorAll("#pollModalBody .controls");for(let a=0;a<d.length;a++)d[a].addEventListener("click",
f)},attachConfirmInit(a,b,c,d){this.action(a,b,c,d)},action(a,b,c,d){b(a,c,d)},displaycoursePollList(){const a=this;this.dispList("course");var b=document.querySelector("#listQnContcourse tbody");if(b)for(;b.childNodes.length;)b.removeChild(b.lastChild);b=document.querySelector("#listQnContcourse");if(this.coursePoll.length){b&&(b.style.display="block");var c=document.querySelector("#mszBoxPoll");c.style.display="none";this.coursePoll.forEach((b,c)=>{a.forEachPoll(b,c,"course")})}else{c=document.querySelector("#mszBoxPoll");
const a=virtualclass.lang.getString("noPoll");c.style.display="block";c.innerHTML=a;b&&(b.style.display="none")}(b=document.getElementById("emptyListsite"))&&b.parentNode.removeChild(b);this.dispNewPollBtn("course");"teacherPublish"!=this.pollState.currScreen&&(this.pollState.currScreen="displaycoursePollList")},displaysitePollList(a){const b=this;this.dispList("site");var c=document.querySelector("#listQnContsite tbody");if(c)for(;c.childNodes.length;)c.removeChild(c.lastChild);c=document.querySelector("#listQnContsite");
if(this.sitePoll.length){this.sitePoll.forEach((c,f)=>{b.forEachPoll(c,f,"site",a)});c&&(c.style.display="block");var d=document.querySelector("#mszBoxPoll");d.style.display="none"}else{d=document.querySelector("#mszBoxPoll");let b=virtualclass.lang.getString("noPoll");"false"==a&&(b=virtualclass.lang.getString("noPollNoAdmin"));d.style.display="block";d.innerHTML=b;c&&(c.style.display="none")}(c=document.getElementById("emptyListcourse"))&&c.parentNode.removeChild(c);this.dispNewPollBtn("site",a);
"teacherPublish"!=this.pollState.currScreen&&(this.pollState.currScreen="displaysitePollList")},dispList(a){var b=document.getElementById("mszBoxPoll");0<b.childNodes.length&&b.childNodes[0].parentNode.removeChild(b.childNodes[0]);b="course"==a?"site":"course";this.hidePollList(b);var c=document.getElementById(`listQnCont${a}`);c?(c.style.display="table",(c=document.getElementById(`newPollBtn${a}`))&&c.classList.contains(b)&&(c.classList.remove(b),c.classList.add(a))):this.UI.layout2("layoutPollBody",
a)},dispNewPollBtn(a,b){this.attachEvent(`newPollBtn${a}`,"click",this.newPollHandler,a);var c=document.getElementById(`newPollBtn${a}`);"site"==a?("undefined"!==typeof b&&"true"==b?c.style.display="table":(c.style.display="none",roles.hasControls&&(a=document.getElementById("listQnContsite"),a.classList.add("teacherTableHeader"))),c=document.getElementById("newPollBtncourse")):(roles.hasControls&&(a=document.getElementById("listQnContsite"),a.classList.remove("teacherTableHeader")),c.style.display=
"table",c=document.getElementById("newPollBtnsite"));c&&(c.style.display="none")},forEachPoll(a,b,c,d){const f={};f.questiontext=a.questiontext;f.creator=a.creatorname;f.pollType=c;f.index=b;const g=virtualclass.getTemplate("qn","poll");(document.querySelector(`#listQnCont${c} .pollList tbody`)||document.querySelector(`#listQnCont${c} .pollList`)).insertAdjacentHTML("beforeend",g({pollQn:f}));if("course"==c&&a.createdby==wbUser.id||"site"==c&&"true"==d){if(a.isPublished){if(d=document.querySelector(`#editQn${c}${b} span`))d.setAttribute("title",
virtualclass.lang.getString("etDisabledA")),d.style.cursor="default",d.classList.add("disabled")}else this.attachEvent(`editQn${c}${b}`,"click",this.editHandler,a,c,b,a.createdby,a.questionid);this.attachEvent(`deleteQn${c}${b}`,"click",this.deleteHandler,a,c,b)}else{if(d=document.querySelector(`#editQn${c}${b} span`))d.setAttribute("title",virtualclass.lang.getString("etDisabledCr")),d.style.cursor="default",d.classList.add("disabled");d=document.querySelector(`#deleteQn${c}${b} span`);d.setAttribute("title",
virtualclass.lang.getString("dltDisabled"));d.style.cursor="default";d.classList.add("disabled")}d="course"==c?virtualclass.poll.coursePoll:virtualclass.poll.sitePoll;if(b==d.length-1||b==d.length-2||b==d.length-3)d=document.querySelector(`#contQn${c}${b}`),d.classList.add("lastNode");this.attachEvent(`publishQn${c}${b}`,"click",this.publishHandler,a,c,b);this.previewOnHover(a,c,b)},previewOnHover(a,b,c){const f={};document.querySelector(`#qnText${b}${c} .popover-content`)||(f.questiontext=a.questiontext,
f.options=a.options,a=virtualclass.getTemplate("previewPopup","poll")({data:f}),virtualclass.modal.attachpopupHandler(b,c,a))},attachEvent(a,b,c,d,k,m,n,q,r){q=document.getElementById(a);null!=q&&q.addEventListener(b,()=>{"undefined"!==typeof d?c(d,k,m,a,n,r):c(k,m,a,n,r)})},hidePollList(a){if(a=document.getElementById(`listQnCont${a}`))a.style.display="none"},editHandler(a,b,f){a=document.getElementById("mszBoxPoll");0<a.childNodes.length&&a.childNodes[0].parentNode.removeChild(a.childNodes[0]);
a={};c="course"==b?virtualclass.poll.coursePoll[f]:virtualclass.poll.sitePoll[f];a.options=c.options;a.questiontext=c.questiontext;const d=virtualclass.getTemplate("edit-modal","poll");document.querySelector("#bootstrapCont").insertAdjacentHTML("beforeend",d({data:a}));virtualclass.poll.UI.editPoll(b,f);virtualclass.modal.closeModalHandler("editPollModal")},stdResponse(a,b){this.updateResponse(a,b)},newPollHandler(a){const b=document.querySelector("#createPollCont");var c=document.querySelector("#editPollModal");
c&&c.remove();c=virtualclass.getTemplate("modal","poll");b.insertAdjacentHTML("beforeend",c());virtualclass.modal.closeModalHandler("editPollModal");virtualclass.poll.pollPopUp(virtualclass.poll.popupFn,void 0,a)},popupFn(a,b,c){virtualclass.poll[a].call(virtualclass.poll,b,c,a)},next(a,b){virtualclass.poll.pollSetting(b,a)},goBack(a,b){console.log("modal dismiss")},etSave(a,b,c){var f=virtualclass.poll.isBlank();if(!f)return 0;f="course"==b?virtualclass.poll.coursePoll[a]:virtualclass.poll.sitePoll[a];
const d="course"==b?virtualclass.poll.cmid:0,m=document.getElementById("q");document.getElementById("etSave").setAttribute("data-dismiss","modal");if("undefined"!==typeof a)virtualclass.poll.saveQuestion(m,a,b),virtualclass.poll.saveOption(a,b),virtualclass.poll.interfaceToEdit({questionid:f.questionid,question:f.questiontext,options:f.options,createdby:f.createdby},d);else if(f=virtualclass.poll.newPollSave("undefined",b),!f)return 0;"etSave"==c&&virtualclass.modal.removeModal();return 1},closePoll(a){const b=
virtualclass.lang.getString("pclose");virtualclass.popup.confirmInput(b,virtualclass.poll.askConfirmClose,"close",a)},saveQuestion(a,b,c){"course"==c?(this.coursePoll[b].questiontext=a.value,this.coursePoll[b].creator=wbUser.name):(this.sitePoll[b].questiontext=a.value,this.sitePoll[b].creator=wbUser.name);console.log(this.coursePoll);document.getElementById(`qnText${c}${b}`).innerHTML=a.value},saveOption(a,b){const c=[];let d=0;var k;a="course"==b?this.coursePoll[a]:this.sitePoll[a];const m=document.getElementById("optsTxCont").querySelectorAll("#virtualclassCont #optsTxCont .opt");
for(b=0;b<m.length;b++)c[b]=m[b].value;for(k in a.options)a.options[k]=c[d],d++;if(b>d)for(d,k=d;k<b;k++)a.options[`noid${d}`]=c[d],d++},hideModal(){virtualclass.modal.removeModal()},newPollSave(a,b){a=0;const c=[];if(!virtualclass.poll.isBlank())return 0;var d=document.getElementById("optsTxCont").querySelectorAll("#virtualclassCont #optsTxCont .opt");for(let a=0;a<d.length;a++)c.push(d[a].value);d=document.getElementById("q");"course"==b&&(a=virtualclass.poll.cmid);virtualclass.poll.interfaceToSave({question:d.value,
options:c,action:"newPollSave",category:a,copied:!1},a);return 1},isBlank(){document.getElementById("q");var a=document.getElementById("optsTxCont").querySelectorAll("#virtualclassCont #optsTxCont .opt");let b=0,c=0;for(let f=0;f<a.length;f++)null==a[f].value||""===a[f].value.trim()?c++:b++;a=document.getElementById("q");return null==a.value||""===a.value.trim()?(virtualclass.lang.getString("pollblank"),alert(virtualclass.lang.getString("pollblank")),0):2>b?(alert(virtualclass.lang.getString("minoption")),
0):c?(alert(virtualclass.lang.getString("delblank")),0):1},saveNdPublish(a,b){var c=virtualclass.poll.isBlank();if(!c)return 0;c=`${b}Poll`;var {length:d}=virtualclass.poll[c],k=document.getElementById("optsTxCont");k=k.querySelectorAll("#virtualclassCont #optsTxCont .opt");if("undefined"===typeof a){var {length:d}=virtualclass.poll[c],m=document.getElementById("q").value;c={};k=document.getElementById("optsTxCont");k=k.querySelectorAll("#virtualclassCont #optsTxCont .opt");for(var n=0;n<k.length;n++)c[n]=
k[n].value;virtualclass.poll.dataToStd.question=m;virtualclass.poll.dataToStd.options=c;(c=virtualclass.poll.newPollSave(d,b,!0))&&virtualclass.poll.pollSetting(b,d,!0)}else{d=virtualclass.poll[c][a];m=document.getElementById("q").value;d.question=m;m=0;for(n in d.options)d.options[n]=k[m].value,m++;virtualclass.poll[c][a].questiontext=document.getElementById("q").value;virtualclass.poll.dataToStd.question=virtualclass.poll[c][a].questiontext;virtualclass.poll.dataToStd.options=virtualclass.poll[c][a].options;
(c=virtualclass.poll.etSave(a,b,void 0))&&virtualclass.poll.pollSetting(b,a,!0)}a={type:"course",qid:a,pollqnOps:virtualclass.poll.dataToStd};virtualclass.poll.pollState.currScreen="setting";virtualclass.poll.pollState.data=a},pollCancel(){virtualclass.popup.closeElem();virtualclass.modal.closeModalHandler("editPollModal")},reset(){const a=document.querySelectorAll("#editPollModal textArea");for(let b=0;b<a.length;b++)a[b].value=""},addMoreOption(a,b){virtualclass.poll.UI.createOption(a,b)},removeOption(a,
b,c){const f=c.replace("remove","");c=document.getElementById(c);c.parentNode.parentNode.removeChild(c.parentNode);a="course"==a?virtualclass.poll.coursePoll[b]:virtualclass.poll.sitePoll[b];"undefined"!==typeof a&&(delete a.options[f],virtualclass.poll.interfaceToDelOption(f))},publishHandler(a,b,c){var f=document.getElementById("mszBoxPoll");0<f.childNodes.length&&f.childNodes[0].parentNode.removeChild(f.childNodes[0]);({isPublished:f}=a);f?virtualclass.poll.duplicatePoll(a):virtualclass.poll.publishPoll(a,
b,c)},duplicatePoll(a){const b=[];for(const c in a.options)b.push(a.options[c]);virtualclass.poll.interfaceToSave({question:a.questiontext,options:b,action:"newPollSave",category:a.category,copied:!0},a.category)},publishPoll(a,b){virtualclass.poll.dataToStd.question=a.questiontext;virtualclass.poll.dataToStd.qId=a.questionid;virtualclass.poll.dataToStd.options=a.options;var c=document.getElementById("layoutPollBody"),d=document.createElement("div");d.className="container";c.appendChild(d);(c=document.getElementById("editPollModal"))&&
c.remove();c={};c.questiontext=a.questiontext;c.options=a.options;d=virtualclass.getTemplate("preview-modal","poll");const k=document.querySelector("#virtualclassApp #bootstrapCont");k&&k.insertAdjacentHTML("beforeend",d({poll:c}));b||(b="0"==a.category?"site":"course");virtualclass.poll.pollPreview(b);virtualclass.modal.closeModalHandler("editPollModal")},pollPreview(a){const b=document.getElementById("contFooter");virtualclass.poll.UI.previewFooterBtns(b,a)},publishHandler2(){virtualclass.poll.showMsg("mszBoxPoll",
"poll published","alert-success")},deleteHandler(a,b,c){a=document.getElementById("mszBoxPoll").querySelectorAll("#mszBoxPoll .alert");0<a.length&&a[0].parentNode.removeChild(a[0]);a=virtualclass.lang.getString("pollDel");virtualclass.popup.confirmInput(a,virtualclass.poll.askConfirm,b,c)},showMsg(a,b,c){let f=document.getElementById(a);if(!f){const b=document.getElementById("layoutPollBody");f=document.createElement("div");f.id=a;b.appendChild(f)}const d=document.createElement("div");d.className=
"alert  alert-dismissable";d.classList.add(c);d.innerHTML=b;f.insertBefore(d,f.firstChild);a=document.createElement("button");a.className="close";a.setAttribute("data-dismiss","alert");a.innerHTML="&times";d.appendChild(a);a.addEventListener("click",()=>{d.parentNode.removeChild(d)})},askConfirm(a,b,c){if(a){a=document.getElementById(`contQn${b}${c}`);a.parentNode.removeChild(a);a=virtualclass.lang.getString("Pdsuccess");virtualclass.poll.showMsg("mszBoxPoll",a,"alert-success");a="course"==b?virtualclass.poll.coursePoll[c]:
virtualclass.poll.sitePoll[c];const f=a.questionid;a="course"==b?virtualclass.poll.coursePoll:virtualclass.poll.sitePoll;a.splice(c,1);virtualclass.poll.interfaceToDelete(f)}},askConfirmClose(a,b,c){if(a){(virtualclass.poll.setting.showResult&&roles.hasControls()||!roles.hasControls())&&ioAdapter.mustSend({poll:{pollMsg:"stdPublishResult",data:virtualclass.poll.count},cf:"poll"});virtualclass.poll.resultToStorage();virtualclass.poll.UI.pollClosedUI();virtualclass.poll.interfaceToSaveResult({qid:virtualclass.poll.dataToStd.qId,
list:virtualclass.poll.list});a=virtualclass.lang.getString("Pclosed");virtualclass.poll.showMsg("resultLayoutHead",a,"alert-success");virtualclass.poll.pollState.data.pollClosed="yes";clearInterval(virtualclass.poll.timer);a=virtualclass.poll.timer=0;for(var f in virtualclass.poll.count)virtualclass.poll.count[f]&&(a=1);if(a)f=document.getElementById("chart"),"list"!=virtualclass.poll.currResultView&&(f.style.display="block");else{virtualclass.poll.noneVoted(c);if(c=document.getElementById("resultLayoutHead"))for(f=
0;f<c.childNodes.length;f++)c.childNodes[f].parentNode.removeChild(c.childNodes[f]);f=document.getElementById("pollResultMsz");f.parentNode.removeChild(f);f=document.getElementById("chartMenuCont");f.parentNode.removeChild(f)}}},showStudentPollReport(a){virtualclass.poll.studentReportLayout(a);(a=document.getElementById("mszBoxPoll"))&&a.parentNode.removeChild(a)},studentReportLayout(a){for(var b=document.getElementById("layoutPollBody");1<b.childElementCount;)b.removeChild(b.lastChild);const c=document.createElement("div");
b.appendChild(c);b=a.result;virtualclass.poll.count=b;virtualclass.poll.dataRec=a.pollData;virtualclass.poll.stdPublishResult(b,"true")},timerDisable(){document.getElementById("timer").classList.add("disabled")},stdPublish(){var a=document.getElementById("mszBoxPoll");a&&0<a.childNodes.length&&a.childNodes[0].parentNode.removeChild(a.childNodes[0]);virtualclass.poll.timer&&clearInterval(virtualclass.poll.timer);(a=document.getElementById("resultLayout"))&&a.parentNode.removeChild(a);(a=document.getElementById("stdPollContainer"))&&
a.parentNode.removeChild(a);if(a=document.querySelector(".congrea.student #virtualclassPoll #navigator #stdPollHeader"))a.style.display="block";a={};a.question=virtualclass.poll.dataRec.options;var b=virtualclass.getTemplate("pollStd","poll");document.querySelector("#layoutPollBody").insertAdjacentHTML("beforeend",b({poll:a}));this.UI.stdPublishUI();virtualclass.poll.dataRec.setting.timer?(a=virtualclass.poll.dataRec.newTime,virtualclass.poll.newTimer=a,this.showTimer(a),a=document.querySelector("#timerLabel"),
a.innerHTML=virtualclass.lang.getString("Rtime")):(this.elapsedTimer(),a=virtualclass.lang.getString("Tmyclose"),virtualclass.poll.showMsg("stdContHead",a,"alert-success"),a=document.querySelector("#timerLabel"),a.innerHTML=virtualclass.lang.getString("ETime"));a=document.getElementById("stdQnCont");this.showQn(a);a=document.getElementById("stdOptionCont");this.showOption(a);(a=document.getElementById("btnVote"))&&a.addEventListener("click",virtualclass.poll.voted);a={stdPoll:virtualclass.poll.dataRec,
timer:virtualclass.poll.newUserTime};if(b=document.querySelector("#virtualclassCont.congrea.student #navigator #pollResult"))b.style.display="none";virtualclass.poll.pollState.currScreen="stdPublish";virtualclass.poll.pollState.data=a},voted(){virtualclass.poll.pollState.currScreen="voted";if(!document.querySelector("#virtualclassCont.congrea #stdPollContainer #btnVote").classList.contains("disabled"))if(virtualclass.poll.saveSelected()){virtualclass.poll.timer&&clearInterval(virtualclass.poll.timer);
var a=document.getElementById("stdPollMszLayout");a&&a.parentNode.removeChild(a);a=document.getElementById("stdPollContainer");a.parentNode.removeChild(a);a=virtualclass.poll.dataRec.setting.showResult?virtualclass.lang.getString("votesuccess"):virtualclass.lang.getString("votesuccessPbt");document.querySelector(".congrea.student #mszBoxPoll").style.display="block";virtualclass.poll.showMsg("mszBoxPoll",a,"alert-success");virtualclass.poll.sendResponse()}else alert("Select an option");a={stdPoll:virtualclass.poll.dataRec,
timer:virtualclass.poll.newUserTime};virtualclass.poll.pollState.currScreen="voted";virtualclass.poll.pollState.data=a},sendResponse(){const a=virtualclass.vutil.whoIsTeacher();ioAdapter.mustSendUser({poll:{pollMsg:"stdResponse",data:virtualclass.poll.responseId},cf:"poll"},a)},timeStamp(a){virtualclass.poll.newTimer=a},saveSelected(){const a=document.getElementById("stdOptionCont").querySelectorAll("#stdOptionCont .opt");for(var b=0;b<a.length;b++)if(a[b].checked)return virtualclass.poll.responseId=
a[b].id,1;if(b==a.length)return 0},elapsedTimer(a,b){virtualclass.poll.hasOwnProperty("timer")&&clearInterval(virtualclass.poll.timer);const c=document.getElementById("timerLabel");c&&(c.innerHTML=virtualclass.lang.getString("ETime"));if(a||b)var d=a,k=b;else d=k=0;if(roles.hasControls())var m=document.getElementById("timerCont");else{if(a=document.getElementById("stdContHead"))m=document.querySelector("#timerCont"),null==m&&(m=document.createElement("div"),m.id="timerCont",a.appendChild(m));d=virtualclass.poll.dataRec.newTime.min;
k=virtualclass.poll.dataRec.newTime.sec}a=function(){m?(k++,60==k&&(k=0,d++,60==d&&(d=0)),virtualclass.poll.newUserTime.min=d,virtualclass.poll.newUserTime.sec=k,m.innerHTML=`${10>d?`0${d}`:d}:${10>k?`0${k}`:k}`):clearInterval(virtualclass.poll.timer)};a();virtualclass.poll.timer=setInterval(a,1E3)},showTimer(a,b){virtualclass.poll.timer&&clearInterval(virtualclass.poll.timer);const c=document.getElementById("timerCont");roles.hasControls()&&virtualclass.poll.pollState.data&&(virtualclass.poll.pollState.data.newTime=
virtualclass.poll.newUserTime,console.log(`test${virtualclass.poll.pollState.data.newTime}`));var d=0,k=0;roles.hasControls()&&("undefined"!==typeof a.digit?(b=a.digit,{unit:a}=a,k=b,d=0,"minut"==a&&(d=b,k=0)):"undefined"!==typeof a.min&&(d=a.min,k=a.sec));roles.hasControls()||!virtualclass.poll.newTimer.min&&!virtualclass.poll.newTimer.sec||(d=virtualclass.poll.newTimer.min,k=virtualclass.poll.newTimer.sec,virtualclass.poll.newTimer={});a=function(){c?(virtualclass.poll.newUserTime.min=d,virtualclass.poll.newUserTime.sec=
k,c.innerHTML=`${10>d?`0${d}`:d}:${10>k?`0${k}`:k}`,console.log(`testtimer${virtualclass.poll.timer}`),k--,0>=k&&(k=59,d--,0>d&&(k=d=0,c.innerHTML=`${10>d?`0${d}`:d}:${10>k?`0${k}`:k}`,clearInterval(virtualclass.poll.timer),virtualclass.poll.timerExpired()))):clearInterval(virtualclass.poll.timer)};if(d||k)a(),virtualclass.poll.timer=setInterval(a,1E3)},timerExpired(){var a=document.getElementById("btnVote");a&&a.classList.add("disabled");roles.hasControls()&&(virtualclass.poll.setting.showResult&&
ioAdapter.mustSend({poll:{pollMsg:"stdPublishResult",data:virtualclass.poll.count},cf:"poll"}),virtualclass.poll.timer&&virtualclass.poll.interfaceToSaveResult({qid:virtualclass.poll.dataToStd.qId,list:virtualclass.poll.list}),this.testNoneVoted());virtualclass.poll.timer=0;if(a=document.getElementById("congreaPollVoters"))a.innerHTML=virtualclass.lang.getString("rvtu");virtualclass.poll.pollState.data.pollClosed="yes"},testNoneVoted(){var a=0,b;for(b in virtualclass.poll.count)virtualclass.poll.count[b]&&
(a=1);if(a)(b=document.getElementById("chart"))&&"list"!=virtualclass.poll.currResultView&&(b.style.display="block");else{this.noneVoted();if(a=document.getElementById("resultLayoutHead"))for(b=0;b<a.childNodes.length;b++)a.childNodes[b].parentNode.removeChild(a.childNodes[b]);b=document.getElementById("pollResultMsz");b.parentNode.removeChild(b);b=document.getElementById("chartMenuCont");b.parentNode.removeChild(b)}},stdPublishResult(a,b){virtualclass.poll.count=a;virtualclass.poll.timer&&clearInterval(virtualclass.poll.timer);
if(virtualclass.poll.dataRec||b)virtualclass.poll.dataRec.setting.showResult?this.resultDisplay(a):(this.noResultDisplay(),a=document.getElementById("resultLayoutHead"),virtualclass.poll.UI.resultNotShownUI(a),virtualclass.poll.pollState.currScreen="stdPublishResult",virtualclass.poll.pollState.data="noResult");virtualclass.poll.resultToStorage()},resultDisplay(a){var b=document.querySelector(".congrea #stdPollContainer");b&&(b.style.display="none");(b=document.getElementById("resultLayout"))&&b.parentNode.removeChild(b);
virtualclass.poll.UI.createResultLayout();document.getElementById("resultLayout");b=document.getElementById("timerWrapper");b.parentNode.removeChild(b);b=document.getElementById("resultLayout");b.classList.add("bootstrap","container");virtualclass.poll.count=a;(a=document.getElementById("mszBoxPoll"))&&0<a.childNodes.length&&(a=a.querySelectorAll("#mszBoxPoll .alert"),0<a.length&&a[0].parentNode.removeChild(a[0]));(b=document.getElementById("chartMenuCont"))&&virtualclass.poll.UI.chartMenu(b);a=0;
for(var c in virtualclass.poll.count)virtualclass.poll.count[c]&&(a=1);a?(virtualclass.poll.showGraph(),document.getElementById("chart").style.display="block"):this.noneVoted();c={stdPoll:virtualclass.poll.dataRec,timer:virtualclass.poll.newUserTime,count:virtualclass.poll.count};virtualclass.poll.pollState.currScreen="stdPublishResult";virtualclass.poll.pollState.data=c},noResultDisplay(){var a=document.getElementById("stdPollContainer");a&&a.parentNode.removeChild(a);virtualclass.poll.UI.createResultLayout();
var b=document.getElementById("resultLayoutHead");if(b)for(a=0;a<b.childNodes.length;a++)b.childNodes[a].parentNode.removeChild(b.childNodes[a]);if(b=document.getElementById("resultLayoutBody"))for(a=0;a<b.childNodes.length;a++)b.childNodes[a].parentNode.removeChild(b.childNodes[a])},noneVoted(a){"undefined"!==typeof virtualclass.poll.timer&&clearInterval(virtualclass.poll.timer);this.noResultDisplay();var b=document.querySelector("#resultLayoutHead");b&&(b.style.display="none");document.querySelector("#qnLabelCont");
if(b=document.querySelector("#chartMenuCont"))b.style.display="none";b=document.getElementById("resultLayoutBody");var c=document.createElement("div");c.className="pollResultNotify";c.id="resultNote";b.appendChild(c);b.insertBefore(c,b.firstChild);c=virtualclass.lang.getString("Pclosed");virtualclass.poll.showMsg("resultNote",c,"alert-error");c=document.getElementById("resultNote");const d=document.createElement("div");d.className="notifyText alert alert-info";d.id="congreaPollNote";d.innerHTML=virtualclass.lang.getString("Novote");
c.appendChild(d);c=virtualclass.poll.dataRec;roles.hasControls()||this.showPollText(b,c);(b=document.getElementById("modalClose"))&&b.addEventListener("click",()=>{const b=document.querySelector("#editPollModal");b&&b.remove();roles.hasControls()&&a&&virtualclass.poll.pollState.currScreen&&"teacherPublish"==virtualclass.poll.pollState.currScreen&&(virtualclass.poll.pollState.currScreen="course"==a?"displaycoursePollList":"displaysitePollList")})},showPollText(a){var b=roles.hasControls()?virtualclass.poll.dataToStd:
virtualclass.poll.dataRec;a={};a.question=b.question;a.options=b.options;b=virtualclass.getTemplate("qnOptions","poll");document.querySelector("#resultLayoutBody #optnNonVotd").insertAdjacentHTML("beforeend",b({poll:a}))},showQn(a){roles.hasControls()?a.innerHTML=virtualclass.poll.dataToStd.question:a.innerHTML=virtualclass.poll.dataRec.question},showOption(a){const b=roles.hasControls()?virtualclass.poll.dataToStd:virtualclass.poll.dataRec;var {options:c}=b;for(const f in c){c=document.createElement("div");
a.appendChild(c);var d=document.createElement("input");d.className="opt";d.setAttribute("name","option");d.setAttribute("value",f);d.setAttribute("type","radio");d.id=f;c.appendChild(d);d=document.createElement("span");d.className="stdoptn";c.appendChild(d);d.innerHTML=b.options[f]}},pollSetting(a,b,c){virtualclass.poll.UI.hidePrevious(b);null==document.getElementById(`settingTx${b}`)&&virtualclass.poll.UI.pollSettingUI(b,a);"undefined"!==typeof c&&document.getElementById("publish").setAttribute("disable",
!0);document.getElementById("publish").addEventListener("click",()=>{virtualclass.poll.saveSetting(a,c)});document.getElementById("cancelSetting").addEventListener("click",()=>{virtualclass.modal.removeModal("editPollModal")});virtualclass.modal.closeModalHandler("editPollModal")},saveSetting(a,b){if(document.getElementById("radioBtn2")){var c=document.getElementById("radioBtn2").checked;virtualclass.poll.setting.timer=c}const d=document.getElementById("timer");if(d){virtualclass.poll.setting.time.digit=
d.options[d.selectedIndex].value;var k=document.getElementById("ut");virtualclass.poll.setting.time.unit=k.options[k.selectedIndex].value;k=Date.now();console.log(`sender TimeStamp${Date.now()}`);virtualclass.poll.setting.time.timestamp=k}document.getElementById("pollCkbox")&&(k=document.getElementById("pollCkbox").checked,virtualclass.poll.setting.showResult=k);virtualclass.poll.UI.resultView(c,a);virtualclass.poll.currResultView="bar";c?virtualclass.poll.showTimer(virtualclass.poll.setting.time,
0):virtualclass.poll.elapsedTimer();"undefined"!==typeof b&&(virtualclass.poll.dataToStd.qId=virtualclass.poll.currQid,virtualclass.poll.dataToStd.options=virtualclass.poll.currOption);a={question:virtualclass.poll.dataToStd.question,options:virtualclass.poll.dataToStd.options,qId:virtualclass.poll.dataToStd.qId,setting:virtualclass.poll.setting,newTime:virtualclass.poll.newUserTime,count:virtualclass.poll.count,list:virtualclass.poll.list,users:virtualclass.poll.uniqueUsers,pollType:a};"undefined"!==
typeof virtualclass.poll.afterReload&&(a.newTime=virtualclass.poll.afterReload,delete virtualclass.poll.afterReload);d&&(ioAdapter.mustSend({poll:{pollMsg:"stdPublish",data:a},cf:"poll"}),console.log(`to send${a}`));a.view=virtualclass.poll.currResultView;virtualclass.poll.showGraph();virtualclass.poll.updateBarGraph();virtualclass.poll.pollState.currScreen="teacherPublish";virtualclass.poll.pollState.data=a},updateResponse(a,b){var c=document.getElementById("chart");c&&"list"!=virtualclass.poll.currResultView&&
(c.style.display="block");if(c=document.getElementById("pollResultMsz"))c.style.display="none";c=document.querySelectorAll("#chartMenuCont button");for(let a=0;a<c.length;a++)c[a].classList.remove("disabled");c={};"undefined"===typeof virtualclass.poll.count[a]&&(virtualclass.poll.count[a]=0);virtualclass.poll.count[a]+=1;c[b.userid]=a;c.username=b.name;virtualclass.poll.list.push(c);"bar"==virtualclass.poll.currResultView?(virtualclass.poll.showGraph(),virtualclass.poll.updateBarGraph()):"pi"==virtualclass.poll.currResultView?
virtualclass.poll.updatePiChart():"list"==virtualclass.poll.currResultView&&virtualclass.poll.updateListResult()},noOfVotes(a){var b=virtualclass.hasOwnProperty("connectedUsers")?virtualclass.connectedUsers.length:0;let c=0;for(const a in virtualclass.poll.count)c+=virtualclass.poll.count[a];b=b?b-1:0;virtualclass.poll.pollState.data&&(virtualclass.poll.pollState.data.totalUsers=a||b);(a=virtualclass.poll.uniqueUsers.length?virtualclass.poll.uniqueUsers.length:0)&&(b=a);a=document.getElementById("receivedVotes");
null!=a&&(a.innerHTML=`${c}\/${b}`)},updateBarGraph(){const a=document.getElementById("chart"),b=document.getElementById("pollResultMsz"),c=[],d=roles.hasControls()?virtualclass.poll.dataToStd:virtualclass.poll.dataRec;for(var k in virtualclass.poll.count)c.push([d.options[k],virtualclass.poll.count[k]]),virtualclass.poll.count[k]&&(a&&(a.style.display="block"),b&&(b.style.display="none"));for(k in d.options)virtualclass.poll.count.hasOwnProperty(k)||(c.push([d.options[k],"0"]),virtualclass.poll.count[k]=
0);virtualclass.poll.chart&&virtualclass.poll.chart.load({columns:c});roles.hasControls()&&this.noOfVotes()},updatePiChart(){const a=document.getElementById("chart"),b=document.getElementById("pollResultMsz");this.noOfVotes();const c=roles.hasControls()?virtualclass.poll.dataToStd:virtualclass.poll.dataRec,d=[];for(var k in virtualclass.poll.count)d.push([c.options[k],virtualclass.poll.count[k]]),virtualclass.poll.count[k]&&(a&&(a.style.display="block"),b&&(b.style.display="none"));for(k in c.options)virtualclass.poll.count.hasOwnProperty(k)||
(d.push([c.options[k],"0"]),virtualclass.poll.count[k]=0);virtualclass.poll.piChart&&virtualclass.poll.piChart.load({columns:d})},updateListResult(){this.noOfVotes();const a=virtualclass.poll.list.pop();virtualclass.poll.addResultListItem(a);virtualclass.poll.list.push(a);virtualclass.poll.pollState.data.list=virtualclass.poll.list},createPiChart(){const a=roles.hasControls()?virtualclass.poll.dataToStd:virtualclass.poll.dataRec;virtualclass.poll.currResultView="pi";const b=document.getElementById("chart");
b.style.display="none";var c=document.getElementById("listCont");c&&(c.style.display="none");c=[];let d=!1;for(const b in virtualclass.poll.count)c.push([a.options[b],virtualclass.poll.count[b]]),virtualclass.poll.count[b]&&(d=!0);d&&(b.style.display="block");virtualclass.poll.piChart=c3.generate({data:{columns:c,transition:{duration:null},type:"pie",onclick(a,b){console.log("onclick",a,b)},onmouseover(a,b){console.log("onmouseover",a,b)},onmouseout(a,b){console.log("onmouseout",a,b)}}});virtualclass.poll.currResultView=
"pi";"undefined"!==typeof virtualclass.poll.pollState.data&&(virtualclass.poll.pollState.data.view="pi")},listView(){virtualclass.poll.currResultView="list";document.getElementById("chart").style.display="none";var a=document.getElementById("resultLayoutBody"),b=document.getElementById("listCont");b.hasChildNodes()&&b.removeChild(b.childNodes[0]);0<virtualclass.poll.list.length&&(virtualclass.poll.createResponseTable(a),(a=document.getElementById("pollResultMsz"))&&a.parentNode.removeChild(a));if(b=
document.getElementById("listCont"))b.style.display="block"},createResponseTable(a){a=virtualclass.getTemplate("pollresultlist","poll");document.querySelector("#virtualclassApp #listCont").insertAdjacentHTML("beforeend",a({}));virtualclass.poll.list.forEach((a,c)=>{virtualclass.poll.addResultListItem(a,c)});virtualclass.poll.currResultView="list";"undefined"!==typeof virtualclass.poll.pollState.data&&(virtualclass.poll.pollState.data.view="list",virtualclass.poll.pollState.data.list=virtualclass.poll.list)},
addResultListItem(a){const b=virtualclass.poll.dataToStd.options;var c=document.getElementById("resultList");for(var d in a)if("username"!=d)var k=a[d];d=document.createElement("tr");c.appendChild(d);c=document.createElement("td");c.innerHTML=a.username;d.appendChild(c);c=document.createElement("td");c.innerHTML=b[k];d.appendChild(c)},barGraph(){var a=document.getElementById("chart");a&&(a.style.display="block");virtualclass.poll.currResultView="bar";if(a=document.getElementById("listCont"))a.style.display=
"none";virtualclass.poll.showGraph();virtualclass.poll.updateBarGraph();virtualclass.poll.pollState.data.view="bar"},showGraph(){var a=roles.hasControls()?virtualclass.poll.dataToStd:virtualclass.poll.dataRec,b=[];for(const c in virtualclass.poll.count)b.push([a.options[c],virtualclass.poll.count[c]]);a={type:"bar"};a.columns=b;if(b=document.getElementById("chart"))b.style.display="none";virtualclass.poll.chart=c3.generate({bindto:"#chart",data:a,bar:{width:100}})},UI:{id:"virtualclassPoll",class:"virtualclass",
container(){var a=document.getElementById(this.id);null!=a&&a.parentNode.removeChild(a);a=virtualclass.getTemplate("pollmain","poll");const b=!!roles.hasAdmin();virtualclass.vutil.insertAppLayout(a({control:b}));if(roles.hasAdmin()){const a=document.querySelector("#coursePollTab"),b=document.querySelector("#sitePollTab");b.addEventListener("click",()=>{a.classList.remove("active");b.classList.add("active");b.style.pointerEvents="none";a.style.pointerEvents="visible";virtualclass.poll.interfaceToFetchList(0)});
a.addEventListener("click",()=>{b.classList.remove("active");a.classList.add("active");a.style.pointerEvents="none";b.style.pointerEvents="visible";virtualclass.poll.interfaceToFetchList(virtualclass.poll.cmid)})}else{document.querySelector("#virtualclassCont.congrea.student #navigator #pollResult").style.display="none";virtualclass.storage.getAllDataOfPoll(["pollStorage"],a=>{if(a&&(a=JSON.parse(a.pop().pollResult),a.pollData.setting.showResult)){virtualclass.poll.previousResult=a;if(a=document.querySelector("#virtualclassCont.congrea.student #navigator #pollResult"))a.style.display=
"block";if(a=document.querySelector("#virtualclassCont.congrea.student #navigator #stdPollHeader"))a.style.display="none"}});const a=document.querySelector(".congrea.student #virtualclassPoll #navigator #pollResult");a.addEventListener("click",()=>{virtualclass.poll.showStudentPollReport(virtualclass.poll.previousResult);a.classList.add("active")})}},resultView(a,b){document.getElementById("layoutPoll");if(roles.hasControls()&&(this.createResultLayout(),!a)){var c=document.getElementById("resultLayoutHead");
a=document.getElementById("closePoll");a||(a=document.createElement("button"),a.id="closePoll",a.className="btn btn-default col-md-2",c.appendChild(a),a.innerHTML=virtualclass.lang.getString("closeVoting"),a.addEventListener("click",()=>{virtualclass.poll.closePoll(b)}),c=document.createElement("i"),c.className="icon-close-poll",a.appendChild(c))}if(a=document.getElementById("modalClose"))a.removeAttribute("data-dismiss"),a.addEventListener("click",()=>{virtualclass.poll.pollModalClose(b)});virtualclass.poll.count=
{};virtualclass.poll.list=[]},createResultLayout(){var a=document.getElementById("resultLayout");a&&a.parentNode.removeChild(a);var b=!!roles.hasControls();a={};a.control=b;if(roles.hasControls()){a.question=virtualclass.poll.dataToStd.question;a.options=virtualclass.poll.dataToStd.options;b=virtualclass.getTemplate("result-modal","poll");const c=document.querySelector("#editPollModal");c&&c.remove();document.querySelector("#bootstrapCont").insertAdjacentHTML("beforeend",b({obj:a}));a=document.querySelectorAll("#chartMenuCont button");
for(b=0;b<a.length;b++)a[b].classList.add("disabled")}else a.question=virtualclass.poll.dataRec.question,b=virtualclass.getTemplate("stdResult","poll"),document.querySelector("#virtualclassPoll").insertAdjacentHTML("beforeend",b({obj:a}));this.resultLayoutBody()},resultNotShownUI(a){if(a=document.querySelector("#resultLayoutBody"))a.style.display="none";var b=document.getElementById("mszBoxPoll");if(b)for(;0<b.childNodes.length;)b.removeChild(b.childNodes[0]);else b=document.createElement("div"),
b.id="mszBoxPoll",a.appendChild(b);a=virtualclass.lang.getString("noResultStd");document.querySelector("#mszBoxPoll").style.display="block";if(b=document.querySelector("#resultLayoutHead"))b.style.display="none";virtualclass.poll.showMsg("mszBoxPoll",a,"alert-success")},resultLayoutBody(a){if(a=document.querySelector("#qnLabelCont"))roles.hasControls()&&(a.innerHTML=virtualclass.poll.dataToStd.question),roles.hasControls()&&(this.chartMenu(),this.createResultMsgCont())},createResultMsgCont(a){document.getElementById("pollResultMsz").innerHTML=
virtualclass.lang.getString("watstdrespo")},pollClosedUI(){var a=document.getElementById("closePoll");a&&a.parentNode.removeChild(a);if(a=document.getElementById("congreaPollVoters"))a.innerHTML=virtualclass.lang.getString("rvtu");(a=document.getElementById("pollResultMsz"))&&a.parentNode.removeChild(a)},chartMenu(a){a=document.querySelector("#chartMenuCont #bar");a.addEventListener("click",virtualclass.poll.barGraph);document.querySelector("#chartMenuCont #pi").addEventListener("click",virtualclass.poll.createPiChart);
roles.hasControls()&&(a=document.querySelector("#chartMenuCont #rList"),a.addEventListener("click",virtualclass.poll.listView))},qnLabel(a){const b=document.createElement("div");b.id="chart";b.className="row";a.appendChild(b)},createNav(a){roles.hasControls()||document.querySelector(".congrea.student #virtualclassPoll #navigator a").addEventListener("click",()=>{virtualclass.poll.showStudentPollReport()})},createMszBox(a){const b=document.createElement("div");b.id="mszBoxPoll";b.className="row";a.appendChild(b)},
createOption(a,b){var c=document.getElementById("optsTxCont").querySelectorAll("#optsTxCont .opt");let d=0;for(let a=0;a<c.length;a++){d++;var k=c[a].id}var m=k?d:"0";c={};c.index=m;c.closeBtn=1<m;c=virtualclass.getTemplate("optioninput","poll")({close:c});document.querySelector("#addMoreCont").insertAdjacentHTML("beforebegin",c);c=document.getElementById(`remove${m}`);c.addEventListener("click",()=>{virtualclass.poll.removeOption(b,a,`remove${m}`)})},hidePrevious(a){(a=document.getElementById("optsTxCont"))&&
a.parentNode.removeChild(a);if(a=document.getElementById("reset"))a.style.display="none";a=document.getElementById("footerCtrCont");a.parentNode.removeChild(a)},editPoll(a,b){virtualclass.poll.UI.loadContent(a,b);virtualclass.poll.UI.footerBtns(a,b)},loadContent(a,b){let f;document.getElementById("qnTxCont");virtualclass.poll.UI.editQn(a,b);f=c.options;let d=0;if("object"===typeof f)for(var k in f)console.log(k),d++,virtualclass.poll.UI.editOptions(a,b,k,d);else for(k=0;k<f.length;k++)virtualclass.poll.UI.editOptions(a,
b,k,d)},previewFooterBtns(a,b,c){document.getElementById("footerCtrCont")&&virtualclass.poll.pollPopUp(virtualclass.poll.popupFn,c,b)},footerBtns(a,b){a&&virtualclass.poll.pollPopUp(virtualclass.poll.popupFn,b,a)},editQn(a,b){const c=document.querySelector("#qnTxCont #q");null==c&&(c.value=document.getElementById(`qnText${a}${b}`).innerHTML);null==c||c.value||(c.value="course"==a?virtualclass.poll.coursePoll[b].questiontext:virtualclass.poll.sitePoll[b].questiontext)},editOptions(a,b,c,d){document.getElementById("optsTxCont").style.display=
"block";document.getElementById(`opt${b}${c}`);if(2<d){const f=document.createElement("a");f.id=`remove${c}`;f.className="close";f.innerHTML="&times";document.querySelector(`#optsTxCont .inputWrapper #option${c}`).parentNode.appendChild(f);f.addEventListener("click",()=>{virtualclass.poll.removeOption(a,b,f.id)})}d=document.getElementById(`option${c}`);"course"==a?(c=virtualclass.poll.coursePoll[b].options[c],d.value="object"===typeof c?c.options:c):(c=virtualclass.poll.sitePoll[b].options[c],d.value=
"object"===typeof c?c.options:c)},pollSettingUI(a,b){const c=virtualclass.getTemplate("setting-modal","poll"),d=document.querySelector("#editPollModal");for(;d.firstChild;)d.removeChild(d.firstChild);d.insertAdjacentHTML("beforeend",c({time:function(a,b){const c=[];for(a=b-a+1;a--;)c[a]=b--;return c}(1,60)}));this.settingUIBody(a,b)},settingUIBody(a,b){this.addSettingHandlers()},addSettingHandlers(){document.getElementById("mode").addEventListener("click",()=>{var a=document.getElementById("radioBtn1");
const b=document.getElementById("radioBtn2");a.checked?(a=document.getElementById("timer"),a.setAttribute("disabled",!0),a=document.getElementById("ut"),a.setAttribute("disabled",!0)):b.checked&&(a=document.getElementById("timer"),a.removeAttribute("disabled"),a=document.getElementById("ut"),a.removeAttribute("disabled"))})},defaultLayoutForStudent(){this.container();const a=document.getElementById("mszBoxPoll");if(null==document.getElementById("stdPollMszLayout")){const b=document.createElement("div");
b.id="stdPollMszLayout";b.innerHTML=virtualclass.lang.getString("pollmaybeshown");a.appendChild(b)}},stdPublishUI(){const a=document.getElementById("stdPollMszLayout");a&&a.parentNode.removeChild(a)},disableClose(){document.getElementById("pollClose").style.display="none"}},updateUsersOnPoll(){0>virtualclass.poll.uniqueUsers.indexOf(virtualclass.jId)&&(virtualclass.poll.uniqueUsers.push(virtualclass.jId),0<Object.keys(virtualclass.poll.count).length&&virtualclass.poll.noOfVotes())}}};d.poll=c})(window);var dashBoard={userConfirmation(d,c){virtualclass.popup.confirmInput(d,a=>{c(a)})},close(){console.log("Close dashboard");var d=document.querySelector("#congdashboard .modal-content button.close");null!=d&&(d.classList.remove("clicked"),d.click(),d=document.querySelector("#dashboardnav button"),null!=d&&d.classList.remove("clicked"),virtualclass.modal.hideModal())},isDashBoardExit(d){return null!=document.querySelector(`#${d}Dashboard`)},isDashBoardNavExist(){return null!=document.querySelector("#dashboardnav")},
actualCloseHandler(){const d=document.querySelector("#congdashboard .modal-content button.close");null!=d&&d.addEventListener("click",()=>{const c=document.querySelector("#dashboardnav button");null!=c&&(c.classList.remove("clicked"),dashBoard.dashBoardClickTooltip("open"))})},clickCloseButton(){const d=document.querySelector("#dashboardnav button");null!=d&&d.classList.add("clicked")},dashBoardClickTooltip(d){const c=document.querySelector("#dashboardnav button");"Video"==virtualclass.currApp?c.parentNode.setAttribute("data-title",
virtualclass.lang.getString(`${d}videoDashboard`)):"SharePresentation"==virtualclass.currApp?c.parentNode.setAttribute("data-title",virtualclass.lang.getString(`${d}SharePresentationdbHeading`)):"DocumentShare"==virtualclass.currApp?c.parentNode.setAttribute("data-title",virtualclass.lang.getString(`${d}dsDbheading`)):console.log("dashboard tooltip not working properly")}};(function(d){d.videoUl=function(){return{videos:[],uploaderParam:{},videoObj:{},videoId:"",videoUrl:"",isfullscreen:!1,order:[],currPlaying:"",autoPlayFlag:1,status:0,yts:!1,online:!1,listEndPause:!1,attachPlayer:!1,init(c,a){this.videoInit=!0;this.currPlaying="";this.pages={};virtualclass.previrtualclass="virtualclassVideo";virtualclass.previous="virtualclassVideo";this.autoPlayFlag=1;"undefined"!==typeof c&&("studentlayout"!=c.init&&(this.videoId=c.init.videoId||c.init,this.videoUrl=c.init.videoUrl,
this.yts=c.init.yts,this.online=c.init.online,this.isPaused=c.init.isPaused),"undefined"!==typeof c.isAutoplay&&(this.autoPlayFlag=c.isAutoplay));if(!roles.hasAdmin()||roles.isEducator()){if("undefined"!==typeof this.videoId||!roles.isStudent()||virtualclass.videoUl.yts)if(this.UI.container(),roles.hasControls())ioAdapter.mustSend({videoUl:{init:"studentlayout"},cf:"videoUl"}),ioAdapter.mustSend({videoUl:{init:{id:virtualclass.videoUl.videoId,videoUrl:virtualclass.videoUl.videoUrl},startFrom:virtualclass.videoUl.player.currentTime()},
cf:"videoUl"});else if("undefined"!==typeof c)if(c.hasOwnProperty("fromReload"))this.fromReload(this.videoId,this.videoUrl,a);else{if(void 0!=this.videoId&&"undefined"!==typeof this.videoId&&("object"!==typeof this.videoId||0!=this.videoId.yts)){const b=c.url||c.init.videoUrl;"undefined"!==typeof b&&""!=b&&"studentlayout"!=c.init&&("undefined"===typeof a?this.UI.displayVideo(c.id,b):this.UI.displayVideo(c.id,b,a))}}else if(a=document.getElementById("messageLayoutVideo"))a.style.display="block"}else this.UI.container(),
c=document.querySelector("#dashboardnav button"),null!=c&&c.click(),"undefined"!==typeof a?this.fromReload(this.videoId,this.videoUrl,a):ioAdapter.mustSend({videoUl:{init:"studentlayout"},cf:"videoUl"})},isPlayerReady(){return virtualclass.videoUl.hasOwnProperty("player")&&"object"===typeof virtualclass.videoUl.player},createPageModule(){virtualclass.videoUl.videos&&virtualclass.videoUl.videos.length&&virtualclass.videoUl.videos.forEach((c,a)=>{virtualclass.videoUl.pages[c.id]=new virtualclass.page("videoList",
"video","virtualclassVideo","videoUl",c.status)})},reArrangeElements(c){const a=document.getElementById("listvideo"),b=document.createElement("div");b.id="listvideo";b.className="videos";var f=this.getActiveVideos(),d=!1;for(let a=0;a<f.length;a++)-1>=c.indexOf(f[a].fileuuid)&&(c.push(f[a].fileuuid),d=!0);d&&(virtualclass.videoUl.order=c,virtualclass.videoUl.sendOrder(virtualclass.videoUl.order));for(f=0;f<c.length;f++)(d=document.getElementById(`linkvideo${c[f]}`))&&b.appendChild(d);a.parentNode.replaceChild(b,
a)},getActiveVideos(){const c=[];for(let a=0;a<virtualclass.videoUl.videos.length;a++)virtualclass.videoUl.videos[a].hasOwnProperty("deleted")||c.push(virtualclass.videoUl.videos[a]);return c},fromReload(c,a,b){virtualclass.videoUl.UI.container();a&&virtualclass.videoUl.UI.displayVideo(c,a,b)},saveVideosInLocalStr(){const {order:c}=virtualclass.videoUl;console.log(c);console.log("videosinlocalstorage");console.log(virtualclass.videoUl.videos);localStorage.setItem("videoList",JSON.stringify(virtualclass.videoUl.videos));
localStorage.setItem("videoOrder",JSON.stringify(virtualclass.videoUl.order))},requestOrder(){virtualclass.vutil.requestOrder("vid",c=>{"Error"==c?console.log("page order retrieve failed"):"undefined"!==typeof c&&void 0!=c&&(virtualclass.videoUl.order=[],virtualclass.videoUl.order=c,0<virtualclass.videoUl.order.length&&virtualclass.videoUl.reArrangeElements(virtualclass.videoUl.order))})},afterDocStatus(c){},updateOrder(){const c=this.getActiveVideos();c.length!=this.order.length&&(this.order=c.map(a=>
a.fileuuid));this.sendOrder(this.order)},afterUploadVideo(c,a,b){if(b=b.success){this.updateOrder();virtualclass.videoUl.order.push(virtualclass.gObj.file.uuid);virtualclass.videoUl.sendOrder(virtualclass.videoUl.order);virtualclass.videoUl.showUploadMsz("Video uploaded successfully","alert-success");(c=document.querySelector(".congrea #VideoDashboard #videoPopup"))&&(c.classList.contains("uploadSuccess")||c.classList.add("uploadSuccess"));for(c=0;c<virtualclass.gObj.uploadingFiles.length;c++)a={},
a.filename=`${virtualclass.gObj.uploadingFiles[c].name} (Processing...)`,a.fileuuid=virtualclass.gObj.uploadingFiles[c].uuid,a.filetype="video",a.key_room=`${virtualclass.gObj.sessionInfo.key}_${virtualclass.gObj.sessionInfo.room}`,a.noVideo=!0,console.log(`File uploading ${a.filename}`),this.afterUploadFile(a);virtualclass.gObj.uploadingFiles=[];virtualclass.serverData.pollingStatus(virtualclass.videoUl.UI.awsVideoList)}else virtualclass.videoUl.showUploadMsz("video upload failed","alert-error");
if(c=document.querySelector("#videoPopup .qq-upload-list-selector.qq-upload-list"))c.style.display="none"},showUploadMsz(c,a){const b=document.querySelector("#VideoDashboard #uploadMsz"),f=document.querySelector("#VideoDashboard #uploadMsz .alert");f&&f.parentNode.removeChild(f);const d=document.createElement("div");d.className="alert  alert-dismissable";d.classList.add(a);d.innerHTML=c;b.appendChild(d);c=document.createElement("button");c.className="close";c.setAttribute("data-dismiss","alert");
c.innerHTML="&times";c.addEventListener("click",()=>{var a=document.querySelector("#uploadMsz");a&&(a.style.display="none");(a=document.querySelector(".congrea #VideoDashboard #videoPopup"))&&a.classList.remove("uploadSuccess");d.parentNode.removeChild(d)});d.appendChild(c)},retrieveOrder(){this.requestOrder()},afterUploadFile(c){var a=c.fileuuid;this.pages[a]=new virtualclass.page("videoList","video","virtualclassVideo","videoUl",c.status,c.filetype);if("video_yts"==c.filetype){var b=virtualclass.videoUl.getVideoId(c.URL);
virtualclass.videoUl.UI.fetchYtsTitle(c,b)}this.pages[a].init(a,c.filename);this.videoDisplayHandler(c);a=document.getElementById(`linkvideo${c.fileuuid}`);if(b=document.getElementById(`videoTitle${c.fileuuid}`))b.innerHTML=c.filename;b=a.getElementsByClassName("status")[0];c.hasOwnProperty("disabled")?(this._disable(c.fileuuid),a&&(a.classList.add("disable"),a.dataset.status=0)):(this._enable(c.fileuuid),a&&(a.classList.add("enable"),a.dataset.status=1));b.dataset.status=a.dataset.status;this.calculateHeight();
c.hasOwnProperty("noVideo")&&a.classList.add("noVideo")},calculateHeight(){var c=document.querySelector("#listvideo");const a=document.querySelector(".congrea .qq-uploader-selector");console.log(c.offsetHeight);c=c.offsetHeight;console.log(a.offsetHeight);$(".qq-uploader-selector").css({minHeight:c})},showVideos(c,a){roles.hasControls()&&virtualclass.videoUl.showVideoList();virtualclass.videoUl.videoUrl&&(virtualclass.videoUl.activeVideoClass(virtualclass.videoUl.videoId),virtualclass.vutil.showFinishBtn())},
showVideoList(){document.getElementById("videoList");var c=document.getElementById("listvideo");if(c)for(var a=0;a<c.childNodes.length-1;a++)c.childNodes[a].parentNode.removeChild(c.childNodes[a]);virtualclass.videoUl.videos&&virtualclass.videoUl.videos.length&&virtualclass.videoUl.videos.forEach((a,c)=>{a.hasOwnProperty("deleted")||(c=document.querySelector(`#linkvideo${a.fileuuid}`),null!=c&&c.classList.remove("noVideo"),virtualclass.videoUl.afterUploadFile(a))});virtualclass.vutil.makeElementActive("#listvideo");
c=document.querySelector(".congrea #listvideo .linkvideo.singleVideo");a=document.querySelector(".congrea #listvideo .linkvideo");1!=virtualclass.videoUl.videos.length||c?1<virtualclass.videoUl.videos.length&&c&&c.classList.remove("singleVideo"):a.classList.add("singleVideo")},videoDisplayHandler(c){const a=document.getElementById(`mainpvideo${c.fileuuid}`);a&&!c.status?a.classList.contains("playDisable")||a.classList.add("playDisable"):a&&a.classList.contains("playDisable")&&a.classList.remove("playDisable");
a&&a.addEventListener("click",()=>{virtualclass.videoUl.isPaused=!1;"video_yts"==c.filetype?(virtualclass.videoUl.yts=!0,virtualclass.videoUl.online=!1):"video_online"==c.filetype?(virtualclass.videoUl.yts=!1,virtualclass.videoUl.online=!0):(virtualclass.videoUl.yts=!1,virtualclass.videoUl.online=!1);if(c.urls){const a=c.urls.main_video;virtualclass.videoUl.UI.displayVideo(c.fileuuid,a);virtualclass.videoUl.activeVideoClass(c.fileuuid);const f={};f.content_path=a;f.id=c.fileuuid;f.title=c.filename;
f.type=c.filetype;virtualclass.videoUl.videoToStudent(f);virtualclass.videoUl.videoId=c.fileuuid;virtualclass.vutil.showFinishBtn();virtualclass.dashBoard.close()}})},activeVideoClass(c){for(var a=document.getElementsByClassName("controlCont"),b=0;b<a.length;b++)a[b].classList.contains("removeCtr")&&a[b].classList.remove("removeCtr");(a=document.getElementById(`controlContvideo${c}`))&&!a.classList.contains("removeCtr")&&a.classList.add("removeCtr");a=document.getElementsByClassName("linkvideo");
for(b=0;b<a.length;b++)a[b].classList.contains("playing")&&a[b].classList.remove("playing");(c=document.getElementById(`linkvideo${c}`))&&!c.classList.contains("playing")&&c.classList.add("playing")},shareVideo(c){const a={};virtualclass.videoUl.UI.displayVideo("no",c);a.instantVideo=!0;a.content_path=c;virtualclass.videoUl.videoToStudent(a)},destroyPl(){"object"===typeof virtualclass.videoUl.player&&("ScreenShare"==virtualclass.currApp&&ioAdapter.mustSend({video:"destroyPl",cf:"video"}),virtualclass.videoUl.player.dispose())},
_rearrange(c){this.order=c;this.reArrangeElements(c);this.sendOrder(this.order)},async _editTitle(c,a,b){b=new FormData;const f={lc_content_id:c,action:"edit",title:a,user:virtualclass.gObj.uid};b=new FormData;for(const a in f)b.append(a,f[a]),console.log(f[a]);await this.vxhr.post(`${d.webapi}&user=${virtualclass.gObj.uid}&methodname=update_content_video`,b).then(b=>{if(b=document.getElementById(`videoTitle${c}`))b.innerHTML=a,b.style.display="inline",virtualclass.videoUl.videos&&virtualclass.videoUl.videos.length&&
virtualclass.videoUl.videos.forEach((b,f)=>{b.id==c&&(console.log(b),b.title=a)})}).catch(a=>{console.error("Request failed with error ",a)})},sendOrder(c,a){virtualclass.vutil.sendOrder("vid",c)},onmessage(c){if("string"===typeof c.videoUl)if("play"==c.videoUl)this.playVideo(c),virtualclass.videoUl.isPaused=!1;else if("pause"==c.videoUl)this.pauseVideo(),virtualclass.videoUl.isPaused=!0;else if("destroyPlayer"==c.videoUl)virtualclass.videoUl.destroyPlayer();else if("enterFullScreen"==c.videoUl)virtualclass.videoUl.enterFullScreen();
else if("exitFullScreen"==c.videoUl)virtualclass.videoUl.exitFullScreen();else{if("videoDelete"==c.videoUl&&(c=document.querySelector("#videoPlayerCont"))){c.style.display="none";if(c=document.querySelector("#messageLayoutVideo"))c.style.display="block";virtualclass.videoUl.videoId=null;virtualclass.videoUl.videoUrl=null;c=document.querySelector(".congrea #dispVideo video");const a=document.querySelector(".congrea #dispVideo iframe");(c=c||a)&&c.setAttribute("src","")}}else this.onmessageObj(c)},
onmessageObj(c){c.videoUl.type&&("video_yts"==c.videoUl.type?(virtualclass.videoUl.yts=!0,virtualclass.videoUl.online=!1):"video_online"==c.videoUl.type?(virtualclass.videoUl.online=!0,virtualclass.videoUl.yts=!1):(virtualclass.videoUl.yts=!1,virtualclass.videoUl.online=!1));if(c.videoUl.hasOwnProperty("init"))if(virtualclass.videoUl.rec=c.videoUl,console.log(virtualclass.videoUl.rec),"studentlayout"==c.videoUl.init){if(virtualclass.makeAppReady("Video",void 0,c.videoUl),c=document.getElementById("messageLayoutVideo"))c.style.display=
"block"}else c.videoUl.init.hasOwnProperty("videoUrl")&&(virtualclass.videoUl.videoId=c.videoUl.init.id,virtualclass.videoUl.videoUrl=c.videoUl.init.videoUrl,virtualclass.videoUl.UI.displayVideo(c.videoUl.init.id,c.videoUl.init.videoUrl,c.videoUl.startFrom));else c.videoUl.hasOwnProperty("content_path")?(virtualclass.videoUl.videoId=c.videoUl.id,virtualclass.videoUl.videoUrl=c.videoUl.content_path,virtualclass.videoUl.title=c.videoUl.title,virtualclass.videoUl.UI.displayVideo(c.videoUl.id,virtualclass.videoUl.videoUrl)):
c.videoUl.hasOwnProperty("play")&&(this.playVideo(c.videoUl.play),virtualclass.videoUl.isPaused=!1)},enablePlayer(){const c=document.getElementById("videoPlayerCont");c&&(c.style.display="block")},disablePlayer(){const c=document.getElementById("videoPlayerCont");c&&(c.style.display="none")},destroyPlayer(){virtualclass.videoUl.player.dispose()},playVideo(c){virtualclass.videoUl.isPlayerReady()&&(console.log("====Video play"),virtualclass.videoUl.player.currentTime(c),virtualclass.videoUl.player.play())},
pauseVideo(){virtualclass.videoUl.isPlayerReady()&&(console.log("====Video pause"),virtualclass.videoUl.player.pause(),virtualclass.videoUl.isPaused=!0)},autoPlayList(c){var a=this.getActiveVideos();c=this.findNextObj(c);"object"!==typeof c?c<a.length&&(c=this.autoPlayList(c)):(a={},a.id=c.fileuuid,a.title=c.filename,a.type=c.filetype,virtualclass.videoUl.listEnd||("video_online"==c.filetype?(virtualclass.videoUl.yts=!1,virtualclass.videoUl.online=!0,virtualclass.videoUl.UI.displayVideo(c.fileuuid,
c.URL),virtualclass.videoUl.videoToStudent(c),this.activeVideoClass(c.id),a.content_path=c.URL):(virtualclass.videoUl.online=!1,"video_yts"==c.filetype?(virtualclass.videoUl.yts=!0,virtualclass.videoUl.UI.displayVideo(c.fileuuid,c.URL),a.content_path=c.URL):(virtualclass.videoUl.yts=!1,virtualclass.videoUl.UI.displayVideo(c.fileuuid,c.urls.main_video),a.content_path=c.urls.main_video),virtualclass.videoUl.videoToStudent(a)),virtualclass.videoUl.player&&virtualclass.videoUl.player.ready(function(){this.play()}),
this.activeVideoClass(c.fileuuid)))},findNextObj(c){const a=this.findNextVideoId(c),b=this.getActiveVideos();for(let f=0;f<b.length;f++)if(b[f].fileuuid==a)return"1"==document.getElementById(`linkvideo${b[f].fileuuid}`).getAttribute("data-status")?c=b[f]:c+1},findNextVideoId(c){const a=document.querySelectorAll("#listvideo .linkvideo");return c<a.length?a[c].getAttribute("data-rid"):!1},findVideoIndex(c){const a=document.querySelectorAll("#listvideo .linkvideo");for(let b=0;b<a.length;b++)if(a[b].getAttribute("data-rid")==
c)return c=b},_disable(c){document.querySelector(`#linkvideo${c}`).classList.add("playDisable");const a=document.getElementById(`mainpvideo${c}`);a.style.opacity=.3;a.style.pointerEvents="none";virtualclass.videoUl.videos&&virtualclass.videoUl.videos.length&&virtualclass.videoUl.videos.forEach((a,f)=>{a.fileuuid==c&&(a.disabled=0,a.status=0)})},_enable(c){document.querySelector(`#linkvideo${c}`).classList.remove("playDisable");const a=document.getElementById(`mainpvideo${c}`);a&&(a.style.opacity=
1,a.style.pointerEvents="auto",virtualclass.videoUl.videos&&virtualclass.videoUl.videos.length&&virtualclass.videoUl.videos.forEach((a,f)=>{a.fileuuid==c&&(delete a.disabled,a.status=1)}))},_delete(c){const a=this;virtualclass.xhrn.vxhrn.post(virtualclass.api.UpdateDocumentStatus,{uuid:c,action:"delete",page:0}).then(b=>{a.afterDeleteCallback(b.data,c)})},afterDeleteCallback(c,a){if("ERROR"!=c&&(c=document.getElementById(`linkvideo${a}`))){c.parentNode.removeChild(c);if(virtualclass.videoUl.videoId==
a&&(c=document.querySelector("#videoPlayerCont"))){c.style.display="none";ioAdapter.mustSend({videoUl:"videoDelete",cf:"videoUl"});virtualclass.videoUl.videoId=null;virtualclass.videoUl.videoUrl=null;c=document.querySelector(".congrea #dispVideo video");const a=document.querySelector(".congrea #dispVideo iframe");(c=c||a)&&c.setAttribute("src","");virtualclass.vutil.removeFinishBtn()}virtualclass.videoUl.videos&&virtualclass.videoUl.videos.length&&virtualclass.videoUl.videos.forEach((b,c)=>{b.fileuuid==
a&&(c=virtualclass.videoUl.videos.indexOf(b),0<=c&&(virtualclass.videoUl.videos.splice(c,1),console.log(virtualclass.videoUl.videos)))});c=virtualclass.videoUl.order.indexOf(a);0<=c&&(virtualclass.videoUl.order.splice(c,1),console.log(virtualclass.videoUl.order),virtualclass.videoUl.sendOrder(virtualclass.videoUl.order));virtualclass.videoUl.videos.length?1==virtualclass.videoUl.videos.length&&(c=document.querySelector(".congrea #listvideo .linkvideo"))&&c.classList.add("singleVideo"):virtualclass.vutil.removeFinishBtn()}},
xhrOrderSend(c){virtualclass.xhrn.vxhrn.post(virtualclass.api.UpdateRoomMetaData,{order:c.toString()}).then(()=>{virtualclass.serverData.fetchAllData(virtualclass.videoUl.UI.awsVideoList)})},videoToStudent(c){ioAdapter.mustSend({videoUl:c,cf:"videoUl"})},getVideoId(c){c=c.match(/^.*(?:(?:youtu\.be\/|v\/|vi\/|u\/\w\/|embed\/)|(?:(?:watch)?\?v(?:i)?=|&v(?:i)?=))([^#&\?]*).*/);return null!=c&&1<c.length&&(c=c[1].substring(0,11),11==c.length)?c:!1},UI:{id:"virtualclassVideo",class:"bootstrap virtualclass",
container(){if(!document.getElementById("virtualclassVideo")){var c={control:!!roles.hasAdmin()};virtualclass.vutil.insertAppLayout((0,JST[`${virtualclass.gObj.tempPrefix}/videoupload/videoupload.hbs`])(c));document.getElementById(this.id)}!roles.hasControls()&&(c=document.getElementById("messageLayoutVideo"))&&(c.style.display="block")},createYoutubeUrlCont(c){const a=document.createElement("div");a.id="listvideo";c.appendChild(a)},displayVideo(c,a,b){const f=this;virtualclass.videoUl.hasOwnProperty("displayVideoTime")&&
clearTimeout(virtualclass.videoUl.displayVideoTime);virtualclass.videoUl.displayVideoTime=setTimeout(()=>{"Video"==virtualclass.currApp&&f._displayVideo(c,a,b)},300)},_displayVideo(c,a,b){"object"===typeof virtualclass.videoUl.player&&virtualclass.videoUl.player.hasOwnProperty("dispose")&&virtualclass.videoUl.player.dispose();virtualclass.videoUl.videoUrl=a;virtualclass.videoUl.videoId=c;var f=document.getElementById("videoPlayerCont");f?f.style.display="block":(virtualclass.videoUl.UI.container(),
f=document.getElementById("videoPlayerCont"));const d=document.querySelector("iframe#player");d&&d.remove();virtualclass.videoUl.UI.switchDisplay(f,a);virtualclass.videoUl.UI.videojsPlayer(a,c,b);virtualclass.modal.hideModal()},videojsPlayer(c,a,b){if(!virtualclass.videoUl.player){const b=videojs("dispVideo");if(roles.hasControls()){$(".vjs-autoPlay-button").length||virtualclass.videoUl.UI.appendAutoPlayButton(b);const a=document.getElementById("autoPlayListBtn");a&&(a.className=virtualclass.videoUl.autoPlayClass)}virtualclass.videoUl.player=
b;virtualclass.videoUl.UI.attachPlayerHandler(virtualclass.videoUl.player,a,c)}virtualclass.videoUl.UI.onEndedHandler(virtualclass.videoUl.player,a,c);virtualclass.videoUl.UI.setPlayerUrl(virtualclass.videoUl.player,c,b)},attachPlayerHandler(c,a,b){this.attachPlayer||(this.attachPlayer=!0,console.log("Attach video player"),c.on("pause",a=>{console.log("paused");roles.hasControls()&&ioAdapter.mustSend({videoUl:"pause",cf:"videoUl"});virtualclass.videoUl.isPaused=!0}),c.on("play",a=>{console.log("play");
roles.hasControls()&&ioAdapter.mustSend({videoUl:{play:c.currentTime()},cf:"videoUl"});virtualclass.videoUl.isPaused=!1}))},switchDisplay(c,a){var b=document.getElementById("dispVideo");b?b.style.display="block":virtualclass.videoUl.UI.createVideoElem(c);b=document.getElementById("videoPlayerCont");c=document.getElementById("messageLayoutVideo");"undefined"===typeof a?(b.style.display="none",c?c.style.display="block":(b=document.createElement("div"),b.id="messageLayoutVideo")):(b.style.display="block",
c&&(c.style.display="none"))},createVideoElem(c,a){c.insertAdjacentHTML("beforeend",'<video id="dispVideo" class="video-js" autoplay controls  preload="auto" data-setup="{}" >');c=document.createElement("p");c.setAttribute("class","vjs-no-js");document.getElementById("dispVideo").appendChild(c);a=document.createElement("a");a.setAttribute("href","https://videojs.com/html5-video-support/");a.setAttribute("target","_blank");a.innerHTML="supports HTML5 video";c.appendChild(a)},setPlayerUrl(c,a,b){console.log("====Video init to play start");
void 0==b&&virtualclass.videoUl.startTime&&(b=virtualclass.videoUl.startTime);c.poster_&&(c.poster_="");const f=document.querySelector("#dispVideo");virtualclass.videoUl.yts?(f.setAttribute("data-setup",'{ techOrder: [youtube],"preload": "auto"}'),c.src({type:"video/youtube",src:a})):virtualclass.videoUl.online?(f.setAttribute("data-setup",'{"preload": "auto" }'),c.src({type:"video/webm",src:a}),c.src({type:"video/mp4",src:a})):(f.setAttribute("data-setup",'{"preload": "auto"}'),c.src({type:"application/x-mpegURL",
withCredentials:!0,src:a}));c.ready(function(){const a=this;a.on("loadedmetadata",()=>{virtualclass.videoUl.isPaused?a.pause():"desktop"==virtualclass.system.device&&a.play();b&&(a.currentTime(b),virtualclass.videoUl.yts&&!virtualclass.videoUl.isPaused&&"desktop"==virtualclass.system.device&&a.play())})});console.log(b)},appendAutoPlayButton(c){virtualclass.videoUl.autoPlayClass=virtualclass.videoUl.autoPlayFlag?"vjs-autoPlay-button vjs-control on":"vjs-autoPlay-button vjs-control off";c.controlBar.addChild("button",
{el:videojs.createEl("button",{className:"vjs-autoPlay-button vjs-control on",id:"autoPlayListBtn",role:"button",title:"Auto Play",onclick(){virtualclass.videoUl.UI.autoPlayFn(this)}})})},autoPlayFn(c){c.classList.contains("off")?(virtualclass.videoUl.autoPlayFlag=1,c.classList.remove("off"),c.classList.add("on"),c.style.color="green"):(virtualclass.videoUl.autoPlayFlag=0,c.classList.remove("on"),c.classList.add("off"),c.style.color="red")},onEndedHandler(c,a,b){c.off("ended");c.on("ended",f=>{virtualclass.videoUl.UI.onEnded(c,
a,b)})},onEnded(c,a,b){var f=document.querySelector("#dispVideo");virtualclass.videoUl.yts?(f.setAttribute("data-setup","{ techOrder: [youtube],controls: true,}"),c.src({type:"video/youtube",src:b})):virtualclass.videoUl.online?(f.setAttribute("data-setup",'{"preload": "auto", "controls": true, }'),c.src({type:"video/webm",src:b}),c.src({type:"video/mp4",src:b})):(f.setAttribute("data-setup",'{"preload": "auto", "controls": true, }'),c.src({type:"application/x-mpegURL",withCredentials:!0,src:b}));
console.log(`ended${a}`);b=document.querySelectorAll("#listvideo .linkvideo");f=0;for(let c=0;c<b.length;c++)if(b[c].getAttribute("data-rid")==a){f=c;break}virtualclass.videoUl.autoPlayFlag?(c.poster_&&(c.poster_=""),virtualclass.videoUl.findNextVideoId(f+1)?virtualclass.videoUl.autoPlayList(f+1,b):virtualclass.videoUl.UI.autoVideoPause()):virtualclass.videoUl.UI.autoVideoPause()},autoVideoPause(){virtualclass.videoUl.isPaused=!0;virtualclass.videoUl.listEndPause=!0;virtualclass.videoUl.player.on("play",
()=>{virtualclass.videoUl.listEndPause&&(console.log("==== Video is paused"),virtualclass.videoUl.player.pause(),virtualclass.videoUl.listEndPause=!1)})},inputUrl(){document.getElementById("congreaShareVideoUrlCont");var c=document.getElementById("messageLayout");null!=c&&c.parentNode.removeChild(c);document.getElementById("submitURL").addEventListener("click",()=>{var a=document.querySelector(".congrea #videourl");if(virtualclass.videoUl.UI.validateURL(a.value)){var b=document.querySelector(" #listvideo .playing");
b&&b.classList.remove("playing");(b=document.querySelector(" #listvideo .removeCtr"))&&b.classList.remove("removeCtr");a=virtualclass.vutil.createHashString(a.value)+virtualclass.vutil.randomString(32).slice(1,-1);virtualclass.videoUl.UI.saveYtsUrl(a)}});(c=document.querySelector(".congrea #newVideoBtn"))&&c.addEventListener("click",()=>{var a=document.querySelector(".congrea #congreavideoContBody");a.style.display="block";a=document.querySelector(".congrea #listvideo");a.style.display="none"})},
saveYtsUrl(c){const a=document.querySelector(".congrea #videourl"),b={};b.uuid=c;b.URL=a.value;b.title=a.value;c=virtualclass.api.addURL;"boolean"===typeof virtualclass.videoUl.getVideoId(a.value)?b.type="video_online":b.type="video_yts";virtualclass.xhrn.vxhrn.post(c,b).then(()=>{virtualclass.videoUl.updateOrder();virtualclass.videoUl.order.push(b.uuid);virtualclass.videoUl.sendOrder(virtualclass.videoUl.order);virtualclass.serverData.fetchAllData(virtualclass.videoUl.UI.awsVideoList)});document.querySelector(".congrea #videourl").value=
""},fetchYtsTitle(c,a){$.getJSON("https://www.googleapis.com/youtube/v3/videos",{key:"AIzaSyCt1SQWwanpucKGFlzytu-mDdr6vRKzJGA",part:"snippet,statistics",id:a},a=>{0===a.items.length?console.log("video not found"):(a=a.items[0].snippet.title,virtualclass.videoUl.UI.setYtsTitle(c,a))}).fail((a,c,d)=>{console.log("unable to fetch you tube title");return"ERROR"})},validateURL(c){return null==c.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g)?
(virtualclass.popup.validateurlPopup("video"),!1):!0},setYtsTitle(c,a){if(c=document.querySelector(`#listvideo #videoTitle${c.fileuuid}`))c.innerHTML=a},removeinputURL(){const c=document.getElementById("youtubeUrlContainer");null!=c&&c.parentNode.removeChild(c)},popup(c){(c=document.querySelector("#congreavideoContBody"))&&null!=c.lastChild&&c.removeChild(c.lastChild);c={};var a=document.querySelector("#listvideo .playing");a&&(this.currPlaying=a.getAttribute("data-rid"));c.validation="mp4 avi wmv mov webm mkv vob mpeg".split(" ");
c.cb=virtualclass.videoUl.afterUploadVideo;c.cthis="video";c.multiple=!1;c.maxSize=512E6;c.requesteEndPoint=`${d.webapi}&methodname=file_save&live_class_id=${virtualclass.gObj.congCourse}&status=1&content_type_id=2&user=${virtualclass.gObj.uid}`;c.wrapper=document.getElementById("congreavideoContBody");virtualclass.fineUploader.uploaderFn(c);virtualclass.vutil.isBulkDataFetched()&&virtualclass.videoUl.videos.length?(virtualclass.videoUl.showVideos(virtualclass.videoUl.videos),0<virtualclass.videoUl.order.length&&
virtualclass.videoUl.reArrangeElements(virtualclass.videoUl.order)):virtualclass.serverData.fetchAllData(virtualclass.videoUl.UI.awsVideoList);(c=document.querySelector("#virtualclassCont.congrea #VideoDashboard .qq-uploader.qq-gallery"))&&c.setAttribute("qq-drop-area-text","Drop videos here");c=document.querySelector("#uploadMsz");if(a=document.querySelector("#videoPopup #congreavideoContBody .qq-upload-list-selector.qq-upload-list"))a.style.display="block";let b=document.querySelector("#uploadMsz div");
b||(b=document.createElement("div"),c.appendChild(b));b.appendChild(a);c=document.querySelectorAll("#videoPopup #uploadMsz ul");if(2<c.length)for(a=0;a<c.length-1;a++)c[a].querySelector("li")||c[a].parentNode.removeChild(c[a]);a=document.querySelector("#videoPopup #uploadMsz .qq-upload-list-selector.qq-upload-list");document.querySelector("#uploadVideo").addEventListener("click",()=>{const a=document.querySelector("#videoPopup .qq-upload-list-selector.qq-upload-button input"),b=document.querySelector("#uploadMsz");
b&&(b.style.display="block");a&&a.click()})},awsr(){console.log("Request get document url 2");this.postAjax(virtualclass.api.GetDocumentURLs,"Demo")},awsVideoList(){const c=virtualclass.awsData,a=[];for(let b=0;b<c.length;b++)"video"!=c[b].filetype&&"video_yts"!=c[b].filetype&&"video_online"!=c[b].filetype||c[b].hasOwnProperty("deleted")||a.push(c[b]);console.log(a);virtualclass.videoUl.videos=a;virtualclass.serverData.rawData.video=a;virtualclass.videoUl.showVideos(a);virtualclass.videoUl.retrieveOrder()}}}}})(window);(function(d){const c=function(){return{generateModal(a,b){var c=document.getElementById(`${a}PopupCont`);elem1Id="congreaVideoContBody";elem2Id="congreaShareVideoUrlCont";var d=document.createElement("div");d.id=`${a}Popup`;d.className="modal";d.role="dialog";d.style.display="none";d.setAttribute("tab-index","-1");d.setAttribute("area-hidden","true");c.appendChild(d);a=document.createElement("div");a.className="modal-dialog";d.appendChild(a);d=document.createElement("div");d.className="modal-content";
d.id="videoModalBody";a.appendChild(d);a=document.createElement("div");a.id="contHead";a.className="modal-header";d.appendChild(a);c=document.createElement("button");c.type="button";c.className="close";c.id="modalClose";c.setAttribute("data-dismiss","modal");c.innerHTML="&times";a.appendChild(c);const k=document.createElement("div");k.id="modalcontBody";k.className="modal-body";d.appendChild(k);b.forEach(a=>{virtualclass.fineUploader.createElems(k,a)});b=document.createElement("form");b.id="form1";
d.appendChild(b);b=document.createElement("div");b.id="contFooter";b.className="modal-footer";d.appendChild(b)},createElems(a,b){const c=document.createElement("div");c.id=b;c.className="upload";a.appendChild(c)},initModal(a){$(`#${a}Popup`).modal({backdrop:"static",keyboard:!1});$(`#${a}Popup`).modal({show:!0});$(`#${a}Popup`).on("hidden.bs.modal",()=>{$(`#${a}Popup`).remove()})},uploaderFn(a){new qq.s3.FineUploader({element:a.wrapper,template:"qq-template-gallery",debug:!0,multiple:a.multiple,validation:{allowedExtensions:a.validation,
minSizeLimit:4E3,sizeLimit:a.maxSize},request:{endpoint:virtualclass.api.uploadMedia,accessKey:"AKIAJV7RJOFBDFVY62EQ"},signature:{endpoint:virtualclass.api.upload,version:4,customHeaders:{"x-api-key":wbUser.lkey,"x-congrea-authuser":wbUser.auth_user,"x-congrea-authpass":wbUser.auth_pass,"x-congrea-room":wbUser.room}},uploadSuccess:{endpoint:virtualclass.api.uploadSuccess,customHeaders:{"x-api-key":wbUser.lkey,"x-congrea-authuser":wbUser.auth_user,"x-congrea-authpass":wbUser.auth_pass,"x-congrea-room":wbUser.room}},
retry:{enableAuto:!1},cors:{allowXdr:!0,expected:!0,sendCredentials:!1},objectProperties:{key(a){const b=wbUser.lkey,c=wbUser.room;virtualclass.gObj.file={};virtualclass.gObj.file.uuid=this.getUuid(a);virtualclass.gObj.file.name=this.getName(a);const d={name:this.getName(a),uuid:this.getUuid(a)};virtualclass.gObj.uploadingFiles.push(d);virtualclass.gObj.sessionInfo={key:b,room:c};return`${b}/${c}/${virtualclass.gObj.file.uuid}/${this.getName(a)}`}},callbacks:{onComplete(b,c,d){if("video"==a.cthis){a.cb.call(virtualclass.videoUl,
b,c,d);if(b=document.querySelector("#videoPopup .qq-upload-list-selector.qq-upload-list"))b.style.display="none";virtualclass.vutil.makeElementActive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery");virtualclass.vutil.makeElementActive("#listvideo");b=document.querySelector("#uploadMsz .qq-upload-list-selector.qq-upload-list");null!=b&&(b.style.display="block");b=document.querySelectorAll("#uploadMsz .qq-upload-list-selector.qq-upload-list");if(1<b.length)for(c=1;c<b.length-1;c++)b[c].parentNode.removeChild(b[c]);
virtualclass.vutil.removeChildrens("#VideoDashboard #uploadMsz .qq-upload-list-selector.qq-upload-list li");var f=document.querySelector("#VideoDashboard")}else"docs"==a.cthis&&(a.cb.call(virtualclass.dts,b,c,d),virtualclass.vutil.makeElementActive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery"),virtualclass.vutil.makeElementActive("#listdocs"),b=document.querySelector("#docsuploadContainer #docsUploadMsz .qq-upload-list-selector.qq-upload-list"),null!=b&&(b.style.display=
"block"),virtualclass.vutil.removeChildrens("#docsUploadMsz .qq-upload-list-selector.qq-upload-list li"),f=document.querySelector("#DocumentShareDashboard"));null!=f&&f.classList.remove("uploading")},onError(){var b=document.querySelector(".dbContainer .alert");b&&b.parentNode.removeChild(b);if("video"==a.cthis){if(b=document.querySelector("#videoPopup .qq-upload-list-selector.qq-upload-list"))b.style.display="none";virtualclass.vutil.makeElementActive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery");
virtualclass.vutil.makeElementActive("#listvideo")}else if("docs"==a.cthis){if(b=document.querySelector("#DocumentShareDashboard .qq-upload-list-selector.qq-upload-list"))b.style.display="none";virtualclass.vutil.makeElementActive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery");virtualclass.vutil.makeElementActive("#listdocs")}},onSubmitted(b,c){this.setName(b,c.toLowerCase());if("video"==a.cthis)var f="#uploadMsz",d="#VideoDashboard";else"docs"==a.cthis&&(f="#docsUploadMsz",
d="#DocumentShareDashboard");document.querySelector(d).classList.add("uploading");b=document.querySelector(`${f} .close`);null!=b&&b.click();b=document.querySelector(f);null!=b&&(b.style.display="block");document.querySelector(`${f} .qq-upload-list-selector.qq-upload-list`).style.display="block"}}})},onDragEnter(a){"DocumentShare"==virtualclass.currApp?(virtualclass.vutil.makeElementDeactive("#listnotes"),virtualclass.vutil.makeElementActive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery")):
"Video"==virtualclass.currApp&&(virtualclass.vutil.makeElementDeactive("#listvideo"),virtualclass.vutil.makeElementActive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery"))},onDragEnd(a){}}}();d.fineUploader=c})(window);(function(d,c){const a=function(a,c,d,k,m,n){this.appId=d;this.id=null;this.parent="undefined"!==typeof a?a:null;this.status="undefined"!==typeof m?m:1;this.type=c;this.module=k;"video"==c&&(this.videoClass=n)};a.prototype.init=function(a,f){this.rid=a;this.id=this.type+a;"undefined"!==typeof f&&(this.title=f);roles.hasControls()&&(a=c.getElementById(this.parent),null==c.querySelector(`#link${this.id}`)&&this.createPageNav(a))};a.prototype.createPageNav=function(a){var b=c.getElementById(`list${this.type}`),
d=`link${this.type}${this.rid}`;a={rid:this.rid,status:this.status,id:this.id,type:this.type,title:this.title,titleAction:1==this.status?"Hide":"Show"};if("video"==this.type){if(b=c.getElementById("listvideo")){a=this.UI.createPageNavLink2.call(this,b);var k=virtualclass.getTemplate("linkvideo","videoupload");b.insertAdjacentHTML("beforeend",k(a));b=c.getElementById(`${this.type}Title${this.rid}`);b.innerHTML=this.title;b.dataset.title=this.title;this.UI.controller.init(this,d)}}else if("docs"==this.type)k=
virtualclass.getTemplate("docsNav",virtualclass.dts.tempFolder),a.title=virtualclass.vutil.trimExtension(a.title),b.insertAdjacentHTML("beforeend",k(a)),this.UI.controller.init(this,d);else if("notes"==this.type){k=virtualclass.getTemplate("notesNav",virtualclass.dts.tempFolder);const c=virtualclass.dts.getNote(this.rid);a.content_path=c.thumbnail;b.insertAdjacentHTML("beforeend",k(a));this.UI.controller.init(this,d)}else"ppt"==this.type&&(b=c.getElementById("listppt"))&&(a=this.UI.createPageNavLink2.call(this,
b),k=virtualclass.getTemplate("linkPpt","ppt"),b.insertAdjacentHTML("beforeend",k(a)),b=c.getElementById(`${this.type}Title${this.rid}`),b.innerHTML=this.title,b.dataset.title=this.title,this.UI.controller.init(this,d));d=c.getElementById(`mainp${this.id}`);this.createPageNavAttachEvent(d)};a.prototype.createPageNavAttachEvent=function(a){if("docs"==this.type){const b=virtualclass.dts;a=a.closest(".linkdocs");null!=a?a.onclick=b.docs.goToDocs(this.rid):alert("Element is null")}else"notes"==this.type&&
(a.onclick=virtualclass.dts.docs.goToNavs(this.rid))};a.prototype.displayContent=function(a,d){c.getElementById(a);a.appendChild(d)};a.prototype.sendUpdate=function(b){b.type=this.type;b.id=this.rid;a.prototype.xhrSend(b)};a.prototype.xhrSend=async function(a){const b=new FormData;for(const c in a)b.append(c,a[c]);await this.vxhr.post(`${d.webapi}&user=${virtualclass.gObj.uid}${"SharePresentation"!=virtualclass.currApp?"&methodname=update_content":"&methodname=update_content_video"}`,b).catch(a=>
{console.error("Request failed with error ",a)})};a.prototype.sendStatus2=function(a){"notes"==this.type?a.page_id=this.rid:a.lc_content_id=this.rid;this.xhrSend(a)};a.prototype.sendStatus=function(a){if("notes"==this.type){const b=this.rid.split("_");a.uuid=b[0];a.page=parseInt(b[1])}else a.uuid=this.rid,a.page=0;virtualclass.xhrn.vxhrn.post(virtualclass.api.UpdateDocumentStatus,a).then(a=>{console.log(`Msg ${a.data}`)})};a.prototype.rearrange=function(){const a=c.querySelectorAll(`#list${this.type} .link${this.type}`),
d=[];if(null!=a)for(let b=0;b<a.length;b++)d.push(a[b].dataset.rid);0<d.length?"notes"==this.type?virtualclass.dts.reArrangeNotes(d):virtualclass[this.module]._rearrange(d):console.log("Document share:- Element is missing")};a.prototype.disable=function(a){"notes"==this.type?virtualclass.dts._noteDisable(this.rid):virtualclass[this.module]._disable(this.rid)};a.prototype.enable=function(){"notes"==this.type?virtualclass.dts._noteEnable(this.rid):virtualclass[this.module]._enable(this.rid)};a.prototype.UI=
{mainPDiv(){const a=c.createElement("div");a.className=`mainp${this.type}`;a.id=`mainp${this.id}`;a.className="mainpreview";if("notes"==this.type){a.innerHTML="";const b=c.createElement("img");b.className="thumbnail";b.id=`thumbnail${this.rid}`;var d=virtualclass.dts.getNote(this.rid);b.src=d.content_path;b.style.border="1px solid gray";b.style.width="70px";b.style.height="40px";b.style.padding="5px";a.appendChild(b);d=c.querySelectorAll(`#list${this.type} .link${this.type}`);d=null!=d?d.length:1;
const f=c.createElement("span");f.className="thumbList tooltip2";f.innerHTML=d;f.dataset.title=this.title;a.appendChild(b);a.appendChild(f)}else"docs"==this.type&&(a.innerHTML=this.title,a.dataset.title=this.title,a.className+=" tooltip2");a.dataset.screen=this.id;a.dataset.rid=this.rid;return a},createPageNavLink2(){const a=c.createElement("div");a.className=`link${this.type}`;a.id=`link${this.id}`;a.className=`link${this.type} links`;a.dataset.screen=this.id;a.dataset.rid=this.rid;a.type=this.type;
a.dataset.selected=0;a.dataset.status=this.status;"video"==this.type&&a.classList.add(this.videoClass);return a},createPageNavLink(a){const b={};b.type=this.type;b.className=`link${this.type}`;b.id=`link${this.id}`;b.className=`link${this.type} links`;b.dataset={};b.dataset.screen=this.id;b.dataset.rid=this.rid;b.dataset.selected=0;b.dataset.status=this.status;if("video"==this.type){b.type="video";var c=virtualclass.getTemplate("linkvideo","videoupload")}else c=JST["templates/linkdoc.hbs"];a.insertAdjacentHTML("beforeend",
c(b))},mainView(a){c.getElementById(this.parent);if(null==c.getElementById(`screen-${this.type}`)){a={hasControls:roles.hasControls(),cd:virtualclass.dts.docs.currDoc};const b=JST["templates/docMain.hbs"];c.querySelector("#documentScreen").insertAdjacentHTML("beforeend",b(a))}return c.querySelector(`#screen${this.id}   .pageContainer`)},controller:{cthis:null,init(a,c){this.cthis=a;this.element(a,"status",this.cthis.status);this.element(a,"delete");"video"==a.type&&this.element(a,"edit");"docs"!=
a.type&&this.dragDrop.init(this.cthis)},dragDrop:{cthis:null,source:null,init(a){const b=this;this.cthis=a;const d=c.querySelector(`#${`link${this.cthis.type}${this.cthis.rid}`}`);d.setAttribute("draggable","true");d.addEventListener("dragstart",c=>{b.handleDragStart(c,a)},!1);d.addEventListener("dragenter",c=>{b.handleDragEnter(c,a)},!1);d.addEventListener("dragend",c=>{b.handleDragEnd(c,a)},!1)},isBefore(a,c){if(a&&c){if(a.parentNode==c.parentNode)for(;a;a=a.previousSibling)if(a===c)return!0;return!1}},
handleDragStart(a,c){a.dataTransfer.setData("text/plain","nirmala");"video"===c.type?(virtualclass.vutil.makeElementDeactive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery"),virtualclass.vutil.makeElementActive("#listvideo")):"notes"===this.cthis.type&&(virtualclass.vutil.makeElementDeactive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery"),virtualclass.vutil.makeElementActive("#listnotes"));a.target.classList.contains(`link${c.type}`)?this.source=a.target:this.source=
a.target.closest(`.link${c.type}`);a.dataTransfer.effectAllowed="move";this.source&&this.source.classList.add("dragElem")},handleDragEnter(a,d){"video"==d.type?virtualclass.vutil.makeElementActive("#listvideo"):"notes"==d.type&&virtualclass.vutil.makeElementActive("#listnotes");if(this.source){this.source.classList.add("dragElem");console.log("add dragelem");if("video"==d.type||"notes"==d.type||"ppt"==d.type){var b=c.querySelectorAll(`#virtualclassCont.congrea .link${d.type}.htn`);for(var f=0;f<b.length;f++)b[f].classList.remove("htn")}b=
a.target.closest(`.link${d.type}`);b.classList.add("htn");this.isBefore(this.source,b)?b.parentNode.insertBefore(this.source,b):(a=a.target.closest(`.link${d.type}`),a.parentNode.insertBefore(this.source,a.nextSibling));if("video"==d.type||"notes"==d.type||"ppt"==d.type)for(b=c.querySelectorAll(`#virtualclassCont.congrea .link${d.type}:not(.dragElem)`),f=0;f<b.length;f++)b[f].classList.add("opaq")}},handleDragEnd(a,d){"DocumentShare"==virtualclass.currApp&&(virtualclass.dts.indexNav.oldOrder=virtualclass.dts.order);
d.rearrange();a.preventDefault();this.source.classList.remove("dragElem");console.log("remove dragelem");if("video"==d.type||"notes"==d.type||"ppt"==d.type){"video"==d.type?virtualclass.vutil.makeElementActive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery"):"notes"==d.type&&virtualclass.vutil.makeElementActive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery");virtualclass.vutil.makeElementActive(`#list${d.type}`);const b=c.querySelectorAll(` #virtualclassCont.congrea .link${d.type}.opaq`);
for(a=0;a<b.length;a++)b[a].classList.remove("opaq");d=c.querySelectorAll(` #virtualclassCont.congrea .link${d.type}.htn`);for(a=0;a<d.length;a++)d[a].classList.remove("htn")}}},events:{status2(a,c){0==+a.dataset.status?(a.title="video"==c.type||"ppt"==c.type?"Disable":"Hide",c.status=1,c.enable()):(a.title="video"==c.type||"ppt"==c.type?"Enable":"Show",c.status=0,c.disable());a.dataset.status=c.status;a.closest(`.link${c.type}`).dataset.status=c.status;a.querySelector(".statusanch").innerHTML=`status${a.dataset.status}`;
c.sendStatus({action:"status",status:a.dataset.status})},status(a,c){0==+a.dataset.status?(a.title="video"==c.type||"ppt"==c.type?"Disable":"Hide",c.status=1,c.enable()):(a.title="video"==c.type||"ppt"==c.type?"Enable":"Show",c.status=0,c.disable());a.dataset.status=c.status;a.closest(`.link${c.type}`).dataset.status=c.status;a.querySelector(".statusanch").innerHTML=`status${a.dataset.status}`;c.sendStatus(0==c.status?{action:"disable"}:{action:"enable"})},delete(a,c,g){virtualclass.dashBoard.userConfirmation(virtualclass.lang.getString("deletepopup"),
a=>{a&&("notes"==c.type?virtualclass[c.module]._deleteNote(c.rid,c.type):virtualclass[c.module]._delete(c.rid))});"DocumentShare"==virtualclass.currApp&&(a=g||d.event,a.stopPropagation&&a.stopPropagation(),null!=a.cancelBubble&&(a.cancelBubble=!0))},edit(a,d){if(!c.querySelector(`#titleCont${d.rid}`)&&"video"==d.type){var b=function(){var a=c.querySelector(`#virtualclassCont.congrea #temp${d.rid}`);a&&(a.value||(a.value=d.title),a.value&&(virtualclass.videoUl._editTitle(d.rid,a.value,d.videoClass),
a=c.querySelector(`#virtualclassCont.congrea #titleCont${d.rid}`),a.parentNode.removeChild(a)))},f=c.querySelector(`#virtualclassCont.congrea #videoTitle${d.rid}`);a=f.innerHTML;f.style.display="none";const g=c.querySelector(`#virtualclassCont.congrea #videoTitleCont${d.rid} .controls.edit`),k=c.createElement("div");k.setAttribute("class","titleCont");k.setAttribute("id",`titleCont${d.rid}`);f.parentNode.insertBefore(k,g);f=c.createElement("input");f.setAttribute("type","text");f.setAttribute("class",
"textInput");f.setAttribute("id",`temp${d.rid}`);f.setAttribute("placeholder",a);k.appendChild(f);$(c).on("click",a=>{a.target.id!=`temp${d.rid}`&&a.target.id!=`editVideoTitle${d.rid}`&&b()})}}},element2(a,d,g){("video"==a.type?"status"==d?c.querySelector(`#controlCont${a.type}${a.rid} .status`):c.querySelector(`#controlCont${a.type}${a.rid} .delete`):"status"==d?c.querySelector(".controls.status"):c.querySelector(".controls.delete")).onclick=this.goToEvent(this.cthis,d)},element(a,d,g){g=`.${d}`;
"status"==d||"delete"==d?(g=c.querySelector(`#controlCont${a.type}${a.rid} ${g}`),g.onclick=this.goToEvent(this.cthis,d)):"edit"==d&&(g=c.querySelector(`#${a.type}TitleCont${a.rid} ${g}`),g.onclick=this.goToEvent(this.cthis,d),"video_yts"!=a.videoClass&&(g.style.pointerEvents="none",g.classList.add("editDisable")));const b=this;if(g=c.querySelector(`#link${a.type}${a.rid}`))b.hoverHandler(a),g.classList.add("showCtr"),g.addEventListener("mouseover",()=>{b.hoverHandler(a)}),g.addEventListener("mouseout",
()=>{b.hoverHandler1(a)})},hoverHandler(a){(a="video"==a.type?c.querySelector(`#VideoDashboard #link${a.type}${a.rid} .controlCont`):"ppt"==a.type?c.querySelector(`#SharePresentationDashboard #link${a.type}${a.rid} .controlCont`):c.querySelector(`#DocumentShareDashboard #link${a.type}${a.rid} .controlCont`))&&a.classList.add("showCtr")},hoverHandler1(a){"video"==a.type?(a=c.querySelector(`#VideoDashboard #link${a.type}${a.rid} .controlCont`),a.classList.remove("showCtr")):"ppt"==a.type&&(a=c.querySelector(`#SharePresentationDashboard #link${a.type}${a.rid} .controlCont`),
a.classList.remove("showCtr"))},goToEvent(a,c){const b=this;return function(d){b.events[c](this,a,d)}}}};d.page=a})(window,document);(function(d){let c=!0;d.documentShare=function(){return{allPages:null,allNotes:null,allDocs:null,notes:null,order:[],tempFolder:"documentSharing",init(a){this.firstRequest=!1;c=!0;this.indexNav=new virtualclass.pageIndexNav("documentShare");virtualclass.gObj.hasOwnProperty("dstAll")&&"string"===typeof virtualclass.gObj.dstAll?this.storageRawData=null:(null==virtualclass.gObj.dstAll||"undefined"!==typeof virtualclass.gObj.dstAll&&0==Object.keys(virtualclass.gObj.dstAll).length?(a=void 0,localStorage.removeItem("dtsdocs"),
this.storageRawData=null):this.storageRawData="object"===typeof virtualclass.gObj.dstAll?virtualclass.gObj.dstAll:null,null!=virtualclass.gObj.dstAllNotes&&(this.allNotes=virtualclass.gObj.dstAllNotes),roles.isStudent()&&(virtualclass.serverData.rawData.docs=this.storageRawData),roles.hasControls()&&virtualclass.storage.dstAllStore(virtualclass.gObj.dstAll));virtualclass.gObj.hasOwnProperty("docs")&&"string"===typeof virtualclass.gObj.docs?this.documents=null:this.documents="object"===typeof virtualclass.gObj.docs?
virtualclass.gObj.docs:null;this.UI.container();this.pages={};this.notes={};null!=this.documents&&(this.allNotes=this.documents);this.initAfterUpload(a);roles.hasControls()&&"undefined"===typeof a&&(ioAdapter.mustSend({dts:{init:"studentlayout"},cf:"dts"}),console.log(`${virtualclass.gObj.currWb} `+"Document share Teacher layout "));"undefined"!==typeof a?"layout"!=a.init&&"studentlayout"!=a.init?(null!=this.storageRawData&&this.rawToProperData(this.storageRawData,"fromStorage"),this.setNoteScreen(a)):
c&&roles.isStudent()&&this.rawToProperData(this.storageRawData,"fromStorage"):(a=JSON.parse(localStorage.getItem("dtsdocs")),null!=a?(null!=this.storageRawData&&this.rawToProperData(this.storageRawData,"fromStorage"),this.initAfterUpload(a),null!=a.slideNumber&&(this.setNoteScreen(a),a.slideNumber=null,localStorage.setItem("dtsdocs",JSON.stringify(a)))):null!=this.allDocs&&0<Object.keys(this.allDocs).length?(console.log("Do nothing"),this.afterFirstRequestDocs(virtualclass.serverData.rawData.docs,
!0)):roles.hasControls()&&this.firstRequestDocs());virtualclass.dts.noteExist()?virtualclass.modal.hideModal():virtualclass.modal.showModal()},moveProgressbar(){const a=document.querySelector("#docsUploadMsz"),b=document.querySelector("#docsuploadContainer .qq-upload-list-selector.qq-upload-list");if(b){b.style.display="block";const c=document.createElement("div");a.appendChild(c);c.appendChild(b)}},initAfterUpload(a){if("undefined"!==typeof a){for(const b in a.docs)this.afterUploadFile(a.docs[b].rid,
"fromReload",a);a.hasOwnProperty("order")&&(this.order=JSON.parse(a.order))}},setNoteScreen(a){if(null==document.querySelector(`#note${a.slideNumber}.current.note`)){const b=this.getDocId(a.slideNumber);this.docs.executeScreen(b,"fromreload",void 0,a.slideNumber);this.setScreenByOrder(b)}},setScreenByOrder(a){if(null!=this.order&&0<this.order.length){const c=this.getAllNotes(this.order);let d;for(var b=0;b<c.length;b++)d=c[b].id.split("_")[0],this.setLinkSelected(d,1);document.querySelectorAll("#notesContainer .note");
this.createNoteLayout(c,a);this.reArrangeNotes(this.order);for(b=0;b<this.order.length;b++)this.noteStatus(this.order[b],this.allNotes[this.order[b]].status);this.storeInDocs(this.allNotes)}},createNoteLayout(a,b){var c=[];for(let b=0;b<a.length;b++)a[b].hasOwnProperty("deletedn")||c.push(a[b]);0<c.length&&(null==document.querySelector("#screen-docs .pageContainer")?(b={notes:c,hasControls:roles.hasControls(),cd:b},c="screen",a=document.querySelector("#docScreenContainer")):(b={notes:c},c="notesMain",
a=document.querySelector("#screen-docs #notesContainer")),c=virtualclass.getTemplate(c,"documentSharing"),b=c(b),null!=a?a.insertAdjacentHTML("beforeend",b):console.log("there is no such element"),roles.hasControls()||virtualclass.vutil.showZoom())},afterUploadFile(a,b,c){var d="undefined"!==typeof c?c.docs["docs"+a].status:1;"undefined"===typeof b&&roles.hasControls()?this.requestDocs(a):(b=`docs${a}`,"object"!==typeof this.pages[b]&&(this.pages[b]=new virtualclass.page("docScreenContainer","docs",
"virtualclassDocumentShare","dts",d),c="undefined"!==typeof c?c.docs[b].title:this.allDocs[a].title,this.pages[b].init(a,c)))},initDocs(a){if("object"!==typeof this.pages[a]){let b=0;if("true"==this.allDocs[a].status||1==this.allDocs[a].status)b=1;const c=`docs${a}`;this.pages[c]=new virtualclass.page("docScreenContainer","docs","virtualclassDocumentShare","dts",b);this.pages[c].init(a,this.allDocs[a].filename);this.upateInStorage()}},firstRequestDocs(){const a=this;virtualclass.vutil.isBulkDataFetched()?
(ioAdapter.mustSend({dts:{fallDocs:virtualclass.serverData.rawData.docs},cf:"dts"}),a.afterFirstRequestDocs(virtualclass.serverData.rawData.docs)):virtualclass.serverData.fetchAllData(()=>{ioAdapter.mustSend({dts:{fallDocs:virtualclass.serverData.rawData.docs},cf:"dts"});a.afterFirstRequestDocs(virtualclass.serverData.rawData.docs);a.firstRequest=!0})},fetchAllNotes(){const a={};for(const b in virtualclass.dts.allDocs)for(let c=0;c<virtualclass.dts.allDocs[b].notesarr.length;c++)a[virtualclass.dts.allDocs[b].notesarr[c].id]=
virtualclass.dts.allDocs[b].notesarr[c];return a},fetchAllNotesAsArr(){const a=[];for(const b in virtualclass.dts.allDocs)for(let c=0;c<virtualclass.dts.allDocs[b].notesarr.length;c++)a.push(virtualclass.dts.allDocs[b].notesarr[c]);return a},afterFirstRequestDocs(a,b){this.rawToProperData(a);virtualclass.storage.dstAllStore(a);for(const a in this.allDocs)this.allDocs[a].hasOwnProperty("deleted")||this.initDocs(this.allDocs[a].fileuuid);roles.hasAdmin()&&this.requestOrder(this.executeOrder)},rawToProperData(a,
b){"undefined"===typeof notconvert&&(this.allDocsTemp=a,this.allDocs=this.convertInObjects(this.allDocsTemp));this.allNotes="undefined"!==typeof b?virtualclass.gObj.dstAllNotes:this.fetchAllNotes()},afterRequestOrder(a){this.order.length=0;this.order=a;a=this.getDocId(this.order[0]);virtualclass.dts.allDocs.hasOwnProperty(a)&&(a=`docs${a}`,console.log(`From database doc share order ${this.order.join(",")}`),this.setScreenByOrder(a),this.docs.currNote=this.order[0],this.docs.displayScreen(a,this.order[0]))},
requestOrder(a){virtualclass.vutil.requestOrder("docs",a)},executeOrder(a){if(void 0!=a&&"undefined"!==typeof a){const b=virtualclass.dts;0<a.length&&("Failed"==a||"Error"==a?(console.log("page order retrieve failed"),$("#congdashboard").modal(),console.log(`dashboard length ${$("#congdashboard").length}`),virtualclass.dashBoard.clickCloseButton()):a&&roles.hasAdmin()&&(ioAdapter.mustSend({dts:{order_recived:a},cf:"dts"}),"DocumentShare"===virtualclass.currApp&&(b.afterRequestOrder(a),b.createNoteNav())))}},
getFilenameFromUploadingfiles(a){for(a=0;a<virtualclass.gObj.uploadingFiles.length;)return virtualclass.gObj.uploadingFiles[a].name},requestDocs(a){var b={filename:this.getFilenameFromUploadingfiles(a),fileuuid:a,filepath:"somewhere",filetype:"doc",key_room:`${virtualclass.gObj.sessionInfo.key}_${virtualclass.gObj.sessionInfo.room}`,status:1};this.allDocs[a]=b;b=0;if("true"==this.allDocs[a].status||1==this.allDocs[a].status)b=1;const c=`docs${a}`;"object"!==typeof this.pages[c]&&(this.pages[c]=new virtualclass.page("docScreenContainer",
"docs","virtualclassDocumentShare","dts",b),this.pages[c].init(a,this.allDocs[a].filename),this.allDocs[a].hasOwnProperty("notes")||document.querySelector(`#linkdocs${a}`).classList.add("noDocs"));ioAdapter.mustSend({dts:{allDocs:this.allDocs,doc:a},cf:"dts"});virtualclass.serverData.pollingStatus(virtualclass.dts.afterRequestNotes)},afterRequestNotes(){const a=virtualclass.dts;virtualclass.dts.afterFirstRequestDocs(virtualclass.serverData.rawData.docs);ioAdapter.mustSend({dts:{fallDocs:virtualclass.serverData.rawData.docs},
cf:"dts"});a.removeNoDocsElem();a.allPages=virtualclass.dts.fetchAllNotesAsArr();a.allNotes=virtualclass.dts.fetchAllNotes();a.storeInDocs(a.allNotes);virtualclass.storage.dstAllStore(virtualclass.serverData.rawData.docs);ioAdapter.mustSend({dts:{allNotes:a.allNotes},cf:"dts"})},removeNoDocsElem(){const a=document.querySelectorAll(".noDocs");for(let b=0;b<a.length;b++)a[b].classList.remove("noDocs")},requestNotes(a){const b=this;virtualclass.vutil.xhrSendWithForm({live_class_id:virtualclass.gObj.congCourse,
notes_id:"all",user:virtualclass.gObj.uid},"retrieve_all_notes").then(c=>{+c.data.status&&(b.allPages=c.data.resultdata,b.allNotes=b.convertInObjects(b.allPages),b.storeInDocs(b.allNotes),ioAdapter.mustSend({dts:{allNotes:b.allNotes,doc:a},cf:"dts"}))}).catch(a=>{console.error("Request failed with error ",a)})},firstRequestNotes(){const a=this;virtualclass.vutil.xhrSendWithForm({live_class_id:virtualclass.gObj.congCourse,notes_id:"all",user:virtualclass.gObj.uid},"retrieve_all_notes").then(b=>{a.allPages=
b.data.resultdata;a.allNotes=a.convertInObjects(a.allPages);a.storeInDocs(a.allNotes);ioAdapter.mustSend({dts:{fallNotes:a.allNotes},cf:"dts"});a.requestOrder(a.executeOrder)}).catch(a=>{console.error("Request failed with error ",a)})},requestSlidesOld(a){a=parseInt(a,10);console.log(`${virtualclass.gObj.currWb} `+`document share : request ${a}`);const b=this.getDocs(a),c=document.querySelector(`#linkdocs${a}`).dataset.selected;ioAdapter.mustSend({dts:{dres:a,ds:1-+c},cf:"dts"});return b},requestSlides(a){console.log(`${virtualclass.gObj.currWb} `+
`document share : request ${a}`);const b=this.getDocs(a),c=document.querySelector(`#linkdocs${a}`).dataset.selected;ioAdapter.mustSend({dts:{dres:a,ds:1-+c},cf:"dts"});return b},storeInDocs(a){virtualclass.storage.dstAllStore(virtualclass.serverData.rawData.docs)},removeWhiteboardFromStorage(a){virtualclass.storage.wbDataRemove(a)},getNotesOld(a){const b=[];for(const c in this.allNotes)this.allNotes[c].lc_content_id==a&&b.push(this.allNotes[c]);return b},getNotes(a){return this.allDocs[a].notesarr},
removePagesUI(a){a=this.getNotes(a);for(let b=0;b<a.length;b++)this._removePageUI(a[b].id);0>=this.order.length&&(c=!0);roles.hasControls()&&this.indexNav.createIndex()},_removePageUI(a,b){b=this.order.indexOf(a);0<=b&&this.order.splice(b,1);b=document.querySelector(`#notesContainer #note${a}`);null!=b&&b.parentNode.removeChild(b);"object"===typeof virtualclass.wb[`_doc_${a}_${a}`]&&delete virtualclass.wb[`_doc_${a}_${a}`];this.removeNoteNav(a);this.reaArrangeThumbCount();if(!roles.hasControls())if(a=
document.querySelector("#notesContainer .note.current"))a=a.id.split("note")[1],virtualclass.dts.indexNav.studentDocNavigation(a);else{if(a=document.getElementById("stdPageNo"))a.innerHTML=1;virtualclass.dts.indexNav.setTotalPages(virtualclass.dts.order.length)}},addPages(a){let b=0;for(;b<a.length;)a[b].hasOwnProperty("deletedn")||null!=this.order&&-1>=this.order.indexOf(a[b].id)&&this.order.push(a[b].id),b++},toggleSlideWithOrder(a,b){a=document.querySelector(`#linkdocs${a}`);if(null!=a){if(1==
a.dataset.selected)return a.dataset.selected=0,!1;a.dataset.selected=1;return!0}console.log("Document sharing There is no Element")},setLinkSelected(a,b){a=document.querySelector(`#linkdocs${a}`);null!=a&&(a.dataset.selected=b)},onResponseFiles(a,b,d,g,k){c&&(this.docs.currNote="undefined"!==typeof g?g:b[0].id,console.log(`Current note ${this.docs.currNote}`),c=!1);(roles.hasControls()?this.toggleSlideWithOrder(a,b):"undefined"!==typeof d?+d:1)?(this.addPages(b),a="string"!==typeof a?`docs${a}`:0<=
a.indexOf("docs")?a:`docs${a}`,this.createNoteLayout(b,a),"undefined"!==typeof g?this.docs.displayScreen(a,g):this.docs.displayScreen(a),"undefined"!==typeof k?this.createNoteNav(k):this.createNoteNav(),this.updateLinkNotes(this.docs.currNote),virtualclass.dts.setCurrentNav(this.docs.currNote),virtualclass.vutil.hideUploadMsg("docsuploadContainer"),virtualclass.vutil.addNoteClass()):(this.removePagesUI(a),virtualclass.dts.noteExist()||(virtualclass.vutil.showUploadMsg("docsuploadContainer"),virtualclass.dts.docs.currNote=
0,virtualclass.dts.docs.currDoc=void 0,virtualclass.gObj.currWb=null),virtualclass.dts.docSelected()||(b=JSON.parse(localStorage.getItem("dtsdocs")),null!=b&&(b.slideNumber=null,localStorage.setItem("dtsdocs",JSON.stringify(b))),roles.isStudent()&&(b=document.querySelector(`#cont${virtualclass.gObj.currWb}`),null!=b?b.style.display="block":(b=document.querySelector("#docScreenContainer"),null!=b&&b.classList.remove("noteDisplay"),virtualclass.gObj.currWb=null,document.querySelector("#virtualclassCont").classList.remove("pdfRendering"),
b=document.querySelector("#virtualclassAppLeftPanel.hideZoom"),g=document.querySelector("#virtualclassAppLeftPanel"),b||(g.classList.add("hideZoom"),g.classList.remove("showZoom"))))));null==document.querySelector("#listnotes .currentNav")&&(b=document.querySelector("#listnotes .linknotes"),null!=b&&(virtualclass.dts.currNote=b.dataset.rid,b=document.querySelector(`#mainpnotes${virtualclass.dts.currNote}`),null!=b&&(virtualclass.dts.docs.currDoc=virtualclass.dts.currNote.split("_")[0],b.click())));
roles.hasAdmin()&&this.sendOrder(this.order)},selectFirstNote(){if(null==document.querySelector("#notesContainer .current")){const a=document.querySelector("#notesContainer .note");null!=a&&(this.docs.currNote=a.dataset.slide,console.log(`Current note ${this.docs.currNote}`),this.docs.currDoc=`docs${this.getDocId(a.dataset.slide)}`,this.docs.note.getScreen(a))}},isDocumentExist(a){if("undefined"!==typeof a)return"layout"!=a.init&&"studentlayout"!=a.init?!0:!1},isDocAlreadyExist(a){for(let b=0;b<this.documents.length;b++)if(this.documents[b].id==
a)return!0;return!1},UI:{id:"virtualclassDocumentShare",class:"virtualclass container",container(){if(null==document.getElementById(this.id)){roles.hasAdmin();var a={control:roles.hasControls()};const b=virtualclass.getTemplate("docsMain","documentSharing");virtualclass.vutil.insertAppLayout(b(a));null==document.querySelector("#congdashboard")&&(a=virtualclass.getTemplate("dashboard")({app:"DocumentShare"}),document.querySelector("#dashboardContainer").innerHTML=a)}null==document.querySelector("#DocumentShareDashboard")&&
(a=document.createElement("div"),document.querySelector("#congdashboard .modal-body").appendChild(a),a.id="DocumentShareDashboard");null==document.querySelector("#docsDbCont")&&(document.querySelector("#DocumentShareDashboard").innerHTML=virtualclass.vutil.getDocsDashBoard("DocumentShare"),roles.hasControls()&&(virtualclass.vutil.attachEventToUploadTab(),null==document.querySelector("#DocumentShareDashboard .qq-gallery")&&virtualclass.vutil.modalPopup("docs",["docsuploadContainer"]),virtualclass.vutil.modalCloseHandler()))},
createMainContent(a,b,c){},createSlides(a,b){let c=document.querySelector("#notesContainer");null==c&&(c=document.createElement("div"),c.className="notes",c.id="notesContainer");for(let a=0;a<b.length;a++)if(null==document.querySelector(`#note${b[a].id}`)){const c=document.createElement("div");c.id=`note${b[a].id}`;c.className="note";c.dataset.slide=b[a].id;c.dataset.status="true"==c.dataset.statuS||1==c.dataset.statuS?1:"false"==c.dataset.status||0==c.dataset.status?0:b[a].status}a.appendChild(c);
roles.hasControls()&&(this.createNavigation(a,"prev"),this.createNavigation(a,"next"))},createNavigation(a,b){if(null==document.querySelector(`#docs${b}`)){const c=document.createElement("span");c.className=`${"nvgt "}${b}`;c.id=`docs${b}`;a.appendChild(c)}},createDocsNav(a,b){let c=document.getElementById("listDocs");null==c&&(c=document.createElement("div"),c.id="listDocs",a.appendChild(c));a=this.createDocsNavLink(b);this.attachDocsNav(a,b);c.appendChild(a)},createDocsNavLink(a){const b=document.createElement("div");
b.id=`link${a}`;b.className="linkdoc";b.innerHTML=a;b.dataset.screen=a;return b},attachDocsNav(a,b){a.onclick=virtualclass.dts.docs.goToDocs(b)}},createNoteNav(a){this.order&&this.indexNav.init();for(let c=0;c<this.order.length;c++){if("object"!==typeof this.notes[this.order[c]]){var b="true"==this.allNotes[this.order[c]].status||1==+this.allNotes[this.order[c]].status?1:0;this.notes[this.order[c]]=new virtualclass.page("screen-docs","notes","virtualclassDocumentShare","dts",b);this.notes[this.order[c]].init(this.order[c],
`note_${this.allNotes[this.order[c]].lc_content_id}_${this.order[c]}`);"undefined"===typeof a&&this.noteStatus(this.order[c],b)}roles.hasControls()&&this.indexNav.createDocNavigationNumber(this.order[c],c,b)}this.storeInDocs(this.allNotes);roles.hasControls()&&(this.indexNav.shownPage(this.indexNav.width),this.indexNav.addActiveNavigation(),document.querySelector("#dcPaging").addEventListener("change",function(){virtualclass.dts.docs.goToNavs(this.value)()}));document.querySelector(".congrea.teacher  #dashboardContainer .modal-header button.enable")||
virtualclass.vutil.showFinishBtn();this.indexNav.setTotalPages(virtualclass.dts.order.length)},addNoteHidClass(a,b,c){b>c?a.classList.add("hid","right"):a.classList.add("shw")},calcInitialWidth(){},indexHandler(a){virtualclass.dts.docs.goToNavs(a)},createNoteNavAlt(a){for(let c=0;c<this.order.length;c++){var b="true"==this.allNotes[this.order[c]].status||1==+this.allNotes[this.order[c]].status?1:0;this.notes[this.order[c]]=new virtualclass.page("screen-docs","notes","virtualclassDocumentShare","dts",
b);this.notes[this.order[c]].init(this.order[c],`note_${this.allNotes[this.order[c]].lc_content_id}_${this.order[c]}`);"undefined"===typeof a&&this.noteStatus(this.order[c],b)}"undefined"===typeof a&&this.storeInDocs(this.allNotes)},removeNoteNav(a){const b=document.querySelector(`#linknotes${a}`);null!=b&&b.parentNode.removeChild(b);"object"===typeof this.notes[a]&&delete this.notes[a]},docs:{num:0,currNote:0,curr(a,b){this.currDoc=a;virtualclass.dts.docs.num=a;const c=document.querySelector("#documentScreen .screen.current");
null!=c&&c.classList.remove("current");document.querySelector("#screen-docs").classList.add("current");document.querySelector("#documentScreen").dataset.screen=a;this.note="undefined"!==typeof b?new this.slide(b):new this.slide;this.note.init();this.note.currentSlide(this.currNote)},display(a){document.querySelector(a).style.display="block"},hide(a){document.querySelector(a).style.display="none"},goToDocs(a){const b=this;return function(){"object"===typeof virtualclass.dts.docs.note&&virtualclass.vutil.updateCurrentDoc(virtualclass.dts.docs.note.currNote);
b.executeScreen(a);roles.hasControls()&&(Object.keys(virtualclass.dts.notes).length?virtualclass.vutil.showFinishBtn():virtualclass.vutil.removeFinishBtn())}},goToNavs(a){return function(){const b=document.querySelector(`#linknotes${a}`);null!=b?1==+b.dataset.status&&(virtualclass.dts.docs.currNote=a,virtualclass.dts.docs.note.currentSlide(a)):(virtualclass.dts.docs.currNote=a,virtualclass.dts.docs.note.currentSlide(a));virtualclass.dts.indexNav.addActiveNavigation();virtualclass.dts.indexNav.UI.setClassPrevNext()}},
studentExecuteScreen(a){const b=a.dres;this.currDoc=b;const c=virtualclass.dts.getDocs(b);if(null!=c)virtualclass.dts.onResponseFiles(b,c,a.ds)},executeScreen(a,b,c,d){this.currDoc=a;-1==a.indexOf("docs")&&(this.currDoc=`docs${a}`);const f=virtualclass.dts;if(roles.hasControls()&&"undefined"===typeof b)b=f.requestSlides(a),null!=b?(f.onResponseFiles(a,b),"undefined"!==typeof c&&c()):console.log("There is no data");else{{"string"===typeof a&&-1<a.indexOf("docs")&&(a=a.split("docs")[1]);const g=f.getDocs(a);
if(null!=g){if("undefined"===typeof b)f.onResponseFiles(a,g,void 0,d);else f.onResponseFiles(a,g,void 0,d,"fromReload");"undefined"!==typeof c&&c()}}}},displayScreen(a,b){console.log("==== prev display screen");"undefined"!==typeof b?this.curr(a,b):this.curr(a)},async createWhiteboard(a){const b=`_doc_${a}_${a}`;console.log(`${virtualclass.gObj.currWb} `+"document share Create Whiteboard ");const c=document.createElement("div");c.id="cont";c.className="whiteboard";c.dataset.wid=b;c.id=`cont${c.dataset.wid}`;
a=document.querySelector(`.note[data-slide='${a}']`);null!=a?(a.insertBefore(c,a.firstChild),await virtualclass.vutil.createWhiteBoard(c.dataset.wid)):console.log("Element is null");console.log("==== previous set ",virtualclass.dtsConfig.id);virtualclass.previous=virtualclass.dtsConfig.id},slide:function(a){return{li_items:0,imageNumber:0,currSlide:"undefined"!==typeof a?a:0,currNote:"undefined"!==typeof a?a:0,doc:1,init(a){const b=virtualclass.dts;a="#screen-docs";var c=document.querySelector(`${a} .notes`);
this.doc=b.docs.num;if(null!=c){if(this.li_items=c.children,this.imageNumber=this.li_items.length,roles.hasControls()){c=document.querySelector(`${a} .prev`);a=document.querySelector(`${a} .next`);const d=this;c.onclick=function(){virtualclass.vutil.navWhiteboard(d,d.prevSlide,b)};a.onclick=function(){virtualclass.vutil.navWhiteboard(d,d.nextSlide,b)}}}else alert("no element")},slideTo(a,c){const b=a.dataset.slide;virtualclass.vutil.updateCurrentDoc(b);this.displaySlide(a);roles.hasControls()&&"undefined"===
typeof c&&(ioAdapter.mustSend({dts:{slideTo:b,docn:virtualclass.dts.docs.currDoc},cf:"dts"}),console.log(`Slide to document sharing ${b}`))},displaySlide(a){const b=document.querySelector("#screen-docs .note.current");null!=b&&b.classList.remove("current");null!=a&&a.classList.add("current");virtualclass.vutil.addNoteClass();roles.hasControls()||(a=a.id.split("note")[1],virtualclass.dts.indexNav.studentDocNavigation(a))},prevSlide(a){var b=a.docs.currNote,c=document.querySelector(`#documentScreen #note${b}`);
null!=c&&(c=c.previousElementSibling,null!=c?(0==+c.dataset.status?(b=this.getActiveSlide(a,b,"prev"))?(this.getScreen(b,!0),a.docs.currNote=b.dataset.slide,console.log(`Current note ${virtualclass.dts.docs.currNote}`)):virtualclass.dts.indexNav.UI._setArrowStatusDocs(document.getElementById("leftNavPage"),"disable","enable"):(this.getScreen(c,!0),a.docs.currNote=c.dataset.slide,console.log(`Current note ${virtualclass.dts.docs.currNote}`)),"object"===typeof virtualclass.wb[`_doc_${a.docs.currNote}_${a.docs.currNote}`]&&
system.setAppDimension(null,"resize"),virtualclass.dts.indexNav.movePageIndex("left")):virtualclass.dts.indexNav.UI._setArrowStatusDocs(document.getElementById("leftNavPage"),"disable","enable"))},getActiveSlide(a,c,d){c=document.querySelector(`#documentScreen #note${c}`);if(null!=c)return c="next"==d?c.nextElementSibling:c.previousElementSibling,null!=c?0==+c.dataset.status?this.getActiveSlide(a,c.dataset.slide,d):c:!1},nextSlide(a){var b=a.docs.currNote;if(b!=a.order[a.order.length-1]){var c=document.querySelector(`#documentScreen #note${b}`);
null!=c&&(c=c.nextElementSibling,null!=c&&(0==+c.dataset.status?(b=this.getActiveSlide(a,b,"next"))?(this.getScreen(b,!0),a.docs.currNote=b.dataset.slide,console.log(`Current note ${virtualclass.dts.docs.currNote}`)):alert("There is no page"):(this.getScreen(c,!0),a.docs.currNote=c.dataset.slide)));virtualclass.dts.indexNav.movePageIndex("right")}else virtualclass.dts.indexNav.UI._setArrowStatusDocs(document.getElementById("rightNavPage"),"disable","enable"),virtualclass.zoom.adjustScreenOnDifferentPdfWidth()},
isSlideAvailable(a,c){return a==c?!1:!0},currentSlide(a){const b=document.querySelector(`#documentScreen #note${a}`);null!=b?this.getScreen(b):console.log(`Document-Sharing:-${a} is not found `);a=document.querySelector("#docScreenContainer");null!=a&&a.classList.add("noteDisplay")},isPdfRendered(){const a=document.querySelector(`#canvas${virtualclass.gObj.currWb}`);return null!=a?a.parentNode.dataset.hasOwnProperty("pdfrender"):!1},getScreen(a,c){this.currNote=this.currSlide=a.dataset.slide;virtualclass.dts.currDoc=
this.doc;this.slideTo(a);null!=virtualclass.wb[virtualclass.gObj.currWb]&&console.log(`whiteboard ============ ${virtualclass.wb[virtualclass.gObj.currWb].gObj.queue.length}`);null!=virtualclass.wb[virtualclass.gObj.currWb]&&0<virtualclass.wb[virtualclass.gObj.currWb].gObj.queue.length&&(virtualclass.gObj.tempQueue[virtualclass.gObj.currWb]=virtualclass.wb[virtualclass.gObj.currWb].gObj.queue);this.isWhiteboardExist(this.currNote)?this.isWhiteboardExist(this.currNote)&&!this.isPdfRendered(this.currNote)?
(delete virtualclass.wb[virtualclass.gObj.currWb],virtualclass.dts.docs.createWhiteboard(this.currNote)):virtualclass.zoom.adjustScreenOnDifferentPdfWidth():virtualclass.dts.docs.createWhiteboard(this.currNote);virtualclass.vutil.updateCurrentDoc(this.currNote);virtualclass.dts.updateLinkNotes(this.currNote);c=virtualclass.dts.isFirstNote(a.id);a=virtualclass.dts.isLastNote(a.id);const b=document.querySelector("#screen-docs .pageContainer");c&&a?(b.classList.add("firstNote"),b.classList.add("lastNote")):
c?(b.classList.remove("lastNote"),b.classList.add("firstNote")):a?(b.classList.remove("firstNote"),b.classList.add("lastNote")):(b.classList.remove("firstNote"),b.classList.remove("lastNote"))},isWhiteboardExist(a){return null!=document.querySelector(`#${`containerWb_doc_${a}_${a}`}`)}}}},destroyDts(){const a=document.getElementById(virtualclass.dts.UI.id);null!=a?a.parentNode.removeChild(a):console.log("Element is null");virtualclass.dts=null},screenIsCreated(a){return null!=document.getElementById(`screen${a}`)},
convertInObjects(a){const b={};for(let c=0;c<a.length;c++)b[a[c].fileuuid]=a[c];return b},onmessage(a){"object"!==typeof virtualclass.dts&&virtualclass.makeAppReady("DocumentShare",void 0,{init:"studentlayout"});const {dts:b}=a.message;b.hasOwnProperty("docn")&&-1==b.docn.indexOf("docs")&&(b.docn=`docs${b.docn}`);if(b.hasOwnProperty("allNotes"))this.allNotes=b.allNotes,this.storeInDocs(this.allNotes);else if(b.hasOwnProperty("fallNotes"))this.allNotes=b.fallNotes,this.storeInDocs(this.allNotes),virtualclass.storage.dstAllStore(virtualclass.serverData.rawData.docs);
else if(b.hasOwnProperty("allDocs"))this.allDocs=b.allDocs,this.afterUploadFile(b.doc);else if(b.hasOwnProperty("fallDocs")){var c=this;c.afterFirstRequestDocs(b.fallDocs);virtualclass.serverData.rawData.docs=b.fallDocs;for(const a in virtualclass.serverData.rawData.docs[0].notes)virtualclass.createPrefetchLink(virtualclass.serverData.rawData.docs[0].notes[a].pdf)}else b.hasOwnProperty("dres")?(this.docs.studentExecuteScreen(b),console.log(`${virtualclass.gObj.currWb} `+"document share :- Layout initialized")):
b.hasOwnProperty("slideTo")?"object"!==typeof this.docs.note?(c=this,this.docs.executeScreen(b.docn,void 0,()=>{console.log("document share :- doc is not created");c.docs.note.currNote=b.slideTo;const a=document.querySelector(`#note${b.slideTo}`);c.docs.note.slideTo(a)},b.slideTo)):"object"===typeof this.docs.note&&b.docn!=this.docs.num?(this.docs.currNote=b.slideTo,console.log(`Current note ${this.docs.currNote}`),this.docs.executeScreen(b.docn,void 0),this.docs.note.currentSlide(b.slideTo)):(a=
document.querySelector(`#note${b.slideTo}`),null!=a?(this.docs.currNote=b.slideTo,console.log(`Current note ${this.docs.currNote}`),this.docs.note.getScreen(a),console.log(`${virtualclass.gObj.currWb} `+"document share :- Normal Case")):alert(`Note is not found ${b.slideTo}`)):b.hasOwnProperty("dispScreen")?(a=b.dispScreen.sc,virtualclass.vutil.updateCurrentDoc(a,b.dispScreen.sn),virtualclass.dts.screenIsCreated(a)?(console.log(`${virtualclass.gObj.currWb} `+"document share :- Only display screen"),
this.docs.displayScreen(a)):(console.log(`${virtualclass.gObj.currWb} `+"document share :- With screen Created"),this.docs.executeScreen(a,void 0,void 0,b.dispScreen.sn),"object"===typeof this.docs.note&&this.docs.note.getScreen(b.dispScreen.sn))):b.hasOwnProperty("rmnote")?this._delete(b.rmnote):b.hasOwnProperty("rmsnote")?(this._removePageUI(b.rmsnote),this._removePageFromStructure(b.rmsnote),this.storeInDocs(this.allNotes)):b.hasOwnProperty("noteSt")?(this.noteStatus(b.note,b.noteSt),this.storeInDocs(this.allNotes)):
b.hasOwnProperty("docSt")?this.docStatus(b.doc,b.docSt):b.hasOwnProperty("order_recived")?this.afterRequestOrder(b.order_recived):b.hasOwnProperty("norder")&&(this.order=b.norder,virtualclass.dts.indexNav.studentDocNavigation(this.docs.currNote))},sendCurrentSlide(){if(virtualclass.dts.docs.hasOwnProperty("currDoc")){const a=virtualclass.dts.docs.currDoc;void 0!=a?null!=document.querySelector("#listnotes .note")&&(ioAdapter.mustSend({dts:{slideTo:virtualclass.dts.docs.note.currNote,docn:a},cf:"dts"}),
console.log(`${virtualclass.gObj.currWb} `+"Document share send current slide")):console.log("Document sharing : doc number is undefined")}},sendCurrentDoc(){if(virtualclass.dts.docs.hasOwnProperty("currDoc"))if(void 0!=a){var a;ioAdapter.mustSend({dts:{doc:virtualclass.dts.docs.currDoc},cf:"dts"});console.log(`${virtualclass.gObj.currWb} `+"Document share send current doc only")}else console.log("Document sharing : doc number is undefined")},consoleMessage(a){console.log(`${virtualclass.gObj.currWb} ${a}`)},
_rearrange(a){alert(a.toString())},reArrangeNotes(a){this.order=a;this.reArrangeElements(a);roles.hasAdmin()&&(this.sendOrder(this.order),ioAdapter.mustSend({dts:{norder:this.order},cf:"dts"}))},sendOrder(a){virtualclass.vutil.sendOrder("docs",a)},reaArrangeThumbCount(){const a=document.querySelectorAll("#listnotes .thumbList");for(let b=0;b<a.length;b++)a[b].innerHTML=b+1},reArrangeElements(a){const b=document.getElementById("notesContainer"),c=document.createElement("div");c.id="notesContainer";
c.className="notes";for(let b=0;b<a.length;b++)c.appendChild(document.getElementById(`note${a[b]}`));b.parentNode.replaceChild(c,b);this.reaArrangeThumbCount();0<document.querySelectorAll("#dcPaging .noteIndex").length&&this.indexNav.rearrangePageNavigation(a);document.querySelector("#dcPaging").addEventListener("change",function(){virtualclass.dts.docs.goToNavs(this.value)()})},_delete(a){const b=document.querySelector(`#linkdocs${a}`);null!=b&&b.parentNode.removeChild(b);const c=this;virtualclass.xhrn.vxhrn.post(virtualclass.api.UpdateDocumentStatus,
{uuid:a,action:"delete",page:0}).then(a=>{"ok"==a.data.status&&c.sendOrder(c.order)});delete this.pages[`docs${a}`];this.removePagesUI(a);this.removePagesFromStructure(a);this.upateInStorage()},_deleteNote(a,b){this._removePageUI(a,b);this._removePageFromStructure(a,b);this.storeInDocs(this.allNotes);roles.hasControls()&&ioAdapter.mustSend({dts:{rmsnote:a},cf:"dts"});b=a.split("_");a=b[0];b=parseInt(b[1]);const c=this;virtualclass.xhrn.vxhrn.post(virtualclass.api.UpdateDocumentStatus,{uuid:a,action:"delete",
page:b}).then(a=>{"ok"==a.data.status&&c.sendOrder(c.order)});b=!1;const d=virtualclass.dts.allDocs[a];if(null!=d)for(let a=0;a<d.notesarr.length;a++)if(!d.notesarr[a].hasOwnProperty("deletedn")){b=!0;break}b||this._delete(a);roles.hasControls()&&this.indexNav.createIndex()},removePagesFromStructure(a){this.allDocs[a].deleted="0";let b;for(b in this.allNotes)-1<this.allNotes[b].id.indexOf(a)&&this._removePageFromStructure(this.allNotes[b].id);this.storeInDocs(this.allNotes)},updateInAllDocs(a){var b=
a.split("_")[0];b=this.allDocs[b];if("undefined"!==typeof b.notes[a]){b.notes[a].deletedn=a;for(let c=0;c<b.notesarr.length;c++)b.notesarr[c].id==a&&(b.notesarr[c].deletedn=a)}else console.log(`The note with the id ${a} is not available`)},_removePageFromStructure(a){this.removeWhiteboardFromStorage(`_doc_${a}_${a}`);this.allNotes[a].deletedn=a;this.updateInAllDocs(a)},_disable(a){this.docStatus(a)},_enable(a){this.docStatus(a)},docStatus(a,b){var c=document.querySelector(`#linkdocs${a} .controls.status`);
null!=c?"undefined"===typeof b&&(b=1-+c.dataset.status):console.log(`document share:- there is no element ${a}`);c=this.getDocs(a);for(let a=0;a<c.length;a++){const d=c[a].id;this.noteStatus(d,b);this.updatePageNavStatus(d,b)}this.storeInDocs(this.allNotes);roles.hasControls()&&ioAdapter.mustSend({dts:{docSt:b,doc:a},cf:"dts"})},updatePageNavStatus(a,b){const c=document.querySelector(`#linknotes${a}`);null!=c?(c.dataset.status=b,a=c.querySelector(".controls.status"),a.dataset.status=b,a.querySelector(".statusanch").innerHTML=
`status${b}`):console.log(`${"Document share : there is no element #linknotes"}${a}`)},_noteDisable(a){this.noteStatus(a);this.storeInDocs(this.allNotes);this.sendNoteStatus(a)},_noteEnable(a){this.noteStatus(a);this.storeInDocs(this.allNotes);this.sendNoteStatus(a)},sendNoteStatus(a){if(roles.hasControls()){const b=document.querySelector(`#note${a}`);null!=b?ioAdapter.mustSend({dts:{noteSt:b.dataset.status,note:a},cf:"dts"}):console.log("Element is null")}},noteStatus(a,b){const c=document.querySelector(`#note${a}`);
null!=c?(b="undefined"===typeof b?1-+c.dataset.status:1==b||"true"==b?1:0,c.dataset.status=b,b=this.allNotes[a],b.status=c.dataset.status,this.allNotes[a]=b):console.log(`there is no element #note${a}`)},getDocsOld(a){const b=[];for(const c in this.allNotes)a==this.allNotes[c].lc_content_id&&b.push(this.allNotes[c]);return b},getDocs(a){console.log("--------------");if(null!=this.allDocs&&"object"===typeof this.allDocs[a])return this.allDocs[a].notesarr;console.log(`There is no document with the id ${a}`)},
getDocId(a){return a.split("_")[0]},getAllNotes(a){const b=[];for(let c=0;c<a.length;c++)b.push(this.allNotes[a[c]]);return b},getNote(a){return this.allNotes[a]},updateLinkNotes(a){const b=document.querySelector("#listnotes .currentNav");null!=b&&b.classList.remove("currentNav");this.setCurrentNav(a)},setCurrentNav(a){a=document.querySelector(`#linknotes${a}`);null!=a&&a.classList.add("currentNav")},onAjaxResponse(a,b,c){if(c.hasOwnProperty("success")&&c.success){for(a=0;a<virtualclass.gObj.uploadingFiles.length;a++)this.afterUploadFile(virtualclass.gObj.uploadingFiles[a].uuid);
virtualclass.gObj.uploadingFiles=[];this.showUploadMsz(virtualclass.lang.getString("docUploadSuccess"),"alert-success")}else"duplicate"==c.message?this.showUploadMsz(virtualclass.lang.getString("duplicateUploadMsg"),"alert-error"):c.hasOwnProperty("error")?this.showUploadMsz(c.error,"alert-error"):this.showUploadMsz(virtualclass.lang.getString("someproblem"),"alert-error");if(a=document.querySelector("#DocumentShareDashboard .qq-upload-list-selector.qq-upload-list"))a.style.display="none";null!=document.querySelector("#listnotes")?
(virtualclass.vutil.makeElementDeactive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery"),virtualclass.vutil.makeElementActive("#listnotes")):console.log("List note is null")},showUploadMsz(a,b){const c=document.querySelector("#DocumentShareDashboard #docsUploadMsz");var d=document.querySelector("#DocumentShareDashboard #docsUploadMsz .alert");d&&d.parentNode.removeChild(d);d=document.createElement("div");d.className="alert  alert-dismissable";d.classList.add(b);d.innerHTML=
a;c.appendChild(d);a=document.createElement("button");a.className="close";a.setAttribute("data-dismiss","alert");a.innerHTML="&times";d.appendChild(a);a.addEventListener("click",function(){this.parentNode.remove()})},setNoteDimension(a,b,c){var d=document.querySelector(`#cont${c}`);null!=d&&(d=document.querySelector(`#${d.parentNode.id} .imageContainer img`),d.style.width=a,d.style.height=b);system.setDocCanvasDimension(a,b,c);c=document.querySelector("#screen-docs .pageContainer");roles.hasAdmin()&&
(b+=60);null!=c&&(c.style.width=`${a}px`,c.style.height=`${b}px`)},isFirstNote(a){const b=document.querySelector("#notesContainer .note");return null!=b&&a==b.id},isLastNote(a){const b=document.querySelectorAll("#notesContainer .note"),c=b[b.length-1];return 0<b.length&&c.id==a},noteExist(){return null!=document.querySelector("#notesContainer .note")},docSelected(){return document.querySelector('#listdocs .linkdocs[data-selected="1"]')},isUploaderExist(){return null!=document.querySelector("#docsuploadContainer .qq-uploader-selector")},
upateInStorage(){if(virtualclass.hasOwnProperty("dts")&&typeof virtualclass.dts.hasOwnProperty("pages")&&"object"===typeof virtualclass.dts.pages){const a={};a.docs=virtualclass.dts.pages;a.order=JSON.stringify(virtualclass.dts.order);a.slideNumber=0<virtualclass.dts.order.length?virtualclass.dts.docs.note.currNote:null;localStorage.setItem("dtsdocs",JSON.stringify(a))}}}}})(window);(function(d){"use strtic";let c,a;d.quiz=function(){return{coursequiz:[],uid:virtualclass.gObj.uid,qzid:0,newUserTime:{},list:[],listQuiz:{},uniqueUsers:[],usersFinishedQz:[],quizJSON:{},attemptedUsers:{},cmid:2,exportfilepath:d.exportfilepath,quizSt:{},quizAttempted:{},qGrade:[],init(){virtualclass.previrtualclass="virtualclassQuiz";virtualclass.previous="virtualclassQuiz";this.cmid=virtualclass.vutil.getUrlVars(exportfilepath).cmid;!roles.hasAdmin()||roles.isEducator()?roles.isStudent()?this.UI.defaultLayoutForStudent():
(this.UI.container(),roles.hasControls()?ioAdapter.mustSend({quiz:{quizMsg:"init"},cf:"quiz"}):this.UI.defaultLayoutForStudent()):(this.UI.container(),ioAdapter.mustSend({quiz:{quizMsg:"init"},cf:"quiz"}));roles.hasControls()&&(console.log("fetchquizes"),this.interfaceToFetchList(this.cmid));const a=JSON.parse(localStorage.getItem("quizSt"));a&&(this.storedDataHandle(a),virtualclass.quiz.quizSt=a)},storedDataHandle(a){if("stdPublish"==a.screen){var b=this;virtualclass.storage.getQuizData(a=>{a.hasOwnProperty("qData")?
(a=JSON.parse(a.qData),b.quizDisplay(a)):console.log("Quiz data is not available")})}else if("quizsubmitted"==a.screen){const a=JSON.parse(localStorage.getItem("qRep"));this.UI.displayStudentResultScreen(a)}else"tchResultView"==a.screen&&(b=this,virtualclass.storage.getQuizData(c=>{if("undefined"!==typeof c&&c.hasOwnProperty("qData")&&c.hasOwnProperty("qDetail")){const d=JSON.parse(c.qDetail);b.quizJSON=c.qData;b.openQuizPopup(b.quizJSON,d.id);b.UI.resultView(d);b.tabContent();c.hasOwnProperty("qAttempt")&&
(b.quizAttempted=JSON.parse(c.qAttempt),b.displayAttemptOverview());c.hasOwnProperty("qGrade")&&(b.qGrade=JSON.parse(c.qGrade),b.displayGradeReport());"true"==a.qClosed&&(document.getElementById("closeQzBt").disabled=!0)}}),virtualclass.quiz.quizSt.screen=a.screen)},displayQuizList(){var a=!1;virtualclass.quiz.dispList("course");document.getElementById("listquizcourse");if(0<Object.keys(this.coursequiz).length){for(const b in this.coursequiz)this.coursequiz.hasOwnProperty(b)&&!+this.coursequiz[b].quizstatus&&
(a=!0,this.displayQuizes(this.coursequiz[b],b));this.UI.listHeader();if(a)a=document.querySelector("#virtualclassCont.congrea #layoutQuiz #headerContainer"),a.classList.contains("show")||a.classList.add("show");else if(a=document.querySelector("#virtualclassCont.congrea #layoutQuiz #mszBoxQuiz"))a.classList.add("show"),a.innerHTML=virtualclass.lang.getString("noQuiz")}else if(a=document.querySelector("#virtualclassCont.congrea #layoutQuiz #mszBoxQuiz"))a.classList.add("show"),a.innerHTML=virtualclass.lang.getString("noQuiz")},
dispList(){document.getElementById("mszBoxQuiz");const a=document.getElementById("listQzCont");a?a.style.display="block":(console.log("quiz layout 2"),this.UI.layout2("layoutQuizBody"))},interfaceToFetchList(a){a=new FormData;a.append("cmid",this.cmid);a.append("user",this.uid);const b=this;virtualclass.xhr.vxhr.post(`${d.webapi}&methodname=congrea_quiz`,a).then(a=>{a=a.data;if(0==a.status)document.getElementById("bootstrapQzCont").innerHTML=virtualclass.lang.getString("noQuiz");else{for(let b=0;b<=
a.length-1;b++){const {options:c}=a[b];for(const d in c)a[b].options[d]=c[d].options}b.coursequiz=a;b.displayQuizList()}}).catch(a=>{console.error("Request failed with error ",a)})},displayQuizes(a,c){this.UI.qzCont(c);this.UI.qzCtrCont(c);this.UI.qzTextCont(a,c);this.attachQZEvent(`publishQz${c}`,"click",this.publishHandler,a,c)},attachQZEvent(a,c,d,k,m){a=document.getElementById(a);null!=a&&a.addEventListener(c,()=>{"undefined"!==typeof k?(console.log("attach time handler"),d(k,m)):console.log("quiz is missing no need of time")})},
publishHandler(a,c){const b=document.getElementById("mszBoxQuiz");0<b.childNodes.length&&b.childNodes[0].parentNode.removeChild(b.childNodes[0]);virtualclass.quiz.publishQuiz(a,c)},publishQuiz(a,c){this.openQuizPopup(a,c);this.quizPreview(a);a=document.querySelector("#editQuizModal");a.className="modal in";a.style.display="block"},openQuizPopup(a,c){this.qzid=c;a=document.getElementById("layoutQuizBody");c=document.createElement("div");c.className="container";a.appendChild(c);(a=document.getElementById("editQuizModal"))&&
a.remove();a=document.getElementById("bootstrapQzCont");virtualclass.quiz.UI.generateModal("editQuizModal",a)},showQn(a){roles.hasControls()?a.innerHTML="quiz question":a.innerHTML="quiz question for student"},action(a,c,d){c(a,d)},getQuizData(a){const b=this.coursequiz[a.id],g=new FormData;g.append("cmid",this.cmid);g.append("user",this.uid);g.append("qid",a.id);c=this;virtualclass.xhr.vxhr.post(`${d.webapi}&methodname=congrea_get_quizdata`,g,{transformResponse:a=>a}).then(a=>{if(c.isJson(a.data))c.quizJSON=
a.data,$("#slickQuiz").slickQuiz({json:c.quizJSON,questionPerPage:b.questionsperpage,questionMode:b.preferredbehaviour,quizTime:b.timelimit,displayDetailResult:!1});else{const b=document.getElementById("publishQzBt");b.parentNode.removeChild(b);document.getElementById("contQzBody").innerHTML=a}}).catch(a=>{console.error("Request failed with error ",a)})},quizPopUp(a,c){console.log("quiz pop up");const b=function(){console.log(this.id);virtualclass.quiz.action(this.id,a,c)},d=(document.getElementById("editQuizModal")?
document.getElementById("editQuizModal"):document.getElementById("qzPopup")).querySelectorAll(":scope .controls");for(let a=0;a<d.length;a++)d[a].addEventListener("click",b)},quizPreview(a){console.log("quiz preview function");this.UI.modalContentUI();var b=document.getElementById("contQzHead"),c=document.createElement("div");c.id="QstnName";c.innerHTML=a.name;b.appendChild(c);c=document.getElementById("contQzBody");b=document.createElement("button");b.id="publishQzBt";b.classList.add("btn","btn-default",
"controls");b.innerHTML=virtualclass.lang.getString("PQuiz");c.appendChild(b);c=document.createElement("i");c.className="icon-publish";b.appendChild(c);this.getQuizData(a);this.quizPopUp(this.popupFn,1)},popupFn(a,c){virtualclass.quiz[a].call(virtualclass.quiz,c)},publishQzBt(){const a=virtualclass.quiz;var c=a.quizJSON,g=JSON.parse(c).questions.length;a.coursequiz[a.qzid].noOfQus=g;g=a.coursequiz[a.qzid];const k={json:c,questionPerPage:g.questionsperpage,questionMode:g.preferredbehaviour,quizTime:g.timelimit,
displayDetailResult:!1,ptm:(new Date).getTime()};ioAdapter.mustSend({quiz:{quizMsg:"stdPublish",quizId:a.qzid,data:k},cf:"quiz"});a.UI.resultView(g);a.tabContent();a.quizSt.screen="tchResultView";virtualclass.storage.quizStorage("qDetail",JSON.stringify(g));virtualclass.storage.quizStorage("qData",c);c=new FormData;c.append("cmid",a.cmid);c.append("qzid",a.qzid);c.append("user",a.uid);virtualclass.xhr.vxhr.post(`${d.webapi}&methodname=congrea_add_quiz`,c).then(a=>{"ture"!==a.data&&console.log("Quiz data not saved in congrea")}).catch(a=>
{console.error("Request failed with error ",a)})},closeQzBt(){console.log("-------CLOSE QUIZ--------");var {qzid:a}=virtualclass.quiz;ioAdapter.mustSend({quiz:{quizMsg:"stdShowResult",data:{qzid:a}},cf:"quiz"});null!=virtualclass.gObj.CDTimer&&(clearInterval(virtualclass.gObj.CDTimer),console.log("Clear quiz interval"));document.getElementById("closeQzBt").disabled=!0;a=document.createElement("div");a.className="alert alert-info";a.innerHTML=virtualclass.lang.getString("QClosed");resultQzLayout.insertBefore(a,
resultQzLayout.firstChild)},quizDisplay(a){var b=document.getElementById("mszBoxQuiz");b&&b.parentNode.removeChild(b);(b=document.getElementById("contQzBody"))&&b.parentNode.removeChild(b);b=document.getElementById("bootstrapQzCont");const c=virtualclass.view.customCreateElement("div","contQzBody","modal-body");b.appendChild(c);this.UI.modalContentUI();$("#slickQuiz").slickQuiz(a)},saveInLocalStorage(){const a=virtualclass.quiz;null!=document.querySelector("#qztime")&&(a.quizSt.qtime=document.querySelector("#qztime").textContent,
console.log(`quiz=${a.quizSt.qtime}`));null!=document.querySelector("#elsTime")&&(a.quizSt.qtime=document.querySelector("#elsTime").textContent,console.log(`quiz=${a.quizSt.qtime}`));console.log(`quiz=${a.quizSt.screen}`);null!=document.getElementById("closeQzBt")&&1==document.getElementById("closeQzBt").disabled&&(a.quizSt.qClosed="true");a.quizSt&&localStorage.setItem("quizSt",JSON.stringify(a.quizSt));a.quizAttempted&&(console.log(`attempt data =${a.quizAttempted}`),virtualclass.storage.quizStorage("qAttempt",
JSON.stringify(a.quizAttempted)))},onmessage(a,c){const b=virtualclass.quiz;"stdPublish"==a.quiz.quizMsg&&(b.dataRec=a.quiz.data,virtualclass.storage.quizStorage("qData",JSON.stringify(b.dataRec)),b.quizSt.screen="stdPublish",this.quizDisplay(a.quiz.data));if("stdShowResult"==a.quiz.quizMsg||"quizTimeEnd"==a.quiz.quizMsg){null!=document.querySelector("#timeText")&&(document.querySelector("#timeText").textContent="Quiz has been closed");var d=document.querySelector("#slickQuiz .quizResults");d&&"block"!=
d.style.display&&(d=document.querySelectorAll("#slickQuiz .nextQuestion"),d[d.length-1].click())}"quizClosed"==a.quiz.quizMsg&&(localStorage.removeItem("quizSt"),this.quizSt={},localStorage.removeItem("qRep"),virtualclass.storage.clearTableData("quizData"),this.UI.defaultLayoutForStudent());if("quizAttempt"==a.quiz.quizMsg&&roles.hasControls()){"undefined"===typeof this.attemptedUsers[a.quiz.questionId]&&(this.attemptedUsers[a.quiz.questionId]={});d=a.quiz.user;"undefined"===typeof this.attemptedUsers[a.quiz.questionId][d]&&
(this.attemptedUsers[a.quiz.questionId][d]={});this.attemptedUsers[a.quiz.questionId][d]=a.quiz.ans;d=Object.keys(this.attemptedUsers[a.quiz.questionId]).length;let b=0;for(var f in this.attemptedUsers[a.quiz.questionId])1==this.attemptedUsers[a.quiz.questionId][f]&&b++;document.getElementById(`usA_${a.quiz.questionId}`).innerHTML=d;f=0;0<b&&(f=b/d*100);const c=document.getElementById(`qPb_${a.quiz.questionId}`);c.innerHTML=`${f}% correct`;c.style.width=`${f}%`;"undefined"===typeof this.quizAttempted[a.quiz.questionId]&&
(this.quizAttempted[a.quiz.questionId]={});this.quizAttempted[a.quiz.questionId].uA=d;this.quizAttempted[a.quiz.questionId].cA=b}"quizsubmitted"==a.quiz.quizMsg&&roles.hasControls()&&(this.usersFinishedQz.push(a.quiz.user),c="undefined"==!typeof c.lname?`${c.name} ${c.lname}`:c.name,this.gradeReport(this.usersFinishedQz.length,c,a.quiz.timetaken,a.quiz.score,a.quiz.quesattemptd,a.quiz.correctans),this.qGrade.push({nm:c,tt:a.quiz.timetaken,sc:a.quiz.score,qAt:a.quiz.quesattemptd,ca:a.quiz.correctans}),
virtualclass.storage.quizStorage("qGrade",JSON.stringify(b.qGrade)),this.saveGradeInDb(a.quiz.user,a.quiz.timetaken,a.quiz.score,a.quiz.quesattemptd,a.quiz.correctans))},saveGradeInDb(a,c,g,k,m){const b=virtualclass.quiz;c=this.convertTimeToSec(c);const f=new FormData;f.append("cmid",b.cmid);f.append("qzid",b.qzid);f.append("user",a);f.append("grade",g);f.append("timetaken",c);f.append("qusattempted",k);f.append("currectans",m);virtualclass.xhr.vxhr.post(`${d.webapi}&methodname=congrea_quiz_result`,
f).then(a=>{"ture"!==a.data&&console.log("Quiz data not saved in congrea")}).catch(a=>{console.error("Request failed with error ",a)})},displayAttemptOverview(){const a=virtualclass.quiz;for(const b in a.quizAttempted)if(document.getElementById(`usA_${b}`).innerHTML=a.quizAttempted[b].uA,0<a.quizAttempted[b].cA){const c=(a.quizAttempted[b].cA/a.quizAttempted[b].uA*100).toFixed(2),d=document.getElementById(`qPb_${b}`);d.innerHTML=`${c}% correct`;d.style.width=`${c}%`}},displayGradeReport(){const a=
virtualclass.quiz;for(let b=0;b<a.qGrade.length;b++)a.gradeReport(b+1,a.qGrade[b].nm,a.qGrade[b].tt,a.qGrade[b].sc,a.qGrade[b].qAt,a.qGrade[b].ca)},attemptProgressReport(){var a=JSON.parse(virtualclass.quiz.quizJSON);const c=virtualclass.view.customCreateElement("div","attemptQzBody","modal-body");a=a.questions;let d=1;for(let b=0;b<a.length;b++){const f=virtualclass.view.customCreateElement("div","","q-area");c.appendChild(f);var k=virtualclass.view.customCreateElement("span","","q-no");k.innerHTML=
d;f.appendChild(k);k=virtualclass.view.customCreateElement("div","","qscolor");k.innerHTML=a[b].q;f.appendChild(k);k=virtualclass.view.customCreateElement("div");k.innerHTML=`Users attempted : <span id='usA_${a[b].qid}'>0</span>`;f.appendChild(k);k=this.UI.createProgressBar(a[b].qid,0);f.appendChild(k);d++}return c},tabContent(){const a=document.getElementById("resultQzLayout"),c=virtualclass.view.customCreateElement("div","","tab-content");var d=virtualclass.view.customCreateElement("div","qzOverv");
d.className="tab-pane fade in active";var k=this.attemptProgressReport();d.appendChild(k);c.appendChild(d);d=virtualclass.view.customCreateElement("div","gdRpt");d.className="tab-pane fade";k=this.UI.gradeReportLayout();d.appendChild(k);c.appendChild(d);a.appendChild(c)},gradeReport(a,c,d,k,m,n){var b=document.getElementById("qzReTbody");if(b){const f=document.createElement("tr");b.appendChild(f);b=document.createElement("th");b.scope="row";b.innerHTML=a;f.appendChild(b);a=document.createElement("td");
a.innerHTML=c;f.appendChild(a);c=document.createElement("td");c.innerHTML=d;f.appendChild(c);d=document.createElement("td");d.innerHTML=`${k}%`;f.appendChild(d);k=document.createElement("td");k.innerHTML=m;f.appendChild(k);m=document.createElement("td");m.innerHTML=n;f.appendChild(m)}},quizTimer(a,c,d){function b(){g="asc"==d?a+((Date.now()-f)/1E3|0):a-((Date.now()-f)/1E3|0);q=g/3600|0;r=g%3600/60|0;z=g%60|0;q=10>q?`0${q}`:q;r=10>r?`0${r}`:r;z=10>z?`0${z}`:z;c.textContent=`${q}:${r}:${z}`;0>=g&&("asc"!=
d&&(c.textContent="00 : 00 : 00 "),f=0,null!=virtualclass.gObj.CDTimer&&(clearInterval(virtualclass.gObj.CDTimer),console.log("Clear quiz interval")),ioAdapter.mustSend({quiz:{quizMsg:"quizTimeEnd",quizId:virtualclass.view.qzid},cf:"quiz"}),roles.hasControls()&&(document.getElementById("closeQzBt").disabled=!0))}d="undefined"!==typeof d?d:"desc";let f=Date.now(),g,q,r,z;"asc"!==d&&b();virtualclass.gObj.CDTimer=setInterval(b,1E3)},quizModalClose(){const a=this,c=virtualclass.lang.getString("rusureCquiz");
virtualclass.popup.confirmInput(c,b=>{b&&(localStorage.removeItem("quizSt"),a.quizSt={},virtualclass.storage.clearTableData("quizData"),localStorage.removeItem("qRep"),b=document.getElementById("editQuizModal"),b.parentNode.removeChild(b),a.attemptedUsers={},a.quizAttempted={},ioAdapter.mustSend({quiz:{quizMsg:"quizClosed",quizId:a.qzid},cf:"quiz"}))})},convertSecToTime(a){if(/^\d+$/.test(a)){const b=new Date(null);b.setSeconds(a);return b.toISOString().substr(11,8)}return"00:00:00"},convertTimeToSec(a){return a?
(a=a.split(":"),3600*+a[0]+60*+a[1]+ +a[2]):0},isJson(a){try{JSON.parse(a)}catch(f){return!1}return!0},UI:{id:"virtualclassQuiz",class:"virtualclass",container(){console.log("quiz layout check");var a=document.getElementById(this.id);null!=a&&a.parentNode.removeChild(a);a=virtualclass.view.customCreateElement("div",this.id,this.class);virtualclass.vutil.insertAppLayout(a);this.layout(a)},layout(a){const b=virtualclass.view.customCreateElement("div","layoutQuiz","bootstrap container-fluid quizLayout");
a.appendChild(b);a=document.createElement("nav");a.className="nav navbar ";b.appendChild(a);const c=virtualclass.view.customCreateElement("div","","vchead");c.innerHTML=virtualclass.lang.getString("Quiz");a.appendChild(c);a=virtualclass.view.customCreateElement("div","layoutQuizBody","quizMainCont");b.appendChild(a);this.createMszBox(a);this.createModalCont(a)},createModalCont(a){const b=virtualclass.view.customCreateElement("div","bootstrapQzCont","modalCont");a.appendChild(b)},layout2(a){a=document.getElementById(a);
var b=document.getElementById("listQzCont");if(null==b){const c=document.createElement("div");c.className="table-responsive";a.appendChild(c);b=virtualclass.view.customCreateElement("table","listQzCont","table table-bordered table-striped quizList");c.appendChild(b)}},listHeader(){var a=document.getElementById("listQzCont");const c=document.createElement("tr");c.classList.add("headerContainer");c.id="headerContainer";a.insertBefore(c,a.firstChild);a=document.createElement("th");a.classList.add("controlsHeader");
a.innerHTML=virtualclass.lang.getString("Controls");c.appendChild(a);var d=document.createElement("i");d.className="icon-setting";a.appendChild(d);a=document.createElement("th");a.classList.add("qnTextHeader");a.innerHTML=virtualclass.lang.getString("Quizes");c.appendChild(a);d=document.createElement("i");d.className="icon-help";a.appendChild(d);a=document.createElement("th");a.classList.add("timeHeader");a.innerHTML=virtualclass.lang.getString("Time");c.appendChild(a);d=document.createElement("i");
d.className="icon-creator";a.appendChild(d);a=document.createElement("th");a.classList.add("qperpageHeader");a.innerHTML=virtualclass.lang.getString("Quiz/page");c.appendChild(a)},createTab(){const a=document.createElement("ul");a.classList.add("nav","nav-tabs");const c=document.createElement("li");c.className="active";var d=document.createElement("a");d.setAttribute("data-toggle","tab");d.href="#qzOverv";d.innerHTML="Questions overview";c.appendChild(d);a.appendChild(c);const k=document.createElement("li");
d=document.createElement("a");d.setAttribute("data-toggle","tab");d.href="#gdRpt";d.innerHTML=virtualclass.lang.getString("Greport");k.appendChild(d);a.appendChild(k);k.addEventListener("click",()=>{k.classList.toggle("active");c.classList.toggle("active");k.classList.contains("active")&&(document.querySelector("#gdRpt").className="tab-pane fade in active",document.querySelector("#qzOverv").className="tab-pane fade")});c.addEventListener("click",()=>{c.classList.toggle("active");k.classList.toggle("active");
c.classList.contains("active")&&(document.querySelector("#qzOverv").className="tab-pane fade in active",document.querySelector("#gdRpt").className="tab-pane fade")});return a},resultView(a){document.getElementById("layoutQuiz");if(roles.hasControls()){this.createResultLayout();var b=document.querySelector("#contQzHead"),c=document.querySelector("#QstnName");null==c&&(c=document.createElement("div"),c.id="QstnName",c.innerHTML=a.name,null!=b&&b.appendChild(c));let f=parseInt(a.timelimit);if(0<f){c=
"desc";var d="Time remaining"}else c="asc",d="Elapsed time";b=localStorage.getItem("quizSt");null!=b&&(b=JSON.parse(b),0<Object.keys(b).length&&(b=b.qtime.split(":"),f=parseInt(b[2])+60*parseInt(b[1])+3600*parseInt(b[0])));b=document.getElementById("resultQzLayout");const g=virtualclass.view.customCreateElement("div","rsQzHead","row col-md-12");b.appendChild(g);var m=virtualclass.view.customCreateElement("div","","col-md-3");m.innerHTML=`Time limit : <span> ${virtualclass.quiz.convertSecToTime(a.timelimit)}</span>`;
g.appendChild(m);m=virtualclass.view.customCreateElement("div","","col-md-3");m.innerHTML=`No of questions : <span> ${a.noOfQus}</span>`;g.appendChild(m);a=virtualclass.view.customCreateElement("div","","col-md-4");a.innerHTML=`${d} : <span id="elsTime">00:00:00</span>`;g.appendChild(a);a=virtualclass.view.customCreateElement("button","closeQzBt","");a.classList.add("btn","btn-default","controls");a.innerHTML=virtualclass.lang.getString("Cquiz");g.appendChild(a);a.addEventListener("click",virtualclass.quiz.closeQzBt);
a=JSON.parse(localStorage.getItem("quizSt"));null==a||"true"!=a.qClosed&&!a.qClosed?virtualclass.quiz.quizTimer(f,document.getElementById("elsTime"),c):(console.log("Don't run timer when quiz is closed"),c=document.querySelector("#elsTime"),localStorage.setItem("quizSt",JSON.stringify(a)),null!=c&&(c.innerHTML=a.qtime));c=this.createTab();b.appendChild(c)}},createResultLayout(){var b=document.getElementById("resultQzLayout");b&&b.parentNode.removeChild(b);if(roles.hasControls()){b=document.getElementById("contQzHead");
(a=document.getElementById("publishQzBt"))&&a.parentNode.removeChild(a);var c=document.querySelector("#contQzHead .close");c&&(c.parentNode.removeChild(c),c=virtualclass.view.customCreateElement("div","modalQzClose","close"),c.type="button",c.innerHTML="&times",b.appendChild(c));if(b=document.getElementById("quizModalBody"))for(;1<b.childElementCount;)b.removeChild(b.lastChild);c=document.createElement("div");c.id="resultQzLayout";b.appendChild(c);document.getElementById("modalQzClose").addEventListener("click",
()=>{virtualclass.quiz.usersFinishedQz=[];virtualclass.quiz.qGrade=[];virtualclass.quiz.quizModalClose()})}},createProgressBar(a,c){const b=virtualclass.view.customCreateElement("div","","progress");a=virtualclass.view.customCreateElement("div",`qPb_${a}`,"progress-bar");a.role="progressbar";a.setAttribute("setaria-valuenow",c);a.setAttribute("aria-valuemin","0");a.setAttribute("aria-valuemax","100");a.style=`width:${c}%`;a.innerHTML=`${c}% Correct`;b.appendChild(a);return b},gradeReportLayout(){const a=
virtualclass.view.customCreateElement("div","gradeRpBody","modal-body"),c=virtualclass.view.customCreateElement("table","","table");var d=virtualclass.view.customCreateElement("thead","","thead-inverse");const k=document.createElement("tr");var m=document.createElement("th");m.innerHTML="#";k.appendChild(m);m=document.createElement("th");m.innerHTML="Name";k.appendChild(m);m=document.createElement("th");m.innerHTML="Time taken";k.appendChild(m);m=document.createElement("th");m.innerHTML="Grade";k.appendChild(m);
m=document.createElement("th");m.innerHTML="Q. attempted";k.appendChild(m);m=document.createElement("th");m.innerHTML="Correct";k.appendChild(m);d.appendChild(k);c.appendChild(d);d=virtualclass.view.customCreateElement("tbody","qzReTbody");c.appendChild(d);a.appendChild(c);return a},displayStudentResultScreen(a){var b=document.getElementById("mszBoxQuiz");if(b){var c=document.getElementById("stdQuizMszLayout");c&&b.removeChild(c);c=virtualclass.view.customCreateElement("div","resultDiv");b.appendChild(c);
b=document.createElement("h4");b.innerHTML=`<span class='col-md-4'> Total no of questions </span>  <span class='nfqh'>: &nbsp;  ${a.grade.noofqus}</span>`;c.appendChild(b);b=document.createElement("h4");b.innerHTML=` <span class='col-md-4'> Time taken </span><span class='tth'> : &nbsp;   ${a.grade.timetaken}</span>`;c.appendChild(b);b=document.createElement("h4");b.innerHTML=` <span class='col-md-4'> Maximum mark </span><span class='mmh'>: &nbsp;  ${a.grade.maxmarks}</span>`;c.appendChild(b);b=document.createElement("h4");
b.innerHTML=`<span class='col-md-4'> Correct answers </span><span class='cah'>: &nbsp;  ${a.grade.correctans}</span>`;c.appendChild(b);b=document.createElement("h4");b.innerHTML=` <span class='col-md-4'> Questions attempted</span> <span class='qah'>: &nbsp;  ${a.grade.quesattemptd}</span>`;c.appendChild(b);b=document.createElement("h4");b.innerHTML=` <span class='col-md-4'> You Scored </span> <span class='sch'>: &nbsp;  ${a.grade.score}</span>`;c.appendChild(b);c.style.display="block"}},createMszBox(a){const b=
virtualclass.view.customCreateElement("div","mszBoxQuiz","row");a.appendChild(b)},generateModal(a,c){const b=virtualclass.view.customCreateElement("div",a,"modal");b.role="dialog";b.style.display="none";b.setAttribute("tab-index","-1");b.setAttribute("area-hidden","true");c.appendChild(b);c=document.createElement("div");c.className="modal-dialog";b.appendChild(c);a=virtualclass.view.customCreateElement("div","quizModalBody","modal-content");c.appendChild(a);c=virtualclass.view.customCreateElement("div",
"contQzHead","modal-header");a.appendChild(c);const d=virtualclass.view.customCreateElement("div","","close");d.type="button";d.setAttribute("data-dismiss","modal");d.innerHTML="&times";c.appendChild(d);c=virtualclass.view.customCreateElement("div","contQzBody","modal-body");a.appendChild(c);document.querySelector("#editQuizModal #contQzHead .close ").addEventListener("click",()=>{b.style.display="none";b.className="modal fade"})},modalContentUI(){const a=document.getElementById("contQzBody"),c=virtualclass.view.customCreateElement("div",
"slickQuiz","path-mod-congrea-quiz");var d=virtualclass.view.customCreateElement("h3","","quizName");c.appendChild(d);d=virtualclass.view.customCreateElement("P","timeText");c.appendChild(d);var k=virtualclass.view.customCreateElement("div","exam_navblock","navblock");c.appendChild(k);d=virtualclass.view.customCreateElement("div","","content");k.appendChild(d);k=virtualclass.view.customCreateElement("div","","qn_buttons multipages");d.appendChild(k);d=virtualclass.view.customCreateElement("div","",
"quizArea");c.appendChild(d);k=virtualclass.view.customCreateElement("div","","quizHeader");d.appendChild(k);d=virtualclass.view.customCreateElement("a","","button startQuiz");d.href="#";d.innerHTML="Get Started!";k.appendChild(d);k=virtualclass.view.customCreateElement("div","","quizResults");c.appendChild(k);var m=virtualclass.view.customCreateElement("h3","","quizScore");m.innerHTML="You Scored: <span></span>";k.appendChild(m);m=virtualclass.view.customCreateElement("h3","","quizLevel");d.innerHTML=
"<strong>Ranking:</strong> <span></span>";k.appendChild(m);d=virtualclass.view.customCreateElement("div","","quizResultsCopy");k.appendChild(d);a.appendChild(c)},qzCont(a){const b=document.getElementById("listQzCont");a=virtualclass.view.customCreateElement("tr",`contQz${a}`,"vcQuizCont");null!=b&&b.insertBefore(a,b.firstChild)},qzCtrCont(a){var b=document.getElementById(`contQz${a}`);const c=virtualclass.view.customCreateElement("td",`ctrQz${a}`,"quizCtrCont");b.appendChild(c);b=document.createElement("a");
b.href="#";b.id=`publishQz${a}`;c.appendChild(b);a=document.createElement("span");a.className="icon-publish2";a.setAttribute("data-toggle","tooltip");a.setAttribute("title",virtualclass.lang.getString("quizreviewpublish"));b.appendChild(a)},qzTextCont(a,c){c=document.getElementById(`contQz${c}`);var b=document.createElement("td");b.classList.add("qnText");b.innerHTML=a.name;c.appendChild(b);b=document.createElement("td");b.classList.add("creator");var d=0<a.timelimit?virtualclass.quiz.convertSecToTime(a.timelimit):
a.timelimit;b.innerHTML=d;c.appendChild(b);b=document.createElement("td");b.classList.add("qperpage");b.innerHTML=a.questionsperpage;c.appendChild(b)},defaultLayoutForStudent(){this.container();const a=document.getElementById("mszBoxQuiz");if(null==document.getElementById("stdQuizMszLayout")){const b=virtualclass.view.customCreateElement("div","stdQuizMszLayout");b.innerHTML=virtualclass.lang.getString("quizmayshow");a.appendChild(b)}}}}}})(window);!function(){const d=Handlebars.template;(Handlebars.templates=Handlebars.templates||{})["docNotesMain.hbs"]=d({compiler:[7,">= 4.0.0"],main(c,a,b,d,g){let f;return`<div id="notesContainer" class="notes ddd">\n  ${c.escapeExpression((f=null!=(f=b.name||(null!=a?a.name:a))?f:b.helperMissing,"function"===typeof f?f.call(null!=a?a:c.nullContext||{},{name:"name",hash:{},data:g}):f))}\n</div>`},useData:!0})}();(function(d){function c(a){console.log(`multivideo, ${a}`)}function a(){console.log("multivideo, success setRemoteDescriptionSuccess")}function b(a){console.log(`multivideo, error setRemoteDescriptionError${a}`)}function f(a){console.log(`multivideo, error handleCreateAnswerError${a}`)}function g(){console.log("multivideo, success addIceCandidateSuccess")}function k(a){console.log(`multivideo, error addIceCandidateError${a}`)}function m(c,d){t[d]=new RTCPeerConnection(pc_config);t[d].onicecandidate=
n(d,"opc");t[d].onaddstream=r(d);"undefined"!==typeof _localStream?t[d].addStream(_localStream):console.log("_localStream is not defined");t[d].setRemoteDescription(new RTCSessionDescription(c.sdp),a,b);console.log(`multivideo, addStream and setRemoteDescription for${d}`);t[d].createAnswer(a=>{t[d].setLocalDescription(a);console.log(`multivideo setLocalDescription for ${d}`);ioAdapter.sendUser({cf:"mvid",sdp:a,answer:!0},d)},f)}function n(a,b){return function(c){console.log("multivideo, STEP 7(9), handleIceCandidate event");
c.candidate?ioAdapter.sendUser({cf:"mvid",candidate:c.candidate,pt:b},a):console.log("multivideo, STEP 10, End of candidates.")}}function q(a,b){p[b]=a;virtualclass.multiVideo.removeUser(b);b=$(`<div class='videoCont remoteVideo'  id='vid${b}' data-userid='${b}' data-totaluser=''></div>`);const c=$("<video  class='videoBox' autoplay></video>");c.attr({src:d.URL.createObjectURL(a),autoplay:"autoplay"});b.append(c);$("#videosWrapper").append(b);virtualclass.multiVideo.updateVideoLength();console.log("multivideo, Remote stream added");
b.click(function(){v.UI.displayMainVideo(this)});"undefined"!==typeof updateActiveTime&&clearTimeout(updateActiveTime);updateActiveTime=setTimeout(()=>{var a=0;for(var b in p){var c=p[b].getVideoTracks()[0];const d=document.querySelector(`#vid${b}`);null!=c?(a++,null!=d?(d.classList.add("vshow"),d.classList.remove("vhide")):console.log("Meeting mode is null")):null!=d?(d.classList.add("vhide"),d.classList.remove("vshow")):console.log("Meeting mode is null")}c="one";4<a?c="morethanfour":2<a?c="four":
1<a&&(c="two");a=document.querySelector("#virtualclassCont");b=document.querySelector("#videoConfrence");a.setAttribute("data-totalUser",c);b.setAttribute("data-totalUser",c)},3E3)}function r(a){return function(b){q(b.stream,a)}}function z(a){u[a]=new RTCPeerConnection(pc_config);u[a].onicecandidate=n(a,"apc");u[a].onaddstream=r(a);"undefined"!==typeof _localStream?(u[a].addStream(_localStream),console.log(`multivideo, Set addStream for ${a}`)):console.log(`No _localStream  for ${a}`);console.log(`multivideo, Create offer for ${a}`);
u[a].createOffer(b=>{u[a].setLocalDescription(b);console.log("multivideo, setLocalDescription with offer");ioAdapter.sendUser({cf:"mvid",sdp:b,offer:!0},a)},c)}let t,u;const p={},v={init(){this.UI.container();this.start();var a=document.querySelector("#videosWrapper .videoCont.selfVideo");a.id=`vid${virtualclass.gObj.uid}`;a.setAttribute("data-userid",virtualclass.gObj.uid);const b=this;p[virtualclass.gObj.uid]=virtualclass.multiVideo.localStream;a.addEventListener("click",function(){b.UI.displayMainVideo(this)});
this.updateVideoLength();a=localStorage.getItem("videoSwitch");null!=a&&"0"==a&&virtualclass.multiVideo.setVideoStatus(!1)},_init(){const a=document.querySelector("#videosWrapper .videoCont.selfVideo");this.UI.displayMainVideo(a);const b=this;setTimeout(()=>{b.displayVideo();roles.hasControls()&&ioAdapter.mustSend({cf:"mvid",_init:!0})},2E3)},displayVideo(){document.querySelector("#virtualclassMultiVideo").style.display="block"},start(){console.log("Video First, multivideo");virtualclass.multiVideo.localStream=
virtualclass.media.video.tempStream;console.log("multivideo, add get user media ");const a=document.querySelector("#videoConfrence .multilocalVideo");virtualclass.adpt.attachMediaStream(a,virtualclass.multiVideo.localStream);this.initDone=!0},UI:{container(){if(null==document.querySelector("#virtualclassMultiVideo")){const a=virtualclass.getTemplate("multiVideoMain");virtualclass.vutil.insertAppLayout(a())}},displayMainVideoOld(a){const b=a.firstElementChild;if("MultiVideo"==virtualclass.currApp){const a=
document.querySelector("#multiVidSelected"),c=a.getContext("2d");"undefined"!==typeof earlierVideo&&clearInterval(earlierVideo);earlierVideo=setInterval(()=>{c.drawImage(b,0,0,a.width,a.height)},28)}},displayMainVideo(a){if("MultiVideo"==virtualclass.currApp){const b=document.querySelector("#multiVidSelected");({userid:a}=a.dataset);virtualclass.adpt.attachMediaStream(b,p[a])}}},removeUser(a){a=document.querySelector(`#videosWrapper .videoCont[data-userid="${a}"]`);null!=a&&a.parentNode.removeChild(a)},
onUserRemove(a){this.removeUser(a);this.updateVideoLength();"object"===typeof t[a]&&t[a].close();"object"===typeof u[a]&&u[a].close()},updateVideoLength(){var a=document.querySelectorAll("#videoConfrence .videoCont"),b="one";4<a.length?b="morethanfour":2<a.length?b="four":1<a.length&&(b="two");a=document.querySelector("#virtualclassCont");const c=document.querySelector("#videoConfrence");a.setAttribute("data-totalUser",b);c.setAttribute("data-totalUser",b)},setAudioStatus(a){const b=virtualclass.multiVideo.localStream.getAudioTracks();
if(0===b.length)console.log("No local audio available.");else for(let c=0;c<b.length;++c)b[c].enabled=a},setVideoStatus(a){setTimeout(()=>{if("undefined"!==typeof virtualclass.multiVideo.localStream){const b=document.querySelector(`#vid${virtualclass.gObj.uid}`),c=virtualclass.multiVideo.localStream.getVideoTracks();if(0===c.length)console.log("No local video available.");else{console.log("Toggling video mute state.");for(let d=0;d<c.length;++d)if(c[d].enabled=a,null!=b){const a=document.querySelector("#videoConfrence"),
b=document.querySelectorAll("#videosWrapper .videoCont.vshow");null!=a&&(a.dataset.activeuser=`vid_${b.length}`)}}}else console.log("localStream is undefined")},1E3)},addClass(){}};t={};u={};v.onmessage=function(c,d){if(c.hasOwnProperty("_init"))virtualclass.makeAppReady(virtualclass.apps.mv);else if(c.hasOwnProperty("offer"))m(c,d);else if(c.hasOwnProperty("candidate")){const a=new RTCIceCandidate(c.candidate);"apc"==c.pt?t[d].addIceCandidate(a,g,k):u[d].addIceCandidate(a,g,k);console.log("multivideo addIcecandidate")}else c.hasOwnProperty("answer")&&
(console.log(`multivideo setRemoteDescription for${d}`),u[d].setRemoteDescription(new RTCSessionDescription(c.sdp),a,b))};v.onUserJoin=function(a){setTimeout(()=>{z(a)},2E3)};d.MultiVideo=v})(window);(function(d){d.zoomWhiteboard=function(){return{init(){if(null==document.querySelector(".zoomControler")){var c=document.querySelector("#virtualclassAppLeftPanel");if(null!=c){const a=virtualclass.getTemplate("zoomControl")({hasControls:roles.hasControls()});c.insertAdjacentHTML("beforeend",a);this._initScaleController();c=localStorage.getItem("canvasDimension");null!=c&&(virtualclass.zoom.canvasDimension=JSON.parse(c))}}},_initScaleController(){const c=document.querySelector(".zoomControler");var a=
this;a=this;c.querySelector(".zoomIn").addEventListener("click",()=>{virtualclass.zoom.performZoom=!0;delete virtualclass.zoom.fitToScreenWidth;delete virtualclass.zoom.prvWhiteboard;a.zoomAction("zoomIn")});c.querySelector(".zoomOut").addEventListener("click",()=>{delete virtualclass.zoom.fitToScreenWidth;delete virtualclass.zoom.prvWhiteboard;virtualclass.zoom.performZoom=!0;a.zoomAction("zoomOut")});c.querySelector(".fitScreen").addEventListener("click",()=>{a.zoomAction("fitToScreen")})},zoomAction(c){"ScreenShare"===
virtualclass.currApp?virtualclass.studentScreen[c].call(virtualclass.studentScreen):(virtualclass.zoom.prvCanvasScale=this.canvasScale,this[c].call(this))},zoomIn(c){const a=virtualclass.gObj.currWb;if("object"===typeof virtualclass.wb[a]){const {canvas:b}=virtualclass.wb[a].vcan.main,d=virtualclass.zoom.canvasDimension.width*virtualclass.gObj.SCALE_FACTOR,g=virtualclass.zoom.canvasDimension.height*virtualclass.gObj.SCALE_FACTOR;virtualclass.zoom.canvasDimension.width=d;virtualclass.zoom.canvasDimension.height=
g;"undefined"!==typeof c?virtualclass.pdfRender[a]._zoom.call(virtualclass.pdfRender[a],b,d,g,c):virtualclass.pdfRender[a]._zoom.call(virtualclass.pdfRender[a],b,d,g)}},zoomOut(){const c=virtualclass.gObj.currWb,{canvas:a}=virtualclass.wb[c].vcan.main,b=a.parentNode,d=a.parentNode.offsetWidth;console.log(`Canvas pdf scale ${this.canvasScale}`);const g=1/virtualclass.gObj.SCALE_FACTOR*virtualclass.zoom.canvasDimension.width,k=1/virtualclass.gObj.SCALE_FACTOR*virtualclass.zoom.canvasDimension.height;
virtualclass.zoom.canvasDimension.width=g;virtualclass.zoom.canvasDimension.height=k;g<=d&&b.classList.remove("scrollX");virtualclass.pdfRender[c]._zoomOut.call(virtualclass.pdfRender[c],a,g,k)},adjustScreenOnDifferentPdfWidth(c){this.hasOwnProperty("adjustScreenOnDifferentPdfWidthTime")&&clearTimeout(this.adjustScreenOnDifferentPdfWidthTime);this.adjustScreenOnDifferentPdfWidthTime=setTimeout(()=>{this._adjustScreenOnDifferentPdfWidth()},400)},_adjustScreenOnDifferentPdfWidth(c){c=c||virtualclass.pdfRender[virtualclass.gObj.currWb].page;
if(null!=c){var a=c.getViewport(1);c=a.width;a=a.height;virtualclass.zoom.hasOwnProperty("prevPdfWidth")&&c!==virtualclass.zoom.prevPdfWidth?(virtualclass.zoom.canvasDimension.width=virtualclass.zoom.canvasScale*c,virtualclass.zoom.canvasDimension.height=virtualclass.zoom.canvasScale*a,virtualclass.zoom.hasOwnProperty("fitToScreenWidth")?virtualclass.zoom.fitToScreen():virtualclass.zoom.normalRender()):virtualclass.zoom.normalRender();virtualclass.zoom.prevPdfWidth=c}else console.log("Page is null")},
getReduceValueForCanvas(){const c=document.querySelector(`#canvas${virtualclass.gObj.currWb}`);if(null!=c&&null!=c.parentNode)return c.parentNode.scrollHeight>c.parentNode.clientHeight?382:372},fitToScreen(){virtualclass.gObj.fitToScreen=!0;delete virtualclass.zoom.performZoom;const c=virtualclass.gObj.currWb;if("undefined"!==typeof virtualclass.pdfRender[c]){console.log("--Pdf render start----------");const {page:b}=virtualclass.pdfRender[c],{canvas:f}=virtualclass.wb[virtualclass.gObj.currWb].vcan.main;
var a=document.querySelector("#virtualclassCont");a=(null!=a?a.offsetWidth:d.innerWidth)-this.getReduceValueForCanvas();console.log(`==== wrapperWidth ${a}`);try{const d=b.getViewport(1);virtualclass.zoom.fitToScreenWidth=d.width;virtualclass.zoom.prvWhiteboard=virtualclass.gObj.currWb;const k=b.getViewport(+a/b.getViewport(1).width);console.log(`==== PDF width => ${k.width} PDF height => ${k.height} scale => ${k.scale}`);console.log(`==== PDF temp width => ${d.width} PDF height => ${d.height} scale => ${d.scale}, after scale=${this.canvasScale}`);
virtualclass.pdfRender[c]._fitToScreen.call(virtualclass.pdfRender[c],f,a,f.height)}catch(g){console.log(`Error ${g}`)}}},reload(){virtualclass.zoom.normalRender()},normalRender(c){console.log(`--Pdf Render Start ${virtualclass.currApp} ------------`);console.log("Pdf render normal view");console.log("--Pdf render------------");c=virtualclass.gObj.currWb;delete virtualclass.zoom.performZoom;"object"===typeof virtualclass.pdfRender[c].shownPdf&&(null!=virtualclass.zoom.canvasScale?(virtualclass.zoom.canvasDimension.width/=
virtualclass.gObj.SCALE_FACTOR,virtualclass.zoom.canvasDimension.height/=virtualclass.gObj.SCALE_FACTOR,console.log(`Canvas pdf scale ${this.canvasScale}`),virtualclass.zoom.zoomIn("normalRender")):console.log("canvasScale is not defined yet."))},removeZoomController(){const c=document.querySelector("#virtualclassApp .zoomControler");null!=c&&virtualclass.gObj.studentSSstatus.mesharing&&c.parentNode.removeChild(c)}}}})(window);(function(d){let c=null;d.pdfRender=function(){return{firstTime:!0,shownPdf:"",canvasWrapper:null,canvasId:null,canvas:null,pdfScale:1,url:"",axhr:axios.create({timeout:5E3,withCredentials:!0,responseType:"arraybuffer"}),init(a,b){document.querySelector("#virtualclassCont");io.globallock=!1;virtualclass.gObj.firstNormalRender=!1;this.url="undefined"!==typeof b?virtualclass.dts.getNote(b).pdf:`${whiteboardPath}resources/sample.pdf`;this.loadPdf(this.url,a,b)},prefechPdf(a){const b=virtualclass.dts.getNote(a);
this.axhr.get(b.pdf).then(a=>{virtualclass.pdfRender[virtualclass.gObj.currWb].afterPdfPrefetch(b.id,a.data)}).catch(a=>{console.error("Request failed with error ",a)})},afterPdfPrefetch(a,b){virtualclass.gObj.next={};virtualclass.gObj.next[a]=b},async loadPdf(a,b,c){virtualclass.gObj.hasOwnProperty("getDocumentTimeout")&&clearTimeout(virtualclass.gObj.getDocumentTimeout);virtualclass.isPlayMode?virtualclass.gObj.getDocumentTimeout=setTimeout(()=>{this.loadPdfActual(a,b,c);virtualclass.gObj.getDocumentTimer=
!1},100):null==virtualclass.gObj.getDocumentTimer||!1===virtualclass.gObj.getDocumentTimer?(this.loadPdfActual(a,b,c),virtualclass.gObj.getDocumentTimer=!0,virtualclass.gObj.getDocumentTimeout=setTimeout(()=>{virtualclass.gObj.getDocumentTimer=!1},1E3)):virtualclass.gObj.getDocumentTimeout=setTimeout(()=>{this.loadPdfActual(a,b,c);virtualclass.gObj.getDocumentTimer=!1},300)},loadPdfActual(a,b,c){virtualclass.gObj.next.hasOwnProperty(c)?this.afterPdfLoad(b,c,virtualclass.gObj.next[c]):this.axhr.get(a).then(a=>
{virtualclass.pdfRender[virtualclass.gObj.currWb].afterPdfLoad(b,c,a.data)}).catch(d=>{console.error("Request failed with error ",d);setTimeout(()=>{virtualclass.pdfRender[virtualclass.gObj.currWb].loadPdfActual(a,b,c)},1E3)})},async afterPdfLoad(a,b,c){this.canvasWrapper=document.querySelector(`#canvasWrapper${virtualclass.gObj.currWb}`);this.canvas=a;a={};a.data=c;null!=virtualclass.gObj.myworker&&(a.worker=virtualclass.gObj.myworker);const d=this;c=virtualclass.gObj.currWb;virtualclass.currApp==
virtualclass.currApp?(d.wbId="undefined"===typeof b?virtualclass.gObj.currWb:b,console.log(`-----------START ${virtualclass.currApp}----------`),console.log("PDF render request to pdf.js 1"),PDFJS.workerSrc=`${whiteboardPath}build/src/pdf.worker.min.js`,PDFJS.cMapUrl=`${whiteboardPath}build/cmaps/`,PDFJS.cMapPacked=!0,PDFJS.getDocument(a).then(a=>{null==virtualclass.gObj.myworker&&(virtualclass.gObj.myworker=a.loadingTask._worker);d.displayPage(a,1,()=>{},!0);d.shownPdf=a;roles.hasControls()||(d.topPosY=
0,d.leftPosX=0);d.scrollEvent()})):"DocumentShare"==virtualclass.currApp&&virtualclass.wbCommon.deleteWhiteboard(c);"undefined"!==typeof virtualclass.gObj.currWb&&null!=virtualclass.gObj.currWb&&(b=document.querySelector(`#note${b}`),null!=b&&null!=b.nextElementSibling&&virtualclass.pdfRender[virtualclass.gObj.currWb].prefechPdf(b.nextElementSibling.dataset.slide))},updateScrollPosition(a,b){"object"===typeof this.scroll[b]&&this.scroll[b].hasOwnProperty("b")?(this.scroll[b].b=a,this.scroll[b].c=
this.scroll[b].b+this.scroll[b].studentVPm):console.log("Scroll b is undefined")},scrollEvent(){const a=this.canvasWrapper,b=a.scrollTop,c=a.scrollLeft;virtualclass.topPosY=b;virtualclass.leftPosX=c;this.topPosY=b;this.leftPosX=c;const d=this;a.onscroll=function(){d.onScroll(a)}},onScroll(a,b){var c=a.scrollTop;var d=a.scrollLeft;(0<c||"undefined"!==typeof b)&&this._scroll(d,c,a,"Y");(0<d||"undefined"!==typeof b)&&this._scroll(d,c,a,"X");roles.hasControls()||virtualclass.pdfRender[virtualclass.gObj.currWb].setScrollPosition({scX:d,
scY:c})},_scroll(a,b,c,d){if(roles.hasControls())return this.topPosY=b,this.leftPosX=a,this.scrollPosition(c,d);if("Y"==d)var f=b;else"X"==d&&(f=a);this.updateScrollPosition(f,d);return null},scrollPosition(a,b){const {canvas:c}=this;if("Y"==b)var d=a.scrollTop,k=c.height;else"X"==b&&(d=a.scrollLeft,k=c.width);this[`scrollPos${b}`]=d/k*100;a=virtualclass.vutil.getElemM(`canvasWrapper${virtualclass.gObj.currWb}`,b);this[`actualVp${b}`]=a;this[`viewPort${b}`]=a/k*100;k={};k[`vp${b}`]=this[`viewPort${b}`];
k[`sc${b}`]=this[`scrollPos${b}`];return k},scroll:{caclculatePosition(a,b,c){a=this.type=c;null==this[a]&&(this[a]={});this[a].a=0;this[a].d=b;b=`canvasWrapper${virtualclass.gObj.currWb}`;c=document.querySelector(`#${b}`);null!=c&&("X"==this.type?this[a].b=c.scrollLeft:"Y"==this.type&&(this[a].b=c.scrollTop),this[a].studentVPm=virtualclass.vutil.getElemM(b,a),this[a].c=this[a].b+this[a].studentVPm)}},setScrollPosition(a){a.hasOwnProperty("scY")&&null!=a.scY&&this.scroll.caclculatePosition(a.scY,
this.canvas.height,"Y");a.hasOwnProperty("scX")&&null!=a.scX&&this.scroll.caclculatePosition(a.scX,this.canvas.width,"X")},customMoustPointer(a,b,c){this.scroll[b].e=c;this.scroll[b].e>this.scroll[b].c?(a=this.scroll[b].b+(this.scroll[b].d-this.scroll[b].c),a>this.scroll[b].e&&(a=this.scroll[b].e-(this.scroll[b].b+this.scroll[b].c)/2),console.log(`custom mouse down pointer ay=${this.scroll[b].a} by=${this.scroll[b].b} cy=${this.scroll[b].c} dy=${this.scroll[b].d} ey${this.scroll[b].e} scrollPos=${a}`),
"Y"==b?this.canvasWrapper.scrollTop=a:(this.canvasWrapper.scrollLeft=a,console.log(`Scroll left ${this.canvasWrapper.scrollLeft}`)),this.scroll[b].b=a,this.scroll[b].c=this.scroll[b].b+this.scroll[b].studentVPm):this.scroll[b].e<this.scroll[b].b&&(a=this.scroll[b].b-this.scroll[b].a,this.scroll[b].c-a<this.scroll[b].e&&(a=(this.scroll[b].b+this.scroll[b].c)/2-this.scroll[b].e),"Y"==b?this.canvasWrapper.scrollTop-=a:this.canvasWrapper.scrollLeft-=a,this.scroll[b].b=a,this.scroll[b].c=this.scroll[b].b+
this.scroll[b].studentVPm)},setCustomMoustPointer(a,b){var c=`scrollDiv${b}${virtualclass.gObj.currWb}`,d=document.querySelector(`#${c}mousePointer`);null==d&&(d=document.createElement("div"),d.className="mousepointer",d.id=`${c}mousePointer`,c=document.querySelector(`#scrollDiv${b}${virtualclass.gObj.currWb}`),null!=c&&c.appendChild(d));"Y"==b?d.style.top=`${a.y-this.scroll[b].a}px`:"X"==b&&(d.style.left=`${a.x-this.scroll[b].a}px`)},sendScroll(){virtualclass.vutil.setDefaultScroll()},sendCurrentScroll(a){let b=
{};if(null!=this.currentScroll){b=Object.assign(b,this.currentScroll);console.log(`Send scroll first time ${this.currentScroll}`);const c=this;c.currentScrolltoUser=a;setTimeout(()=>{c.currentScrolltoUser=a;b.cf="scf";b.toUser=a;virtualclass.vutil.beforeSend({toUser:a,cf:"scf",scY:b.scY,vpY:b.vpY},a);console.log(`Send scroll ${b}to user ${a}`);console.log(`Send scroll ${b}`)},2E3)}},async renderPage(a,b){console.log("#### render page");if(null!=virtualclass.gObj.currWb){var f=this.pdfScale;null!=
virtualclass.zoom.canvasScale&&""!=virtualclass.zoom.canvasScale&&(0<virtualclass.zoom.canvasScale?f=virtualclass.zoom.canvasScale:console.log("Why negative value"));var g="Whiteboard"==virtualclass.currApp&&null!=this.wbId&&virtualclass.gObj.currWb!=this.wbId?-1<this.wbId.indexOf("_doc_")?this.wbId:`_doc_${this.wbId}_${this.wbId}`:virtualclass.gObj.currWb;const {canvas:k}=virtualclass.wb[g].vcan.main;virtualclass.gObj.hasOwnProperty("fitToScreen")?(k.width=d.innerWidth-virtualclass.zoom.getReduceValueForCanvas(),
console.log("==== a canvas width fit to screen"),roles.hasControls()||(k.width+=50)):virtualclass.zoom.hasOwnProperty("performZoom")?(k.width=virtualclass.zoom.canvasDimension.width,delete virtualclass.zoom.performZoom):virtualclass.zoom.hasOwnProperty("canvasDimension")?(console.log(`==== a canvas width dimension ${virtualclass.zoom.canvasDimension.width} scale=${virtualclass.zoom.canvasScale}`),k.width=virtualclass.zoom.canvasDimension.width):0===k.offsetWidth?(k.width=d.innerWidth-382,console.log("==== a canvas width click to continue")):
virtualclass.isPlayMode&&(k.width=d.innerWidth-382,console.log("==== a canvas width"));this.firstTime?(this.firstTime=!1,console.log("## WHITEBOARD Canvas = ",virtualclass.zoom.prvCanvasScale," ID ",virtualclass.gObj.currWb),f=null==virtualclass.zoom.canvasScale?a.getViewport(k.width/a.getViewport(1).width):a.getViewport(f)):f=a.getViewport(k.width/a.getViewport(1).width);virtualclass.zoom.prvCanvasScale=virtualclass.zoom.canvasScale;virtualclass.zoom.canvasScale=f.scale;k.height=f.height;const m=
k.nextSibling;m.width=k.width;m.height=k.height;virtualclass.zoom.canvasDimension={};virtualclass.zoom.canvasDimension.width=k.width;virtualclass.zoom.canvasDimension.height=k.height;console.log("==== canvas dimension ",virtualclass.zoom.canvasDimension.width);if(virtualclass.gObj.hasOwnProperty("fitToScreen")){const a=document.querySelector(`#canvasWrapper${virtualclass.gObj.currWb}`);if(null!=a&&(a.scrollHeight<=a.clientHeight||a.scrollWidth<=a.clientWidth))virtualclass.pdfRender[virtualclass.gObj.currWb].onScroll(a,
!0)}delete virtualclass.gObj.fitToScreen;f={canvasContext:m.getContext("2d"),viewport:f};const n=this;console.log("PDF render initiate to display pdf on canvas 3");a.render(f).then(()=>{console.log("PDF render DONE 4");console.log("-----------END----------");k.parentNode.dataset.pdfrender=!0;n[g]={pdfrender:!0};virtualclass.vutil.showZoom();void 0!=b&&null!=virtualclass.gObj.currWb&&n.initWhiteboardData(virtualclass.gObj.currWb);c();"object"===typeof n.shownPdf?(io.globallock=!1,io.onRecJson(null),
virtualclass.gObj.hasOwnProperty("pdfNormalTimeout")&&clearTimeout(virtualclass.gObj.pdfNormalTimeout),virtualclass.gObj.firstNormalRender||null==virtualclass.gObj.currWb||null==document.querySelector(`#canvas${virtualclass.gObj.currWb}_pdf`)||(virtualclass.zoom.adjustScreenOnDifferentPdfWidth(a),virtualclass.gObj.firstNormalRender=!0),virtualclass.vutil.removeClass("virtualclassCont","resizeWindow")):console.log("We should have a PDF here")})}},displayPage(a,b,d,g){c=d;this._displayPage(a,b,d,g)},
async _displayPage(a,b,c,d){a=await a.getPage(b);virtualclass.pdfRender[virtualclass.gObj.currWb].page=a;console.log("==== to be display ",virtualclass.pdfRender[virtualclass.gObj.currWb].page,virtualclass.gObj.currWb);"undefined"!==typeof d?await this.renderPage(a,d):await this.renderPage(a,null)},fitToScreenIfNeed(){"DocumentShare"!=virtualclass.currApp||virtualclass.gObj.docPdfFirstTime||(virtualclass.gObj.docPdfFirstTime=!0,virtualclass.zoom.zoomAction("fitToScreen"))},async initWhiteboardData(a){await virtualclass.storage.getWbData(a);
"object"===typeof virtualclass.gObj.tempReplayObjs[a]&&0<virtualclass.gObj.tempReplayObjs[a].length&&(console.log("Start whiteboard replay from local storage"),virtualclass.wb[a].utility.replayFromLocalStroage(virtualclass.gObj.tempReplayObjs[a]))},_zoom(a,b,c,d){virtualclass.vutil.setHeight(virtualclass.gObj.currWb,a,c);virtualclass.vutil.setWidth(virtualclass.gObj.currWb,a,b);const f=a.parentNode,g=virtualclass.vutil.getValueWithoutPixel(f.style.width),n=this;this.displayPage(this.shownPdf,1,()=>
{if("undefined"===typeof d){console.log("Zooming whiteboard");for(var a in virtualclass.pdfRender)n.zoomwhiteboardObjects(a)}else null!=virtualclass.gObj.currWb&&({vcan:a}=virtualclass.wb[virtualclass.gObj.currWb],a.renderAll());b>g&&f.classList.add("scrollX")})},fitWhiteboardAtScale(a){if("object"===typeof virtualclass.wb[a]){({vcan:a}=virtualclass.wb[a]);const d=a.main.children;if(0<d.length)for(const a in d){var {scaleX:b}=d[a],{scaleY:c}=d[a];b=b/virtualclass.zoom.prvCanvasScale*virtualclass.zoom.canvasScale;
c=c/virtualclass.zoom.prvCanvasScale*virtualclass.zoom.canvasScale;const f=d[a].x/d[a].scaleX*b,g=d[a].y/d[a].scaleY*c;d[a].scaleX=b;d[a].scaleY=c;d[a].x=f;d[a].y=g;d[a].setCoords()}a.renderAll()}},zoomwhiteboardObjects(a){this.fitWhiteboardAtScale(a)},zoomOutWhiteboardObjects(a){this.fitWhiteboardAtScale(a)},fitToScreenWhiteboardObjects(a){this.fitWhiteboardAtScale(a)},_zoomOut(a,b,c,d){virtualclass.vutil.setHeight(virtualclass.gObj.currWb,a,c);virtualclass.vutil.setWidth(virtualclass.gObj.currWb,
a,b);const f=this;this.displayPage(this.shownPdf,1,()=>{for(const a in virtualclass.pdfRender)f.zoomOutWhiteboardObjects(a)})},_fitToScreen(a,b,c){console.log(`==== Current whiteboard id ${virtualclass.gObj.currWb}`);virtualclass.vutil.setHeight(virtualclass.gObj.currWb,a,c);virtualclass.vutil.setWidth(virtualclass.gObj.currWb,a,b);const d=a.parentNode,f=d.offsetWidth,m=this;" "!==this.shownPdf?this.displayPage(this.shownPdf,1,()=>{for(const a in virtualclass.pdfRender)m.fitToScreenWhiteboardObjects(a);
b>f&&55<b-f?d.classList.add("scrollX"):d.classList.remove("scrollX")}):console.log("ERROR : shown pdf is not available")},isBiggerCanvasHeight(a){},isBiggerCanvasWidth(a){},calculateScaleAtFirst(a,b){a=a.getViewport(b.width/a.getViewport(1).width);this.firstTime=!1;return a},isWhiteboardAlreadyExist(a){return null!=this.canvas},defaultScroll(){null!=virtualclass.gObj.currWb&&(this.canvasWrapper.scrollTop=1)}}}})(window);(function(d){var c={order:[0],wbInd:0,initNavHandler(){const a=this;var b=document.querySelector("#virtualclassWhiteboard.whiteboard .next");null!=b&&(b.onclick=function(){virtualclass.vutil.navWhiteboard(a,a.next);c.hasOwnProperty("setNextWhiteboardTime")&&clearTimeout(c.setNextWhiteboardTime);"Whiteboard"==virtualclass.currApp&&(c.setNextWhiteboardTime=setTimeout(()=>{virtualclass.zoom.normalRender()},500))});b=document.querySelector("#virtualclassWhiteboard.whiteboard .prev");null!=b&&(b.onclick=
function(){virtualclass.vutil.navWhiteboard(a,a.prev);"object"===typeof virtualclass.wb[virtualclass.gObj.currWb]&&setTimeout(()=>{console.log("whiteboard zoom normal render");virtualclass.zoom.normalRender()},500)})},initNav(a){"undefined"===typeof this.indexNav&&(this.indexNav=new pageIndexNav("WB"));let b=virtualclass.gObj.currIndex||a.length;this.indexNav.init();if(roles.hasControls()){var c=localStorage.getItem("wbOrder");null!=c&&(c=JSON.parse(c),virtualclass.wbCommon.order=c);1<this.order.length&&
(virtualclass.wbCommon.rearrangeNav(this.order),this.rearrange(this.order),c=localStorage.getItem("currIndex"),null!==c&&(b=c));virtualclass.wbCommon.indexNav.createWbNavigationNumber(b);virtualclass.wbCommon.indexNav.addActiveNavigation(virtualclass.gObj.currWb)}else virtualclass.wbCommon.indexNav.studentWBPagination(virtualclass.gObj.currIndex||virtualclass.gObj.currSlide);virtualclass.wbCommon.indexNav.setTotalPages(a.length)},displaySlide(a){this.hideElement();const b=document.querySelector(`#note${a}`);
null!=b&&(b.classList.add("current"),virtualclass.gObj.currWb=a);this.identifyFirstNote(a);roles.hasControls()||"undefined"!==typeof virtualclass.wbCommon.indexNav&&virtualclass.wbCommon.indexNav.studentWBPagination(virtualclass.gObj.currIndex||virtualclass.gObj.currSlide)},hideElement(){const a=document.querySelector("#virtualclassWhiteboard.whiteboard .current");null!=a&&(console.log("Whiteboard slide remove"),a.classList.remove("current"))},currentWhiteboard(a){null==document.querySelector(`#canvas${a}`)&&
(this.hideElement(),virtualclass.vutil.createWhiteBoard(a),this.displaySlide(a),virtualclass.gObj.currWb=a)},next:function(){this.hideElement();var a=this.whiteboardWrapperExist("next");if(null!==a){this.readyCurrentWhiteboard(a);this.setCurrSlideNumber(a);virtualclass.wbCommon.indexNav.addActiveNavigation(a);virtualclass.wbCommon.indexNav.UI.pageNavHandler("right");let b=this.order.indexOf(a.slice(7));this.identifyLastNote(a);virtualclass.gObj.currWb=a;virtualclass.gObj.currIndex=b+1;virtualclass.wbCommon.indexNav.setCurrentIndex(virtualclass.gObj.currIndex);
virtualclass.vutil.beforeSend({cf:"cwb",diswb:!0,wid:a,currIndex:virtualclass.gObj.currIndex});localStorage.setItem("currIndex",virtualclass.gObj.currIndex)}console.log("==== current slide ",virtualclass.gObj.currSlide);this.identifyFirstNote(a)},prev(){this.hideElement();const a=this.whiteboardWrapperExist("prev"),b=+a.split("_doc_0_")[1];this.readyCurrentWhiteboard(a);this.setCurrSlideNumber(a);virtualclass.wbCommon.indexNav.addActiveNavigation(a);virtualclass.wbCommon.indexNav.UI.pageNavHandler("left");
const c=document.querySelector(`#${virtualclass.wb[a].prvTool}`);null==c||c.classList.contains("active")||c.classList.add("active");virtualclass.gObj.currIndex=this.order.indexOf(b)+1;virtualclass.wbCommon.indexNav.setCurrentIndex(virtualclass.gObj.currIndex);console.log("==== current slide ",virtualclass.gObj.currSlide);virtualclass.vutil.beforeSend({cf:"cwb",diswb:!0,wid:a,currIndex:virtualclass.gObj.currIndex});this.identifyLastNote(a);localStorage.setItem("currIndex",virtualclass.gObj.currIndex)},
newPage:async function(){this.hideElement();virtualclass.gObj.wbCount++;-1>=virtualclass.gObj.wIds.indexOf(virtualclass.gObj.wbCount)&&virtualclass.gObj.wIds.push(virtualclass.gObj.wbCount);const a=`${"_doc_0_"}${virtualclass.gObj.wbCount}`;var b=virtualclass.gObj.currWb.slice(7);const c=this.order.indexOf(b),d=this.whiteboardWrapperExist("next");await virtualclass.vutil.createWhiteBoard(a,c);this.displaySlide(a);null==d?(-1>=this.order.indexOf(virtualclass.gObj.wbCount)&&this.order.push(virtualclass.gObj.wbCount),
b=this.order.length,virtualclass.wbCommon.indexNav.createWbNavigationNumber(b)):(b=this.order.indexOf(b),this.order.splice(b+1,0,virtualclass.gObj.wbCount),this.rearrange(this.order),this.rearrangeNav(this.order),b+=2,virtualclass.wbCommon.indexNav.createWbNavigationNumber(b));virtualclass.vutil.beforeSend({cf:"cwb",wbCount:virtualclass.gObj.wbCount,currIndex:b});this.setCurrSlideNumber(a);virtualclass.gObj.currIndex=b;console.log("==== current slide ",virtualclass.gObj.currSlide);this.identifyLastNote(a);
localStorage.setItem("currIndex",virtualclass.gObj.currIndex);localStorage.setItem("wbOrder",JSON.stringify(this.order))},rearrange(a){const b=document.getElementsByClassName("whiteboardContainer")[0],c=document.createElement("div");c.className="whiteboardContainer";for(let b=0;b<a.length;b++){const d=document.getElementById(`note_doc_0_${a[b]}`);d&&c.appendChild(d)}b.parentNode.replaceChild(c,b)},rearrangeNav(a){document.querySelector("#dcPaging").innerHTML="";if("Whiteboard"==virtualclass.currApp)var b=
virtualclass.gObj.currWb.split("doc_0_")[1];a=this.order.indexOf(b);var c=document.querySelector(".congrea #dcPaging .noteIndex.active");c&&c.classList.remove("active");if(c=document.querySelector(`#index${b}`))c.classList.add("active"),c.selected="selected";b=document.querySelector("#dcPaging .hid.right.active");const d=document.querySelector("#dcPaging .hid.left.active");if(b||d)var k=b?b.title:d.title;"Whiteboard"==virtualclass.currApp?this.index=+a+1:(this.index=null!=k?k:null!=c&&"undefined"!==
typeof c?c.title:1,virtualclass.dts.order.length||(this.index=0),k=document.querySelector("#docShareNav"),this.index?(k.classList.add("show"),k.classList.remove("hide")):(k.classList.add("hide"),k.classList.remove("show")))},setCurrSlideNumber(a){a=a.split("_");0<a.length&&(virtualclass.gObj.currSlide=a[a.length-1],roles.hasControls()||"undefined"!==typeof virtualclass.wbCommon.indexNav&&virtualclass.wbCommon.indexNav.studentWBPagination(virtualclass.gObj.currIndex||virtualclass.gObj.currSlide))},
readyCurrentWhiteboard(a){null!=a?(this.whiteboardExist(a)||virtualclass.vutil.createWhiteBoard(a),this.displaySlide(a),virtualclass.gObj.currWb=a,console.log(`whiteboard slide send=${virtualclass.gObj.currWb}`)):alert("Elemennt is NULL")},whiteboardExist(a){return null!=document.querySelector(`#canvas${a}`)},whiteboardWrapperExist(a){var b=virtualclass.gObj.currWb;if(null!=b){b=document.querySelector(`#note${b}`);if("prev"==a)var c=b.previousElementSibling;else"next"==a&&(c=b.nextElementSibling);
return null!=c?c.dataset.wbId:null}},readyElements(a){const b=document.querySelector("#virtualclassWhiteboard .whiteboardContainer");for(let d=0;d<a.length;d++){const f=`_doc_0_${a[d]}`;var c=document.querySelector(`#note${f}`);null==c&&(c=document.createElement("div"),c.id=`note${f}`,c.dataset.wbId=f,c.className="canvasContainer",b.appendChild(c))}},reArrangeElements(a){const b=document.querySelector("#virtualclassWhiteboard .whiteboardContainer"),c=document.createElement("div");c.className="whiteboardContainer";
for(let b=0;b<a.length;b++){var d=`note_doc_0_${a[b]}`;d=document.getElementById(d);null!=c&&null!=d?c.appendChild(d):console.log(`Error temp div is null ${c}`)}b.parentNode.replaceChild(c,b)},identifyFirstNote(a){const b=document.querySelector("#virtualclassWhiteboard");"_doc_0_0"==a?b.classList.add("firstNote"):b.classList.remove("firstNote")},identifyLastNote(a){let b=document.querySelector("#virtualclassWhiteboard");const c=+a.slice(7);this.order.indexOf(c)+1==this.order.length||"_doc_0_0"==a&&
1==virtualclass.gObj.wIds.length?b.classList.add("lastNote"):b.classList.remove("lastNote")},removeAllContainers(){const a=document.querySelectorAll("#virtualclassWhiteboard .whiteboardContainer .canvasContainer");let b;for(let c=0;c<a.length;c++)b=a[c],b.parentNode.removeChild(b)},clearNavigation(){const a=document.getElementById("dcPaging");if(null!==a){for(;a.firstChild;)a.removeChild(a.firstChild);if(null!=virtualclass.wbCommon.indexNav)if(roles.hasControls())virtualclass.wbCommon.indexNav.createWbNavigationNumber(0,
0),document.querySelector("#virtualclassWhiteboard").classList.add("lastNote");else{const b=document.createElement("span");b.id="stdPageNo";a.appendChild(b);virtualclass.wbCommon.indexNav.studentWBPagination(0)}}},deleteWhiteboard(a){delete virtualclass.wb[a];delete virtualclass.pdfRender[a];"Whiteboard"===virtualclass.currApp&&(a=document.querySelector(`#containerWb${a}`),null!==a&&a.parentNode.removeChild(a))}};d.wbCommon=c})(window);const serverData={rawData:{video:[],ppt:[],docs:[]},sdxhr:axios.create({timeout:1E4,headers:{"Content-Type":"application/json","x-api-key":wbUser.lkey,"x-congrea-authuser":wbUser.auth_user,"x-congrea-authpass":wbUser.auth_pass,"x-congrea-room":wbUser.room,post:{"Content-Type":"application/json"}}}),fetchAllData(d){console.log("Fetch all data");this.cb=d;console.log("Request get document url");this.requestData(virtualclass.api.GetDocumentURLs)},requestData(d){!0!==virtualclass.gObj.readyToCommunicate?
setTimeout(()=>{virtualclass.serverData.requestData(d)},1E3):(this.rawData={video:[],ppt:[],docs:[]},this.sdxhr.post(d,{}).then(c=>{virtualclass.serverData.afterResponse(c.data)}).catch(c=>{console.error("Request failed with error ",c);setTimeout(()=>{virtualclass.serverData.requestData(d)},1E3)}))},afterResponse(d){this.awsUrlArr(d);virtualclass.gObj.fetchedData=!0;"undefined"!==typeof virtualclass.serverData.cb&&virtualclass.serverData.cb()},awsUrlArr(d){this.rawData={video:[],ppt:[],docs:[]};const c=
[];d=d.Items;for(let q=0;q<d.length;q++)if(d[q].hasOwnProperty("filetype"))switch(d[q].filetype.S){case "doc":var a=this.processObj(d[q]);var b=d[q].processed_data.M.commonpath.S;var f=parseInt(d[q].processed_data.M.count.N);if(null!=b&&null!=f){b=`${"https://media.congrea.net"}/${d[q].processed_data.M.commonpath.S}`;a.notes={};a.notesarr=[];let r=[],z=[];a.hasOwnProperty("deletednes")&&(r=a.deletednes);a.hasOwnProperty("disablednes")&&(z=a.disablednes);for(let c=1;c<=f;c++){var g=c;var k=3-`${g}`.length;
var m=(0<k?Array(++k).join("0"):"")+g;g=`${b}/image/${m}.${d[q].processed_data.M.image.M.type.S}`;k=`${b}/pdf/${m}.pdf`;m=`${b}/thumbnail/${m}.${d[q].processed_data.M.thumbnail.M.type.S}`;virtualclass.createPrefetchLink(k);var n=99<c?`${a.fileuuid}_${c}`:9<c?`${a.fileuuid}_0${c}`:`${a.fileuuid}_00${c}`;const f={};0<r.length&&-1<r.indexOf(c)&&(f.deletedn=n);f.id=n;f.pdf=k;f.image=g;f.thumbnail=m;0<z.length?-1<z.indexOf(c)?f.status=0:f.status=1:f.status=1;a.notes[n]=f;a.notesarr.push(f)}c.push(a);this.rawData.docs.push(a)}break;
case "video":null!=d[q].processed_data&&"COMPLETED"==d[q].processed_data.S&&(a=this.processObj(d[q]),f=a.filepath.substr(0,a.filepath.lastIndexOf("/")),a.urls={},a.urls.thumbnail={},a.urls.videos={},a.urls.main_video=`${"https://media.congrea.net/"+f}/video/play_video.m3u8`,a.urls.videos["0400k"]=`${"https://media.congrea.net/"+f}/video/0400k/video.m3u8`,a.urls.videos["0600k"]=`${"https://media.congrea.net/"+f}/video/0600k/video.m3u8`,a.urls.videos["1000k"]=`${"https://media.congrea.net/"+f}/video/1000k/video.m3u8`,
a.urls.videos["1500k"]=`${"https://media.congrea.net/"+f}/video/1500k/video.m3u8`,a.urls.videos["2000k"]=`${"https://media.congrea.net/"+f}/video/2000k/video.m3u8`,a.urls.thumbnail["0400k"]=`${"https://media.congrea.net/"+f}/video/0400k/thumbs/00001.png`,a.urls.thumbnail["0600k"]=`${"https://media.congrea.net/"+f}/video/0600k/thumbs/00001.png`,a.urls.thumbnail["1000k"]=`${"https://media.congrea.net/"+f}/video/1000k/thumbs/00001.png`,a.urls.thumbnail["1500k"]=`${"https://media.congrea.net/"+f}/video/1500k/thumbs/00001.png`,
a.urls.thumbnail["2000k"]=`${"https://media.congrea.net/"+f}/video/2000k/thumbs/00001.png`,c.push(a),this.rawData.video.push(a));break;case "video_yts":console.log("Handle youtube");a=this.processVidUrlObj(d[q]);a.urls={};a.urls.main_video=a.URL;c.push(a);this.rawData.video.push(a);break;case "presentation":console.log("presentation data");a=this.processVidUrlObj(d[q]);a.urls={};a.urls.presentation=a.URL;c.push(a);this.rawData.ppt.push(a);break;case "video_online":console.log("Handle one line "),
a=this.processVidUrlObj(d[q]),a.urls={},a.urls.main_video=a.URL,c.push(a),this.rawData.video.push(a)}virtualclass.awsData=c},processObj(d){const c={};c.filename=d.filename.S;c.filepath=d.filepath.S;c.filetype=d.filetype.S;c.fileuuid=d.fileuuid.S;c.key_room=d.key_room.S;c.fileuuid=d.fileuuid.S;d.hasOwnProperty("deleted")&&("0"==d.deleted.NS[0]?c.deleted=d.deleted.NS[0]:c.deletednes=d.deleted.NS);d.hasOwnProperty("disabled")&&("0"==d.disabled.NS[0]?c.disabled=d.disabled.NS[0]:c.disablednes=d.disabled.NS);
return c},processVidUrlObj(d){const c={};c.URL=d.URL.S;c.filename=c.URL;c.filetype=d.filetype.S;c.fileuuid=d.fileuuid.S;c.key_room=d.key_room.S;c.fileuuid=d.fileuuid.S;d.hasOwnProperty("deleted")&&(c.deleted=d.deleted.NS[0]);d.hasOwnProperty("disabled")&&(c.disabled=d.disabled.NS[0]);return c},pollingStatus(d){const c=virtualclass.api.GetDocumentStatus;virtualclass.gObj.hasOwnProperty("pollingDocumentStatus")&&clearTimeout(virtualclass.gObj.pollingDocumentStatus);const a=this;virtualclass.gObj.pollingDocumentStatus=
setTimeout(()=>{virtualclass.xhrn.vxhrn.post(c,{uuid:virtualclass.gObj.file.uuid}).then(b=>{b=b.data.Item;null!=b&&(b.hasOwnProperty("processed_data")&&(b.processed_data.hasOwnProperty("S")&&"COMPLETED"==b.processed_data.S||b.processed_data.hasOwnProperty("M")&&b.processed_data.M.hasOwnProperty("pdf"))?(clearTimeout(virtualclass.gObj.pollingDocumentStatus),virtualclass.serverData.fetchAllData(d)):a.pollingStatus(d))})},5E3)}};const api={access:"https://api.congrea.net/data/access",upload:"https://api.congrea.net/t/upload",uploadSuccess:"https://api.congrea.net/t/uploadSuccess",uploadMedia:"https://uploadmedia.congrea.net",UpdateDocumentStatus:"https://api.congrea.net/t/UpdateDocumentStatus",GetDocumentURLs:"https://api.congrea.net/t/GetDocumentURLs",UpdateRoomMetaData:"https://api.congrea.net/t/UpdateRoomMetaData",GetRoomMetaData:"https://api.congrea.net/t/GetRoomMetaData",addURL:"https://api.congrea.net/t/addURL",GetDocumentStatus:"https://api.congrea.net/t/GetDocumentStatus",
recordingFiles:"https://api.congrea.net/data/recording-files"};(function(d,c){d.raiseHand=function(a){return{stdRhEnable:"enabled",rhCount:0,rhCountR:0,init(a){this.stdRhEnable="enabled";roles.hasControls()||(this.attachHandlerAtStudent(),this.stdRhEnable&&"disabled"==this.stdRhEnable&&(c.querySelector("#virtualclassCont.congrea #icHr").setAttribute("data-action","disable"),a=c.querySelector("#virtualclassCont.congrea #congHr"),a.classList.remove("enable"),a.classList.add("disable"),a.setAttribute("data-title",virtualclass.lang.getString("RaiseHandStdDisabled"))))},
raisehand(a){chatContainerEvent.elementFromShadowDom(`#ml${a} .controllerRaiseH`);var b=chatContainerEvent.elementFromShadowDom(`#ml${a} .controllerRaiseH`);const d=b.querySelector("a.congtooltip"),k=d.querySelector(".RaiseHandImg");ioAdapter.mustSendUser({data:{action:"disable"},cf:"raiseHand"},a);b.classList.remove("enabled");b.classList.add("disabled");k.setAttribute("data-raisehand-disable",!0);d.setAttribute("data-title","disabled");b.style.pointerEvents="none";virtualclass.user.control.updateUser(a,
"raiseHand",!1);virtualclass.raiseHand.moveDownInList(a);this.rhCount--;this.rhCount||c.querySelector("#user_list .hand_bt").classList.remove("highlight");a=c.querySelector("#user_list .hand_bt  #notifyText");0<this.rhCount?a.innerHTML=this.rhCount:(b=c.querySelector("#user_list .hand_bt"),a.innerHTML="",b.classList.remove("congtooltip"),b.removeAttribute("data-title"),c.querySelector("#user_list .hand_bt").classList.remove("highlight"))},onMsgRec(a){a=a.message;roles.hasControls()?this.msgRecAtTeacher(a.data):
this.msgRecAtStudent(a.data)},msgRecAtTeacher(a){console.log(`raiseStd${a.action}`);var b=a.user;const d=chatContainerEvent.elementFromShadowDom(`#ml${b} .controllerRaiseH`),k=d.querySelector("a.congtooltip"),m=k.querySelector(".RaiseHandImg");"enable"==a.action?(this.enableRaiseHand(b),this.moveUpInList()):"disable"==a.action&&(virtualclass.user.control.updateUser(b,"raiseHand",!1),d.classList.remove("enabled"),d.classList.add("disabled"),m.setAttribute("data-raisehand-disable",!0),k.setAttribute("data-title",
"disabled"),d.style.pointerEvents="none",this.moveDownInList(b),this.rhCount--,this.rhCount||c.querySelector("#user_list .hand_bt").classList.remove("highlight"));a=c.querySelector("#user_list .hand_bt  #notifyText");0<this.rhCount?a.innerHTML=this.rhCount:(b=c.querySelector("#user_list .hand_bt"),a.innerHTML="",b.classList.remove("congtooltip"),b.removeAttribute("data-title"))},msgRecAtStudent(a){"disable"==a.action&&(this.stdRhEnable="enabled",a=c.getElementById("congHr"),a.classList.remove("disable"),
a.classList.add("enable"),c.querySelector("#virtualclassCont.congrea #icHr").setAttribute("data-action","enable"),c.querySelector("#virtualclassCont.congrea #congHr").setAttribute("data-title",virtualclass.lang.getString("RaiseHandStdEnabled")))},moveUpInList(){const a=chatContainerEvent.elementFromShadowDom(".controllerRaiseH","all");for(let b=0;b<a.length;b++)a[b].classList.contains("enabled")&&0!=b&&a[b].closest(".ui-memblist-usr").parentNode.insertBefore(a[b].closest(".ui-memblist-usr"),a[0].closest(".ui-memblist-usr"))},
moveDownInList(a){const b=chatContainerEvent.elementFromShadowDom(".controllerRaiseH.enabled","all");a=virtualclass.gObj.testChatDiv.shadowRoot.getElementById(`${a}contRaiseH`);0<b.length&&a.closest(".ui-memblist-usr").parentNode.insertBefore(a.closest(".ui-memblist-usr"),b[b.length-1].closest(".ui-memblist-usr").nextSibling)},enableRaiseHand(a){this.rhCount++;this._enableRaiseHand(this.rhCount,a)},_enableRaiseHand(a,d){const b=chatContainerEvent.elementFromShadowDom(`#ml${d} .controllerRaiseH`),
f=b.querySelector("a.congtooltip"),m=f.querySelector(".RaiseHandImg");virtualclass.user.control.updateUser(d,"raiseHand",!0);b.classList.remove("disabled");b.classList.add("enabled");m.setAttribute("data-raisehand-disable",!1);f.setAttribute("data-title",virtualclass.lang.getString("RaiseHandEnable"));b.style.pointerEvents="visible";d=c.querySelector("#user_list .hand_bt");d.classList.contains("highlight")||d.classList.add("highlight");c.querySelector("#user_list .hand_bt  #notifyText").innerHTML=
a;a=c.querySelector("#user_list .hand_bt");a.classList.contains("congtooltip")||a.classList.add("congtooltip");a.setAttribute("data-title",virtualclass.lang.getString("raiseHandNotify"))},_raiseHand(a){this.rhCountR++;this.rhCount=this.rhCountR;this._enableRaiseHand(this.rhCountR,a)},updateInStorage(){localStorage.setItem("stdRhEnable",this.stdRhEnable)},attachHandlerAtStudent(){const a=c.querySelector("#virtualclassCont.congrea #congHr");a.addEventListener("click",()=>{var b=c.querySelector("#virtualclassCont.congrea #icHr");
const d=virtualclass.vutil.whoIsTeacher();ioAdapter.sendUser({data:{user:wbUser.id,action:b.getAttribute("data-action")},cf:"raiseHand"},d);"enable"==b.getAttribute("data-action")?(b.setAttribute("data-action","disable"),a.classList.remove("enable"),a.classList.add("disable"),b=c.querySelector("#virtualclassCont.congrea #congHr"),b.setAttribute("data-title",virtualclass.lang.getString("RaiseHandStdDisabled")),virtualclass.raiseHand.stdRhEnable="disabled"):(b.setAttribute("data-action","enable"),a.classList.add("enable"),
a.classList.remove("disable"),b=c.querySelector("#virtualclassCont.congrea #congHr"),b.setAttribute("data-title",virtualclass.lang.getString("RaiseHandStdEnabled")),virtualclass.raiseHand.stdRhEnable="enabled")})}}}()})(window,document);(function(d){d.colorSelector={makeThemeReady(){const c=virtualclassSetting.theme.selectedColor,a=virtualclass.vutil.calcBrightness(c);let b;b=125<a?"black":"white";const d={},g={},k={};k.fcolor=chroma(c).brighten().hex();k.scolor=chroma(c).brighten(1.8).hex();50>a?10>=a?(g.fcolor=chroma(c).brighten(2).hex(),g.scolor=chroma(c).brighten(3).hex()):(g.fcolor=chroma(c).darken().hex(),g.scolor=chroma(c).darken(2).hex()):180<a?(g.fcolor=chroma(c).darken(1.5).hex(),g.scolor=chroma(c).darken(1.1).hex(),k.fcolor=
chroma(c).darken(.5).hex(),k.scolor=chroma(c).darken(.8).hex()):(g.fcolor=chroma(c).darken(.8).hex(),g.scolor=chroma(c).darken(.6).hex(),k.fcolor=chroma(c).brighten().hex(),k.scolor=chroma(c).brighten(1.8).hex());d.fcolor=c;d.scolor=chroma(c).brighten().hex();g.frontColor=b;k.frontColor=b;this.makeThemeReadyMainCont(b,d,g,k);this.makeThemeReadyEditor(b,d,g,k);this.makeThemeReadyRightPanel(b,d,g,k);this.makeThemeReadyVideo(b,d,g,k,a);this.makeThemeReadyPoll(b,d,g,k,a);this.makeThemeReadyPresentation(b,
d,g,k,a);this.makeThemeReadyDocument(b,d,g,k);this.lightColorCustomize(b,d,g,k,a)},lightColorCustomize(c,a,b,d,g){218<=g&&(a.fcolor=chroma(a.fcolor).darken(.4).hex(),a.scolor=chroma(a.fcolor).darken().hex());c=`0.05em solid ${a.fcolor}`;this.addCss(`${"#virtualclassCont.congrea #virtualclassOptionsCont .appOptions, #virtualclassCont.congrea #audioWidget{border-top:"}${c} !important;}`+"#virtualclassCont.congrea .containerWb .commandToolsWrapper .shapesToolbox .shapesTool .tool a"+`{border-bottom:${c} !important;}`+
"#virtualclassCont.congrea .containerWb .commandToolsWrapper .shapesToolbox .shapes_icon a ,#virtualclassCont.congrea #virtualclassAppLeftPanel #docShareNav ,#virtualclassCont.congrea #screenController .share button ,#virtualclassCont.congrea #stopScreenShare button "+`{border-left: 0.01em solid ${a.fcolor}!important;}`+"#virtualclassCont.congrea #audioWidget li"+`{border-right:${c} !important;}`+"#virtualclassCont.congrea #virtualclassAppRightPanel #chatWidget .chatBarTab, #virtualclassCont.congrea #audioWidget .audioTool, #virtualclassCont.congrea #networkStatusContainer, #virtualclassCont.congrea #alleditorRichContainerAnch"+
`{border-left:${c} !important;}`+"#virtualclassCont.congrea .containerWb .commandToolsWrapper .tool a ,#virtualclassCont.congrea #audioWidget li,#virtualclassCont.congrea #virtualclassAppRightPanel #chatWidget .chatBarTab li "+`{border-right: 0.01em solid ${a.fcolor}!important;}`+"#virtualclassCont.congrea .ui-widget-header.ui-corner-top.ui-chatbox-titlebar.ui-dialog-header"+`{border: 0.02em solid ${a.fcolor}!important;}`+"#virtualclassCont.congrea .btn.btn-default ,#virtualclassCont.congrea .vceditor-toolbar ,#virtualclassCont.congrea #virtualclassAppRightPanel #chatWidget .chatBarTab,#virtualclassCont.congrea #stickybar .footerCtr .vmchat_search #congreaUserSearch ,#virtualclassCont.congrea #layoutQuiz .navbar ,#virtualclassCont.congrea button ,#virtualclassCont.congrea #alleditorRichContainer #alleditorRichContainerAnch,#virtualclassCont.congrea .zoomControler ,#virtualclassCont.congrea .btn-default "+
`{background-image: linear-gradient(to bottom, ${a.fcolor} 0%,${a.scolor} 100%) !important;}`+"#virtualclassCont.congrea .shapesToolbox ,#virtualclassCont.congrea #stopScreenShare button "+`{border-right: 0.01em solid ${a.fcolor}!important;}`)},calcBrightness(c){c=chroma(c).rgb();c=Math.round((299*parseInt(c[0])+587*parseInt(c[1])+114*parseInt(c[2]))/1E3);console.log(`brightne${c}`);return c},makeThemeReadyMainCont(c,a,b,d){this.addCss(`${"#virtualclassCont.congrea .ui-widget-header{background-image: linear-gradient(to bottom, "}${a.fcolor} 0%,${a.scolor} 100%) !important} `+
"#virtualclassCont.congrea #virtualclassAppLeftPanel #dashboardnav .btn"+`{background-image: linear-gradient(to bottom, ${a.fcolor} 0%,${a.scolor} 100%) !important} `+"#virtualclassCont.congrea #virtualclassAppLeftPanel #dashboardnav .btn.clicked"+`{background-image: linear-gradient(to bottom, ${b.fcolor} 0%,${b.scolor} 100%) !important} `+"#virtualclassCont.congrea #navigator, #virtualclassCont.congrea #layoutQuiz .navbar, #virtualclassCont.congrea .commandToolsWrapper, #virtualclassCont.congrea .commandToolsWrapper .shapesToolbox .shapesTool,#virtualclassCont.congrea .commandToolsWrapper ul.strkSizeList li:hover,#virtualclassCont.congrea #sessionEndMsgCont .endHeader,#virtualclassCont.congrea #virtualclassAppContainer .virtualclass .commandToolsWrapper .tool ul.strkSizeList li.selected,#virtualclassCont.congrea #virtualclassAppContainer .virtualclass .commandToolsWrapper .tool ul.fontSizeList span.selected,#virtualclassCont.congrea #playButton,#virtualclassCont.congrea #recordPlay .rv-vanilla-modal-body #downloadPcCont #downloadSessionText"+
`{background-image: linear-gradient(to bottom, ${a.fcolor} 0%,${a.scolor} 100%) !important} `+"#virtualclassCont.congrea #virtualclassOptionsCont:first-child "+`{background-image: linear-gradient(to right, ${a.fcolor} 0%,${a.scolor} 100%)} `+"#virtualclassCont.congrea .commandToolsWrapper"+`{background-image: linear-gradient(to bottom, ${a.fcolor} 0%,${a.scolor} 100%)} `+"#virtualclassCont.congrea #virtualclassOptionsCont .appOptions.active, #virtualclassCont.congrea .commandToolsWrapper .tool.active a "+
`{background-image: radial-gradient(ellipse at center, ${b.fcolor} 0%,${b.scolor} 100%);} `+"#virtualclassCont.congrea .tool.active a span:before "+`{color:${c}!important}`+"#virtualclassCont.congrea #virtualclassOptionsCont .appOptions:hover, #virtualclassCont.congrea .containerWb .commandToolsWrapper .tool a:hover, #virtualclassCont.congrea .containerWb .commandToolsWrapper .tool ul.fontSizeList span:hover,#virtualclassCont.congrea #confirmCancel #confirmCancelButton:hover, #virtualclassCont.congrea #alleditorRichContainer:hover, #virtualclassCont.congrea #confirm.popupWindow #confirmOk #confirmOkButton:hover"+
`{background-image: radial-gradient(ellipse at center, ${d.fcolor} 0%,${d.scolor} 100%) !important}`+"#virtualclassCont.congrea #confirm.popupWindow #confirmOk #confirmOkButton,#virtualclassCont.congrea #confirm.popupWindow #confirmCancel #confirmCancelButton"+`{color:${c}!important}`+"#virtualclassCont.congrea .appOptions:hover .cgIcon:before"+`{color:${d.frontColor}!important}`+"#virtualclassCont.congrea .active .cgIcon:before"+`{color:${b.frontColor}!important}`+"#virtualclassCont.congrea .commandToolsWrapper .tool:hover .cgIcon:before"+
`{color:${d.frontColor}!important}`+"#virtualclassCont.congrea .cgIcon:before"+`{color:${c}!important}`+"#virtualclassCont.congrea #docShareNav #totalPages"+`{color:${c}!important}`+"#virtualclassCont.congrea #docShareNav .pageNav"+`{color:${c}!important}`+"#virtualclassCont.congrea #docShareNav #dcPaging #stdPageNo"+`{color:${c}!important}`+"#virtualclassCont.congrea .containerWb .commandToolsWrapper .tool a"+`{color:${c}!important}`+"#virtualclassCont.congrea .shapesToolbox a"+`{color:${c}!important}`+
"#virtualclassCont.congrea .shapes_icon .icon-shapes.cgIcon:after"+`{color:${c}!important}`+"#virtualclassCont.congrea .cgText"+`{color:${c}!important}`+"#virtualclassCont.congrea .vchead"+`{color:${c}!important}`+"#virtualclassCont.congrea .icon-publish2:before"+`{color:${b.fcolor}!important}`+"#virtualclassCont.congrea button ,#virtualclassCont.congrea .btn-default "+`{background-image: linear-gradient(to bottom, ${a.fcolor} 0%,${a.scolor} 100%) !important } `+"#virtualclassCont.congrea #congdashboard .modal-header .close{opacity :1;}#virtualclassCont.congrea .modal-header .btn-default ,#virtualclassCont.congrea .modal .btn-default ,#virtualclassCont.congrea .precheck .btn-default "+
`{color :${c}!important} `+"#virtualclassCont.congrea .vjs-control-bar .vjs-autoPlay-button {background:none !important ;}#virtualclassCont.congrea .vjs-control-bar .vjs-button {background:none !important ; border:none !important ;color:white!important}#virtualclassCont.congrea  #onlineusertext:before"+`{color :${c}!important} `+"#virtualclassCont.congrea  #recordPlay #playButton:before"+`{color :${c}!important} `+"#virtualclassCont.congrea #recordingHeaderContainer  "+`{background-image: linear-gradient(to bottom, ${a.fcolor} 0%,${a.scolor} 100%) !important ;color:${c}!important} `+
"#virtualclassCont.congrea  #virtualclassApp .playControllerMainCont "+`{background-image: linear-gradient(to bottom, ${a.fcolor} 0%,${a.scolor} 100%) !important ;color:${c}!important} `+"#virtualclassCont.congrea  .dbContainer .qq-cancel-button-selector"+`{color :${c}!important} `+" #virtualclassCont.congrea #virtualclassOptionsCont .appOptions "+`{border : 1px solid${a.fcolor}!important} `+`{background-image: linear-gradient(to bottom, ${b.fcolor} 0%,${b.scolor} 100%) !important ;color:${c}!important} `+
`{border-left: 1px solid ${a.fcolor}!important}`+"#virtualclassCont.congrea #screenController .share button:hover,#virtualclassCont.congrea #stopScreenShare button:hover "+`{background-image: linear-gradient(to bottom, ${d.fcolor} 0%,${d.scolor} 100%) !important;color:${c}!important}`+"#virtualclassCont.congrea  #playController button"+`{background-image:none !important;color:${c}!important; border-right: 1px solid ${a.fcolor}!important}`+"#virtualclassCont.congrea #virtualclassAppLeftPanel .containerWb .commandToolsWrapper .shapesToolbox.active"+
`{background-image: radial-gradient(ellipse at center, ${b.fcolor} 0%,${b.scolor} 100%);} `)},makeThemeReadyEditor(c,a,b,d){this.addCss(`${"#virtualclassCont.congrea a.vceditor-btn#virtualclassCont.congrea .containerWb .commandToolsWrapper .tool ul.fontSizeList span.selected,{background-color: "}${b.fcolor}} `+"#virtualclassCont.congrea a.vceditor-btn"+`{color: ${b.frontColor}} `+"#virtualclassCont.congrea #alleditorRichContainer"+`{background-color: ${b.frontColor}} `+"#virtualclassCont.congrea .vceditor-toolbar"+
`{background-image: linear-gradient(to bottom, ${a.fcolor} 0%,${a.scolor} 100%) !important} `+"#virtualclassCont.congrea a.vceditor-btn:hover"+`{color:${d.frontColor}!important}`+"#virtualclassCont.congrea a.vceditor-btn:hover"+`{background-image: radial-gradient(ellipse at center, ${d.fcolor} 0%,${d.scolor} 100%) !important}`+"#virtualclassCont.congrea .commandToolsWrapper .tool.active a"+`{background-image: radial-gradient(ellipse at center, ${b.fcolor} 0%,${b.scolor} 100% !important)} `+"#virtualclassCont .vceditor-dropdown-menu a:hover"+
`{background-color:${a.fcolor}!important}`)},makeThemeReadyRightPanel(c,a,b,d){this.addCss(`${"#virtualclassCont.congrea #recordPlay .rv-vanilla-modal-body #downloadPcCont #downloadSessionText,#virtualclassCont.congrea #virtualclassAppRightPanel #audioWidget{background-image: linear-gradient(to bottom, "}${a.fcolor} 0%,${a.scolor} 100%) !important}`+"#virtualclassCont.congrea #chatWidget .chatBarTab"+`{background: linear-gradient(to bottom, ${a.fcolor} 0%,${a.scolor} 100%) !important}`+"#virtualclassCont.congrea #stickycontainer .inner_bt:hover, #virtualclassCont.congrea #stickycontainer .stdRaiseHand:hover, #virtualclassCont.congrea #stickycontainer #contrAudioAll:hover, #virtualclassCont.congrea #virtualclassAppRightPanel #mainAudioPanel li:hover, #virtualclassCont.congrea #virtualclassAppRightPanel #mainAudioPanel li a:hover,#virtualclassCont.congrea #audioWidget #speakerPressOnce:hover,#virtualclassCont.congrea #audioTest-box:hover,#virtualclassCont.congrea #playButton:hover, #virtualclassCont.congrea #alwaysPress:hover,#virtualclassCont.congrea .recButton:hover"+
`{background-image: radial-gradient(ellipse at center, ${d.fcolor} 0%,${d.scolor} 100%) !important}`+"#virtualclassCont.congrea .vmchat_support.active ,#virtualclassCont.congrea .vmchat_room_bt.active,#virtualclassCont.congrea .vmchat_bar_button.active, #virtualclassCont.congrea #virtualclassAppRightPanel #audioWidget .settingActive,#virtualclassCont.congrea #virtualclassAppRightPanel #stickycontainer .handRaise.disable"+`{background-image: radial-gradient(ellipse at center, ${b.fcolor} 0%,${b.scolor} 100%) !important}`+
"#virtualclassCont.congrea #virtualclassAppRightPanel li:hover .cgIcon:before"+`{color:${d.frontColor}!important}`+"#virtualclassCont.congrea #virtualclassAppRightPanel #appSettingCtrlAnchor span"+`{color:${c}!important}`+"#virtualclassCont.congrea #virtualclassAppRightPanel li:hover .cgText"+`{color:${d.frontColor}!important}`+"#virtualclassCont.congrea #virtualclassAppRightPanel .handRaise.enable #icHr:before"+`{color:${c}!important}`+"#virtualclassCont.congrea #virtualclassAppRightPanel .pre-check-btn"+
`{background-image: linear-gradient(to bottom, ${a.fcolor} 0%,${a.scolor} 100%) !important ;color:${c}!important} `)},makeThemeReadyVideo(c,a,b,d,g){let f=a.fcolor;180<g&&(f=b.fcolor);this.addCss(`${"#virtualclassCont.congrea .ui-widget-header,#virtualclassCont.congrea #congdashboard .modal-header {background-image: linear-gradient(to bottom, "}${a.fcolor} 0%,${a.scolor} 100%) !important}`+"#virtualclassCont.congrea #listvideo .linkvideo .videoTitleCont:before, #virtualclassCont.congrea #listvideo .linkvideo .controls .editanch:before, "+
`#virtualclassCont.congrea #listvideo .linkvideo .controls:before{color:${f}!important}`+`#virtualclassCont.congrea #listvideo .linkvideo .controls:hover:before{color:${d.fcolor}!important}`+`#virtualclassCont.congrea #VideoDashboard button{color:${c}!important}`+`#virtualclassCont.congrea #VideoDashboard button{border:1px solid${c}!important}`+`{background-color: ${b.frontColor}!important} `+`#virtualclassCont.congrea #listvideo .linkvideo.playing{border:solid ${a.fcolor} 1px!important}`)},makeThemeReadyPoll(c,
a,b,d,g){a=a.fcolor;180<g&&(a=b.fcolor);this.addCss(`${"#virtualclassCont.congrea #virtualclassPoll .btn.btn-default, #virtualclassCont.congrea #virtualclassPoll #stdPollContainer #btnVote{color:"}${c};}`+`#virtualclassCont.congrea .bootstrap .pollNavBar > li > a {color:${c} ; }`+"#virtualclassCont.congrea .bootstrap .navListTab:hover"+`{color:${d.frontColor}!important;}`+"#virtualclassCont.congrea #virtualclassPoll #chartMenuCont a, #virtualclassCont.congrea #virtualclassPoll .controlIcon:before"+
`{color:${a}!important}`+`#virtualclassCont.congrea #virtualclassPoll .controlIcon:hover:before{color:${d.fcolor}!important}`+"#virtualclassCont.congrea #virtualclassPoll #navigator #stdPollHeader"+`{color:${c}!important;}`+"#virtualclassCont.congrea #virtualclassPoll .modal button.close ,#virtualclassCont.congrea  .alert .close {background-image: none !important ;background-color:none !important}")},makeThemeReadyPresentation(c,a,b,d,g){a=a.fcolor;180<g&&(a=b.fcolor,d.fcolor=chroma(b.fcolor).darken());
this.addCss(`${"#virtualclassCont.congrea #SharePresentationDashboard .btn-default{color:"}${c}!important;}`+"#virtualclassCont.congrea #virtualclassPoll #chartMenuCont a, "+`#virtualclassCont.congrea #SharePresentationDashboard .controls:before{color:${a}!important}`+`#virtualclassCont.congrea #SharePresentationDashboard .controls:hover:before{color:${d.fcolor}!important}`)},makeThemeReadyDocument(c,a,b,d){this.addCss(`${"#virtualclassCont.congrea #DocumentShareDashboard #newDocBtn {color:"}${c}!important; border: 1px solid ${a.fcolor}!important}`)},
addCss(c){const a=document.getElementsByTagName("head")[0],b=document.createElement("style");b.setAttribute("type","text/css");b.styleSheet?b.styleSheet.cssText=c:b.appendChild(document.createTextNode(c));a.appendChild(b)}}})(window);(function(d,c){d.appSetting=function(a){return{init(){const a=c.querySelector("#virtualclassCont.congrea #appSettingCtrl"),d=c.querySelector("#virtualclassCont.congrea #chatWidget"),g=c.querySelector("#virtualclassCont.congrea #appSettingDetail"),k=c.querySelector("#virtualclassCont.congrea .vmchat_bar_button"),m=c.querySelector("#virtualclassCont.congrea .vmchat_room_bt");a&&a.addEventListener("click",()=>{a.classList.contains("chatActive")?(a.classList.remove("chatActive"),a.classList.add("settingActive"),
d.classList.remove("active"),d.classList.add("deactive"),g.classList.add("active"),g.classList.remove("deactive"),k.classList.contains("active")&&k.classList.remove("active"),m.classList.contains("active")&&m.classList.remove("active")):(a.classList.add("chatActive"),a.classList.remove("settingActive"),d.classList.remove("deactive"),d.classList.add("active"),g.classList.remove("active"),g.classList.add("deactive"),c.querySelector(".congrea #memlist.enable")&&k.classList.add("active"),c.querySelector(".congrea #chatrm.enable")&&
m.classList.add("active"))})}}}()})(window,document);function Network(){this.sumLatency=this.latency=0;this.minLatency=999999;this.countLatency=0;this.avgLatency=1;this.MYSPEED_COUNTER_HIGH=this.MYSPEED_COUNTER_OK=0}Network.prototype.pingToServer=function(){if(io.webSocketConnected()){const d=Date.now();ioAdapter.sendPing(d)}};
Network.prototype.initToPing=function(d){this.hasOwnProperty("initToPingTime")&&clearTimeout(this.initToPingTime);this.hasOwnProperty("sleepTime")&&clearTimeout(this.sleepTime);this.initToPingTime=setTimeout(()=>{this.pingToServer();const c=this;this.sleepTime=setTimeout(()=>{this.latency=3E3;c.initToPing(5E3)},3E3)},d);this.variations()};
Network.prototype.variations=function(){this.latency&&3E3>this.latency&&0<this.latency&&(this.sumLatency+=this.latency,this.countLatency++,this.avgLatency=Math.round(this.sumLatency/this.countLatency),this.latency<this.minLatency&&10<this.latency&&(this.minLatency=this.latency));this.avgLatency>2*this.minLatency&&this.resetVariations();this.adaptiveMedia()};
Network.prototype.adaptiveMedia=function(){3>virtualclass.videoHost.gObj.MYSPEED&&(3E3<=this.latency||999999>this.minLatency&&this.latency>3*this.minLatency)?(this.MYSPEED_COUNTER_OK=0,this.MYSPEED_COUNTER_HIGH+=1,this.updateNetworkInfo("medium"),1===virtualclass.videoHost.gObj.MYSPEED&&2<=this.MYSPEED_COUNTER_HIGH?(this.MYSPEED_COUNTER_HIGH=0,this.updateNetworkInfo("medium"),this.setSpeed(2)):2===virtualclass.videoHost.gObj.MYSPEED&&4<=this.MYSPEED_COUNTER_HIGH&&(this.MYSPEED_COUNTER_HIGH=0,this.updateNetworkInfo("slow"),
this.setSpeed(3))):1<virtualclass.videoHost.gObj.MYSPEED&&999999>this.minLatency&&this.latency<2*this.minLatency?(this.MYSPEED_COUNTER_OK+=1,this.MYSPEED_COUNTER_HIGH=0,this.updateNetworkInfo("medium"),2<virtualclass.videoHost.gObj.MYSPEED&&4<=this.MYSPEED_COUNTER_OK?(this.MYSPEED_COUNTER_OK=0,this.updateNetworkInfo("medium"),this.setSpeed(2)):1<virtualclass.videoHost.gObj.MYSPEED&&10<=this.MYSPEED_COUNTER_OK&&(this.MYSPEED_COUNTER_OK=0,this.updateNetworkInfo("fast"),this.setSpeed(1))):(1E3<this.latency?
this.updateNetworkInfo("medium"):this.updateNetworkInfo("fast"),this.MYSPEED_COUNTER_HIGH=this.MYSPEED_COUNTER_OK=0)};
Network.prototype.updateNetworkInfo=function(d){var c;1===virtualclass.videoHost.gObj.MYSPEED?c="high":2===virtualclass.videoHost.gObj.MYSPEED?c="medium":3===virtualclass.videoHost.gObj.MYSPEED&&(c="low");const a=document.getElementById("proposedSpeed");a&&(a.dataset.suggestion=c);if(c=document.getElementById("networkLatency"))c.dataset.latency=d,d=virtualclass.lang.getString(`band${d}`),c.dataset.title=d};
Network.prototype.setSpeed=function(d){virtualclass.videoHost.gObj.MYSPEED=d;ioAdapter.sendSpeed(virtualclass.videoHost.gObj.MYSPEED);console.log(`Latency - CHANGE SPEED TO ${virtualclass.videoHost.gObj.MYSPEED}`);this.hideTeacherVideo();this.resetVariations()};Network.prototype.hideTeacherVideo=function(){if(roles.isStudent()&&3<=virtualclass.videoHost.gObj.MYSPEED){const d=document.querySelector("#videoParticipate"),c=d.getContext("2d");c.fillStyle="#000000";c.fillRect(0,0,d.offsetWidth,d.offsetHeight)}};
Network.prototype.resetVariations=function(){this.countLatency=this.sumLatency=0;this.avgLatency=1;this.minLatency=999999};Network.prototype.netWorkElementIsReady=function(){const d=document.querySelector("#networkStatusContainer");if(null==d){const c=this;virtualclass.gObj.connectingRoom=setTimeout(()=>{c.netWorkElementIsReady()},1E3)}else d.classList.add("connecting-room"),clearTimeout(virtualclass.gObj.connectingRoom)};const gesture={initClassJoin(){const d=document.querySelector("#joinClassModal");null!=d&&(d.style.display="block");document.querySelector("#joinClassModal").className="modal in";const c=document.querySelector("#virtualclassCont #virtualclassApp");null!=c&&(c.style.display="none");const a=document.querySelector("#joinClassModal .joinClasscontainer button");d&&d.addEventListener("click",()=>{a.focus()});this.classJoin=!0},attachHandler(){const d=document.querySelector("#joinClassModal .joinClasscontainer button");
d.focus();null!=d&&(d.addEventListener("click",()=>{virtualclass.gesture.clickToContinue()}),d.addEventListener("keydown",c=>{c.preventDefault();13==c.keyCode&&virtualclass.gesture.clickToContinue()}))},clickToContinue(){const d=document.querySelector("#virtualclassCont #virtualclassApp"),c=document.querySelector("#joinClassModal");d.style.display="block";c.style.display="none";virtualclass.media.audio.initAudiocontext();virtualclass.vutil.triggerMouseEvent(document.querySelector(".CodeMirror-scroll"),
"mousedown")},initAudioResume(d){const c=document.querySelector("#joinClassModal");null!==c&&(c.style.display="block");virtualclass.modal.show("#joinClassModal");if(null===document.getElementById("initAudio")){var a=document.querySelector("#joinClassModal .modal-body");const b=document.createElement("div");b.id="initAudio";b.innerHTML=virtualclass.lang.getString("clickheretoplay");a.appendChild(b);a.onclick=function(){virtualclass.media.audio.initScriptNode(d);c.style.display="none";virtualclass.gObj.requestToScriptNode=
null}}a=document.querySelector("#joinClassModal .joinClasscontainer");null!==a&&(a.style.display="none")}};(function(d,c){const a=function(a){this.shownPages=6;this.app=a};a.prototype.init=function(){this.UI.container();const a=virtualclass.system.measureResoultion({width:d.innerWidth,height:d.innerHeight});this.subCont=c.querySelector("#virtualclassCont.congrea #dcPaging");this.width=a.width;this.shownPages=this.countNumberOfNavigation(this.width)};a.prototype.createIndex=function(){this.init();for(let a=0;a<virtualclass.dts.order.length;a++)this.createDocNavigationNumber(virtualclass.dts.order[a],a);
this.shownPage(this.width);this.addActiveNavigation();this.setTotalPages(virtualclass.dts.order.length)};a.prototype.setCurrentIndex=function(a){console.log("==== page, set current index");c.querySelector("#currIndex").innerHTML=a};a.prototype.setTotalPages=function(a){console.log("==== page, set total page");var b=c.querySelector("#docShareNav #totalPages");b&&(b.innerHTML=` of ${a}`,b=c.querySelector("#docShareNav"),a?(b.classList.add("show"),b.classList.remove("hide")):(b.classList.add("hide"),
b.classList.remove("show")))};a.prototype.adjustPageNavigation=function(a,d){if("right"==d){d=c.querySelectorAll(".noteIndex.shw");if(d.length)var b=d[d.length-1],f=parseInt(b.getAttribute("data-set"));for(;f<a;f++){"DocumentShare"==virtualclass.currApp&&virtualclass.dts.indexNav.UI.setClassPrevNext();var m=c.querySelector(".noteIndex.hid.right");m&&(m.classList.remove("hid","right"),m.classList.add("shw"),b=c.querySelector(".noteIndex.shw"))&&(b.classList.remove("shw"),b.classList.add("hid","left"))}"DocumentShare"==
virtualclass.currApp&&(a=virtualclass.dts.docs.currNote,(a=c.querySelector(`.congrea #dcPaging #index${a}`))&&!a.classList.contains("active")&&a.classList.add("active"))}else{for((d=c.querySelector(".noteIndex.shw"))&&(f=parseInt(d.getAttribute("data-set")));f>a;f--)"DocumentShare"==virtualclass.currApp&&virtualclass.dts.indexNav.UI.setClassPrevNext(),d=c.querySelectorAll(".noteIndex.hid.left"),d.length&&(m=d[d.length-1]),m&&(m.classList.remove("hid","left"),m.classList.add("shw"),d=c.querySelectorAll(".noteIndex.shw"),
d.length&&(b=d[d.length-1]),b&&(b.classList.remove("shw"),b.classList.add("hid","right")));"DocumentShare"==virtualclass.currApp&&(a=virtualclass.dts.docs.currNote,(a=c.querySelector(`.congrea #dcPaging #index${a}`))&&!a.classList.contains("active")&&(a.classList.add("active"),a.setAttribute("selected","selected")))}};a.prototype.removeNav=function(){const a=c.getElementById("docShareNav");for(;a.firstChild;)a.removeChild(a.firstChild)};a.prototype.addActiveNavigation=function(a){this.addActiveClass(a);
a=c.querySelector("#rightNavPage.disable");this.UI.isNodeAvailable(".noteIndex.shw.active","next")?null!=a&&("Whiteboard"==virtualclass.currApp?this.UI.setArrowStatus("rightNavPage","enable"):virtualclass.dts.indexNav.UI._setArrowStatusDocs(c.getElementById("rightNavPage"),"enable","disable")):"Whiteboard"==virtualclass.currApp?this.UI.setArrowStatus("rightNavPage","disable"):virtualclass.dts.indexNav.UI._setArrowStatusDocs(c.getElementById("rightNavPage"),"disable","enable");a=c.querySelector("#leftNavPage.disable");
this.UI.isNodeAvailable(".noteIndex.shw.active","prev")?null!=a&&("Whiteboard"==virtualclass.currApp?this.UI.setArrowStatus("leftNavPage","enable"):virtualclass.dts.indexNav.UI._setArrowStatusDocs(c.getElementById("leftNavPage"),"enable","disable")):"Whiteboard"==virtualclass.currApp?this.UI.setArrowStatus("leftNavPage","disable"):virtualclass.dts.indexNav.UI._setArrowStatusDocs(c.getElementById("leftNavPage"),"disable","enable")};a.prototype.addActiveClass=function(a){if("Whiteboard"===virtualclass.currApp)a=
virtualclass.gObj.wbCount+1;else{a=virtualclass.dts.order.length;let b=virtualclass.dts.order.indexOf(virtualclass.dts.docs.currNote);this.setCurrentIndex(b+1)}this.setTotalPages(a)};a.prototype.rearrangePageNavigation=function(a){const b=c.getElementById("dcPaging");if(b){const f=c.createElement("div");f.id="dcPaging";if(null!=f){const g=[];if(this.oldOrder)for(var d=0;d<this.oldOrder.length;d++){var k=this.oldOrder[d];g[k]=c.getElementById(`index${this.oldOrder[d]}`).className}for(d=0;d<a.length;d++){const b=
c.getElementById(`index${a[d]}`);this.oldOrder&&(k=this.oldOrder[d],b.className=g[k]);f.appendChild(b);b.innerHTML=d+1;b.value=d+1}b.parentNode.replaceChild(f,b)}}this.UI.setClassPrevNext();this.addActiveNavigation()};a.prototype.shownPage=function(a){const b=c.querySelectorAll(".noteIndex");a=this.countNumberOfNavigation(a);for(let c=0;c<b.length;c++)b[c].className=c>a?"noteIndex hid right":"noteIndex shw"};a.prototype.countNumberOfNavigation=function(a){return 1200<=a?8:700<=a?5:500<=a?4:2};a.prototype.movePageIndex=
function(a){virtualclass.dts.indexNav.addActiveNavigation();virtualclass.dts.indexNav.UI.setClassPrevNext();virtualclass.dts.indexNav.UI.pageNavHandler(a)};a.prototype.createDocNavigationNumber=function(a,d){var b=virtualclass.getTemplate("docIndex","navigation")({app:virtualclass.currApp,id:a,page:d+1});this.subCont.insertAdjacentHTML("beforeend",b);b=c.querySelector("#index"+a);virtualclass.dts.docs.currNote==a&&(b.classList.add("active"),this.setCurrentIndex(d));this.index=d+1;b.onclick=virtualclass.dts.docs.goToNavs(a)};
a.prototype.createWbNavigationNumber=function(a){const b="_doc_0_"+a,c=virtualclass.getTemplate("wbIndex","navigation")({app:virtualclass.currApp,id:a,order:a,wid:b});this.subCont.insertAdjacentHTML("beforeend",c);virtualclass.wbCommon.indexNav.addActiveNavigation(b);this.setCurrentIndex(a)};a.prototype.newWbpage=function(a){virtualclass.vutil.navWhiteboard(virtualclass.wbCommon,virtualclass.wbCommon.newPage);virtualclass.wbCommon.hasOwnProperty("setNextWhiteboardTime")&&clearTimeout(virtualclass.wbCommon.setNextWhiteboardTime);
"Whiteboard"===virtualclass.currApp&&(virtualclass.wbCommon.setNextWhiteboardTime=setTimeout(()=>{virtualclass.zoom.normalRender()},500))};a.prototype.studentDocNavigation=function(a){if(virtualclass.dts.order){a=virtualclass.dts.order.indexOf(a);var b=c.querySelector("#docShareNav");-1==a?(b.classList.add("hide"),b.classList.remove("show")):(b.classList.add("show"),b.classList.remove("hide"));if(b=c.getElementById("stdPageNo"))b.innerHTML=a+1;const d=this;setTimeout(()=>{d.setTotalPages(virtualclass.dts.order.length)},
100)}};a.prototype.studentWBPagination=function(a){const b=c.getElementById("stdPageNo");if(b){console.log("==== student page navigation");b.innerHTML=parseInt(a);const c=this;setTimeout(()=>{c.setTotalPages(virtualclass.gObj.wbCount+1)},100)}};a.prototype.UI={container(){for(var a=c.getElementById("docShareNav");a.firstChild;)a.removeChild(a.firstChild);var d=virtualclass.getTemplate("navMain","navigation")({app:virtualclass.currApp,control:roles.hasControls()});a.innerHTML=d;if(roles.hasControls()){a=
c.querySelector(".congrea #docShareNav");c.querySelector("#currIndex").addEventListener("click",function(){var a=c.querySelector("#dcPaging");a&&(a.classList.toggle("close"),a.classList.toggle("open"))});if("Whiteboard"==virtualclass.currApp){d=c.createElement("span");d.id="addNewPage";d.className="newPage";a.appendChild(d);var g=c.createElement("span");d.appendChild(g);g.className="icon-newPage congtooltip";g.setAttribute("data-title",virtualclass.lang.getString("newPage"));g.addEventListener("click",
function(){virtualclass.wbCommon.indexNav.newWbpage(this.type)})}var k=c.querySelector("#dcPaging");a.addEventListener("mouseover",function(){k.classList.add("open");k.classList.remove("close")});a.addEventListener("mouseout",function(){k.classList.add("close");k.classList.remove("open")});var m=this;c.querySelector("#leftNavPage").addEventListener("click",function(){"Whiteboard"==virtualclass.currApp?m.isNodeAvailable(".noteIndex.shw.active","prev")?c.querySelector("#virtualclassWhiteboard .prev").click():
m.setArrowStatus("leftNavPage","disable"):(c.getElementById("docsprev").click(),m.setArrowStatus("leftNavPage","disable"))});c.querySelector("#rightNavPage").addEventListener("click",function(){"Whiteboard"==virtualclass.currApp?m.isNodeAvailable(".noteIndex.shw.active","next")?(c.querySelector("#virtualclassWhiteboard .next").click(),virtualclass.gObj.currWb.split("_doc_0")[1]>this.shownPages&&(c.querySelector(".noteIndex.shw").className="noteIndex hid left")):m.setArrowStatus("rightNavPage","disable"):
(c.getElementById("docsnext").click(),m.setArrowStatus("rightNavPage","disable"))})}},setClassPrevNext(){const a=c.querySelector(`#documentScreen #note${virtualclass.dts.docs.currNote}`);if(null!=a)var d=a.previousElementSibling,g=a.nextElementSibling;c.querySelector("#leftNavPage")&&(d?this.setArrowStatus("leftNavPage","enable"):this.setArrowStatus("leftNavPage","disable"));c.querySelector("#rightNavPage")&&(g?this.setArrowStatus("rightNavPage","enable"):this.setArrowStatus("rightNavPage","disable"))},
pageNavHandler(a,d){if("right"==a){if(a=c.querySelector(".noteIndex.hid.right.active")){a.classList.remove("hid");a.classList.remove("right");a.classList.add("shw");var b=c.querySelector(".noteIndex.shw");b&&(b.classList.remove("shw"),b.classList.add("hid","left"))}}else if(a=c.querySelector(".noteIndex.hid.left.active"))a.classList.remove("hid"),a.classList.remove("left"),a.classList.add("shw"),a=c.querySelectorAll(".noteIndex.shw"),a.length&&(b=a[a.length-1]),b&&(b.classList.remove("shw"),b.classList.add("hid"),
b.classList.add("right"))},setArrowStatus(a,d){const b="disable"==d?"enable":"disable";a=c.getElementById(a);"Whiteboard"==virtualclass.currApp?(a.classList.add(d),a.classList.remove(b)):virtualclass.dts.docs.currNote==virtualclass.dts.order[virtualclass.dts.order.length-1]&&this._setArrowStatusDocs(a,d,b)},_setArrowStatusDocs(a,c,d){a.classList.add(c);a.classList.remove(d)},isNodeAvailable(a,d){d="next"==d?"nextSibling":"previousSibling";return(a=c.querySelector(a))&&null!=a[d]}};d.pageIndexNav=
a})(window,document);(function(d){d.modal=(()=>({show(c){c=document.querySelector(c);null!=c&&c.classList.add("in")},hide(){var c=document.querySelector(c);null!=c&&c.classList.add("fade")},removeModal(){const c=document.querySelector("#editPollModal");c&&c.parentNode.removeChild(c)},closeModalHandler(c){const a=this;(c=document.querySelector(`#${c} .close`))&&c.addEventListener("click",()=>{a.removeModal()})},hideModal(){const c=document.querySelector("#congdashboard");c&&(c.className="modal fade")},showModal(){const c=
document.querySelector("#congdashboard");c&&(c.className="modal in")},attachpopupHandler(c,a,b){const d=document.querySelector(`#qnText${c}${a}`);d.insertAdjacentHTML("beforeend",b);document.querySelector(`#qnText${c}${a} .popover-content`).classList.add("hide");const g=document.querySelector(`#qnText${c}${a} .popover-content`);d.addEventListener("mouseover",()=>{g.classList.add("show");g.classList.remove("hide")});d.addEventListener("mouseleave",()=>{g.classList.remove("show");g.classList.add("hide")})}}))()})(window);const chatContainerEvent={ub:"init_chatBox",ac:"footerControler",ch:"footerControler",er:"footerControler",rs:"footerControler",rh:"footerControler",getEvent(d){({event:d}=d.dataset);return this[d]},init_chatBox(d,c){var a=$(d);let b;"videoSubWrapper"==d.className||"userVideos"==d.classList?(b=a[0].id,d=b.replace("user","")):(b=a.attr("href"),d=b.replace("#",""));"undefined"!==typeof b&&(a=0<a.parent(".usern").length?a.html():chat_div.shadowRoot.querySelector(`#ml${d} .usern a`).title,-1==$.inArray(d,
virtualclass.chat.idList)&&(virtualclass.chat.counter++,virtualclass.chat.idList.push(d),virtualclass.chat.vmstorage.hasOwnProperty(d)||(virtualclass.chat.vmstorage[d]=[],virtualclass.chat.vmstorage[d].push({userid:d,name:a}))),c.addBox(d,{dest:`dest${virtualclass.chat.counter}`,title:`box${virtualclass.chat.counter}`,first_name:a,type:"privateChat"}),c.init({user:{name:a},messageSent(a,b,c){$(`#${a}`).chatbox("option","boxManager").addMsg(b.name,c)}}),virtualclass.chat.vmstorage.hasOwnProperty(d)&&
displayUserSinglePvtChatHistory(d),a=d=null)},onEvent(d,c){const a=this.getEvent(d);"userVideos"==d.classList||"videoSubWrapper"==d.classList||"init_chatBox"==a?(d=d.classList.contains("media-heading")?d.parentNode.previousElementSibling:d.parentNode,this.init_chatBox(d,c)):"footerControler"==a&&("A"==d.tagName&&(d=d.firstElementChild,"SPAN"!=d.tagName&&alert("no span tag is found")),virtualclass.user.control.init.call(virtualclass.user,d))},elementFromShadowDom(d,c,a){if(null!=virtualclass.gObj.testChatDiv){const b=
virtualclass.gObj.testChatDiv.shadowRoot;return"undefined"!==typeof c&&"all"==c?b.querySelectorAll(d):"undefined"!==typeof a?b.getElementById(d):b.querySelector(d)}}};var micTesting={audioPlayerNode:!1,manipulateStreamFallback(d){this.playAudio=!0;this.audioToBePlay=[];this.allAudioArr=[];this.bufferSize=16384;if(null!=d){if(!virtualclass.media.audioVisual.hasOwnProperty("audioCtx")||virtualclass.media.audioVisual.hasOwnProperty("audioCtx")&&null==virtualclass.media.audioVisual.audioCtx)virtualclass.media.audioVisual.audioCtx=new (window.AudioContext||window.webkitAudioContext);virtualclass.system.mediaDevices.hasMicrophone?null==this.audioCreatorNode||void 0==
this.audioCreatorNode||"undefined"===typeof this.audioCreatorNode?(console.log("processor intialize"),this.audioInput=virtualclass.media.audioVisual.audioCtx.createMediaStreamSource(d),this.audioCreatorNode=virtualclass.media.audioVisual.audioCtx.createScriptProcessor(this.bufferSize,1,1),this.audioCreatorNode.onaudioprocess=this.recorderProcessFallback.bind(this),this.audioInput.connect(this.audioCreatorNode),this.audioCreatorNode.connect(virtualclass.media.audioVisual.audioCtx.destination)):console.log("No audio "):
console.log("There is no microphone")}else console.log("No stream is found")},recorderProcessFallback(d){if(this.playAudio){virtualclass.precheck.mic.graph.microphone.hasOwnProperty("localAudioBuffer")&&null!=virtualclass.precheck.mic.graph.microphone.localAudioBuffer||(virtualclass.precheck.mic.graph.microphone.localAudioBuffer=virtualclass.media.audioVisual.audioCtx.createBuffer(1,this.bufferSize,virtualclass.media.audioVisual.audioCtx.sampleRate));const c=d.inputBuffer.getChannelData(0);this.queueWithFallback(c);
this.playWithFallback();virtualclass.precheck.mic.graph.microphone.reloadBufferFunction(d)}},queueWithFallback(d){for(let c=0;c<d.length;c++)this.allAudioArr.push(d[c]);for(;this.allAudioArr.length>=this.bufferSize;)d=this.allAudioArr.splice(0,this.bufferSize),this.audioToBePlay.push(new Float32Array(d))},playWithFallback(){const d=this;this.audioPlayerNode||(this.audioPlayerNode=virtualclass.media.audioVisual.audioCtx.createScriptProcessor(this.bufferSize,1,1),this.audioPlayerNode.onaudioprocess=
function(c){if(micTesting.playAudio){c=c.outputBuffer.getChannelData(0);var a=d.getAudioChunks();if(null!=a)for(let b=0;b<a.length;b++)c[b]=a[b]}else for(c=c.outputBuffer.getChannelData(0),a=0;a<c.length;a++)c[a]=0},this.audioPlayerNode.connect(virtualclass.media.audioVisual.audioCtx.destination))},getAudioChunks(){if(5<=this.audioToBePlay.length){for(;2<=this.audioToBePlay.length;)this.audioToBePlay.shift();this.aChunksPlay=!0;return this.audioToBePlay.shift()}if(2<=this.audioToBePlay.length||0<
this.audioToBePlay.length&&!0===this.aChunksPlay)return this.aChunksPlay=!0,this.audioToBePlay.shift();this.aChunksPlay=!1},makeAudioEmpty(){this.playAudio=!1;this.audioToBePlay=[]},destroyAudioNode(){this.makeAudioEmpty();if(virtualclass.gObj.meetingMode){const d=virtualclass.multiVideo.localStream.getTracks();for(let c=0;c<d.length;c++)d[c].stop()}else this.audioPlayerNode&&(this.audioPlayerNode.disconnect(virtualclass.media.audioVisual.audioCtx.destination),delete this.audioPlayerNode,this.audioPlayerNode=
!1),this.audioCreatorNode&&(this.audioCreatorNode.disconnect(virtualclass.media.audioVisual.audioCtx.destination),delete this.audioCreatorNode,"Firefox"!=virtualclass.system.mybrowser.name&&"iOS"!=virtualclass.system.mybrowser.name&&"Safari"!=virtualclass.system.mybrowser.name||virtualclass.media.audioVisual.audioCtx.close(),virtualclass.precheck.mic.hasOwnProperty("graphProcessor")&&null!=virtualclass.precheck.mic.graphProcessor&&virtualclass.precheck.mic.graphProcessor.disconnect(virtualclass.precheck.mic.graphContext.destination),
"Firefox"!=virtualclass.system.mybrowser.name&&"iOS"!=virtualclass.system.mybrowser.name&&"Safari"!=virtualclass.system.mybrowser.name||null==virtualclass.precheck.mic.graphContext||virtualclass.precheck.mic.graphContext.close(),delete virtualclass.media.audioVisual.audioCtx)}};(function(d){d.settings={info:{},user:{},init(){var c=localStorage.getItem("settings");null===c&&(c=virtualclassSetting.settings,localStorage.setItem("settings",c));virtualclass.settings.info=virtualclass.settings.parseSettings(c);if(c=localStorage.getItem("userSettings"))virtualclass.settings.user=JSON.parse(c);this.recording.init()},settingsToHex(c){const a=[];a[0]=+c.allowoverride;a[1]=+c.studentaudio;a[2]=+c.studentvideo;a[3]=+c.studentpc;a[4]=+c.studentgc;a[5]=+c.raisehand;a[6]=+c.userlist;a[7]=
+c.enableRecording;a[8]=+c.recAllowpresentorAVcontrol;a[9]=+c.recShowPresentorRecordingStatus;a[10]=+c.attendeeAV;a[11]=+c.recallowattendeeAVcontrol;a[12]=+c.showAttendeeRecordingStatus;a[13]=+c.trimRecordings;a[14]=+c.attendeerecording;a[15]=+c.x6;return virtualclass.settings.binaryToHex(a.join(""))},parseSettings(c){const a={};c=virtualclass.settings.hexToBinary(c);c=c.split("");a.allowoverride=!!+c[0];a.studentaudio=!!+c[1];a.studentvideo=!!+c[2];a.studentpc=!!+c[3];a.studentgc=!!+c[4];a.raisehand=
!!+c[5];a.userlist=!!+c[6];a.enableRecording=!!+c[7];a.recAllowpresentorAVcontrol=!!+c[8];a.recShowPresentorRecordingStatus=!!+c[9];a.attendeeAV=!!+c[10];a.recallowattendeeAVcontrol=!!+c[11];a.showAttendeeRecordingStatus=!!+c[12];a.trimRecordings=!!+c[13];a.attendeerecording=!!+c[14];a.x6=!!+c[15];return a},hexToBinary(c){let a,b="";const d={0:"0000",1:"0001",2:"0010",3:"0011",4:"0100",5:"0101",6:"0110",7:"0111",8:"1000",9:"1001",a:"1010",b:"1011",c:"1100",d:"1101",e:"1110",f:"1111",A:"1010",B:"1011",
C:"1100",D:"1101",E:"1110",F:"1111"};for(a=0;a<c.length;a+=1)if(d.hasOwnProperty(c[a]))b+=d[c[a]];else return!1;return b},binaryToHex(c){let a,b,d,g,k="";for(a=c.length-1;3<=a;a-=4){d=c.substr(a+1-4,4);for(b=g=0;4>b;b+=1){if("0"!==d[b]&&"1"!==d[b])return!1;g=2*g+parseInt(d[b],10)}k=10<=g?String.fromCharCode(g-10+65)+k:String(g)+k}if(0<=a){for(b=g=0;b<=a;b+=1){if("0"!==c[b]&&"1"!==c[b])return!1;g=2*g+parseInt(c[b],10)}k=String(g)+k}return k},applySettings(c,a,b){if(roles.hasControls())return!0!==c&&
!1!==c||!virtualclass.settings.info.hasOwnProperty(a)?!1:("undefined"===typeof b?virtualclass.settings.applyPresentorGlobalSetting(c,a):virtualclass.settings.applySpecificAttendeeSetting(c,a,b),!0)},applyPresentorGlobalSetting(c,a){localStorage.removeItem("userSettings");virtualclass.settings.info[a]=c;c=virtualclass.settings.settingsToHex(virtualclass.settings.info);virtualclass.vutil.beforeSend({cf:"settings",Hex:c});localStorage.setItem("settings",c);for(const a in virtualclass.settings.user)virtualclass.user.control.changeAttribute(a,
virtualclass.gObj.testChatDiv.shadowRoot.getElementById(a+"contrAudImg"),virtualclass.settings.info.studentaudio,"audio","aud"),virtualclass.user.control.changeAttribute(a,virtualclass.gObj.testChatDiv.shadowRoot.getElementById(a+"contrChatImg"),virtualclass.settings.info.studentpc,"chat","chat");virtualclass.settings.user={}},applySpecificAttendeeSetting(c,a,b){if(virtualclass.settings.user.hasOwnProperty(b)){var d=virtualclass.settings.parseSettings(virtualclass.settings.user[b]);d[a]=c;c=virtualclass.settings.settingsToHex(d)}else{d=
{};for(const a in virtualclass.settings.info)d[a]=virtualclass.settings.info[a];d[a]=c;c=virtualclass.settings.settingsToHex(d)}virtualclass.vutil.beforeSend({cf:"settings",Hex:c,toUser:b},b);virtualclass.settings.user[b]=c;localStorage.setItem("userSettings",JSON.stringify(virtualclass.settings.user))},applyAttendeeSetting(c){for(const a in c)if(virtualclass.settings.info[a]!==c[a]&&(virtualclass.settings.info[a]=c[a],"trimRecordings"!==a))virtualclass.settings[a](c[a])},onMessage(c){if("string"===
typeof c){if(roles.isStudent()){const a=virtualclass.settings.parseSettings(c);this.applyAttendeeSetting(a);localStorage.setItem("settings",c)}}else this.recording.triggerSetting(c)},studentaudio(c){roles.isStudent()&&(!0===c?(virtualclass.user.control.audioWidgetEnable(!0),virtualclass.gObj.audioEnable=!0):!1===c&&(c=document.querySelector("#speakerPressOnce"),!0!==c.dataset.audioPlaying&&"true"!==c.dataset.audioPlaying||virtualclass.media.audio.clickOnceSpeaker("speakerPressOnce"),virtualclass.user.control.audioDisable(),
virtualclass.gObj.audioEnable=!1))},allowoverride(){console.log("TO DO")},studentpc(c){console.log("TO DO");!0===c?virtualclass.user.control.allChatEnable("pc"):!1===c&&virtualclass.user.control.disbaleAllChatBox()},studentgc(c){console.log("TO DO");!0===c?virtualclass.user.control.allChatEnable("gc"):virtualclass.user.control.disableCommonChat()},studentvideo(c){if(roles.isStudent()){const a=document.querySelector(".videoSwitchCont #videoSwitch");a.classList.contains("off")&&!1===c?console.log("do nothing"):
a.classList.contains("on")&&!0===c?console.log("do nothing"):a.classList.contains("on")&&!1===c&&virtualclass.vutil.videoHandler("off");virtualclass.videoHost.toggleVideoMsg(!1===c?"disable":"enable")}},raisehand(){console.log("TO DO")},userlist(){console.log("TO DO")},attendeerecording(){console.log("TO DO")},enableRecording(){console.log("TO DO")},recAllowpresentorAVcontrol(){console.log("TO DO")},recShowPresentorRecordingStatus(){console.log("TO DO")},attendeeAV(){console.log("TO DO")},recallowattendeeAVcontrol(){console.log("TO DO")},
showAttendeeRecordingStatus(){console.log("TO DO")},x6(){console.log("TO DO")},recording:{recordingButton:0,attendeeButtonAction:!0,init(){var c=JSON.parse(localStorage.getItem("recordingButton"));null===c?(this.recordingButton=this.recordingStatus(),localStorage.setItem("recordingButton",this.recordingButton)):this.recordingButton=c;c=JSON.parse(localStorage.getItem("attendeeButtonAction"));null!==c&&(this.attendeeButtonAction=c);this.showRecordingButton()},toggleRecordingButton(){21===this.recordingButton?
this.recordingButton=11:11===this.recordingButton&&(this.recordingButton=21);ioAdapter.setRecording();localStorage.setItem("recordingButton",this.recordingButton);this.showRecordingButton();roles.hasControls()?ioAdapter.mustSend({ac:this.recordingButton,cf:"recs"}):21===this.recordingButton?(this.attendeeButtonAction=!0,localStorage.setItem("attendeeButtonAction",!0)):(this.attendeeButtonAction=!1,localStorage.setItem("attendeeButtonAction",!1))},showRecordingButton(){var c=virtualclass.getTemplate("recordingButton");
switch(this.recordingButton){case 10:var a={ten:"ten"};break;case 11:a={eleven:"eleven"};break;case 20:a={twenty:"twenty"};break;case 21:a={twentyone:"twentyone"};break;default:return}c=c(a);a=document.querySelector("#docShareNav");let b=document.getElementById("recording");null!==b&&b.remove();a.insertAdjacentHTML("afterend",c);b=document.getElementById("recording");21!==this.recordingButton&&11!==this.recordingButton||this.attachHandler(b)},attachHandler(c){c.addEventListener("click",this.recordingButtonAction.bind(this,
c))},recordingButtonAction(){21!==this.recordingButton&&11!==this.recordingButton||this.toggleRecordingButton()},recordingStatus(){if(virtualclass.settings.info.enableRecording)return roles.hasControls()?virtualclass.settings.info.recAllowpresentorAVcontrol?21:virtualclass.settings.info.recShowPresentorRecordingStatus?20:22:virtualclass.settings.info.attendeerecording?virtualclass.settings.info.attendeeAV?virtualclass.settings.info.recallowattendeeAVcontrol?21:virtualclass.settings.info.showAttendeeRecordingStatus?
20:22:virtualclass.settings.info.showAttendeeRecordingStatus?10:0:0;if(roles.hasControls()){if(virtualclass.settings.info.recShowPresentorRecordingStatus)return 10}else if(virtualclass.settings.info.showAttendeeRecordingStatus)return 10;return 0},sendYesOrNo(){return 20===this.recordingButton||21===this.recordingButton||22===this.recordingButton?"yes":"no"},triggerSetting(c){if(virtualclass.settings.info.attendeeAV){switch(c.ac){case 11:this.recordingButton=10;break;case 21:this.recordingButton=virtualclass.settings.info.recallowattendeeAVcontrol?
this.attendeeButtonAction?21:11:20;break;default:return}ioAdapter.setRecording();localStorage.setItem("recordingButton",this.recordingButton);virtualclass.settings.info.showAttendeeRecordingStatus&&this.showRecordingButton()}else this.recordingButton=0,ioAdapter.setRecording(),this.showRecordingButton()}},userAudioIcon(){!1===virtualclass.settings.info.studentaudio?(virtualclass.gObj.audioEnable=!1,virtualclass.user.control.audioDisable(!0)):!0===virtualclass.settings.info.studentaudio?(virtualclass.gObj.audioEnable=
!0,virtualclass.user.control.audioWidgetEnable(!0)):!0!==virtualclass.settings.info.studentaudio&&virtualclass.user.control.audioDisable()},userVideoIcon(){!1===virtualclass.settings.info.studentvideo&&roles.isStudent()?(virtualclass.vutil.videoHandler("off"),virtualclass.user.control.videoDisable()):(roles.isStudent()&&!0!==virtualclass.settings.info.studentvideo?(virtualclass.vutil.videoHandler("off"),virtualclass.videoHost.toggleVideoMsg("disable")):(virtualclass.user.control.videoEnable(),roles.isStudent()&&
virtualclass.vutil.videoHandler("off")),!0===virtualclass.settings.info.studentvideo&&virtualclass.user.control.videoEnable())}}})(window);(d=>{function c(a){const b=new Promise((b,c)=>{const d=()=>{a.removeEventListener("success",g);a.removeEventListener("error",k)},g=()=>{b(f(a.result));d()},k=()=>{c(a.error);d()};a.addEventListener("success",g);a.addEventListener("error",k)});b.then(b=>{b instanceof IDBCursor&&q.set(b,a)});u.set(b,a);return b}function a(a){if(!r.has(a)){var b=new Promise((b,c)=>{const d=()=>{a.removeEventListener("complete",f);a.removeEventListener("error",g);a.removeEventListener("abort",g)},f=()=>{b();d()},g=()=>
{c(a.error);d()};a.addEventListener("complete",f);a.addEventListener("error",g);a.addEventListener("abort",g)});r.set(a,b)}}function b(a){return a!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(a)?function(...b){a.apply(u.get(this),b);return f(q.get(this))}:function(...b){return f(a.apply(u.get(this),b))}:function(b,...c){c=a.call(u.get(this),b,...c);
z.set(c,b.sort?b.sort():[b]);return f(c)}}function f(d){if(d instanceof IDBRequest)return c(d);if(t.has(d))return t.get(d);if("function"===typeof d)var f=b(d);else d instanceof IDBTransaction&&a(d),f=k(d,m||(m=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(d,p):d;f!==d&&(t.set(d,f),u.set(f,d));return f}function g(a,b){if(a instanceof IDBDatabase&&!(b in a)&&"string"===typeof b){if(C.get(b))return C.get(b);var c=b.replace(/FromIndex$/,""),d=b!==c,f=B.includes(c);if(c in
(d?IDBIndex:IDBObjectStore).prototype&&(f||v.includes(c)))return a=async function(a,...b){a=this.transaction(a,f?"readwrite":"readonly");let g=a.store;d&&(g=g.index(b.shift()));b=g[c](...b);f&&await a.done;return b},C.set(b,a),a}}const k=(a,b)=>b.some(b=>a instanceof b);let m,n;const q=new WeakMap,r=new WeakMap,z=new WeakMap,t=new WeakMap,u=new WeakMap;let p={get(a,b,c){if(a instanceof IDBTransaction){if("done"===b)return r.get(a);if("objectStoreNames"===b)return a.objectStoreNames||z.get(a);if("store"===
b)return c.objectStoreNames[1]?void 0:c.objectStore(c.objectStoreNames[0])}return f(a[b])},has(a,b){return a instanceof IDBTransaction&&("done"===b||"store"===b)?!0:b in a}};const v=["get","getKey","getAll","getAllKeys","count"],B=["put","add","delete","clear"],C=new Map;p=(a=>({get:(b,c,d)=>g(b,c)||a.get(b,c,d),has:(b,c)=>!!g(b,c)||a.has(b,c)}))(p);d.virtualclassOpenDB=function(a,b,{blocked:c,upgrade:d,blocking:g}={}){const k=indexedDB.open(a,b);a=f(k);d&&k.addEventListener("upgradeneeded",a=>{d(f(k.result),
a.oldVersion,a.newVersion,f(k.transaction))});c&&k.addEventListener("blocked",()=>c());g&&a.then(a=>a.addEventListener("versionchange",g));return a};d.virtualclassDeleteDB=function(a,{blocked:b}={}){a=indexedDB.deleteDatabase(a);b&&a.addEventListener("blocked",()=>b());return f(a).then(()=>{})}})(window);function triggerInitShareScreen(d,c){"function"===typeof virtualclass.getDataFullScreen&&virtualclass.ss.initShareScreen(d,c)}function isAlreadyInPendingList(d){if(0<virtualclass.gObj.memberlistpending.length)return-1<virtualclass.gObj.memberlistpending.findIndex(c=>c.userid==d.userid)}const removeAppsDom=function(){var d=document.getElementById("commandToolsWrapper");null!=d&&d.parentNode.removeChild(d);d=document.getElementById("virtualclassOptionsCont");null!=d&&d.parentNode.removeChild(d)};
function memberUpdateWithDelay(d,c){if("removed"==c){var a=virtualclass.gObj.memberlistpending.findIndex(a=>a.userid==d.removeUser);-1<a?(virtualclass.gObj.memberlistpending.splice(a,1),console.log("===== JOIN user left call")):setTimeout(()=>{console.log("===== JOIN user left call");memberUpdate(d,c)},0)}else{const b=d.message;if(virtualclass.isPlayMode)for(a=0;a<b.length;a++)isAlreadyInPendingList(b[a])||virtualclass.gObj.memberlistpending.push(b[a]);else for(a=0;a<b.length;a++)virtualclass.gObj.memberlistpending.push(b[a]);
console.log("member list pending(memberlistpending) udpate ")}0<virtualclass.gObj.memberlistpending.length&&!virtualclass.gObj.hasOwnProperty("memberUpdateDelayTimer")&&(virtualclass.gObj.memberUpdateDelayTimer=setTimeout(()=>{memberUpdate(null,"added");delete virtualclass.gObj.memberUpdateDelayTimer;virtualclass.gObj.hasOwnProperty("addEventToChatDiv")||(virtualclass.gObj.testChatDiv.shadowRoot.querySelector("#subchat").addEventListener("click",a=>{chatContainerEvent.onEvent(a.srcElement,chatboxManager)}),
virtualclass.gObj.addEventToChatDiv=!0)},1500))}
const defaultOperation=function(d,c){virtualclass.jId==virtualclass.gObj.uid?"t"!=virtualclass.joinUser.role&&(virtualclass.vutil.overrideRoles(virtualclass.joinUser.role),"s"==virtualclass.joinUser.role?removeAppsDom():"e"!=virtualclass.joinUser.role&&virtualclass.vutil.removeSessionEndTool()):console.log("Does not need to say hello to new user");ioPingPong.ping(d);Array.isArray(d.message)||(d.message=[d.message]);memberUpdateWithDelay(d,"added");roles.hasAdmin()&&(virtualclass.gObj.uid==virtualclass.jId&&
(virtualclass.gObj.studentSSstatus.mesharing||("EDITORRICH"!=virtualclass.currApp.toUpperCase()&&"EDITORCODE"!=virtualclass.currApp.toUpperCase()||ioAdapter.mustSend({eddata:"currAppEditor",et:virtualclass.currApp}),virtualclass.editorRich.isVcAdapterIsReady("editorRich")?virtualclass.editorRich.responseToRequest():console.log("Editor Rich vcAdapter is not ready"),virtualclass.editorCode.isVcAdapterIsReady("editorCode")?virtualclass.editorCode.responseToRequest():console.log("Editor Code vcAdapter is not ready")),
"SharePresentation"===virtualclass.currApp?"object"===typeof virtualclass.sharePt&&ioAdapter.mustSendUser({ppt:{init:virtualclass.sharePt.pptUrl,startFrom:virtualclass.sharePt.state},cf:"ppt"},virtualclass.jId):"Video"===virtualclass.currApp&&"object"===typeof virtualclass.videoUl.player&&ioAdapter.mustSendUser({videoUl:{init:{videoId:virtualclass.videoUl.videoId,videoUrl:virtualclass.videoUl.videoUrl},startFrom:virtualclass.videoUl.player.currentTime()},cf:"videoUl"},virtualclass.jId)),ioAdapter.sendWithDelayAndDrop({cf:"tConn"},
null,"send","tConn",1E3));roles.hasControls()&&virtualclass.gObj.uid!=virtualclass.jId?(virtualclass.vutil.sendCurrAppOnUserJoin(),"ScreenShare"===virtualclass.currApp?c="ss":"SharePresentation"===virtualclass.currApp?(console.log("sharePPt"),"object"===typeof virtualclass.sharePt?ioAdapter.mustSendUser({ppt:{init:virtualclass.sharePt.pptUrl,startFrom:virtualclass.sharePt.state},cf:"ppt"},virtualclass.jId):ioAdapter.mustSendUser({ppt:{init:"studentlayout"},cf:"ppt"},virtualclass.jId)):"DocumentShare"===
virtualclass.currApp?roles.hasControls()&&virtualclass.dts.docs.hasOwnProperty("currDoc")?null!=virtualclass.gObj.currWb&&(ioAdapter.mustSendUser({dts:{slideTo:virtualclass.dts.docs.note.currNote,docn:virtualclass.dts.docs.currDoc},cf:"dts"},virtualclass.jId),console.log("Document share send :- Complete slide")):(ioAdapter.mustSendUser({dts:{init:"studentlayout"},cf:"dts"},virtualclass.jId),console.log("Document share send :- Layout")):"Video"===virtualclass.currApp&&("object"===typeof virtualclass.videoUl.player?
virtualclass.videoUl.videoUrl&&ioAdapter.mustSendUser({videoUl:{init:{id:virtualclass.videoUl.videoId,videoUrl:virtualclass.videoUl.videoUrl},startFrom:virtualclass.videoUl.player.currentTime(),isPaused:virtualclass.videoUl.player.paused()},cf:"videoUl"},virtualclass.jId):ioAdapter.mustSendUser({videoUl:{init:"studentlayout"},cf:"videoUl"},virtualclass.jId)),"undefined"!==typeof c&&null!==c&&triggerInitShareScreen(c,6E3)):roles.isStudent()&&virtualclass.gObj.uid!=virtualclass.jId&&virtualclass.gObj.studentSSstatus.mesharing&&
triggerInitShareScreen("ss",6E3)};function processImage(d,c){d=new Uint8ClampedArray(d);d=d.subarray(2,d.length);1==c?(c=`data:image/webp;base64,${btoa(virtualclass.videoHost.Uint8ToString(d))}`,d="webp"):(c=`data:image/jpeg;base64,${btoa(virtualclass.videoHost.Uint8ToString(d))}`,d="jpeg");virtualclass.videoHost.drawReceivedImage(c,d,{x:0,y:0})}function isAnyOnePresenter(){return 1==parseInt(wbUser.anyonepresenter,10)}
function joinAsTeacher(d){virtualclass.gObj.veryFirstJoin=!1;virtualclass.vutil.isOrginalTeacherExist(d)||(overrideOperation("t"),console.log("Member add :- join as teacher"))}var overrideOperation=function(d){"s"===d&&(virtualclass.view.disappearBox("drawArea"),removeAppsDom(),"object"===typeof virtualclass.wb&&virtualclass.wb[virtualclass.gObj.currWb].utility.makeCanvasDisable());virtualclass.vutil.overrideRoles(d)};function getPosition(d,c){return d.findIndex(a=>a.userid==c)}
const ioEventApi={readyto_member_add(d){if("object"===typeof d.joinUser){const c={};let a=0;for(const b in d.joinUser)wbUser.id!=b&&(console.log("Don t join"),c.joinUser={key:b},c.message=d.message[a],c.newuser=d.newuser,c.type=d.type,c.user=d.user,a++,this.member_added(c))}else this.member_added(d)},member_added(d){"undefined"===typeof virtualclass.connectedUsers&&(virtualclass.connectedUsers=[]);if(d.hasOwnProperty("user")){const a=d.message;virtualclass.jId=a.userid;console.log(`===== JOIN users ${virtualclass.jId}`);
const b=getPosition(virtualclass.connectedUsers,virtualclass.jId);-1!=b&&virtualclass.connectedUsers.splice(b,1);virtualclass.gObj.allUserObj[virtualclass.jId]=a;virtualclass.connectedUsers.push(a);virtualclass.joinUser=a}else if(d.hasOwnProperty("users")){virtualclass.jId=d.joinUser;console.log(`===== JOIN users ${virtualclass.jId}`);virtualclass.connectedUsers=d.message;for(var c=0;c<virtualclass.connectedUsers.length;c++)virtualclass.gObj.allUserObj[virtualclass.connectedUsers[c].userid]=virtualclass.connectedUsers[c];
virtualclass.joinUser=this.getJoinUser(virtualclass.connectedUsers,virtualclass.jId)}else console.log("User packet is not receving");virtualclass.jId==virtualclass.gObj.uid&&(virtualclass.videoHost.setDefaultValue("undefined"===typeof virtualclass.videoHost.gObj.MYSPEED?1:virtualclass.videoHost.gObj.MYSPEED),virtualclass.vutil.setDefaultScroll(),roles.hasControls()&&virtualclass.vutil.beforeSend({cf:"settings",Hex:virtualclass.settings.settingsToHex(virtualclass.settings.info)}));virtualclass.gObj.mySetTime=
2E3;console.log("==== Add users");defaultOperation(d,void 0);roles.hasControls()&&virtualclass.poll.updateUsersOnPoll();if("undefined"!==typeof virtualclass.quiz&&0>virtualclass.quiz.uniqueUsers.indexOf(virtualclass.jId))for(c in virtualclass.quiz.uniqueUsers.push(virtualclass.jId),io.uniquesids)0>virtualclass.quiz.uniqueUsers.indexOf(c)&&virtualclass.quiz.uniqueUsers.push(c);"s"==virtualclass.joinUser.role&&virtualclass.gObj.has_ts_capability&&ioAdapter.mustSend({uid:virtualclass.gObj.uid,ac:!0,
cf:"tsr"});if(virtualclass.gObj.uid!=virtualclass.jId&&virtualclass.gObj.meetingMode)virtualclass.multiVideo.onUserJoin(virtualclass.jId);!roles.hasControls()&&("t"===d.message.role||virtualclass.gObj.uid==virtualclass.jId&&virtualclass.vutil.whoIsTeacher())&&(d=document.querySelector("#virtualclassCont.congrea"),d.classList.contains("tr_available")||d.classList.add("tr_available"))},newmessage(d){const c=d.message;if(c.hasOwnProperty("cf"))if("function"===typeof receiveFunctions[c.cf])receiveFunctions[c.cf](d);
else console.log(`CF ${c.cf} is not a function of receiveFunctions`)},readyto_user_logout(d){for(const c in d.action)d={type:"user_logout",fromUser:c,message:"offline"},virtualclass.ioEventApi.user_logout(d)},user_logout(d){console.log("user_logout");if(!roles.hasControls()&&(virtualclass.gObj.hasOwnProperty("whoIsTeacher")||(virtualclass.gObj.whoIsTeacher=virtualclass.vutil.whoIsTeacher()),virtualclass.gObj.whoIsTeacher==d.fromUser)){var c=document.querySelector("#virtualclassCont.congrea");c&&c.classList.contains("tr_available")&&
c.classList.remove("tr_available")}virtualclass.media.video.removeUser(d.fromUser);virtualclass.chat.isTechSupportExist(d.fromUser)&&virtualclass.chat.disableTechSupport(d.fromUser);c=d.fromUser;delete virtualclass.gObj.allUserObj[c];d=getPosition(virtualclass.connectedUsers,c);-1!==d&&virtualclass.connectedUsers.splice(d,1);d={removeUser:c};memberUpdateWithDelay(d,"removed");if(virtualclass.gObj.meetingMode)virtualclass.multiVideo.onUserRemove(c);virtualclass.connectedUsers.length<virtualclass.gObj.userToBeDisplay&&
(virtualclass.gObj.insertUser=!0)},error(d){virtualclass.gObj.displayError?(virtualclass.view.removeElement("serverErrorCont"),"undefined"==typeof d.message?console.log("Error ",d.message):("undefined"!==typeof d.message.stack?virtualclass.view.displayServerError("serverErrorCont",d.message.stack):console.log(`Error message ${d.message.stack} could not display`),"object"!==typeof d.message&&display_error(d.message.stack))):"object"!==typeof d.message&&console.log(d.message.stack)},Text_Limit_Exeed(d){virtualclass.view.createErrorMsg(virtualclass.lang.getString("Text_Limit_Exeed"),
"errorContainer","chatWidget",{className:"Text_Limit_Exeed"})},Binary_Limit_Exeed(d){virtualclass.view.createErrorMsg(virtualclass.lang.getString("Binary_Limit_Exeed"),"errorContainer","chatWidget",{className:"Binary_Limit_Exeed"})},Unauthenticated(d){virtualclass.view.createErrorMsg(virtualclass.lang.getString("Unauthenticated"),"errorContainer","chatWidget",{className:"Unauthenticated"});virtualclass.vutil.stopConnection()},Multiple_login(d){virtualclass.view.createErrorMsg(virtualclass.lang.getString("Multiple_login"),
"errorContainer","chatWidget",{className:"Multiple_login"});virtualclass.vutil.stopConnection()},Max_rooms(d){virtualclass.view.createErrorMsg(virtualclass.lang.getString("Max_rooms"),"errorContainer","chatWidget",{className:"Max_rooms"})},Max_users(d){virtualclass.view.createErrorMsg(virtualclass.lang.getString("Max_users"),"errorContainer","chatWidget",{className:"Max_users"})},PONG(d){virtualclass.network.latency=Date.now()-d.message;virtualclass.network.initToPing(1E3)},authentication_failed(d){virtualclass.chat.removeCookieUserInfo(d)},
connectionclose(d){virtualclass.hasOwnProperty("recorder")&&virtualclass.recorder.startUpload?console.log("During the upload process there would not any other popup box."):virtualclass.recorder.smallData&&virtualclass.recorder.hasOwnProperty("rdlength")&&1E5>virtualclass.recorder.rdlength?console.log("Do not show the waiting popupbox if there small chunks of data"):virtualclass.popup.waitMsg();virtualclass.chat.makeUserListEmpty()},connectionopen(d){virtualclass.gObj.invalidlogin=!1;d=6E3;virtualclass.gObj.hasOwnProperty("doEndSession")&&
(console.log("From Become Teacher"),d=1E4);setTimeout(()=>{if(virtualclass.vutil.sesionEndMsgBoxIsExisting()||virtualclass.gObj.hasOwnProperty("downloadProgress")||virtualclass.recorder.startUpload)console.log("Popup box Could not close");else{virtualclass.popup.closePopup();virtualclass.vutil.setDefaultScroll();const c=document.getElementById("popupContainer");null!=c&&(c.style.display="none");console.log("Popup box Close All")}},d)},binrec(d){const c=new Uint8Array(d.message);switch(c[0]){case 102:case 103:case 104:case 202:case 203:case 204:if(roles.hasControls()){virtualclass.gObj.studentSSstatus.mesharing=
!0;const a=document.querySelector("#virtualclassCont");""!=a&&(a.classList.add("studentScreenSharing"),document.querySelector("#chat_div").classList.add("studentScreenSharing"))}virtualclass.hasOwnProperty("studentScreen")||(virtualclass.studentScreen=new studentScreen);roles.hasControls()&&!virtualclass.gObj.studentSSstatus.mesharing||virtualclass.studentScreen.ssProcess(c,d.message,"ss","ScreenShare");virtualclass.gObj.studentSSstatus.sharing&&roles.isStudent()&&(d=document.getElementById("virtualclassScreenShareLocal"),
virtualclass.gObj.studentSSstatus.shareToAll?null!=d&&(d.style.display="block"):null!=d&&(d.style.display="none"));break;case 11:virtualclass.media.video.process(d.message);break;case 21:processImage(d.message,c[1])}},getJoinUser(d,c){for(let a=0;a<d.length;a++)if(d[a].userid==c)return d[a]}};const receiveFunctions=new function(){this.pong=function(d){ioPingPong.pong(d)};this.pongAck=function(d){ioPingPong.pongAck(d)};this.control=function(d){virtualclass.user.control.onmessage(d)};this.eddata=function(d){if(d.message.hasOwnProperty("et"))if("editorRich"==d.message.et)virtualclass.editorRich.onmessage(d,"EditorRich");else virtualclass.editorCode.onmessage(d,"EditorCode")};this.nEd=function(d){localStorage.setItem("nEd",!0);const c=document.getElementById("EditorRichwriteModeBox");null!=
c?"true"==c.dataset.writeMode?localStorage.removeItem("nEd"):(d.message.cf="control",localStorage.setItem("editorCode","true"),virtualclass.user.control.onmessage(d)):console.log("editor mode editorRichWriteModeBox null");console.log("Editor mode save")};this.bt=function(){virtualclass.vutil.removeBecomeTeacherWidget()};this.tConn=function(d){setTimeout(()=>{virtualclass.vutil.setReadModeWhenTeacherIsConn("editorRich");virtualclass.vutil.setReadModeWhenTeacherIsConn("editorCode")},2E3)};this.yts=
function(d){if(d.fromUser.userid!=virtualclass.gObj.uid)virtualclass.yts.onmessage(d.message)};this.sad=function(d){d.message.sad?(d=virtualclass.user.control.updateUser(d.fromUser.userid,"ad",!0),virtualclass.user.control.audioSign(d,"create")):(d=virtualclass.user.control.updateUser(d.fromUser.userid,"ad",!1),virtualclass.user.control.audioSign(d,"remove"),d=document.getElementById(`${d.id}contrAudAnch`),null!=d&&d.setAttribute("data-title",virtualclass.lang.getString("audioDisable")));return!0};
this.settings=function(d){if(d.message.hasOwnProperty("Hex"))virtualclass.settings.onMessage(d.message.Hex)};this.ena=function(d){};this.dia=function(d){};this.aEna=function(d){};this.aDia=function(d){};this.msg=function(d){messageUpdate(d)};this.sEnd=function(d){document.querySelector("#joinClassModal").style.display="none";d=document.querySelector("#virtualclassCont #virtualclassApp");null!=d&&(d.style.display="block");virtualclass.config.endSession();virtualclass.popup.sesseionEndWindow();virtualclass.gObj.endSession=
!0};this.dispWhiteboard=function(d){virtualclass.makeAppReady(virtualclass.apps.wb,void 0,d.message.d,d.message.ci)};this.ppt=function(d){d.fromUser.userid!=virtualclass.gObj.uid&&(d.message.hasOwnProperty("init")?virtualclass.makeAppReady(virtualclass.apps.sp):("object"!==typeof virtualclass.sharePt&&(virtualclass.makeAppReady(virtualclass.apps.sp),virtualclass.sharePt.onmessage({pptMsg:d.message.ppt.init,cf:"ppt",user:"all",cfpt:"setUrl"})),virtualclass.sharePt.onmessage(d.message)))};this.unshareScreen=
function(d){d=d.message.st;"object"===typeof virtualclass[d]&&(console.log("Unshare the screen at student"),virtualclass[d].prevImageSlices=[],virtualclass[d].removeStream(),virtualclass.currApp=virtualclass.gObj.defaultApp)};this.videoSlice=function(d){virtualclass.media.playVideo(d.message.videoSlice)};this.videoByImage=function(d){virtualclass.media.existVideoContainer(d.message.videoByImage)||virtualclass.media.video.createElement(d.message.videoByImage)};this.userMsg=function(d){virtualclass.gObj.chat.display(d.message.userMsg)};
this.requestPacketBy=function(d){roles.hasControls()&&virtualclass.gObj.chat.sendPackets(d.message.requestPacketBy,d.message.sp)};this.chatPackResponsed=function(d){d.message.byRequest===virtualclass.gObj.uid&&virtualclass.gObj.chat.displayMissedChats(d.message.chatPackResponsed)};this.reclaimRole=function(d){console.log("Role reclaim");roles.hasControls()&&virtualclass.vutil.vcResponseAReclaimRole(d.fromUser.userid,wbUser.id)};this.rpr=function(d){this.reclaimRole(d);console.log("reclaim role")};
this.assignRole=function(d){d.message.toUser===virtualclass.gObj.uid&&(console.log("Role assign"),"object"===typeof virtualclass.wb&&virtualclass.wb[virtualclass.gObj.currWb].utility.removeWhiteboardMessage(),virtualclass.vutil.vcResponseAssignRole(d.fromUser.userid,wbUser.id))};this.clearAll=function(d){"object"!==typeof virtualclass.wb&&virtualclass.makeAppReady(virtualclass.apps.wb);virtualclass.wb[virtualclass.gObj.currWb].response.clearAll(d.fromUser.userid,wbUser.id,d.message,virtualclass.wb[virtualclass.gObj.currWb].oTeacher)};
this.getMsPckt=function(d){virtualclass.wb[virtualclass.gObj.currWb].gObj.chunk=[];d=virtualclass.wb[virtualclass.gObj.currWb].bridge.sendPackets(d,virtualclass.wb[virtualclass.gObj.currWb].gObj.chunk);virtualclass.vutil.beforeSend({repObj:d,chunk:!0,cf:"repObj"})};this.createArrow=function(d){"object"===typeof virtualclass.wb&&(roles.hasControls()||virtualclass.wb[virtualclass.gObj.currWb].response.createArrow(d.message))};this.repObj=function(d){"object"!==typeof virtualclass.wb&&"DocumentShare"!=
virtualclass.currApp&&virtualclass.makeAppReady(virtualclass.apps.wb);"undefined"!==typeof virtualclass.gObj.currWb&&(virtualclass.wb[virtualclass.gObj.currWb].utility.removeWhiteboardMessage(),"t"==d.fromUser.role?virtualclass.wb[virtualclass.gObj.currWb].utility.replayObjsByFilter(d.message.repObj):console.log("whiteboard -------------------------- We just lost a packet"))};this.replayAll=function(d){virtualclass.wb[virtualclass.gObj.currWb].response.replayAll()};this.dts=function(d){console.log(`Document share :- message received ${d.message.serial}`);
console.dir(d.message.dts);if(d.message.dts.hasOwnProperty("init"))virtualclass.gObj.screenRh=100,virtualclass.makeAppReady("DocumentShare",void 0,d.message.dts),virtualclass.gObj.screenRh=60;else if("object"===typeof virtualclass.dts)virtualclass.dts.onmessage(d)};this.poll=function(d){console.log(d.message.poll.pollMsg);"init"==d.message.poll.pollMsg?virtualclass.makeAppReady("Poll"):("object"!==typeof virtualclass.poll&&(virtualclass.makeAppReady("Poll"),virtualclass.poll.onmessage({pollMsg:d.message.poll.init,
cf:"poll",user:"all"})),virtualclass.poll.onmessage(d.message,d.fromUser))};this.quiz=function(d){console.log(d.message.quiz.quizMsg);"init"==d.message.quiz.quizMsg?virtualclass.makeAppReady("Quiz"):("object"!==typeof virtualclass.quiz&&(virtualclass.makeAppReady("Quiz"),virtualclass.quiz.onmessage({quizMsg:d.message.quiz.init,cf:"quiz",user:"all"})),virtualclass.quiz.onmessage(d.message,d.fromUser))};this.videoUl=function(d){if(d.fromUser.userid!=virtualclass.gObj.uid)virtualclass.videoUl.onmessage(d.message)};
this.congController=function(d){const c=d.message.congCtr.videoSwitch;if(d.fromUser.userid!=virtualclass.gObj.uid)virtualclass.videoHost.onmessage(c);"off"===c?(virtualclass.vutil.addClass("virtualclassCont","videoff"),virtualclass.vutil.addClass("virtualclassAppRightPanel","hide"),virtualclass.vutil.removeClass("virtualclassAppRightPanel","show"),virtualclass.videoHost.setUserIcon(d.fromUser.userid)):(document.querySelector("#virtualclassCont").classList.remove("videoff"),virtualclass.vutil.addClass("virtualclassAppRightPanel",
"show"),virtualclass.vutil.removeClass("virtualclassAppRightPanel","hide"))};this.tsr=function(d){};this.na=function(d){virtualclass.user.control.iconAttrManupulate(d.fromUser.userid,"icon-audioEnaOrange")};this.ya=function(d){virtualclass.user.control.iconAttrManupulate(d.fromUser.userid,"icon-audioEnaGreen")};this.mem_add=function(d){virtualclass.ioEventApi.member_added({type:"member_added",newJoinUser:d.message.user,cmadd:!0})};this.mvid=function(d){console.log("multivideo, message received");
virtualclass.multiVideo.onmessage(d.message,d.fromUser.userid)};this.sc=function(d){console.log("Recevied scroll");virtualclass.pdfRender[virtualclass.gObj.currWb].setScrollPosition(d.message)};this.scf=function(d){console.log("Recevied scroll first");console.dir(d.message);null!=virtualclass.gObj.currWb&&virtualclass.pdfRender[virtualclass.gObj.currWb].setScrollPosition(d.message)};this.cwb=function(d){if(d.message.hasOwnProperty("diswb")){const {wid:c}=d.message;virtualclass.gObj.currWb=c;virtualclass.wbCommon.whiteboardExist(virtualclass.gObj.currWb)||
virtualclass.vutil.createWhiteBoard(virtualclass.gObj.currWb);const a=c.split("_");0<a.length&&(virtualclass.gObj.currSlide=a[a.length-1]);virtualclass.gObj.currIndex=d.message.currIndex;virtualclass.wbCommon.displaySlide(c);localStorage.setItem("currIndex",virtualclass.gObj.currIndex)}else d.message.hasOwnProperty("wbCount")&&(virtualclass.gObj.wbCount=d.message.wbCount,-1==virtualclass.gObj.wIds.indexOf(Number(virtualclass.gObj.wbCount))&&(virtualclass.gObj.wIds.push(virtualclass.gObj.wbCount),
virtualclass.gObj.currIndex=d.message.currIndex,virtualclass.wbCommon.indexNav.studentWBPagination(virtualclass.gObj.currIndex)),localStorage.setItem("currIndex",virtualclass.gObj.currIndex))};this.reqscreen=function(d){"mobTab"==virtualclass.system.device||"Chrome"!=virtualclass.system.mybrowser.name&&"Firefox"!=virtualclass.system.mybrowser.name&&"Edge"!=virtualclass.system.mybrowser.name?virtualclass.vutil.beforeSend({ext:!0,cf:"colorIndicator",nosupport:!0}):(d=virtualclass.lang.getString("stdscreenshare"),
virtualclass.gObj.precheckScrn&&virtualclass.vutil.prechkScrnShare(),virtualclass.popup.confirmInput(d,c=>{c?(roles.isStudent()&&(virtualclass.gObj.studentSSstatus.mesharing=!0),virtualclass.makeAppReady("ScreenShare","byclick")):virtualclass.vutil.beforeSend({sd:!0,cf:"colorIndicator"})}))};this.sshare_user=d=>{virtualclass.vutil.removeSSsharing();virtualclass.gObj.whoIsSharing=d.fromUser.userid;virtualclass.vutil.initssSharing(d.fromUser.userid)};this.sview=function(d){const c=document.getElementById("virtualclassScreenShareLocal");
roles.isStudent()&&!virtualclass.gObj.studentSSstatus.mesharing&&null!=c&&(c.style.display="none");d.message.hasOwnProperty("firstSs")&&(virtualclass.gObj.studentSSstatus.sharing=!0);virtualclass.gObj.studentSSstatus.shareToAll=!1;console.log("Share, self view")};this.sToAll=function(){const d=document.getElementById("virtualclassScreenShareLocal");null!=d&&(d.style.display="block");virtualclass.gObj.studentSSstatus.shareToAll=!0;virtualclass.gObj.studentSSstatus.sharing=!0;console.log("Share, to all")};
this.rmStdScreen=function(d){virtualclass.vutil.initDefaultApp();virtualclass.vutil.beforeSend({unshareScreen:!0,st:"ss",cf:"unshareScreen"});"object"===typeof virtualclass.ss?virtualclass.ss.clearScreenShare():virtualclass.vutil.removeSSsharing()};this.raiseHand=function(d){virtualclass.raiseHand.onMsgRec(d)};this.colorIndicator=function(d){var c=d.message;d=d.fromUser.userid;c.sd?(d=chatContainerEvent.elementFromShadowDom(`#ml${d} .icon-stdscreenImg`),null!=d&&d.setAttribute("data-dcolor","red")):
c.ext&&(c=c.hasOwnProperty("nosupport")?"nosupport":"orange",d=chatContainerEvent.elementFromShadowDom(`#ml${d} .icon-stdscreenImg`),null!=d&&d.setAttribute("data-dcolor",c))};this.stdVideoCtrl=function(d){d.fromUser.userid!=virtualclass.gObj.uid&&virtualclass.videoHost.stdVideoCtrlMsg(d)};this.toggleVideo=function(d){};this.destroyPlayer=function(d){if("Video"==virtualclass.currApp&&virtualclass.hasOwnProperty("videoUl")&&virtualclass.videoUl.videoUrl){virtualclass.videoUl.videoUrl="";virtualclass.videoUl.videoId=
"";(d=document.getElementById("dispVideo_Youtube_api"))&&d.contentWindow&&d.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*");if(d=document.querySelector(".congrea #dispVideo"))d.style.display="none",(d=document.querySelector(".congrea #dispVideo video"))&&d.setAttribute("src","");(d=document.querySelector("#listvideo .playing"))&&d.classList.remove("playing");(d=document.querySelector("#listvideo .removeCtr"))&&d.classList.remove("removeCtr");"object"===typeof virtualclass.videoUl.player&&
delete virtualclass.videoUl.player}};this.sync=function(){};this.recs=function(d){if(virtualclass.isPlayMode)11===d.message.ac?virtualclass.videoHost.onmessage("off"):virtualclass.videoHost.onmessage("on");else if(virtualclass.settings.info.attendeeAV)virtualclass.settings.onMessage(d.message)}};function Config(){}Config.prototype.setNewSession=function(d){localStorage.setItem("mySession",d);!virtualclass.isPlayMode&&roles.hasControls()&&(d=(new Date).getTime(),d=JSON.stringify({createdDate:d}),localStorage.setItem("myConfig",d))};
Config.prototype.endSession=function(d){console.log("==== End the session here");delete virtualclass.connectedUsers;virtualclass.gObj.hasOwnProperty("memberUpdateDelayTimer")&&(clearTimeout(virtualclass.gObj.memberUpdateDelayTimer),virtualclass.gObj.memberlistpending.length=0,delete virtualclass.gObj.memberUpdateDelayTimer);virtualclass.hasOwnProperty("poll")&&""!==virtualclass.poll&&(virtualclass.poll.pollState={},virtualclass.poll.dataRec={});var c=document.getElementById("congrealogo");null!=c&&
c.classList.remove("disbaleOnmousedown");$("#chatroom_bt2").removeClass("ui-state-highlight");"object"===typeof virtualclass.videoUl&&virtualclass.videoUl.hasOwnProperty("player")&&"object"===typeof virtualclass.videoUl.player&&null!=virtualclass.videoUl.player.player_&&virtualclass.videoUl.destroyPlayer();null!=virtualclass.gObj.CDTimer&&clearInterval(virtualclass.gObj.CDTimer);c=document.querySelector(`#virtualclass${virtualclass.currApp}`);null!=c&&(c.style.display="none");virtualclass.hasOwnProperty("media")&&
virtualclass.media.audio.muteButtonToogle();c=chatContainerEvent.elementFromShadowDom(".ui-memblist-usr","all");if(null!=c&&0<c.length)for(var a=0;a<c.length;a++)null!=c[a]&&c[a].parentNode.removeChild(c[a]);virtualclass.gObj.precheckScrn&&virtualclass.vutil.prechkScrnShare();virtualclass.gObj.audioEnable=roles.hasControls()?!0:virtualclass.gObj.stdaudioEnable;c=localStorage.getItem("precheck");null!=virtualclass.chat&&(delete virtualclass.chat.vmstorage,virtualclass.chat.vmstorage={},virtualclass.chat.removeChatHighLight("chatrm"));
virtualclass.recorder.items=[];virtualclass.recorder.totalSent=0;virtualclass.gObj.tempReplayObjs.length=0;virtualclass.wb="";delete virtualclass.gObj.currWb;virtualclass.gObj.studentSSstatus.mesharing=!1;virtualclass.removeSharingClass();virtualclass.gObj.studentSSstatus.shareToAll=!1;virtualclass.gObj.studentSSstatus.sharing=!1;delete virtualclass.gObj.whoIsSharing;null!=virtualclass.videoHost&&(virtualclass.videoHost.gObj.stdStopSmallVid=!1,virtualclass.videoHost.gObj.allStdVideoOff=!1);virtualclass.gObj.wbTool=
{};virtualclass.recorder.hasOwnProperty("startUpload")&&delete virtualclass.recorder.startUpload;virtualclass.gObj.hasOwnProperty("downloadProgress")&&delete virtualclass.gObj.downloadProgress;d||("object"===typeof virtualclass.wb&&(alert("Clear all whiteboard"),virtualclass.wb[virtualclass.gObj.currWb].utility.t_clearallInit(),virtualclass.wb[virtualclass.gObj.currWb].utility.makeDefaultValue(),"object"===typeof virtualclass.wb[virtualclass.gObj.currWb].replay&&(virtualclass.wb[virtualclass.gObj.currWb].replay.rendering=
!1)),null!=virtualclass.editorRich&&virtualclass.editorRich.removeEditorData(),virtualclass.pdfRender={});virtualclass.vutil.removeClass("audioWidget","fixed");virtualclass.storage.clearStorageData();virtualclass.wbCommon.removeAllContainers();virtualclass.gObj.wbCount=0;virtualclass.gObj.currSlide=0;virtualclass.currApp=virtualclass.gObj.defaultApp;virtualclass.gObj.hasOwnProperty("disableCamByUser")?virtualclass.user.control.audioDisable():virtualclass.user.control.audioWidgetEnable(!0);virtualclass.user.control.allChatEnable();
virtualclass.user.control.resetmediaSetting();roles.isStudent()?(d=document.getElementById("videoHostContainer"),null!==d&&(d.style.display="none"),d=document.getElementById("virtualclassAppRightPanel"),null!==d&&d.classList.contains("vidShow")&&d.classList.remove("vidShow")):(d=document.getElementById("virtualclassSessionEndTool"),null!==d&&(d.className=virtualclass.vutil.removeClassFromElement("virtualclassSessionEndTool","active")));"object"===typeof virtualclass.yts&&clearInterval(virtualclass.yts.tsc);
"object"===typeof virtualclass.sharePt&&virtualclass.sharePt.UI.removeIframe();console.log("Session End.");virtualclass.previous=`virtualclass${virtualclass.currApp}`;virtualclass.getContent=!1;virtualclass.recorder.storeDone=0;workerIO.postMessage({cmd:"sessionEndClose"});null!=c&&localStorage.setItem("precheck",JSON.parse(c));console.log(`New role before clear ${virtualclass.gObj.uRole}`);virtualclass.settings.user={};d=document.querySelector("#virtualclassWhiteboard");null!==d&&(d.style.display=
"none");d=document.querySelector("#virtualclassCont");null!==d&&d.classList.remove("loading");localStorage.clear();virtualclass.videoHost&&roles.isStudent()&&!virtualclass.isPlayMode&&(d=document.querySelector("#virtualclassAppRightPanel"),null===d||d.classList.contains("vidHide")||d.classList.add("vidHide"));console.log(`New role after clear ${virtualclass.gObj.uRole}`);virtualclass.enablePreCheck||virtualclass.popup.waitMsg();"object"===typeof virtualclass.dts&&null!=virtualclass.dts&&virtualclass.dts.destroyDts();
if("object"===typeof virtualclass.raiseHand&&null!=virtualclass.raiseHand)if(roles.hasControls()){if(virtualclass.raiseHand.rhCount=0,virtualclass.raiseHand.rhCountR=0,(d=document.querySelector(".congrea .vmchat_bar_button .hand_bt.highlight"))&&d.classList.remove("highlight"),d=document.querySelector(".congrea .vmchat_bar_button .hand_bt #notifyText"))d.innerHTML=""}else if(d=document.querySelector(".congrea .handRaise.disable"))d.classList.remove("disable"),d.classList.add("enable"),d.setAttribute("data-title",
virtualclass.lang.getString("RaiseHandStdEnabled")),document.querySelector(".congrea .handRaise #icHr").setAttribute("data-action","enable"),virtualclass.raiseHand.stdRhEnable="enabled";if(null!==document.getElementById("chat_div")){(d=chatContainerEvent.elementFromShadowDom(".vmchat_room_bt.ui-state-highlight"))&&d.classList.remove("ui-state-highlight");(d=document.querySelector("#virtualclassCont.congrea.student"))&&d.classList.contains("videoff")&&d.classList.remove("videoff");d=document.querySelector("#virtualclassCont #memlist");
c=document.querySelector("#virtualclassCont #chatrm");a=document.querySelector("#user_list");const b=document.querySelector("#chatroom_bt2");d&&!d.classList.contains("enable")&&(d.classList.add("enable"),d.classList.remove("disable"),c&&(c.classList.add("disable"),c.classList.remove("enable")));null!==b&&(a.classList.contains("active")||a.classList.add("active"),b.classList.remove("active"));virtualclass.chat.removeCommonChatNodes()}null!=virtualclass.serverData&&(virtualclass.serverData.rawData=
{video:[],ppt:[],docs:[]},roles.hasAdmin()&&virtualclass.serverData.fetchAllData());virtualclass.gObj.wIds=[0];virtualclass.wbCommon.order=[0];virtualclass.gObj.wbCount=0;virtualclass.wbCommon.clearNavigation();"object"===typeof virtualclass.wb&&delete virtualclass.wb[virtualclass.gObj.currWb].activeToolColor;virtualclass.gObj.currIndex=1};(function(d){function c(){}c.prototype.setBasicData=async function(a){a.earlierWidth=a.innerWidth;a.earlierHeight=a.innerHeight;a.wbUser=wbUser;a.pageEnter=(new Date).getTime();const b=new a.virtualclass;b.config=new Config;b.appData={};b.virtualclassIDBOpen=a.virtualclassOpenDB;a.virtualclass=b;b.gObj.displayError=1;b.lang={};b.lang.getString=a.getString;b.lang.message=a.message;b.gObj.mobileVchOffset=vhCheck();b.settings=a.settings;b.ioEventApi=ioEventApi;b.user=new a.user;b.storage=a.storage;b.wbCommon=
a.wbCommon;b.recorder=a.recorder;b.vutil=a.vutil;b.system=a.system;b.chat=new Chat;await b.system.mediaDevices.getMediaDeviceInfo();wbUser.virtualclassPlay=+wbUser.virtualclassPlay;wbUser.virtualclassPlay&&(b.gObj.role="s",localStorage.removeItem("teacherId"),wbUser.id=99955551230,b.gObj.uid=wbUser.id);b.popup=new PopUp({showOverlay:!0});b.gObj.fromPageRefresh=!0;b.isMiniFileIncluded("wb.min")&&(b.gObj.displayError=0);2<a.virtualclass.error.length?a.virtualclass.error=[]:(b.gObj.memberlistpending=
[],b.gObj.veryFirstJoin=!0,await b.storage.init())};c.prototype.validDateSession=function(){var a=localStorage.getItem("prvUser");const b=localStorage.getItem("thisismyplaymode");virtualclass.gObj.myConfig=localStorage.getItem("myConfig");virtualclass.isPlayMode||null!==b&&"thisismyplaymode"===b?virtualclass.config.endSession():null!==a?(a=JSON.parse(a),a.id===wbUser.id&&a.room===wbUser.room&&wbUser.role===a.role&&a.settings===virtualclassSetting.settings||virtualclass.config.endSession()):null!==
virtualclass.gObj.myConfig&&(a=JSON.parse(virtualclass.gObj.myConfig),a=a.createdDate,108E5<(new Date).getTime()-a&&virtualclass.config.endSession())};c.prototype.loadData=function(){roles.hasControls()&&localStorage.setItem("uRole",virtualclass.gObj.uRole);null===localStorage.getItem("prvUser")&&virtualclass.setPrvUser();virtualclass.createMainContainer();var a=localStorage.getItem("wIds");null!=a&&(a=JSON.parse(a),virtualclass.gObj.wIds=a,virtualclass.gObj.wbCount=a.length-1);const b=JSON.parse(localStorage.getItem("prevApp"));
virtualclass.gObj.prevApp=b;if(null!=b){virtualclass.previousApp=b;var c=b.name;c=c.charAt(0).toUpperCase()+c.slice(1);if("Yts"==b.name||"DocumentShare"==b.name)if(null==b.metaData)var d=null;else d=b.metaData,d.fromReload=!0;else"Video"==b.name?null==b.metaData||null==b.metaData.init?d=null:(d=b.metaData,d.fromReload=!0):"Whiteboard"==b.name&&(null==a&&(virtualclass.gObj.wbCount=b.wbn),a=localStorage.getItem("currSlide"),null!=a&&(virtualclass.gObj.currSlide=a,console.log("==== current slide ",virtualclass.gObj.currSlide)))}else c=
virtualclass.gObj.defaultApp;"undefined"===typeof d&&(d=null);virtualclass.precheck=localStorage.getItem("precheck");a=localStorage.getItem("precheck");null!=a&&(virtualclass.isPrecheck=JSON.parse(a));wbUser.virtualclassPlay?(virtualclass.isPrecheck=!1,virtualclass.enablePreCheck=!1):(virtualclass.precheck=localStorage.getItem("precheck"),virtualclass.enablePreCheck=!0,a=localStorage.getItem("precheck"),null!=a&&(virtualclass.isPrecheck=JSON.parse(a)));!virtualclass.enablePreCheck||null!=virtualclass.isPrecheck&&
virtualclass.isPrecheck?(virtualclass.makePreCheckAvailable=!1,virtualclass.popup.waitMsg("refresh")):virtualclass.makePreCheckAvailable=!0;virtualclass.appData.appIs=c;virtualclass.appData.videoObj=d};c.prototype.appInit=async function(){virtualclass.settings.init();await virtualclass.init(wbUser.role,virtualclass.appData.appIs,virtualclass.appData.videoObj);if("Edge"===virtualclass.system.mybrowser.name){const a=document.getElementById("virtualclassCont");null!=a&&a.classList.add("edge")}wbUser.virtualclassPlay||
virtualclass.editorRich.veryInit();virtualclass.gObj.testChatDiv=document.querySelector("#chat_div");virtualclass.gObj.testChatDiv.attachShadow({mode:"open"})};c.prototype.setUpMedia=async function(){if(roles.isStudent()){const a=localStorage.getItem("audEnable");null!==a&&"false"===a.ac&&(virtualclass.user.control.mediaWidgetDisable(),virtualclass.gObj.audioEnable=!1)}virtualclass.gObj.hasOwnProperty("audIntDisable")||virtualclass.gObj.hasOwnProperty("vidIntDisable")||await virtualclass.media.init()};
c.prototype.readyToGo=async function(){null!=virtualclass.isPrecheck&&("undefined"===typeof virtualclass.videoHost.gObj.MYSPEED&&(virtualclass.videoHost.gObj.MYSPEED=1),await virtualclass.videoHost.afterSessionJoin())};d.Bootstrap=c})(window);$.uiBackCompat=!1;(function(d){d.onload=async function(){const c=new d.Bootstrap;await c.setBasicData(d);await c.validDateSession();await c.loadData();await c.appInit();await c.setUpMedia();await c.readyToGo()}})(window);
//# sourceMappingURL=https://live.congrea.net/virtualclass/build/src/wb-map
