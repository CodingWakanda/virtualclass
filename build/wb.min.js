/*
 modernizr 3.5.0 (Custom Build) | MIT *
 https://modernizr.com/download/?-webp-setclasses !*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,c,b){d!=Array.prototype&&d!=Object.prototype&&(d[c]=b.value)};$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(d,c,b,a){if(c){b=$jscomp.global;d=d.split(".");for(a=0;a<d.length-1;a++){var f=d[a];f in b||(b[f]={});b=b[f]}d=d[d.length-1];a=b[d];c=c(a);c!=a&&null!=c&&$jscomp.defineProperty(b,d,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.fill",function(d){return d?d:function(c,b,a){var f=this.length||0;0>b&&(b=Math.max(0,f+b));if(null==a||a>f)a=f;a=Number(a);0>a&&(a=Math.max(0,f+a));for(b=Number(b||0);b<a;b++)this[b]=c;return this}},"es6","es3");
$jscomp.findInternal=function(d,c,b){d instanceof String&&(d=String(d));for(var a=d.length,f=0;f<a;f++){var g=d[f];if(c.call(b,g,f,d))return{i:f,v:g}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(c,b){return $jscomp.findInternal(this,c,b).v}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.Symbol=function(){var d=0;return function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+d++}}();$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var d=$jscomp.global.Symbol.iterator;d||(d=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[d]&&$jscomp.defineProperty(Array.prototype,d,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(d){var c=0;return $jscomp.iteratorPrototype(function(){return c<d.length?{done:!1,value:d[c++]}:{done:!0}})};$jscomp.iteratorPrototype=function(d){$jscomp.initSymbolIterator();d={next:d};d[$jscomp.global.Symbol.iterator]=function(){return this};return d};
$jscomp.iteratorFromArray=function(d,c){$jscomp.initSymbolIterator();d instanceof String&&(d+="");var b=0,a={next:function(){if(b<d.length){var f=b++;return{value:c(f,d[f]),done:!1}}a.next=function(){return{done:!0,value:void 0}};return a.next()}};a[Symbol.iterator]=function(){return a};return a};$jscomp.polyfill("Array.prototype.keys",function(d){return d?d:function(){return $jscomp.iteratorFromArray(this,function(c){return c})}},"es6","es3");
$jscomp.makeIterator=function(d){$jscomp.initSymbolIterator();var c=d[Symbol.iterator];return c?c.call(d):$jscomp.arrayIterator(d)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(d){function c(){this.batch_=null}function b(a){return a instanceof f?a:new f(function(b,c){b(a)})}if(d&&!$jscomp.FORCE_POLYFILL_PROMISE)return d;c.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};c.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var a=$jscomp.global.setTimeout;c.prototype.asyncExecuteFunction=function(b){a(b,
0)};c.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];a[b]=null;try{c()}catch(r){this.asyncThrow_(r)}}}this.batch_=null};c.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var f=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(n){b.reject(n)}};f.prototype.createResolveAndReject_=
function(){function a(a){return function(f){c||(c=!0,a.call(b,f))}}var b=this,c=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};f.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof f)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};f.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(n){this.reject_(n);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};f.prototype.reject_=function(a){this.settle_(2,a)};f.prototype.fulfill_=function(a){this.settle_(1,a)};f.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};f.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
0;a<this.onSettledCallbacks_.length;++a)g.asyncExecute(this.onSettledCallbacks_[a]);this.onSettledCallbacks_=null}};var g=new c;f.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};f.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(r){c.reject(r)}};f.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{g(a(b))}catch(w){h(w)}}:
b}var g,h,d=new f(function(a,b){g=a;h=b});this.callWhenSettled_(c(a,g),c(b,h));return d};f.prototype.catch=function(a){return this.then(void 0,a)};f.prototype.callWhenSettled_=function(a,b){function c(){switch(f.state_){case 1:a(f.result_);break;case 2:b(f.result_);break;default:throw Error("Unexpected state: "+f.state_);}}var f=this;null==this.onSettledCallbacks_?g.asyncExecute(c):this.onSettledCallbacks_.push(c)};f.resolve=b;f.reject=function(a){return new f(function(b,c){c(a)})};f.race=function(a){return new f(function(c,
f){for(var g=$jscomp.makeIterator(a),h=g.next();!h.done;h=g.next())b(h.value).callWhenSettled_(c,f)})};f.all=function(a){var c=$jscomp.makeIterator(a),g=c.next();return g.done?b([]):new f(function(a,f){function h(b){return function(c){d[b]=c;m--;0==m&&a(d)}}var d=[],m=0;do d.push(void 0),m++,b(g.value).callWhenSettled_(h(d.length-1),f),g=c.next();while(!g.done)})};return f},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var d={},c=Object.create(new $jscomp.global.Proxy(d,{get:function(b,a,f){return b==d&&"q"==a&&f==c}}));return!0===c.q}catch(b){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(d,c){return Object.prototype.hasOwnProperty.call(d,c)};
$jscomp.polyfill("WeakMap",function(d){function c(){if(!d||!Object.seal)return!1;try{var a=Object.seal({}),b=Object.seal({}),c=new d([[a,2],[b,3]]);if(2!=c.get(a)||3!=c.get(b))return!1;c.delete(a);c.set(b,4);return!c.has(a)&&4==c.get(b)}catch(A){return!1}}function b(a){$jscomp.owns(a,f)||$jscomp.defineProperty(a,f,{value:{}})}function a(a){var c=Object[a];c&&(Object[a]=function(a){b(a);return c(a)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(d&&$jscomp.ES6_CONFORMANCE)return d}else if(c())return d;
var f="$jscomp_hidden_"+Math.random();a("freeze");a("preventExtensions");a("seal");var g=0,h=function(a){this.id_=(g+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};h.prototype.set=function(a,c){b(a);if(!$jscomp.owns(a,f))throw Error("WeakMap key fail: "+a);a[f][this.id_]=c;return this};h.prototype.get=function(a){return $jscomp.owns(a,f)?a[f][this.id_]:void 0};h.prototype.has=
function(a){return $jscomp.owns(a,f)&&$jscomp.owns(a[f],this.id_)};h.prototype.delete=function(a){return $jscomp.owns(a,f)&&$jscomp.owns(a[f],this.id_)?delete a[f][this.id_]:!1};return h},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(d){function c(){if($jscomp.ASSUME_NO_NATIVE_MAP||!d||"function"!=typeof d||!d.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),b=new d($jscomp.makeIterator([[a,"s"]]));if("s"!=b.get(a)||1!=b.size||b.get({x:4})||b.set({x:4},"t")!=b||2!=b.size)return!1;var c=b.entries(),f=c.next();if(f.done||f.value[0]!=a||"s"!=f.value[1])return!1;f=c.next();return f.done||4!=f.value[0].x||"t"!=f.value[1]||!c.next().done?!1:!0}catch(t){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(d&&$jscomp.ES6_CONFORMANCE)return d}else if(c())return d;$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=new WeakMap,a=function(a){this.data_={};this.head_=h();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};a.prototype.set=function(a,b){a=0===a?0:a;var c=f(this,a);c.list||(c.list=this.data_[c.id]=[]);c.entry?c.entry.value=b:(c.entry={next:this.head_,previous:this.head_.previous,head:this.head_,
key:a,value:b},c.list.push(c.entry),this.head_.previous.next=c.entry,this.head_.previous=c.entry,this.size++);return this};a.prototype.delete=function(a){a=f(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};a.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=h();this.size=0};a.prototype.has=function(a){return!!f(this,a).entry};
a.prototype.get=function(a){return(a=f(this,a).entry)&&a.value};a.prototype.entries=function(){return g(this,function(a){return[a.key,a.value]})};a.prototype.keys=function(){return g(this,function(a){return a.key})};a.prototype.values=function(){return g(this,function(a){return a.value})};a.prototype.forEach=function(a,b){for(var c=this.entries(),f;!(f=c.next()).done;)f=f.value,a.call(b,f[1],f[0],this)};a.prototype[Symbol.iterator]=a.prototype.entries;var f=function(a,c){var f=c&&typeof c;"object"==
f||"function"==f?b.has(c)?f=b.get(c):(f=""+ ++m,b.set(c,f)):f="p_"+c;var g=a.data_[f];if(g&&$jscomp.owns(a.data_,f))for(a=0;a<g.length;a++){var h=g[a];if(c!==c&&h.key!==h.key||c===h.key)return{id:f,list:g,index:a,entry:h}}return{id:f,list:g,index:-1,entry:void 0}},g=function(a,b){var c=a.head_;return $jscomp.iteratorPrototype(function(){if(c){for(;c.head!=a.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:b(c)};c=null}return{done:!0,value:void 0}})},h=function(){var a={};return a.previous=
a.next=a.head=a},m=0;return a},"es6","es3");$jscomp.assign="function"==typeof Object.assign?Object.assign:function(d,c){for(var b=1;b<arguments.length;b++){var a=arguments[b];if(a)for(var f in a)$jscomp.owns(a,f)&&(d[f]=a[f])}return d};$jscomp.polyfill("Object.assign",function(d){return d||$jscomp.assign},"es6","es3");$jscomp.polyfill("Array.prototype.values",function(d){return d?d:function(){return $jscomp.iteratorFromArray(this,function(c,b){return b})}},"es8","es3");
!function(d,c,b){function a(a){var b=A.className,c=n._config.classPrefix||"";if(z&&(b=b.baseVal),n._config.enableJSClass)b=b.replace(new RegExp("(^|\\s)"+c+"no-js(\\s|$)"),"$1"+c+"js$2");n._config.enableClasses&&(b+=" "+c+a.join(" "+c),z?A.className.baseVal=b:A.className=b)}function f(b,c){if("object"==typeof b)for(var g in b)r(b,g)&&f(g,b[g]);else{b=b.toLowerCase();g=b.split(".");var h=n[g[0]];if(2==g.length&&(h=h[g[1]]),"undefined"!=typeof h)return n;c="function"==typeof c?c():c;1==g.length?n[g[0]]=
c:(!n[g[0]]||n[g[0]]instanceof Boolean||(n[g[0]]=new Boolean(n[g[0]])),n[g[0]][g[1]]=c);a([(c&&0!=c?"":"no-")+g.join("-")]);n._trigger(b,c)}return n}var g=[],h=[],m={_version:"3.5.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(a,b){var c=this;setTimeout(function(){b(c[a])},0)},addTest:function(a,b,c){h.push({name:a,fn:b,options:c})},addAsyncTest:function(a){h.push({name:null,fn:a})}},n=function(){};n.prototype=m;n=new n;var r,A=c.documentElement,z="svg"===
A.nodeName.toLowerCase();!function(){var a={}.hasOwnProperty;r="undefined"===typeof a||"undefined"===typeof a.call?function(a,b){return b in a&&"undefined"===typeof a.constructor.prototype[b]}:function(b,c){return a.call(b,c)}}();m._l={};m.on=function(a,b){this._l[a]||(this._l[a]=[]);this._l[a].push(b);n.hasOwnProperty(a)&&setTimeout(function(){n._trigger(a,n[a])},0)};m._trigger=function(a,b){if(this._l[a]){var c=this._l[a];setTimeout(function(){var a;for(a=0;a<c.length;a++)(0,c[a])(b)},0);delete this._l[a]}};
n._q.push(function(){m.addTest=f});n.addAsyncTest(function(){function a(a,b,c){function g(b){var g=b&&"load"===b.type?1==h.width:!1;f(a,"webp"===a&&g?new Boolean(g):g);c&&c(b)}var h=new Image;h.onerror=g;h.onload=g;h.src=b}var b=[{uri:"data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA=",name:"webp"},{uri:"data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAABBxAR/Q9ERP8DAABWUDggGAAAADABAJ0BKgEAAQADADQlpAADcAD++/1QAA==",name:"webp.alpha"},{uri:"data:image/webp;base64,UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA",
name:"webp.animation"},{uri:"data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",name:"webp.lossless"}],c=b.shift();a(c.name,c.uri,function(c){if(c&&"load"===c.type)for(c=0;c<b.length;c++)a(b[c].name,b[c].uri)})});(function(){var a,b,c,f,d;for(d in h)if(h.hasOwnProperty(d)){if(a=[],b=h[d],b.name&&(a.push(b.name.toLowerCase()),b.options&&b.options.aliases&&b.options.aliases.length))for(c=0;c<b.options.aliases.length;c++)a.push(b.options.aliases[c].toLowerCase());c="function"===
typeof b.fn?b.fn():b.fn;for(f=0;f<a.length;f++){var m=a[f];m=m.split(".");1===m.length?n[m[0]]=c:(!n[m[0]]||n[m[0]]instanceof Boolean||(n[m[0]]=new Boolean(n[m[0]])),n[m[0]][m[1]]=c);g.push((c?"":"no-")+m.join("-"))}}})();a(g);delete m.addTest;delete m.addAsyncTest;for(c=0;c<n._q.length;c++)n._q[c]();d.Modernizr=n}(window,document);var roles={isTeacher:function(){return"t"===virtualclass.gObj.uRole},isStudent:function(){return"s"===virtualclass.gObj.uRole},isPresenter:function(){return"p"===virtualclass.gObj.uRole},isEducator:function(){return"e"===virtualclass.gObj.uRole},hasControls:function(){return"t"===virtualclass.gObj.uRole||"p"===virtualclass.gObj.uRole},hasAdmin:function(){return"t"===virtualclass.gObj.uRole||"e"===virtualclass.gObj.uRole},hasView:function(){return"s"===virtualclass.gObj.uRole||"e"===virtualclass.gObj.uRole}};var ioStorage={sendStore:function(d,c){c=JSON.stringify({type:c,m:d,userto:null,user:virtualclass.uInfo.userobj});d.hasOwnProperty("sEnd")||d.hasOwnProperty("getMsPckt")||1!=d.onrefresh&&this.completeStorage(c)},dataBinaryStore:function(d){var c;"[object Int8Array]"==Object.prototype.toString.call(d)?c="a":"[object Uint8ClampedArray]"==Object.prototype.toString.call(d)&&(c="c");dtConWorker.postMessage({dt:c,msg:d});var b=this;dtConWorker.onmessage=function(a){b.completeStorage(a.data.msg,{type:a.data.dt})}},
dataAdapterStore:function(d,c){"object"==typeof virtualclass.storage&&"object"==typeof virtualclass.storage.db?virtualclass.storage.dataAdapterAllStore(JSON.stringify(d),c):setTimeout(function(){ioStorage.dataAdapterStore(d,c)},10)},dataUserAdapterMustData:function(d,c){"object"==typeof virtualclass.storage&&"object"==typeof virtualclass.storage.db?virtualclass.storage.dataUserAdapterAllStore(JSON.stringify(d),c):setTimeout(function(){ioStorage.dataUserAdapterMustData(d,c)},10)},dataExecutedStoreAll:function(d,
c){virtualclass.storage.dataExecutedStoreAll(JSON.stringify(d),c)},dataExecutedUserStoreAll:function(d,c){virtualclass.storage.dataExecutedUserStoreAll(JSON.stringify(d),c)},ioCompleteStorageInit:function(d){try{ioStorage.completeStorage(d)}catch(b){var c=this;setTimeout(function(){c.ioCompleteStorageInit(d)},10)}},completeStorage:function(d,c,b){if(!virtualclass.hasOwnProperty("getContent")||1!=virtualclass.getContent){if("undefined"==typeof firstTime&&(referenceTime=window.pageEnter,firstTime=!0,
!virtualclass.vutil.isPlayMode())){try{var a=virtualclass.storage.db.transaction(["allData"],"readwrite")}catch(h){this.ioCompleteStorageInit(d);return}a=virtualclass.storage.db.transaction(["allData"],"readwrite");if("undefined"!=typeof a){var f=a.objectStore("allData");f.openCursor().onsuccess=function(a){(a=a.target.result)&&a.value.hasOwnProperty("recObjs")&&(a.value.hasOwnProperty("bd")?f.clear():JSON.parse(a.value.recObjs).hasOwnProperty("authuser")||f.clear())}}}a=(new Date).getTime();var g=
a-referenceTime;"undefined"!=typeof b?virtualclass.storage.completeStorage(g,void 0,void 0,b):"undefined"==typeof c?virtualclass.storage.completeStorage(g,d):virtualclass.storage.completeStorage(g,d,c);referenceTime=a}}};var ioMissingPackets={executedStore:[],executedSerial:null!=localStorage.getItem("executedSerial")?JSON.parse(localStorage.getItem("executedSerial")):{},missRequest:[],aheadPackets:[],missRequestFlag:0,executedUserStore:[],executedUserSerial:null!=localStorage.getItem("executedUserSerial")?JSON.parse(localStorage.getItem("executedUserSerial")):{},missUserRequest:[],aheadUserPackets:[],missUserRequestFlag:0,validateAllVariables:function(d){if("undefined"==typeof this.executedSerial||null==this.executedSerial)this.executedSerial=
{};"undefined"==typeof this.executedSerial[d]&&(this.executedSerial[d]=-1);"undefined"==typeof this.missRequest[d]&&(this.missRequest[d]=0);"undefined"==typeof this.executedStore[d]&&(this.executedStore[d]=[]);"undefined"==typeof this.aheadPackets[d]&&(this.aheadPackets[d]=[])},validateAllUserVariables:function(d){if("undefined"==typeof this.executedUserSerial||null==this.executedUserSerial)this.executedUserSerial={};"undefined"==typeof this.executedUserSerial[d]&&(this.executedUserSerial[d]=-1);
"undefined"==typeof this.missUserRequest[d]&&(this.missUserRequest[d]=0);"undefined"==typeof this.executedUserStore[d]&&(this.executedUserStore[d]=[]);"undefined"==typeof this.aheadUserPackets[d]&&(this.aheadUserPackets[d]=[])},checkMissing:function(d){var c=d.user.userid;this.validateAllVariables(c);if("t"==d.user.role&&d.m.hasOwnProperty("ping")&&d.m.hasOwnProperty("session")){var b=localStorage.getItem("mySession");if(null!=b&&d.m.session!=b){virtualclass.isPlayMode?localStorage.setItem("mySession",
"thisismyplaymode"):(localStorage.removeItem("mySession"),virtualclass.storage.config.endSession(),localStorage.setItem("mySession",d.m.session),console.log("REFRESH SESSION"));return}}1==d.m.missedpackets?this.fillExecutedStore(d):"undefined"!=typeof d.m.serial&&null!=d.m.serial?d.m.serial==this.executedSerial[c]+1?(console.log("UID "+c+" Object with Serial "+d.m.serial),this.executedSerial[c]=d.m.serial,this.executedStore[c][d.m.serial]=d,ioStorage.dataExecutedStoreAll(d,c+"_"+d.m.serial),this.onRecSave(d),
io.onRecJson(d)):d.m.serial>this.executedSerial[c]+1?(console.log("UID "+c+" requst miss packet"),this.requestMissedPackets(this.executedSerial[c]+1,d.m.serial,d,c)):(console.log("UID "+c+" no action current packet "+this.executedSerial[c]+" coming at "+d.m.serial),this.executedStore[c][d.m.serial]=d):console.log("UID "+c+" checkMissing should not be called without serial")},userCheckMissing:function(d){var c=d.user.userid;this.validateAllUserVariables(c);1==d.m.missedpackets?this.fillExecutedStore(d):
"undefined"!=typeof d.m.userSerial&&null!=d.m.userSerial?d.m.userSerial==this.executedUserSerial[c]+1?(console.log("UID "+c+" Object with userSerial "+d.m.userSerial),this.executedUserSerial[c]=d.m.userSerial,this.onRecSave(d),io.onRecJson(d),this.executedUserStore[c][d.m.userSerial]=d,ioStorage.dataExecutedStoreAll(d,c+"_"+d.m.userSerial)):d.m.userSerial>this.executedUserSerial[c]+1?(console.log("UID "+c+" requst miss packet"),this.userRequestMissedPackets(this.executedUserSerial[c]+1,d.m.userSerial,
d,c)):(console.log("UID "+c+" no action current packet "+this.executedUserSerial[c]+" coming at "+d.m.userSerial),this.executedUserStore[c][d.m.userSerial]=d):console.log("UID "+c+" checkMissing should not be called without userSerial")},requestMissedPackets:function(d,c,b,a){0>d&&(d=0);"use strict";0==this.missRequest[a]?(this.aheadPackets[a].unshift(b.m.serial),this.executedStore[a][b.m.serial]=b,c--,console.log("UID "+a+" request packet from "+d+" to "+c),this.waitAndResetmissRequest(a),ioAdapter.sendUser({reqMissPac:1,
from:d,till:c},a)):(console.log("UID "+a+" ahead packet"+b.m.serial),this.aheadPackets[a].unshift(b.m.serial),this.executedStore[a][b.m.serial]=b)},userRequestMissedPackets:function(d,c,b,a){0>d&&(d=0);"use strict";0==this.missUserRequest[a]?(this.aheadUserPackets[a].unshift(b.m.userSerial),this.executedUserStore[a][b.m.userSerial]=b,c--,console.log("UID "+a+" User request packet from "+d+" to "+c),this.userWaitAndResetmissUserRequest(a),ioAdapter.sendUser({userReqMissPac:1,from:d,till:c},a)):(console.log("UID "+
a+" User ahead packet"+b.m.userSerial),this.aheadUserPackets[a].unshift(b.m.userSerial),this.executedUserStore[a][b.m.userSerial]=b)},waitAndResetmissRequest:function(d){ioMissingPackets.missRequest[d]=1;ioMissingPackets.missRequestFlag=1;setTimeout(function(){ioMissingPackets.missRequest[d]=0;ioMissingPackets.missRequestFlag=0},15E3)},userWaitAndResetmissUserRequest:function(d){ioMissingPackets.missUserRequest[d]=1;ioMissingPackets.missUserRequestFlag=1;setTimeout(function(){ioMissingPackets.missUserRequest[d]=
0;ioMissingPackets.missUserRequestFlag=0},15E3)},sendMissedPackets:function(d){var c=d.user.userid;this.validateAllVariables(c);var b=d.m.from;0>b&&(b=0);b=ioAdapter.adapterMustData.slice(b,d.m.till+1);ioAdapter.sendUser({missedpackets:1,data:b},d.user.userid);console.log("UID "+c+" send packet total chunk length "+b.length)},userSendMissedPackets:function(d){var c=d.user.userid;this.validateAllUserVariables(c);var b=d.m.from;0>b&&(b=0);b=ioAdapter.userAdapterMustData[c].slice(b,d.m.till+1);ioAdapter.sendUser({userMissedpackets:1,
data:b},d.user.userid);console.log("UID "+c+" send packet total chunk length "+b.length)},fillExecutedStore2:function(d){var c=d.user.userid;this.validateAllVariables(c);var b=d.m.data.length,a;for(a=0;a<b;a++)if(null!=d.m.data[a])if("undefined"!=typeof d.m.data[a].m.serial&&null!=d.m.data[a].m.serial){this.executedSerial[c]=d.m.data[a].m.serial;ioStorage.dataExecutedStoreAll(d.m.data[a],c+"_"+d.m.data[a].m.serial);this.onRecSave(d.m.data[a]);d.m.data[a].user=d.user;this.executedStore[c][d.m.data[a].m.serial]=
d.m.data[a];try{console.log("UID "+c+" Object with Serial "+d.m.data[a].m.serial),io.onRecJson(d.m.data[a])}catch(f){console.log("Error "+f)}}else console.log("UID "+c+" Received Packed missing serial");for(this.aheadPackets[c]=this.aheadPackets[c].sort(function(a,b){return b-a});d=this.aheadPackets[c].pop();)if("undefined"!=typeof d&&null!=d)if("undefined"!=typeof this.executedStore[c][d])this.executedSerial[c]=d,this.onRecSave(this.executedStore[c][d]),console.log("UID "+c+" Object with Serial "+
this.executedStore[c][d].m.serial),ioStorage.dataExecutedStoreAll(this.executedStore[c][d],c+"_"+this.executedStore[c][d].m.serial),io.onRecJson(this.executedStore[c][d]);else{console.log("fillExecutedStore undefined");return}else console.log("UID "+c+" ahead Packed missing serial");this.missRequest[c]=0;ioMissingPackets.missRequestFlag=0;virtualclass.vutil.initCommonSortingChat()},fillExecutedStore:function(d){var c=d.user.userid;this.validateAllVariables(c);var b=d.m.data.length,a;for(a=0;a<b;a++)if(null!=
d.m.data[a])if("undefined"!=typeof d.m.data[a].m.serial&&null!=d.m.data[a].m.serial){this.executedSerial[c]=d.m.data[a].m.serial;ioStorage.dataExecutedStoreAll(d.m.data[a],c+"_"+d.m.data[a].m.serial);this.onRecSave(d.m.data[a]);d.m.data[a].user=d.user;this.executedStore[c][d.m.data[a].m.serial]=d.m.data[a];try{console.log("UID "+c+" Object with Serial "+d.m.data[a].m.serial),io.onRecJson(d.m.data[a])}catch(f){console.log("Error "+f)}}else console.log("UID "+c+" Received Packed missing serial");for(this.aheadPackets[c]=
this.aheadPackets[c].sort(function(a,b){return b-a});d=this.aheadPackets[c].pop();)if("undefined"!=typeof d&&null!=d)if("undefined"!=typeof this.executedStore[c][d])this.executedSerial[c]=d,this.onRecSave(this.executedStore[c][d]),console.log("UID "+c+" Object with Serial "+this.executedStore[c][d].m.serial),ioStorage.dataExecutedStoreAll(this.executedStore[c][d],c+"_"+this.executedStore[c][d].m.serial),io.onRecJson(this.executedStore[c][d]);else{console.log("fillExecutedStore undefined");return}else console.log("UID "+
c+" ahead Packed missing serial");this.missRequest[c]=0;ioMissingPackets.missRequestFlag=0;virtualclass.vutil.initCommonSortingChat()},userFillExecutedStore:function(d){var c=d.user.userid;this.validateAllUserVariables(c);0<d.m.data.length||console.log("UID "+c+" empty user data object");var b=d.m.data.length,a;for(a=0;a<b;a++)if(null!=d.m.data[a])if("undefined"!=typeof d.m.data[a].m.userSerial&&null!=d.m.data[a].m.userSerial){this.executedUserSerial[c]=d.m.data[a].m.userSerial;ioStorage.dataExecutedUserStoreAll(d.m.data[a],
c+"_"+d.m.data[a].m.userSerial,d.m.data[a].m.userSerial);this.onRecSave(d.m.data[a]);d.m.data[a].user=d.user;d.m.data[a].userto=d.userto;try{console.log("UID "+c+" Object with user Serial "+d.m.data[a].m.userSerial),io.onRecJson(d.m.data[a])}catch(f){console.log("Error "+f)}this.executedUserStore[c][d.m.data[a].m.userSerial]=d.m.data[a]}else console.log("UID "+c+" Received Packed missing User serial");for(this.aheadUserPackets[c]=this.aheadUserPackets[c].sort(function(a,b){return b-a});d=this.aheadUserPackets[c].pop();)"undefined"!=
typeof d&&null!=d?(this.executedUserSerial[c]=d,this.onRecSave(this.executedUserStore[c][d]),console.log("UID "+c+" Object with Serial "+this.executedUserStore[c][d].m.userSerial),io.onRecJson(this.executedUserStore[c][d])):console.log("UID "+c+" ahead Packed missing serial");this.missUserRequest[c]=0;ioMissingPackets.missUserRequestFlag=0;virtualclass.vutil.initCommonSortingChat()},onRecSave:function(d){var c=JSON.stringify(d);io.onRecSave(d,c)}};var ioAdapter={adapterMustData:[],serial:-1,userSerial:[],userAdapterMustData:[],sendWithDelayIdentifier:{},validateAllVariables:function(d){if("undefined"==typeof this.userSerial||null==this.userSerial)this.userSerial=[];"undefined"==typeof this.userSerial[d]&&(this.userSerial[d]=-1);if("undefined"==typeof this.userAdapterMustData||null==this.userAdapterMustData)this.userAdapterMustData=[];"undefined"==typeof this.userAdapterMustData[d]&&(this.userAdapterMustData[d]=[])},sendWithDelayAndDrop:function(d,
c,b,a,f){null!=d&&null!=b&&(null==a&&(a=0),null==f&&(f=1E3),this.sendWithDelayIdentifier.hasOwnProperty(a)&&ioAdapter.sendWithDelayIdentifier[a]&&(console.log("Cancelling send "+b+" message "+JSON.stringify(d)),clearTimeout(ioAdapter.sendWithDelayIdentifier[a]),ioAdapter.sendWithDelayIdentifier[a]=0),ioAdapter.sendWithDelayIdentifier[a]=setTimeout(function(){console.log("Sending With Delay "+b+" message "+JSON.stringify(d));ioAdapter[b](d);ioAdapter.sendWithDelayIdentifier[a]=0},f))},mustSend:function(d){this.serial++;
d.serial=this.serial;this.adapterMustData[this.serial]={type:"broadcast",m:d};this.send(d);ioStorage.dataAdapterStore({type:"broadcast",user:wbUser.id,m:d},this.serial)},send:function(d){io.send(d,"broadcastToAll",null);ioStorage.sendStore(d,"broadcastToAll")},mustSendAll:function(d){this.mustSendUser(d,virtualclass.gObj.uid);this.mustSend(d)},mustSendUser:function(d,c){this.validateAllVariables(c);"undefined"!=typeof d.serial&&d.serial&&(d.serial=null);this.userSerial[c]++;console.log("USER s.n "+
this.userSerial[c]+" user "+c);d.userSerial=this.userSerial[c];this.userAdapterMustData[c][d.userSerial]={type:"broadcastToAll",m:d};this.sendUser(d,c);ioStorage.dataUserAdapterMustData({type:"broadcastToAll",user:wbUser.id,m:d},c+"_"+d.userSerial)},sendUser:function(d,c){io.send(d,"broadcastToAll",c)},sendPing:function(d){io.send(d,"ping")},sendSpeed:function(d){ioAdapter.sendWithDelayAndDrop(d,null,"realSendSpeed","sendSpeed",1E3)},realSendSpeed:function(d){io.send(d,"speed")},sendBinary:function(d){io.sendBinary(d)}};var ioPingPong={ping:function(d){"member_added"==d.type&&roles.hasAdmin()&&(d={ping:"ping",cf:"pong",session:this.sessionName()},ioAdapter.sendWithDelayAndDrop(d,null,"mustSend","pingAll",3E3),console.log("PING BROADCAST"))},pong:function(d){d.toUser?(console.log("PONG TO "+d.toUser.userid+" from "+d.fromUser.userid),ioAdapter.mustSendUser({ping:"pong",cf:"pongAck"},d.fromUser.userid),console.log("PONG ACK TO "+d.fromUser.userid)):(console.log("PONG BROADCAST from "+d.fromUser.userid),this.verifySession(d))},
pongAck:function(d){console.log("PONG ACK FROM "+d.fromUser.userid)},sessionName:function(){var d=localStorage.getItem("mySession");null===d&&(virtualclass.gObj.hasOwnProperty("doEndSession")&&virtualclass.storage.config.endSession(),d=this.setSession());return d},setSession:function(){var d=randomString(32);console.log("My session is created by setSession");localStorage.setItem("mySession",d);return d},verifySession:function(d){var c=d.message.session,b=localStorage.getItem("mySession");null!=b?
b!==c&&"t"==d.fromUser.role&&this.sessionDestroy(c,d):(console.log("My session is created"),localStorage.setItem("mySession",c))},sessionDestroy:function(d,c){virtualclass.isPlayMode?(console.log("My session is created"),localStorage.setItem("mySession","thisismyplaymode")):(c=c.fromUser.userid,localStorage.removeItem("mySession"),virtualclass.storage.config.endSession(),localStorage.setItem("mySession",d),ioMissingPackets.validateAllVariables(c),console.log("REFRESH SESSION"))}};(function(d){d.virtualclass=function(){SCALE_FACTOR=1.02;var c=null,b=""!=wbUser.virtualclassPlay?parseInt(wbUser.virtualclassPlay,10):0,a=localStorage.getItem("studentSSstatus");a=null!=a?JSON.parse(localStorage.getItem("studentSSstatus")):{sharing:!1,mesharing:!1,shareToAll:!1};return{isPlayMode:b,apps:{wb:"Whiteboard",ss:"ScreenShare",yt:"Yts",er:"EditorRich",ec:"EditorCode",sp:"SharePresentation",poll:"Poll",vid:"Video",ds:"DocumentShare",quiz:"Quiz",mv:"MultiVideo"},appSessionEnd:"virtualclassSessionEnd",
appAudioTest:"virtualclassAudioTest",rWidgetConfig:{id:"virtualclassAppRightPanel"},wb:"",ss:"",wss:"",rw:"",poll:"",quiz:"",raiseHand:"",error:[],pdfRender:{},clearGlobalLock:"",gObj:{uid:d.wbUser.id,uRole:d.wbUser.role,uName:d.wbUser.name,tempReplayObjs:{},commandToolsWrapperId:{},editorInitDone:0,resize:!1,has_ts_capability:1==wbUser.ts||1==wbUser.ts?!0:!1,meetingMode:+wbUser.meetingMode,chromeExt:!1,pdfdebugg:!0,wbInitHandle:!1,wbCount:0,prvWindowSize:!1,wIds:[0],wbRearrang:!1,currSlide:null!=
localStorage.getItem("currSlide")?localStorage.getItem("currSlide"):0,uploadingFiles:[],docOrder:{},fetchedData:!1,wbNavtime:0,studentSSstatus:a,screenRh:60,isReadyForVideo:!0,defaultApp:"Whiteboard",tempQueue:{}},enablePreCheck:!0,clearSession:function(){d.pageEnter=(new Date).getTime();virtualclass.vutil.beforeSend({sEnd:!0,cf:"sEnd"},null,!0);"object"==typeof virtualclass.videoUl&&"object"==typeof virtualclass.videoUl.player&&"undefined"!=typeof virtualclass.videoUl.player.dispose&&virtualclass.videoUl.player.dispose();
virtualclass.storage.config.endSession();virtualclass.hasOwnProperty("prevScreen")&&virtualclass.prevScreen.hasOwnProperty("currentStream")&&virtualclass.prevScreen.unShareScreen();virtualclass.previrtualclass="virtualclass"+virtualclass.gObj.defaultApp},init:function(a,b,c){a=d.wbUser;virtualclass.uInfo={userid:a.id,sid:a.sid,rid:a.path,authuser:a.auth_user,authpass:a.auth_pass,userobj:{userid:a.id,name:a.name,lname:a.lname,img:a.imageurl,role:null!=localStorage.getItem("uRole")?localStorage.getItem("uRole"):
a.role},room:a.room};this.gObj.congCourse=typeof("undefiend"!=d.congCourse)?d.congCourse:0;this.wbConfig={id:"virtualclass"+virtualclass.apps.wb,classes:"appOptions"};this.ssConfig={id:"virtualclass"+virtualclass.apps.ss,classes:"appOptions"};this.edConfig={id:"virtualclass"+virtualclass.apps.er,classes:"appOptions"};this.edCodeConfig={id:"virtualclass"+virtualclass.apps.ec,classes:"appOptions"};this.ptConfig={id:"virtualclass"+virtualclass.apps.sp,classes:"appOptions"};this.plConfig={id:"virtualclass"+
virtualclass.apps.poll,classes:"appOptions"};this.viConfig={id:"virtualclass"+virtualclass.apps.vid,classes:"appOptions"};this.dtsConfig={id:"virtualclass"+virtualclass.apps.ds,classes:"appOptions"};this.qzConfig={id:"virtualclass"+this.apps.quiz,classes:"appOptions"};this.mvConfig={id:"virtualclass"+this.apps.mv,classes:"appOptions"};this.user=new d.user;this.vutil=d.vutil;this.media=d.media;this.sharePt=d.sharePt;this.fineUploader=d.fineUploader;this.system=d.system;this.recorder=d.recorder;this.converter=
d.converter;this.clear="";this.currApp=this.vutil.capitalizeFirstLetter(b);this.storage=d.storage;this.dashBoard=dashBoard;this.multiVideo=d.MultiVideo;this.vutil.isChromeExtension();this.wbCommon=d.wbCommon;this.system.isIndexedDbSupport()?this.storage.init(function(){virtualclass.vutil.isPlayMode()||ioStorage.completeStorage(JSON.stringify(virtualclass.uInfo))}):console.log("Indexeddb does not support");virtualclass.modernizr=Modernizr;this.system.webpInit();this.dirtyCorner=d.dirtyCorner;this.html.init(this);
this.adapter=d.adapter;virtualclass.system.mybrowser.hasOwnProperty("name")||this.system.setBrowserDetails();virtualclass.api=d.api;virtualclass.vutil.initOnBeforeUnload(virtualclass.system.mybrowser.name);virtualclass.xhr=d.xhr;virtualclass.xhr.init();virtualclass.xhrn=d.xhrn;virtualclass.xhrn.init();this.xhrn.getAcess(function(a){"ERROR"==a&&"Error"==a||console.log("get access")});virtualclass.chat=new Chat;virtualclass.chat.init();virtualclass.dtCon=virtualclass.converter();virtualclass.pbar=progressBar;
virtualclass.editorRich=d.editor("editorRich","virtualclassEditorRich","virtualclassEditorRichBody");virtualclass.editorCode=d.editor("editorCode","virtualclassEditorCode","virtualclassEditorCodeBody");virtualclass.yts=d.yts();virtualclass.poll=d.poll();virtualclass.quiz=d.quiz();virtualclass.videoUl=d.videoUl();virtualclass.videoHost=d.videoHost;virtualclass.precheck=d.precheck;virtualclass.page=page;virtualclass.zoom=d.zoomWhiteboard();virtualclass.network=new Network;this.serverData=serverData;
roles.hasControls()&&this.serverData.fetchAllData();null!=localStorage.uRole&&(virtualclass.gObj.uRole=localStorage.uRole,document.getElementById("virtualclassCont").classList.add(virtualclass.vutil.getClassName(virtualclass.gObj.uRole)));"undefined"==typeof c||null==c?this.makeAppReady(b,"byclick"):this.makeAppReady(b,"byclick",c);this.system.check();this.vutil.isSystemCompatible();this.system.mediaDevices.getMediaDeviceInfo();b==virtualclass.apps.ss&&this.system.setAppDimension();virtualclass.vutil.createReclaimButtonIfNeed();
virtualclass.user.assignRole(virtualclass.gObj.uRole,b);this.gObj.video=new d.virtualclass.media;this.gObj.video.audioVisual.init();b=localStorage.getItem("precheck");null!=b&&(b=JSON.parse(b));virtualclass.makePreCheckAvailable?virtualclass.precheck.init():virtualclass.makeReadySocket();virtualclass.gObj.precheckScrn=!1;virtualclass.gObj.meetingMode||virtualclass.videoHost.init(320,240);virtualclass.vutil.videoController();virtualclass.gObj.has_ts_capability&&!virtualclass.vutil.isPlayMode()&&virtualclass.vutil.initTechSupportUi();
b=document.getElementById("precheckSetting");b.addEventListener("click",function(){virtualclass.gObj.precheckScrn=!0;virtualclass.precheck.init(virtualclass.precheck)});this.raiseHand=d.raiseHand;this.raiseHand.init();this.appSetting=d.appSetting;this.appSetting.init();this.appSettingMedia=d.appSettingMedia;virtualclass.colorSelector=d.colorSelector;virtualclassSetting.theme.selectedColor&&this.colorSelector.makeThemeReady()},makeReadySocket:function(){if(!virtualclass.vutil.isPlayMode())var a=this,
b=setInterval(function(){2<=a.gObj.editorInitDone&&(a.initSocketConn(),clearInterval(b))},100)},initSocketConn:function(){this.system.webSocket&&(io.init(virtualclass.uInfo),d.userdata=virtualclass.uInfo)},html:{id:"virtualclassCont",optionsClass:"appOptions",init:function(a){this.virtualclass=a},leftAppBar:function(){if(!(0<document.getElementsByClassName("appOptions").length)){document.querySelector("#virtualclassApp #virtualclassAppLeftPanel");var a=virtualclass.getTemplate("appTools")();virtualclass.vutil.insertAppLayout(a);
virtualclass.gObj.hasOwnProperty("errNotScreenShare")&&virtualclass.view.disableSSUI();virtualclass.gObj.hasOwnProperty("errAppBar")&&virtualclass.view.disableLeftAppBar()}},createDiv:function(a,b,c,d,n){var f=document.createElement("a");f.href="#";var g=document.createElement("div");g.id=a;"undefined "!=typeof d&&(g.className=d);d=document.createElement("span");d.className="icon-"+b;f.appendChild(d);f.dataset.title=virtualclass.lang.getString(b);f.className="tooltip";"virtualclassWhiteboardTool"==
a&&(f.dataset.doc="_doc_0_"+virtualclass.gObj.wbCount);g.appendChild(f);"undefined"!=typeof n?(n=document.getElementById("virtualclassScreenShareTool"),c.replaceChild(g,n)):c.appendChild(g)},createElement:function(a,b,c){a=document.createElement(a);"undefined"!=typeof b&&(a.id=b);if("undefined"!=typeof c&&1<c.length)for(b=0;b<c.length;b++)a.className+=c[b]+" ";return a}},dispvirtualclassLayout:function(a){if("undefined"!=typeof this.previous)if(this.previous.toUpperCase()!=("virtualclass"+this.currApp).toUpperCase()){var b=
document.getElementById(virtualclass.previous);null!=b&&(b.style.display="none");"undefined"!=typeof a?("EDITORRICH"==a.toUpperCase()?(b=document.getElementById("virtualclassEditorCode"),null!=b&&(b.style.display="none")):console.log("EditorRich can not be display:none "+a),"EDITORCODE"==a.toUpperCase()?(b=document.getElementById("virtualclassEditorRich"),null!=b&&(b.style.display="none")):console.log("EditorCode can not be display:none "+a)):console.log("appId "+a+" undefined")}else{b=document.getElementById("virtualclassCont").getElementsByClassName("virtualclass");
for(var c=0;c<b.length;c++)b[c].style.display="none"}"undefined"!=typeof a&&(a="virtualclass"+(a.charAt(0).toUpperCase()+a.slice(1)));b=document.getElementById(a);null!=b&&(b.style.display="block",console.log("App "+a+" block"))},makeAppReady:function(a,b,c){virtualclass.dashBoard.close();console.log("Application is ready"+a);this.view=d.view;this.currApp=virtualclass.vutil.capitalizeFirstLetter(a);console.log("Current App init "+this.currApp);a!=virtualclass.apps.ss&&virtualclass.hasOwnProperty("previrtualclass")&&
roles.hasControls()&&virtualclass.vutil.makeActiveApp("virtualclass"+a,virtualclass.previrtualclass);if("undefined"!=typeof this.previous&&("virtualclassEditorRich"==this.previous||"virtualclassEditorCode"==this.previous)){var f=this.previous.split("virtualclass")[1];this.user.control.toggleDisplayEditorController(f,"none")}a!=virtualclass.apps.ss&&(this.dispvirtualclassLayout(a),document.getElementById("virtualclassCont").dataset.currapp=this.currApp);"undefined"!=typeof this.prevScreen&&this.prevScreen.hasOwnProperty("currentStream")&&
this.prevScreen.unShareScreen();if("SharePresentation"==a)"virtualclass"+a!=virtualclass.previous&&this.appInitiator[a].apply(virtualclass,Array.prototype.slice.call(arguments));else if("DocumentShare"==a)this.appInitiator[a].apply(virtualclass,Array.prototype.slice.call(arguments)),roles.hasControls()&&(virtualclass.dts.firstRequest?virtualclass.vutil.triggerDashboard(a,"hidepopup"):virtualclass.vutil.triggerDashboard(a)),system.initResize();else{f=localStorage.getItem("prevApp");if(null!=f){var g=
JSON.parse(f);"SharePresentation"==g.name&&(g.name="",localStorage.setItem("prevApp",JSON.stringify(g)))}if("Whiteboard"==a){var h=[];for(g=0;g<arguments.length;g++)h.push(arguments[g]);"undefined"==typeof b&&(h[1]=b);h[2]="undefined"!=typeof c?"_doc_"+c:"_doc_0_"+virtualclass.gObj.currSlide;h.push("virtualclassWhiteboard");this.appInitiator[a].apply(virtualclass,Array.prototype.slice.call(h));f=JSON.parse(f);virtualclass.gObj.wbRearrang||null==f||null==localStorage.getItem("currSlide")||(h=localStorage.getItem("wIds"),
h=JSON.parse(h),null!=h&&0<h.length&&(virtualclass.wbCommon.readyElements(h),virtualclass.gObj.hasOwnProperty("currSlide")&&-1==h.indexOf(virtualclass.gObj.currSlide)&&(console.log("wids, From virtualclass "),h.push(virtualclass.gObj.currSlide)),virtualclass.wbCommon.reArrangeElements(h),virtualclass.gObj.wbRearrang=!0,virtualclass.gObj.wIds=h));virtualclass.wbCommon.identifyFirstNote(virtualclass.gObj.currWb);system.initResize()}else f=Array.prototype.slice.call(arguments)[2],this.appInitiator[a].apply(virtualclass,
Array.prototype.slice.call(arguments)),f&&f.init&&f.init.videoUrl&&f.fromReload&&(h=!0),roles.hasControls()&&"Video"==a&&("virtualclass"+a!=virtualclass.previous&&(f=document.querySelector("#dashboardnav button"),null!=f&&(f.setAttribute("data-currapp","Video"),f.classList.contains("clicked")&&f.classList.remove("clicked"))),virtualclass.vutil.triggerDashboard(a,h))}this.previrtualclass=this.previous;a!=virtualclass.apps.wb&&a!=virtualclass.apps.ss&&virtualclass.system.setAppDimension();if("Video"!=
a&&virtualclass.hasOwnProperty("videoUl")){virtualclass.videoUl.videoUrl="";virtualclass.videoUl.videoId="";(h=document.getElementById("dispVideo_Youtube_api"))&&h.contentWindow&&h.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*");if(h=document.querySelector(".congrea #dispVideo"))h.style.display="none",(h=document.querySelector(".congrea #dispVideo video"))&&h.setAttribute("src","");$(".congrea #listvideo .playing").removeClass("playing");$(".congrea #listvideo .removeCtr").removeClass("removeCtr");
"object"==typeof virtualclass.videoUl.player&&delete virtualclass.videoUl.player}roles.hasControls()&&(f=Array.prototype.slice.call(arguments)[2],"SharePresentation"==virtualclass.currApp||"Video"==virtualclass.currApp?(virtualclass.vutil.initDashboardNav(f),"Video"==virtualclass.currApp?console.log("currApp "+virtualclass.currApp):virtualclass.sharePt.localStoragFlag||(f=document.querySelector("#dashboardnav button"),null!=f&&f.click())):"DocumentShare"!=virtualclass.currApp&&virtualclass.vutil.removeDashboardNav())},
appInitiator:{Whiteboard:function(a,b,c,m){"Whiteboard"==virtualclass.currApp&&"virtualclassWhiteboard"!=virtualclass.previous&&virtualclass.view.window.resize(c);"object"==typeof this.ss&&(this.ss.prevStream=!1);"undefined"!=typeof this.previous&&"undefined"!=typeof b&&"byclick"==b&&roles.hasControls()&&"Whiteboard"==virtualclass.currApp&&(b=c.split("_doc_")[1],virtualclass.vutil.beforeSend({dispWhiteboard:!0,cf:"dispWhiteboard",d:b}));virtualclass.gObj.currWb=c;"object"!=typeof this.pdfRender[c]?
this.pdfRender[c]=d.pdfRender():("Whiteboard"==virtualclass.currApp||"DocumentShare"==virtualclass.currApp)&&virtualclass.zoom.normalRender();roles.isStudent()&&"Whiteboard"==virtualclass.currApp&&virtualclass.wbCommon.setCurrSlideNumber(c);if("undefined"!=typeof c){if("object"!=typeof this.wb[c])if("object"!=typeof this.wb&&(this.wb={}),virtualclass.gObj.commandToolsWrapperId[c]="commandToolsWrapper"+c,this.wb[c]={},virtualclass.gObj.tempReplayObjs[c]=[],this.wb[c]=new d.whiteboard(this.wbConfig,
c),null!=this.gObj.tempQueue[c]&&(this.wb[c].gObj.queue=this.gObj.tempQueue[c].slice(),this.gObj.tempQueue[c]=null),"Whiteboard"==virtualclass.currApp?(b=document.querySelector("#virtualclassWhiteboard .whiteboardContainer"),virtualclass.gObj.wbInitHandle||(virtualclass.wbCommon.initNavHandler(),virtualclass.gObj.wbInitHandle=!0)):b=document.getElementById("cont"+c),null!=b){if(null==document.querySelector("vcanvas"+c)){m=virtualclass.getTemplate("main","whiteboard");if("Whiteboard"==virtualclass.currApp){virtualclass.wbCommon.hideElement();
var f="note"+c,g=document.querySelector("#"+f);null!=g?(g.classList.add("canvasContainer","current"),m=m({cn:c,hasControl:roles.hasControls()}),g.innerHTML=m):(m="<div id='"+f+"' data-wb-id='"+c+"' class='canvasContainer current'>"+m({cn:c,hasControl:roles.hasControls()})+"</div>","_doc_0_0"!=c?b.insertAdjacentHTML("beforeend",m):(b.innerHTML=m,g=document.querySelector("#note_doc_0_0"),null!=g&&g.classList.add("current")))}else m=m({cn:c,hasControl:roles.hasControls()}),b.innerHTML=m;g=document.querySelector("#canvas"+
c)}this.wb[c].utility=new d.utility;this.wb[c].alreadyReplay=!1;this.wb[c].packContainer=new d.packContainer;this.wb[c].draw_object=d.draw_object;this.wb[c].makeobj=d.makeobj;this.wb[c].readyFreeHandObj=d.readyFreeHandObj;this.wb[c]._replay=_replay;this.wb[c].readyTextObj=d.readyTextObj;this.wb[c].bridge=d.bridge;this.wb[c].response=d.response;virtualclass.wb[c].utility.displayCanvas(c);b=virtualclass.wb[c].vcan;roles.hasControls()&&(virtualclass.wb[c].utility.setOrginalTeacherContent(a),virtualclass.wb[c].attachToolFunction(virtualclass.gObj.commandToolsWrapperId[c],
!0,c),a=b.utility.canvasCalcOffset(b.main.canid),console.log("whietboard offset x="+a.x+"  y="+a.y));"DocumentShare"==virtualclass.currApp?virtualclass.pdfRender[c].init(g,virtualclass.dts.docs.note.currNote):virtualclass.pdfRender[c].init(g);virtualclass.storage.getWbData(c,function(){console.log("The data has been received from local storage")})}else alert("whiteboard container is null");else a="commandToolsWrapper"+c,null==document.getElementById("commandToolsWrapper"+c)&&roles.hasControls()&&
virtualclass.wb[c].attachToolFunction(a,!0,c);b=virtualclass.wb[c].vcan;null!=document.getElementById("canvas"+c)&&(b.utility.canvasCalcOffset(b.main.canid),0==this.gObj.tempReplayObjs[c].length&&virtualclass.wb[c].utility.makeCanvasEnable());"virtualclassScreenShare"==this.previous&&roles.hasControls()&&(virtualclass.vutil.dimensionMatch("virtualclassWhiteboard","virtualclassScreenShare")||virtualclass.wb[c].utility.lockvirtualclass());this.previous=this.wbConfig.id;roles.hasControls()&&virtualclass.gObj.resize&&
virtualclass.wb[c].utility.lockvirtualclass()}else alert("id is undefined");virtualclass.zoom.init()},ScreenShare:function(a){"object"!=typeof this.ss&&(this.ss=new d.screenShare(virtualclass.ssConfig));this.ss.init({type:"ss",app:a})},Yts:function(a,b,c){"undefined"!=typeof c&&null!=c?virtualclass.yts.init(c,c.startFrom):null==document.querySelector("iframe#player")&&virtualclass.yts.init();this.previous=virtualclass.ytsConfig.id},EditorRich:function(a){this.appInitiator.editor.call(virtualclass,
a)},EditorCode:function(a){this.appInitiator.editor.call(virtualclass,a)},SharePresentation:function(a,b){"object"==typeof this.ss&&(this.ss.prevStream=!1);this.sharePt=new d.sharePt;console.log(virtualclass.sharePt.pptUrl);this.sharePt.init(a,b);console.log(virtualclass.sharePt.pptUrl);this.previous=virtualclass.ptConfig.id;virtualclass.sharePt.attachMessageEvent("message",virtualclass.sharePt.pptMessageEventHandler)},Poll:function(a){virtualclass.poll.init()},Quiz:function(a){virtualclass.quiz.init()},
Video:function(a,b,c){"undefined"!=typeof c&&null!=c?"undefined"==typeof c.type?virtualclass.videoUl.init(c,c.startFrom):"video_yts"==c.type?(virtualclass.videoUl.init(),virtualclass.yts.init(c,c.startFrom)):virtualclass.videoUl.init():virtualclass.videoUl.init()},editor:function(a){this.user.control.toggleDisplayEditorController(a.substring(a.indexOf("virtualclass"),a.length),"block");var b=[];a==virtualclass.apps.er?(virtualclass.editorRich.init(0,b,"",""),this.previous=virtualclass.edConfig.id):
(virtualclass.editorCode.init(0,b,"",""),this.previous=virtualclass.edCodeConfig.id);b=JSON.parse(localStorage.getItem(virtualclass.vutil.smallizeFirstLetter(a)));var c=virtualclass.vutil.smallizeFirstLetter(a);roles.hasAdmin()||(null==b?(this[c].cm.setOption("readOnly","nocursor"),this.user.control.toggleDisplayWriteModeMsgBox(a,!1),console.log("message box is created "+a)):(this.user.control.toggleDisplayWriteModeMsgBox(a,b),b?this[c].cm.setOption("readOnly",!1):this[c].cm.setOption("readOnly",
"nocursor")),virtualclass.vutil.setReadModeWhenTeacherIsDisConn(c))},makeReadyDsShare:function(a,b,c){virtualclass.dts.docs.hasOwnProperty("currDoc")?(roles.hasControls()&&(ioAdapter.mustSend({dts:{init:"studentlayout"},cf:"dts"}),console.log("doc share current"),virtualclass.dts.sendCurrentDoc(),virtualclass.dts.sendCurrentSlide()),a=virtualclass.dts.docs.currNote,"undefined"!=typeof a&&virtualclass.vutil.updateCurrentDoc(a)):"undefined"!=typeof c?setTimeout(function(){virtualclass.dts.init(c)},
1E3):virtualclass.dts.init();virtualclass.previous=virtualclass.dtsConfig.id},DocumentShare:function(a,b,h){virtualclass.hasOwnProperty("dts")&&null!=virtualclass.dts?virtualclass.dts.firstRequest=!1:virtualclass.dts=d.documentShare();var f=[];"undefined"!=typeof a&&f.push(a);"undefined"!=typeof b&&f.push(b);"undefined"!=typeof h&&f.push(h);var g=virtualclass;virtualclass.gObj.hasOwnProperty("docs")?(g.appInitiator.makeReadyDsShare.apply(g.appInitiator,f),virtualclass.vutil.initDashboardNav(),virtualclass.dts.firstRequest||
virtualclass.dts.noteExist()||(a=document.querySelector("#dashboardnav button"),null!=a&&a.click()),null!=c&&clearTimeout(c),null!=virtualclass.gObj.currWb&&"undefined"!=typeof virtualclass.pdfRender[virtualclass.gObj.currWb]&&"DocumentShare"==virtualclass.currApp&&virtualclass.pdfRender[virtualclass.gObj.currWb].hasOwnProperty("page")&&null!=virtualclass.pdfRender[virtualclass.gObj.currWb].page&&virtualclass.zoom.normalRender()):c=setTimeout(function(){"DocumentShare"==virtualclass.currApp&&g.appInitiator.DocumentShare.apply(g.appInitiator,
f)},100);(a=document.querySelector("#virtualclassAppLeftPanel .zoomControler .reloadNote span"))&&a.setAttribute("data-title",virtualclass.lang.getString("reloadDoc"))},MultiVideo:function(){var a=this;a.multiVideo.hasOwnProperty("initDone")?a.multiVideo._init():setTimeout(function(){a.appInitiator.MultiVideo.apply(virtualclass)},2E3);this.previous=virtualclass.mvConfig.id}},attachFunction:function(){for(var a=document.getElementsByClassName("appOptions"),b=0;b<a.length;b++){var c=a[b].getElementsByTagName("a")[0];
if("virtualclassEditorCodeTool"!=a[b].id){var d=this;clickedAnchor=c;c.onclick=function(){d.initlizer(this)}}}},initlizer:function(a){a=a.parentNode.id.split("virtualclass")[1];"SessionEndTool"==a?virtualclass.popup.confirmInput(virtualclass.lang.getString("savesession"),function(a){a?(ioStorage.completeStorage(void 0,void 0,"sessionend"),setTimeout(function(){virtualclass.enablePreCheck=!1;virtualclass.recorder.hasOwnProperty("recordDone")&&(console.log("deleete recordDone"),delete virtualclass.recorder.recordDone);
virtualclass.recorder.alreadyDownload=!1;virtualclass.getContent=!0;virtualclass.vutil.beforeSend({sEnd:!0,cf:"sEnd"});virtualclass.recorder.smallData=!0;io.sock.close();virtualclass.recorder.startUploadProcess()},300)):virtualclass.popup.confirmInput(virtualclass.lang.getString("startnewsession"),function(a){a?(virtualclass.clearSession(),virtualclass.gObj.hasOwnProperty("beTeacher")&&roles.isTeacher()&&localStorage.setItem("uRole","t")):console.log("Not start new session")})}):(a=a.substring(0,
a.indexOf("Tool")),this.PrvAndCurrIsWss(this.previous,a)?alert(virtualclass.lang.getString("screensharealready")):("DocumentShare"==virtualclass.currApp&&(virtualclass.gObj.screenRh=160),this.makeAppReady(a,"byclick"),setTimeout(function(){virtualclass.gObj.screenRh=60},1500)));"ScreenShare"!=a&&virtualclass.vutil.removeClass("audioWidget","fixed")},PrvAndCurrIsWss:function(a,b){return"virtualclassWholeScreenShare"==a&&b==virtualclass.apps.yt?!0:!1},prvCurrUsersSame:function(){var a=localStorage.getItem("prvUser");
if(null==a)virtualclass.setPrvUser();else if(a=JSON.parse(a),a.id!=wbUser.id||a.room!=wbUser.room)virtualclass.gObj.sessionClear=!0,virtualclass.setPrvUser(),roles.hasControls()&&localStorage.setItem("uRole",this.gObj.uRole)},setPrvUser:function(){localStorage.clear();localStorage.setItem("prvUser",JSON.stringify({id:wbUser.id,room:wbUser.room}))},registerPartial:function(){for(var a={whiteboardPath:whiteboardPath},b="precheck teacherVideo audioWidget appTools popupCont appToolsMeeting appSettingDetail".split(" "),
c={hasControl:roles.hasControls()},d,n=0;n<b.length;n++){d=null;if("precheck"==b[n]||"popupCont"==b[n])d=a;else if("audioWidget"==b[n])d=virtualclassSetting,d.isControl=roles.hasControls(),d.isMettingMode=virtualclass.gObj.meetingMode&&roles.isStudent();else if("teacherVideo"==b[n]||"appTools"==b[n]||"appSettingDetail"==b[n])d=c;this.makeReadyTemplate(b[n],d)}Handlebars.registerPartial({docNotesMain:this.getTemplate("notesMain","documentSharing"),whiteboardToolbar:this.getTemplate("toolbar","whiteboard"),
rightBar:this.getTemplate("rightBar"),recordingControl:this.getTemplate("recordingControl"),leftBar:this.getTemplate("leftBar"),main:this.getTemplate("main"),whiteboard:this.getTemplate("main","whiteboard"),dashboardCont:this.getTemplate("dashboardCont"),multiVideo:this.getTemplate("multiVideo")})},registerHelper:function(){Handlebars.registerHelper("getString",function(a){return virtualclass.lang.getString(a)});Handlebars.registerHelper("debug",function(a){console.log("Current Context");console.log("====================");
console.log(this);a&&(console.log("Value"),console.log("===================="),console.log(a))});Handlebars.registerHelper("getVideoType",function(a){return virtualclass.gObj.meetingMode?"multiVideo":"teacherVideo"})},createMainContainer:function(){var a=document.querySelector("#"+virtualclass.html.id);this.registerHelper();this.registerPartial();var b=this.getTemplate("main"),c={isPlay:virtualclass.isPlayMode,hasControls:roles.hasControls(),meetingMode:virtualclass.gObj.meetingMode};b=b(c);a.insertAdjacentHTML("afterbegin",
b)},makeReadyTemplate:function(a,b){Handlebars.registerPartial(a,(0,JST["templates/"+a+".hbs"])(b))},getTemplate:function(a,b){return"undefined"==typeof b?JST["templates/"+a+".hbs"]:JST["templates/"+b+"/"+a+".hbs"]}}}})(window);(function(d,c){d.Vcan=function(){var b={create:function(a){if("#"==a.charAt(0)){var c=a.substring(1,a.length);b.utility.canvasCalcOffset(c);return new b.main(a)}console.log("there is a problem with canvas id")},main:function(a){b.main.children=[];b.main.id=0;b.main.uid=0;b.main.canvas=c.querySelector(a);b.main.canid=a.substring(1,a.length);b.main.currentTransform="";b.main.replayObjs=[];b.main.dragMode=!1;b.main.scaleMode=!1;b.main.usrCurrAction="";b.main.currObj="";b.main.textObj=!1;b.main.action=
"create";b.wb={};b.wb.sentPack=!1;b.activMouse=new b.mouse;b.activMouse.init()},extend:function(a,b){if("object"==typeof a&&"object"==typeof b){for(var c in b)a[c]=b[c];return a}console.log("it seems that the arguments you passed are not object")},transform:function(a,b){a.translate(b.x,b.y);a.rotate(b.theta);a.scale(b.scaleX*(b.flipX?-1:1),b.scaleY*(b.flipY?-1:1))},getStates:function(a){return b.main[a]},setValInMain:function(a,c){return b.main[a]=c},ArrayIndexOf:function(a,b){if(!b||"function"!=
typeof b||!a||!a.length||1>a.length)return-1;for(var c=0;c<a.length;c++)if(b(a[c]))return c;return-1},renderAll:function(a){"object"!=typeof a&&(a=b.main.canvas.getContext("2d"));b.clearContext(a);this.displayPdfWhiteboard()},normalDisplay:function(a){console.log("Whiteboard index "+a);"freeDrawing"==b.main.children[a].type?b.fhdRender(ctx,b.main.children[a]):b.render(ctx,b.main.children[a])},displayPdfWhiteboard:function(){var a=b.main.children.length;if(a)for(var c=b.main.canvas.getContext("2d"),
g=0;g<a;++g)"pdf"==b.main.children[g].type?console.log("Pdf, Render the data, that should not be a"):"freeDrawing"==b.main.children[g].type?b.fhdRender(c,b.main.children[g]):b.render(c,b.main.children[g])},clearContext:function(a){var c=b.main.canvas;a.clearRect(0,0,c.width,c.height);return c},deactivateAll:function(){for(var a=b.main.children,c=0,g=a.length;c<g;c++)a[c].setActive(!1)},makeDispObject:function(a){return{coreObj:a,bind:function(a,b){this.addEventListener("on"+a,b)}}},remove:function(a){var c=
b.main.canvas,g=b.ArrayIndexOf(b.main.children,function(b){return b.id==a.id&&(b.mt==a.mt||1==a.multiuser)});0<=g&&b.main.children.splice(g,1);g=c.height;var h=c.width;c=c.getContext("2d");c.beginPath();c.clearRect(0,0,h,g);c.closePath();b.renderAll()},render:function(a,c,g){a.beginPath();a.save();a.lineWidth=void 0!==a.lineWidth?c.lineWidth:2;g||b.transform(a,c);a.strokeStyle=void 0!=c.borderColor?c.borderColor:"#000000";"rectangle"==c.type?b.objRect.draw(a,c,g):"line"==c.type?b.objLine.draw(a,c,
g):"oval"==c.type?b.objOval.draw(a,c,g):"triangle"==c.type?b.objTri.draw(a,c,g):"text"==c.type&&b.objTxt.draw(a,c,g);c.active&&!g&&(c.drawBorders(a),c.hideCorners||c.drawCorners(a));a.closePath();a.restore()},fhdRender:function(a,c,g){a.save();var f=c.transformMatrix;f&&a.transform(f[0],f[1],f[2],f[3],f[4],f[5]);g||b.transform(a,c);c.overlayFill?a.fillStyle=c.overlayFill:c.fill&&(a.fillStyle=c.fill);c.stroke&&(a.strokeStyle=c.stroke);a.beginPath();for(var d,n=-(c.width/2),r=-(c.height/2),A=0,z=c.path.length;A<
z;++A)switch(d=c.path[A],d[0]){case "L":f=d[1];d=d[2];a.lineTo(f+n,d+r);break;case "M":f=d[1],d=d[2],a.moveTo(f+n,d+r)}c.fill&&a.fill();c.stroke&&(a.strokeStyle=c.stroke,a.lineWidth=c.strokeWidth,a.lineCap=a.lineJoin="round",a.stroke());!g&&c.active&&(c.drawBorders(a),c.hideCorners||c.drawCorners(a));a.restore()},makeStackObj:function(a,b,c,h){return{mt:a,ac:b,x:c,y:h}}};return b}})(window,document);(function(d,c){d.whiteboard=function(b,a){console.log("Whiteboard new one");var f=b.hasOwnProperty("id")?b.id:"appWhitebaordCont";b=b.hasOwnProperty("class");"object"!=typeof virtualclass.wb[a].vcan&&(virtualclass.wb[a].vcan=new d.Vcan,d.vcanUtility(a),d.vcanMain(a),d.Events(a),d.Virtualbox(a),d.Interact(a),d.Rectangle(a),d.Oval(a),d.Triangle(a),d.Text(a),d.Line(a),d.FreeHandDrawing(a),d.Path(a),d.Mouse(a),d.Optimize(a));return{id:f,classes:b,tool:"",obj:{},prvObj:"",replayTime:0,uid:0,lt:"",view:{},
lang:{},system:{},user:{},gObj:{myrepObj:[],replayObjs:[],myArr:[],displayedObjId:0,packQueue:[],queue:[],virtualWindow:!1},vcan:virtualclass.wb[a].vcan,init:function(a){var b=virtualclass.wb[a].vcan;virtualclass.wb[a].canvas=b.create("#canvas"+a);b.main.canvas.setAttribute("tabindex","0");d.onkeydown=virtualclass.wb[a].utility.keyOperation;virtualclass.system.setAppDimension(a);"undefined"!==typeof Storage&&(d.virtualclass.wb[a]=virtualclass.wb[a]);this.arrowInit();this._init(a)},_init:function(a){virtualclass.wb[a].oTeacher=
roles.hasAdmin();virtualclass.vutil.chkValueInLocalStorage("rcvdPackId")?virtualclass.wb[a].gObj.rcvdPackId=parseInt(localStorage.rcvdPackId):virtualclass.wb[a].gObj.rcvdPackId=0;d.addEventListener("click",function(){virtualclass.view.disappearBox("WebRtc");virtualclass.view.disappearBox("Canvas");virtualclass.view.disappearBox("drawArea")});virtualclass.wb[a].utility.crateCanvasDrawMesssage(a)},UI:{mainContainer:function(a,b){a=c.querySelector("#"+a);if(null!=a){var f=c.createElement("div");f.id=
"vcanvas"+b;f.className="vcanvas";f.dataset.wbId=b;var g=c.createElement("div");g.id="containerWb"+b;g.className="containerWb";f.appendChild(g);a.appendChild(f)}else alert("container is null")}},arrowInit:function(){this.arrImg=new Image;this.arrImg.src="undefined"!=typeof d.whiteboardPath?d.whiteboardPath+"/images/arrow.png":"/images/arrow.png";this.arrImgDraw=!1;var a=this;this.arrImg.onload=function(){a.arrImgDraw=!0}},createCommand:function(a,b){if((a=virtualclass.wb[b].utility.alreadyExistToolBar(b))||
null!=localStorage.getItem("educator")&&localStorage.reclaim)return!0;a=virtualclass.getTemplate("toolbar","whiteboard")({cn:b});b=c.getElementById("containerWb"+b);null!=b&&b.insertAdjacentHTML("afterbegin",a)},createCommandWrapper:function(){var a=c.createElement("div");a.id=virtualclass.gObj.commandToolsWrapperId;var b=c.getElementById(vcan.canvasWrapperId);null!=b?c.getElementById("containerWb").insertBefore(a,b):c.getElementById("containerWb").appendChild(a);return a},createCanvas:function(a){virtualclass.wb[a].vcan.canvasWrapperId=
cmdToolsWrapper.id},objInit:function(a){"undefined"!=typeof virtualclass.wb[virtualclass.gObj.currWb]&&""!=virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj&&"undefined"!=typeof virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj&&0>this.parentNode.id.indexOf("t_text")&&0<c.querySelectorAll(".canvasWrapper .textBoxContainer").length&&virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.finalizeTextIfAny();a=virtualclass.vutil.getWhiteboardId(this.parentNode);var b=virtualclass.wb[a].vcan;
roles.hasControls()&&this.parentNode.id!="t_clearall"+a&&virtualclass.wb[a].utility.makeActiveTool(this.parentNode.id);this.parentNode.id=="t_replay"+a?(virtualclass.wb[a].utility.clearAll(!1),virtualclass.vutil.beforeSend({replayAll:!0,cf:replayAll})):virtualclass.wb[a].toolInit(this.parentNode.id,a);if(this.parentNode.id!="t_replay"+a&&this.parentNode.id!="t_clearall"+a&&this.parentNode.id!="t_reclaim"+a&&this.parentNode.id!="t_assign"+a){var f=(new Date).getTime();virtualclass.wb[a].lt=this.parentNode.id;
f={cmd:this.parentNode.id.split(/_doc_*/)[0],mt:f};virtualclass.wb[a].uid++;f.uid=virtualclass.wb[a].uid;b.main.replayObjs.push(f);virtualclass.storage.store(JSON.stringify(b.main.replayObjs));virtualclass.vutil.beforeSend({repObj:[f],cf:"repObj"})}this.parentNode.id!="t_clearall"+a&&(virtualclass.wb[a].prvTool=this.parentNode.id,virtualclass.wb[a].prvToolInfo=f)},attachToolFunction:function(a,b,f){virtualclass.wb[f].createCommand(b,f);a=c.getElementById(a).getElementsByTagName("div");for(b=0;b<a.length;b++)a[b].getElementsByTagName("a")[0].addEventListener("click",
virtualclass.wb[f].objInit)},toolInit:function(a,b,f,d){var g=virtualclass.gObj.currWb;-1>=a.indexOf("_doc_")&&(a+=g);var h=virtualclass.wb[g].vcan;"object"==typeof virtualclass.wb[g].obj.drawTextObj&&1==virtualclass.wb[g].obj.drawTextObj.wmode&&h.main.canvas.getContext("2d");0<h.getStates("children").length?a!="t_clearall"+g&&("undefined"!=typeof f&&a=="t_replay"+g||virtualclass.wb[g].utility.deActiveFrmDragDrop(),1!=f&&"t_replay"!=a&&h.renderAll()):h.main.action="create";virtualclass.wb[g].utility.IsObjEmpty(virtualclass.wb[g].obj.freeDrawObj&&
0==f)||(virtualclass.wb[g].obj.freeDrawObj.freesvg=!1);h.main.currUserCommand=a+"Init";if(a=="t_activeall"+g)console.log("command active"),virtualclass.wb[g].utility.t_activeallInit();else if(a=="t_replay"+g)"undefined"==typeof f&&h.setValInMain("id",0),"undefined"!=typeof d?virtualclass.wb[g].t_replayInit(b,d):virtualclass.wb[g].t_replayInit(b);else if(a=="t_clearall"+g){if("Whiteboard"==virtualclass.currApp)var m=virtualclass.lang.getString("clearAllWarnMessageW");else"DocumentShare"==virtualclass.currApp&&
(m=virtualclass.lang.getString("clearAllWarnMessageD"));virtualclass.popup.confirmInput(m,function(a){if(!a)return!0;console.log("Whiteboard clear init "+g);virtualclass.wb[g].utility.t_clearallInit();virtualclass.wb[g].utility.makeDefaultValue(b);virtualclass.storage.clearSingleTable("wbData");virtualclass.vutil.beforeSend({clearAll:!0,cf:"clearAll"});var b=virtualclass.wb[g].hasOwnProperty("prvToolInfo")&&"object"==typeof virtualclass.wb[g].prvToolInfo?virtualclass.wb[g].prvToolInfo.cmd:"t_triangle";
-1>=b.indexOf("_doc_")&&(b+=virtualclass.gObj.currWb);a=c.getElementById(b).getElementsByTagName("a")[0];null!=a&&a.click()})}else a=="t_assign"+g?(b=localStorage.getItem("toolHeight"),null!=b?virtualclass.vutil.beforeSend({assignRole:!0,toolHeight:b,socket:virtualclass.wb[g].socketOn}):virtualclass.vutil.beforeSend({assignRole:!0,socket:virtualclass.wb[g].socketOn,cf:"assignRole"})):"t_reclaim"==a&&virtualclass.wb[g].utility._reclaimRole();a!="t_replay"+g&&a!="t_clearallInit"+g&&a!="t_assign"+g&&
a!="t_reclaim"+g&&(virtualclass.wb[g].tool=new virtualclass.wb[g].tool_obj(a),virtualclass.wb[g].utility.attachEventHandlers(g))},tool_obj:function(a){if(-1<a.indexOf("_doc_")){var b=c.querySelector("#"+a);b=null==b?virtualclass.gObj.currWb:virtualclass.vutil.getWhiteboardId(b)}else b=virtualclass.gObj.currWb,a+=b;this.cmd=a;a!="t_freeDrawing"+b&&(virtualclass.wb[b].obj.freeDrawObj="");a=="t_text"+b||virtualclass.vutil.exitTextWrapper()||(virtualclass.wb[b].obj.drawTextObj="");a=="t_freeDrawing"+
b?(virtualclass.wb[b].obj.freeDrawObj=new virtualclass.wb[b].readyFreeHandObj("#424240","3"),virtualclass.wb[b].obj.freeDrawObj.init()):a=="t_text"+b&&(virtualclass.wb[b].obj.drawTextObj=new virtualclass.wb[b].readyTextObj,virtualclass.wb[b].obj.drawTextObj.init("canvasWrapper"+b));a=a.slice(2,a.length);-1<a.indexOf("_doc_")&&(a=a.substring(0,a.indexOf("_")));virtualclass.wb[b].draw_object(a,virtualclass.wb[b].canvas,this)},t_replayInit:function(a,b){var c=virtualclass.gObj.currWb;"fromFile"==a?(virtualclass.gObj.chat.removeAllChat(),
virtualclass.wb[c].recordAudio=!0,virtualclass.recorder.init()):(virtualclass.wb[c].replay=virtualclass.wb[c]._replay(),"undefined"!=typeof b?(virtualclass.wb[c].replay.init(a,b),virtualclass.wb[c].replay.renderObj(b)):(virtualclass.wb[c].replay.init(a),virtualclass.wb[c].replay.renderObj()))}}}})(window,document);(function(d){d.utility=function(){return{userIds:[],isObjExistRE:function(c){var b=virtualclass.gObj.currWb;if(0<=virtualclass.wb[b].replay.removeElements.length&&(b=virtualclass.wb[b].vcan.ArrayIndexOf(virtualclass.wb[b].replay.removeElements,function(a){return a.id==c.id}),0<=b))return b},IsObjEmpty:function(c){for(var b in c)if(c.hasOwnProperty(b))return!1;return!0},stringToNumber:function(c){" "==c[c.length-1]&&(c=c.substring(0,c.length-1));return c=Number(c)},clickOutSidebox:function(c){return 1!=
c%2?!0:!1},keyOperation:function(c){var b=virtualclass.gObj.currWb;8==c.keyCode||46==c.keyCode?(c=virtualclass.wb[b].vcan,""!=c.main.currObj&&roles.hasControls()&&(console.log("Delete whiteboard obj:- Invoke the command"),b=virtualclass.wb[b].utility.removeSelectedItem(c.main.currObj),virtualclass.vutil.beforeSend({repObj:[b],cf:"repObj"}))):27==c.keyCode&&"object"==typeof virtualclass.wb[b]&&virtualclass.wb[b].obj.drawTextObj.finalizeTextIfAny()},removeSelectedItem:function(c,b,a){var f=virtualclass.gObj.currWb,
g=virtualclass.wb[f].vcan;virtualclass.wb[f].canvas.removeObject(g.main.currObj);c={mt:(new Date).getTime(),ac:"del"};"undefined"==typeof b&&virtualclass.wb[f].uid++;c.uid=virtualclass.wb[f].uid;roles.hasControls()?"undefined"==typeof a&&(console.log("Delete:- Saving the delete command with id "+c.uid),g.main.replayObjs.push(c),virtualclass.storage.store(JSON.stringify(g.main.replayObjs))):virtualclass.storage.store(JSON.stringify(virtualclass.wb[f].gObj.replayObjs));g.main.currObj="";console.log("Delete:- Removing the whitboard object");
return c},attachEventHandlers:function(c){virtualclass.wb[c].canvas.bind("mousedown",virtualclass.wb[c].utility.ev_canvas);virtualclass.wb[c].canvas.bind("mousemove",virtualclass.wb[c].utility.ev_canvas);virtualclass.wb[c].canvas.bind("mouseup",virtualclass.wb[c].utility.ev_canvas)},t_clearallInit:function(){virtualclass.wb[virtualclass.gObj.currWb].utility.clearAll(!0)},clearAll:function(c,b){b=virtualclass.gObj.currWb;console.log("Whiteboard clear "+b);virtualclass.wb[b].uid=0;virtualclass.wb[b].lt=
"";for(var a=virtualclass.wb[virtualclass.gObj.currWb].vcan;0<a.main.children.length;)virtualclass.wb[b].canvas.removeObject(a.main.children[0]);1==c&&a.main.replayObjs.splice(0,a.main.replayObjs.length);void 0!=virtualclass.wb[b].replay&&(virtualclass.wb[b].replay.objNo=0);"move"==a.getStates("action")&&a.setValInMain("action","create");c=document.getElementById("sendPackCont");if(null!=c&&(c=c.getElementsByClassName("numbers"),0<c.length))for(b=0;b<c.length;b++)c[b].innerHTML=0;c=document.getElementById("serverErrorCont");
null!=c&&(c.parentNode.removeChild(c),console.log("Some ERROR removed."));virtualclass.vutil.removeAllTextWrapper()},deActiveFrmDragDrop:function(){var c=virtualclass.wb[virtualclass.gObj.currWb].vcan,b=c.main.children;if("move"==c.getStates("action")){c.setValInMain("action","create");for(c=0;c<b.length;c++)b[c].dragDrop(!1),b[c].setActive(!1);return!0}return!1},getOffset:function(c){for(var b=c.target,a=y=0;b&&!isNaN(b.offsetLeft)&&!isNaN(b.offsetTop);)a+=b.offsetLeft-b.scrollLeft,y+=b.offsetTop-
b.scrollTop,b=b.offsetParent;a=c.clientX-a;y=c.clientY-y;return{x:a,y:y}},ev_canvas:function(c){var b=virtualclass.gObj.currWb,a=virtualclass.wb[b].vcan.utility.getReltivePoint(c);c.currX=a.x;c.currY=a.y;if(b=virtualclass.wb[b].tool[c.type])return b(c),this.ev_canvas},t_activeallInit:function(){var c=virtualclass.wb[virtualclass.gObj.currWb].vcan,b=c.getStates("children");if(1<=b.length)for(c.setValInMain("action","move"),c=0;c<b.length;c++)b[c].dragDrop(!0)},drawArrowImg:function(c,b){var a=virtualclass.wb[virtualclass.gObj.currWb].vcan,
f=a.main.canvas.getContext("2d");f.clearRect(0,0,a.main.canvas.width,a.main.canvas.height);a.renderAll();f.save();f.beginPath();f.translate(b.mp.x,b.mp.y);f.drawImage(c,-3,-3,18,24);f.closePath();f.restore()},assignRole:function(c){var b=virtualclass.gObj.currWb;virtualclass.wb[b].tool="";"move"==vcan.main.action&&virtualclass.wb[b].utility.deActiveFrmDragDrop();if("undefined"!=typeof c)roles.isEducator()&&(c=document.getElementById(virtualclass.gObj.commandToolsWrapperId),c.parentNode.removeChild(c)),
virtualclass.gObj.uRole="p",localStorage.setItem("uRole",virtualclass.gObj.uRole),virtualclass.user.assignRole(virtualclass.gObj.uRole,virtualclass.currApp),vcan.utility.canvasCalcOffset(vcan.main.canid),"Yts"==virtualclass.currApp&&(virtualclass.yts.UI.inputURL(),virtualclass.yts.seekChangeInterval());else{"Yts"==virtualclass.currApp&&(virtualclass.yts.UI.removeinputURL(),virtualclass.yts.hasOwnProperty("tsc")&&clearInterval(virtualclass.yts.tsc));virtualclass.gObj.uRole="s";c=document.getElementById(virtualclass.gObj.commandToolsWrapperId);
if(null!=c)for(;c.hasChildNodes();)c.removeChild(c.lastChild);virtualclass.wb[b].utility.makeCanvasDisable();roles.hasAdmin()?(virtualclass.vutil.createReclaimButton(c),virtualclassCont=document.getElementById("virtualclassCont"),virtualclassCont.className+=" educator"):null!=c&&c.parentNode.removeChild(c);localStorage.setItem("uRole",virtualclass.gObj.uRole);virtualclass.wb[b].utility.uniqueArrOfObjsToStudent()}},reclaimRole:function(){var c=virtualclass.gObj.currWb;virtualclass.gObj.controlAssign=
!1;virtualclass.wb[c].response.assignRole(virtualclass.gObj.uid,virtualclass.gObj.uid,!0)},dispQueuePacket:function(c){c=virtualclass.gObj.currWb;(roles.hasControls()||roles.isEducator())&&virtualclass.wb[c].utility.toolWrapperEnable();virtualclass.wb[c].drawMode=!1;roles.hasControls()&&(virtualclass.wb[c].utility.makeCanvasEnable(),virtualclass.wb[c].utility.enableAppsBar())},makeCanvasDisable:function(){var c=virtualclass.wb[virtualclass.gObj.currWb].vcan.main.canvas;c.style.position="relative";
c.style.pointerEvents="none"},makeCanvasEnable:function(){var c=virtualclass.gObj.currWb,b=virtualclass.wb[c].vcan;!roles.hasControls()||virtualclass.wb[c].hasOwnProperty("canvasDisable")&&virtualclass.wb[c].canvasDisable||(b.main.canvas.style.pointerEvents="visible")},removeToolBox:function(c){c=document.getElementById("commandToolsWrapper"+c);c.parentNode.removeChild(c)},createReclaimButton:function(c){var b=virtualclass.gObj.currWb;virtualclass.vutil.createDiv("t_reclaim","reclaim",c);document.getElementById("t_reclaim").getElementsByTagName("a")[0].addEventListener("click",
virtualclass.wb[b].objInit)},chkValueInLocalStorage:function(c){return null===localStorage.getItem(c)?!1:localStorage[c]},uniqueArrOfObjsToStudent:function(){var c=virtualclass.gObj.currWb,b=virtualclass.wb[c].vcan;virtualclass.wb[c].gObj.replayObjs=[];for(var a=0;a<b.main.replayObjs.length;a++){var f=b.extend({},b.main.replayObjs[a]);virtualclass.wb[c].gObj.replayObjs.push(f)}},uniqueArrOfObjsToTeacher:function(){var c=virtualclass.gObj.currWb,b=virtualclass.wb[c].vcan;b.main.replayObjs=[];for(var a,
f=0;f<virtualclass.wb[c].gObj.replayObjs.length;f++)a=b.extend({},virtualclass.wb[c].gObj.replayObjs[f]),b.main.replayObjs.push(a)},makeDefaultValue:function(c){var b=virtualclass.gObj.currWb;"undefined"!=typeof c&&"t_clearall"==c||virtualclass.wb[b].utility.makeDeActiveTool();virtualclass.wb[b].gObj.myrepObj=[];virtualclass.wb[b].gObj.replayObjs=[];virtualclass.wb[b].gObj.rcvdPackId=0;virtualclass.wb[b].gObj.displayedObjId=0;virtualclass.wb[b].gObj.packQueue=[];virtualclass.wb[b].gObj.queue=[];virtualclass.wb[b].uid=
0;localStorage.setItem("rcvdPackId",0);virtualclass.vutil.chkValueInLocalStorage("wbrtcMsg");virtualclass.vutil.chkValueInLocalStorage("canvasDrwMsg");virtualclass.vutil.chkValueInLocalStorage("toolHeight");JSON.parse(virtualclass.vutil.chkValueInLocalStorage("prvUser"));JSON.parse(virtualclass.vutil.chkValueInLocalStorage("tc"));virtualclass.gObj.video.audio.bufferSize=0;virtualclass.gObj.video.audio.encMode="alaw";virtualclass.gObj.video.audio.rec="";virtualclass.gObj.video.audio.audioNodes=[];
c=virtualclass.wb[b].vcan;"undefined"!=typeof c.objTxt&&c.objTxt.removeTextNode();"undefined"!=typeof c.main.currentTransform&&(c.main.currentTransform="");virtualclass.gObj.video.audio.updateInfo()},clearCurrentTool:function(){var c=virtualclass.gObj.currWb;virtualclass.wb[c].hasOwnProperty("tool")&&(virtualclass.wb[c].tool="")},setOrginalTeacherContent:function(){localStorage.setItem("canvasDrwMsg",!0)},checkWebRtcConnected:function(){return"undefined"==typeof cthis||!cthis.pc[0].hasOwnProperty("iceConnectionState")&&
"undefined"==typeof cthis.pc[0].iceConnectionState?!1:!0},createVirtualWindow:function(c){var b=virtualclass.gObj.currWb;virtualclass.wb[b].gObj.virtualWindow=!0;var a=document.createElement("div");virtualclass.wb[b].utility.removeVirtualWindow("virtualWindow");a.setAttribute("id","virtualWindow");a.style.width=c.width+"px";"undefined"!=typeof assignRoleAtStudent?b=0:(b=parseInt(localStorage.getItem("toolHeight")),b=null!=b?b:0);roles.hasAdmin()?a.style.height=c.height+b+"px":roles.hasControls()?
a.style.height=c.height+"px":a.style.height=c.height-b+"px";c=document.getElementById("containerWb");c.insertBefore(a,c.firstChild)},removeVirtualWindow:function(c){var b=virtualclass.gObj.currWb;c=document.getElementById(c);null!=c&&(virtualclass.wb[b].gObj.virtualWindow=!1,c.parentNode.removeChild(c))},getWideValueAppliedByCss:function(c,b){c=document.getElementById(c);if(null!=c){b=d.getComputedStyle(c);if("undefined"!=typeof b.marginTop){var a=parseInt(b.marginTop.match(/\d+/));null==a&&(a=0)}return c.clientHeight+
a}return!1},isNumber:function(c){return isNaN(+c)?!1:+c},setCommandToolHeights:function(c,b){var a=document.getElementById("virtualWindow");if(null!=a){var f=parseInt(a.style.height.match(/\d+/));a.style.height="decrement"==b?f-parseInt(c)+"px":f+parseInt(c)+"px"}},setClass:function(c,b){c=document.getElementById(c);var a=c.classList,f="";0<a.length&&(f=2>f.length?a[0]+" ":a.join(" ")+" ");c.setAttribute("class",f+b)},setStyleUserConnetion:function(c,b,a){c=document.getElementsByClassName(c)[0];null!=
c&&c.setAttribute("class",b+" controlCmd")},existUserLikeMe:function(c){if(c.fromUser.userid!=wbUser.id){if(c.message.checkUser.hasOwnProperty("role")){var b=c.message.checkUser.role;if(b){if(null==localStorage.getItem("otherRole")){var a=[];if(b!=virtualclass.gObj.uRole)a.push(b);else return existUser=!0}else a=JSON.parse(localStorage.getItem("otherRole")),-1==a.indexOf(b)&&a.push(b);"undefined"!=typeof a&&(localStorage.setItem("otherRole",JSON.stringify(a)),console.log("Other Browser "+b+" "+c.fromUser.userid))}return virtualclass.gObj.uRole==
b?!0:!1}}else{if("undefined"!=typeof existUser)return!0;c=JSON.parse(localStorage.getItem("otherRole"));if(null!=c){for(b=0;b<c.length;b++)if(virtualclass.gObj.uRole==c[b])return!0;return!1}}},existUserWithSameId:function(c){var b=virtualclass.gObj.currWb;this.userIds.push(c.fromUser.userid);if(1<this.userIds.length&&virtualclass.wb[b].utility.arrayContainsSameValue(this.userIds[0],this.userIds))return!0},makeUserAvailable:function(){var c=virtualclass.gObj.currWb;null==localStorage.getItem("repObjs")&&
(virtualclass.wb[c].utility.toolWrapperEnable(),null!=vcan.main.canvas&&virtualclass.wb[c].utility.makeCanvasEnable())},displayCanvas:function(c){virtualclass.wb[c].vcan.canvasWrapperId="canvasWrapper"+c;null==document.getElementById("canvas"+c)&&virtualclass.wb[c].createCanvas(c);d.virtualclass.wb[c].init(c);virtualclass.wb[c].utility.makeCanvasDisable();virtualclass.wb[c].utility.toolWrapperDisable();roles.hasControls()||roles.hasAdmin()},removeWhiteboardMessage:function(){var c=document.getElementById("whiteBoardMsg");
null!=c&&c.parentNode.removeChild(c)},createWhiteboardMessage:function(){if(null==document.getElementById("whiteBoardMsg")){var c=document.createElement("div");c.id="whiteBoardMsg";c.innerHTML=virtualclass.lang.getString("msgForWhiteboard");var b=document.getElementById("canvasWrapper"+virtualclass.gObj.currWb);null!=b&&b.appendChild(c)}},initAll:function(c){c=virtualclass.gObj.currWb;roles.hasControls()&&virtualclass.wb[c].utility.makeCanvasDisable();virtualclass.system.measureResoultion({width:d.outerWidth,
height:d.innerHeight})},alreadyExistToolBar:function(c){c=document.getElementById("t_rectangle"+c);return null!=c?8<=c.parentNode.getElementsByClassName("tool").length?!0:!1:!1},toolWrapperDisable:function(c){var b=document.getElementById("commandToolsWrapper");if(null!=b)if("undefined"!=typeof c)for(c=b.getElementsByTagName("a"),b=0;b<c.length;b++)c[b].style.pointerEvents="none";else b=document.getElementById("commandToolsWrapper"),null!=b&&(b.style.pointerEvents="none")},toolWrapperEnable:function(c){var b=
document.getElementById("commandToolsWrapper");if(null!=b)if("undefined"!=typeof c)for(c=b.getElementsByTagName("a"),b=0;b<c.length;b++)c[b].style.pointerEvents="visible";else null==b||virtualclass.gObj.hasOwnProperty("errNotDesktop")||(b.style.pointerEvents="visible")},replayFromLocalStroage:function(c){console.log("PDF, Whiteboard is intializing");var b=virtualclass.gObj.currWb;"undefined"!==typeof Storage&&(!1===virtualclass.storage.reclaim&&virtualclass.vutil.disableAppsBar(),virtualclass.wb[b].utility.clearAll(!1,
"dontClear"),virtualclass.wb[b].gObj.tempRepObjs=c,0<c.length&&(virtualclass.wb[b].utility.makeCanvasDisable(),virtualclass.wb[b].utility.toolWrapperDisable(),virtualclass.wb[b].gObj.displayedObjId=0,virtualclass.wb[b].utility.replayObjsByFilter(c,"fromBrowser")))},setUserStatus:function(c,b){var a=virtualclass.gObj.currWb;c||b?virtualclass.wb[a].utility.setClass("vcanvas","teacher"):(virtualclass.wb[a].utility.removeToolBox(a),virtualclass.wb[a].utility.setClass("vcanvas","student"))},crateCanvasDrawMesssage:function(c){roles.hasControls()&&
null==localStorage.getItem("canvasDrwMsg")&&(localStorage.canvasDrwMsg=!0)},arrayContainsSameValue:function(c,b){for(var a=0;a<b.length;a++)if(b[a]!==c)return!1;return!0},actionAfterRemovedUser:function(){var c=virtualclass.gObj.currWb;virtualclass.wb[c].utility.makeCanvasDisable();virtualclass.wb[c].utility.setStyleUserConnetion("con","coff");virtualclass.wb[c].utility.removeVirtualWindow("virtualWindow");virtualclass.wb[c].user.connected=!1;wb[c];localStorage.removeItem("otherRole");"undefined"!=
typeof cthis&&(tempIsInitiaor=!0,cthis.isStarted&&cthis.handleRemoteHangup())},sendRequest:function(){virtualclass.vutil.beforeSend({reclaimRole:!0,cf:"reclaimRole"})},updateSentInformation:function(c,b){if(roles.hasAdmin()){c=JSON.parse(c);b="undefined"!=typeof b?c:c.repObj[0];c="";for(var a in b)c+=a+" : "+b[a]+" <br />";null!=document.getElementById("sentMsgInfo")&&(document.getElementById("sentMsgInfo").innerHTML=c)}},beforeSend:function(c,b){var a=virtualclass.gObj.currWb;if(c.hasOwnProperty("createArrow")){var f=
JSON.stringify(c);virtualclass.wb[a].vcan.optimize.sendPacketWithOptimization(f,io.sock.readyState,300)}else{if(c.hasOwnProperty("repObj")){if("undefined"==typeof c.repObj[c.repObj.length-1])return;virtualclass.wb[a].gObj.rcvdPackId=c.repObj[c.repObj.length-1].uid;virtualclass.wb[a].gObj.displayedObjId=virtualclass.wb[a].gObj.rcvdPackId}f=JSON.stringify(c);1==io.sock.readyState&&("undefined"==typeof b?ioAdapter.mustSend(c):ioAdapter.mustSendUser(c,b));JSON.parse(f).hasOwnProperty("repObj")&&virtualclass.wb[a].utility.updateSentInformation(f)}},
checkCanvasHasParents:function(){for(var c=document.getElementById("vcanvas");"BODY"!=c.parentNode.tagName;)"vcanvas"!=c.id&&(c.style.margin="0",c.style.padding="0"),c=c.parentNode;"vcanvas"!=c.id&&(c.style.margin="0",c.style.padding="0")},lockvirtualclass:function(){var c=virtualclass.gObj.currWb;d.earlierWidth!=d.innerWidth&&(virtualclass.wb[c].canvasDisable=!0,virtualclass.wb[c].utility.makeCanvasDisable(),virtualclass.wb[c].utility.toolWrapperDisable(),virtualclass.vutil.disableAppsBar(),null==
document.getElementById("divForReloadMsg")&&(c=roles.hasControls()?"msgForReload":"msgStudentForReload",d.virtualclass.view.displayMsgBox("divForReloadMsg",c),d.earlierWidth=d.innerWidth))},getElementRightOffSet:function(c){var b=20;null!=c.parentNode&&(c=c.parentNode,b=vcan.utility.getElementOffset(c),b=d.innerWidth-(c.clientWidth+(b.x-0)));return b},objPutInContainer:function(c){vcan.main.replayObjs.push(c);virtualclass.storage.store(JSON.stringify(vcan.main.replayObjs))},makeActiveTool:function(c){var b=
virtualclass.gObj.currWb;c=document.getElementById(c);if(virtualclass.wb[b].hasOwnProperty("prvTool")&&virtualclass.wb[b].prvTool!="t_reclaim"+b){var a=virtualclass.vutil.removeClassFromElement(virtualclass.wb[b].prvTool,"active");document.getElementById(virtualclass.wb[b].prvTool).className=a}else a=c.className;c.className=a+" active";localStorage.activeTool=c.id},makeDeActiveTool:function(){virtualclass.wb[virtualclass.gObj.currWb].tool="";document.getElementById("commandToolsWrapper");var c=document.getElementsByClassName("tool active");
0<c.length&&c[0].classList.remove("active")},createAudioTransmitIcon:function(c){var b=document.cteateElement("div");b.id="audioTransmit"+uuserId;b.className="audioTransmit";document.getElementById(c+"ControlContainer")},_reclaimRole:function(){var c=virtualclass.gObj.currWb;virtualclass.wb[c].utility.reclaimRole();virtualclass.wb[c].utility.sendRequest();virtualclass.user.control.changeAttrToAssign("enable")},enableAppsBar:function(){var c=document.getElementById("virtualclassOptionsCont");null!=
c&&(c.style.pointerEvents="visible")},replayObjsByFilter:function(c,b){for(var a=virtualclass.gObj.currWb,f=0;f<c.length;f++)virtualclass.wb[a].bridge.makeQueue(c[f]),c[f].uid==virtualclass.wb[a].gObj.displayedObjId+1&&(virtualclass.wb[a].uid=c[f].uid,this.executeWhiteboardData(c[f]),"undefined"!=typeof b&&(virtualclass.wb[a].gObj.rcvdPackId=virtualclass.wb[a].uid));0<virtualclass.wb[a].gObj.replayObjs.length&&virtualclass.storage.store(JSON.stringify(virtualclass.wb[a].gObj.replayObjs))},executeWhiteboardData:function(c){var b=
virtualclass.gObj.currWb;console.log("Whiteboard executed uid "+c.uid);virtualclass.wb[b].gObj.replayObjs.push(c);virtualclass.wb[b].response.replayObj([c]);this.checkNextQueue(c)},checkNextQueue:function(c){(c=this.findPacketInQueue(c))&&this.executeWhiteboardData(c)},findPacketInQueue:function(c){var b=virtualclass.gObj.currWb;return virtualclass.wb[b].gObj.queue.hasOwnProperty(c.uid+1)?virtualclass.wb[b].gObj.queue[c.uid+1]:!1},putScrollWithCevent:function(c){return c=this.scaleCordinate(c)},scaleCordinate:function(c){c.detail.cevent.x*=
virtualclass.zoom.canvasScale;c.detail.cevent.y*=virtualclass.zoom.canvasScale;return c},scaleMoveCordinate:function(c){c.x=ev.detail.cevent.x/virtualclass.zoom.canvasScale;c.y=ev.detail.cevent.y/virtualclass.zoom.canvasScale;return c}}}})(window);(function(d){d.message={ActiveAll:"Active all",Addoption:"Add option",addnew:"Add new",adminusr:"Admin user",appPrerequites:"Validate app prerequisites",assign:"Assign",assignDisable:"Reclaim controls",askplayMessage:'<span id="askplaymsg"> Should we start playing the session?</span><br /><span id="remaingmsg">Remaining data will be downloaded in the background.</span>',askplaymsg:'<span id="askplaymsg"> "Downloading in progress, click Play to begin </span>"',audioInput:"Audio input",audiolatency:"Audio latency",
audioOutput:"Audio output",audioDisable:"Unmute",audioEnable:"Mute",audioTest:"Your voice will be recorded and played back to you. \n Press Ok and speak something for few seconds.",Back:"Back",bandfast:"Bandwidth is high",bandmedium:"Bandwidth is medium",bandslow:"Bandwidth is low",becomeTeacher:"Become teacher",Binary_Limit_Exeed:"Warning: High BN usage",bulkUserActions:"Bulk user actions",ByInstructor:"By instructor",ByTimer:"By timer",cancel:"Cancel",canvasDrawMsg:"You can click on any tool for drawingclick and hold the left mouse button to draw",
canvasmissing:"Canvas is missing in your browser. Please update your browser to the latest version.",chatEnable:"Disable chat",Chatroom:"Chatroom",ClearAll:"Clear all",clicktoplay:"Play",chatDisable:"Enable chat",chFireBrowsersIssue:"Your browser {virtualclass1} {virtualclass2} needs updation, Congrea support Chrome 40+ and Firefox 35+.",clearAllWarnMessageW:"Do you really want to clear this whiteboard?",clearAllWarnMessageD:"Do you really want to clear this drawings?",closedsDbheading:"Close document dashboard",
closeSharePresentationdbHeading:"Close presentation dashboard",closevideoDashboard:"Close video dashboard",closeVoting:"Close voting",cnmissing:"Chunk number is missing",CodeEditor:"Code editor",cof:"Connection off",collaborate:"Collaborate",commonChat:"Common chat",commonBrowserIssue:"Your browser {virtualclass1} {virtualclass2} is not supported, Congrea support Chrome and Firefox.",congreainchrome:"Your browser is compatible.",confirmCancel:"No",confirmOk:"Yes",Controls:"Controls",coursePoll:"Course level poll",
Cpoll:"Course poll",Cquiz:"Close quiz",createnewpoll:"Create new poll",Creator:"Creator",dap:"false","delete":"Delete",delblank:"Remove the blank option",Delete:"Delete",DevicesNotFoundError:"Webcam is not available, or not connected properly.",deletepopup:"Are you sure to delete ?",disable:"Disable",disabled:"disabled",disableAllVideo:"Disable all video",dltDisabled:"Can be deleted  by creator of the poll",documentShare:"Share document",DocumentSharing:"Document sharing",DocumentSharedbHeading:"Document dashboard",
docUploadSuccess:"Document uploaded successfully",download:"Download",downloadFile:"Download file",downloadsession:"Please wait while the recording is downloaded",drawArea:"Draw area",dropfilehere:"Drop files here",duplicateUploadMsg:"This file already exists, please upload new file.",edit:"Edit",editorCode:"Code editor",edittitle:"Edit title",editorRichDisable:"Write mode",editorRichEnable:"Read only",educator:"Educator",EHTMLPresentUrl:"Enter HTML5 presentation URL",enable:"Enable",enablehistory:'"Browser history" should be enabled during the session.',
enableVideoAll:"Enable video all",enteryouryoutubeurl:"Enter YouTube/online video URL",etDisabledA:"Can\u2019t edit, poll attempted",etDisabledCr:"Can be edited by creator of the poll",ETime:"Elapsed time",FF2:"Fast forward 2",FF8:"Fast forward 8",filenotsave:"Your file could not be saved.",filetsaveTS:"The session is ready to save.",Finish:"Finish",fitToScreen:"Fit to screen",Freehand:"Free hand",general:"General",Greport:"Grade report",highBandWidthSpeed:"Your bandwidth is good enough.",httpsmissing:"Only secure origins(https) are allowed for screen sharing.",
ieBrowserIssue:"Internet Explorer is not supported, Congrea fully support Chrome  and Firefox.",ios7support:"For Apple, Virtual Class supports iOS 8 and higher versions.",iosAudEnable:"Tap here to enable the audio",InternalError:"Please ensure that same webcam is not being used <br /> in multiple browsers or multiple applications. ",invalidcmid:"Invalid course module Id.",invalidurl:"Invalid URL",indvprogress:"Current task",InsertimageURL:"Insert image URL",JoinSession:"Join session",keymissing:"Your software(LMS/CMS)'s key is is missing",
Line:"Line",lowBandWidthSpeed:"Your bandwidth is too low, we are stopping video playback. You will still be able to hear audio and view screen.",maxCommonChat:"Show chat window",Max_rooms:"Error: Max rooms limit reached",Max_users:"Error: Max users limit reached",media:"Media",mediumBandWidthSpeed:"Your bandwidth is limited, we are reducing video quality based on your available bandwidth.",minCommonChat:"Hide chat window",minoption:"Enter at least two options",mictesting:"If above audio bar fluctuate while you speak, microphone is working.",
minute:"Minute",ModeclosingPoll:"Mode of closing Poll :",msgForDownloadStart:"Unable to save data. <br /> Preparing data for download",msgForReload:"Please reload this page to continue editing.",msgForWhiteboard:"Empty whiteboard.",msgStudentForReload:"Please reload this page.",Multiple_login:"Error: Access denied, multiple logins",muteAll:"Mute all",muteAllAudio:"Mute all audio",mybsharedoc:"Document will shared shortly",NAME:"NAME",Next:"Next",nomdlroot:"There is no url for momodle root.",noResultStd:"You are not permitted to see the result",
NotAllowedError:"Webcam is disabled",NotFoundError:"Webcam is not available, or not connected properly.",NotReadableError:"Please ensure that same webcam is not being used <br /> in multiple browsers or multiple applications.",notSupportBrowser:"Firefox {virtualclass1} does not support Screen sharing.",notsupportbrowser:"{virtualclass1} is not fully compatible. For the best experience, use Google Chrome.",NotSupportedError:"Only secure origins(https) are allowed for audio and video",notSupportIphone:"Sorry. Virtual class doesn't support mobile phones.",
noPoll:"There is no question available for poll. Go to \u2018add new\u2019 to create question.",noPollNoAdmin:"There is no question available for site poll .Only admin can create site level poll",noQuiz:"No quiz available. Congrea supports only mutliple choice questions",Novote:"No vote received for this poll",nowebcam:"Webcam is not available, or not connected properly.",offcollaboration:"Collaboration off",oncollaboration:"Collaboration on",opendsDbheading:"Document dashboard",openSharePresentationdbHeading:"Presentation dashboard",
openvideoDashboard:"Video dashboard",operaBrowserIssue:"Your browser {virtualclass1} {virtualclass2} is partially supported. You will not be able to share your screen, Congrea fully support chrome and Firefox",Options:"Options",optselectd:"OPTION SELECTED",Oval:"Oval",overallprogress:"Overall progress",Pause:"Pause",pclosetag:"<span>Are you sure to close this poll?  </span>",pclose:"Are you sure to close voting?",Pclosed:"Poll closed",Pdsuccess:"Poll deleted successfully",PEdit:"Poll edit",PermissionDeniedError:"Webcam access has been denied.",
PERMISSION_DENIED:"You denied access to your Webcam(camera/microphone).",Play:"Play",playsessionmsg:"Click \u2018play\u2019 to start the session.",pleasewaitWhSynNewCont:"Please wait a while. Syncing new content.",plswaitwhile:"Please wait....",poll:"Poll",pollblank:"Question can not be left blank",pollCancel:"Close",pollDel:"Are you sure to delete this poll?",pollHead:"Vote this poll",pollmaybeshown:"Poll will be published",pollmybpublish:"Poll will be published shortly",pollresult:"Previous result",
ppoll:"Publish poll",PQuestions:"Poll questions",PQuiz:"Publish quiz",Precheck:"Precheck",precheckStart:"Start",prechkcmplt:"Precheck complete",Presult:"Poll result",preWllBshortly:"Presentation will be shared shortly",Prev:"Prev",proposedspeed:"Proposed speed",PSetting:"Poll setting",Publish:"Publish",QClosed:"Quiz closed",Question:"Question",Quiz:"Quiz","Quiz/page":"Quiz / page",Quizes:"Quizzes",quizmayshow:"Get ready for a quiz",quizreviewpublish:"Review & publish quiz",RaiseHandStdDisabled:"Undo raise hand",
RaiseHandEnable:"Hand raised",raiseHandNotify:"Student(s) raised hand",RaiseHandStdEnabled:"Raise hand",readonlymode:"Read only",receivedVotes:"Received votes",reclaim:"Reclaim",Rectangle:"Rectangle",rejected:"Another application on your computer might be using your webcam. Kindly close all other applications",reload:"Reload",reloadDoc:"Reload document",replay:"Re-play",Replay:"Replay from start.",replay_message:"Thanks for watching.",requestScreenShare:"Request screen share",Reset:"Reset",Rtime:"Remaining time",
rusureCquiz:"<span>Are your sure to close this quiz? </span>",rvtu:"Votes received/ total users",safariBrowserIssue:"Your browser Safari {virtualclass1} is not supported, We fully support Chrome  and Firefox",Save:"Save",savesession:"Do you want to save current session?",savesessionTechSupport:"Do you want to save current session? <br /> Once you download the session, Updates won't be available on re-downloading of same session.",screensharealready:"The screen is being shared.",ScreenShare:"Screen share",
screensharemsg:"The above screen is being shared.",second:"Second",selfview:"Self view",SetTimer:"Set timer",sesseionkeymissing:"Session key is missing from Front End.",sentPackets:"Sent <br/><span>Packets</span>",SessionEnd:"Session end",sessionendmsg:"Session has been closed. You may now close your browser.",setting:"Setting",Searchuser:"Search user",share:"Share",ShareVideo:"Share video",shareAnotherYouTubeVideo:"Share another YouTube video",SharePresentation:"Share presentation",SharePresentationdbHeading:"Presentation dashboard",
sharetoall:"Share to all",Showresulttostudents:"Show result to students",sitePoll:"Site level poll",Skip:"Close",someproblem:"There is some problem in uploading file. Please try again.",SourceUnavailableError:"Please ensure that same webcam is not being used in multiple browsers or multiple applications.",speakerTest:"If you can hear music, speakers are working.",Spoll:"Site poll",ssBtn:"Stop sharing",ssStop:"Stop screen sharing",startnewsession:"This session has not been saved, do you really want to end this session?",
status:"Status",stdPublish:"stdPublish",stdscreenshare:"Do you want to share your screen ?",studentAudEnable:"Student audio enabled",studentSafariBrowserIssue:"Your browser {virtualclass1} {virtualclass2} cannot  share your webcam with other users, Congrea fully support Chrome  and Firefox.",supportDesktop:"Virtual Class does not support tablets or mobiles. To present please use a desktop.",supportDesktopOnly:"Sorry, presenter mode only supports desktops. Tablets and Mobile devices are not supported.",
teacherSafariBrowserIssue:"Safari does not support presenter functionality. Please switch to Chrome or Firefox.",techsupport:"Tech support",testingbrowser:"Testing browser compatibility",testinginternetspeed:"Testing internet speed",testingmichrophone:"Testing microphone",testingspeaker:"Testing speaker",testingwebcam:"Testing webcam",Text:"Text",Text_Limit_Exeed:"Warning: High TX usage",TextEditor:"Text editor",Time:"Time",Tmyclose:"Teacher may close this poll at any time",total:"Total",totalprogress:"Total progress",
tpAudioTest:"Test audio",transferControls:"Transfer controls",Triangle:"Triangle",Udocument:"Upload document",Unauthenticated:"Error: Access invalid",unmuteAll:"Unmute all",uploadsession:"Please wait until processing is complete",uploadvideo:"Upload video",uploadedsession:"Your session has ended, you may now close the window.Or close this popup to start a new session.",usermissing:"User is missing",userList:"User's list",validateurlmsg:"Invalid URL",VCE2:"No permission to recording session",VCE4:"Record data is missing",
VCE5:"Unable to Record Data.",VCE6:"Course module is missing.",VideodbHeading:"Video dashboard",videoInput:"Video input",videooff:"Video off",videoquality:"Video quality",VotedSoFar:"Votes received so far",votesuccess:"Your vote has been submitted successfully",votesuccessPbt:"Vote submitted successfully, you are not permitted to see the result.",Vwllbshrshortly:"Video will be shared shortly",waitmsgconnect:"Please wait a while. Application is trying to connect.",watstdrespo:"Waiting for student\u2019s response",
wbrtcMsgChrome:"You can click the deny button for not sharing your microphone and camera  with Congrea.or click allow button to share them.",wbrtcMsgFireFox:'You can click on  "Share Selected Devices" to share your mic and camera feed with other users',webcamerainfo:"If video is visible, webcam is working.",Whiteboard:"Whiteboard",writemode:"Write mode",youtubeshare:"YouTube video share",youTubeUrl:"Enter YouTube video URL",zoomIn:"Zoom in",zoomOut:"Zoom out",PermissionDeniedErrorExt:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top right of the screen <br /> Click on "Always allow..." option and select the camera option <br />  Click on done and refresh the screen  </div> <div class="screenImages"> <figure class="chrome" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-video.png" > <figcaption>Chrome</figcaption> </figure></div>',
SecurityErrorExt:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top right of the screen <br /> Click on "Always allow..." option and select the camera option <br />  Click on done and refresh the screen  </div> <div class="screenImages"> <figure class="chrome" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-video.png" > <figcaption>Chrome</figcaption> </figure></div>',nopermissionExt:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top right of the screen <br /> Click on "Always allow..." option and select the camera option <br />  Click on done and refresh the screen  </div> <div class="screenImages"> <figure class="chrome" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-video.png" > <figcaption>Chrome</figcaption> </figure></div>',
chromeExtMiss:"Congrea needs 'Desktop Selector' plugin to share the Screen.<br />You can download this from <a href='https://chrome.google.com/webstore/detail/desktop-selector/ijhofagnokdeoghaohcekchijfeffbjl' target='_blank'>HERE.</a>",PermissionDeniedErrorExtFF:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top left of the screen <br /> Click on "Share Selected Device." option.<div class="screenImages"><figure class="firefox" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-screnshare.png" > <figcaption>Chrome</figcaption> </figure></div>',
screensharereload:"Screen is not being shared. Please reload for the sharing.",SecurityErrorExtFF:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top left of the screen <br /> Click on "Share Selected Device." option.<div class="screenImages"><figure class="firefox" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-screnshare.png" > <figcaption>Chrome</figcaption> </figure></div>',nopermissionExtFF:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top left of the screen <br /> Click on "Share Selected Device." option.<div class="screenImages"><figure class="firefox" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-screnshare.png" > <figcaption>Chrome</figcaption> </figure></div>',
TypeError:"Your webcam is not initialised properly. Please reload the page."}})(window);(function(d){d.getString=function(c,b){c=d.virtualclass.lang.message[c];if("undefined"!=typeof b&&0<b.length)for(var a=0;a<b.length;a++)c=c.replace(new RegExp("{virtualclass"+(a+1)+"}"),b[a]);return c}})(window);(function(d){var c,b={init:function(){this.msgBoxClass="msgBox";this.window={};this.virtualWindow={};return this},displayMessage:function(a,b,c,h,d,n){a="undefined"==typeof d?this.createMsgBox(a,b,c):this.createMsgBox(a,b,c,d);b=document.getElementById("vcanvas"+n);"undefined"!=typeof h?document.getElementById(h+n).appendChild(a):b.insertBefore(a,b.childNodes[0])},createErrorMsg:function(a,b,c,h){var f="error",g=document.getElementById(b);if(null==g)g=document.createElement("div"),g.id=b;else if(null!=
h&&h.hasOwnProperty("className")){var d=document.querySelector("#"+b+"."+h.className);null!=d&&d.parentNode.removeChild(d);f+=" "+h.className}g.innerHTML='<span className="'+f+'">'+a+"</span>";a=document.querySelector("#closeMsg");null==a&&(a=document.createElement("span"),a.id="closeMsg",a.innerHTML="X",g.appendChild(a));a.onclick=function(){var a=document.querySelector("#"+b);a.parentNode.removeChild(a)};c=document.getElementById(c);c.parentNode.insertBefore(g,c);return g.id},removeErrorMsg:function(a,
b){a=document.getElementById(a);if("undefined"!=typeof b&&(b=a.innerHTML.split(/<br>|<br\\>/),1<b.length)){b.shift();a.innerHTML=b.join();return}a.parentNode.removeChild(a)},removeErrorContainer:function(a){a=document.getElementById(a);a.parentNode.removeChild(a)},customCreateElement:function(a,b,c){a=document.createElement(a);"undefined"!=typeof b&&""!=b&&(a.id=b);"undefined"!=typeof c&&(a.className=c);return a},createMsgBox:function(a,b,c,h){var f=this.customCreateElement("div",b,c);"undefined"==
typeof h&&(c=this.customCreateElement("div",b+"img",c+"img"),f.appendChild(c));b=this.customCreateElement("p",b+"Para");b.innerHTML=a;f.appendChild(b);return f},disappearBox:function(a){a=document.getElementsByClassName(this.msgBoxClass+a);null!=a[0]&&a[0].parentNode.removeChild(a[0])},multiMediaMsg:function(a){"Firefox"==virtualclass.system.mybrowser.name?virtualclass.lang.getString("wbrtcMsgFireFox"):"Chrome"==virtualclass.system.mybrowser.name&&virtualclass.lang.getString("wbrtcMsgChrome")},canvasDrawMsg:function(a,
b){document.getElementById("vcanvas"+b).classList.add("canvasMsgBoxParent");if("Firefox"==virtualclass.system.mybrowser.name){var c=virtualclass.lang.getString("canvasDrawMsg");this.displayMessage(c,"canvasDrawMsgContFirefox",this.msgBoxClass+a,"containerWb")}else"Chrome"==virtualclass.system.mybrowser.name&&(c=virtualclass.lang.getString("canvasDrawMsg"),this.displayMessage(c,"canvasDrawMsgContChrome",this.msgBoxClass+a,"containerWb",null,b))},drawLabel:function(a,b){var c=virtualclass.lang.getString("drawArea");
this.displayMessage(c,"canvasDrawArea",this.msgBoxClass+a,"containerWb",!1,b)},displayMsgBox:function(a,b){var c=this.customCreateElement("div",a),f=this.customCreateElement("p",a+"Para");f.innerHTML=virtualclass.lang.getString(b);c.appendChild(f);b=this.customCreateElement("a",a+"Anchor");b.href="#";b.innerHTML=virtualclass.lang.getString("reload");b.onclick=function(){d.location.reload()};c.appendChild(b);a=document.getElementById("divForReloadMsg"==a?"virtualclassCont":"virtualclassAppLeftPanel");
a.insertBefore(c,a.firstChild)},displayServerError:function(a,b){a=this.customCreateElement("div",a);a.innerHTML=b;b=document.getElementById("vcanvas");b.parentNode.insertBefore(a,b)},removeElement:function(a){a=document.getElementById(a);null!=a&&a.parentNode.removeChild(a)},disableSSUI:function(){var a=document.getElementById("virtualclassScreenShareTool");null!=a&&(a.style.opacity="0.5",a.style.pointerEvents="none")},disableLeftAppBar:function(){var a=document.getElementById("virtualclassOptionsCont");
null!=a&&(a.style.opacity="0.5",a.style.pointerEvents="none")}};b=b.init();count=0;b.window.resizeFinished=function(){var a=0;return function(b,c){clearTimeout(a);a=setTimeout(b,c)}}();b.window.resize=function(a){a=virtualclass.system.measureResoultion({width:d.innerWidth,height:d.innerHeight});"DocumentShare"==virtualclass.currApp&&(a.width-=10,roles.hasControls()?a.height-=100:a.height-=40);console.log("Container height "+a.height);virtualclass.vutil.setContainerWidth(a,virtualclass.currApp);console.log("Window resize event ");
a=virtualclass.gObj.currWb;"undefined"!=typeof a&&"undefined"!=typeof virtualclass.wb[a]&&virtualclass.wb[a].hasOwnProperty("vcan")&&virtualclass.wb[a].vcan.renderAll();b.windowResizeFinished()};b.windowResizeFinished=function(){clearTimeout(c);c=setTimeout(function(){b._windowResizeFinished()},100)};b._windowResizeFinished=function(){var a=virtualclass.vutil.calculateChatHeight();roles.hasControls()||virtualclass.videoHost.gObj.videoSwitch||(a+=230);console.log("heightinview"+a);virtualclass.vutil.setChatContHeight(a);
virtualclass.isPlayMode&&(a+=64);$("#chat_div").css("max-height",a+"px");virtualclass.chat.boxHeight=a;"Whiteboard"!=virtualclass.currApp&&"DocumentShare"!=virtualclass.currApp||null==virtualclass.gObj.currWb||"undefined"==typeof virtualclass.gObj.currWb||(virtualclass.gObj.hasOwnProperty("fitToScreenOnResize")&&clearTimeout(virtualclass.gObj.fitToScreenOnResize),virtualclass.gObj.fitToScreenOnResize=setTimeout(function(){var a=document.querySelector(".zoomControler .fitScreen");null!=a&&a.click()},
700))};b.virtualWindow.manupulation=function(a){var b=a.message.virtualWindow;if(b.hasOwnProperty("removeVirtualWindow"))a.fromUser.userid!=wbUser.id&&virtualclass.wb[virtualclass.gObj.currWb].utility.removeVirtualWindow("virtualWindow");else if(b.hasOwnProperty("createVirtualWindow"))b.hasOwnProperty("toolHeight")&&localStorage.setItem("toolHeight",b.toolHeight),a.fromUser.userid!=wbUser.id&&virtualclass.wb[virtualclass.gObj.currWb].utility.createVirtualWindow(b.createVirtualWindow);else if(b.hasOwnProperty("shareBrowserWidth")){b.hasOwnProperty("toolHeight")&&
localStorage.setItem("toolHeight",b.toolHeight);if(roles.hasControls()){var c=virtualclass.wb[virtualclass.gObj.currWb].utility.getWideValueAppliedByCss("commandToolsWrapper");localStorage.setItem("toolHeight",c)}a.fromUser.userid!=wbUser.id?(roles.hasControls()&&virtualclass.wb[virtualclass.gObj.currWb].utility.makeCanvasEnable(),otherBrowser=b.browserRes):myBrowser=virtualclass.system.measureResoultion({width:d.outerWidth,height:d.innerHeight});"object"==typeof myBrowser&&"object"==typeof otherBrowser&&
(myBrowser.width>otherBrowser.width?virtualclass.wb[virtualclass.gObj.currWb].gObj.virtualWindow||(virtualclass.wb[virtualclass.gObj.currWb].utility.createVirtualWindow(otherBrowser),virtualclass.wb[virtualclass.gObj.currWb].gObj.virtualWindow=!0):myBrowser.width<otherBrowser.width&&!virtualclass.wb[virtualclass.gObj.currWb].gObj.virtualWindow&&(a=document.getElementById("vcanvas"),a=virtualclass.wb[virtualclass.gObj.currWb].utility.getElementRightOffSet(a),roles.hasControls()?virtualclass.vutil.beforeSend({virtualWindow:{createVirtualWindow:myBrowser-
a,toolHeight:c}}):virtualclass.vutil.beforeSend({virtualWindow:{createVirtualWindow:myBrowser-a}})))}};d.view=b})(window);(function(d){var c={init:function(){this.wbRtc={};this.wbRtc.className="webrtcCont";this.mybrowser={};return this},isCanvasSupport:function(b,a,c){console.log("is canvas support");console.log(b);console.log(a);return"MSIE"==a?9!=c?!1:!0:d.CanvasRenderingContext2D?!0:!1},isWebSocketSupport:function(b,a,c){return"undefined"==typeof d.WebSocket||"function"!=typeof d.WebSocket&&"object"!=typeof d.WebSocket||!d.WebSocket.hasOwnProperty("OPEN")?!1:!0},isLocalStorageSupport:function(){return void 0!==Storage},
isGetUserMediaSupport:function(b,a){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return navigator.getUserMedia?!0:!1},isIndexedDbSupport:function(){return d.indexedDB||d.webkitIndexedDB||d.mozIndexedDB||d.msIndexedDB?!0:!1},isWorkerSupport:function(){return!!d.Worker},isAudioApiSupport:function(){return d.AudioContext||d.webkitAudioContext?!0:!1},isTypedArraySupport:function(){return!!("ArrayBuffer"in d)},isScreenShareSupport:function(b,
a){return"Firefox"==b?34<=a:"Chrome"==b?39<=a?!0:!1:!1},setValue:function(b,a){this[b]=a},checkBrowserFunctions:function(b,a){this.setValue("canvas",this.isCanvasSupport());this.setValue("webSocket",this.isWebSocketSupport());this.setValue("getusermedia",this.isGetUserMediaSupport());this.setValue("indexeddb",this.isIndexedDbSupport());this.setValue("webworker",this.isWorkerSupport());this.setValue("webaudio",this.isAudioApiSupport());this.setValue("typedarray",this.isTypedArraySupport());this.setValue("screenshare",
this.isScreenShareSupport(b,a));this.setValue("localstorage",this.isLocalStorageSupport())},measureResoultion:function(b){var a=document.getElementById("virtualclassCont");a=virtualclass.vutil.getElementOffset(a);var c=a.x;return{width:1024>b.width?1024-(c+10):b.width-(c+350),height:b.height-a.y}},setAppDimension:function(b,a){},setDocCanvasDimension:function(b,a,c){c=document.querySelector("#canvas"+c);null!=c&&(c.width=b,c.height=a)},setCanvasDimension:function(b,a){if("object"==typeof virtualclass.wb[a]){var c=
virtualclass.wb[a].vcan;if("undefined"!=typeof c.main.canvas){var g=c.main.canvas;ctx=c.main.canvas.getContext("2d");g.width=b.width;var h=document.querySelector("#canvasWrapper"+virtualclass.gObj.currWb);h.style.width=g.width+"px";var d=virtualclass.isPlayMode?85:15;d=roles.hasControls()||roles.hasAdmin()?100:"Whiteboard"==virtualclass.currApp?d+30:d;g.height=b.height-d;h.style.height=g.height-30+"px";console.log("canvasWrapper height"+h.style.height);console.log("canvas width "+g.width);b=c.utility.getElementOffset(document.getElementById("canvas"+
a));c.main.offset.x=b.x;console.log("canvas offset x="+c.main.offset.x+" canvas offset y="+b.y)}}},setCanvasWrapperDimension:function(b,a){console.log("Width of canvas wrapper, not seeting ")},getResoultion:function(b){var a={};1280>b?(a.width=1024,a.height=768):1280<=b&&1366>b?(a.width=1280,a.height=1024):1366<=b&&1920>b?(a.width=1366,a.height=768):1920<=b&&(a.width=1920,a.height=1080);return a},reportBrowser:function(b){b=this.getErrors(b);1<b.length?virtualclass.error.push(b.join(",")+" are disabled in your browser."):
1==b.length&&virtualclass.error.push(b+" is disabled in your browser.")},getErrors:function(b){var a=[],c="canvas webSocket getusermedia webaudio indexeddb localstorage typedarray".split(" ");"t"!=b&&"e"!=b||c.push("webworker","screenshare");for(b=0;b<c.length;b++)this[c[b]]||("screenshare"==c[b]&&(virtualclass.gObj.errNotScreenShare=!0),a.push(virtualclass.lang.getString("err"+c[b])));return a},isiOSDevice:function(){return parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||
[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||!1},isAndroid:function(){return-1<navigator.userAgent.toLowerCase().indexOf("android")},isIPad:function(){return/(iPad)/g.test(navigator.userAgent)},setBrowserDetails:function(){var b=this.isiOSDevice();this.device="desktop";if(b){var a="iOS";this.device="mobTab"}else b=this.mybrowser.detection(),a=b[0],b=parseFloat(b[1]);this.mybrowser.name=a;this.mybrowser.version=b},check:function(){var b=this.isiOSDevice();this.device="desktop";
if(b){var a="iOS";this.device="mobTab"}else{var c=this.isAndroid();b=this.mybrowser.detection();a=b[0];b=parseFloat(b[1])}this.mybrowser.name=a;this.mybrowser.version=b;this.checkBrowserFunctions(a,b);"undefined"!=typeof c&&c?(this.device="mobTab",roles.hasControls()?(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("supportDesktopOnly"))):c&&("Chrome"==a?40<=b?virtualclass.vutil.initDisableAudVid():(virtualclass.error.push(virtualclass.error.push(virtualclass.lang.getString("chFireBrowsersIssue",
[a,b]))),virtualclass.vutil.initDisableVirtualClass()):(virtualclass.error.push(virtualclass.error.push(virtualclass.lang.getString("chFireBrowsersIssue",[a,b]))),virtualclass.vutil.initDisableVirtualClass()))):"Chrome"==a&&40<=b||"Firefox"==a&&35<=b||roles.isStudent()&&a=="OPR">b>=26?this.reportBrowser(virtualclass.gObj.uRole):"Chrome"==a&&40>b||"Firefox"==a&&35>b||roles.isStudent()&&"OPR"==a&&26>b?(this.reportBrowser(virtualclass.gObj.uRole),virtualclass.error.push(virtualclass.lang.getString("chFireBrowsersIssue",
[a,b]))):"OPR"==a&&26<=b?(this.reportBrowser(virtualclass.gObj.uRole),roles.hasControls()&&virtualclass.error.push(virtualclass.lang.getString("operaBrowserIssue",[a,b]))):"SafarisupportedOld"==a?8<=b?roles.hasControls()?(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("teacherSafariBrowserIssue",[a,b]))):(virtualclass.vutil.initDisableAudVid(),virtualclass.error.push(virtualclass.lang.getString("studentSafariBrowserIssue",[a,b])),virtualclass.user.control.mediaWidgetDisable()):
(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("safariBrowserIssue",[a,b]))):"iOS"==a?this.isIPad()?roles.isStudent()?8<=b?(virtualclass.vutil.initDisableAudVid(),virtualclass.gObj.iosIpadbAudTrue=!1,a=document.createElement("div"),a.innerHTML=virtualclass.lang.getString("iosAudEnable"),a.id="iosAudioTrigger",a.addEventListener("click",function(){virtualclass.vutil.firstiOSaudioCall();this.parentNode.removeChild(this)}),c=document.getElementById("audioWidget"),
c.parentNode.insertBefore(a,c.nextSibling)):(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("ios7support"))):(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("supportDesktop"))):(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("notSupportIphone"))):this.mybrowser.detectIE()&&(virtualclass.gObj.errIE=!0,virtualclass.error.push(virtualclass.lang.getString("ieBrowserIssue")),
virtualclass.vutil.initDisableVirtualClass())},mediaDevices:{webcamErr:[],getMediaDeviceInfo:function(){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=function(a){navigator.mediaDevices.enumerateDevices().then(a)});var b=[],a="https:"===location.protocol,c=!1;"undefined"!==typeof MediaStreamTrack&&"getSources"in MediaStreamTrack?c=!0:navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(c=!0);var g=this.hasWebcam=this.hasSpeakers=this.hasMicrophone=
!1,h=!1,m=this;(function(f){c&&(!navigator.enumerateDevices&&d.MediaStreamTrack&&d.MediaStreamTrack.getSources&&(navigator.enumerateDevices=d.MediaStreamTrack.getSources.bind(d.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.enumerateDevices&&(navigator.enumerateDevices=navigator.enumerateDevices.bind(navigator)),navigator.enumerateDevices?(b=[],navigator.enumerateDevices(function(c){c.forEach(function(c){var f={},d;for(d in c)f[d]=c[d];"audio"===f.kind&&(f.kind="audioinput");"video"===
f.kind&&(f.kind="videoinput");var n;b.forEach(function(a){a.id===f.id&&a.kind===f.kind&&(n=!0)});n||(f.deviceId||(f.deviceId=f.id),f.id||(f.id=f.deviceId),f.label?("videoinput"!==f.kind||h||(h=!0),"audioinput"!==f.kind||g||(g=!0)):(f.label="Please invoke getUserMedia once.",a||(f.label="HTTPs is required to get label of this "+f.kind+" device.")),"audioinput"===f.kind&&(m.hasMicrophone=!0),"audiooutput"===f.kind&&(m.hasSpeakers=!0),"videoinput"===f.kind&&(m.hasWebcam=!0),b.push(f))});f&&f()})):f&&
f())})()}},webpInit:function(){virtualclass.modernizr.on("webp",function(b){virtualclass.system.webpSupport=b?!0:!1})},initResize:function(){virtualclass.vutil.addClass("virtualclassCont","resizeWindow");c.setAppDimension(null,"resize");virtualclass.view.window.resize()}};c=c.init();d.addEventListener("resize",function(){c.initResize()});c.mybrowser.detectIE=function(){var b=d.navigator.userAgent,a=b.indexOf("MSIE ");if(0<a)return parseInt(b.substring(a+5,b.indexOf(".",a)),10);if(0<b.indexOf("Trident/"))return a=
b.indexOf("rv:"),parseInt(b.substring(a+3,b.indexOf(".",a)),10);a=b.indexOf("Edge/");return 0<a?parseInt(b.substring(a+5,b.indexOf(".",a)),10):!1};c.mybrowser.detection=function(){var b=navigator.userAgent,a=b.match(/(opera|opr|OPR(?=\/))\/?\s*([\d\.]+)/i)||[];if(0>=a.length&&(a=b.match(/(chrome|safari|firefox|trident(?=\/))\/?\s*([\d\.]+)/i)||[],"Safari"==a[1])){var c=b.match(/(version(?=\/))\/?\s*([\d\.]+)/i)||[];a[2]=c[2]}if(/trident/i.test(a[1])){var g=/\brv[ :]+(\d+(\.\d+)?)/g.exec(b)||[];return"IE "+
(g[1]||"")}a=a[2]?[a[1],a[2]]:[navigator.appName,navigator.appVersion,"-?"];null!=(g=b.match(/version\/([\.\d]+)/i))&&(a[2]=g[1]);return a};d.system=c})(window);(function(d){d.packContainer=function(){return{createPacketContDiv:function(c,b){var a=document.createElement("div");"undefined"!=typeof c&&(a.id=c);"undefined"!=typeof b&&(a.clasName=b);return a},togglePacketCont:function(c){for(var b=this.className.split(" "),a=0;a<b.length;a++)if("display"==b[a]){this.className="hide";this.innerHTML="+";c._togglePacketCont(b[a]);break}else if("hide"==b[a]){this.className="display";this.innerHTML="-";c._togglePacketCont(b[a]);break}},_togglePacketCont:function(c){c=
"display"==c?"none":"block";document.getElementById("dataInfoHeading").style.display=c;var b=document.getElementById("packetContainer");b.style.display=c;b=document.getElementById("informationCont");b.style.display=c}}}})(window);(function(d){d.draw_object=function(c,b,a){var f=this;a.started=!1;var g,h,d=[],n=virtualclass.wb[virtualclass.gObj.currWb].vcan;a.mousedown=function(b,g){var h=virtualclass.gObj.currWb;(new Date).getTime();b.detail.hasOwnProperty("cevent")&&(b=virtualclass.wb[virtualclass.gObj.currWb].utility.scaleCordinate(b),b.clientX=b.detail.cevent.x+f.vcan.main.offset.x,b.clientY=b.detail.cevent.y+f.vcan.main.offset.y,b.x=b.detail.cevent.x+f.vcan.main.offset.x,b.y=b.detail.cevent.y+f.vcan.main.offset.y,b.pageX=
b.detail.cevent.x+f.vcan.main.offset.x,b.pageY=b.detail.cevent.y+f.vcan.main.offset.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);g=f.vcan;lastmousemovetime=null;a.startPosX=b.currX;a.startPosY=b.currY;virtualclass.wb[h].gObj.spx=a.startPosX;virtualclass.wb[h].gObj.spy=a.startPosY;if("create"==g.getStates("action")){var d=(new Date).getTime();if("text"!=c&&f.tool.cmd!="t_clearall"+h){if(h=g.getStates("currentTransform"),""==h||null==h)b.detail.hasOwnProperty("cevent")||g.optimize.calculatePackets(d,
"d",a.startPosX,a.startPosY),a.started=!0}else f.obj.drawTextObj.muser=!1,b.detail.hasOwnProperty("cevent")||f.tool.cmd=="t_clearall"+h?f.obj.drawTextObj.muser=!0:f.utility.clickOutSidebox(f.obj.drawTextObj.textWriteMode)&&g.optimize.calculatePackets(d,"d",a.startPosX,a.startPosY),b.detail.hasOwnProperty("cevent")?b.detail.cevent.hasOwnProperty("mtext")?f.obj.drawTextObj.textUtility(a.startPosX,a.startPosY,b.detail.cevent.mtext):f.obj.drawTextObj.textUtility(a.startPosX,a.startPosY):"object"==typeof f.obj.drawTextObj&&
f.obj.drawTextObj.textUtility(a.startPosX,a.startPosY)}"freeDrawing"==c&&1==f.obj.freeDrawObj.freesvg&&(f.obj.freeDrawObj.drawStart(b),console.log("free drawing start x="+b.currX+" drawing y="+b.currY))};a.mousemove=function(b,m){b.detail.hasOwnProperty("cevent")&&(b=virtualclass.wb[virtualclass.gObj.currWb].utility.scaleCordinate(b),b.clientX=b.detail.cevent.x+f.vcan.main.offset.x,b.clientY=b.detail.cevent.y+f.vcan.main.offset.y,b.x=b.detail.cevent.x+f.vcan.main.offset.x,b.y=b.detail.cevent.y+f.vcan.main.offset.y,
b.pageX=b.detail.cevent.x+f.vcan.main.offset.x,b.pageY=b.detail.cevent.y+f.vcan.main.offset.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);if(a.started&&"t_clearall"!=f.tool.cmd)if(void 0!=f.obj.freeDrawObj&&1==f.obj.freeDrawObj.freesvg){if(f.obj.freeDrawObj.fdObj.isCurrentlyDrawing&&(f.obj.freeDrawObj.wb_draw(b),!b.detail.hasOwnProperty("cevent")||b.detail.hasOwnProperty("cevent")&&b.detail.hasOwnProperty("broadCast"))){"undefined"!=typeof m||"undefined"!=typeof lastmousemovetime&&null!=
lastmousemovetime||(lastmousemovetime=(new Date).getTime(),n.optimize.calculatePackets(lastmousemovetime,"m",b.currX,b.currY));var r=(new Date).getTime();r=n.makeStackObj(r,"m",b.currX/virtualclass.zoom.canvasScale,b.currY/virtualclass.zoom.canvasScale);console.log("whiteboard create, move position x ="+b.currX+" y = "+b.currY+" scrollX="+virtualclass.leftPosX+" scrollY="+virtualclass.topPosY);d.push(r);if("undefined"==typeof m&&(presentmousemovetime=(new Date).getTime(),2E3<=presentmousemovetime-
lastmousemovetime)){for(b=0;b<d.length;b++)f.uid++,d[b].uid=f.uid,n.main.replayObjs.push(d[b]),console.log("free drawing move x="+d[b].x+" drawing y="+d[b].y);virtualclass.vutil.beforeSend({repObj:d,cf:"repObj"});virtualclass.storage.store(JSON.stringify(n.main.replayObjs));d=[];lastmousemovetime=(new Date).getTime()}}}else{g=b.currX;h=b.currY;""!=f.prvObj&&f.canvas.removeObject(f.prvObj);m=f.makeobj(a.startPosX,a.startPosY,g,h,c);m=f.canvas.readyObject(m);f.canvas.addObject(m);m.coreObj.usrCurrAction=
"create";r=(new Date).getTime();if("undefined"==typeof lastmousemovetime||null==lastmousemovetime)lastmousemovetime=(new Date).getTime(),(!b.detail.hasOwnProperty("cevent")||b.detail.hasOwnProperty("cevent")&&b.detail.hasOwnProperty("broadCast"))&&"text"!=c&&"t_clearall"!=f.tool.cmd&&n.optimize.calculatePackets(r,"m",g,h);presentmousemovetime=(new Date).getTime();2E3<=presentmousemovetime-lastmousemovetime&&((!b.detail.hasOwnProperty("cevent")||b.detail.hasOwnProperty("cevent")&&b.detail.hasOwnProperty("broadCast"))&&
"text"!=c&&"t_clearall"!=f.tool.cmd&&n.optimize.calculatePackets(r,"m",g,h),lastmousemovetime=(new Date).getTime());f.prvObj=m.coreObj}else"move"==f.vcan.main.action&&(""!=n.main.currentTransform&&null!=n.main.currentTransform||"move"!=f.vcan.main.action)||virtualclass.vutil.beforeSend({createArrow:!0,x:b.currX/virtualclass.zoom.canvasScale,y:b.currY/virtualclass.zoom.canvasScale,cf:"createArrow"})};a.mouseup=function(b,m){b.detail.hasOwnProperty("cevent")&&(b.clientX=b.detail.cevent.x+f.vcan.main.offset.x,
b.clientY=b.detail.cevent.y+f.vcan.main.offset.y,b.x=b.detail.cevent.x+f.vcan.main.offset.x,b.y=b.detail.cevent.y+f.vcan.main.offset.y,b.pageX=b.detail.cevent.x+f.vcan.main.offset.x,b.pageY=b.detail.cevent.y+f.vcan.main.offset.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);g=b.currX;h=b.currY;lastmousemovetime=null;if(a.started&&"text"!=c){a.mousemove(b,"up");(!b.detail.hasOwnProperty("cevent")||b.detail.hasOwnProperty("cevent")&&b.detail.hasOwnProperty("broadCast"))&&"freeDrawing"!=c&&(m=
(new Date).getTime(),n.optimize.calculatePackets(m,"u",g,h));if(void 0!=f.obj.freeDrawObj&&1==f.obj.freeDrawObj.freesvg&&(f.obj.freeDrawObj.fdObj.isCurrentlyDrawing&&f.obj.freeDrawObj.finalizeDraw(b),(!b.detail.hasOwnProperty("cevent")||b.detail.hasOwnProperty("cevent")&&b.detail.hasOwnProperty("broadCast"))&&0<d.length)){m=(new Date).getTime();b=n.makeStackObj(m,"u",g/virtualclass.zoom.canvasScale,h/virtualclass.zoom.canvasScale);d.push(b);for(b=0;b<d.length;b++)f.uid++,d[b].uid=f.uid,n.main.replayObjs.push(d[b]);
virtualclass.vutil.beforeSend({repObj:d,cf:"repObj"});virtualclass.storage.store(JSON.stringify(n.main.replayObjs));d=[]}""!=f.prvObj&&(f.prvObj="");f.prvObj="";a.started=!1}f.vcan.wb.sentPack&&(f.vcan.wb.sentPack=!1)}}})(window);(function(d){d.makeobj=function(c,b,a,f,g){var h={mp:{}};h.mp.x=a;h.mp.y=f;var d=2*virtualclass.zoom.canvasScale;if(c>a){var n=a,r=f;a=c;f=b;c=n;b=r;h.dRoad="b2t"}else h.dRoad="t2b";h.type=g;if("rectangle"==g||"triangle"==g)h.sx=c,h.sy=b,h.ex=a,h.ey=f;if("line"==g)h.lineColor="#424240",h.lineWidth=d,h.start={x:c,y:b},h.end={x:a,y:f};else if("rectangle"==g)h.width=a-c,h.height=f-b,h.borderColor="#424240",h.lineWidth=d;else if("oval"==g)h.lineWidth=d,h.borderColor="#424240",h.width=a-c,h.height=f-b,
h.x=a-h.width/2,h.y=f-h.height/2,h.rx=h.width/2,h.ry=h.height/2;else if("triangle"==g)h.lineWidth=d,h.borderColor="#424240";else if("text"==g)return;return h}})(window);newScrollVal=0;
(function(d){d.vcanUtility=function(c){var b=virtualclass.wb[c].vcan;b.utility={canvasCalcOffset:function(a){var c=b.main;a=document.getElementById(a);a=b.utility.getElementOffset(a);0==a.x&&(a.x=53,a.y=48);return c.offset=a},getElementOffset:function(a){var b=0,c=0;do b+=a.offsetTop||0,c+=a.offsetLeft||0,a=a.offsetParent;while(a);return{x:c,y:b}},setVal:function(a,c,g){("scaleX"===c||"scaleY"===c)&&g<a.MIN_SCALE_LIMIT&&(g=a.MIN_SCALE_LIMIT);if("object"==typeof c)for(var f in c)b.utility.setVal(a,f,
c[f]);else"angle"===c?b.utility.setAngle(a,g):a[c]=g;return a},getVal:function(a,b){return a[b]},setAngle:function(a,b){a.theta=b/180*Math.PI;a.angle=b;return a},actualPointer:function(a){var c=0,g=0;null!=virtualclass.gObj.currWb&&(c="undefined"==typeof virtualclass.pdfRender[virtualclass.gObj.currWb].topPosY?0:virtualclass.pdfRender[virtualclass.gObj.currWb].topPosY,g="undefined"==typeof virtualclass.pdfRender[virtualclass.gObj.currWb].leftPosX?0:virtualclass.pdfRender[virtualclass.gObj.currWb].leftPosX);
return{x:b.utility.pointerX(a)+g,y:b.utility.pointerY(a)+c}},pointerX:function(a){var b=document.documentElement,c=document.body||{scrollLeft:0};return("unknown"!=typeof a.clientX?a.clientX:0)+(b.scrollLeft||c.scrollLeft)-(b.clientLeft||0)},pointerYOld:function(a){var b=document.documentElement,c=document.body||{scrollTop:0};return("unknown"!=typeof a.clientY?a.clientY:0)+(b.scrollTop||c.scrollTop)-(b.clientTop||0)},pointerY:function(a){var b=document.documentElement,c=document.body||{scrollTop:0};
newScrollVal=(b.scrollTop||c.scrollTop)-(b.clientTop||0);return("unknown"!=typeof a.clientY?a.clientY:0)+newScrollVal},getReltivePoint:function(a){var c=b.main.offset;a=b.utility.actualPointer(a);return{x:a.x-c.x,y:a.y-c.y}},degreesToRadians:function(a){return Math.PI/180*a},setActiveObject:function(a){b.main.activeObject&&b.main.activeObject.setActive(!1);b.main.activeObject=a;a.setActive(!0);return a},updateObj:function(a){var b={};for(prop in a)"oCoords"!=prop?b[prop]=a[prop]:(b.start={},b.end=
{},b.start.x=a[prop].tl.x,b.start.y=a[prop].tl.y,b.end.x=a[prop].br.x,b.end.y=a[prop].br.y);return b},setCursorFromEvent:function(a,b,c){var f=a.upperCanvasEl.style;if(c)if(b=c.findTargetCorner(b))if(b in a.cursorMap)f.cursor=a.cursorMap[b];else if("mtr"===b&&c.hasRotatingPoint)f.cursor=a.rotationCursor;else return f.cursor=this.defaulCursor,!1;else f.cursor=a.hoverCursor;else return f.cursor=this.defaultCursor,!1;return!0},getChildren:function(){return b.main.children},isCeventExist:function(a){return a.hasOwnProperty("detail")?
a.hasOwnProperty("cevent"):!1},updateCordinate:function(a){a=b.utility.actualPointer(a);var c={detail:{}};c.clientX=a.x;c.clientY=a.y;return c}}}})(window);(function(d){d.vcanMain=function(c){var b=virtualclass.wb[c].vcan;b.main.prototype={addObject:function(a){if("object"==typeof a.coreObj){"freehand"!=a.coreObj.type&&b.main.children.push(a.coreObj);var c=b.main.canvas.getContext("2d");b.render(c,a.coreObj)}},removeObject:function(a){b.remove(a)},bind:function(a,c){b.events().bind(b.main.canvas,a,c)},readyObject:function(a,c){a=b.extend({},a);c||void 0!=a.id||(b.main.id++,a.id=b.main.id);a.rotatingPointOffset=40;a.selectable=!0;a.downObj=!1;a.active=
!1;a.cornersize=12;a.padding=0;a.hasControls=!0;a.cornerColor="rgba(102,153,255,0.5)";void 0==a.borderColor&&(a.borderColor="#000");a.flipX=!1;a.flipY=!1;a.draggable=!1;a.hasBorders=!0;a.hasRotatingPoint=!1;a.hideCorners=!1;a.lockRotation=!1;a.MIN_SCALE_LIMIT=.1;a.borderOpacityWhenMoving=.4;a.hasOwnProperty("theta")||(a.theta=0);a.hasOwnProperty("scaleX")||(a.scaleX=1);a.hasOwnProperty("scaleY")||(a.scaleY=1);"line"==a.type?(b.objLine=new b.line,b.objLine.init(a)):"rectangle"==a.type?(b.objRect=new b.rectangle,
b.objRect.init(a)):"oval"==a.type?(b.objOval=new b.oval,b.objOval.init(a)):"triangle"==a.type?(b.objTri=new b.triangle,b.objTri.init(a)):"text"==a.type&&(b.objTxt=new b.text,b.objTxt.init(a));a.getWidth=function(){return this.width*this.scaleX};a.getHeight=function(){return this.height*this.scaleY};a.setCoords=function(){this.currentWidth=this.width*this.scaleX;this.currentHeight=this.height*this.scaleY;this.hypotenuse=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));this.angle=
Math.atan(this.currentHeight/this.currentWidth);var c=this.theta=this.theta,f=Math.sin(c);c=Math.cos(c);var d={x:this.x-Math.cos(this.angle+this.theta)*this.hypotenuse,y:this.y-Math.sin(this.angle+this.theta)*this.hypotenuse},n={x:d.x+this.currentWidth*c,y:d.y+this.currentWidth*f},r={x:d.x-this.currentHeight*f,y:d.y+this.currentHeight*c};this.oCoords={tl:d,tr:n,br:{x:n.x-this.currentHeight*f,y:n.y+this.currentHeight*c},bl:r,ml:{x:d.x-this.currentHeight/2*f,y:d.y+this.currentHeight/2*c},mt:{x:d.x+
this.currentWidth/2*c,y:d.y+this.currentWidth/2*f},mr:{x:n.x-this.currentHeight/2*f,y:n.y+this.currentHeight/2*c},mb:{x:r.x+this.currentWidth/2*c,y:r.y+this.currentWidth/2*f},mtr:{x:d.x+this.currentWidth/2*c,y:d.y+this.currentWidth/2*f}};this.setCornerCoords();a.findTargetCorner=function(c){var f=b.main.offset;if(!this.hasControls)return!1;var g=b.utility.actualPointer(c);c=g.x-f.x;f=g.y-f.y;for(var h in this.oCoords){if("mtr"===h&&!this.hasRotatingPoint)break;g=b.virtual_box.getImageLines(this.oCoords[h].corner,
h);g=b.virtual_box.findCrossPoints(c,f,g);if(1==g%2&&0!=g)return a.corner=h}return!1};return this};a.drawBorders=function(a){if(this.hasBorders){var b=this.padding,c=2*b;a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;var f=1/(this.scaleX<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleX),g=1/(this.scaleY<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleY);a.lineWidth=1/this.borderScaleFactor;a.scale(f,g);f=this.getWidth();g=this.getHeight();
a.strokeRect(~~(-(f/2)-b)+.5,~~(-(g/2)-b)+.5,~~(f+c),~~(g+c));!this.hasRotatingPoint||this.hideCorners||this.lockRotation||(b=(this.flipY?g:-g)/2,a.beginPath(),a.moveTo(0,b),a.lineTo(0,b+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),a.closePath(),a.stroke());a.restore();return this}};a.drawCorners=function(a){if(this.hasControls){var b=8*virtualclass.zoom.canvasScale,c=b/2,f=this.padding,g=-(this.width/2),d=-(this.height/2),z=b/this.scaleX,t=b/this.scaleY,v=(f+c)/this.scaleY,q=
(f+c)/this.scaleX,w=(f+c-b)/this.scaleX;c=(f+c-b)/this.scaleY;f=this.height;a.save();a.fillStyle=this.cornerColor;a.fillRect(g-q,d-v,z,t);b=g+this.width-q;a.fillRect(b,d-v,z,t);a.fillRect(g-q,d+f+c,z,t);b=g+this.width+w;a.fillRect(b,d+f+c,z,t);b=g+this.width/2-q;a.fillRect(b,d-v,z,t);b=g+this.width/2-q;a.fillRect(b,d+f+c,z,t);b=g+this.width+w;a.fillRect(b,d+f/2-v,z,t);a.fillRect(g-q,d+f/2-v,z,t);this.hasRotatingPoint&&(b=g+this.width/2-q,g=this.flipY?d+f+this.rotatingPointOffset/this.scaleY-t/2:d-
this.rotatingPointOffset/this.scaleY-t/2,a.fillRect(b,g,z,t));a.restore();return this}};a.setActive=function(a){this.active=!!a;return this};a.dragDrop=function(a){this.draggable=void 0!=a?a:!1};a.setCornerCoords=function(){var a=this.oCoords,c=b.utility.degreesToRadians(45-this.getAngle()),f=Math.sqrt(2*Math.pow(this.cornersize,2))/2,d=f*Math.cos(c);c=f*Math.sin(c);f=Math.sin(this.theta);var r=Math.cos(this.theta);a.tl.corner={tl:{x:a.tl.x-c,y:a.tl.y-d},tr:{x:a.tl.x+d,y:a.tl.y-c},bl:{x:a.tl.x-d,
y:a.tl.y+c},br:{x:a.tl.x+c,y:a.tl.y+d}};a.tr.corner={tl:{x:a.tr.x-c,y:a.tr.y-d},tr:{x:a.tr.x+d,y:a.tr.y-c},br:{x:a.tr.x+c,y:a.tr.y+d},bl:{x:a.tr.x-d,y:a.tr.y+c}};a.bl.corner={tl:{x:a.bl.x-c,y:a.bl.y-d},bl:{x:a.bl.x-d,y:a.bl.y+c},br:{x:a.bl.x+c,y:a.bl.y+d},tr:{x:a.bl.x+d,y:a.bl.y-c}};a.br.corner={tr:{x:a.br.x+d,y:a.br.y-c},bl:{x:a.br.x-d,y:a.br.y+c},br:{x:a.br.x+c,y:a.br.y+d},tl:{x:a.br.x-c,y:a.br.y-d}};a.ml.corner={tl:{x:a.ml.x-c,y:a.ml.y-d},tr:{x:a.ml.x+d,y:a.ml.y-c},bl:{x:a.ml.x-d,y:a.ml.y+c},br:{x:a.ml.x+
c,y:a.ml.y+d}};a.mt.corner={tl:{x:a.mt.x-c,y:a.mt.y-d},tr:{x:a.mt.x+d,y:a.mt.y-c},bl:{x:a.mt.x-d,y:a.mt.y+c},br:{x:a.mt.x+c,y:a.mt.y+d}};a.mr.corner={tl:{x:a.mr.x-c,y:a.mr.y-d},tr:{x:a.mr.x+d,y:a.mr.y-c},bl:{x:a.mr.x-d,y:a.mr.y+c},br:{x:a.mr.x+c,y:a.mr.y+d}};a.mb.corner={tl:{x:a.mb.x-c,y:a.mb.y-d},tr:{x:a.mb.x+d,y:a.mb.y-c},bl:{x:a.mb.x-d,y:a.mb.y+c},br:{x:a.mb.x+c,y:a.mb.y+d}};a.mtr.corner={tl:{x:a.mtr.x-c+f*this.rotatingPointOffset,y:a.mtr.y-d-r*this.rotatingPointOffset},tr:{x:a.mtr.x+d+f*this.rotatingPointOffset,
y:a.mtr.y-c-r*this.rotatingPointOffset},bl:{x:a.mtr.x-d+f*this.rotatingPointOffset,y:a.mtr.y+c-r*this.rotatingPointOffset},br:{x:a.mtr.x+c+f*this.rotatingPointOffset,y:a.mtr.y+d-r*this.rotatingPointOffset}}};a.getAngle=function(){return 180*this.theta/Math.PI};a.setZindex=function(){for(var a=0;a<b.main.children.length;a++)if(this.id==b.main.children[a].id){var c=b.main.children[a];b.main.children.splice(a,1);break}return" "!=c?(b.main.children.push(c),!0):!1};a.setupCurrentTransform=function(a){var c=
b.main,f="drag",g=b.utility.actualPointer(a);if(a=this.findTargetCorner(a))f="ml"===a||"mr"===a?"scaleX":"mt"===a||"mb"===a?"scaleY":"mtr"===a?"rotate":this.hasRotatingPoint?"scale":"rotate";c.currentTransform={target:this,action:f,scaleX:this.scaleX,scaleY:this.scaleY,offsetX:g.x-this.x,offsetY:g.y-this.y,ex:g.x,ey:g.y,x:this.x,y:this.y,theta:this.theta,width:this.width*this.scaleX};c.currentTransform.original={x:this.x,y:this.y}};"text"!=a.type&&a.setCoords();return b.makeDispObject(a)}}}})(window);(function(d){d.Events=function(c){var b=virtualclass.wb[c].vcan;b.events=function(){return{bind:function(a,b,c){a["on"+b]=c},findTarget:function(a){for(var c,g=b.main.children,d=g.length;d--;)if(g[d]&&b.virtual_box.containsPoint(a,g[d])){c=g[d];break}if(c&&c.selectable)return c}}}}})(window);(function(d){d.Virtualbox=function(c){var b=virtualclass.wb[c].vcan;b.virtual_box={findCrossPoints:function(a,b,c){var f=0,g;for(g in c){var d=c[g];if(!(d.o.y<b&&d.d.y<b||d.o.y>=b&&d.d.y>=b)){if(d.o.x==d.d.x&&d.o.x>=a)var r=d.o.x;else{r=(d.d.y-d.o.y)/(d.d.x-d.o.x);var A=b-0*a;d=d.o.y-r*d.o.x;r=-(A-d)/(0-r)}r>=a&&(f+=1);if(2==f)break}}return f},getImageLines:function(a,b){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},containsPoint:function(a,
c){var f=b.utility.getReltivePoint(a),d=f.x;f=f.y;var m=b.virtual_box.getImageLines(c.oCoords);return(d=b.virtual_box.findCrossPoints(d,f,m))&&1===d%2||c.findTargetCorner(a)?!0:!1}}}})(window);(function(d){d.Interact=function(c){var b=virtualclass.wb[c].vcan;b.interact={rotateObject:function(a,c){var f=b.main.currentTransform,d=b.main.offset;f.target.lockRotation||b.utility.setVal(f.target,"theta",Math.atan2(c-f.y-d.y,a-f.x-d.x)-Math.atan2(f.ey-f.y-d.y,f.ex-f.x-d.x)+f.theta)},scaleObject:function(a,c,g){var f=b.main.currentTransform,d=b.main.offset;target=f.target;if(!target.lockScalingX||!target.lockScalingY){var n=Math.sqrt(Math.pow(f.ey-f.y-d.y,2)+Math.pow(f.ex-f.x-d.x,2));a=Math.sqrt(Math.pow(c-
f.y-d.y,2)+Math.pow(a-f.x-d.x,2));target.scaling=!0;g?"x"!==g||target.lockUniScaling?"y"!==g||target.lockUniScaling||target.lockScalingY||b.utility.setVal(target,"scaleY",f.scaleY*a/n):target.lockScalingX||b.utility.setVal(target,"scaleX",f.scaleX*a/n):(target.lockScalingX||b.utility.setVal(target,"scaleX",f.scaleX*a/n),target.lockScalingY||b.utility.setVal(target,"scaleY",f.scaleY*a/n))}},translateObject:function(a,c){var f=b.main.currentTransform.target;f.lockMovementX||b.utility.setVal(f,"x",a-
b.main.currentTransform.offsetX);f.lockMovementY||b.utility.setVal(f,"y",c-b.main.currentTransform.offsetY);return f}}}})(window);(function(d){d.Rectangle=function(c){virtualclass.wb[c].vcan.rectangle=function(){return{type:"rectangle",init:function(b){void 0==b.x&&(b.x=b.ex-b.width/2);void 0==b.y&&(b.y=b.ey-b.height/2);return b},draw:function(b,a,c){c=-a.width/2;var f=-a.height/2,d=a.width,m=a.height;b.beginPath();b.strokeStyle=void 0!=a.borderColor?'"'+a.strokeColor+'"':"#000";b.moveTo(c,f);b.stroke();b.lineTo(c+d,f);b.stroke();b.lineTo(c+d,f+m);b.stroke();b.lineTo(c,f+m);b.stroke();b.lineTo(c,f);b.fillStyle=void 0!=a.fillColor?
a.fillColor:" ";b.closePath();b.stroke();void 0!=a.fillColor&&(b.fillStyle=a.fillColor,b.fill())}}}}})(window);(function(d){d.Oval=function(c){virtualclass.wb[c].vcan.oval=function(){return{type:"oval",init:function(b){void 0==b.width&&(b.width=2*b.rx);void 0==b.height&&(b.height=2*b.ry);void 0==b.borderColor&&(b.borderColor="#000000");void 0!=b.fillColor&&(b.fillStyle=b.fillColor);return b},draw:function(b,a,c){b.beginPath();b.save();var f=2*Math.PI;b.lineWidth=a.lineWidth;var d=a.ry/a.rx;d=d.toFixed(3);0==d&&(d=.01);b.transform(1,0,0,d,0,0);b.arc(c?a.x:0,c?a.y:0,a.rx,0,f,!1);b.closePath();void 0!=a.fillStyle&&
(b.fillStyle=a.fillStyle,b.fill());void 0!=a.borderColor&&(b.fillStyle=a.borderColor,b.stroke());b.restore()}}}}})(window);(function(d){d.Triangle=function(c){virtualclass.wb[c].vcan.triangle=function(){return{type:"triangle",init:function(b){b.fillStyle=b.fillColor;void 0==b.dRoad&&(b.dRoad="ltr");void 0==b.width&&(b.width=b.ex-b.sx);void 0==b.height&&(b.height=b.ey-b.sy);void 0==b.x&&(b.x=b.ex-b.width/2);void 0==b.y&&(b.y=b.ey-b.height/2);return b},draw:function(b,a,c){b.beginPath();if("t2b"==a.dRoad){c=a.width/2;var f=a.height/2}else c=-a.width/2,f=-a.height/2;b.lineWidth=a.lineWidth;void 0!=a.borderColor&&(b.strokeStyle=
a.borderColor);b.moveTo(-c,f);b.lineTo(0,-f);b.lineTo(c,f);b.closePath();void 0!=a.fillStyle&&(b.fillStyle=a.fillStyle,b.fill());b.stroke()}}}}})(window);(function(d){d.Line=function(c){virtualclass.wb[c].vcan.line=function(){return{type:"line",init:function(b){var a=b.start.x,c=b.start.y,g=b.end.x,d=b.end.y;void 0==b.width&&(b.width=g-a,b.height=d-c);b.x=a+(g-a)/2;b.y=c+(d-c)/2;return b},draw:function(b,a,c){b.beginPath();c=1===a.width?0:a.width/2;var f=1===a.height?0:a.height/2;b.moveTo(1===a.width?0:-a.width/2,1===a.height?0:-a.height/2);b.lineTo(c,f);b.lineWidth=a.lineWidth;void 0!=a.lineColor&&(b.strokeStyle=a.lineColor);b.closePath();b.stroke()}}}}})(window);(function(d){d.Text=function(c){virtualclass.wb[c].vcan.text=function(){return{type:"text",init:function(b){b.lineHeight=1.3;void 0==b.fontSize&&(b.fontSize=30);b.fontSize*=virtualclass.zoom.canvasScale;b.font=b.fontSize+"px Times New Roman";return b},draw:function(b,a,c){b.font=a.font;c=a.text.split(/\r?\n/);a.height=this.getTextHeight(b,c,a);a.width=this.getTextWidth(b,c);b.beginPath();for(var f=0,d=c.length;f<d;f++)b.fillText(c[f],-a.width/2,-a.height/2+f*a.fontSize*a.lineHeight+a.fontSize);b.closePath();
a.setCoords()},getTextWidth:function(b,a){for(var c=b.measureText(a[0]).width,g=1,d=a.length;g<d;g++){var m=b.measureText(a[g]).width;m>c&&(c=m)}return c},getTextHeight:function(b,a,c){return c.fontSize*a.length*c.lineHeight},removeTextNode:function(){for(var b=document.getElementsByClassName("textBoxContainer"),a=0;a<b.length;a++)b[a].parentNode.removeChild(b[a])}}}}})(window);(function(d){d.FreeHandDrawing=function(c){var b=virtualclass.wb[c].vcan;b.main.freeHandDrawing=function(a){return{type:"freeDrawing",init:function(){this.contextTop={};this.isCurrentlyDrawing=!1;this.freeDrawingXPoints=[];this.freeDrawingYPoints=[];this.mdTime=[];this.freeDrawingColor=void 0==a.borderColor?"#000000":a.borderColor;this.freeDrawingLineWidth=void 0!=a.lineWidth?a.lineWidth*virtualclass.zoom.canvasScale:3*virtualclass.zoom.canvasScale;return this},fhdStart:function(a,b,c){c=(new Date).getTime();
this.contextTop=a;this.isCurrentlyDrawing=!0;this.freeDrawingXPoints.push(b.x);this.freeDrawingYPoints.push(b.y);this.contextTop.beginPath();this.contextTop.save();this.contextTop.moveTo(b.x,b.y);this.mdTime.push(c);this.contextTop.strokeStyle=this.freeDrawingColor;this.contextTop.lineWidth=this.freeDrawingLineWidth;this.contextTop.lineCap=this.contextTop.lineJoin="round"},fhRendering:function(a,b){b=(new Date).getTime();this.freeDrawingXPoints.push(a.x);this.freeDrawingYPoints.push(a.y);this.contextTop.lineTo(a.x,
a.y);this.contextTop.stroke();this.mdTime.push(b)},finalizeDrawingPath:function(c,g,d){(new Date).getTime();this.contextTop.closePath();this.isCurrentlyDrawing=!1;var f=this.utility.min(this.freeDrawingXPoints);g=this.utility.min(this.freeDrawingYPoints);var h=this.utility.max(this.freeDrawingXPoints);d=this.utility.max(this.freeDrawingYPoints);var r=[],A,z,t,v=this.freeDrawingXPoints,q=this.freeDrawingYPoints,w=this.mdTime;r.push("M ",v[0]-f," ",q[0]-g," ",w[0]," ");for(var p=1;A=v[p],z=q[p],t=w[p];p++)r.push("L ",
A-f," ",z-g," ",t," ");r=r.join("");if("M 0 0 L 0 0 "!==r)return A=this.freeDrawingXPoints[this.freeDrawingXPoints.length-1],z=this.freeDrawingYPoints[this.freeDrawingYPoints.length-1],t=new b.Path(r,this),t.mp={},t.mp.x=A,t.mp.y=z,t.init(r),t=c.readyObject(t),t.coreObj.type="freeDrawing",t=t.coreObj,t.fill=null,t.stroke=this.freeDrawingColor,t.strokeWidth=this.freeDrawingLineWidth,t.minX=f,t.minY=g,this.utility.objAdd(t),c=b.utility.setVal(t,"x",f+(h-f)/2),c=b.utility.setVal(c,"y",g+(d-g)/2),c.setCoords(),
"object"==typeof a&&this.contextTop.restore(),b.renderAll(this.contextTop),c},utility:{max:function(a,b){if(a&&0!==a.length){var c=a.length-1,f=b?a[c][b]:a[c];if(b)for(;c--;)a[c][b]>=f&&(f=a[c][b]);else for(;c--;)a[c]>=f&&(f=a[c]);return f}},min:function(a,b){if(a&&0!==a.length){var c=a.length-1,f=b?a[c][b]:a[c];if(b)for(;c--;)a[c][b]<f&&(f=a[c][b]);else for(;c--;)a[c]<f&&(f=a[c]);return f}},objAdd:function(a){b.main.children.push(a);return this}}}}}})(window);(function(d){d.Path=function(c){var b=virtualclass.wb[c].vcan;b.Path=function(a,c){return{objectType:"path",init:function(a,b){b=b||{};this.commandLengths={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7};if(!a)throw Error("`path` argument is required");if(this.path=a.match&&a.match(/[a-zA-Z][^a-zA-Z]*/g))return this.initializeFromArray(b),this},initializeFromArray:function(a){var b="width"in a,c="height"in a;this.path=this._parsePath();b&&c||(this.utility.extend(this,this._parseDimensions()),b&&(this.width=
a.width),c&&(this.height=a.height))},_render:function(a){for(var b,c,f=-(this.width/2),g=-(this.height/2),d=0,z=this.path.length;d<z;++d)switch(b=this.path[d],b[0]){case "L":c=b[1];b=b[2];a.lineTo(c+f,b+g);break;case "M":c=b[1],b=b[2],a.moveTo(c+f,b+g)}},replay_render:function(a,b,c,f){var g=y=0;switch(b[0]){case "L":g+=b[1];y+=b[2];a.lineTo(g+c,y+f);a.stroke();break;case "M":g+=b[1],y+=b[2],a.moveTo(g+c,y+f)}},render:function(a,c){a.save();var f=this.transformMatrix;f&&a.transform(f[0],f[1],f[2],
f[3],f[4],f[5]);c||b.transform(a,this);this.overlayFill?a.fillStyle=this.overlayFill:this.fill&&(a.fillStyle=this.fill);this.stroke&&(a.strokeStyle=this.stroke);a.beginPath();this._render(a);this.fill&&a.fill();this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=this.strokeWidth,a.lineCap=a.lineJoin="round",a.stroke());!c&&this.active&&(this.drawBorders(a),this.hideCorners||this.drawCorners(a));a.restore()},_parsePath:function(){for(var a=[],b,c,f,d=0,A,z=this.path.length;d<z;d++){var t=/\d+\s$/.exec(this.path[d]);
null!=t&&(b=this.path[d].indexOf(t),this.path[d]=this.path[d].substring(0,b));b=this.path[d];c=b.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/);b=[b.charAt(0)];A=0;for(var v=c.length;A<v;A++)f=parseFloat(c[A]),isNaN(f)||b.push(f);c=b[0].toLowerCase();c=this.commandLengths[c];if(b.length-1>c)for(f=1,A=b.length;f<A;f+=c)null==t?a.push([b[0]].concat(b.slice(f,f+c))):(a.push([b[0]].concat(b.slice(f,f+c))),b.push(t),a.push(b));else null!=t&&b.push(t[0]),a.push(b)}return a},_parseDimensions:function(){var a=
[],b=[],f,d,r=!1,A,z;this.path.forEach(function(c,g){if(" "!=c[3])var h=c.splice(3);"H"!==c[0]&&(f=0===g?this.utility.getX(c):this.utility.getX(this.path[g-1]));"V"!==c[0]&&(d=0===g?this.utility.getY(c):this.utility.getY(this.path[g-1]));c[0]===c[0].toLowerCase()&&(r=!0);A=r?f+this.utility.getX(c):"V"===c[0]?f:this.utility.getX(c);z=r?d+this.utility.getY(c):"H"===c[0]?d:this.utility.getY(c);g=parseInt(A,10);isNaN(g)||a.push(g);g=parseInt(z,10);isNaN(g)||b.push(g);void 0!=h&&1<=h.length&&c.push(h[0])},
this);var t=c.utility.min(a);t={y:c.utility.min(b)-0,x:t-0,bottom:c.utility.max(b)-0,right:c.utility.max(a)-0};t.width=t.right-t.x;t.height=t.bottom-t.y;return t},utility:{getX:function(a){return"H"===a[0]?a[1]:a[a.length-2]},getY:function(a){return"V"===a[0]?a[1]:a[a.length-1]},extend:function(a,b){for(var c in b)a[c]=b[c];return a}}}}}})(window);(function(d){d.Mouse=function(c){var b=virtualclass.wb[c].vcan;b.mouse=function(){return{init:function(){this.bindHandlers()},bindHandlers:function(){canvasElement=b.main.canvas;var a={mousedown:"mousedown",mousemove:"mousemove",mouseup:"mouseup"},c;for(c in a)"mousedown"==c?canvasElement.addEventListener(c,this.mousedown,!1):"mousemove"==c?canvasElement.addEventListener(c,this.mousemove,!1):"mouseup"==c&&canvasElement.addEventListener(c,this.mouseup,!1)},mousedown:function(a,c){b.utility.getReltivePoint(a);
a.detail.hasOwnProperty("cevent")&&"create"!=b.main.action&&(a=virtualclass.wb[virtualclass.gObj.currWb].utility.putScrollWithCevent(a),a.clientX=b.main.offset.x+a.detail.cevent.x,a.clientY=b.main.offset.y+a.detail.cevent.y,a.x=b.main.offset.x+a.detail.cevent.x,a.y=b.main.offset.y+a.detail.cevent.y,a.pageX=b.main.offset.x+a.detail.cevent.x,a.pageY=b.main.offset.y+a.detail.cevent.y,a.currX=a.detail.cevent.x,a.currY=a.detail.cevent.y);lastmousemovetime=null;this.moveChunk=[];"move"==b.main.action?b.main.currentTransform||
((c=b.events().findTarget(a))?(0<b.main.children.length&&c.setZindex(),c.downObj=!0,c.setupCurrentTransform(a),b.utility.setActiveObject(c),b.main.currObj=c):b.deactivateAll(),void 0!=c&&b.renderAll(),a.detail.hasOwnProperty("cevent")||(roles.hasControls()&&(a=b.utility.updateCordinate(a)),c=(new Date).getTime(),a=b.makeStackObj(c,"d",a.clientX-b.main.offset.x,a.clientY-b.main.offset.y),a.x/=virtualclass.zoom.canvasScale,a.y/=virtualclass.zoom.canvasScale,virtualclass.wb[virtualclass.gObj.currWb].uid++,
console.log("uid "+virtualclass.wb[virtualclass.gObj.currWb].uid),a.uid=virtualclass.wb[virtualclass.gObj.currWb].uid,b.main.replayObjs.push(a),virtualclass.vutil.beforeSend({repObj:[a],cf:"repObj"}))):"create"==b.main.action&&(a.detail.hasOwnProperty("cevent")&&(a.clientX=a.detail.cevent.x+virtualclass.wb[virtualclass.gObj.currWb].vcan.main.offset.x,a.clientY=a.detail.cevent.y+virtualclass.wb[virtualclass.gObj.currWb].vcan.main.offset.y,a.x=a.detail.cevent.x+virtualclass.wb[virtualclass.gObj.currWb].vcan.main.offset.x,
a.y=a.detail.cevent.x+virtualclass.wb[virtualclass.gObj.currWb].vcan.main.offset.y,a.pageX=a.detail.cevent.x+virtualclass.wb[virtualclass.gObj.currWb].vcan.main.offset.x,a.pageY=a.detail.cevent.y+virtualclass.wb[virtualclass.gObj.currWb].vcan.main.offset.y,a.currX=a.detail.cevent.x,a.currY=a.detail.cevent.y),(c=b.events().findTarget(a))&&"text"==c.type&&"t_text"==virtualclass.wb[virtualclass.gObj.currWb].tool.cmd&&c.setupCurrentTransform(a))},mousemove:function(a){b.utility.getReltivePoint(a);a.detail.hasOwnProperty("cevent")&&
("move"==b.main.action&&(a=virtualclass.wb[virtualclass.gObj.currWb].utility.putScrollWithCevent(a)),a.clientX=b.main.offset.x+a.detail.cevent.x,a.clientY=b.main.offset.y+a.detail.cevent.y,a.x=b.main.offset.x+a.detail.cevent.x,a.y=b.main.offset.y+a.detail.cevent.y,a.pageX=b.main.offset.x+a.detail.cevent.x,a.pageY=b.main.offset.y+a.detail.cevent.y,a.currX=a.detail.cevent.x,a.currY=a.detail.cevent.y);if("move"==b.main.action){var c=b.main;if(c.currentTransform){var g=b.utility.actualPointer(a),d=g.x;
g=g.y;c.currentTransform.target.isMoving=!0;"rotate"===c.currentTransform.action?(b.interact.rotateObject(d,g),c.currentTransform.target.hasRotatingPoint||b.interact.scaleObject(d,g),a.detail.hasOwnProperty("cevent")||b.optimize.doOptiMize(a)):"scale"===c.currentTransform.action?(a.detail.hasOwnProperty("cevent")||b.optimize.doOptiMize(a),b.interact.scaleObject(d,g)):"scaleX"===c.currentTransform.action?(a.detail.hasOwnProperty("cevent")||b.optimize.doOptiMize(a),b.interact.scaleObject(d,g,"x")):
"scaleY"===c.currentTransform.action?(a.detail.hasOwnProperty("cevent")||b.optimize.doOptiMize(a),b.interact.scaleObject(d,g,"y")):c.currentTransform.target.draggable&&(b.extend({},b.main.currentTransform.target),(new Date).getTime(),1==c.currentTransform.target.downObj&&(b.main.dragMode=!0,c.currentTransform.target.downObj=!1),d=b.interact.translateObject(d,g),a.detail.hasOwnProperty("cevent")||b.optimize.doOptiMize(a),d.setActive(!0),d.setCoords());if("scaleX"===c.currentTransform.action||"scaleY"===
c.currentTransform.action||"rotate"===c.currentTransform.action&&!c.currentTransform.target.hasRotatingPoint)b.main.scaleMode=!0,(new Date).getTime(),c.currentTransform.target.downObj&&(c.currentTransform.target.downObj=!1),d=b.extend({},b.main.currentTransform.target),d.setCoords();b.renderAll()}}},mouseup:function(a){a.detail.hasOwnProperty("cevent")&&(a.clientX=b.main.offset.x+a.detail.cevent.x,a.clientY=b.main.offset.y+a.detail.cevent.y,a.x=b.main.offset.x+a.detail.cevent.x,a.y=b.main.offset.y+
a.detail.cevent.y,a.pageX=b.main.offset.x+a.detail.cevent.x,a.pageY=b.main.offset.y+a.detail.cevent.y,a.currX=a.detail.cevent.x,a.currY=a.detail.cevent.y);lastmousemovetime=null;if("move"==b.main.action){b.activMouse.mousemove(a);var c=b.main;if(c.currentTransform){var g=c.currentTransform.target;g.scaling&&(g.scaling=!1);for(g=c.children.length;g--;)c.children[g].setCoords()}c.currentTransform=null;b.renderAll();if(1==b.main.dragMode||1==b.main.scaleMode){roles.hasControls()&&(a=b.utility.updateCordinate(a));
var d=(new Date).getTime();(!a.detail.hasOwnProperty("cevent")||a.detail.hasOwnProperty("cevent")&&a.detail.hasOwnProperty("broadCast"))&&b.optimize.calculatePackets(d,"u",a.clientX-b.main.offset.x,a.clientY-b.main.offset.y);b.main.dragMode&&(b.main.dragMode=!1);b.main.scaleMode&&(b.main.scaleMode=!1)}else!a.detail.hasOwnProperty("cevent")&&a.detail.hasOwnProperty("cevent")&&a.detail.hasOwnProperty("broadCast")&&b.optimize.calculatePackets(d,"u",a.clientX-b.main.offset.x,a.clientY-b.main.offset.y);
b.wb.sentPack=!0}}}}}})(window);(function(d){d.readyFreeHandObj=function(c,b){return{init:function(){this.freesvg=!0;this.fdObj={};this.borderColor=c;this.freeDrawingLineWidth=b},drawStart:function(a){var b=virtualclass.wb[virtualclass.gObj.currWb].vcan;if(1==virtualclass.wb[virtualclass.gObj.currWb].obj.freeDrawObj.freesvg){var c=b.main.canvas.getContext("2d");this.fdObj=b.main.freeHandDrawing({borderColor:this.borderColor,lineWidth:this.freeDrawingLineWidth});this.fdObj.init();pointer=b.utility.getReltivePoint(a);this.fdObj.fhdStart(c,
pointer)}},wb_draw:function(a){a=virtualclass.wb[virtualclass.gObj.currWb].vcan.utility.getReltivePoint(a);this.fdObj.fhRendering(a)},finalizeDraw:function(a){a=virtualclass.wb[virtualclass.gObj.currWb].vcan;virtualclass.wb[virtualclass.gObj.currWb].prvObj=this.fdObj.finalizeDrawingPath(virtualclass.wb[virtualclass.gObj.currWb].canvas);a.main.children[a.main.children.length-1].mt=virtualclass.wb[virtualclass.gObj.currWb].utility.stringToNumber(virtualclass.wb[virtualclass.gObj.currWb].prvObj.path[virtualclass.wb[virtualclass.gObj.currWb].prvObj.path.length-
1][3])}}}})(window);(function(d){_replay=function(){return{init:function(c,b){var a=virtualclass.wb[virtualclass.gObj.currWb].vcan;this.objs="undefined"!=typeof b?a.getStates("replayObjs"):recorder.items;this.objNo=0;this.repMode=c;this.callBkfunc="";this.rendering=!1},makeCustomEvent:function(c,b){c=c.hasOwnProperty("mtext")?{detail:{cevent:{x:c.x,y:c.y,mtext:c.mtext}}}:{detail:{cevent:{x:c.x,y:c.y}}};"undefined"!=typeof b&&(c.detail.broadCast=!0);b=new CustomEvent(event,c);vcan.main.canvas.dispatchEvent(b)},renderObj:function(c){var b=
virtualclass.wb[virtualclass.gObj.currWb].vcan;if("undefined"==typeof this.objs[this.objNo])console.log(this.objs+"is undefined cannot continue play.");else{this.rendering=virtualclass.wb[virtualclass.gObj.currWb].drawMode=!0;"undefined"!=typeof c&&(this.callBkfunc=c);if(this.objs[this.objNo].hasOwnProperty("cmd"))virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId=this.objs[this.objNo].uid,virtualclass.wb[virtualclass.gObj.currWb].toolInit(this.objs[this.objNo].cmd,"fromFile",!0);else{c=
"";if("del"==this.objs[this.objNo].ac)""!=b.main.currObj&&(virtualclass.wb[virtualclass.gObj.currWb].utility.removeSelectedItem(b.main.currObj,!0,!0),console.log("Whiteboard Delete:-  Performing delete operation:-"));else{"d"==this.objs[this.objNo].ac?c="mousedown":"m"==this.objs[this.objNo].ac?c="mousemove":"u"==this.objs[this.objNo].ac&&(c="mouseup");var a=this.objs[this.objNo];if(a.hasOwnProperty("mtext"))var f={detail:{cevent:{x:a.x,y:a.y,mtext:a.mtext}}};else f={detail:{cevent:{x:a.x,y:a.y}}},
a.hasOwnProperty("scy")&&(f.detail.cevent.scy=a.scy),a.hasOwnProperty("scx")&&(f.detail.cevent.scx=a.scx);c=new CustomEvent(c,f);b.main.canvas.dispatchEvent(c)}virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId=this.objs[this.objNo].uid}this.objs[this.objs.length-1].uid==virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId&&("function"==typeof this.callBkfunc&&this.callBkfunc("callBkfunc"),this.rendering=!1);roles.hasControls()&&virtualclass.wb[virtualclass.gObj.currWb].gObj.tempRepObjs[virtualclass.wb[virtualclass.gObj.currWb].gObj.tempRepObjs.length-
1].uid==virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId&&(b.main.replayObjs=virtualclass.wb[virtualclass.gObj.currWb].gObj.tempRepObjs);if("object"==typeof this.objs[this.objNo+1]){virtualclass.wb[virtualclass.gObj.currWb].replayTime="undefined"!=typeof this.repMode&&"fromBrowser"==this.repMode?0:0==this.objNo?0:this.objs[this.objNo+1].mt-this.objs[this.objNo].mt;this.objNo++;var g=this;setTimeout(function(){g.renderObj.call(g)},virtualclass.wb[virtualclass.gObj.currWb].replayTime)}}}}};
d._replay=_replay})(window);(function(d){d.readyTextObj=function(){return{init:function(c){this.currTextObjWrapper=this.prevTextObj="";this.currObject={};this.prvModTextObj={};this.prvCurrTransform={};this.totalBox=this.textWriteMode=0;this.boxContainer=c;this.muser=!1},textUtility:function(c,b,a){console.log("Text position x="+c+" y="+b);this.startPosX=c;this.startPosY=b;var f=virtualclass.wb[virtualclass.gObj.currWb].vcan,g=f.main.canvas.getContext("2d");this.textWriteMode++;this.wmode=!0;void 0!=f.main.currentTransform&&
""!=f.main.currentTransform?(this.currObject=f.main.currentTransform.target,void 0!=this.currObject&&"text"==this.currObject.type&&(c={width:300,height:100,x:this.currObject.oCoords.tl.x,y:this.currObject.oCoords.tl.y,text:this.currObject.text},virtualclass.wb[virtualclass.gObj.currWb].utility.clickOutSidebox(this.textWriteMode)||virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.drawTextBoxWrapper(c,this.currObject.id),f.main.currentTransform=""),virtualclass.wb[virtualclass.gObj.currWb].utility.clickOutSidebox(this.textWriteMode)&&
virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.renderText(this.prvCurrTransform,this.prvModTextObj,g),void 0!=this.currObject&&"text"==this.currObject.type&&(this.prvModTextObj={prvObjId:this.currObject.id,prvText:this.currObject.text,x:this.currObject.x,y:this.currObject.y},this.prvTextObj=this.currObject),this.prvCurrTransform=this.currObject):virtualclass.wb[virtualclass.gObj.currWb].utility.clickOutSidebox(this.textWriteMode)?"undefined"!=typeof a?virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.renderText(this.currObject,
this.prvModTextObj,g,a):virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.renderText(this.currObject,this.prvModTextObj,g):(this.totalBox++,c={x:c,y:b,width:300,height:100},"undefined"==typeof a?virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.drawTextBoxWrapper(c,this.totalBox):virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.drawTextBoxWrapper(c,this.totalBox,a))},drawTextBoxWrapper:function(c,b,a){a=document.querySelector("#vcanvas"+virtualclass.gObj.currWb);null!=a&&
(a=a.offsetWidth-c.x,350>a&&(c.x=c.x-350-a));virtualclass.vutil.removeAllTextWrapper();a=document.createElement("div");a.id="box"+b;a.className="textBoxContainer";a.style.position="absolute";a.style.left=c.x-virtualclass.leftPosX+"px";a.style.top=c.y-virtualclass.topPosY+"px";b=document.createElement("textarea");b.id=a.id+"textarea";b.className="whiteBoardTextBox";b.rows=8;b.cols=41;void 0!=c.text&&""!=c.text&&(b.value=c.text);a.appendChild(b);document.getElementById(this.boxContainer).appendChild(a);
this.prevTextObj=a;this.currTextObjWrapper=c;this.prevTextObj.measure=c;virtualclass.wb[virtualclass.gObj.currWb].utility.toolWrapperDisable(!0);roles.hasControls()||(b.style.display="none",roles.hasAdmin()&&virtualclass.wb[virtualclass.gObj.currWb].utility.toolWrapperEnable(!0));console.log("Text Command:- Create text wrapper box")},renderText:function(c,b,a,f){var g=virtualclass.wb[virtualclass.gObj.currWb].vcan;if(""!=this.prevTextObj){if(!virtualclass.wb[virtualclass.gObj.currWb].utility.IsObjEmpty(c))for(var d=
0;d<g.main.children.length;d++)if(c.id==g.main.children[d].id){g.main.children.splice(d,1);this.currObject="";break}virtualclass.wb[virtualclass.gObj.currWb].utility.IsObjEmpty(c)?"undefined"!=typeof f?this.finalizeText(a,this.prevTextObj,"undefined",f):this.finalizeText(a,this.prevTextObj):"undefined"!=typeof f?this.finalizeText(a,this.prevTextObj,b,f):this.finalizeText(a,this.prevTextObj,b);virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.wmode=!1}},finalizeText:function(c,b,a,f){a=virtualclass.wb[virtualclass.gObj.currWb].vcan;
var g=document.getElementById(b.id),d="";if("undefined"==typeof f){f=g.getElementsByTagName("textarea");for(var m=0;m<f.length;m++)if(f[m].id==g.id+"textarea"){d=f[m].value;break}}else d=f;c.font="20px Times New Roman";var n=d.split(/\r?\n/);var r=c.measureText(n[0]).width;f=13;for(m=1;m<n.length;m++){f+=13;var A=c.measureText(n[m]).width;A>r&&(r=A)}r/=2;m=(new Date).getTime();c={type:"text",text:d,x:b.measure.x+r*virtualclass.zoom.canvasScale,y:b.measure.y+f*virtualclass.zoom.canvasScale,fontSize:20,
fontWidth:c.measureText(d).width,mp:{x:b.measure.x,y:b.measure.y}};0==virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.muser&&(d={mt:m,ac:"d",x:this.startPosX,y:this.startPosY,mtext:c.text},virtualclass.wb[virtualclass.gObj.currWb].uid++,d.uid=virtualclass.wb[virtualclass.gObj.currWb].uid,a.main.replayObjs.push(d),virtualclass.storage.store(JSON.stringify(a.main.replayObjs)),virtualclass.vutil.beforeSend({repObj:[d],cf:"repObj"}));c=virtualclass.wb[virtualclass.gObj.currWb].canvas.readyObject(c);
virtualclass.wb[virtualclass.gObj.currWb].canvas.addObject(c);a.main.children[a.main.children.length-1].mt=m;g.parentNode.removeChild(b);a.renderAll();virtualclass.wb[virtualclass.gObj.currWb].utility.toolWrapperEnable(!0)},finalizeTextIfAny:function(c){var b=document.getElementById("canvasWrapper"+virtualclass.gObj.currWb);null!=b&&null!=b.getElementsByClassName("whiteBoardTextBox")&&("undefined"==typeof c||"undefined"!=typeof c&&0!=virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.textWriteMode%
2)&&virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.textUtility()}}}})(window);(function(d){d.keyBoard={prvTool:"",skey:!1,triggerActiveAll:function(c){c.shiftKey&&(virtualclass.wb[virtualclass.gObj.currWb].keyBoard.skey=!0,virtualclass.wb[virtualclass.gObj.currWb].keyBoard.prvTool=virtualclass.wb[virtualclass.gObj.currWb].tool.cmd,virtualclass.wb[virtualclass.gObj.currWb].toolInit("t_activeall"),c={cmd:"t_activeall",mt:(new Date).getTime()},vcan.main.replayObjs.push(c),virtualclass.vutil.beforeSend({repObj:[c],cf:"repObj"}),virtualclass.wb[virtualclass.gObj.currWb].vcan.main.action=
"move")},triggerdeActiveAll:function(c){virtualclass.wb[virtualclass.gObj.currWb].keyBoard.skey&&(c=(new Date).getTime(),virtualclass.wb[virtualclass.gObj.currWb].utility.deActiveFrmDragDrop(),virtualclass.wb[virtualclass.gObj.currWb].toolInit(virtualclass.wb[virtualclass.gObj.currWb].keyBoard.prvTool),c={cmd:virtualclass.wb[virtualclass.gObj.currWb].keyBoard.prvTool,mt:c},vcan.main.replayObjs.push(c),virtualclass.vutil.beforeSend({repObj:[c],cf:"repObj"}))}}})(window);(function(d){(function(c){"object"===typeof exports&&"undefined"!==typeof module?module.exports=c():"function"===typeof define&&define.amd?define([],c):("undefined"!==typeof d?d:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).adapter=c()})(function(){return function g(b,a,f){function d(h,n){if(!a[h]){if(!b[h]){var r="function"==typeof require&&require;if(!n&&r)return r(h,!0);if(m)return m(h,!0);n=Error("Cannot find module '"+h+"'");throw n.code="MODULE_NOT_FOUND",n;}n=a[h]=
{exports:{}};b[h][0].call(n.exports,function(a){var f=b[h][1][a];return d(f?f:a)},n,n.exports,g,b,a,f)}return a[h].exports}for(var m="function"==typeof require&&require,n=0;n<f.length;n++)d(f[n]);return d}({1:[function(b,a,f){function g(a,b,f,g,d){b=q.writeRtpDescription(a.kind,b);b+=q.writeIceParameters(a.iceGatherer.getLocalParameters());b+=q.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===f?"actpass":d||"active");b+="a=mid:"+a.mid+"\r\n";b=a.rtpSender&&a.rtpReceiver?b+"a=sendrecv\r\n":
a.rtpSender?b+"a=sendonly\r\n":a.rtpReceiver?b+"a=recvonly\r\n":b+"a=inactive\r\n";a.rtpSender&&(f="msid:"+g.id+" "+a.rtpSender.track.id+"\r\n",b=b+("a="+f)+("a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+f),a.sendEncodingParameters[0].rtx&&(b+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+f,b+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n"));b+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+q.localCName+"\r\n";a.rtpSender&&a.sendEncodingParameters[0].rtx&&
(b+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+q.localCName+"\r\n");return b}function h(a,b){var f=!1;a=JSON.parse(JSON.stringify(a));return a.filter(function(a){if(a&&(a.urls||a.url)){var g=a.urls||a.url;a.url&&!a.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var d="string"===typeof g;d&&(g=[g]);g=g.filter(function(a){return 0!==a.indexOf("turn:")||-1===a.indexOf("transport=udp")||-1!==a.indexOf("turn:[")||f?0===a.indexOf("stun:")&&14393<=b&&-1===a.indexOf("?transport=udp"):
f=!0});delete a.url;a.urls=d?g[0]:g;return!!g.length}})}function m(a,b){var f={codecs:[],headerExtensions:[],fecMechanisms:[]},g=function(a,b){a=parseInt(a,10);for(var f=0;f<b.length;f++)if(b[f].payloadType===a||b[f].preferredPayloadType===a)return b[f]},d=function(a,b,f,d){a=g(a.parameters.apt,f);b=g(b.parameters.apt,d);return a&&b&&a.name.toLowerCase()===b.name.toLowerCase()};a.codecs.forEach(function(g){for(var h=0;h<b.codecs.length;h++){var m=b.codecs[h];if(g.name.toLowerCase()===m.name.toLowerCase()&&
g.clockRate===m.clockRate&&("rtx"!==g.name.toLowerCase()||!g.parameters||!m.parameters.apt||d(g,m,a.codecs,b.codecs))){m=JSON.parse(JSON.stringify(m));m.numChannels=Math.min(g.numChannels,m.numChannels);f.codecs.push(m);m.rtcpFeedback=m.rtcpFeedback.filter(function(a){for(var b=0;b<g.rtcpFeedback.length;b++)if(g.rtcpFeedback[b].type===a.type&&g.rtcpFeedback[b].parameter===a.parameter)return!0;return!1});break}}});a.headerExtensions.forEach(function(a){for(var g=0;g<b.headerExtensions.length;g++){var d=
b.headerExtensions[g];if(a.uri===d.uri){f.headerExtensions.push(d);break}}});return f}function n(a,b,f){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[b][a].indexOf(f)}function r(a,b){var f=a.getRemoteCandidates().find(function(a){return b.foundation===a.foundation&&b.ip===a.ip&&b.port===
a.port&&b.priority===a.priority&&b.protocol===a.protocol&&b.type===a.type});f||a.addRemoteCandidate(b);return!f}function A(a,b){b.addTrack(a);var f=new Event("addtrack");f.track=a;b.dispatchEvent(f)}function z(a,b){b.removeTrack(a);var f=new Event("removetrack");f.track=a;b.dispatchEvent(f)}function t(a,b,f,g){var h=new Event("track");h.track=b;h.receiver=f;h.transceiver={receiver:f};h.streams=g;d.setTimeout(function(){a._dispatchEvent("track",h)})}function v(a,b){b=Error(b);b.name=a;return b}var q=
b("sdp");a.exports=function(a,b){var f=function(f){var g=this,d=document.createDocumentFragment();["addEventListener","removeEventListener","dispatchEvent"].forEach(function(a){g[a]=d[a].bind(d)});this.canTrickleIceCandidates=null;this.needNegotiation=!1;this.localStreams=[];this.remoteStreams=[];this.remoteDescription=this.localDescription=null;this.signalingState="stable";this.iceGatheringState=this.iceConnectionState="new";f=JSON.parse(JSON.stringify(f||{}));this.usingBundle="max-bundle"===f.bundlePolicy;
if("negotiate"===f.rtcpMuxPolicy)throw v("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");f.rtcpMuxPolicy||(f.rtcpMuxPolicy="require");switch(f.iceTransportPolicy){case "all":case "relay":break;default:f.iceTransportPolicy="all"}switch(f.bundlePolicy){case "balanced":case "max-compat":case "max-bundle":break;default:f.bundlePolicy="balanced"}f.iceServers=h(f.iceServers||[],b);this._iceGatherers=[];if(f.iceCandidatePoolSize)for(var m=f.iceCandidatePoolSize;0<m;m--)this._iceGatherers=
new a.RTCIceGatherer({iceServers:f.iceServers,gatherPolicy:f.iceTransportPolicy});else f.iceCandidatePoolSize=0;this._config=f;this.transceivers=[];this._sdpSessionId=q.generateSessionId();this._sdpSessionVersion=0;this._dtlsRole=void 0;this._isClosed=!1};f.prototype.onicecandidate=null;f.prototype.onaddstream=null;f.prototype.ontrack=null;f.prototype.onremovestream=null;f.prototype.onsignalingstatechange=null;f.prototype.oniceconnectionstatechange=null;f.prototype.onicegatheringstatechange=null;
f.prototype.onnegotiationneeded=null;f.prototype.ondatachannel=null;f.prototype._dispatchEvent=function(a,b){if(!this._isClosed&&(this.dispatchEvent(b),"function"===typeof this["on"+a]))this["on"+a](b)};f.prototype._emitGatheringStateChange=function(){var a=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",a)};f.prototype.getConfiguration=function(){return this._config};f.prototype.getLocalStreams=function(){return this.localStreams};f.prototype.getRemoteStreams=function(){return this.remoteStreams};
f.prototype._createTransceiver=function(a){var b=0<this.transceivers.length;a={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:a,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};this.usingBundle&&b?(a.iceTransport=this.transceivers[0].iceTransport,a.dtlsTransport=this.transceivers[0].dtlsTransport):(b=this._createIceAndDtlsTransports(),
a.iceTransport=b.iceTransport,a.dtlsTransport=b.dtlsTransport);this.transceivers.push(a);return a};f.prototype.addTrack=function(b,f){if(this.transceivers.find(function(a){return a.track===b}))throw v("InvalidAccessError","Track already exists.");if("closed"===this.signalingState)throw v("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");for(var g,d=0;d<this.transceivers.length;d++)this.transceivers[d].track||this.transceivers[d].kind!==b.kind||(g=this.transceivers[d]);
g||(g=this._createTransceiver(b.kind));this._maybeFireNegotiationNeeded();-1===this.localStreams.indexOf(f)&&this.localStreams.push(f);g.track=b;g.stream=f;g.rtpSender=new a.RTCRtpSender(b,g.dtlsTransport);return g.rtpSender};f.prototype.addStream=function(a){var f=this;if(15025<=b)a.getTracks().forEach(function(b){f.addTrack(b,a)});else{var g=a.clone();a.getTracks().forEach(function(a,b){var f=g.getTracks()[b];a.addEventListener("enabled",function(a){f.enabled=a.enabled})});g.getTracks().forEach(function(a){f.addTrack(a,
g)})}};f.prototype.removeTrack=function(b){if(!(b instanceof a.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var f=this.transceivers.find(function(a){return a.rtpSender===b});if(!f)throw v("InvalidAccessError","Sender was not created by this connection.");var g=f.stream;f.rtpSender.stop();f.rtpSender=null;f.track=null;f.stream=null;-1===this.transceivers.map(function(a){return a.stream}).indexOf(g)&&-1<this.localStreams.indexOf(g)&&
this.localStreams.splice(this.localStreams.indexOf(g),1);this._maybeFireNegotiationNeeded()};f.prototype.removeStream=function(a){var b=this;a.getTracks().forEach(function(a){var f=b.getSenders().find(function(b){return b.track===a});f&&b.removeTrack(f)})};f.prototype.getSenders=function(){return this.transceivers.filter(function(a){return!!a.rtpSender}).map(function(a){return a.rtpSender})};f.prototype.getReceivers=function(){return this.transceivers.filter(function(a){return!!a.rtpReceiver}).map(function(a){return a.rtpReceiver})};
f.prototype._createIceGatherer=function(b,f){var g=this;if(f&&0<b)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var d=new a.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});Object.defineProperty(d,"state",{value:"new",writable:!0});this.transceivers[b].candidates=[];this.transceivers[b].bufferCandidates=function(a){var f=!a.candidate||0===Object.keys(a.candidate).length;d.state=f?"completed":
"gathering";null!==g.transceivers[b].candidates&&g.transceivers[b].candidates.push(a.candidate)};d.addEventListener("localcandidate",this.transceivers[b].bufferCandidates);return d};f.prototype._gather=function(b,f){var g=this,d=this.transceivers[f].iceGatherer;if(!d.onlocalcandidate){var h=this.transceivers[f].candidates;this.transceivers[f].candidates=null;d.removeEventListener("localcandidate",this.transceivers[f].bufferCandidates);d.onlocalcandidate=function(a){if(!(g.usingBundle&&0<f)){var h=
new Event("icecandidate");h.candidate={sdpMid:b,sdpMLineIndex:f};var m=a.candidate;if(a=!m||0===Object.keys(m).length){if("new"===d.state||"gathering"===d.state)d.state="completed"}else"new"===d.state&&(d.state="gathering"),m.component=1,h.candidate.candidate=q.writeCandidate(m);m=q.splitSections(g.localDescription.sdp);m[h.candidate.sdpMLineIndex+1]=a?m[h.candidate.sdpMLineIndex+1]+"a=end-of-candidates\r\n":m[h.candidate.sdpMLineIndex+1]+("a="+h.candidate.candidate+"\r\n");g.localDescription.sdp=
m.join("");m=g.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});"gathering"!==g.iceGatheringState&&(g.iceGatheringState="gathering",g._emitGatheringStateChange());a||g._dispatchEvent("icecandidate",h);m&&(g._dispatchEvent("icecandidate",new Event("icecandidate")),g.iceGatheringState="complete",g._emitGatheringStateChange())}};a.setTimeout(function(){h.forEach(function(a){var b=new Event("RTCIceGatherEvent");b.candidate=a;d.onlocalcandidate(b)})},0)}};f.prototype._createIceAndDtlsTransports=
function(){var b=this,f=new a.RTCIceTransport(null);f.onicestatechange=function(){b._updateConnectionState()};var g=new a.RTCDtlsTransport(f);g.ondtlsstatechange=function(){b._updateConnectionState()};g.onerror=function(){Object.defineProperty(g,"state",{value:"failed",writable:!0});b._updateConnectionState()};return{iceTransport:f,dtlsTransport:g}};f.prototype._disposeIceAndDtlsTransports=function(a){var b=this.transceivers[a].iceGatherer;b&&(delete b.onlocalcandidate,delete this.transceivers[a].iceGatherer);
if(b=this.transceivers[a].iceTransport)delete b.onicestatechange,delete this.transceivers[a].iceTransport;if(b=this.transceivers[a].dtlsTransport)delete b.ondtlsstatechange,delete b.onerror,delete this.transceivers[a].dtlsTransport};f.prototype._transceive=function(a,f,g){var d=m(a.localCapabilities,a.remoteCapabilities);f&&a.rtpSender&&(d.encodings=a.sendEncodingParameters,d.rtcp={cname:q.localCName,compound:a.rtcpParameters.compound},a.recvEncodingParameters.length&&(d.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),
a.rtpSender.send(d));g&&a.rtpReceiver&&0<d.codecs.length&&("video"===a.kind&&a.recvEncodingParameters&&15019>b&&a.recvEncodingParameters.forEach(function(a){delete a.rtx}),a.recvEncodingParameters.length&&(d.encodings=a.recvEncodingParameters),d.rtcp={compound:a.rtcpParameters.compound},a.rtcpParameters.cname&&(d.rtcp.cname=a.rtcpParameters.cname),a.sendEncodingParameters.length&&(d.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),a.rtpReceiver.receive(d))};f.prototype.setLocalDescription=function(a){var b=
this;if(!n("setLocalDescription",a.type,this.signalingState)||this._isClosed)return Promise.reject(v("InvalidStateError","Can not set local "+a.type+" in state "+b.signalingState));if("offer"===a.type){var f=q.splitSections(a.sdp);var g=f.shift();f.forEach(function(a,f){a=q.parseRtpParameters(a);b.transceivers[f].localCapabilities=a});this.transceivers.forEach(function(a,f){b._gather(a.mid,f)})}else if("answer"===a.type){f=q.splitSections(b.remoteDescription.sdp);g=f.shift();var d=0<q.matchPrefix(g,
"a=ice-lite").length;f.forEach(function(a,f){var h=b.transceivers[f],n=h.iceGatherer,r=h.iceTransport,p=h.dtlsTransport,t=h.localCapabilities,z=h.remoteCapabilities;if(!(q.isRejected(a)&&0===q.matchPrefix(a,"a=bundle-only").length||h.isDatachannel)){var w=q.getIceParameters(a,g);a=q.getDtlsParameters(a,g);d&&(a.role="server");b.usingBundle&&0!==f||(b._gather(h.mid,f),"new"===r.state&&r.start(n,w,d?"controlling":"controlled"),"new"===p.state&&p.start(a));f=m(t,z);b._transceive(h,0<f.codecs.length,
!1)}})}this.localDescription={type:a.type,sdp:a.sdp};switch(a.type){case "offer":this._updateSignalingState("have-local-offer");break;case "answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"');}return Promise.resolve()};f.prototype.setRemoteDescription=function(f){var g=this;if(!n("setRemoteDescription",f.type,this.signalingState)||this._isClosed)return Promise.reject(v("InvalidStateError","Can not set remote "+f.type+" in state "+g.signalingState));
var d={};this.remoteStreams.forEach(function(a){d[a.id]=a});var h=[],m=q.splitSections(f.sdp),p=m.shift(),w=0<q.matchPrefix(p,"a=ice-lite").length,B=0<q.matchPrefix(p,"a=group:BUNDLE ").length;this.usingBundle=B;var H=q.matchPrefix(p,"a=ice-options:")[0];this.canTrickleIceCandidates=H?0<=H.substr(14).split(" ").indexOf("trickle"):!1;m.forEach(function(m,n){var t=q.splitLines(m),v=q.getKind(m),H=q.isRejected(m)&&0===q.matchPrefix(m,"a=bundle-only").length,C=t[0].substr(2).split(" ")[2];t=q.getDirection(m,
p);var G=q.parseMsid(m),qa=q.getMid(m)||q.generateIdentifier();if("application"===v&&"DTLS/SCTP"===C)g.transceivers[n]={mid:qa,isDatachannel:!0};else{var V=q.parseRtpParameters(m);if(!H){var P=q.getIceParameters(m,p);var K=q.getDtlsParameters(m,p);K.role="client"}C=q.parseRtpEncodingParameters(m);var D=q.parseRtcpParameters(m),fa=0<q.matchPrefix(m,"a=end-of-candidates",p).length,M=q.matchPrefix(m,"a=candidate:").map(function(a){return q.parseCandidate(a)}).filter(function(a){return 1===a.component});
("offer"===f.type||"answer"===f.type)&&!H&&B&&0<n&&g.transceivers[n]&&(g._disposeIceAndDtlsTransports(n),g.transceivers[n].iceGatherer=g.transceivers[0].iceGatherer,g.transceivers[n].iceTransport=g.transceivers[0].iceTransport,g.transceivers[n].dtlsTransport=g.transceivers[0].dtlsTransport,g.transceivers[n].rtpSender&&g.transceivers[n].rtpSender.setTransport(g.transceivers[0].dtlsTransport),g.transceivers[n].rtpReceiver&&g.transceivers[n].rtpReceiver.setTransport(g.transceivers[0].dtlsTransport));
if("offer"!==f.type||H)"answer"!==f.type||H||(J=g.transceivers[n],I=J.iceGatherer,v=J.iceTransport,qa=J.dtlsTransport,Z=J.rtpReceiver,H=J.sendEncodingParameters,m=J.localCapabilities,g.transceivers[n].recvEncodingParameters=C,g.transceivers[n].remoteCapabilities=V,g.transceivers[n].rtcpParameters=D,M.length&&"new"===v.state&&(!w&&!fa||B&&0!==n?M.forEach(function(a){r(J.iceTransport,a)}):v.setRemoteCandidates(M)),B&&0!==n||("new"===v.state&&v.start(I,P,"controlling"),"new"===qa.state&&qa.start(K)),
g._transceive(J,"sendrecv"===t||"recvonly"===t,"sendrecv"===t||"sendonly"===t),!Z||"sendrecv"!==t&&"sendonly"!==t?delete J.rtpReceiver:(t=Z.track,G?(d[G.stream]||(d[G.stream]=new a.MediaStream),A(t,d[G.stream]),h.push([t,Z,d[G.stream]])):(d.default||(d.default=new a.MediaStream),A(t,d.default),h.push([t,Z,d.default]))));else{var J=g.transceivers[n]||g._createTransceiver(v);J.mid=qa;J.iceGatherer||(J.iceGatherer=g._createIceGatherer(n,B));M.length&&"new"===J.iceTransport.state&&(!fa||B&&0!==n?M.forEach(function(a){r(J.iceTransport,
a)}):J.iceTransport.setRemoteCandidates(M));m=a.RTCRtpReceiver.getCapabilities(v);15019>b&&(m.codecs=m.codecs.filter(function(a){return"rtx"!==a.name}));H=J.sendEncodingParameters||[{ssrc:1001*(2*n+2)}];P=!1;if("sendrecv"===t||"sendonly"===t){P=!J.rtpReceiver;var Z=J.rtpReceiver||new a.RTCRtpReceiver(J.dtlsTransport,v);if(P){t=Z.track;if(!G||"-"!==G.stream)if(G){d[G.stream]||(d[G.stream]=new a.MediaStream,Object.defineProperty(d[G.stream],"id",{get:function(){return G.stream}}));Object.defineProperty(t,
"id",{get:function(){return G.track}});var I=d[G.stream]}else d.default||(d.default=new a.MediaStream),I=d.default;I&&(A(t,I),J.associatedRemoteMediaStreams.push(I));h.push([t,Z,I])}}else J.rtpReceiver&&J.rtpReceiver.track&&(J.associatedRemoteMediaStreams.forEach(function(a){var b=a.getTracks().find(function(a){return a.id===J.rtpReceiver.track.id});b&&z(b,a)}),J.associatedRemoteMediaStreams=[]);J.localCapabilities=m;J.remoteCapabilities=V;J.rtpReceiver=Z;J.rtcpParameters=D;J.sendEncodingParameters=
H;J.recvEncodingParameters=C;g._transceive(g.transceivers[n],!1,P)}}});void 0===this._dtlsRole&&(this._dtlsRole="offer"===f.type?"active":"passive");this.remoteDescription={type:f.type,sdp:f.sdp};switch(f.type){case "offer":this._updateSignalingState("have-remote-offer");break;case "answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+f.type+'"');}Object.keys(d).forEach(function(b){var f=d[b];if(f.getTracks().length){if(-1===g.remoteStreams.indexOf(f)){g.remoteStreams.push(f);
var m=new Event("addstream");m.stream=f;a.setTimeout(function(){g._dispatchEvent("addstream",m)})}h.forEach(function(a){f.id===a[2].id&&t(g,a[0],a[1],[f])})}});h.forEach(function(a){a[2]||t(g,a[0],a[1],[])});a.setTimeout(function(){g&&g.transceivers&&g.transceivers.forEach(function(a){a.iceTransport&&"new"===a.iceTransport.state&&0<a.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),a.iceTransport.addRemoteCandidate({}))})},
4E3);return Promise.resolve()};f.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop();a.dtlsTransport&&a.dtlsTransport.stop();a.rtpSender&&a.rtpSender.stop();a.rtpReceiver&&a.rtpReceiver.stop()});this._isClosed=!0;this._updateSignalingState("closed")};f.prototype._updateSignalingState=function(a){this.signalingState=a;a=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",a)};f.prototype._maybeFireNegotiationNeeded=function(){var b=
this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,a.setTimeout(function(){if(!1!==b.needNegotiation){b.needNegotiation=!1;var a=new Event("negotiationneeded");b._dispatchEvent("negotiationneeded",a)}},0))};f.prototype._updateConnectionState=function(){var a={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(b){a[b.iceTransport.state]++;a[b.dtlsTransport.state]++});a.connected+=a.completed;
var b="new";if(0<a.failed)b="failed";else if(0<a.connecting||0<a.checking)b="connecting";else if(0<a.disconnected)b="disconnected";else if(0<a.new)b="new";else if(0<a.connected||0<a.completed)b="connected";b!==this.iceConnectionState&&(this.iceConnectionState=b,b=new Event("iceconnectionstatechange"),this._dispatchEvent("iceconnectionstatechange",b))};f.prototype.createOffer=function(f){var d=this;if(this._isClosed)return Promise.reject(v("InvalidStateError","Can not call createOffer after close"));
var h=this.transceivers.filter(function(a){return"audio"===a.kind}).length,m=this.transceivers.filter(function(a){return"video"===a.kind}).length;if(f){if(f.mandatory||f.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==f.offerToReceiveAudio&&(h=!0===f.offerToReceiveAudio?1:!1===f.offerToReceiveAudio?0:f.offerToReceiveAudio);void 0!==f.offerToReceiveVideo&&(m=!0===f.offerToReceiveVideo?1:!1===f.offerToReceiveVideo?0:f.offerToReceiveVideo)}for(this.transceivers.forEach(function(a){"audio"===
a.kind?(h--,0>h&&(a.wantReceive=!1)):"video"===a.kind&&(m--,0>m&&(a.wantReceive=!1))});0<h||0<m;)0<h&&(this._createTransceiver("audio"),h--),0<m&&(this._createTransceiver("video"),m--);var n=q.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.transceivers.forEach(function(f,g){var h=f.track,m=f.kind,n=q.generateIdentifier();f.mid=n;f.iceGatherer||(f.iceGatherer=d._createIceGatherer(g,d.usingBundle));n=a.RTCRtpSender.getCapabilities(m);15019>b&&(n.codecs=n.codecs.filter(function(a){return"rtx"!==
a.name}));n.codecs.forEach(function(a){"H264"===a.name&&void 0===a.parameters["level-asymmetry-allowed"]&&(a.parameters["level-asymmetry-allowed"]="1")});g=f.sendEncodingParameters||[{ssrc:1001*(2*g+1)}];h&&15019<=b&&"video"===m&&!g[0].rtx&&(g[0].rtx={ssrc:g[0].ssrc+1});f.wantReceive&&(f.rtpReceiver=new a.RTCRtpReceiver(f.dtlsTransport,m));f.localCapabilities=n;f.sendEncodingParameters=g});"max-compat"!==this._config.bundlePolicy&&(n+="a=group:BUNDLE "+this.transceivers.map(function(a){return a.mid}).join(" ")+
"\r\n");n+="a=ice-options:trickle\r\n";this.transceivers.forEach(function(a,b){n+=g(a,a.localCapabilities,"offer",a.stream,d._dtlsRole);n+="a=rtcp-rsize\r\n";!a.iceGatherer||"new"===d.iceGatheringState||0!==b&&d.usingBundle||(a.iceGatherer.getLocalCandidates().forEach(function(a){a.component=1;n+="a="+q.writeCandidate(a)+"\r\n"}),"completed"===a.iceGatherer.state&&(n+="a=end-of-candidates\r\n"))});f=new a.RTCSessionDescription({type:"offer",sdp:n});return Promise.resolve(f)};f.prototype.createAnswer=
function(){var f=this;if(this._isClosed)return Promise.reject(v("InvalidStateError","Can not call createAnswer after close"));var d=q.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.usingBundle&&(d+="a=group:BUNDLE "+this.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n");var h=q.splitSections(this.remoteDescription.sdp).length-1;this.transceivers.forEach(function(a,n){if(!(n+1>h))if(a.isDatachannel)d+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+
a.mid+"\r\n";else{if(a.stream){var r;"audio"===a.kind?r=a.stream.getAudioTracks()[0]:"video"===a.kind&&(r=a.stream.getVideoTracks()[0]);r&&15019<=b&&"video"===a.kind&&!a.sendEncodingParameters[0].rtx&&(a.sendEncodingParameters[0].rtx={ssrc:a.sendEncodingParameters[0].ssrc+1})}n=m(a.localCapabilities,a.remoteCapabilities);!n.codecs.filter(function(a){return"rtx"===a.name.toLowerCase()}).length&&a.sendEncodingParameters[0].rtx&&delete a.sendEncodingParameters[0].rtx;d+=g(a,n,"answer",a.stream,f._dtlsRole);
a.rtcpParameters&&a.rtcpParameters.reducedSize&&(d+="a=rtcp-rsize\r\n")}});var n=new a.RTCSessionDescription({type:"answer",sdp:d});return Promise.resolve(n)};f.prototype.addIceCandidate=function(a){if(a&&""!==a.candidate)if(void 0!==a.sdpMLineIndex||a.sdpMid)if(this.remoteDescription){var b=a.sdpMLineIndex;if(a.sdpMid)for(var f=0;f<this.transceivers.length;f++)if(this.transceivers[f].mid===a.sdpMid){b=f;break}var g=this.transceivers[b];if(g){if(g.isDatachannel)return Promise.resolve();f=0<Object.keys(a.candidate).length?
q.parseCandidate(a.candidate):{};if("tcp"===f.protocol&&(0===f.port||9===f.port)||f.component&&1!==f.component)return Promise.resolve();if((0===b||0<b&&g.iceTransport!==this.transceivers[0].iceTransport)&&!r(g.iceTransport,f))return Promise.reject(v("OperationError","Can not add ICE candidate"));g=a.candidate.trim();0===g.indexOf("a=")&&(g=g.substr(2));a=q.splitSections(this.remoteDescription.sdp);a[b+1]+="a="+(f.type?g:"end-of-candidates")+"\r\n";this.remoteDescription.sdp=a.join("")}else return Promise.reject(v("OperationError",
"Can not add ICE candidate"))}else return Promise.reject(v("InvalidStateError","Can not add ICE candidate without a remote description"));else throw new TypeError("sdpMLineIndex or sdpMid required");else for(b=0;b<this.transceivers.length&&(this.transceivers[b].isDatachannel||(this.transceivers[b].iceTransport.addRemoteCandidate({}),a=q.splitSections(this.remoteDescription.sdp),a[b+1]+="a=end-of-candidates\r\n",this.remoteDescription.sdp=a.join(""),!this.usingBundle));b++);return Promise.resolve()};
f.prototype.getStats=function(){var a=[];this.transceivers.forEach(function(b){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(f){b[f]&&a.push(b[f].getStats())})});return new Promise(function(b){var f=new Map;Promise.all(a).then(function(a){a.forEach(function(a){Object.keys(a).forEach(function(b){var g=a[b];a[b].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[g.type]||
g.type;f.set(b,a[b])})});b(f)})})};var d=["createOffer","createAnswer"];d.forEach(function(a){var b=f.prototype[a];f.prototype[a]=function(){var a=arguments;return"function"===typeof a[0]||"function"===typeof a[1]?b.apply(this,[arguments[2]]).then(function(b){"function"===typeof a[0]&&a[0].apply(null,[b])},function(b){"function"===typeof a[1]&&a[1].apply(null,[b])}):b.apply(this,arguments)}});d=["setLocalDescription","setRemoteDescription","addIceCandidate"];d.forEach(function(a){var b=f.prototype[a];
f.prototype[a]=function(){var a=arguments;return"function"===typeof a[1]||"function"===typeof a[2]?b.apply(this,arguments).then(function(){"function"===typeof a[1]&&a[1].apply(null)},function(b){"function"===typeof a[2]&&a[2].apply(null,[b])}):b.apply(this,arguments)}});["getStats"].forEach(function(a){var b=f.prototype[a];f.prototype[a]=function(){var a=arguments;return"function"===typeof a[1]?b.apply(this,arguments).then(function(){"function"===typeof a[1]&&a[1].apply(null)}):b.apply(this,arguments)}});
return f}},{sdp:2}],2:[function(b,a,f){var g={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};g.localCName=g.generateIdentifier();g.splitLines=function(a){return a.trim().split("\n").map(function(a){return a.trim()})};g.splitSections=function(a){return a.split("\nm=").map(function(a,b){return(0<b?"m="+a:a).trim()+"\r\n"})};g.matchPrefix=function(a,b){return g.splitLines(a).filter(function(a){return 0===a.indexOf(b)})};g.parseCandidate=function(a){a=0===a.indexOf("a=candidate:")?
a.substring(12).split(" "):a.substring(10).split(" ");for(var b={foundation:a[0],component:parseInt(a[1],10),protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],port:parseInt(a[5],10),type:a[7]},f=8;f<a.length;f+=2)switch(a[f]){case "raddr":b.relatedAddress=a[f+1];break;case "rport":b.relatedPort=parseInt(a[f+1],10);break;case "tcptype":b.tcpType=a[f+1];break;case "ufrag":b.ufrag=a[f+1];b.usernameFragment=a[f+1];break;default:b[a[f]]=a[f+1]}return b};g.writeCandidate=function(a){var b=
[];b.push(a.foundation);b.push(a.component);b.push(a.protocol.toUpperCase());b.push(a.priority);b.push(a.ip);b.push(a.port);var f=a.type;b.push("typ");b.push(f);"host"!==f&&a.relatedAddress&&a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort));a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType));a.ufrag&&(b.push("ufrag"),b.push(a.ufrag));return"candidate:"+b.join(" ")};g.parseIceOptions=function(a){return a.substr(14).split(" ")};
g.parseRtpMap=function(a){a=a.substr(9).split(" ");var b={payloadType:parseInt(a.shift(),10)};a=a[0].split("/");b.name=a[0];b.clockRate=parseInt(a[1],10);b.numChannels=3===a.length?parseInt(a[2],10):1;return b};g.writeRtpMap=function(a){var b=a.payloadType;void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType);return"a=rtpmap:"+b+" "+a.name+"/"+a.clockRate+(1!==a.numChannels?"/"+a.numChannels:"")+"\r\n"};g.parseExtmap=function(a){a=a.substr(9).split(" ");return{id:parseInt(a[0],10),direction:0<
a[0].indexOf("/")?a[0].split("/")[1]:"sendrecv",uri:a[1]}};g.writeExtmap=function(a){return"a=extmap:"+(a.id||a.preferredId)+(a.direction&&"sendrecv"!==a.direction?"/"+a.direction:"")+" "+a.uri+"\r\n"};g.parseFmtp=function(a){for(var b={},f=a.substr(a.indexOf(" ")+1).split(";"),g=0;g<f.length;g++)a=f[g].trim().split("="),b[a[0].trim()]=a[1];return b};g.writeFmtp=function(a){var b="",f=a.payloadType;void 0!==a.preferredPayloadType&&(f=a.preferredPayloadType);if(a.parameters&&Object.keys(a.parameters).length){var g=
[];Object.keys(a.parameters).forEach(function(b){g.push(b+"="+a.parameters[b])});b+="a=fmtp:"+f+" "+g.join(";")+"\r\n"}return b};g.parseRtcpFb=function(a){a=a.substr(a.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}};g.writeRtcpFb=function(a){var b="",f=a.payloadType;void 0!==a.preferredPayloadType&&(f=a.preferredPayloadType);a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){b+="a=rtcp-fb:"+f+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:
"")+"\r\n"});return b};g.parseSsrcMedia=function(a){var b=a.indexOf(" "),f={ssrc:parseInt(a.substr(7,b-7),10)},g=a.indexOf(":",b);-1<g?(f.attribute=a.substr(b+1,g-b-1),f.value=a.substr(g+1)):f.attribute=a.substr(b+1);return f};g.getMid=function(a){if(a=g.matchPrefix(a,"a=mid:")[0])return a.substr(6)};g.parseFingerprint=function(a){a=a.substr(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1]}};g.getDtlsParameters=function(a,b){return{role:"auto",fingerprints:g.matchPrefix(a+b,"a=fingerprint:").map(g.parseFingerprint)}};
g.writeDtlsParameters=function(a,b){var f="a=setup:"+b+"\r\n";a.fingerprints.forEach(function(a){f+="a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"});return f};g.getIceParameters=function(a,b){a=g.splitLines(a);a=a.concat(g.splitLines(b));return{usernameFragment:a.filter(function(a){return 0===a.indexOf("a=ice-ufrag:")})[0].substr(12),password:a.filter(function(a){return 0===a.indexOf("a=ice-pwd:")})[0].substr(10)}};g.writeIceParameters=function(a){return"a=ice-ufrag:"+a.usernameFragment+"\r\na=ice-pwd:"+
a.password+"\r\n"};g.parseRtpParameters=function(a){for(var b={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},f=g.splitLines(a)[0].split(" "),d=3;d<f.length;d++){var h=f[d],z=g.matchPrefix(a,"a=rtpmap:"+h+" ")[0];if(z){z=g.parseRtpMap(z);var t=g.matchPrefix(a,"a=fmtp:"+h+" ");z.parameters=t.length?g.parseFmtp(t[0]):{};z.rtcpFeedback=g.matchPrefix(a,"a=rtcp-fb:"+h+" ").map(g.parseRtcpFb);b.codecs.push(z);switch(z.name.toUpperCase()){case "RED":case "ULPFEC":b.fecMechanisms.push(z.name.toUpperCase())}}}g.matchPrefix(a,
"a=extmap:").forEach(function(a){b.headerExtensions.push(g.parseExtmap(a))});return b};g.writeRtpDescription=function(a,b){var f="";f+="m="+a+" ";f+=0<b.codecs.length?"9":"0";f+=" UDP/TLS/RTP/SAVPF ";f+=b.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n";f+="c=IN IP4 0.0.0.0\r\n";f+="a=rtcp:9 IN IP4 0.0.0.0\r\n";b.codecs.forEach(function(a){f+=g.writeRtpMap(a);f+=g.writeFmtp(a);f+=g.writeRtcpFb(a)});var d=0;b.codecs.forEach(function(a){a.maxptime>
d&&(d=a.maxptime)});0<d&&(f+="a=maxptime:"+d+"\r\n");f+="a=rtcp-mux\r\n";b.headerExtensions.forEach(function(a){f+=g.writeExtmap(a)});return f};g.parseRtpEncodingParameters=function(a){var b=[],f=g.parseRtpParameters(a),d=-1!==f.fecMechanisms.indexOf("RED"),h=-1!==f.fecMechanisms.indexOf("ULPFEC"),z=g.matchPrefix(a,"a=ssrc:").map(function(a){return g.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute}),t=0<z.length&&z[0].ssrc,v;z=g.matchPrefix(a,"a=ssrc-group:FID").map(function(a){a=
a.split(" ");a.shift();return a.map(function(a){return parseInt(a,10)})});0<z.length&&1<z[0].length&&z[0][0]===t&&(v=z[0][1]);f.codecs.forEach(function(a){"RTX"===a.name.toUpperCase()&&a.parameters.apt&&(a={ssrc:t,codecPayloadType:parseInt(a.parameters.apt,10),rtx:{ssrc:v}},b.push(a),d&&(a=JSON.parse(JSON.stringify(a)),a.fec={ssrc:v,mechanism:h?"red+ulpfec":"red"},b.push(a)))});0===b.length&&t&&b.push({ssrc:t});var q=g.matchPrefix(a,"b=");q.length&&(q=0===q[0].indexOf("b=TIAS:")?parseInt(q[0].substr(7),
10):0===q[0].indexOf("b=AS:")?950*parseInt(q[0].substr(5),10)-16E3:void 0,b.forEach(function(a){a.maxBitrate=q}));return b};g.parseRtcpParameters=function(a){var b={},f=g.matchPrefix(a,"a=ssrc:").map(function(a){return g.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0];f&&(b.cname=f.value,b.ssrc=f.ssrc);f=g.matchPrefix(a,"a=rtcp-rsize");b.reducedSize=0<f.length;b.compound=0===f.length;a=g.matchPrefix(a,"a=rtcp-mux");b.mux=0<a.length;return b};g.parseMsid=function(a){var b=g.matchPrefix(a,
"a=msid:");if(1===b.length)return a=b[0].substr(7).split(" "),{stream:a[0],track:a[1]};a=g.matchPrefix(a,"a=ssrc:").map(function(a){return g.parseSsrcMedia(a)}).filter(function(a){return"msid"===a.attribute});if(0<a.length)return a=a[0].value.split(" "),{stream:a[0],track:a[1]}};g.generateSessionId=function(){return Math.random().toString().substr(2,21)};g.writeSessionBoilerplate=function(a,b){b=void 0!==b?b:2;return"v=0\r\no=thisisadapterortc "+(a?a:g.generateSessionId())+" "+b+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"};
g.writeMediaSection=function(a,b,f,d){b=g.writeRtpDescription(a.kind,b);b+=g.writeIceParameters(a.iceGatherer.getLocalParameters());b+=g.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===f?"actpass":"active");b+="a=mid:"+a.mid+"\r\n";b=a.direction?b+("a="+a.direction+"\r\n"):a.rtpSender&&a.rtpReceiver?b+"a=sendrecv\r\n":a.rtpSender?b+"a=sendonly\r\n":a.rtpReceiver?b+"a=recvonly\r\n":b+"a=inactive\r\n";a.rtpSender&&(f="msid:"+d.id+" "+a.rtpSender.track.id+"\r\n",b=b+("a="+f)+("a=ssrc:"+
a.sendEncodingParameters[0].ssrc+" "+f),a.sendEncodingParameters[0].rtx&&(b+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+f,b+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n"));b+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+g.localCName+"\r\n";a.rtpSender&&a.sendEncodingParameters[0].rtx&&(b+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+g.localCName+"\r\n");return b};g.getDirection=function(a,b){a=g.splitLines(a);for(var f=
0;f<a.length;f++)switch(a[f]){case "a=sendrecv":case "a=sendonly":case "a=recvonly":case "a=inactive":return a[f].substr(2)}return b?g.getDirection(b):"sendrecv"};g.getKind=function(a){return g.splitLines(a)[0].split(" ")[0].substr(2)};g.isRejected=function(a){return"0"===a.split(" ",2)[1]};g.parseMLine=function(a){a=g.splitLines(a)[0].split(" ");return{kind:a[0].substr(2),port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}};"object"===typeof a&&(a.exports=g)},{}],3:[function(b,a,f){f=
"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof d?d:{};b=b("./adapter_factory.js");a.exports=b({window:f.window})},{"./adapter_factory.js":4}],4:[function(b,a,f){var g=b("./utils");a.exports=function(a,f){a=a&&a.window;var d={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(h in f)hasOwnProperty.call(f,h)&&(d[h]=f[h]);f=g.log;var h=g.detectBrowser(a);var m=b("./chrome/chrome_shim")||null,z=b("./edge/edge_shim")||null,t=b("./firefox/firefox_shim")||
null,v=b("./safari/safari_shim")||null,q=b("./common_shim")||null,w={browserDetails:h,commonShim:q,extractVersion:g.extractVersion,disableLog:g.disableLog,disableWarnings:g.disableWarnings};switch(h.browser){case "chrome":if(!m||!m.shimPeerConnection||!d.shimChrome){f("Chrome shim is not included in this adapter release.");break}f("adapter.js shimming chrome.");w.browserShim=m;q.shimCreateObjectURL(a);m.shimGetUserMedia(a);m.shimMediaStream(a);m.shimSourceObject(a);m.shimPeerConnection(a);m.shimOnTrack(a);
m.shimAddTrackRemoveTrack(a);m.shimGetSendersWithDtmf(a);q.shimRTCIceCandidate(a);q.shimMaxMessageSize(a);q.shimSendThrowTypeError(a);break;case "firefox":if(!t||!t.shimPeerConnection||!d.shimFirefox){f("Firefox shim is not included in this adapter release.");break}f("adapter.js shimming firefox.");w.browserShim=t;q.shimCreateObjectURL(a);t.shimGetUserMedia(a);t.shimSourceObject(a);t.shimPeerConnection(a);t.shimOnTrack(a);t.shimRemoveStream(a);q.shimRTCIceCandidate(a);q.shimMaxMessageSize(a);q.shimSendThrowTypeError(a);
break;case "edge":if(!z||!z.shimPeerConnection||!d.shimEdge){f("MS edge shim is not included in this adapter release.");break}f("adapter.js shimming edge.");w.browserShim=z;q.shimCreateObjectURL(a);z.shimGetUserMedia(a);z.shimPeerConnection(a);z.shimReplaceTrack(a);q.shimMaxMessageSize(a);q.shimSendThrowTypeError(a);break;case "safari":if(!v||!d.shimSafari){f("Safari shim is not included in this adapter release.");break}f("adapter.js shimming safari.");w.browserShim=v;q.shimCreateObjectURL(a);v.shimRTCIceServerUrls(a);
v.shimCallbacksAPI(a);v.shimLocalStreamsAPI(a);v.shimRemoteStreamsAPI(a);v.shimTrackEventTransceiver(a);v.shimGetUserMedia(a);v.shimCreateOfferLegacy(a);q.shimRTCIceCandidate(a);q.shimMaxMessageSize(a);q.shimSendThrowTypeError(a);break;default:f("Unsupported browser!")}return w}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":10,"./safari/safari_shim":12,"./utils":13}],5:[function(b,a,f){var g=b("../utils.js"),d=g.log;a.exports={shimGetUserMedia:b("./getusermedia"),
shimMediaStream:function(a){a.MediaStream=a.MediaStream||a.webkitMediaStream},shimOnTrack:function(a){if("object"!==typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype)"RTCRtpTransceiver"in a||g.wrapPeerConnectionEvent(a,"track",function(a){a.transceiver||(a.transceiver={receiver:a.receiver});return a});else{Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&this.removeEventListener("track",this._ontrack);
this.addEventListener("track",this._ontrack=a)}});var b=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){var f=this;f._ontrackpoly||(f._ontrackpoly=function(b){b.stream.addEventListener("addtrack",function(g){var d=a.RTCPeerConnection.prototype.getReceivers?f.getReceivers().find(function(a){return a.track&&a.track.id===g.track.id}):{track:g.track};var h=new Event("track");h.track=g.track;h.receiver=d;h.transceiver={receiver:d};h.streams=
[b.stream];f.dispatchEvent(h)});b.stream.getTracks().forEach(function(g){var d=a.RTCPeerConnection.prototype.getReceivers?f.getReceivers().find(function(a){return a.track&&a.track.id===g.id}):{track:g};var h=new Event("track");h.track=g;h.receiver=d;h.transceiver={receiver:d};h.streams=[b.stream];f.dispatchEvent(h)})},f.addEventListener("addstream",f._ontrackpoly));return b.apply(f,arguments)}}},shimGetSendersWithDtmf:function(a){if("object"===typeof a&&a.RTCPeerConnection&&!("getSenders"in a.RTCPeerConnection.prototype)&&
"createDTMFSender"in a.RTCPeerConnection.prototype){var b=function(a,b){return{track:b,get dtmf(){void 0===this._dtmf&&(this._dtmf="audio"===b.kind?a.createDTMFSender(b):null);return this._dtmf},_pc:a}};if(!a.RTCPeerConnection.prototype.getSenders){a.RTCPeerConnection.prototype.getSenders=function(){this._senders=this._senders||[];return this._senders.slice()};var f=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,g){var d=f.apply(this,arguments);d||(d=b(this,
a),this._senders.push(d));return d};var g=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){g.apply(this,arguments);var b=this._senders.indexOf(a);-1!==b&&this._senders.splice(b,1)}}var d=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var f=this;f._senders=f._senders||[];d.apply(f,[a]);a.getTracks().forEach(function(a){f._senders.push(b(f,a))})};var h=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=
function(a){var b=this;b._senders=b._senders||[];h.apply(b,[a]);a.getTracks().forEach(function(a){var f=b._senders.find(function(b){return b.track===a});f&&b._senders.splice(b._senders.indexOf(f),1)})}}else if("object"===typeof a&&a.RTCPeerConnection&&"getSenders"in a.RTCPeerConnection.prototype&&"createDTMFSender"in a.RTCPeerConnection.prototype&&a.RTCRtpSender&&!("dtmf"in a.RTCRtpSender.prototype)){var m=a.RTCPeerConnection.prototype.getSenders;a.RTCPeerConnection.prototype.getSenders=function(){var a=
this,b=m.apply(a,[]);b.forEach(function(b){b._pc=a});return b};Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get:function(){void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null);return this._dtmf}})}},shimSourceObject:function(a){var b=a&&a.URL;"object"===typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(a){var f=
this;this._srcObject=a;this.src&&b.revokeObjectURL(this.src);a?(this.src=b.createObjectURL(a),a.addEventListener("addtrack",function(){f.src&&b.revokeObjectURL(f.src);f.src=b.createObjectURL(a)}),a.addEventListener("removetrack",function(){f.src&&b.revokeObjectURL(f.src);f.src=b.createObjectURL(a)})):this.src=""}}))},shimAddTrackRemoveTrackWithNative:function(a){a.RTCPeerConnection.prototype.getLocalStreams=function(){var a=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};return Object.keys(this._shimmedLocalStreams).map(function(b){return a._shimmedLocalStreams[b][0]})};
var b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,f){if(!f)return b.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var g=b.apply(this,arguments);this._shimmedLocalStreams[f.id]?-1===this._shimmedLocalStreams[f.id].indexOf(g)&&this._shimmedLocalStreams[f.id].push(g):this._shimmedLocalStreams[f.id]=[f,g];return g};var f=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var b=this;this._shimmedLocalStreams=
this._shimmedLocalStreams||{};a.getTracks().forEach(function(a){if(b.getSenders().find(function(b){return b.track===a}))throw new DOMException("Track already exists.","InvalidAccessError");});var g=b.getSenders();f.apply(this,arguments);var d=b.getSenders().filter(function(a){return-1===g.indexOf(a)});this._shimmedLocalStreams[a.id]=[a].concat(d)};var g=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||
{};delete this._shimmedLocalStreams[a.id];return g.apply(this,arguments)};var d=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};a&&Object.keys(this._shimmedLocalStreams).forEach(function(f){var g=b._shimmedLocalStreams[f].indexOf(a);-1!==g&&b._shimmedLocalStreams[f].splice(g,1);1===b._shimmedLocalStreams[f].length&&delete b._shimmedLocalStreams[f]});return d.apply(this,arguments)}},shimAddTrackRemoveTrack:function(a){function b(a,
b){var f=b.sdp;Object.keys(a._reverseStreams||[]).forEach(function(b){b=a._reverseStreams[b];f=f.replace(new RegExp(a._streams[b.id].id,"g"),b.id)});return new RTCSessionDescription({type:b.type,sdp:f})}function f(a,b){var f=b.sdp;Object.keys(a._reverseStreams||[]).forEach(function(b){b=a._reverseStreams[b];f=f.replace(new RegExp(b.id,"g"),a._streams[b.id].id)});return new RTCSessionDescription({type:b.type,sdp:f})}var d=g.detectBrowser(a);if(a.RTCPeerConnection.prototype.addTrack&&65<=d.version)return this.shimAddTrackRemoveTrackWithNative(a);
var h=a.RTCPeerConnection.prototype.getLocalStreams;a.RTCPeerConnection.prototype.getLocalStreams=function(){var a=this,b=h.apply(this);a._reverseStreams=a._reverseStreams||{};return b.map(function(b){return a._reverseStreams[b.id]})};var m=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(b){var f=this;f._streams=f._streams||{};f._reverseStreams=f._reverseStreams||{};b.getTracks().forEach(function(a){if(f.getSenders().find(function(b){return b.track===a}))throw new DOMException("Track already exists.",
"InvalidAccessError");});if(!f._reverseStreams[b.id]){var g=new a.MediaStream(b.getTracks());f._streams[b.id]=g;f._reverseStreams[g.id]=b;b=g}m.apply(f,[b])};var v=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};v.apply(this,[this._streams[a.id]||a]);delete this._reverseStreams[this._streams[a.id]?this._streams[a.id].id:a.id];delete this._streams[a.id]};a.RTCPeerConnection.prototype.addTrack=
function(b,f){var g=this;if("closed"===g.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var d=[].slice.call(arguments,1);if(1!==d.length||!d[0].getTracks().find(function(a){return a===b}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(g.getSenders().find(function(a){return a.track===b}))throw new DOMException("Track already exists.",
"InvalidAccessError");g._streams=g._streams||{};g._reverseStreams=g._reverseStreams||{};(d=g._streams[f.id])?(d.addTrack(b),Promise.resolve().then(function(){g.dispatchEvent(new Event("negotiationneeded"))})):(d=new a.MediaStream([b]),g._streams[f.id]=d,g._reverseStreams[d.id]=f,g.addStream(d));return g.getSenders().find(function(a){return a.track===b})};["createOffer","createAnswer"].forEach(function(f){var g=a.RTCPeerConnection.prototype[f];a.RTCPeerConnection.prototype[f]=function(){var a=this,
f=arguments;return arguments.length&&"function"===typeof arguments[0]?g.apply(a,[function(g){g=b(a,g);f[0].apply(null,[g])},function(a){f[1]&&f[1].apply(null,a)},arguments[2]]):g.apply(a,arguments).then(function(f){return b(a,f)})}});var q=a.RTCPeerConnection.prototype.setLocalDescription;a.RTCPeerConnection.prototype.setLocalDescription=function(){if(!arguments.length||!arguments[0].type)return q.apply(this,arguments);arguments[0]=f(this,arguments[0]);return q.apply(this,arguments)};var w=Object.getOwnPropertyDescriptor(a.RTCPeerConnection.prototype,
"localDescription");Object.defineProperty(a.RTCPeerConnection.prototype,"localDescription",{get:function(){var a=w.get.apply(this);return""===a.type?a:b(this,a)}});a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;if("closed"===b.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!a._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(a._pc!==
b)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");b._streams=b._streams||{};var f;Object.keys(b._streams).forEach(function(g){b._streams[g].getTracks().find(function(b){return a.track===b})&&(f=b._streams[g])});f&&(1===f.getTracks().length?b.removeStream(b._reverseStreams[f.id]):f.removeTrack(a.track),b.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(a){var b=g.detectBrowser(a);if(!a.RTCPeerConnection&&a.webkitRTCPeerConnection)a.RTCPeerConnection=
function(b,f){d("PeerConnection");b&&b.iceTransportPolicy&&(b.iceTransports=b.iceTransportPolicy);return new a.webkitRTCPeerConnection(b,f)},a.RTCPeerConnection.prototype=a.webkitRTCPeerConnection.prototype,a.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.webkitRTCPeerConnection.generateCertificate}});else{var f=a.RTCPeerConnection;a.RTCPeerConnection=function(a,b){if(a&&a.iceServers){for(var d=[],h=0;h<a.iceServers.length;h++){var n=
a.iceServers[h];!n.hasOwnProperty("urls")&&n.hasOwnProperty("url")?(g.deprecated("RTCIceServer.url","RTCIceServer.urls"),n=JSON.parse(JSON.stringify(n)),n.urls=n.url,d.push(n)):d.push(a.iceServers[h])}a.iceServers=d}return new f(a,b)};a.RTCPeerConnection.prototype=f.prototype;Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return f.generateCertificate}})}var h=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,b,f){var g=this,d=
arguments;if(0<arguments.length&&"function"===typeof a)return h.apply(this,arguments);if(0===h.length&&(0===arguments.length||"function"!==typeof arguments[0]))return h.apply(this,[]);var n=function(a){var b={};a.result().forEach(function(a){var f={id:a.id,timestamp:a.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};a.names().forEach(function(b){f[b]=a.stat(b)});b[f.id]=f});return b},m=function(a){return new Map(Object.keys(a).map(function(b){return[b,
a[b]]}))};return 2<=arguments.length?h.apply(this,[function(a){d[1](m(n(a)))},arguments[0]]):(new Promise(function(a,b){h.apply(g,[function(b){a(m(n(b)))},b])})).then(b,f)};51>b.version&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var f=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){var a=arguments,b=this,g=new Promise(function(g,d){f.apply(b,[a[0],g,d])});return 2>a.length?g:g.then(function(){a[1].apply(null,[])},function(b){3<=
a.length&&a[2].apply(null,[b])})}});52>b.version&&["createOffer","createAnswer"].forEach(function(b){var f=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){var a=this;if(1>arguments.length||1===arguments.length&&"object"===typeof arguments[0]){var b=1===arguments.length?arguments[0]:void 0;return new Promise(function(g,d){f.apply(a,[g,d,b])})}return f.apply(this,arguments)}});["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var f=a.RTCPeerConnection.prototype[b];
a.RTCPeerConnection.prototype[b]=function(){arguments[0]=new ("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]);return f.apply(this,arguments)}});var m=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?m.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}},{"../utils.js":13,"./getusermedia":6}],6:[function(b,a,f){var g=b("../utils.js"),d=g.log;a.exports=function(a){var b=
g.detectBrowser(a),f=a&&a.navigator,h=function(a){if("object"!==typeof a||a.mandatory||a.optional)return a;var b={};Object.keys(a).forEach(function(f){if("require"!==f&&"advanced"!==f&&"mediaSource"!==f){var g="object"===typeof a[f]?a[f]:{ideal:a[f]};void 0!==g.exact&&"number"===typeof g.exact&&(g.min=g.max=g.exact);var d=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==g.ideal){b.optional=b.optional||[];var h={};"number"===typeof g.ideal?(h[d("min",
f)]=g.ideal,b.optional.push(h),h={},h[d("max",f)]=g.ideal):h[d("",f)]=g.ideal;b.optional.push(h)}void 0!==g.exact&&"number"!==typeof g.exact?(b.mandatory=b.mandatory||{},b.mandatory[d("",f)]=g.exact):["min","max"].forEach(function(a){void 0!==g[a]&&(b.mandatory=b.mandatory||{},b.mandatory[d(a,f)]=g[a])})}});a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced));return b},m=function(a,g){if(61<=b.version)return g(a);if((a=JSON.parse(JSON.stringify(a)))&&"object"===typeof a.audio){var n=function(a,
b,f){b in a&&!(f in a)&&(a[f]=a[b],delete a[b])};a=JSON.parse(JSON.stringify(a));n(a.audio,"autoGainControl","googAutoGainControl");n(a.audio,"noiseSuppression","googNoiseSuppression");a.audio=h(a.audio)}if(a&&"object"===typeof a.video){var m=a.video.facingMode;m=m&&("object"===typeof m?m:{ideal:m});n=66>b.version;if(!(!m||"user"!==m.exact&&"environment"!==m.exact&&"user"!==m.ideal&&"environment"!==m.ideal||f.mediaDevices.getSupportedConstraints&&f.mediaDevices.getSupportedConstraints().facingMode&&
!n)){delete a.video.facingMode;if("environment"===m.exact||"environment"===m.ideal)var r=["back","rear"];else if("user"===m.exact||"user"===m.ideal)r=["front"];if(r)return f.mediaDevices.enumerateDevices().then(function(b){b=b.filter(function(a){return"videoinput"===a.kind});var f=b.find(function(a){return r.some(function(b){return-1!==a.label.toLowerCase().indexOf(b)})});!f&&b.length&&-1!==r.indexOf("back")&&(f=b[b.length-1]);f&&(a.video.deviceId=m.exact?{exact:f.deviceId}:{ideal:f.deviceId});a.video=
h(a.video);d("chrome: "+JSON.stringify(a));return g(a)})}a.video=h(a.video)}d("chrome: "+JSON.stringify(a));return g(a)},t=function(a){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[a.name]||a.name,message:a.message,constraint:a.constraintName,
toString:function(){return this.name+(this.message&&": ")+this.message}}};f.getUserMedia=function(a,b,g){m(a,function(a){f.webkitGetUserMedia(a,b,function(a){g&&g(t(a))})})};var v=function(a){return new Promise(function(b,g){f.getUserMedia(a,b,g)})};f.mediaDevices||(f.mediaDevices={getUserMedia:v,enumerateDevices:function(){return new Promise(function(b){var f={audio:"audioinput",video:"videoinput"};return a.MediaStreamTrack.getSources(function(a){b(a.map(function(a){return{label:a.label,kind:f[a.kind],
deviceId:a.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}});if(f.mediaDevices.getUserMedia){var q=f.mediaDevices.getUserMedia.bind(f.mediaDevices);f.mediaDevices.getUserMedia=function(a){return m(a,function(a){return q(a).then(function(b){if(a.audio&&!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){a.stop()}),new DOMException("","NotFoundError");
return b},function(a){return Promise.reject(t(a))})})}}else f.mediaDevices.getUserMedia=function(a){return v(a)};"undefined"===typeof f.mediaDevices.addEventListener&&(f.mediaDevices.addEventListener=function(){d("Dummy mediaDevices.addEventListener called.")});"undefined"===typeof f.mediaDevices.removeEventListener&&(f.mediaDevices.removeEventListener=function(){d("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":13}],7:[function(b,a,f){var g=b("sdp"),d=b("./utils");a.exports=
{shimRTCIceCandidate:function(a){if(!(a.RTCIceCandidate&&"foundation"in a.RTCIceCandidate.prototype)){var b=a.RTCIceCandidate;a.RTCIceCandidate=function(a){"object"===typeof a&&a.candidate&&0===a.candidate.indexOf("a=")&&(a=JSON.parse(JSON.stringify(a)),a.candidate=a.candidate.substr(2));var f=new b(a);a=g.parseCandidate(a.candidate);var d=Object.assign(f,a);d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}};return d};
d.wrapPeerConnectionEvent(a,"icecandidate",function(b){b.candidate&&Object.defineProperty(b,"candidate",{value:new a.RTCIceCandidate(b.candidate),writable:"false"});return b})}},shimCreateObjectURL:function(a){var b=a&&a.URL;if("object"===typeof a&&a.HTMLMediaElement&&"srcObject"in a.HTMLMediaElement.prototype&&b.createObjectURL&&b.revokeObjectURL){var f=b.createObjectURL.bind(b),g=b.revokeObjectURL.bind(b),h=new Map,m=0;b.createObjectURL=function(a){if("getTracks"in a){var b="polyblob:"+ ++m;h.set(b,
a);d.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream");return b}return f(a)};b.revokeObjectURL=function(a){g(a);h.delete(a)};var v=Object.getOwnPropertyDescriptor(a.HTMLMediaElement.prototype,"src");Object.defineProperty(a.HTMLMediaElement.prototype,"src",{get:function(){return v.get.apply(this)},set:function(a){this.srcObject=h.get(a)||null;return v.set.apply(this,[a])}});var q=a.HTMLMediaElement.prototype.setAttribute;a.HTMLMediaElement.prototype.setAttribute=function(){2===arguments.length&&
"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=h.get(arguments[1])||null);return q.apply(this,arguments)}}},shimMaxMessageSize:function(a){if(!a.RTCSctpTransport&&a.RTCPeerConnection){var b=d.detectBrowser(a);"sctp"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"sctp",{get:function(){return"undefined"===typeof this._sctp?null:this._sctp}});var f=function(a){a=g.splitSections(a.sdp);a.shift();return a.some(function(a){return(a=g.parseMLine(a))&&"application"===
a.kind&&-1!==a.protocol.indexOf("SCTP")})},h=function(a){a=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===a||2>a.length)return-1;a=parseInt(a[1],10);return a!==a?-1:a},m=function(a){var f=65536;"firefox"===b.browser&&(f=57>b.version?-1===a?16384:2147483637:57===b.version?65535:65536);return f},t=function(a,f){var d=65536;"firefox"===b.browser&&57===b.version&&(d=65535);a=g.matchPrefix(a.sdp,"a=max-message-size:");0<a.length?d=parseInt(a[0].substr(19),10):"firefox"===b.browser&&-1!==f&&(d=
2147483637);return d},v=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){this._sctp=null;if(f(arguments[0])){var a=h(arguments[0]),b=m(a);a=t(arguments[0],a);var g=0===b&&0===a?Number.POSITIVE_INFINITY:0===b||0===a?Math.max(b,a):Math.min(b,a);b={};Object.defineProperty(b,"maxMessageSize",{get:function(){return g}});this._sctp=b}return v.apply(this,arguments)}}},shimSendThrowTypeError:function(a){var b=a.RTCPeerConnection.prototype.createDataChannel;
a.RTCPeerConnection.prototype.createDataChannel=function(){var a=this,f=b.apply(a,arguments),g=f.send;f.send=function(){var b=arguments[0];if((b.length||b.size||b.byteLength)>a.sctp.maxMessageSize)throw new DOMException("Message too large (can send a maximum of "+a.sctp.maxMessageSize+" bytes)","TypeError");return g.apply(this,arguments)};return f}}}},{"./utils":13,sdp:2}],8:[function(b,a,f){var g=b("../utils"),d=b("rtcpeerconnection-shim");a.exports={shimGetUserMedia:b("./getusermedia"),shimPeerConnection:function(a){var b=
g.detectBrowser(a);if(a.RTCIceGatherer&&(a.RTCIceCandidate||(a.RTCIceCandidate=function(a){return a}),a.RTCSessionDescription||(a.RTCSessionDescription=function(a){return a}),15025>b.version)){var f=Object.getOwnPropertyDescriptor(a.MediaStreamTrack.prototype,"enabled");Object.defineProperty(a.MediaStreamTrack.prototype,"enabled",{set:function(a){f.set.call(this,a);var b=new Event("enabled");b.enabled=a;this.dispatchEvent(b)}})}!a.RTCRtpSender||"dtmf"in a.RTCRtpSender.prototype||Object.defineProperty(a.RTCRtpSender.prototype,
"dtmf",{get:function(){void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new a.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null));return this._dtmf}});a.RTCPeerConnection=d(a,b.version)},shimReplaceTrack:function(a){!a.RTCRtpSender||"replaceTrack"in a.RTCRtpSender.prototype||(a.RTCRtpSender.prototype.replaceTrack=a.RTCRtpSender.prototype.setTrack)}}},{"../utils":13,"./getusermedia":9,"rtcpeerconnection-shim":1}],9:[function(b,a,f){a.exports=function(a){a=a&&a.navigator;var b=
function(a){return{name:{PermissionDeniedError:"NotAllowedError"}[a.name]||a.name,message:a.message,constraint:a.constraint,toString:function(){return this.name}}},f=a.mediaDevices.getUserMedia.bind(a.mediaDevices);a.mediaDevices.getUserMedia=function(a){return f(a).catch(function(a){return Promise.reject(b(a))})}}},{}],10:[function(b,a,f){var g=b("../utils");a.exports={shimGetUserMedia:b("./getusermedia"),shimOnTrack:function(a){"object"!==typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype||
Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly));this.addEventListener("track",this._ontrack=a);this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.getTracks().forEach(function(b){var f=new Event("track");f.track=b;f.receiver={track:b};f.transceiver={receiver:f.receiver};f.streams=[a.stream];
this.dispatchEvent(f)}.bind(this))}.bind(this))}});"object"===typeof a&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(a){"object"===typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},
set:function(a){this.mozSrcObject=a}}))},shimPeerConnection:function(a){var b=g.detectBrowser(a);if("object"===typeof a&&(a.RTCPeerConnection||a.mozRTCPeerConnection)){a.RTCPeerConnection||(a.RTCPeerConnection=function(f,g){if(38>b.version&&f&&f.iceServers){for(var d=[],h=0;h<f.iceServers.length;h++){var n=f.iceServers[h];if(n.hasOwnProperty("urls"))for(var m=0;m<n.urls.length;m++){var r={url:n.urls[m]};0===n.urls[m].indexOf("turn")&&(r.username=n.username,r.credential=n.credential);d.push(r)}else d.push(f.iceServers[h])}f.iceServers=
d}return new a.mozRTCPeerConnection(f,g)},a.RTCPeerConnection.prototype=a.mozRTCPeerConnection.prototype,a.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.mozRTCPeerConnection.generateCertificate}}),a.RTCSessionDescription=a.mozRTCSessionDescription,a.RTCIceCandidate=a.mozRTCIceCandidate);["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var f=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=
function(){arguments[0]=new ("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]);return f.apply(this,arguments)}});var f=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?f.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var d=function(a){var b=new Map;Object.keys(a).forEach(function(f){b.set(f,a[f]);b[f]=a[f]});return b},h={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",
candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},z=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,f,g){return z.apply(this,[a||null]).then(function(a){48>b.version&&(a=d(a));if(53>b.version&&!f)try{a.forEach(function(a){a.type=h[a.type]||a.type})}catch(p){if("TypeError"!==p.name)throw p;a.forEach(function(b,f){a.set(f,Object.assign({},b,{type:h[b.type]||b.type}))})}return a}).then(f,g)}}},shimRemoveStream:function(a){!a.RTCPeerConnection||
"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){var b=this;g.deprecated("removeStream","removeTrack");this.getSenders().forEach(function(f){f.track&&-1!==a.getTracks().indexOf(f.track)&&b.removeTrack(f)})})}}},{"../utils":13,"./getusermedia":11}],11:[function(b,a,f){var g=b("../utils"),d=g.log;a.exports=function(a){var b=g.detectBrowser(a),f=a&&a.navigator;a=a&&a.MediaStreamTrack;var h=function(a){return{name:{InternalError:"NotReadableError",
NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[a.name]||a.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[a.message]||a.message,constraint:a.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},m=function(a,g,n){var m=function(a){if("object"!==typeof a||a.require)return a;var b=[];Object.keys(a).forEach(function(f){if("require"!==
f&&"advanced"!==f&&"mediaSource"!==f){var g=a[f]="object"===typeof a[f]?a[f]:{ideal:a[f]};void 0===g.min&&void 0===g.max&&void 0===g.exact||b.push(f);void 0!==g.exact&&("number"===typeof g.exact?g.min=g.max=g.exact:a[f]=g.exact,delete g.exact);if(void 0!==g.ideal){a.advanced=a.advanced||[];var d={};d[f]="number"===typeof g.ideal?{min:g.ideal,max:g.ideal}:g.ideal;a.advanced.push(d);delete g.ideal;Object.keys(g).length||delete a[f]}}});b.length&&(a.require=b);return a};a=JSON.parse(JSON.stringify(a));
38>b.version&&(d("spec: "+JSON.stringify(a)),a.audio&&(a.audio=m(a.audio)),a.video&&(a.video=m(a.video)),d("ff37: "+JSON.stringify(a)));return f.mozGetUserMedia(a,g,function(a){n(h(a))})},t=function(a){return new Promise(function(b,f){m(a,b,f)})};f.mediaDevices||(f.mediaDevices={getUserMedia:t,addEventListener:function(){},removeEventListener:function(){}});f.mediaDevices.enumerateDevices=f.mediaDevices.enumerateDevices||function(){return new Promise(function(a){a([{kind:"audioinput",deviceId:"default",
label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})};if(41>b.version){var v=f.mediaDevices.enumerateDevices.bind(f.mediaDevices);f.mediaDevices.enumerateDevices=function(){return v().then(void 0,function(a){if("NotFoundError"===a.name)return[];throw a;})}}if(49>b.version){var q=f.mediaDevices.getUserMedia.bind(f.mediaDevices);f.mediaDevices.getUserMedia=function(a){return q(a).then(function(b){if(a.audio&&!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){a.stop()}),
new DOMException("The object can not be found here.","NotFoundError");return b},function(a){return Promise.reject(h(a))})}}if(!(55<b.version&&"autoGainControl"in f.mediaDevices.getSupportedConstraints())){var w=function(a,b,f){b in a&&!(f in a)&&(a[f]=a[b],delete a[b])},p=f.mediaDevices.getUserMedia.bind(f.mediaDevices);f.mediaDevices.getUserMedia=function(a){"object"===typeof a&&"object"===typeof a.audio&&(a=JSON.parse(JSON.stringify(a)),w(a.audio,"autoGainControl","mozAutoGainControl"),w(a.audio,
"noiseSuppression","mozNoiseSuppression"));return p(a)};if(a&&a.prototype.getSettings){var B=a.prototype.getSettings;a.prototype.getSettings=function(){var a=B.apply(this,arguments);w(a,"mozAutoGainControl","autoGainControl");w(a,"mozNoiseSuppression","noiseSuppression");return a}}if(a&&a.prototype.applyConstraints){var G=a.prototype.applyConstraints;a.prototype.applyConstraints=function(a){"audio"===this.kind&&"object"===typeof a&&(a=JSON.parse(JSON.stringify(a)),w(a,"autoGainControl","mozAutoGainControl"),
w(a,"noiseSuppression","mozNoiseSuppression"));return G.apply(this,[a])}}}f.getUserMedia=function(a,d,h){if(44>b.version)return m(a,d,h);g.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia");f.mediaDevices.getUserMedia(a).then(d,h)}}},{"../utils":13}],12:[function(b,a,f){var g=b("../utils");a.exports={shimLocalStreamsAPI:function(a){if("object"===typeof a&&a.RTCPeerConnection){"getLocalStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getLocalStreams=
function(){this._localStreams||(this._localStreams=[]);return this._localStreams});"getStreamById"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getStreamById=function(a){var b=null;this._localStreams&&this._localStreams.forEach(function(f){f.id===a&&(b=f)});this._remoteStreams&&this._remoteStreams.forEach(function(f){f.id===a&&(b=f)});return b});if(!("addStream"in a.RTCPeerConnection.prototype)){var b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addStream=
function(a){this._localStreams||(this._localStreams=[]);-1===this._localStreams.indexOf(a)&&this._localStreams.push(a);var f=this;a.getTracks().forEach(function(g){b.call(f,g,a)})};a.RTCPeerConnection.prototype.addTrack=function(a,f){f&&(this._localStreams?-1===this._localStreams.indexOf(f)&&this._localStreams.push(f):this._localStreams=[f]);return b.call(this,a,f)}}"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){this._localStreams||(this._localStreams=
[]);var b=this._localStreams.indexOf(a);if(-1!==b){this._localStreams.splice(b,1);var f=this,g=a.getTracks();this.getSenders().forEach(function(a){-1!==g.indexOf(a.track)&&f.removeTrack(a)})}})}},shimRemoteStreamsAPI:function(a){"object"===typeof a&&a.RTCPeerConnection&&("getRemoteStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,
"onaddstream",{get:function(){return this._onaddstream},set:function(a){var b=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly));this.addEventListener("addstream",this._onaddstream=a);this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(function(a){b._remoteStreams||(b._remoteStreams=[]);if(!(0<=b._remoteStreams.indexOf(a))){b._remoteStreams.push(a);var f=new Event("addstream");f.stream=
a;b.dispatchEvent(f)}})})}}))},shimCallbacksAPI:function(a){if("object"===typeof a&&a.RTCPeerConnection){a=a.RTCPeerConnection.prototype;var b=a.createOffer,f=a.createAnswer,g=a.setLocalDescription,d=a.setRemoteDescription,h=a.addIceCandidate;a.createOffer=function(a,f){var g=b.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);if(!f)return g;g.then(a,f);return Promise.resolve()};a.createAnswer=function(a,b){var g=f.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);if(!b)return g;
g.then(a,b);return Promise.resolve()};var t=function(a,b,f){a=g.apply(this,[a]);if(!f)return a;a.then(b,f);return Promise.resolve()};a.setLocalDescription=t;t=function(a,b,f){a=d.apply(this,[a]);if(!f)return a;a.then(b,f);return Promise.resolve()};a.setRemoteDescription=t;t=function(a,b,f){a=h.apply(this,[a]);if(!f)return a;a.then(b,f);return Promise.resolve()};a.addIceCandidate=t}},shimGetUserMedia:function(a){var b=a&&a.navigator;b.getUserMedia||(b.webkitGetUserMedia?b.getUserMedia=b.webkitGetUserMedia.bind(b):
b.mediaDevices&&b.mediaDevices.getUserMedia&&(b.getUserMedia=function(a,f,g){b.mediaDevices.getUserMedia(a).then(f,g)}.bind(b)))},shimRTCIceServerUrls:function(a){var b=a.RTCPeerConnection;a.RTCPeerConnection=function(a,f){if(a&&a.iceServers){for(var d=[],h=0;h<a.iceServers.length;h++){var n=a.iceServers[h];!n.hasOwnProperty("urls")&&n.hasOwnProperty("url")?(g.deprecated("RTCIceServer.url","RTCIceServer.urls"),n=JSON.parse(JSON.stringify(n)),n.urls=n.url,delete n.url,d.push(n)):d.push(a.iceServers[h])}a.iceServers=
d}return new b(a,f)};a.RTCPeerConnection.prototype=b.prototype;"generateCertificate"in a.RTCPeerConnection&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return b.generateCertificate}})},shimTrackEventTransceiver:function(a){"object"===typeof a&&a.RTCPeerConnection&&"receiver"in a.RTCTrackEvent.prototype&&!a.RTCTransceiver&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(a){var b=
a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(a){if(a){var f=this.getTransceivers().find(function(a){return a.sender.track&&"audio"===a.sender.track.kind});!1===a.offerToReceiveAudio&&f?"sendrecv"===f.direction?f.setDirection?f.setDirection("sendonly"):f.direction="sendonly":"recvonly"===f.direction&&(f.setDirection?f.setDirection("inactive"):f.direction="inactive"):!0!==a.offerToReceiveAudio||f||this.addTransceiver("audio");f=this.getTransceivers().find(function(a){return a.sender.track&&
"video"===a.sender.track.kind});!1===a.offerToReceiveVideo&&f?"sendrecv"===f.direction?f.setDirection("sendonly"):"recvonly"===f.direction&&f.setDirection("inactive"):!0!==a.offerToReceiveVideo||f||this.addTransceiver("video")}return b.apply(this,arguments)}}}},{"../utils":13}],13:[function(b,a,f){function g(a,b,f){return(a=a.match(b))&&a.length>=f&&parseInt(a[f],10)}var h=!0,m=!0;a.exports={extractVersion:g,wrapPeerConnectionEvent:function(a,b,f){if(a.RTCPeerConnection){a=a.RTCPeerConnection.prototype;
var g=a.addEventListener;a.addEventListener=function(a,d){if(a!==b)return g.apply(this,arguments);var h=function(a){d(f(a))};this._eventMap=this._eventMap||{};this._eventMap[d]=h;return g.apply(this,[a,h])};var d=a.removeEventListener;a.removeEventListener=function(a,f){if(a!==b||!this._eventMap||!this._eventMap[f])return d.apply(this,arguments);var g=this._eventMap[f];delete this._eventMap[f];return d.apply(this,[a,g])};Object.defineProperty(a,"on"+b,{get:function(){return this["_on"+b]},set:function(a){this["_on"+
b]&&(this.removeEventListener(b,this["_on"+b]),delete this["_on"+b]);a&&this.addEventListener(b,this["_on"+b]=a)}})}},disableLog:function(a){return"boolean"!==typeof a?Error("Argument type: "+typeof a+". Please use a boolean."):(h=a)?"adapter.js logging disabled":"adapter.js logging enabled"},disableWarnings:function(a){if("boolean"!==typeof a)return Error("Argument type: "+typeof a+". Please use a boolean.");m=!a;return"adapter.js deprecation warnings "+(a?"disabled":"enabled")},log:function(){"object"!==
typeof d||h||"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)},deprecated:function(a,b){m&&console.warn(a+" is deprecated, please use "+b+" instead.")},detectBrowser:function(a){var b=a&&a.navigator,f={browser:null,version:null};if("undefined"===typeof a||!a.navigator)return f.browser="Not a browser.",f;b.mozGetUserMedia?(f.browser="firefox",f.version=g(b.userAgent,/Firefox\/(\d+)\./,1)):b.webkitGetUserMedia?(f.browser="chrome",f.version=g(b.userAgent,
/Chrom(e|ium)\/(\d+)\./,2)):b.mediaDevices&&b.userAgent.match(/Edge\/(\d+).(\d+)$/)?(f.browser="edge",f.version=g(b.userAgent,/Edge\/(\d+).(\d+)$/,2)):b.mediaDevices&&b.userAgent.match(/AppleWebKit\/(\d+)\./)?(f.browser="safari",f.version=g(b.userAgent,/AppleWebKit\/(\d+)\./,1)):f.browser="Not a supported browser.";return f}}},{}]},{},[3])(3)});d.adapter=function(){return{RTCPeerConnection:null,webrtcDetectedBrowser:null,init:function(c){virtualclass.system.getusermedia&&(c.mozGetUserMedia?(this.attachMediaStream=
function(b,a){this.videoAdd=!0;var c=d.URL||d.webkitURL;b.src=c?c.createObjectURL(a):a;b.play()},reattachMediaStream=function(b,a){console.log("Reattaching media stream");b.mozSrcObject=a.mozSrcObject;b.play()}):c.webkitGetUserMedia&&"undefined"!=typeof suman?(console.log("This appears to be Chrome"),this.attachMediaStream=function(b,a){var c=d.URL||d.webkitURL;b.src=c?c.createObjectURL(a):a;b.play();this.videoAdd=!0},reattachMediaStream=function(b,a){b.src=a.src},webkitMediaStream.prototype.getVideoTracks||
(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})):c.mediaDevices?this.attachMediaStream=function(b,a){var c=d.URL||d.webkitURL;b.src=c?c.createObjectURL(a):a;b.play()}:
console.log("Browser does not appear to be WebRTC-capable"));return c}}}})(window);function Resampler(d,c,b,a,f){this.fromSampleRate=d;this.toSampleRate=c;this.channels=b|0;this.outputBufferSize=a;this.noReturn=!!f;this.initialize()}
Resampler.prototype.initialize=function(){if(0<this.fromSampleRate&&0<this.toSampleRate&&0<this.channels)this.fromSampleRate==this.toSampleRate?(this.resampler=this.bypassResampler,this.ratioWeight=1):(this.fromSampleRate<this.toSampleRate?(this.compileLinearInterpolationFunction(),this.lastWeight=1):(this.compileMultiTapFunction(),this.tailExists=!1,this.lastWeight=0),this.ratioWeight=this.fromSampleRate/this.toSampleRate,this.initializeBuffers());else throw Error("Invalid settings specified for the resampler.");
};
Resampler.prototype.compileLinearInterpolationFunction=function(){for(var d="var bufferLength = buffer.length;\tvar outLength = this.outputBufferSize;\tif ((bufferLength % "+this.channels+") == 0) {\t\tif (bufferLength > 0) {\t\t\tvar ratioWeight = this.ratioWeight;\t\t\tvar weight = this.lastWeight;\t\t\tvar firstWeight = 0;\t\t\tvar secondWeight = 0;\t\t\tvar sourceOffset = 0;\t\t\tvar outputOffset = 0;\t\t\tvar outputBuffer = this.outputBuffer;\t\t\tfor (; weight < 1; weight += ratioWeight) {\t\t\t\tsecondWeight = weight % 1;\t\t\t\tfirstWeight = 1 - secondWeight;",c=
0;c<this.channels;++c)d+="outputBuffer[outputOffset++] = (this.lastOutput["+c+"] * firstWeight) + (buffer["+c+"] * secondWeight);";d+="}\t\t\tweight -= 1;\t\t\tfor (bufferLength -= "+this.channels+", sourceOffset = Math.floor(weight) * "+this.channels+"; outputOffset < outLength && sourceOffset < bufferLength;) {\t\t\t\tsecondWeight = weight % 1;\t\t\t\tfirstWeight = 1 - secondWeight;";for(c=0;c<this.channels;++c)d+="outputBuffer[outputOffset++] = (buffer[sourceOffset"+(0<c?" + "+c:"")+"] * firstWeight) + (buffer[sourceOffset + "+
(this.channels+c)+"] * secondWeight);";d+="weight += ratioWeight;\t\t\t\tsourceOffset = Math.floor(weight) * "+this.channels+";\t\t\t}";for(c=0;c<this.channels;++c)d+="this.lastOutput["+c+"] = buffer[sourceOffset++];";this.resampler=Function("buffer",d+'this.lastWeight = weight % 1;\t\t\treturn this.bufferSlice(outputOffset);\t\t}\t\telse {\t\t\treturn (this.noReturn) ? 0 : [];\t\t}\t}\telse {\t\tthrow(new Error("Buffer was of incorrect sample length."));\t}')};
Resampler.prototype.compileMultiTapFunction=function(){for(var d="var bufferLength = buffer.length;\tvar outLength = this.outputBufferSize;\tif ((bufferLength % "+this.channels+") == 0) {\t\tif (bufferLength > 0) {\t\t\tvar ratioWeight = this.ratioWeight;\t\t\tvar weight = 0;",c=0;c<this.channels;++c)d+="var output"+c+" = 0;";d+="var actualPosition = 0;\t\t\tvar amountToNext = 0;\t\t\tvar alreadyProcessedTail = !this.tailExists;\t\t\tthis.tailExists = false;\t\t\tvar outputBuffer = this.outputBuffer;\t\t\tvar outputOffset = 0;\t\t\tvar currentPosition = 0;\t\t\tdo {\t\t\t\tif (alreadyProcessedTail) {\t\t\t\t\tweight = ratioWeight;";
for(c=0;c<this.channels;++c)d+="output"+c+" = 0;";d+="}\t\t\t\telse {\t\t\t\t\tweight = this.lastWeight;";for(c=0;c<this.channels;++c)d+="output"+c+" = this.lastOutput["+c+"];";d+="alreadyProcessedTail = true;\t\t\t\t}\t\t\t\twhile (weight > 0 && actualPosition < bufferLength) {\t\t\t\t\tamountToNext = 1 + actualPosition - currentPosition;\t\t\t\t\tif (weight >= amountToNext) {";for(c=0;c<this.channels;++c)d+="output"+c+" += buffer[actualPosition++] * amountToNext;";d+="currentPosition = actualPosition;\t\t\t\t\t\tweight -= amountToNext;\t\t\t\t\t}\t\t\t\t\telse {";
for(c=0;c<this.channels;++c)d+="output"+c+" += buffer[actualPosition"+(0<c?" + "+c:"")+"] * weight;";d+="currentPosition += weight;\t\t\t\t\t\tweight = 0;\t\t\t\t\t\tbreak;\t\t\t\t\t}\t\t\t\t}\t\t\t\tif (weight == 0) {";for(c=0;c<this.channels;++c)d+="outputBuffer[outputOffset++] = output"+c+" / ratioWeight;";d+="}\t\t\t\telse {\t\t\t\t\tthis.lastWeight = weight;";for(c=0;c<this.channels;++c)d+="this.lastOutput["+c+"] = output"+c+";";this.resampler=Function("buffer",d+'this.tailExists = true;\t\t\t\t\tbreak;\t\t\t\t}\t\t\t} while (actualPosition < bufferLength && outputOffset < outLength);\t\t\treturn this.bufferSlice(outputOffset);\t\t}\t\telse {\t\t\treturn (this.noReturn) ? 0 : [];\t\t}\t}\telse {\t\tthrow(new Error("Buffer was of incorrect sample length."));\t}')};
Resampler.prototype.bypassResampler=function(d){return this.noReturn?(this.outputBuffer=d,d.length):d};Resampler.prototype.bufferSlice=function(d){if(this.noReturn)return d;try{return this.outputBuffer.subarray(0,d)}catch(c){try{return this.outputBuffer.length=d,this.outputBuffer}catch(b){return this.outputBuffer.slice(0,d)}}};
Resampler.prototype.initializeBuffers=function(){try{this.outputBuffer=new Float32Array(this.outputBufferSize),this.lastOutput=new Float32Array(this.channels)}catch(d){this.outputBuffer=[],this.lastOutput=[]}};(function(d){function c(a){l=a.length;for(buf=new Int16Array(l);l--;)buf[l]=32767*Math.min(1,a[l]);return buf}repMode=!1;var b=0,a=0,f=0,g=65535,h=0,m={},n={},r={},A={};d.media=function(){return{isChannelReady:"",isInitiator:!1,isStarted:"",pc:[],cn:0,ba:!1,bb:!1,bc:!1,bNotRender:!1,remoteStream:"",turnReady:"",oneExecuted:!1,videoControlId:"videoContainer",videoContainerId:"videos",util:{imageReplaceWithVideo:function(a,b){var c=document.getElementById("ml"+a);virtualclass.vutil.elemHasAnyClass("ml"+
a)&&c.classList.remove("userImg");null!=c?(a=c.getElementsByTagName("a")[0],c=a.getElementsByTagName("img")[0],a.classList.contains("hasVideo")||(a.className+=" hasVideo"),a.replaceChild(b,c)):console.log("chatUser is Null")}},audioVisual:{init:function(){this.audioCtx=new (d.AudioContext||d.webkitAudioContext);this.analyser=this.audioCtx.createAnalyser();this.analyser.minDecibels=-90;this.analyser.maxDecibels=-10;this.analyser.smoothingTimeConstant=.85;this.distortion=this.audioCtx.createWaveShaper();
this.gainNode=this.audioCtx.createGain();this.biquadFilter=this.audioCtx.createBiquadFilter();this.convolver=this.audioCtx.createConvolver()},readyForVisual:function(a){this.source=this.audioCtx.createMediaStreamSource(a);this.source.connect(this.analyser);this.analyser.connect(this.distortion);this.distortion.connect(this.biquadFilter);this.biquadFilter.connect(this.convolver);this.convolver.connect(this.gainNode);this.gainNode.connect(this.audioCtx.destination)}},audio:{audioStreamArr:[],tempAudioStreamArr:[],
recordingLength:0,bufferSize:0,encMode:"alaw",recordAudio:!1,rec:"",otherSound:!1,audioNodes:[],sdElem:"silenceDetect",init:function(){var a=document.getElementById("speakerPressOnce").dataset.audioPlaying;virtualclass.gObj.audMouseDown="true"==a?!0:!1;this.Html5Audio={audioContext:new (d.AudioContext||d.webkitAudioContext)};this.resampler=new Resampler(cthis.audio.Html5Audio.audioContext.sampleRate,8E3,1,4096);this.graph={height:56,width:4,average:0,display:function(){var a=cthis.video;roles.hasControls()&&
this._display(a.tempVidCont,this.height-this.height*this.average/100)},_display:function(a,b){a.beginPath();a.moveTo(this.width,this.height);a.lineTo(this.width,b);a.lineWidth=this.width;a.strokeStyle="rgba(32, 37, 247, 0.8)";a.closePath();a.stroke()}};this.attachFunctionsToAudioWidget()},muteButtonToogle:function(){var a=document.querySelector("#speakerPressOnce");null!=a&&a.dataset.audioPlaying&&"true"==a.dataset.audioPlaying&&a.click()},audioSend:function(a,b){if(virtualclass.gObj.audMouseDown&&
1==io.sock.readyState){var c=virtualclass.vutil.breakintobytes(virtualclass.gObj.uid,8);c=new Int8Array([101,c[0],c[1],c[2],c[3]]);var f=new Int8Array(a.length+c.length);f.set(c);f.set(a,c.length);ioAdapter.sendBinary(f);virtualclass.gObj.video.audio.setAudioStatus(b)}else virtualclass.gObj.video.audio.setAudioStatus("stop")},silenceDetection:function(c,d){var n=0,m=0;for(i=0;i<d.length;i++){var r=Math.abs(d[i]);n<r&&(n=r);m+=r}f=m/d.length;d=Math.abs(f^2-a^2);a=f;5>d&&(g=n);g>n&&(g=n);h<n&&(h=n);
20*g<h&&(g*=5);h/20>g&&(h/=5);10<p&&(h*=.8);var p=h/g;m=n/g;20<=p||2<m||d>g||25<d||n>2*g||4>=p?(this.audioSend(c,"sending"),b=3):0<b?(this.audioSend(c,"sending"),b--):2>p?this.audioSend(c,"sending"):(this.setAudioStatus("notSending"),ioAdapter.send({cf:"na"}));return c},setAudioStatus:function(a){if("undefined"==typeof b)var b=document.getElementById("audioWidget").getElementsByClassName(this.sdElem)[0];b.setAttribute("data-silence-detect",a)},makeIconNotDraggable:function(a,b){var c=document.getElementById(a,
b).getContext("2d"),f=new Image;f.onload=function(){c.drawImage(f,0,0)};f.src=d.whiteboardPath+"images/"+b},attachFunctionsToAudioWidget:function(){for(var a=document.getElementById("audioWidget").getElementsByClassName("audioTool"),b=0;b<a.length;b++)"speakerPressOnce"!=a[b].id&&"speakerPressing"==a[b].id&&this.attachSpeakToStudent(a[b].id),"speakerPressing"!=a[b].id&&a[b].addEventListener("click",this.audioToolInit)},audioToolInit:function(){if(virtualclass.gObj.meetingMode){var a=document.getElementById(this.id);
"false"==a.getAttribute("data-audio-playing")&&"undefined"==typeof alwaysDisable?virtualclass.vutil.audioStatus(a,"true"):virtualclass.vutil.audioStatus(a,"false");virtualclass.multiVideo.disableAudio()}else{var b=virtualclass.gObj.video.audio;if("speakerPressOnce"==this.id)b.clickOnceSpeaker(this.id);else if("audioTest"==this.id){var c=this;virtualclass.popup.confirmInput(virtualclass.lang.getString("audioTest"),function(a){a&&b.testInit(c.id)})}else"silenceDetect"==this.id&&(this.getElementsByTagName("a"),
b.sd?(b.sd=!1,this.className+=" sdDisable"):(b.sd=!0,this.className+=" sdEnable"))}},attachSpeakToStudent:function(a){var b=this,c=document.getElementById(a),f=!1;c.addEventListener("mousedown",function(){if(!virtualclass.gObj.audMouseDown){b.studentSpeak(c);f=!0;var a=document.getElementById("speakerPressonceLabel");null!=a&&virtualclass.vutil.elemHasAnyClass("speakerPressonceLabel")&&a.classList.contains("silenceDetect")&&(a.removeAttribute("data-silence-detect"),a.classList.remove("silenceDetect"),
0>=a.classList.length&&a.removeAttribute("class"),a=a.getElementsByTagName("i")[0],null!=a&&(a.setAttribute("data-silence-detect","stop"),a.className+=" silenceDetect"))}});c.addEventListener("mouseup",function(){if(f){b.studentNotSpeak(c);f=!1;var a=document.getElementById("speakerPressonceLabel"),g=a.getElementsByTagName("i")[0];"undefined"!=typeof g.classList&&g.classList.contains("silenceDetect")&&(g.classList.remove("silenceDetect"),0>=g.classList.length&&g.removeAttribute("class"),a.removeAttribute("data-silence-detect"));
null!==a&&(a.setAttribute("data-silence-detect","stop"),a.className=g.className+" silenceDetect")}})},attachAudioPressOnce:function(){var a=document.getElementById("speakerPressOnce");a.setAttribute("data-audio-playing","false");var b=this;a.addEventListener("click",function(){b.clickOnceSpeaker.call(b,a.id)})},clickOnceSpeaker:function(a,b){a=document.getElementById(a);document.getElementById("speakerPressing");var c=a.getElementsByClassName("congtooltip")[0];"false"==a.getAttribute("data-audio-playing")&&
"undefined"==typeof b?(this.studentSpeak(),a.setAttribute("data-audio-playing","true"),c.setAttribute("data-title",virtualclass.lang.getString("audioEnable")),a.className="audioTool active"):(this.studentNotSpeak(),a.setAttribute("data-audio-playing","false"),c&&c.setAttribute("data-title",virtualclass.lang.getString("audioDisable")),a.className="audioTool deactive")},studentSpeak:function(a){"undefined"!=typeof a&&(document.getElementById(a.id+"Button"),a.classList.remove("deactive"),a.classList.add("active"));
virtualclass.gObj.audMouseDown=!0;virtualclass.vutil.beforeSend({sad:!0,cf:"sad"})},studentNotSpeak:function(a){virtualclass.gObj.hasOwnProperty("audMouseDown")&&virtualclass.gObj.audMouseDown&&("undefined"!=typeof a&&(document.getElementById(a.id+"Button"),a.classList.remove("active"),a.classList.add("deactive")),a=document.getElementById("speakerPressOnce"),a.setAttribute("data-audio-playing","false"),a.className="audioTool deactive",virtualclass.gObj.audMouseDown=!1,virtualclass.gObj.video.audio.setAudioStatus("stop"),
virtualclass.vutil.beforeSend({sad:!1,cf:"sad"},null,!0))},ab2str:function(a){return String.fromCharCode.apply(null,new Int8Array(a))},str2ab:function(a){var b=new ArrayBuffer(a.length);b=new Int8Array(b);for(var c=0,f=a.length;c<f;c++)b[c]=a.charCodeAt(c);return b},recorderProcess:function(a){(new Date).getTime();if(!repMode&&(this.recordAudio||(this.recordingLength+=this.bufferSize),virtualclass.gObj.audMouseDown&&1==io.sock.readyState)){a=this.resampler.resampler(a);a=c(a);var b=this.audioInLocalStorage(a);
this.silenceDetection(b,a)}},recorderProcessFallback:function(a){(new Date).getTime();if(!repMode&&(this.recordAudio||(this.recordingLength+=this.bufferSize),virtualclass.gObj.audMouseDown&&1==io.sock.readyState)){a=a.inputBuffer.getChannelData(0);a=this.resampler.resampler(a);a=c(a);var b=this.audioInLocalStorage(a);this.silenceDetection(b,a)}},audioInLocalStorage:function(a){return G711.encode(a,{alaw:"alaw"==this.encMode?!0:!1})},testInit:function(a){var b=document.getElementById(a);b.classList.add("audioIsTesting");
this.studentNotSpeak();virtualclass.gObj.audioForTest=[];this.storeAudio=!0;var c=this;c.otherSound=!0;c.hasOwnProperty("testAudio")&&clearTimeout(c.testAudio);c.testAudio=setTimeout(function(){c.playRecordedAudio(virtualclass.gObj.audioForTest,virtualclass.gObj.uid,!0)},5E3);setTimeout(function(){console.log("testing");b.classList.remove("audioIsTesting");c.otherSound=!1},11E3)},audioForTesting:function(a){a=G711.encode(a,{alaw:"alaw"==this.encMode?!0:!1});virtualclass.gObj.audioForTest.push(a);
virtualclass.gObj[virtualclass.gObj.uid]=!1},playRecordedAudio:function(a,b,c){this.myaudioNodes=[];for(var f=0,g=0;g<a.length;g++){var d=a[g];this.myaudioNodes.push(d);f+=d.length}a=this.mergeBuffers(this.myaudioNodes,f);"undefined"!=typeof c?virtualclass.gObj.video.audio.play(a,b,c):virtualclass.gObj.video.audio.play(a,b)},play:function(a,b){this.hasOwnProperty("Html5Audio")||this.Html5Audio||(this.Html5Audio={audioContext:new (d.AudioContext||d.webkitAudioContext)});"object"!=typeof n[a]?cthis.audio.Html5Audio.audioContext.audioWorklet.addModule(whiteboardPath+
"worker/receiver-audio-processor.js").then(function(){n[a]=new AudioWorkletNode(cthis.audio.Html5Audio.audioContext,"receiver-audio-processor");n[a].connect(cthis.audio.Html5Audio.audioContext.destination)}):n[a].port.postMessage({audio:b})},playWithFallback:function(a){this.hasOwnProperty("Html5Audio")||this.Html5Audio||(this.Html5Audio={audioContext:new (d.AudioContext||d.webkitAudioContext)});var b=this;"object"!=typeof n[a]&&(console.log("script processor node is created"),n[a]=this.Html5Audio.audioContext.createScriptProcessor(16384,
1,1),A[a]=0,n[a].onaudioprocess=function(c){c=c.outputBuffer.getChannelData(0);var f=b.getAudioChunks(a);if("undefined"!=typeof f){for(i=0;i<f.length;i++)c[i]=f[i];A[a]=f[16383]}else for(i=0;i<c.length;i++)c[i]=A[a]},n[a].connect(this.Html5Audio.audioContext.destination))},queueWithFallback:function(a,b){this.hasOwnProperty("audioToBePlay")||(this.audioToBePlay={});this.hasOwnProperty("aChunksPlay")||(this.aChunksPlay={});this.audioToBePlay.hasOwnProperty(b)||(this.audioToBePlay[b]=[]);a=G711.decode(a,
{alaw:"alaw"==this.encMode?!0:!1,floating_point:!0,Eight:!0});"object"!=typeof this.resamplerdecode&&(this.resamplerdecode={});"object"!=typeof this.resamplerdecode[b]&&("object"!=typeof this.Html5Audio&&(this.Html5Audio={audioContext:new (d.AudioContext||d.webkitAudioContext)}),"object"!=typeof this.resamplerdecode[b]&&(this.resamplerdecode[b]=new Resampler(8E3,this.Html5Audio.audioContext.sampleRate,1,32768)));a=this.resamplerdecode[b].resampler(a);"undefined"==typeof m[b]&&(m[b]=[]);for(var c=
0;c<a.length;c++)m[b].push(a[c]);for("undefined"==typeof r[b]&&(r[b]=0);16384<=m[b].length;)a=m[b].splice(0,16384),this.audioToBePlay[b].push(new Float32Array(a)),r[b]++},queue:function(a,b){a=G711.decode(a,{alaw:"alaw"==this.encMode?!0:!1,floating_point:!0,Eight:!0});"object"!=typeof this.resamplerdecode&&(this.resamplerdecode={});"object"!=typeof this.resamplerdecode[b]&&("object"!=typeof this.Html5Audio&&(this.Html5Audio={audioContext:new (d.AudioContext||d.webkitAudioContext)}),"object"!=typeof this.resamplerdecode[b]&&
(this.resamplerdecode[b]=new Resampler(8E3,this.Html5Audio.audioContext.sampleRate,1,32768)));return a=this.resamplerdecode[b].resampler(a)},getAudioChunks:function(a){console.log("Audo queue "+Math.round(this.audioToBePlay[a].length/3)+" seconds");if(null!=this.audioToBePlay){if(9<=this.audioToBePlay[a].length){for(;3<=this.audioToBePlay[a].length;)virtualclass.gObj.video.audio.audioToBePlay[a].shift();this.aChunksPlay[a]=!0;return virtualclass.gObj.video.audio.audioToBePlay[a].shift()}if(2<=this.audioToBePlay[a].length||
0<this.audioToBePlay[a].length&&1==this.aChunksPlay[a])return this.aChunksPlay[a]=!0,virtualclass.gObj.video.audio.audioToBePlay[a].shift();this.aChunksPlay[a]=!1}},replay:function(a,b){repMode=!0;if(0<this.audioNodes.length){var c=this.mergeBuffers(this.audioNodes);a=this.Html5Audio.audioContext.currentTime+a;var f=this.Html5Audio.audioContext.createBuffer(1,c.length,7800);f.getChannelData(0).set(c);c=this.Html5Audio.audioContext.createBufferSource();c.buffer=f;c.connect(this.Html5Audio.audioContext.destination);
c.start(a,b)}},mergeBuffers:function(a,b){b=new Float32Array(b);for(var c=0,f=a.length,g=0;g<f;g++){var d=a[g];b.set(d,c);c+=d.length}return b},assignFromLocal:function(a,b){this.init();for(var c=0;c<a.length;c++){var f=LZString.decompressFromBase64(a[c]);f=this.str2ab(f);samples=G711.decode(f,{alaw:"alaw"==this.encMode?!0:!1,floating_point:!0,Eight:!0});this.audioNodes.push(new Float32Array(samples));this.recordingLength+=16384}"undefined"!=typeof b&&b()},_manuPulateStream:function(){var a=virtualclass.gObj.video;
setTimeout(function(){a.detectAudioWorklet()?a.audio.manuPulateStream():a.audio.manuPulateStreamWithFallback()},1E3)},manuPulateStream:function(){var a=cthis.stream;"undefined"!=typeof audioNode&&audioNode.disconnect();cthis.audio.Html5Audio.audioContext.audioWorklet.addModule(whiteboardPath+"worker/audio-processor.js").then(function(){var b=cthis.audio.Html5Audio.audioContext.createMediaStreamSource(a);filter=cthis.audio.Html5Audio.audioContext.createBiquadFilter();filter.type="lowpass";filter.frequency.value=
2E3;b.connect(filter);audioNode=new AudioWorkletNode(cthis.audio.Html5Audio.audioContext,"audio-processor");filter.connect(audioNode);audioNode.connect(cthis.audio.Html5Audio.audioContext.destination);audioNode.port.onmessage=function(a){cthis.audio.recorderProcess(a.data.audio)}})},manuPulateStreamWithFallback:function(){var a=cthis.audio.Html5Audio.audioContext.createMediaStreamSource(cthis.stream);cthis.audio.bufferSize=16384;grec=cthis.audio.Html5Audio.audioContext.createScriptProcessor(cthis.audio.bufferSize,
1,1);grec.onaudioprocess=cthis.audio.recorderProcessFallback.bind(cthis.audio);filter=cthis.audio.Html5Audio.audioContext.createBiquadFilter();filter.type="lowpass";filter.frequency.value=2E3;a.connect(filter);filter.connect(grec);grec.connect(cthis.audio.Html5Audio.audioContext.destination)},updateInfo:function(){this.audioStreamArr=[];repMode=this.recordAudio=!1},receivedAudioProcess:function(a){if(!virtualclass.gObj.hasOwnProperty("iosIpadbAudTrue")||0!=virtualclass.gObj.iosIpadbAudTrue){a=this.extractData(a);
var b=a[0];if("undefined"==typeof c)var c={};c.hasOwnProperty(b)||(c[b]={},c[b].ad=!0,c=virtualclass.user.control.updateUser(b,"ad",!0),virtualclass.user.control.audioSign(c,"create"));virtualclass.gObj.video.audio.queueWithFallback(a[1],b);virtualclass.gObj.video.audio.playWithFallback(b)}},extractData:function(a){a=new Int8Array(a);return[virtualclass.vutil.numValidateFour(a[1],a[2],a[3],a[4]),a.subarray(5,a.length)]},removeAudioFromLocalStorage:function(){console.log("Remove audio from local storage");
localStorage.removeItem("audEnable")}},video:{width:75,height:56,tempVid:"",tempVidCont:"",myVideo:"",remoteVid:"",remoteVidCont:"",maxHeight:250,init:function(){this.videoCont=document.getElementById("allVideosCont");null!=this.videoCont&&(this.videoCont.style.maxHeight=this.maxHeight+"px")},calcDimension:function(){this.myVideo.width=this.width;this.myVideo.height=this.height},removeUser:function(a){a=document.getElementById("user"+a);null!=a&&a.parentNode.removeChild(a)},createElement:function(a){var b=
document.createElement("div");b.className="videoWrapper";var c=document.createElement("div");c.className="videoSubWrapper";c.id="user"+a.id;b.appendChild(c);vidId=a.id;var f=document.createElement("canvas");f.id="video"+vidId;f.className="userVideos";f.width=this.width;f.height=this.height;f.muted="muted";c.appendChild(f);virtualclass.gObj.video.util.imageReplaceWithVideo(a.id,b)},updateHightInSideBar:function(a){var b=document.getElementById("widgetRightSide").offsetHeight;document.getElementById("chatContainer").style.height=
b-a+"px"},sendInBinary:function(a){var b={name:virtualclass.gObj.uName,id:virtualclass.gObj.uid};io.webSocketConnected()&&(virtualclass.vutil.beforeSend({videoByImage:b,cf:"videoByImage"},null,!0),ioAdapter.sendBinary(a))},send:function(){function a(){b.tempVidCont.clearRect(0,0,b.tempVid.width,b.tempVid.height);b.tempVidCont.drawImage(b.myVideo,0,0,b.width,b.height);roles.hasControls();if(virtualclass.system.webpSupport){var g=b.tempVid.toDataURL("image/webp",.6);var d=1}else g=b.tempVid.toDataURL("image/jpeg",
.3),d=0;g=virtualclass.videoHost.convertDataURIToBinary(g);if(!virtualclass.videoHost.gObj.stdStopSmallVid&&!roles.hasControls()||roles.hasControls()&&virtualclass.videoHost.gObj.videoSwitch){var h=virtualclass.gObj.uid.toString();for(var n=h.length;8>n;n++)h="0"+h;h=h.match(/[\S]{1,2}/g)||[];d=new Uint8ClampedArray([11,h[0],h[1],h[2],h[3],d]);h=new Uint8ClampedArray(g.length+d.length);h.set(d);h.set(g,d.length);f.sendInBinary(h)}clearInterval(virtualclass.gObj.video.smallVid);g=randomTime+2500*virtualclass.connectedUsers.length;
if(c!=virtualclass.connectedUsers.length){c=virtualclass.connectedUsers.length;d=-1;for(h=0;h<virtualclass.connectedUsers.length;h++)virtualclass.connectedUsers[0].userid==virtualclass.gObj.uid&&(d=h);h=g/c;0>d&&(d=0);virtualclass.gObj.video.smallVid=setInterval(a,g+d*h)}else virtualclass.gObj.video.smallVid=setInterval(a,g)}virtualclass.gObj.video.hasOwnProperty("smallVid")&&clearInterval(virtualclass.gObj.video.smallVid);var b=this;randomTime=Math.floor(5001*Math.random()+3E3);var c=-1,f=this;virtualclass.gObj.video.smallVid=
setInterval(a,randomTime)},startToStream:function(){cthis.video.calcDimension();cthis.video.send()},playWithoutSlice:function(a,b,c){this.remoteVid=document.getElementById("video"+a);null!=this.remoteVid&&(this.remoteVidCont=this.remoteVid.getContext("2d"),this.remoteVidCont.putImageData(imgData,0,0))},drawReceivedImage:function(a,b,c,f){this.remoteVid=document.getElementById("video"+f);if(null!=this.remoteVid)if(this.remoteVidCont=this.remoteVid.getContext("2d"),virtualclass.system.webpSupport||
"jpeg"==b){var g=new Image,d=this;g.onload=function(){d.remoteVidCont.drawImage(g,c.x,c.y)};g.src=a}else loadfile(a,this.remoteVid,this.videoPartCont)},justForDemo:function(){var a=0,b=document.getElementById("allVideosCont");b.style.maxHeight="250px";setInterval(function(){if(20>=++a){b=document.getElementById("allVideosCont");var c=document.createElement("div");c.className="videoWrapper";var f=document.createElement("div");f.className="videoSubWrapper";f.setAttribute("data-uname","suman"+a);c.appendChild(f);
var g=document.createElement("video");g.className="userVideo";g.muted="muted";g.src="http://html5demos.com/assets/dizzy.mp4";f.appendChild(g);b.appendChild(c);250<=b.offsetHeight&&"undefined"!=b.style.overflowY&&"scroll"!=b.style.overflowY&&(b.style.overflowY="scroll",document.getElementById(virtualclass.gObj.chat.mainChatBoxId).style.borderTop="3px solid #bbb")}},200)},createVideoElement:function(){var a=document.createElement("div");a.className="videoWrapper";var b=document.createElement("div");
b.className="videoSubWrapper";a.appendChild(b);var c=document.createElement("video");c.id="video"+virtualclass.gObj.uid;c.autoplay=!0;b.appendChild(c);return a},insertTempVideo:function(a){var b=document.createElement("canvas");b.id="tempVideo";a.parentNode.insertBefore(b,a)},tempVideoInit:function(){cthis.video.tempVid=document.getElementById("tempVideo");cthis.video.tempVid.width=cthis.video.width;cthis.video.tempVid.height=cthis.video.height;cthis.video.tempVidCont=cthis.video.tempVid.getContext("2d")},
process:function(a){var b=new Uint8ClampedArray(a);a=virtualclass.vutil.numValidateFour(b[1],b[2],b[3],b[4]);var c=b.subarray(6,b.length);1==b[5]?(b="data:image/webp;base64,"+btoa(virtualclass.videoHost.Uint8ToString(c)),c="webp"):(b="data:image/jpeg;base64,"+btoa(virtualclass.videoHost.Uint8ToString(c)),c="jpeg");virtualclass.gObj.video.video.drawReceivedImage(b,c,{x:0,y:0},a)}},init:function(a){console.log("Video second, normal video");cthis=this;virtualclass.gObj.oneExecuted=!0;a=virtualclass.system.mediaDevices.hasWebcam?
!0:!1;virtualclass.gObj.meetingMode&&a&&(a={width:{max:288},height:{max:162},frameRate:{max:6}});var b={video:a,audio:virtualclass.system.mediaDevices.hasMicrophone};cthis.video.init();var c=this;virtualclass.user.control.audioDisable();virtualclass.user.control.videoDisable();virtualclass.vutil.isPlayMode()||(virtualclass.adpt=new virtualclass.adapter,virtualclass.adpt.init(navigator).mediaDevices.getUserMedia(b).then(function(a){c.handleUserMedia(a);virtualclass.gObj.meetingMode&&virtualclass.multiVideo.init()}).catch(function(a){c.handleUserMediaError(a)}));
virtualclass.system.wbRtc.peerCon&&"undefined"==typeof localStorage.wbrtcMsg&&(virtualclass.view.multiMediaMsg("WebRtc"),localStorage.wbrtcMsg=!0);0==a&&(virtualclass.user.control.videoDisable(),virtualclass.vutil.addClass("virtualclassCont","nowebcam"))},handleUserMedia:function(a){localStorage.removeItem("dvid");document.getElementById("audioWidget");var b=localStorage.getItem("audEnable");if(virtualclass.system.mediaDevices.hasMicrophone)if(virtualclass.gObj.video.audioVisual.readyForVisual(a),
null!=b)if(b=JSON.parse(b),"false"==b.ac||0==b.ac)virtualclass.gObj.audioEnable=!1,virtualclass.user.control.audioDisable(!0);else{if("true"==b.ac||1==b.ac)virtualclass.gObj.audioEnable=!0,virtualclass.user.control.audioWidgetEnable(!0)}else"undefined"!=typeof a&&virtualclass.user.control.audioWidgetEnable(!0);else virtualclass.user.control.audioDisable();b=a.getVideoTracks()[0];"undefined"!=typeof b?b.onended=function(){virtualclass.system.mediaDevices.webcamErr.push("webcambusy")}:virtualclass.system.mediaDevices.webcamErr.push("nopermission");
cthis.video.tempStream=a;cthis.audio.init();b=document.getElementById("ml"+virtualclass.gObj.uid);null!=b&&null!=b.getElementsByTagName("video")&&cthis._handleUserMedia(virtualclass.gObj.uid);roles.hasAdmin()&&virtualclass.videoHost.isDomReady(function(){virtualclass.videoHost.renderSelfVideo(a)});virtualclass.system.mediaDevices.hasMicrophone&&(cthis.stream=cthis.video.tempStream,cthis.audio._manuPulateStream());virtualclass.user.control.videoEnable()},addUserRole:function(a,b){a.dataset.role=b;
if("undefined"!=typeof b){var c="s"==b?"student":"teacher";a.classList.add(c)}else a.classList.add("student");"t"==virtualclass.gObj.uRole&&"student"==c&&document.getElementById("virtualclassCont").classList.remove("student")},_handleUserMedia:function(a){document.getElementById(a);a=cthis.video.tempStream;if("undefined"!=typeof a&&virtualclass.system.mediaDevices.hasWebcam){var b=cthis.video.createVideoElement();virtualclass.gObj.video.util.imageReplaceWithVideo(virtualclass.gObj.uid,b);cthis.video.insertTempVideo(b);
cthis.video.tempVideoInit();cthis.video.myVideo=document.getElementById("video"+virtualclass.gObj.uid);virtualclass.adpt.attachMediaStream(cthis.video.myVideo,a);cthis.video.myVideo.muted=!0;cthis.stream=cthis.video.tempStream;cthis.video.myVideo.onloadedmetadata=function(){cthis.video.startToStream()}}userMedia=!0},updateVideoContHeight:function(){console.log("Updating User");var a=document.getElementById("virtualclassCont");virtualclass.vutil.getElementOffset(a);a=virtualclass.chat.boxHeight;var b=
document.getElementById("chat_div");b.scrollHeight>=a+1&&(b.style.overflowY="scroll");b.style.maxHeight=a+"px";console.log("Chat height "+b.offsetHeight);console.log("Max height "+b.style.maxHeight);virtualclass.isPlayMode&&(b.style.maxHeight=a+64+"px")},close:function(){virtualclass.gObj.video.hasOwnProperty("smallVid")&&clearInterval(virtualclass.gObj.video.smallVid)},dispAllVideo:function(a){setTimeout(function(){var b=document.getElementById(a);if(null!=b){b=b.getElementsByTagName("video");for(var c=
0;c<b.length;c++)b[c].play()}},1040)},existVideoContainer:function(a){for(var b=document.getElementsByClassName("userVideos"),c=0;c<b.length;c++)if(b[c].id=="video"+a.id)return!0;return!1},handleUserMediaError:function(a){var b="object"==typeof a?virtualclass.lang.getString(a.name):virtualclass.lang.getString(a);null==b?virtualclass.view.createErrorMsg(a,"errorContainer","chatWidget"):virtualclass.view.createErrorMsg(b,"errorContainer","chatWidget");virtualclass.user.control.mediaWidgetDisable("vd");
virtualclass.view.disappearBox("WebRtc");localStorage.setItem("dvid",!0);console.log("navigator.getUserMedia error: ",a);switch(a.name){case "NotFoundError":case "DevicesNotFoundError":a="nowebcam";break;case "SourceUnavailableError":a="webcambusy";break;case "PermissionDeniedError":case "SecurityError":a="nopermission";virtualclass.gObj.disableCamByUser=!0;break;case "NotAllowedError":a="nopermission";virtualclass.gObj.disableCamByUser=!0;break;default:a="rejected"}virtualclass.system.mediaDevices.webcamErr.push(a)},
detectAudioWorklet:function(){var a=new OfflineAudioContext(1,1,44100);return!(!a.audioWorklet||"function"!==typeof a.audioWorklet.addModule)}}}})(window);(function(d){d.sharePt=function(){var c=!1;return{pptUrl:"",state:{},urlValue:"",localStoragFlag:!1,eventsObj:[],autoSlideTime:0,viewFlag:0,controlFlag:0,autoSlideFlag:0,autoSlideResumed:0,studentPpt:0,startFromFlag:0,startFrom:0,currId:"",order:[],init:function(b,a){this.pages={};this.order=[];this.autoSlideResumed=this.autoSlideTime=this.autoSlideFlag=0;"undefined"!=typeof virtualclass.previous&&"undefined"!=typeof a&&"byclick"==a&&roles.hasControls()&&virtualclass.vutil.beforeSend({ppt:!0,init:"makeAppReady",
cf:"ppt"});b=document.getElementById("virtualclassSharePresentation");null!=b&&b.parentNode.removeChild(b);this.UI.container();b=document.getElementById("pptMessageLayout");roles.hasControls()?(a=document.getElementById("urlcontainer"),null!=b&&(b.style.display="none"),a&&(a.style.display="block")):roles.hasView()&&(a=document.getElementById("urlcontainer"),this.UI.messageDisplay(),b&&(b.style.display="block"),a&&(a.style.display="none"));virtualclass.vutil.requestOrder("presentation",function(a){console.log(a);
virtualclass.vutil.isResponseAvailable(a)?virtualclass.sharePt.order=a:console.log("Order response is not available")});this.findInStorage();c||(this.getPptList(),c=!0);virtualclass.sharePt.attachMessageEvent("message",virtualclass.sharePt.pptMessageEventHandler)},createPageModule:function(){virtualclass.sharePt.ppts&&virtualclass.sharePt.ppts.length&&virtualclass.sharePt.ppts.forEach(function(b,a){virtualclass.sharePt.pages[b.fileuuid]=new virtualclass.page("pptListContainer","ppt","virtualclassSharePresentation",
"sharePt",b.status)})},findInStorage:function(){var b=localStorage.getItem("prevApp");console.log("test pApp"+typeof b);console.log(b);null!=b&&(b=JSON.parse(b),"SharePresentation"==b.name&&(b=b.metaData,null!=b&&b.init&&(this.localStoragFlag=!0,this.pptUrl=JSON.parse(localStorage.getItem("pptUrl")),null!=b.startFrom&&(virtualclass.sharePt.stateLocalStorage=b.startFrom),null!=b.currId&&(virtualclass.sharePt.currId=b.currId)),this.localStoragFlag&&this.fromLocalStorage(virtualclass.sharePt.state)));
virtualclass.previrtualclass="virtualclass"+virtualclass.currApp},fromLocalStorage:function(b){null==document.getElementById("iframecontainer")&&this.UI.createIframe();document.getElementById("iframecontainer").style.display="block";b=document.getElementById("pptiframe");var a=0>this.pptUrl.search("postMessage")?this.pptUrl+"?postMessage=true&postMessageEvents=true":this.pptUrl;b.setAttribute("src",a);this.setAutoSlideConfig();b=document.getElementById("pptMessageLayout");null!=b&&(console.log("message block"),
b.style.display="none");b=document.getElementById(this.UI.id);b.classList.contains("pptSharing")||b.classList.add("pptSharing")},_rearrange:function(b){this.order=b;this.reArrangeElements(b);virtualclass.vutil.sendOrder("presentation",b)},sendOrder:function(b){virtualclass.vutil.xhrSendWithForm({content_order:b.toString(),content_order_type:"3",live_class_id:virtualclass.gObj.congCourse},"congrea_page_order",function(a){})},reArrangeElements:function(b){var a=document.getElementById("listppt"),c=
document.createElement("div");c.id="listppt";c.className="ppts";for(var g=!1,d=0;d<virtualclass.sharePt.activeppts.length;d++)-1>=b.indexOf(virtualclass.sharePt.activeppts[d].fileuuid)&&(b.push(virtualclass.sharePt.activeppts[d].fileuuid),g=!0);for(d=0;d<b.length;d++){var m=document.getElementById("linkppt"+b[d]);m&&c.appendChild(m)}a.parentNode.replaceChild(c,a);g&&(virtualclass.sharePt.order=b,virtualclass.vutil.sendOrder("presentation",virtualclass.sharePt.order))},_delete:function(b){var a=this;
virtualclass.xhrn.sendData({uuid:b,action:"delete",page:0},virtualclass.api.UpdateDocumentStatus,function(c){a.afterDeletePtCallback(c,b)})},afterDeletePtCallback:function(b,a){"ERROR"!=b&&(b=document.getElementById("linkppt"+a))&&(b.parentNode.removeChild(b),virtualclass.sharePt.ppts.length&&(virtualclass.sharePt.ppts.forEach(function(b,c){b.fileuuid==a&&(c=virtualclass.sharePt.ppts.indexOf(b),0<=c&&(virtualclass.sharePt.ppts.splice(c,1),console.log(virtualclass.sharePt.ppts)))}),b=virtualclass.sharePt.order.indexOf(a),
0<=b&&(virtualclass.sharePt.order.splice(b,1),console.log(virtualclass.sharePt.order),virtualclass.vutil.sendOrder("presentation",virtualclass.sharePt.order)),(b=document.querySelector(".congrea #pptiframe"))&&b.getAttribute("src")?virtualclass.vutil.showFinishBtn():virtualclass.vutil.removeFinishBtn()),virtualclass.sharePt.currId==a&&(b=document.querySelector("#pptiframe")))&&(b.removeAttribute("src"),ioAdapter.mustSend({pptMsg:"deletePrt",cf:"ppt",currId:virtualclass.sharePt.currId}),virtualclass.sharePt.currId=
null,virtualclass.sharePt.pptUrl=null,virtualclass.vutil.removeFinishBtn())},_delete1:function(b){var a=this;virtualclass.xhrn.sendData({uuid:b,action:"delete",page:0},virtualclass.api.UpdateDocumentStatus,function(c){a.afterDeleteCallback(c,b)})},pptMessageEventHandler:function(b){if("SharePresentation"==virtualclass.currApp){var a=document.getElementById("pptiframe"),c=b.data;c="string"==typeof c?JSON.parse(b.data):b.data;"undefined"!=typeof c&&(c.hasOwnProperty("namespace")&&"reveal"==c.namespace&&
(virtualclass.sharePt.state=c.state),"ready"==c.eventName&&(virtualclass.sharePt.localStoragFlag&&!virtualclass.sharePt.startFromFlag?(b=virtualclass.sharePt.stateLocalStorage,a.contentWindow.postMessage(JSON.stringify({method:"slide",args:[b.indexh,b.indexv,b.indexf]}),"*"),virtualclass.sharePt.localStoragFlag=0):virtualclass.sharePt.startFromFlag&&a.contentWindow.postMessage(JSON.stringify({method:"slide",args:virtualclass.sharePt.startFrom}),"*"),setTimeout(function(){null!=a&&null!=a.contentWindow&&
a.contentWindow.postMessage(JSON.stringify({method:"toggleAutoSlide"}),"*")},1500)),roles.hasView()?"ready"==c.eventName&&(setTimeout(function(){virtualclass.sharePt.removeControls()},100),virtualclass.sharePt.studentPpt&&(virtualclass.sharePt.setSlideState(virtualclass.sharePt.studentPpt),virtualclass.sharePt.studentPpt=0)):roles.hasControls()&&(console.log(c.eventName),"undefined"!=typeof c.eventName&&(virtualclass.sharePt[c.eventName].call(virtualclass.sharePt,c),virtualclass.sharePt.state=c.state)))}else null!=
a&&a.removeAttribute("src")},setAutoSlideConfig:function(){localStorage.getItem("autoSlideTime")&&(virtualclass.sharePt.autoSlideTime=JSON.parse(localStorage.getItem("autoSlideTime")),virtualclass.sharePt.autoSlideFlag=JSON.parse(localStorage.getItem("autoSlideFlag")))},onmessage:function(b){b.hasOwnProperty("autoSlide")&&(this.autoSlideTime=b.autoSlide);"undefined"!=typeof virtualclass.sharePt&&(virtualclass.system.setAppDimension(virtualclass.currApp),this.onPptMsgReceive(b),b=document.getElementById(virtualclass.sharePt.UI.id),
b.classList.contains("pptSharing")||b.classList.add("pptSharing"))},ready:function(b){console.log("teacher ready for ppt ");ioAdapter.mustSend({pptMsg:b,cf:"ppt",cfpt:"setPEvent"})},slidechanged:function(b){this.autoSlideFlag&&this.autoSlideResumed&&!this.autoSlideTime&&this.calculateAutoSlideTime(b);ioAdapter.mustSend({pptMsg:b,cf:"ppt",autoSlide:this.autoSlideTime,cfpt:"setPEvent"})},calculateAutoSlideTime:function(b){this.eventsObj.push({name:b.eventName,time:Date.now()});2<=this.eventsObj.length&&
("slidechanged"==this.eventsObj[0].name&&"slidechanged"==this.eventsObj[1].name?(this.autoSlideTime=this.eventsObj[1].time-this.eventsObj[0].time,console.log("auto slide time withoutpause"+this.autoSlideTime)):"autoslideresumed"==this.eventsObj[0].name&&"slidechanged"==this.eventsObj[1].name&&(this.autoSlideTime=this.eventsObj[1].time-this.eventsObj[0].time,console.log("withpause"+this.autoSlideTime)),console.log(this.eventsObj),console.log(this.autoSlideTime))},autoslidepaused:function(b){this.autoSlideFlag=
1;this.autoSlideResumed=0;console.log(this.pause);ioAdapter.mustSend({pptMsg:b,cf:"ppt",cfpt:"setPEvent"})},autoslideresumed:function(b){this.autoSlideResumed=this.autoSlideFlag=1;this.eventsObj=[];this.eventsObj.push({name:b.eventName,time:Date.now()});ioAdapter.mustSend({pptMsg:b,cf:"ppt",cfpt:"setPEvent"})},fragmentshown:function(b){ioAdapter.mustSend({pptMsg:b,cf:"ppt",cfpt:"setPEvent"})},fragmenthidden:function(b){ioAdapter.mustSend({pptMsg:b,cf:"ppt",cfpt:"setPEvent"})},overviewshown:function(b){ioAdapter.mustSend({pptMsg:b,
cf:"ppt",cfpt:"setPEvent"})},overviewhidden:function(b){ioAdapter.mustSend({pptMsg:b,cf:"ppt",cfpt:"setPEvent"})},paused:function(b){ioAdapter.mustSend({pptMsg:b,cf:"ppt",cfpt:"setPEvent"})},resumed:function(b){ioAdapter.mustSend({pptMsg:b,cf:"ppt",cfpt:"setPEvent"})},removeControls:function(){setTimeout(function(){document.getElementById("pptiframe").contentWindow.postMessage(JSON.stringify({method:"configure",args:[{controls:!1,autoSlide:0,keyboard:!1,progress:!1,touch:!1}]}),"*")},100)},cfpt:{displayFrame:function(){this.displayFrame()},
setUrl:function(b){virtualclass.sharePt.localStoragFlag=0;virtualclass.sharePt.stateLocalStorage={};virtualclass.sharePt.state={indexh:0,indexv:0,indexf:0};this.setSlideUrl(b);var a=document.getElementById("pptiframe");a.onload=function(){roles.hasView()&&null!=a.contentWindow&&"undefined"!=typeof b.pptMsg.state&&a.contentWindow.postMessage(JSON.stringify({method:"setState",args:[b.pptMsg.state]}),"*")}},setPEvent:function(b){null!=document.getElementById("pptiframe")&&virtualclass.sharePt.setSlideState(b.pptMsg);
this.state=b.pptMsg.state}},onPptMsgReceive:function(b){if("undefined"!=typeof b.ppt&&"undefined"!=typeof b.ppt.startFrom){virtualclass.sharePt.startFromFlag=1;var a=document.getElementById("pptiframe");null!=a&&(0>b.ppt.init.search("postMessage")?a.setAttribute("src",b.ppt.init+"?postMessage=true&postMessageEvents=true"):a.setAttribute("src",b.ppt.init),virtualclass.sharePt.startFrom=[b.ppt.startFrom.indexh,b.ppt.startFrom.indexv,b.ppt.startFrom.indexf])}if("undefined"!=typeof b.pptMsg){if("deletePrt"==
b.pptMsg){var c=document.querySelector("#pptiframe");c&&(c.removeAttribute("src"),virtualclass.sharePt.currId=null,virtualclass.sharePt.pptUrl=null,c=document.querySelector("#virtualclassCont.congrea #virtualclassSharePresentation #pptMessageLayout"))&&(c.style.display="block")}else{a=document.getElementById("pptiframe");var g=document.getElementById("pptMessageLayout");null!=a&&(a.onload=function(){roles.hasView()&&null!=a.contentWindow&&"undefined"!=typeof b.pptMsg.state&&a.contentWindow.postMessage(JSON.stringify({method:"setState",
args:[b.pptMsg.state]}),"*")})}null!=g&&(g.style.display="none");b.hasOwnProperty("cfpt")&&"undefined"!=typeof b.cfpt&&"undefined"!=typeof virtualclass.sharePt.cfpt[b.cfpt]&&virtualclass.sharePt.cfpt[b.cfpt].call(virtualclass.sharePt,b)}},displayFrame:function(){virtualclass.system.setAppDimension(virtualclass.currApp);var b=document.getElementById(virtualclass.sharePt.UI.id);b.classList.contains("pptSharing")||b.classList.add("pptSharing")},setSlideUrl:function(b){virtualclass.sharePt.studentPpt=
0;console.log("PPT:- invoke setSlideUrl");this.autoSlideTime=this.autoSlideFlag=this.viewFlag=0;var a=document.getElementById("pptiframe");null!=a&&a.parentNode.removeChild(a);console.log("create iframe from setslide url");this.UI.createIframe();document.getElementById("iframecontainer").style.display="block";a=document.getElementById("pptiframe");a.setAttribute("src",0>b.pptMsg.search("postMessage")?b.pptMsg+"?postMessage=true&postMessageEvents=true":b.pptMsg);console.log("test url is set");this.pptUrl=
b.pptMsg;virtualclass.sharePt.localStoragFlag=0;virtualclass.sharePt.startFromFlag=0},setSlideState:function(b){var a=document.getElementById("pptiframe").contentWindow,c=[b.state.indexh,b.state.indexv,b.state.indexf],g=[b.state];switch(b.eventName){case "ready":a.postMessage(JSON.stringify({method:"setState",args:g}),"*");break;case "slidechanged":virtualclass.sharePt.studentPpt=b;console.log("test PPt:-  changed");a.postMessage(JSON.stringify({method:"slide",args:c}),"*");break;case "autoslidepaused":this.autoSlideFlag=
1;a.postMessage(JSON.stringify({method:"toggleAutoSlide"}),"*");break;case "autoslideresumed":this.autoSlideFlag=1;a.postMessage(JSON.stringify({method:"toggleAutoSlide"}),"*");break;case "fragmentshown":a.postMessage(JSON.stringify({method:"slide",args:c}),"*");break;case "fragmenthidden":a.postMessage(JSON.stringify({method:"slide",args:c}),"*");break;case "overviewshown":a.postMessage(JSON.stringify({method:"setState",args:g}),"*");break;case "overviewhidden":a.postMessage(JSON.stringify({method:"setState",
args:g}),"*"),a.postMessage(JSON.stringify({method:"slide",args:c}),"*");default:console.log("There is no event is occured")}},toProtocolRelativeUrl:function(){var b=virtualclass.sharePt.urlValue;return 0<=b.indexOf("http")?b.replace(/http:\/\/|https:\/\//,"//"):"//"+b},validUrl:function(){return virtualclass.sharePt.isUrlip(virtualclass.sharePt.urlValue)?virtualclass.sharePt.cleanupUrl(virtualclass.sharePt.urlValue):0<virtualclass.sharePt.urlValue.search("<iframe")?virtualclass.sharePt.extractUrl(virtualclass.sharePt.urlValue):
virtualclass.sharePt.validURLWithDomain(virtualclass.sharePt.urlValue)?virtualclass.sharePt.completeUrl(virtualclass.sharePt.cleanupUrl(virtualclass.sharePt.urlValue)):!1},initNewPpt:function(){virtualclass.sharePt.urlValue=document.getElementById("presentationurl").value;virtualclass.sharePt.urlValue=virtualclass.sharePt.toProtocolRelativeUrl();var b=virtualclass.sharePt.validUrl();b?(virtualclass.sharePt.savePptUrl(b),document.getElementById("presentationurl").value=""):alert("Please enter a valid URL")},
savePptUrl:function(b){var a=virtualclass.vutil.createHashString(b)+virtualclass.vutil.randomString(32).slice(1,-1),c={};c.uuid=a;c.URL=b;c.title=b;b=virtualclass.api.addURL;c.type="presentation";var g=this;virtualclass.xhrn.sendData(c,b,function(a){virtualclass.sharePt.hasOwnProperty("activeppts")&&(a=virtualclass.sharePt.activeppts.map(function(a){return a.fileuuid}),a.length!=virtualclass.sharePt.order.length&&(virtualclass.sharePt.order=a));virtualclass.sharePt.order.push(c.uuid);virtualclass.vutil.sendOrder("presentation",
virtualclass.sharePt.order);virtualclass.sharePt.getPptList();g.fetchAllData()})},fetchAllData:function(){virtualclass.serverData.fetchAllData(function(){virtualclass.sharePt.awsPresentationList(virtualclass.serverData.rawData.ppt)})},awsPresentationList:function(b){virtualclass.sharePt.ppts=[];virtualclass.sharePt.ppts=b;document.querySelector("#SharePresentationDashboard .dbContainer")&&(virtualclass.sharePt.createPageModule(),virtualclass.sharePt.showPpts(),virtualclass.vutil.requestOrder("presentation",
function(a){virtualclass.vutil.isResponseAvailable(a)?(virtualclass.sharePt.order=a,virtualclass.sharePt.order&&0<virtualclass.sharePt.order.length&&virtualclass.sharePt.reArrangeElements(virtualclass.sharePt.order)):console.log("Order response is not available")}))},afterPptSaved:function(b){var a=b.fileuuid;b.hasOwnProperty("disabled")?b.status=0:b.status=1;this.pages[a]=new virtualclass.page("pptListContainer","ppt","virtualclassSharePresentation","sharePt",b.status);this.pages[a].init(a,b.URL);
this.pptClickHandler(b);a=document.getElementById("linkppt"+b.fileuuid);var c=document.getElementById("pptTitle"+b.fileuuid),g=this.extractTitle(b.URL);c&&(c.innerHTML=g);c.setAttribute("data-toogle","tooltip");c.setAttribute("data-placement","bottom");c.setAttribute("title",b.URL);b.hasOwnProperty("disabled")?(this._disable(b.fileuuid),a&&a.classList.add("disable")):(this._enable(b.fileuuid),a&&a.classList.add("enable"));virtualclass.sharePt.currId==b.fileuuid&&a.classList.add("playing")},extractTitle:function(b){return-1<
b.indexOf("//")?b.split("/")[4]:b.split("/")[2]},pptClickHandler:function(b){var a=document.getElementById("mainpppt"+b.fileuuid);a&&a.addEventListener("click",function(){virtualclass.sharePt.playPptUrl(b.URL,b.fileuuid);virtualclass.dashBoard.close();virtualclass.sharePt.currId=b.fileuuid;virtualclass.sharePt.activePrs(b.fileuuid)})},activePrs:function(b){for(var a=document.querySelectorAll("#virtualclassCont.congrea .linkppt"),c=0;c<a.length;c++)a[c].classList.contains("playing")&&a[c].classList.remove("playing");
(b=document.querySelector("#virtualclassCont.congrea #linkppt"+b))&&!b.classList.contains("playing")&&b.classList.add("playing")},_disable:function(b){var a=document.getElementById("mainpppt"+b);a.style.opacity=.3;a.style.pointerEvents="none";a=document.querySelector("#linkppt"+b);a.classList.contains("enable")&&a.classList.remove("enable");a.classList.add("disable");virtualclass.sharePt.ppts&&virtualclass.sharePt.ppts.length&&virtualclass.sharePt.ppts.forEach(function(a,c){a.fileuuid==b&&(a.disabled=
0,a.status=0)})},_enable:function(b){var a=document.querySelector("#linkppt"+b);a.classList.contains("disable")&&a.classList.remove("diable");a.classList.add("enable");if(a=document.getElementById("mainpppt"+b))a.style.opacity=1,a.style.pointerEvents="auto",virtualclass.sharePt.ppts&&virtualclass.sharePt.ppts.length&&virtualclass.sharePt.ppts.forEach(function(a,c){a.fileuuid==b&&(delete a.disabled,a.status=1)})},getPptList:function(){virtualclass.gObj.fetchedData?virtualclass.sharePt.awsPresentationList(virtualclass.serverData.rawData.ppt):
this.fetchAllData()},showPpts:function(b){if(b=document.getElementById("listppt"))for(var a=0;a<b.childNodes.length-1;a++)b.childNodes[a].parentNode.removeChild(b.childNodes[a]);virtualclass.sharePt.ppts&&virtualclass.sharePt.ppts.length&&(virtualclass.sharePt.activeppts=[],virtualclass.sharePt.ppts.forEach(function(a,b){a.hasOwnProperty("deleted")||(virtualclass.sharePt.activeppts.push(a),b=document.querySelector("#linkppt"+a.fileuuid),null!=b&&b.classList.remove("noPpt"),virtualclass.sharePt.afterPptSaved(a))}),
virtualclass.vutil.sendOrder("presentation",virtualclass.sharePt.order));(b=document.querySelector(".congrea #pptiframe"))&&b.getAttribute("src")&&virtualclass.vutil.showFinishBtn();virtualclass.vutil.makeElementActive("#listvideo")},retrieveOrder:function(){var b=new FormData;b.append("live_class_id",virtualclass.gObj.congCourse);b.append("content_order_type","3");this.requestOrder(b)},requestOrder:function(b){virtualclass.vutil.requestOrder("presentation",function(a){console.log(a);virtualclass.vutil.isResponseAvailable(a)&&
(virtualclass.sharePt.order=a,0<virtualclass.sharePt.order.length&&virtualclass.sharePt.reArrangeElements(virtualclass.sharePt.order))})},playPptUrl:function(b){virtualclass.sharePt.autoSlideTime=0;virtualclass.sharePt.autoSlideFlag=0;virtualclass.sharePt.localStoragFlag=0;virtualclass.sharePt.startFromFlag=0;virtualclass.sharePt.eventsObj=[];virtualclass.sharePt.state={indexh:0,indexv:0,indexf:0};virtualclass.sharePt.stateLocalStorage={};localStorage.removeItem("autoSlideTime");localStorage.removeItem("autoSlideFlag");
null==document.getElementById("iframecontainer")&&(console.log("call of iframe creater from onclick event handler"),virtualclass.sharePt.UI.createIframe());var a=document.getElementById(virtualclass.sharePt.UI.id);a.classList.contains("pptSharing")||a.classList.add("pptSharing");virtualclass.sharePt.setPptUrl(b);virtualclass.system.setAppDimension()},cleanupUrl:function(b){var a=b.search("#");0<a&&(b=b.slice(0,a));return b},setPptUrl:function(b){console.log("test+set ppt url function");document.getElementById("iframecontainer").style.display=
"block";var a=document.getElementById("pptiframe");console.log("completeurl"+b);virtualclass.sharePt.pptUrl=b+"?postMessage=true&postMessageEvents=true";a.setAttribute("src",virtualclass.sharePt.pptUrl);ioAdapter.mustSend({pptMsg:"displayframe",cf:"ppt",user:"all",cfpt:"displayframe"});ioAdapter.mustSend({pptMsg:b,cf:"ppt",user:"all",cfpt:"setUrl"});a.style.display="visible";document.querySelector(".congrea  #dashboardContainer .modal-header button.enable")||virtualclass.vutil.showFinishBtn()},validURLWithDomain:function(b){return/((http|https)?:\/\/)?(slides.com)\/{1,255}\s*/.test(b)},
completeUrl:function(b){0<b.search("slides.com")&&0>b.search("embed")&&(b+="/embed");return b},extractUrl:function(b){if(0<b.search("src")){var a=b.match(/"(.*?)"/);if(0<a.length)return JSON.parse(a[0])}return b},isUrlip:function(b){b.slice(0,2);return/(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)/.test(b)},saveIntoLocalStorage:function(b){if(this.validURLWithDomain(b.metaData.init)||this.isUrlip(b.metaData.init))localStorage.setItem("prevApp",
JSON.stringify(b)),console.log("ppt_state",b.metaData.startFrom),localStorage.setItem("ppt_state",JSON.stringify(b.metaData.startFrom)),console.log("savinlocal"),localStorage.setItem("pptUrl",JSON.stringify(b.metaData.init)),localStorage.setItem("autoSlideTime",JSON.stringify(virtualclass.sharePt.autoSlideTime)),localStorage.setItem("autoSlideFlag",JSON.stringify(virtualclass.sharePt.autoSlideFlag))},initTeacherLayout:function(){var b=document.getElementById("pptiframe");if(null!=document.getElementById("pptiframe")){var a=
{controls:!0,keyboard:!0,progress:!0,touch:!0},c;virtualclass.sharePt.autoSlideTime&&virtualclass.sharePt.autoSlideFlag?c=virtualclass.sharePt.autoSlideTime:virtualclass.sharePt.autoSlideFlag&&(c=6E3);"undefined"!=typeof c&&1E3<c&&(a.autoSlide=c);b.contentWindow.postMessage(JSON.stringify({method:"configure",args:[a]}),"*");b.contentWindow.postMessage(JSON.stringify({method:"toggleAutoSlide"}),"*")}b=document.getElementById("pptMessageLayout");null!=b&&(b.style.display="none");document.getElementById("urlcontainer")&&
(document.getElementById("urlcontainer").style.display="block");virtualclass.sharePt.eventsObj=[]},initStudentLayout:function(){var b=document.getElementById("pptiframe");virtualclass.sharePt.eventsObj=[];virtualclass.sharePt.UI.messageDisplay();null!=document.getElementById("pptiframe")?(""!=b.src&&virtualclass.sharePt.hideElement("pptMessageLayout"),b.contentWindow.postMessage(JSON.stringify({method:"configure",args:[{controls:!1,autoSlide:0,autoSlideStoppable:!0,keyboard:!1,progress:!1,touch:!1}]}),
"*")):virtualclass.sharePt.displayElement("pptMessageLayout");virtualclass.sharePt.hideElement("urlcontainer")},hideElement:function(b){b=document.getElementById(b);null!=b&&(b.style.display="none")},displayElement:function(b){b=document.getElementById(b);null!=b&&(b.style.display="block")},attachEvent:function(b,a,c){document.getElementById(b);b=document.getElementById(b);null!=b&&b.addEventListener(a,c)},attachMessageEvent:function(b,a){d.addEventListener(b,a)},UI:{id:"virtualclassSharePresentation",
class:"virtualclass",container:function(){var b={control:roles.hasControls()?!0:!1},a=virtualclass.getTemplate("ppt","ppt");virtualclass.vutil.insertAppLayout(a(b))},createIframe:function(){var b=document.getElementById("iframecontainer");null!=b&&b.parentNode.removeChild(b);b=virtualclass.getTemplate("pptiframe","ppt");$("#virtualclassSharePresentation").append(b)},messageDisplay:function(){var b=document.getElementById("pptMessageLayout");b&&b.parentNode.removeChild(b);b=virtualclass.getTemplate("mszdisplay",
"ppt");$("#virtualclassSharePresentation").append(b())},removeIframe:function(){var b=document.getElementById("pptiframe");b&&b.parentNode.removeChild(b)}}}}})(window);(function(d){var c={requestPackets:function(b){1<b.length&&(virtualclass.wb[virtualclass.gObj.currWb].gObj.myArr=b);virtualclass.wb[virtualclass.gObj.currWb].sentReq=!0;return[0==virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId?0:virtualclass.wb[virtualclass.gObj.currWb].gObj.rcvdPackId,b[0].uid]},makeQueue:function(b){virtualclass.wb[virtualclass.gObj.currWb].gObj.queue[b.uid]=b},sendPackets:function(b,a){if(0==b.message.getMsPckt[0])var c=-1;else for(c=0;c<virtualclass.wb[virtualclass.gObj.currWb].gObj.myrepObj.length&&
b.message.getMsPckt[0]!=virtualclass.wb[virtualclass.gObj.currWb].gObj.myrepObj[c].uid;c++);for(c+=1;c<b.message.getMsPckt[1];c++)a.push(virtualclass.wb[virtualclass.gObj.currWb].gObj.myrepObj[c]);return a},handleMissedPackets:function(b,a,f){f=this.removeDupObjs(f);virtualclass.wb[virtualclass.gObj.currWb].gObj.replayObjs=virtualclass.wb[virtualclass.gObj.currWb].gObj.replayObjs.concat(f);c.sortingReplyObjs();b!=a&&virtualclass.storage.store(JSON.stringify(virtualclass.wb[virtualclass.gObj.currWb].gObj.replayObjs));
this.containsIfQueuePacks(b,a,virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId,f)},removeDupObjs:function(b){0<virtualclass.wb[virtualclass.gObj.currWb].gObj.myArr.length&&(b[b.length-1].uid==virtualclass.wb[virtualclass.gObj.currWb].gObj.myArr[0].uid&&(virtualclass.wb[virtualclass.gObj.currWb].gObj.myArr[0].hasOwnProperty("cmd")||virtualclass.wb[virtualclass.gObj.currWb].gObj.myArr.shift()),b=b.concat(virtualclass.wb[virtualclass.gObj.currWb].gObj.myArr),virtualclass.wb[virtualclass.gObj.currWb].gObj.myArr=
[]);return b},containsIfQueuePacks:function(b,a,c,g){b!=a&&c+1!=g[0].uid&&0<virtualclass.wb[virtualclass.gObj.currWb].gObj.packQueue.length&&g[g.length-1].uid==virtualclass.wb[virtualclass.gObj.currWb].gObj.packQueue[0].uid&&(virtualclass.wb[virtualclass.gObj.currWb].gObj.packQueue=g.concat(virtualclass.wb[virtualclass.gObj.currWb].gObj.packQueue))},sortingReplyObjs:function(){virtualclass.wb[virtualclass.gObj.currWb].gObj.replayObjs=virtualclass.wb[virtualclass.gObj.currWb].gObj.replayObjs.sort(function(b,
a){return b.uid-a.uid})}};d.bridge=c})(window);(function(d){d.Optimize=function(c){var b=virtualclass.wb[c].vcan;b.optimize={sendPacketWithOptimization:function(a,b,c){var f=virtualclass.gObj.currWb;"undefined"==typeof this.lastarrowtime&&(this.lastarrowtime=(new Date).getTime(),1==b&&virtualclass.vutil.beforeSend(JSON.parse(a)),virtualclass.wb[f].utility.updateSentInformation(a,!0));this.presentarrowtime=(new Date).getTime();this.presentarrowtime-this.lastarrowtime>=c&&(1==b&&(b=JSON.parse(a),b.hasOwnProperty("createArrow")?ioAdapter.send(b):
ioAdapter.mustSend(b)),virtualclass.wb[f].utility.updateSentInformation(a,!0),this.lastarrowtime=(new Date).getTime())},doOptiMize:function(a){"move"==b.main.action&&roles.hasControls()&&(a=b.utility.updateCordinate(a));if("undefined"==typeof lastmousemovetime||null==lastmousemovetime)lastmousemovetime=(new Date).getTime(),a.detail.hasOwnProperty("cevent")||b.optimize.calculatePackets(lastmousemovetime,"m",a.clientX-b.main.offset.x,a.clientY-b.main.offset.y);presentmousemovetime=(new Date).getTime();
2E3<=presentmousemovetime-lastmousemovetime&&((new Date).getTime(),a.detail.hasOwnProperty("cevent")||b.optimize.calculatePackets(lastmousemovetime,"m",a.clientX-b.main.offset.x,a.clientY-b.main.offset.y),b.optimize.calculatePackets(lastmousemovetime,"m",a.clientX-b.main.offset.x,a.clientY-b.main.offset.y),lastmousemovetime=(new Date).getTime())},calculatePackets:function(a,c,g,d){g/=virtualclass.zoom.canvasScale;d/=virtualclass.zoom.canvasScale;var f=virtualclass.gObj.currWb;a=b.makeStackObj(a,c,
g,d);virtualclass.wb[f].uid++;a.uid=virtualclass.wb[f].uid;b.main.replayObjs.push(a);virtualclass.vutil.beforeSend({repObj:[a],cf:"repObj"});virtualclass.storage.store(JSON.stringify(b.main.replayObjs))}}}})(window);(function(d){d.response={reclaimRole:function(c,b){c!=b&&(virtualclass.user.control._assign(b,"notsent",c),virtualclass.user.displayStudentSpeaker(!0),null!=localStorage.getItem("aId")&&localStorage.removeItem("aId"),virtualclass.user.control.removeAudioFromParticipate(c),"mobTab"==virtualclass.system.device&&((virtualclass.system.mybrowser.name=8<=virtualclass.system.mybrowser.version)&&/(iPad)/g.test(navigator.userAgent)&&virtualclass.vutil.enableVirtualClass(),virtualclass.view.removeErrorMsg("errorContainer",
!0)))},assignRole:function(c,b,a){if(c!=b||"undefined"!=typeof a)if(virtualclass.vutil.assignRole(b),virtualclass.wb[virtualclass.gObj.currWb].utility.uniqueArrOfObjsToTeacher(),roles.hasAdmin())c=document.getElementById("chat_div").getElementsByClassName("currTeacher")[0],null!=c&&virtualclass.user.control.removeCurrTeacherFromControl(c.id),virtualclass.user.control.changeAttrToAssign("enable");else{virtualclass.vutil.removeSessionTool();b=document.getElementById("ml"+c);a=["assign"];var f=document.getElementById(c+
"ControlContainer");null!=f?virtualclass.user.createAssignControl(f,c,!0):(a=virtualclass.user.createControl(c,a),b.appendChild(a));localStorage.setItem("aId",c)}virtualclass.vutil.attachClickOutSideCanvas();"mobTab"==virtualclass.system.device&&(virtualclass.vutil.disableVirtualClass(),virtualclass.view.createErrorMsg(virtualclass.lang.getString("supportDesktop"),"errorContainer","chatWidget"))},checkUser:function(c,b,a){"undefined"!=typeof vcan.teacher||a||virtualclass.wb[virtualclass.gObj.currWb].utility.makeCanvasDisable();
virtualclass.vutil.initDefaultInfo(c,wbUser.role,virtualclass.currApp);virtualclass.wb[virtualclass.gObj.currWb].utility.makeUserAvailable(c.message.checkUser.e.clientLen)},clearAll:function(c,b,a,f){c!=b&&(virtualclass.wb[virtualclass.gObj.currWb].tool=new virtualclass.wb[virtualclass.gObj.currWb].tool_obj("t_clearall"),virtualclass.wb[virtualclass.gObj.currWb].utility.t_clearallInit(),virtualclass.wb[virtualclass.gObj.currWb].utility.makeDefaultValue(),virtualclass.storage.clearSingleTable("wbData"))},
replayAll:function(){d.virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs=virtualclass.wb[virtualclass.gObj.currWb].gObj.replayObjs;virtualclass.wb[virtualclass.gObj.currWb].utility.clearAll(!1);virtualclass.wb[virtualclass.gObj.currWb].toolInit("t_replay","fromFile")},createArrow:function(c){var b=virtualclass.gObj.currWb,a=virtualclass.wb[b].arrImg,f={};f.mp={x:c.x*virtualclass.zoom.canvasScale,y:c.y*virtualclass.zoom.canvasScale};document.querySelector("#canvasWrapper"+b);virtualclass.posY=
f.mp.y;virtualclass.posX=f.mp.x;virtualclass.wb[virtualclass.gObj.currWb].utility.drawArrowImg(a,f);null!=virtualclass.pdfRender[b].scroll.Y&&virtualclass.pdfRender[b].customMoustPointer({y:virtualclass.posY},"Y",virtualclass.posY);null!=virtualclass.pdfRender[b].scroll.X&&virtualclass.pdfRender[b].customMoustPointer({x:virtualclass.posX},"X",virtualclass.posX)},replayObj2:function(c){d.virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs=[];0<c.length&&(virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId+
1==c[0].uid?(d.virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs=c,console.log("Whiteboard:-  recieved "+c[c.length-1].uid),virtualclass.wb[virtualclass.gObj.currWb].toolInit("t_replay","fromBrowser",!0,virtualclass.wb[virtualclass.gObj.currWb].utility.dispQueuePacket)):console.log("Whiteboard:- Problem between display id "+virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId+" and recived first packet"+c[0].uid))},replayObj:function(c){d.virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs=
[];0<c.length&&(d.virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs=c,virtualclass.wb[virtualclass.gObj.currWb].toolInit("t_replay","fromBrowser",!0,virtualclass.wb[virtualclass.gObj.currWb].utility.dispQueuePacket))},chunk:function(c,b,a){virtualclass.wb[virtualclass.gObj.currWb].bridge.handleMissedPackets(c,b,a)},repObjForMissedPkts:function(c){(0!==virtualclass.wb[virtualclass.gObj.currWb].gObj.rcvdPackId||0<virtualclass.wb[virtualclass.gObj.currWb].uid&&0===virtualclass.wb[virtualclass.gObj.currWb].gObj.rcvdPackId)&&
("object"===typeof c||c instanceof Array)&&c[0].hasOwnProperty("uid")&&!c.hasOwnProperty("chunk")&&(Number(virtualclass.wb[virtualclass.gObj.currWb].gObj.rcvdPackId+1)<Number(c[0].uid)||virtualclass.wb[virtualclass.gObj.currWb].gObj.rcvdPackId!=virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId)&&(c=virtualclass.wb[virtualclass.gObj.currWb].bridge.requestPackets(c),virtualclass.vutil.beforeSend({getMsPckt:c,cf:"getMsPckt"}))}}})(window);var LZString={_f:String.fromCharCode,_keyStrBase64:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_keyStrUriSafe:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",_getBaseValue:function(d,c){LZString._baseReverseDic||(LZString._baseReverseDic={});if(!LZString._baseReverseDic[d]){LZString._baseReverseDic[d]={};for(var b=0;b<d.length;b++)LZString._baseReverseDic[d][d[b]]=b}return LZString._baseReverseDic[d][c]},compressToBase64:function(d){if(null==d)return"";
d=LZString._compress(d,6,function(c){return LZString._keyStrBase64.charAt(c)});switch(d.length%4){default:case 0:return d;case 1:return d+"===";case 2:return d+"==";case 3:return d+"="}},decompressFromBase64:function(d){return null==d?"":""==d?null:LZString._decompress(d.length,32,function(c){return LZString._getBaseValue(LZString._keyStrBase64,d.charAt(c))})},compressToUTF16:function(d){return null==d?"":LZString._compress(d,15,function(c){return String.fromCharCode(c+32)})+" "},decompressFromUTF16:function(d){return null==
d?"":""==d?null:LZString._decompress(d.length,16384,function(c){return d.charCodeAt(c)-32})},compressToUint8Array:function(d){d=LZString.compress(d);for(var c=new Uint8Array(2*d.length),b=0,a=d.length;b<a;b++){var f=d.charCodeAt(b);c[2*b]=f>>>8;c[2*b+1]=f%256}return c},decompressFromUint8Array:function(d){if(null===d||void 0===d)return LZString.decompress(d);for(var c=Array(d.length/2),b=0,a=c.length;b<a;b++)c[b]=256*d[2*b]+d[2*b+1];var f=[];c.forEach(function(a){f.push(String.fromCharCode(a))});
return LZString.decompress(f.join(""))},compressToEncodedURIComponent:function(d){return null==d?"":LZString._compress(d,6,function(c){return LZString._keyStrUriSafe.charAt(c)})},decompressFromEncodedURIComponent:function(d){if(null==d)return"";if(""==d)return null;d=d.replace(/ /g,"+");return LZString._decompress(d.length,32,function(c){return LZString._getBaseValue(LZString._keyStrUriSafe,d.charAt(c))})},compress:function(d){return LZString._compress(d,16,function(c){return String.fromCharCode(c)})},
_compress:function(d,c,b){if(null==d)return"";var a,f={},g={},h="",m=2,n=3,r=2,A=[],z=0,t=0,v;for(v=0;v<d.length;v+=1){var q=d[v];Object.prototype.hasOwnProperty.call(f,q)||(f[q]=n++,g[q]=!0);var w=h+q;if(Object.prototype.hasOwnProperty.call(f,w))h=w;else{if(Object.prototype.hasOwnProperty.call(g,h)){if(256>h.charCodeAt(0)){for(a=0;a<r;a++)z<<=1,t==c-1?(t=0,A.push(b(z)),z=0):t++;var p=h.charCodeAt(0);for(a=0;8>a;a++)z=z<<1|p&1,t==c-1?(t=0,A.push(b(z)),z=0):t++,p>>=1}else{p=1;for(a=0;a<r;a++)z=z<<
1|p,t==c-1?(t=0,A.push(b(z)),z=0):t++,p=0;p=h.charCodeAt(0);for(a=0;16>a;a++)z=z<<1|p&1,t==c-1?(t=0,A.push(b(z)),z=0):t++,p>>=1}m--;0==m&&(m=Math.pow(2,r),r++);delete g[h]}else for(p=f[h],a=0;a<r;a++)z=z<<1|p&1,t==c-1?(t=0,A.push(b(z)),z=0):t++,p>>=1;m--;0==m&&(m=Math.pow(2,r),r++);f[w]=n++;h=String(q)}}if(""!==h){if(Object.prototype.hasOwnProperty.call(g,h)){if(256>h.charCodeAt(0)){for(a=0;a<r;a++)z<<=1,t==c-1?(t=0,A.push(b(z)),z=0):t++;p=h.charCodeAt(0);for(a=0;8>a;a++)z=z<<1|p&1,t==c-1?(t=0,A.push(b(z)),
z=0):t++,p>>=1}else{p=1;for(a=0;a<r;a++)z=z<<1|p,t==c-1?(t=0,A.push(b(z)),z=0):t++,p=0;p=h.charCodeAt(0);for(a=0;16>a;a++)z=z<<1|p&1,t==c-1?(t=0,A.push(b(z)),z=0):t++,p>>=1}m--;0==m&&(m=Math.pow(2,r),r++);delete g[h]}else for(p=f[h],a=0;a<r;a++)z=z<<1|p&1,t==c-1?(t=0,A.push(b(z)),z=0):t++,p>>=1;m--;0==m&&r++}p=2;for(a=0;a<r;a++)z=z<<1|p&1,t==c-1?(t=0,A.push(b(z)),z=0):t++,p>>=1;for(;;)if(z<<=1,t==c-1){A.push(b(z));break}else t++;return A.join("")},decompress:function(d){return null==d?"":""==d?null:
LZString._decompress(d.length,32768,function(c){return d.charCodeAt(c)})},_decompress:function(d,c,b){var a=[],f=4,g=4,h=3,m=[],n,r,A=LZString._f,z=b(0),t=c,v=1;for(n=0;3>n;n+=1)a[n]=n;var q=0;var w=Math.pow(2,2);for(r=1;r!=w;){var p=z&t;t>>=1;0==t&&(t=c,z=b(v++));q|=(0<p?1:0)*r;r<<=1}switch(q){case 0:q=0;w=Math.pow(2,8);for(r=1;r!=w;)p=z&t,t>>=1,0==t&&(t=c,z=b(v++)),q|=(0<p?1:0)*r,r<<=1;var B=A(q);break;case 1:q=0;w=Math.pow(2,16);for(r=1;r!=w;)p=z&t,t>>=1,0==t&&(t=c,z=b(v++)),q|=(0<p?1:0)*r,r<<=
1;B=A(q);break;case 2:return""}n=a[3]=B;for(m.push(B);;){if(v>d)return"";q=0;w=Math.pow(2,h);for(r=1;r!=w;)p=z&t,t>>=1,0==t&&(t=c,z=b(v++)),q|=(0<p?1:0)*r,r<<=1;switch(B=q){case 0:q=0;w=Math.pow(2,8);for(r=1;r!=w;)p=z&t,t>>=1,0==t&&(t=c,z=b(v++)),q|=(0<p?1:0)*r,r<<=1;a[g++]=A(q);B=g-1;f--;break;case 1:q=0;w=Math.pow(2,16);for(r=1;r!=w;)p=z&t,t>>=1,0==t&&(t=c,z=b(v++)),q|=(0<p?1:0)*r,r<<=1;a[g++]=A(q);B=g-1;f--;break;case 2:return m.join("")}0==f&&(f=Math.pow(2,h),h++);if(a[B])B=a[B];else if(B===g)B=
n+n[0];else return null;m.push(B);a[g++]=n+B[0];f--;n=B;0==f&&(f=Math.pow(2,h),h++)}}};"undefined"!==typeof module&&null!=module&&(module.exports=LZString);/*
 g711
 Copyright(c) 2011 Jo?o Martins <madjackoo@gmail.com>
 MIT Licensed
*/
(function(d){var c={BIAS:132,CLIP:32635,tables:{ulaw:{compress:[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],decompress:[-32124,-31100,-30076,-29052,-28028,-27004,-25980,-24956,-23932,-22908,-21884,-20860,-19836,-18812,-17788,-16764,-15996,-15484,-14972,-14460,-13948,-13436,-12924,-12412,-11900,-11388,-10876,-10364,-9852,-9340,-8828,-8316,-7932,-7676,-7420,-7164,-6908,-6652,-6396,-6140,-5884,-5628,-5372,-5116,-4860,-4604,-4348,-4092,-3900,-3772,-3644,-3516,-3388,-3260,-3132,-3004,-2876,-2748,-2620,-2492,-2364,-2236,-2108,-1980,-1884,
-1820,-1756,-1692,-1628,-1564,-1500,-1436,-1372,-1308,-1244,-1180,-1116,-1052,-988,-924,-876,-844,-812,-780,-748,-716,-684,-652,-620,-588,-556,-524,-492,-460,-428,-396,-372,-356,-340,-324,-308,-292,-276,-260,-244,-228,-212,-196,-180,-164,-148,-132,-120,-112,-104,-96,-88,-80,-72,-64,-56,-48,-40,-32,-24,-16,-8,0,32124,31100,30076,29052,28028,27004,25980,24956,23932,22908,21884,20860,19836,18812,17788,16764,15996,15484,14972,14460,13948,13436,12924,12412,11900,11388,10876,10364,9852,9340,8828,8316,7932,
7676,7420,7164,6908,6652,6396,6140,5884,5628,5372,5116,4860,4604,4348,4092,3900,3772,3644,3516,3388,3260,3132,3004,2876,2748,2620,2492,2364,2236,2108,1980,1884,1820,1756,1692,1628,1564,1500,1436,1372,1308,1244,1180,1116,1052,988,924,876,844,812,780,748,716,684,652,620,588,556,524,492,460,428,396,372,356,340,324,308,292,276,260,244,228,212,196,180,164,148,132,120,112,104,96,88,80,72,64,56,48,40,32,24,16,8,0]},alaw:{compress:[1,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,
6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],decompress:[-5504,-5248,-6016,-5760,-4480,-4224,-4992,-4736,-7552,-7296,-8064,-7808,-6528,-6272,-7040,-6784,-2752,-2624,-3008,-2880,-2240,-2112,-2496,-2368,-3776,-3648,-4032,-3904,-3264,-3136,-3520,-3392,-22016,-20992,-24064,-23040,-17920,-16896,-19968,-18944,-30208,-29184,-32256,-31232,-26112,-25088,-28160,-27136,-11008,
-10496,-12032,-11520,-8960,-8448,-9984,-9472,-15104,-14592,-16128,-15616,-13056,-12544,-14080,-13568,-344,-328,-376,-360,-280,-264,-312,-296,-472,-456,-504,-488,-408,-392,-440,-424,-88,-72,-120,-104,-24,-8,-56,-40,-216,-200,-248,-232,-152,-136,-184,-168,-1376,-1312,-1504,-1440,-1120,-1056,-1248,-1184,-1888,-1824,-2016,-1952,-1632,-1568,-1760,-1696,-688,-656,-752,-720,-560,-528,-624,-592,-944,-912,-1008,-976,-816,-784,-880,-848,5504,5248,6016,5760,4480,4224,4992,4736,7552,7296,8064,7808,6528,6272,
7040,6784,2752,2624,3008,2880,2240,2112,2496,2368,3776,3648,4032,3904,3264,3136,3520,3392,22016,20992,24064,23040,17920,16896,19968,18944,30208,29184,32256,31232,26112,25088,28160,27136,11008,10496,12032,11520,8960,8448,9984,9472,15104,14592,16128,15616,13056,12544,14080,13568,344,328,376,360,280,264,312,296,472,456,504,488,408,392,440,424,88,72,120,104,24,8,56,40,216,200,248,232,152,136,184,168,1376,1312,1504,1440,1120,1056,1248,1184,1888,1824,2016,1952,1632,1568,1760,1696,688,656,752,720,560,528,
624,592,944,912,1008,976,816,784,880,848]}},encode:function(b,a){a=a||{};b.constructor==Array&&(b.byteLength=2*b.length);var f=new ArrayBuffer(b.byteLength/2);f=new Int8Array(f);a=c[a.alaw?"alaw":"ulaw"];for(var g=0;g<b.byteLength/2;g++)f[g]=a(b[g]);return f},decode:function(b,a){a=a||{};"undefined"==typeof b.byteLength&&(b.byteLength=b.length);var f=!!a.floating_point,g=new ArrayBuffer(b.byteLength*(f?4:2));g=f?new Float32Array(g):new Int16Array(g);a=c[(a.alaw?"alaw":"ulaw")+"_dec"];for(var d,m=
0;m<b.byteLength;m++)d=a(b[m]),g[m]=f?d/32768:d;return g},alaw:function(b){var a=new ArrayBuffer(2),f=new ArrayBuffer(1);a=new Int16Array(a);f=new Int8Array(f);var g=~b>>8&128;128!=g&&(a[0]=-b,b=a[0]);b>c.CLIP&&(b=c.CLIP);256<=b?(a=c.tables.alaw.compress[b>>8&127],f[0]=a<<4|b>>a+3&15):f[0]=b>>4;f[0]=f[0]^g^85;return f[0]},alaw_dec:function(b){var a=new ArrayBuffer(2);a=new Int8Array(a);b=c.tables.alaw.decompress[b&255];a[0]=b;a[1]=b>>8;return(new Int16Array(a.buffer))[0]},ulaw:function(b){var a=new ArrayBuffer(2),
f=new ArrayBuffer(1);a=new Int16Array(a);f=new Int8Array(f);0>b?(a[0]=c.BIAS-b,b=a[0],a=127):(b+=c.BIAS,a=255);var g=c.tables.ulaw.compress[b>>8&127];if(8<=g)return 127^a;f[0]=g<<4|b>>g+3&15;return f[0]^a},ulaw_dec:function(b){var a=new ArrayBuffer(2);a=new Int8Array(a);b=c.tables.ulaw.decompress[b&255];a[0]=b;a[1]=b>>8;return(new Int16Array(a.buffer))[0]},ulaw_dec_slow:function(b){var a=new ArrayBuffer(2);a=new Int16Array(a);a[0]=~b;b=a[0];a=((b&15)<<3)+c.BIAS;a<<=(b&112)>>4;b=128==(b&128);var f=
new ArrayBuffer(2);f=new Int16Array(f);f[0]=b?c.BIAS-a:a-c.BIAS;return f[0]}};d.G711=c;d.version="0.0.1"})("undefined"!==typeof exports?module.exports:window);window.addEventListener("message",function(d){if(d.origin==window.location.origin)if("gotScreen"==d.data.type){if(""===d.data.sourceId){if(d=Error("NavigatorUserMediaError"),d.name="PERMISSION_DENIED",virtualclass.hasOwnProperty("ss"))virtualclass.ss.onError(d)}else{var c=c||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:d.data.sourceId,maxWidth:1440,maxHeight:9999},optional:[{maxFrameRate:3},{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}};virtualclass.adpt=
new virtualclass.adapter;navigator2=virtualclass.adpt.init(navigator);navigator2.getUserMedia(c,function(b){virtualclass.ss._init();virtualclass.ss.initializeRecorder.call(virtualclass.ss,b)},function(b){virtualclass.ss.onError.call(virtualclass.ss,b)})}if(d=document.querySelector("#virtualclassScreenShareLocalSmall"))d.style.display="block"}else"getScreenPending"==d.data.type?window.clearTimeout(d.data.id):"yes"==d.data.type&&(virtualclass.gObj.ext=!0)});(function(d){d.dirtyCorner={decodeRGB:function(c,b,a){b=b.createImageData(a.width,a.height);for(a=0;a<4*c.length;a++)b.data[4*a]=36.5*(c[a]>>5),b.data[4*a+1]=36.5*((c[a]&28)>>2),b.data[4*a+2]=85*(c[a]&3),b.data[4*a+3]=255;return b},decodeRGBSlice:function(c,b,a){b=b.createImageData(a.w,a.h);for(a=0;a<4*c.length;a++)b.data[4*a]=36.5*(c[a]>>5),b.data[4*a+1]=36.5*((c[a]&28)>>2),b.data[4*a+2]=85*(c[a]&3),b.data[4*a+3]=255;return b},encodeRGB:function(c){for(var b=c.length/4,a=new Uint8ClampedArray(b),
f,g,d,m=0;m<b;m++)f=c[4*m],g=c[4*m+1],d=c[4*m+2],f=(Math.round(f/36.5)<<5)+(Math.round(g/36.5)<<2)+Math.round(d/85),a[m]=f;return a},str2ImageData:function(c,b){b=context2.createImageData(b.w,b.h);var a=new ArrayBuffer(c.length);b.data=new Uint8Array(a);for(a=0;a<strLen;a++)b.data[a]=c.charCodeAt(a);return b},doClearCanvas:function(){context2.clearRect(0,0,canvas2.width,canvas2.height)}}})(window);(function(d){d.vutil={createDOM:function(c,b,a){c=document.createElement(c);"undefined"!=typeof b&&(c.id=b);if("undefined"!=typeof a){b="";if(0<a.length)for(var f=0;f<a.length;f++)b+=a[f]+" ";c.className=b}return c},ab2str:function(c){return String.fromCharCode.apply(null,new Uint8ClampedArray(c))},str2ab:function(c){var b=new ArrayBuffer(c.length);b=new Uint8ClampedArray(b);for(var a=0,f=c.length;a<f;a++)b[a]=c.charCodeAt(a);return b},sidebarHeightInit:function(){document.getElementById("widgetRightSide").style.height=
d.innerHeight+"px"},isSystemCompatible:function(){if(0<virtualclass.error.length){var c=1<virtualclass.error.length?virtualclass.error.join("<br />"):virtualclass.error[0];virtualclass.view.createErrorMsg(c,"errorContainer","chatWidget");virtualclass.gObj.hasOwnProperty("errIE")&&virtualclass.vutil.disableVirtualClass();virtualclass.gObj.hasOwnProperty("audIntDisable")&&virtualclass.user.control.mediaWidgetDisable();virtualclass.gObj.hasOwnProperty("errNotDesktop")&&(virtualclass.user.control.mediaWidgetDisable(),
virtualclass.vutil.disableVirtualClass())}else(virtualclass.gObj.hasOwnProperty("audIntDisable")||virtualclass.gObj.hasOwnProperty("vidIntDisable"))&&virtualclass.user.control.mediaWidgetDisable()},chkValueInLocalStorage:function(c){return null===localStorage.getItem(c)?!1:localStorage[c]},setContainerWidth:function(c,b){},setScreenInnerTagsWidth:function(c){document.getElementById(c);document.getElementById(c+"Local");document.getElementById(c+"LocalVideo")},makeActiveApp:function(c,b){if(c!=b&&
"undefined"!=typeof b)b+="Tool",document.getElementById(b).className=virtualclass.vutil.removeClassFromElement(b,"active");else{b=document.getElementsByClassName("appOptions");for(var a=0;a<b.length;a++)b[a].classList.contains("active")&&b[a].classList.remove("active")}document.getElementById(c+"Tool").className+=" active"},initInstallChromeExt:function(c){"EXTENSION_UNAVAILABLE"==c.name&&(console.log("ask for inline installation"),this._inlineChomeExtensionStore())},_inlineChomeExtensionStore:function(){chrome.webstore.install("https://chrome.google.com/webstore/detail/ijhofagnokdeoghaohcekchijfeffbjl",
function(c){d.location.reload()},function(c){alert(c)})},removeAppPanel:function(){var c=document.getElementById("virtualclassOptionsCont");null!=c&&c.parentNode.removeChild(c)},removeTempVideo:function(c){c=document.getElementById(c);c.parentNode.removeChild(c)},createLocalTempVideo:function(c,b){if("string"==typeof c||"String"==typeof c)c=document.getElementById(c);var a=virtualclass.vutil.createDOM("div",b);b=virtualclass.vutil.createDOM("canvas",b+"Video");a.appendChild(b);c.appendChild(a)},initLocCanvasCont:function(c){var b=
"ScreenShare"==virtualclass.currApp?"ss":"wss";virtualclass[b].localtempCanvas=document.getElementById(c);console.log(virtualclass[b].localtempCanvas);virtualclass[b].localtempCont=virtualclass[b].localtempCanvas.getContext("2d")},videoTeacher2Student:function(c,b){var a=c,f=document.getElementById("virtualclass"+c+"LocalVideo");if(null!=f&&"VIDEO"==f.tagName){var g=document.createElement("canvas");g.id=f.id;g.width=f.offsetWidth;g.height=f.offsetHeight;f.parentNode.replaceChild(g,f);"ScreenShare"==
a&&(a="ss");"undefined"!=typeof b||"undefined"==typeof a||"ss"!=a&&"wss"!=a||(virtualclass[a].localCanvas=g,virtualclass[a].localCont=virtualclass[a].localCanvas.getContext("2d"),b=virtualclass[a].localtempCont.getImageData(0,0,virtualclass[a].localtempCanvas.width,virtualclass[a].localtempCanvas.height),virtualclass[a].localCont.putImageData(b,0,0));virtualclass.vutil.removeTempVideo("virtualclass"+c+"LocalTemp")}},clickOutSideCanvas:function(){this.exitTextWrapper()&&virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.textUtility(virtualclass.wb[virtualclass.gObj.currWb].gObj.spx,
virtualclass.wb[virtualclass.gObj.currWb].gObj.spy)},exitTextWrapper:function(){return 0<document.getElementsByClassName("textBoxContainer").length},attachClickOutSideCanvas:function(){function c(b){b=document.getElementById(b);null!=b&&(b.onclick=function(){roles.hasControls()&&virtualclass.vutil.clickOutSideCanvas()})}c("commandToolsWrapper");c("virtualclassOptionsCont");c("audioWidget");c("chatWidget")},dimensionMatch:function(c,b){c=document.getElementById(c).offsetWidth;var a=document.getElementById("virtualclassOptionsCont").offsetWidth;
b=document.getElementById(b);return null!=b?b.offsetWidth+a==c:!1},disableAppsBar:function(){var c=document.getElementById("virtualclassOptionsCont");null!=c&&(c.style.pointerEvents="none")},isMiniFileIncluded:function(c){c=new RegExp(c+".js?=*([0-9]*)");for(var b=document.getElementsByTagName("script"),a=0;a<b.length;a++)if(c.test(b[a].src))return!0;return!1},clearAllChat:function(){localStorage.removeItem(virtualclass.gObj.uid);localStorage.clear("chatroom");virtualclass.chat.idList.length=0;clearAllChatBox();
var c=document.getElementById("chatWidget").getElementsByClassName("ui-chatbox-msg");if(0<c.length)for(;null!=c[0];)c[0].parentNode.removeChild(c[0])},isObjectEmpty:function(c){for(var b in c)if(c.hasOwnProperty(b))return!1;return!0},removeSessionTool:function(){if(!roles.hasAdmin()){var c=document.getElementById("virtualclassSessionEndTool");null!=c&&c.parentNode.removeChild(c)}},addClass:function(c,b){var a=document.getElementById(c);virtualclass.vutil.elemHasAnyClass(c)?a.classList.add(b):a.className=
b},removeClass:function(c,b){var a=document.getElementById(c);virtualclass.vutil.elemHasAnyClass(c)&&a.classList.contains(b)&&a.classList.remove(b)},breakIntoBytes:function(c,b){c=c.toString();for(var a=c.length;a<b;a++)c="0"+c;return c.match(/[\S]{1,2}/g)||[]},numValidateFour:function(c,b,a,f){c=this.preNumValidateTwo(c);b=this.preNumValidateTwo(b);a=this.preNumValidateTwo(a);f=this.preNumValidateTwo(f);return parseInt(c+b+a+f)},numValidateTwo:function(c,b){c=this.preNumValidateTwo(c);b=this.preNumValidateTwo(b);
return parseInt(c+b)},preNumValidateTwo:function(c){c=c.toString();if(1==c.length)return"0"+c;if(2==c.length)return c},elemHasAnyClass:function(c){c=document.getElementById(c);return null!=c?"undefined"!=typeof c.classList:!1},userIsOrginalTeacher:function(c){return roles.hasAdmin()},isUserTeacher:function(c){return roles.hasControls()},initDisableAudVid:function(){virtualclass.gObj.audIntDisable=!0;virtualclass.gObj.vidIntDisable=!0},initDisableVirtualClass:function(){this.initDisableAudVid();virtualclass.gObj.errNotDesktop=
!0;virtualclass.gObj.errNotScreenShare=!0;virtualclass.gObj.errAppBar=!0},disableVirtualClass:function(){var c=document.getElementById("virtualclassCont");c.style.opacity=.6;c.style.pointerEvents="none"},enableVirtualClass:function(){var c=document.getElementById("virtualclassCont");c.style.opacity=1;c.style.pointerEvents="visible"},firstiOSaudioCall:function(){virtualclass.gObj.hasOwnProperty("audioPlayMessage")&&(virtualclass.gObj.iosIpadbAudTrue=!0,virtualclass.gObj.video.audio.receivedAudioProcess(virtualclass.gObj.audioPlayMessage))},
beforeLoad:function(){"DocumentShare"==virtualclass.currApp&&io.disconnect();virtualclass.gObj.windowLoading=!0;if(virtualclass.recorder.hasOwnProperty("doSessionClear"))virtualclass.clearSession();else if(0==localStorage.length)virtualclass.storage.clearStorageData();else{console.log("screen-detail init");if("undefined"!=typeof virtualclass.storage.wholeStoreData){var c=JSON.parse(virtualclass.storage.wholeStoreData);c.beforeRefresh=!0;virtualclass.storage.wholeStore(c,"put")}localStorage.setItem("executedSerial",
JSON.stringify(ioMissingPackets.executedSerial));localStorage.setItem("executedUserSerial",JSON.stringify(ioMissingPackets.executedUserSerial));"undefined"!=typeof virtualclass.gObj.audioEnable&&localStorage.setItem("audEnable",JSON.stringify({ac:virtualclass.gObj.audioEnable}));localStorage.removeItem("otherRole");virtualclass.gObj.hasOwnProperty("audIntDisable")||virtualclass.gObj.video.audio.studentNotSpeak();virtualclass.vutil.clickOutSideCanvas();localStorage.setItem(wbUser.sid,JSON.stringify(virtualclass.chat.vmstorage));
virtualclass.hasOwnProperty("editorRich")&&"object"==typeof virtualclass.editorRich.vcAdapter&&virtualclass.editorRich.saveIntoLocalStorage();virtualclass.hasOwnProperty("editorCode")&&"object"==typeof virtualclass.editorCode.vcAdapter&&virtualclass.editorCode.saveIntoLocalStorage();c={name:virtualclass.vutil.capitalizeFirstLetter(virtualclass.currApp)};console.log(virtualclass.currApp);if("ScreenShare"==virtualclass.currApp){c.name=virtualclass.gObj.defaultApp;var b=virtualclass.vutil.whoIsTeacher();
virtualclass.gObj.studentSSstatus.mesharing?ioAdapter.mustSendUser({cf:"rmStdScreen"},b):roles.hasControls()&&!virtualclass.gObj.studentSSstatus.mesharing&&virtualclass.vutil.beforeSend({unshareScreen:!0,st:"ss",cf:"unshareScreen"});if(roles.isStudent()&&!virtualclass.gObj.studentSSstatus.mesharing||roles.hasControls())console.log("screen-detail is saving into storage"),localStorage.setItem("studentSSstatus",JSON.stringify(virtualclass.gObj.studentSSstatus))}else"Yts"==virtualclass.currApp?"undefined"!=
typeof virtualclass.yts.videoId&&"object"==typeof virtualclass.yts.player&&(c.metaData={init:virtualclass.yts.videoId,startFrom:virtualclass.yts.player.getCurrentTime()}):"SharePresentation"==virtualclass.currApp?"undefined"!=typeof virtualclass.sharePt&&"object"==typeof virtualclass.sharePt&&virtualclass.sharePt.pptUrl?(console.log("beforeloadS"+virtualclass.sharePt.pptUrl),c.metaData={init:virtualclass.sharePt.pptUrl,startFrom:virtualclass.sharePt.state,currId:virtualclass.sharePt.currId},console.log("start From"+
virtualclass.sharePt.state),virtualclass.sharePt.saveIntoLocalStorage(c)):c.metaData=null:"Poll"==virtualclass.currApp?(virtualclass.poll.saveInLocalStorage(),console.log("currAppPoll")):"Video"==virtualclass.currApp?(virtualclass.videoUl.player&&(b=virtualclass.videoUl.player.currentTime()),c.metaData={init:{videoId:virtualclass.videoUl.videoId,videoUrl:virtualclass.videoUl.videoUrl,yts:virtualclass.videoUl.yts,online:virtualclass.videoUl.online,isPaused:virtualclass.videoUl.isPaused},startFrom:b,
isAutoplay:virtualclass.videoUl.autoPlayFlag},console.log(c)):"DocumentShare"==virtualclass.currApp?(console.log("previous app success "+virtualclass.currApp),virtualclass.dts.docs.hasOwnProperty("currDoc")?(b=virtualclass.dts.docs.currDoc,console.log("currentDocument "+b),c.metaData=0<virtualclass.dts.order.length?{init:b,slideNumber:virtualclass.dts.docs.note.currNote,order:JSON.stringify(virtualclass.dts.order)}:{init:"layout",slideNumber:null}):c.metaData={init:"layout",slideNumber:null},0<Object.keys(virtualclass.dts.pages).length&&
(c.metaData.docs=virtualclass.dts.pages)):"Quiz"==virtualclass.currApp?(virtualclass.quiz.saveInLocalStorage(),console.log("quiz data saved")):"Whiteboard"==virtualclass.currApp&&(c={name:"Whiteboard",wbn:virtualclass.gObj.wbCount});localStorage.setItem("wIds",JSON.stringify(virtualclass.gObj.wIds));null!=virtualclass.zoom.canvasScale&&(b=+virtualclass.zoom.canvasScale,console.log("Canvas pdf scale "+b),virtualclass.vutil.isNumeric(b)&&localStorage.setItem("wbcScale",b));roles.hasView()&&"Yts"==virtualclass.currApp&&
(c={name:"Yts",metaData:null});virtualclass.hasOwnProperty("dts")&&null!=virtualclass.dts&&virtualclass.dts.upateInStorage();localStorage.setItem("currSlide",virtualclass.gObj.currSlide);roles.hasControls()||(b=document.querySelector("#virtualclassCont.congrea #congHr.disable"))&&b.click();console.dir("Previous object "+c);localStorage.setItem("prevApp",JSON.stringify(c));roles.hasControls()?localStorage.setItem("videoSwitch",virtualclass.videoHost.gObj.videoSwitch):(localStorage.setItem("stdVideoSwitch",
virtualclass.videoHost.gObj.stdStopSmallVid),localStorage.setItem("allStdVideoOff",virtualclass.videoHost.gObj.allStdVideoOff));localStorage.setItem("chatWindow",virtualclass.chat.chatWindow);"DocumentShare"!=virtualclass.currApp&&io.disconnect()}},initOnBeforeUnload:function(c){"iOS"==c?document.body.onunload=function(){virtualclass.vutil.beforeLoad()}:d.onbeforeunload=function(){var b=virtualclass.vutil.smallizeFirstLetter(virtualclass.currApp);virtualclass.vutil.beforeLoad();if(("editorRich"==
b||"editorCode"==b)&&"Synchronized"!=virtualclass[b].cmClient.state.constructor.name)return virtualclass.lang.getString("editorinsync")}},isPlayMode:function(){return 1==d.wbUser.virtualclassPlay},progressBar:function(c,b,a,f){b>c&&(b=c,document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("playsessionmsg"));c=0==c&&0==b?0:Math.round(100*b/c);document.getElementById(a).style.width=c+"%";document.getElementById(f).innerHTML=c+"%"},hidePrevIcon:function(c){var b=document.getElementById(virtualclass.previous);
null!=b&&(b.style.display="none",console.log("Hide previous screen with display new "+c),"ss"==c?"object"==typeof virtualclass[c]&&(document.getElementById(virtualclass[c].id).style.display="block"):document.getElementById(virtualclass[c].id).style.display="block")},getUserInfo:function(c,b,a){for(var f=0;f<a.length;f++)if(a[f].userid==b)return a[f][c]},getUserAllInfo:function(c,b){for(var a=0;a<b.length;a++)if(b[a].userid==c)return b[a];return!1},smallizeFirstLetter:function(c){return c.charAt(0).toLowerCase()+
c.slice(1)},capitalizeFirstLetter:function(c){return c.charAt(0).toUpperCase()+c.slice(1)},initDefaultInfo:function(c,b){"t"==c&&"Whiteboard"==b?roles.hasAdmin()||(virtualclass.wb[virtualclass.gObj.currWb].utility.setOrginalTeacherContent(),virtualclass.wb[virtualclass.gObj.currWb].attachToolFunction(commandToolsWrapper+virtualclass.gObj.currWb,!0)):"s"==c&&(virtualclass.gObj.studentId=wbUser.id,roles.hasControls()||(b=localStorage.getItem("uRole"),null!=b&&"e"==b&&(c="e"),localStorage.setItem("uRole",
c)),virtualclass.vutil.removeSessionTool());virtualclass.gObj.hasOwnProperty("audIntDisable")||virtualclass.gObj.hasOwnProperty("vidIntDisable")||setTimeout(function(){virtualclass.gObj.video.init();virtualclass.gObj.video.isInitiator=!0},500);virtualclass.gObj.oneExecuted=!1},removeClassFromElement:function(c,b){if("t_reclaim"!=c){c=document.getElementById(c);if(0<c.classList.length)return c.classList.remove(b),c.className;console.log("Whiteboard Tool class:- could not remove "+b)}},beforeSend:function(c,
b,a){var f=virtualclass.gObj.currWb;if(c.hasOwnProperty("createArrow"))c=JSON.stringify(c),virtualclass.wb[f].vcan.optimize.sendPacketWithOptimization(c,io.sock.readyState,300);else{if(c.hasOwnProperty("repObj")){if("undefined"==typeof c.repObj[c.repObj.length-1])return;virtualclass.wb[f].gObj.rcvdPackId=c.repObj[c.repObj.length-1].uid;virtualclass.wb[f].gObj.displayedObjId=virtualclass.wb[f].gObj.rcvdPackId}JSON.stringify(c);"undefined"!=typeof a&&!0===a?"undefined"==typeof b||!1===b||null===b?ioAdapter.send(c):
ioAdapter.sendUser(c,b):"undefined"==typeof b||!1===b||null===b?ioAdapter.mustSend(c):ioAdapter.mustSendUser(c,b)}},breakintobytes:function(c,b){c=c.toString();for(var a=c.length;a<b;a++)c="0"+c;return c.match(/[\S]{1,2}/g)||[]},createReclaimButton:function(c){this.createDiv("t_reclaim","educator",c);var b=this;document.getElementById("t_reclaim").getElementsByTagName("a")[0].addEventListener("click",function(){b._reclaimRole()})},createDiv:function(c,b,a,f){var g=b;b=virtualclass.lang.getString(b);
var d=document.createElement("a");d.href="#";var m=document.createElement("div");m.id=c;"undefined"!=typeof f&&(m.className=f);m.dataset.tool=g;f=document.createElement("span");f.className="icon-"+g;d.appendChild(f);d.dataset.title=b;d.className="tooltip";m.appendChild(d);"t_reclaim"==c?(c=document.getElementById("virtualclassAppLeftPanel"),a.appendChild(m),c.insertBefore(a,c.firstChild)):a.appendChild(m)},assignRole:function(c){if("object"==typeof virtualclass.wb){var b=virtualclass.wb[virtualclass.gObj.currWb].vcan;
virtualclass.wb[virtualclass.gObj.currWb].tool="";"move"==b.main.action&&virtualclass.wb[virtualclass.gObj.currWb].utility.deActiveFrmDragDrop()}if("undefined"!=typeof c){if(roles.isEducator()){var a=document.getElementById("commandToolsWrapper_doc_0_0");a.parentNode.removeChild(a);virtualclass.vutil.removeClass("virtualclassCont","educator")}else virtualclass.vutil.addClass("virtualclassCont","presenter");virtualclass.gObj.uRole=roles.hasAdmin()?"t":"p";localStorage.setItem("uRole",virtualclass.gObj.uRole);
virtualclass.user.assignRole(virtualclass.gObj.uRole,virtualclass.vutil.capitalizeFirstLetter(virtualclass.currApp),c);"object"==typeof virtualclass.wb&&b.utility.canvasCalcOffset(b.main.canid);"Yts"==virtualclass.currApp?(c=document.getElementById("virtualclassYts"),null!=c?null==document.getElementById("player")&&virtualclass.yts.UI.createPlayerTag(c):virtualclass.yts.UI.container(),virtualclass.yts.UI.inputURL(),"object"==typeof virtualclass.yts.player?virtualclass.yts.seekChangeInterval():console.log("Player object is not ready")):
"SharePresentation"==virtualclass.currApp&&(null!=document.getElementById("virtualclassSharePresentation")?null==document.getElementById("iframecontainer")&&virtualclass.sharePt.UI.createIframe():virtualclass.sharePt.UI.container(),roles.hasControls()&&virtualclass.sharePt.initTeacherLayout(),roles.hasView()&&(virtualclass.sharePt.eventsObj=[]),virtualclass.sharePt.attachEvent("submitpurl","click",virtualclass.sharePt.initNewPpt),virtualclass.sharePt.attachMessageEvent("message",virtualclass.sharePt.pptMessageEventHandler))}else{"Yts"==
virtualclass.currApp&&(virtualclass.yts.UI.removeinputURL(),virtualclass.yts.hasOwnProperty("tsc")&&clearInterval(virtualclass.yts.tsc));"SharePresentation"==virtualclass.currApp&&(roles.hasControls()&&virtualclass.sharePt.initStudentLayout(),roles.hasView()&&(virtualclass.sharePt.eventsObj=[],virtualclass.sharePt.hideElement("pptMessageLayout"),virtualclass.sharePt.UI.createUrlContainer(),virtualclass.sharePt.displayElement("urlcontainer")),virtualclass.sharePt.attachEvent("submitpurl","click",virtualclass.sharePt.initNewPpt),
virtualclass.sharePt.attachMessageEvent("message",virtualclass.sharePt.pptMessageEventHandler));virtualclass.gObj.uRole=roles.hasAdmin()?"e":"s";a=document.getElementById("commandToolsWrapper_doc_0_0");if(null!=a)for(;a.hasChildNodes();)a.removeChild(a.lastChild);else a=virtualclass.vutil.createRoleWrapper();"object"==typeof virtualclass.wb&&virtualclass.wb[virtualclass.gObj.currWb].utility.makeCanvasDisable();roles.hasAdmin()?(document.getElementById("virtualclassCont"),virtualclass.vutil.createReclaimButton(a),
virtualclass.vutil.addClass("virtualclassCont","educator")):(virtualclass.vutil.removeClass("virtualclassCont","presenter"),a=document.querySelector("#commandToolsWrapper_doc_0_0"),null!=a&&a.parentNode.removeChild(a));localStorage.setItem("uRole",virtualclass.gObj.uRole);"object"==typeof virtualclass.wb&&virtualclass.wb[virtualclass.gObj.currWb].utility.uniqueArrOfObjsToStudent()}virtualclass.system.setAppDimension();virtualclass.vutil.renderWhiteboardObjectsIfAny();roles.hasAdmin()?virtualclass.uInfo.userobj.role=
virtualclass.gObj.uRole:(io.disconnect(),setTimeout(function(){virtualclass.uInfo.userobj.role=virtualclass.gObj.uRole;io.init(virtualclass.uInfo)},500))},renderWhiteboardObjectsIfAny:function(){"object"==typeof virtualclass.wb&&0<virtualclass.wb[virtualclass.gObj.currWb].vcan.main.children.length&&virtualclass.wb[virtualclass.gObj.currWb].vcan.renderAll()},createCommandWrapper:function(c){var b=virtualclass.wb[c].vcan,a=document.createElement("div");a.id=virtualclass.gObj.commandToolsWrapperId[c];
a.className="commandToolsWrapper";b=document.getElementById(b.canvasWrapperId);null!=b?document.getElementById("containerWb"+c).insertBefore(a,b):document.getElementById("containerWb"+c).appendChild(a);return a},createRoleWrapper:function(){var c=document.createElement("div");c.id="commandToolsWrapper_doc_0_0";c.className="commandToolsWrapper";return c},_reclaimRole:function(){virtualclass.vutil.beforeSend({reclaimRole:!0,cf:"reclaimRole"});var c=document.getElementById("t_reclaim");c.style.pointerEvents=
"none";c.style.opacity="0.5";var b=this;setTimeout(function(){b.reclaimRole();virtualclass.user.control.changeAttrToAssign("enable")},2E3)},reclaimRole:function(){virtualclass.gObj.controlAssign=!1;this.vcResponseAssignRole(virtualclass.gObj.uid,virtualclass.gObj.uid,!0)},vcResponseAssignRole:function(c,b,a){if(c!=b||"undefined"!=typeof a)if(virtualclass.vutil.assignRole(b),"object"==typeof virtualclass.wb&&virtualclass.wb[virtualclass.gObj.currWb].utility.uniqueArrOfObjsToTeacher(),roles.hasAdmin())c=
document.getElementById("chat_div").getElementsByClassName("currTeacher")[0],null!=c&&virtualclass.user.control.removeCurrTeacherFromControl(c.id),virtualclass.user.control.changeAttrToAssign("enable");else{virtualclass.vutil.removeSessionTool();b=document.getElementById("ml"+c);a=["assign"];var f=document.getElementById(c+"ControlContainer");null!=f?virtualclass.user.createAssignControl(f,c,!0):(a=virtualclass.user.createControl(c,a),b.appendChild(a));localStorage.setItem("aId",c)}virtualclass.vutil.attachClickOutSideCanvas();
"mobTab"==virtualclass.system.device&&(virtualclass.vutil.disableVirtualClass(),virtualclass.view.createErrorMsg(virtualclass.lang.getString("supportDesktop"),"errorContainer","chatWidget"))},vcResponseAReclaimRole:function(c,b){console.log("Reclaim role :- Init");if(c!=b){if("object"==typeof virtualclass.wb){var a=virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs[virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs.length-1];if("object"==typeof a&&"del"==a.ac)console.log("Delete command:- Transferring the delete command"),
virtualclass.vutil.beforeSend({repObj:[a],cf:"repObj"});else if("t_text"==virtualclass.wb[virtualclass.gObj.currWb].tool.cmd&&"create"==virtualclass.wb[virtualclass.gObj.currWb].vcan.main.action)virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.finalizeTextIfAny(!0),console.log("Text command:- Transferring text command");else if(virtualclass.wb[virtualclass.gObj.currWb].tool.hasOwnProperty("started")&&1==virtualclass.wb[virtualclass.gObj.currWb].tool.started||"move"==virtualclass.wb[virtualclass.gObj.currWb].vcan.main.action)a=
vcan.extend({},virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs[virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs.length-1]),a.ac="u",a=a.hasOwnProperty("mtext")?{detail:{cevent:{x:a.x,y:a.y,mtext:a.mtext}}}:{detail:{cevent:{x:a.x,y:a.y}}},a.detail.broadCast=!0,a=new CustomEvent("mouseup",a),vcan.main.canvas.dispatchEvent(a),console.log("Whiteboard:- Transfering the assign role to Teacher");console.log("Role assign with reclaim")}virtualclass.user.control._assign(b,"notsent",
c);console.log("Reclaim role :- peforme");virtualclass.user.displayStudentSpeaker(!0);null!=localStorage.getItem("aId")&&localStorage.removeItem("aId");virtualclass.user.control.removeAudioFromParticipate(c);"mobTab"==virtualclass.system.device&&((virtualclass.system.mybrowser.name=8<=virtualclass.system.mybrowser.version)&&/(iPad)/g.test(navigator.userAgent)&&virtualclass.vutil.enableVirtualClass(),virtualclass.view.removeErrorMsg("errorContainer",!0))}},createReclaimButtonIfNeed:function(){if(roles.isEducator()){var c=
virtualclass.vutil.createRoleWrapper();virtualclass.vutil.createReclaimButton(c);return!0}return!1},whoIsTeacher:function(){if(virtualclass.hasOwnProperty("connectedUsers"))for(var c=0;c<virtualclass.connectedUsers.length;c++)if("t"==virtualclass.connectedUsers[c].role||"e"==virtualclass.connectedUsers[c].role)return virtualclass.connectedUsers[c].userid;return 0},enablePresentatorEditors:function(c){c={toUser:c,status:!0};virtualclass.user.control.received_editorRich(c);virtualclass.user.control.received_editorCode(c)},
getClassName:function(c){var b;"t"==c?b="teacher":"e"==c?b="educator":"s"==c?b="student":"p"==c&&(b="presenter");return b},isPresenterExist:function(){for(var c=0;c<virtualclass.connectedUsers.length;c++)if("p"==virtualclass.connectedUsers[c].role)return!0;return!1},setReadModeWhenTeacherIsDisConn:function(c){if(!roles.hasAdmin()){var b=localStorage.getItem("oTDisconn");null!=b&&((b=JSON.parse(b))?virtualclass.hasOwnProperty(c)?"object"==typeof virtualclass[c].cm?virtualclass[c].cm.setOption("readOnly",
"nocursor"):console.log("Editor CM is notvutil defined for editor "+c):console.log("Editor type "+c+" is not ready."):console.log("Teacher is connected."))}},setReadModeWhenTeacherIsConn:function(c){localStorage.removeItem("oTDisconn");var b=document.getElementById(virtualclass.vutil.capitalizeFirstLetter(c)+"writeModeBox");null!=b?"true"==b.getAttribute("data-write-mode")?virtualclass[c].cm.setOption("readOnly",!1):virtualclass[c].cm.setOption("readOnly","nocursor"):console.log("Editor:- writemode element is not found for "+
c)},isTeacherAlreadyExist:function(c){if(virtualclass.hasOwnProperty("connectedUsers"))for(var b=0;b<virtualclass.connectedUsers.length;b++)if(("t"==virtualclass.connectedUsers[b].role||"e"==virtualclass.connectedUsers[b].role)&&virtualclass.connectedUsers[b].userid!=c)return console.log("joni Id "+c),!0;return!1},isPresenterAlreadyExist:function(c){if(virtualclass.hasOwnProperty("connectedUsers"))for(var b=0;b<virtualclass.connectedUsers.length;b++)if("p"==virtualclass.connectedUsers[b].role&&virtualclass.connectedUsers[b].userid!=
c)return console.log("joniId "+c),!0;return!1},getPresenterId:function(){if(virtualclass.hasOwnProperty("connectedUsers"))for(var c=0;c<virtualclass.connectedUsers.length;c++)if("p"==virtualclass.connectedUsers[c].role)return virtualclass.connectedUsers[c].userid;return!1},isEducatorAlreadyExist:function(c){if(virtualclass.hasOwnProperty("connectedUsers"))for(var b=0;b<virtualclass.connectedUsers.length;b++)if("e"==virtualclass.connectedUsers[b].role&&virtualclass.connectedUsers[b].userid!=c)return console.log("joniId "+
c),!0;return!1},isOrginalTeacherExist:function(c){if(virtualclass.hasOwnProperty("connectedUsers"))for(var b=0;b<virtualclass.connectedUsers.length;b++)if("t"==virtualclass.connectedUsers[b].role&&virtualclass.connectedUsers[b].userid!=c)return console.log("joniId "+c),!0;return!1},getMySetTime:function(c){for(var b=0;b<c.length;b++)if(c[b].userid==virtualclass.gObj.uid)return 180*(b+1)+2E3;return 2300},createBecomeTeacherWidget:function(){if(null==document.getElementById("beTeacher")){var c=document.createElement("div");
c.id="beTeacher";var b=document.createElement("a");b.id=c.id+"Anchor";b.innerHTML=virtualclass.lang.getString("becomeTeacher");c.appendChild(b);b=document.getElementById("virtualclassCont");b.insertBefore(c,b.firstChild);c.addEventListener("click",virtualclass.vutil.initTeacherRole);c.style.pointerEvents="none";c.style.opacity="0.5";setTimeout(function(){c.style.pointerEvents="visible";c.style.opacity="1"},6E4)}},removeBecomeTeacherWidget:function(){var c=document.getElementById("beTeacher");null!=
c&&c.parentNode.removeChild(c)},initTeacherRole:function(){ioAdapter.send({cf:"bt"});virtualclass.vutil.removeBecomeTeacherWidget();setTimeout(function(){virtualclass.vutil.isOrginalTeacherExist(virtualclass.jId)?console.log("Already connected teacher"):(virtualclass.vutil.overrideRoles("t"),localStorage.setItem("beTeacher",!0),console.log("connected teacher"));d.location.reload()},virtualclass.gObj.mySetTime)},overrideRoles:function(c){virtualclass.uInfo.userobj.role=c;virtualclass.gObj.uRole=virtualclass.uInfo.userobj.role;
wbUser.role=virtualclass.uInfo.userobj.role;var b=document.getElementById("virtualclassCont");virtualclass.vutil.overrideRolesFromElem(b,c)},overrideRolesFromElem:function(c,b){"s"==b?(c.classList.remove("teacher"),c.classList.remove("orginalTeacher"),c.classList.remove("presenter"),c.classList.remove("educator"),virtualclassCont.classList.add("student")):"p"==b?(c.classList.remove("teacher"),c.classList.remove("orginalTeacher"),c.classList.remove("educator"),virtualclassCont.classList.add("student"),
virtualclassCont.classList.add("presenter")):"e"==b?(c.classList.add("teacher"),c.classList.remove("student"),c.classList.remove("presenter"),c.classList.add("educator"),c.classList.add("orginalTeacher")):"t"==b&&(c.classList.remove("student"),c.classList.remove("educator"),c.classList.remove("presenter"),c.classList.add("teacher"),c.classList.add("orginalTeacher"),console.log("add Teacher"))},sesionEndMsgBoxIsExisting:function(){var c=document.getElementById("sessionEndMsgCont");return c.hasAttribute("data-displaying")&&
"true"==c.dataset.displaying},removeVideoHostContainer:function(){var c=document.getElementById("videoHostContainer");null!=c&&c.parentNode.removeChild(c)},createDummyUser:function(){var c=[],b=1,a=setInterval(function(){if(15<b)clearInterval(a);else{c.push({img:"https://local.vidya.io/congrea_te/images/quality-support.png",name:"suman"+b,userid:3+b,role:"s"});var f={message:c};b++;memberUpdate(f,"added");virtualclass.gObj.video.updateVideoContHeight()}},1E3)},calculateChatHeight:function(){if(null!=
document.querySelector("#virtualclassCont")){var c=this.getVisibleHeightElem("#virtualclassCont")-340;console.log("Chat height "+c);return c}alert("There is no right side bar")},getVisibleHeightElem:function(c){var b=$(c);c=$(d).scrollTop();var a=c+$(d).height(),f=b.offset().top;b=f+b.outerHeight();return(b>a?a:b)-(f<c?c:f)},applyHeight:function(c){c=document.getElementById("virtualclassAppRightPanel");var b=this.getVisibleHeightElem("virtualclassCont");c.style.height=b!=nul1?b:d.innerHeight},insertIntoLeftBar:function(c){var b=
document.querySelector("#virtualclassApp #virtualclassAppLeftPanel");null!=b?b.appendChild(c):alert("Error:- There is no Element to insert it.")},getWhiteboardId:function(c){c=c.closest(".vcanvas");if(null!=c)return c.dataset.wbId;alert("doc element is null")},getElementOffset:function(c){var b=0,a=0;do b+=c.offsetTop||0,a+=c.offsetLeft||0,c=c.offsetParent;while(c);return{x:a,y:b}},updateCurrentDoc:function(c){virtualclass.gObj.currWb="_doc_"+c+"_"+c},getParentTag:function(c,b){return c.closest(b)},
attachEventToUploadTab:function(c,b,a){c=document.getElementById("newDocBtn");null!=c&&(c.removeEventListener("click",virtualclass.vutil._attachEventToUploadTab),c.addEventListener("click",virtualclass.vutil._attachEventToUploadTab))},_attachEventToUploadTab:function(){var c=document.querySelector("#DocumentShareDashboard .qq-upload-button-selector.qq-upload-button input");if(null!=c){if(c.click(),c=document.querySelector("#DocumentShareDashboard .qq-upload-list-selector.qq-upload-list"))c.style.display=
"block"}else alert("Element is null")},attachEventToUpload:function(c,b,a){c=document.getElementById("uploadVideo");null!=c&&c.addEventListener("click",function(){var a=document.querySelector("#VideoDashboard .qq-upload-button-selector.qq-upload-button input");null!=a?a.click():alert("Element is null")})},modalPopup:function(c,b){var a={};"video"==c?(0<$("#listvideo .linkvideo.playing").length&&(this.currPlaying=$("#listvideo .linkvideo.playing").attr("data-rid")),a.validation="avi flv wmv mov mp4 webm mkv vob ogv ogg drc mng qt yuv rm rmvb asf amv m4p m4v mpg mp2 mpeg mpe mpv m2v svi 3gp 3g2 mxf roq nsv f4v f4p f4a f4b".split(" "),
a.cb=virtualclass.videoUl.afterUploadVideo,a.cthis="video",a.maxSize=209715200,a.requesteEndPoint=d.webapi+"&methodname=file_save&live_class_id="+virtualclass.gObj.congCourse+"&status=1&content_type_id=2&user="+virtualclass.gObj.uid):(a.validation="doc docx txt html csv odt ott pdf ppt pptx pot pps xls xlsx xlt png jpg gif svg tiff rtf xpm".split(" "),a.cb=virtualclass.dts.onAjaxResponse,a.cthis="docs",a.maxSize=20971520,a.requesteEndPoint=d.webapi+"&methodname=congrea_image_converter&live_class_id="+
virtualclass.gObj.congCourse+"&status=1&content_type_id=1&user="+virtualclass.gObj.uid);a.multiple=!1;a.wrapper=document.getElementById(b[0]);virtualclass.fineUploader.uploaderFn(a);"video"!=c&&(c=document.querySelector("#DocumentShareDashboard #docsUploadMsz"),b=document.createElement("div"),c&&c.appendChild(b))},xhrSendWithForm:function(c,b,a){var f=new FormData,g;for(g in c)f.append(g,c[g]);c="undefined"==typeof b?d.webapi:d.webapi+"&methodname="+b+"&user="+virtualclass.gObj.uid;"undefined"!=typeof a?
virtualclass.xhr.sendFormData(f,c,a):virtualclass.xhr.sendFormData(f,c)},createSaveButton:function(){var c=document.createElement("div");c.id="tech_support_save";var b=document.createElement("span");b.innerHTML="Save Session";c.appendChild(b);return c},initTechSupportUi:function(){var c=document.querySelector("#virtualclassApp");if(null!=c){if(!virtualclass.isPlayMode)var b=this.createSaveButton();var a=this;b.addEventListener("click",function(){a.intiRecoringByTechSupport()});null!=b&&c.appendChild(b)}},
intiRecoringByTechSupport:function(){virtualclass.popup.confirmInput(virtualclass.lang.getString("savesessionTechSupport"),function(c){c&&(ioStorage.completeStorage(void 0,void 0,"sessionend"),setTimeout(function(){virtualclass.recorder.startUploadProcess()},300))})},setChatContHeight:function(c){},setChatHeight:function(c){},alreadyConnected:function(c){return 0<virtualclass.connectedUsers.length?0<virtualclass.connectedUsers.filter(function(b){return b.userid==c}).length:!1},UTCtoLocalTime:function(c){var b=
new Date(c);c=b.getHours();b="0"+b.getMinutes();return c+":"+b.substr(-2)},appIsForEducator:function(c){for(var b in virtualclass.apps)if(virtualclass.apps[b]==c)return!1;return!0},initDashboardNav:function(c){if(roles.hasControls()){var b=document.querySelector("#dashboardnav button");null==b&&(b=virtualclass.getTemplate("dashboardNav")({app:virtualclass.currApp}),document.querySelector("#virtualclassAppOptionsCont").insertAdjacentHTML("beforeend",b),b=document.querySelector("#dashboardnav button"),
null!=b&&(b.addEventListener("click",function(){this.classList.contains("clicked")?virtualclass.dashBoard.close():(virtualclass.vutil.initDashboard(virtualclass.currApp),this.classList.add("clicked"),virtualclass.dashBoard.dashBoardClickTooltip("close"),"DocumentShare"==virtualclass.currApp&&virtualclass.hasOwnProperty("dts")&&(virtualclass.dts.moveProgressbar(),null!=virtualclass.dts.docs.currNote&&virtualclass.dts.setCurrentNav(virtualclass.dts.docs.currNote)))}),c&&virtualclass.vutil.readyDashboard(c)));
"DocumentShare"==virtualclass.currApp?virtualclass.dts.noteExist()?(virtualclass.dts.isUploaderExist()||virtualclass.vutil.modalPopup("docs",["docsuploadContainer"]),document.getElementById("dashboardnav").setAttribute("data-title",virtualclass.lang.getString("DocumentSharedbHeading"))):this.readyDashboard():("Video"==virtualclass.currApp?"undefined"==typeof c&&this.readyDashboard():this.readyDashboard(),virtualclass.vutil.removeFinishBtn())}},readyDashboard:function(c){console.log("Ready Dashboard");
var b=virtualclass.currApp;if(null==document.querySelector("#congdashboard")){var a=virtualclass.getTemplate("dashboard")({app:b});document.querySelector("#dashboardContainer").innerHTML=a}if("DocumentShare"==b){var f=document.getElementById("dashboardnav");f.setAttribute("data-title",virtualclass.lang.getString("DocumentSharedbHeading"));if(null==document.querySelector("#"+b+"Dashboard")){a=document.createElement("div");var g=document.querySelector("#congdashboard .modal-body");g.appendChild(a);
a.id=b+"Dashboard"}(f=document.querySelector("#docsDbCont"))&&f.parentNode.removeChild(f);document.querySelector("#"+b+"Dashboard").innerHTML=this.getDocsDashBoard(b);virtualclass.dts.init();virtualclass.vutil.attachEventToUploadTab();virtualclass.dts.isUploaderExist()||virtualclass.vutil.modalPopup("docs",["docsuploadContainer"]);virtualclass.vutil.makeElementActive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery");virtualclass.vutil.makeElementActive("#listnotes")}else"Video"==
b?(document.getElementById("dashboardnav"),null==document.querySelector("#"+b+"Dashboard")&&(a=document.createElement("div"),g=document.querySelector("#congdashboard .modal-body"),g.appendChild(a),a.id=b+"Dashboard"),(b=document.querySelector("#videoPopup"))&&b.parentNode.removeChild(b),a=virtualclass.getTemplate("popup","videoupload")(),$("#VideoDashboard").append(a),virtualclass.videoUl.UI.popup(c),virtualclass.vutil.attachEventToUpload(),virtualclass.vutil.makeElementActive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery"),
virtualclass.vutil.makeElementActive("#listvideo"),c&&c.init.videoUrl&&(f=!0),b=document.querySelector("#dashboardnav button"),null==b||f||virtualclass.vutil.isDashboardOpened()||b.click()):"SharePresentation"==b&&(f=document.getElementById("dashboardnav"),f.setAttribute("data-title",virtualclass.lang.getString("SharePresentationdbHeading")),null==document.querySelector("#"+b+"Dashboard")&&(a=document.createElement("div"),g=document.querySelector("#congdashboard .modal-body"),g.appendChild(a),a.id=
b+"Dashboard"))},initDashboard:function(c,b){document.querySelector("#mainContainer");"SharePresentation"==c&&(document.querySelector("#pptDbCont")||(null==document.querySelector(".docsDbCont")&&(document.querySelector("#SharePresentationDashboard").innerHTML=virtualclass.vutil.getPptDashBoard("SharePresentation")),virtualclass.sharePt.attachEvent("submitpurl","click",virtualclass.sharePt.initNewPpt)),virtualclass.sharePt.ppts&&virtualclass.sharePt.ppts.length&&(virtualclass.sharePt.showPpts(virtualclass.sharePt.ppts),
virtualclass.sharePt.retrieveOrder()));for(var a=document.querySelectorAll("#congdashboard .dbContainer"),f=0;f<a.length;f++)a[f].style.display=a[f].dataset.app==virtualclass.currApp?"block":"none";console.log("Dashboard is created for "+virtualclass.currApp);"DocumentShare"==c?("undefined"==typeof b&&($("#congdashboard").modal(),virtualclass.dashBoard.clickCloseButton()),virtualclass.dts.noteExist()&&virtualclass.vutil.hideUploadMsg("docsuploadContainer")):"Video"==c?"undefined"==typeof b&&$("#congdashboard").modal():
$("#congdashboard").modal();virtualclass.dashBoard.actualCloseHandler();b=document.querySelector("#congdashboard .modal-header h4");null!=b&&(b.innerHTML=virtualclass.lang.getString(c+"dbHeading"))},getDocsDashBoard:function(c){var b=virtualclass.getTemplate("dashboard","documentSharing");c={app:c,hasControls:roles.hasControls()};return b(c)},getPptDashBoard:function(c){var b=virtualclass.getTemplate("dashboard","ppt");c={app:c,hasControls:roles.hasControls()};return b(c)},removeDashboardNav:function(){var c=
document.querySelector("#dashboardnav");null!=c&&c.parentNode.removeChild(c)},makeElementDeactive:function(c){console.log("drag drop Deactive element "+c);c=document.querySelector(c);null!=c&&(c.style.pointerEvents="none")},makeElementActive:function(c){console.log("drag drop Active element "+c);c=document.querySelector(c);null!=c&&(c.style.pointerEvents="visible")},initCommonSortingChat:function(){setTimeout(function(){sortCommonChat()},800)},triggerDashboard:function(c,b){"DocumentShare"==c?null==
document.querySelector("#screen-docs .note.current")&&("undefined"==typeof b?virtualclass.vutil.initDashboard(c):virtualclass.vutil.initDashboard(c,b)):"Video"==c?"undefined"==typeof b?virtualclass.vutil.initDashboard(c):virtualclass.vutil.initDashboard(c,b):virtualclass.vutil.initDashboard(c)},trimExtension:function(c){return c.replace(/\.[^/.]+$/,"")},hideUploadMsg:function(c){c=document.querySelector("#"+c+" .qq-uploader-selector.qq-uploader.qq-gallery");null!=c&&c.setAttribute("qq-drop-area-text",
"")},showUploadMsg:function(c){c=document.querySelector("#"+c+" .qq-uploader-selector.qq-uploader.qq-gallery");null!=c&&c.setAttribute("qq-drop-area-text",virtualclass.lang.getString("dropfilehere"))},audioStatus:function(c,b){var a=c.getElementsByClassName("congtooltip")[0];"true"==b?(c.setAttribute("data-audio-playing","true"),a.setAttribute("data-title",virtualclass.lang.getString("audioEnable")),c.className="audioTool active"):(c.setAttribute("data-audio-playing","false"),a&&a.setAttribute("data-title",
virtualclass.lang.getString("audioDisable")),c.className="audioTool deactive")},videoController:function(){var c=document.querySelector(".congrea .videoSwitchCont");c&&c.addEventListener("click",function(){virtualclass.vutil.videoHandler()})},videoHandler:function(){var c="main";var b=document.querySelector(".congrea .videoSwitchCont #videoSwitch");if(b.classList.contains("on")){b.classList.remove("on");b.classList.add("off");b="off";var a=document.querySelector(".videoSwitchCont");a.dataset.title=
"Video on";roles.hasControls()?virtualclass.videoHost.gObj.videoSwitch=0:(virtualclass.videoHost.gObj.stdStopSmallVid=!0,c="small");document.querySelector("#ml"+virtualclass.gObj.uid+" .user-details a .videoWrapper")?virtualclass.videoHost.setUserIcon(virtualclass.gObj.uid):virtualclass.gObj.delayVid="display";virtualclass.videoHost.UI.hideVideo(c)}else b.classList.remove("off"),b.classList.add("on"),b="on",a=document.querySelector(".videoSwitchCont"),a.dataset.title="Video off",roles.hasControls()?
virtualclass.videoHost.gObj.videoSwitch=1:(virtualclass.videoHost.gObj.stdStopSmallVid=!1,c="small"),document.querySelector("#ml"+virtualclass.gObj.uid+" .user-details a img")?virtualclass.videoHost.removeUserIcon(virtualclass.gObj.uid):virtualclass.gObj.delayVid="hide",virtualclass.videoHost.UI.displayVideo(c);virtualclass.gObj.meetingMode?virtualclass.multiVideo.disableVideo():virtualclass.gObj.uid==virtualclass.vutil.whoIsTeacher()&&ioAdapter.mustSend({congCtr:{videoSwitch:b},cf:"congController"});
roles.hasControls()||ioAdapter.mustSend({stdVideoCtr:{videoSwitch:virtualclass.videoHost.gObj.stdStopSmallVid},cf:"stdVideoCtrl"})},isChromeExtension:function(){d.postMessage({type:"isInstalled",id:1},"*");console.log("Chrome Extension:- Check");d.addEventListener("message",function(c){"yes"==c.data.type&&(virtualclass.gObj.chromeExt=!0);console.log("Chrome Extension:- is available")})},setWidth:function(c,b,a){b=document.querySelector("#canvas"+c);b.width=a},setHeight:function(c,b,a){b=document.querySelector("#canvas"+
c);b.height=a},getWidth:function(c){return c.width},getHeight:function(c){return c.height},getValueWithoutPixel:function(c){return parseInt(c,10)},removeDecimal:function(c){return c.toFixed(2)},getElemM:function(c,b){if("Y"==b)var a=document.querySelector("#"+c).offsetHeight;else"X"==b&&(a=document.querySelector("#"+c).offsetWidth);return this.getValueWithoutPixel(a)},getElemM2:function(c,b){if("Y"==b)var a=document.querySelector("#"+c).offsetHeight;else"X"==b&&(a=document.querySelector("#"+c).offsetWidth);
return this.getValueWithoutPixel(a)},getElemHeight:function(c){c=document.querySelector("#"+c).offsetHeight;return this.getValueWithoutPixel(c)},getElemWidth:function(c){c=document.querySelector("#"+c).offsetWidth;return this.getValueWithoutPixel(c)},visibleElementHeighOldt:function(c,b){var a=0;for(c=document.getElementById(c);c.offsetParent&&c.offsetParent.id!=b;)a+=c.offsetTop,c=c.offsetParent;return c.offsetHeight-a},elementIsVisible2:function(c){var b=c.getBoundingClientRect().top;c=c.getBoundingClientRect().bottom;
return 0<=b&&c<=d.innerHeight},elementIsVisible:function(c){c=c.getBoundingClientRect();var b=Math.max(document.documentElement.clientHeight,d.innerHeight);return!(0>c.bottom||0<=c.top-b)},getVisibleHeight:function(c){var b=$("#"+c);c=$(d).scrollTop();var a=c+$(d).height(),f=b.offset().top;b=f+b.outerHeight();return(b>a?a:b)-(f<c?c:f)},isNumeric:function(c){return!isNaN(parseFloat(c))&&isFinite(c)},setContainerDimension:function(c,b){},setDefaultScroll:function(){if(roles.hasControls()&&"Whiteboard"==
virtualclass.currApp||"DocumentShare"==virtualclass.currApp){var c=virtualclass.gObj.currWb;null!=c&&(virtualclass.pdfRender[c].canvasWrapper.scrollTop=1)}},createWhiteBoard:function(c){virtualclass.appInitiator.Whiteboard.apply(virtualclass,Array.prototype.slice.call(["Whiteboard","byclick",c]));var b=virtualclass.system.measureResoultion({width:d.innerWidth,height:d.innerHeight});virtualclass.system.setCanvasWrapperDimension(b,c)},createHashString:function(c){for(var b=0,a=c.length,f=0;f<a;f++)b=
31*b+c.charCodeAt(f),b&=b;return b},randomString:function(c){for(var b="";0<c;--c)b+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.round(61*Math.random())];return b},isBulkDataFetched:function(){return 0<virtualclass.serverData.rawData.video.length||0<virtualclass.serverData.rawData.docs.length||0<virtualclass.serverData.rawData.ppt.length},sendOrder:function(c,b,a){virtualclass.gObj.docOrder[c]=b;c={order:JSON.stringify(virtualclass.gObj.docOrder)};virtualclass.xhrn.sendData(c,
virtualclass.api.UpdateRoomMetaData,a)},requestOrder:function(c,b){virtualclass.xhrn.sendData({noting:!0},virtualclass.api.GetRoomMetaData,function(a){"Error"==a?console.log("page order retrieve failed"):(a=JSON.parse(a).Item,null!=a&&"undefined"!=typeof a&&void 0!=a&&a.order.S&&virtualclass.vutil.IsJsonString(a.order.S)&&(a=JSON.parse(a.order.S),virtualclass.gObj.docOrder=a,b(a[c])))})},IsJsonString:function(c){try{JSON.parse(c)}catch(b){return!1}return!0},removeChildrens:function(c){console.log("children selector "+
c);c=document.querySelectorAll(c);for(var b=0;b<c.length;b++)c[b].parentNode.removeChild(c[b])},initAcitveElement:function(){if("Video"==virtualclass.currApp)var c="#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery",b="#listvideo";else"DocumentShare"==virtualclass.currApp&&(c="#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery",b="#listdocs");var a=document.querySelector("#"+virtualclass.currApp+"Dashboard");null==a||a.classList.contains("uploading")?virtualclass.vutil.makeElementDeactive(c):
(virtualclass.vutil.makeElementActive(c),virtualclass.vutil.makeElementDeactive(b))},isResponseAvailable:function(c){return void 0!=c&&"undefined"!=c&&null!=c},navWhiteboard:function(c,b,a){virtualclass.vutil.isTextWrapperExist()&&virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.finalizeTextIfAny();virtualclass.gObj.hasOwnProperty("wbNav")&&clearTimeout(virtualclass.gObj.wbNav);virtualclass.gObj.wbNav=setTimeout(function(){"undefined"!=typeof a?b.call(c,a):b.call(c);console.log("whiteboard nav time"+
virtualclass.gObj.wbNavtime)},virtualclass.gObj.wbNavtime)},removeAllTextWrapper:function(){for(var c=document.querySelectorAll(".canvasWrapper .textBoxContainer"),b=0;b<c.length;b++)c[b].parentNode.removeChild(c[b])},isDashboardOpened:function(c){c=document.querySelector("#dashboardnav button");return null!=c&&c.classList.contains("clicked")},stopConnection:function(){io.webSocketConnected()&&io.sock.close();virtualclass.gObj.invalidlogin=!0},initDefaultApp:function(){var c=document.querySelector("#virtualclass"+
virtualclass.gObj.defaultApp+"Tool a");null!=c&&c.click(c)},initssSharing:function(c){virtualclass.gObj.whoIsSharing=c;c=document.getElementById(c+"contrstdscreenImg");null!=c&&c.setAttribute("data-dcolor","green")},removeSSsharing:function(){var c=document.querySelector("#chat_div .controleCont.ssSharing");null!=c&&c.classList.remove("ssSharing");delete virtualclass.gObj.whoIsSharing},informIamSharing:function(){var c=virtualclass.vutil.whoIsTeacher();roles.isStudent()&&virtualclass.gObj.studentSSstatus.mesharing&&
ioAdapter.mustSendUser({cf:"sshare_user"},c)},resizeWindowIfBigger:function(){var c=document.querySelector("#canvasWrapper"+virtualclass.gObj.currWb);null!=c&&60<d.innerWidth-(c.offsetWidth+320)&&(console.log("Resize event is triggered"),system.initResize())},isTextWrapperExist:function(){return 0<document.querySelectorAll(".canvasWrapper .textBoxContainer").length},insertAppLayout:function(c){$("#virtualclassAppContainer").append(c)},prechkScrnShare:function(){if(localStorage.getItem("precheck")){var c=
document.getElementById("preCheckcontainer");c.style.display="none";c=document.getElementById("virtualclassApp");c.style.display="block";virtualclass.videoHost._resetPrecheck()}else virtualclass.popup.waitMsg(),virtualclass.makeReadySocket(),c=document.getElementById("preCheckcontainer"),c.style.display="none",c=document.getElementById("virtualclassApp"),c.style.display="block",localStorage.setItem("precheck",!0),virtualclass.videoHost.afterSessionJoin();virtualclass.gObj.precheckScrn=!1},showFinishBtn:function(){var c=
document.querySelector(".congrea #dashboardContainer .modal-header button");c&&c.classList.add("enable");"DocumentShare"==virtualclass.currApp&&(c=document.querySelector("#virtualclassAppLeftPanel"),c.classList.add("showZoom"),c.classList.remove("hideZoom"))},removeFinishBtn:function(){var c=document.querySelector(".congrea.teacher  #dashboardContainer .modal-header button.enable");c&&c.classList.remove("enable");"DocumentShare"==virtualclass.currApp&&(c=document.querySelector("#virtualclassAppLeftPanel"),
c.classList.add("hideZoom"),c.classList.remove("showZoom"))},removeSharingClass:function(){var c=document.querySelector("#virtualclassCont");""!=c&&c.classList.remove("studentScreenSharing")},addNoteClass:function(){if(roles.isStudent()){var c=document.querySelector("#docScreenContainer");null!=c&&(c.classList.add("noteDisplay"),console.log("add note display"))}}}})(window);var globalImageData={},newCanvas;
(function(d){var c,b,a,f,g,h,m=function(a){var b=document.querySelector("#virtualclassScreenShareLocal"),c=document.querySelector("#virtualclassScreenShareLocalVideoNew");null==c&&(c=document.createElement("canvas"),c.id="virtualclassScreenShareLocalVideoNew",b.appendChild(c));c.width=a.width;c.height=a.height;0>=virtualclass.studentScreen.base.width&&(virtualclass.studentScreen.base.width=c.width,virtualclass.studentScreen.base.height=c.height);document.querySelector("#virtualclassScreenShareLocalVideoNew").getContext("2d").putImageData(a,0,
0);virtualclass.ss.localCont.save();virtualclass.ss.localCont.clearRect(0,0,d.innerWidth-300,d.innerHeight);virtualclass.ss.localCont.scale(virtualclass.studentScreen.scale,virtualclass.studentScreen.scale);virtualclass.ss.localCont.drawImage(c,0,0);virtualclass.ss.localCont.restore();"undefined"!=typeof stype&&(console.log("Screen type width "+c.width),console.log("Screen type height "+c.height))};d.Worker&&(sdworker.onmessage=function(a){if("drgb"==a.data.dtype){var b=globalImageData=a.data.globalImageData;
a.data.hasOwnProperty("stype")?(virtualclass.studentScreen.scale=1,virtualclass.studentScreen.base.width=0,virtualclass.studentScreen.setDimension(),m(b),virtualclass.studentScreen.fitToScreen()):m(b,"full")}});d.studentScreen=function(){return{scale:1,SCALE_FACTOR:1.04,szoom:!1,base:{width:0,height:0},ssProcess:function(a,b,c,f){var g=a[0];a=new Uint8ClampedArray(b);switch(g){case 102:case 202:g=virtualclass.vutil.numValidateTwo(a[1],a[2]);b=virtualclass.vutil.numValidateTwo(a[3],a[4]);a=a.subarray(5,
a.length);this.initStudentScreen(a,{w:g,h:b},c,f);break;case 103:case 203:this.drawImageThroughWorker(a);break;case 104:case 204:b=virtualclass.vutil.numValidateTwo(a[1],a[2]);g=virtualclass.vutil.numValidateTwo(a[3],a[4]);var d=virtualclass.vutil.numValidateTwo(a[5],a[6]);var h=virtualclass.vutil.numValidateTwo(a[7],a[8]);a=a.subarray(9,a.length);b={d:{w:b,h:g},vc:{w:d,h:h}};this.initStudentScreen(a,b,c,f)}},initStudentScreen:function(a,c,f,d){g=f;f=document.getElementById("virtualclass"+virtualclass.apps.ss);
"object"!=typeof virtualclass[g]||null==f?("undefined"!=typeof vtype&&(virtualclass.recorder.recImgPlay=!0),virtualclass.makeAppReady("ScreenShare")):("ScreenShare"!=virtualclass.currApp&&virtualclass.vutil.hidePrevIcon(g),virtualclass.currApp=d);if(c.hasOwnProperty("d"))virtualclass[g].dimensionStudentScreenResize(c),h=!0;else{if("undefined"==typeof h||"undefined"!=typeof b&&b!=c.w&&!c.hasOwnProperty("x"))h=!0,virtualclass[g].dimensionStudentScreen(c.w,c.h),b=c.w;!c.hasOwnProperty("w")||virtualclass[g].localCanvas.width==
c.w&&virtualclass[g].localCanvas.height==c.h||(virtualclass[g].localCanvas.width=c.w,virtualclass[g].localCanvas.height=c.h)}virtualclass[g].drawImages(a);virtualclass.previous=virtualclass[g].id;this.szoom||this.initZoom()},initZoom:function(){var a=virtualclass.getTemplate("zoomControl")({hasControls:roles.hasControls()}),b=document.querySelector("#virtualclass"+virtualclass.currApp);if(null!=b){b.insertAdjacentHTML("beforeend",a);a=document.querySelector("#virtualclass"+virtualclass.currApp+" .zoomIn");
b=document.querySelector("#virtualclass"+virtualclass.currApp+" .zoomOut");var c=document.querySelector("#virtualclass"+virtualclass.currApp+" .fitScreen");if(null!=a){var f=this;a.onclick=function(a){f.zoomIn()}}null!=b&&(f=this,b.onclick=function(){f.zoomOut()});null!=c&&(f=this,c.onclick=function(){f.fitToScreen()})}this.szoom=!0},zoomIn:function(){virtualclass.ss.localCanvas.width=+virtualclass.ss.localCanvas.width*this.SCALE_FACTOR;virtualclass.ss.localCanvas.height=+virtualclass.ss.localCanvas.height*
this.SCALE_FACTOR;this.scale*=this.SCALE_FACTOR;m(globalImageData);this.addScroll()},zoomOut:function(){this.scale/=this.SCALE_FACTOR;virtualclass.ss.localCanvas.width=1/this.SCALE_FACTOR*+virtualclass.ss.localCanvas.width;virtualclass.ss.localCanvas.height=1/this.SCALE_FACTOR*+virtualclass.ss.localCanvas.height;m(globalImageData);this.addScroll()},addScroll:function(){var a=virtualclass.ss.localCanvas.width,b=virtualclass.ss.localCanvas.parentNode.style.width;a=virtualclass.vutil.getValueWithoutPixel(a);
b=virtualclass.vutil.getValueWithoutPixel(b);a>b?virtualclass.ss.localCanvas.parentNode.classList.add("scrollX"):virtualclass.ss.localCanvas.parentNode.classList.remove("scrollX")},fitToScreen:function(){var a=this.setDimension();this.scale=virtualclass.ss.getScale(this.base.width,a.width);1<=this.scale?(this.scale=1,virtualclass.ss.localCanvas.width=globalImageData.width,virtualclass.ss.localCanvas.height=globalImageData.height):(virtualclass.ss.localCanvas.width=a.width,virtualclass.ss.localCanvas.height=
a.height);m(globalImageData);virtualclass.ss.localCanvas.parentNode.classList.remove("scrollX")},setDimension:function(){var a=this.getCanvasContainerDimension(),b=a.width;a=a.height;b=virtualclass.vutil.getValueWithoutPixel(b);a=virtualclass.vutil.getValueWithoutPixel(a);this.setCanvasContainerDimension(b,a);return{width:b,height:a}},getCanvasContainerDimension:function(){var a=document.querySelector("#virtualclass"+virtualclass.currApp),b=a.style.width,c=a.style.height;if(null==b||""==b||void 0==
b)b=a.offsetWidth;if(null==c||""==c||void 0==c)c=a.offsetHeight;b=virtualclass.vutil.getValueWithoutPixel(b)-40;c=virtualclass.vutil.getValueWithoutPixel(c);return{width:b,height:c}},setCanvasContainerDimension:function(a,b){var c=document.querySelector("#virtualclassScreenShareLocal");c.style.width=a+"px";c.style.height=b+"px"},drawImageThroughWorker:function(a){d.Worker&&sdworker.postMessage({data_pack:a,dtype:"drgbs"},[a.buffer])}}};d.screenShare=function(b){virtualclass.getSceenFirefox=function(){var a=
parseInt(d.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);33<=a?(virtualclass.adpt=new virtualclass.adapter,virtualclass.adpt.init(navigator).mediaDevices.getUserMedia({video:{mozMediaSource:"window",mediaSource:"window"}}).then(function(a){virtualclass.ss._init();if(roles.hasControls()&&!virtualclass.gObj.studentSSstatus.mesharing||virtualclass.gObj.studentSSstatus.mesharing){if(virtualclass.ss.initializeRecorder.call(virtualclass.ss,a),"undefined"==typeof err)var b=a.currentTime,c=d.setInterval(function(){a||
d.clearInterval(c);if(a.currentTime==b&&(d.clearInterval(c),a.onended))a.onended();b=a.currentTime},500)}else console.log("Set previous app as current app if teacher reclaim role during screen share"),virtualclass.ss.setCurrentApp()}).catch(function(a){virtualclass.ss.setCurrentApp();"string"==typeof a?"PERMISSION_DENIED"===a&&d.open("https://addons.mozilla.org/en-US/firefox/addon/ff_screenshare/").focus():"object"==typeof a&&("PermissionDeniedError"===a.name||"SecurityError"==a.name)&&d.open("https://addons.mozilla.org/en-US/firefox/addon/ff_screenshare/").focus()})):
alert(virtualclass.lang.getString("notSupportBrowser",[a]))};return{prevStream:!1,init:function(a){this.type=a.type;this.ssByClick=!0;this.manualStop=!1;!roles.hasControls()||virtualclass.recorder.recImgPlay||virtualclass.gObj.studentSSstatus.mesharing?roles.isStudent()&&virtualclass.gObj.studentSSstatus.mesharing?this.readyTostart(a.app):this._init():this.readyTostart(a.app)},_init:function(){this.currApp=this.tempCurrApp;document.getElementById("virtualclassCont").dataset.currapp=virtualclass.currApp;
virtualclass.previous!=b.id&&(document.getElementById(virtualclass.previous).style.display="none",virtualclass.previous=b.id);var a=document.getElementById(b.id);null!=a&&(a.style.display="block");this.hasOwnProperty("id")||(this.dc=virtualclass.dirtyCorner,this.postFix="Cont",this.id=b.hasOwnProperty("id")?b.id:"virtualclassScreenShare",this.className="virtualclass",this.label="Local",this.local=this.id+this.label,this.localTemp=this.id+this.label+"Temp",this.classes=b.hasOwnProperty("class")?b.classes:
"",this.initPrevImage(),a=document.getElementById(this.id),null!=a&&a.parentNode.removeChild(a),this.html.UI.call(this,virtualclass.gObj.uRole),(roles.hasControls()&&!virtualclass.recorder.recImgPlay&&!virtualclass.gObj.studentSSstatus.mesharing||roles.isStudent()&&virtualclass.gObj.studentSSstatus.mesharing)&&virtualclass.vutil.initLocCanvasCont(this.localTemp+"Video"))},readyTostart:function(a){a==virtualclass.apps.ss&&this.getScreen()},onError:function(a){virtualclass.previous?(virtualclass.currApp=
virtualclass.previous.split("virtualclass")[1],document.getElementById("virtualclassCont").dataset.currapp=virtualclass.currApp):virtualclass.hasOwnProperty("previousApp")&&"object"==typeof virtualclass.previousApp&&(virtualclass.currApp=virtualclass.previousApp.name,document.getElementById("virtualclassCont").dataset.currapp=virtualclass.currApp);("Video"==virtualclass.currApp||"SharePresentation"==virtualclass.currApp||"DocumentShare"==virtualclass.currApp)&&roles.hasControls()&&virtualclass.vutil.initDashboardNav();
console.log("Error "+a)},getScreen:function(a){"Chrome"==virtualclass.system.mybrowser.name?virtualclass.gObj.hasOwnProperty("ext")&&virtualclass.gObj.ext?d.postMessage({type:"getScreen",id:1},"*"):(virtualclass.vutil.beforeSend({ext:!0,cf:"raiseHand"}),chrome.webstore.install("https://chrome.google.com/webstore/detail/ijhofagnokdeoghaohcekchijfeffbjl",function(){d.location.reload()},function(a){virtualclass.gObj.chromeExt?"https:"!=location.protocol?(a=virtualclass.lang.getString("httpsmissing"),
virtualclass.popup.generalMsg(a)):virtualclass.popup.chromeExtMissing():virtualclass.vutil._inlineChomeExtensionStore()})):"Firefox"==virtualclass.system.mybrowser.name&&virtualclass.getSceenFirefox()},unShareScreen:function(){console.log("Unshare the screen");this.video.src="";this.localtempCont.clearRect(0,0,this.localtempCanvas.width,this.localtempCanvas.height);clearInterval(virtualclass.clear);this.initPrevImage();this.hasOwnProperty("currentStream")&&this.currentStream.getTracks()[0].stop();
virtualclass.vutil.beforeSend({unshareScreen:!0,st:this.type,cf:"unshareScreen"});this.clearScreenShare()},clearScreenShare:function(){console.log("Clear the screen");"undefined"!=typeof virtualclass.prevScreen&&virtualclass.prevScreen.hasOwnProperty("currentStream")&&delete virtualclass.prevScreen.currentStream;virtualclass.gObj.studentSSstatus.mesharing=!1;virtualclass.vutil.removeSharingClass();virtualclass.gObj.studentSSstatus.shareToAll=!1;virtualclass.gObj.studentSSstatus.sharing=!1;localStorage.setItem("studentSSstatus",
JSON.stringify(virtualclass.gObj.studentSSstatus));var a=document.querySelector("#virtualclassScreenShare");null!=a&&a.parentNode.removeChild(a);virtualclass.vutil.removeSSsharing();delete virtualclass.ss;virtualclass.hasOwnProperty("studentScreen")&&delete virtualclass.studentScreen;virtualclass.zoom.removeZoomController();virtualclass.ss=""},removeStream:function(){virtualclass.vutil.removeClass("audioWidget","fixed");this.localCont.clearRect(0,0,this.localCanvas.width,this.localCanvas.height);
this.clearScreenShare()},initializeRecorder:function(a){c=1;this.prevStream&&(this.ssByClick=!1);"undefined"!=typeof virtualclass.prevScreen&&virtualclass.prevScreen.hasOwnProperty("currentStream")&&virtualclass.prevScreen.unShareScreen();this.video=document.getElementById(this.local+"Video");this.videoSmall=document.getElementById(this.local+"Videosmall");if("VIDEO"!=this.video.tagName){var b=document.getElementById(this.local+"video");this.video.parentNode.replaceChild(b,this.video);this.video=
document.getElementById(this.local+"Video");this.video.autoplay=!0;virtualclass.vutil.initLocCanvasCont(this.local+"TempVideo")}this.currentStream=a;var f=this;virtualclass.adpt.attachMediaStream(this.video,a);virtualclass.adpt.attachMediaStream(this.videoSmall,a);this.prevStream=!0;this.currentStream.getVideoTracks()[0].onended=function(a){if(f.ssByClick){if(a=document.querySelector("#virtualclassScreenShareLocalSmall"))a.style.display="none";f.video.src="";f.localtempCont.clearRect(0,0,f.localtempCanvas.width,
f.localtempCanvas.height);clearInterval(virtualclass.clear);f.initPrevImage();f.clearScreenShare();virtualclass.vutil.beforeSend({unshareScreen:!0,st:f.type,cf:"unshareScreen"});console.log("Sending unshare screen with users "+virtualclass.gObj.totalUser);roles.hasControls()?virtualclass.gObj.hasOwnProperty("windowLoading")||virtualclass.vutil.initDefaultApp():(a=virtualclass.vutil.whoIsTeacher(),ioAdapter.mustSendUser({cf:"rmStdScreen"},a));f.prevStream=!1;f.prevScreen="";virtualclass.prevScreen=
"";console.log("Stop by clicking")}else f.ssByClick=!0};a={};a.width=d.innerWidth;a.height=d.innerHeight-140;b=document.getElementById(this.local);var g=this.html.getDimension(a);b.style.width=Math.round(g.width)+"px";b.style.height=Math.round(g.height)+"px";f=this;this.video.onloadedmetadata=function(){f.width=g.width;f.height=g.height;f.localtempCanvas.width=f.video.offsetWidth;f.localtempCanvas.height=f.video.offsetHeight;virtualclass.prevScreen=f;var a=virtualclass.system.measureResoultion({width:d.innerWidth,
height:d.innerHeight});f.sharing();virtualclass.vutil.setContainerWidth(a,virtualclass.currApp);roles.hasControls()&&(virtualclass.vutil.makeActiveApp(f.id,virtualclass.previrtualclass),"virtualclassYts"==virtualclass.previrtualclass&&virtualclass.yts.destroyYT());virtualclass.previrtualclass=f.id}},sharing:function(){function b(a,b){a=a.toString();for(var c=a.length;c<b;c++)a="0"+a;return a.match(/[\S]{1,2}/g)||[]}function g(){clearInterval(virtualclass.clear);if("undefined"!=typeof a&&"undefined"!=
typeof f){if(a!=p.video.offsetWidth||f!=p.video.offsetHeight)c=1}else a=p.video.offsetWidth,f=p.video.offsetHeight;1==c?setTimeout(m,2E3):n(p.type)}function h(a){switch(!0){case 300>=a||"undefined"==typeof a:B=300;break;case 3E3>=a:B=a;break;case 5E3>=a:B=3E3;break;default:B=5E3}}function m(){console.log("RESIZE");if(roles.hasControls()||virtualclass.gObj.studentSSstatus.mesharing){a=p.video.offsetWidth;f=p.video.offsetHeight;q=Math.round(p.localtempCanvas.height/12);w=Math.round(p.localtempCanvas.width/
12);var m=p.type;p.localtempCanvas.width=p.video.offsetWidth;p.localtempCanvas.height=p.video.offsetHeight;p.localtempCont.drawImage(p.video,0,0,p.video.offsetWidth,p.video.offsetHeight);var n=p.localtempCont.getImageData(0,0,p.localtempCanvas.width,p.localtempCanvas.height);n=p.dc.encodeRGB(n.data);var r=Math.round(p.localtempCanvas.width/w),t=Math.round(p.localtempCanvas.height/q);var A=p.getContainerDimension();if("undefined"!=typeof a&&"undefined"!=typeof f){var z=b(a,4);var v=b(f,4)}else z=b(p.video.offsetWidth,
4),v=b(p.video.offsetHeight,4);var K=b(A.width,4);A=b(A.height,4);m=new Uint8ClampedArray(["ss"==m?104:204,z[0],z[1],v[0],v[1],K[0],K[1],A[0],A[1]]);z=new Uint8ClampedArray(n.length+m.length);z.set(m);z.set(n,m.length);d.Worker&&sworker.postMessage({img:n,resize:1,resA:q,resB:w,dw:r,dh:t,offsetWidth:p.video.offsetWidth,offsetHeight:p.video.offsetHeight},[n.buffer]);virtualclass.vutil.informIamSharing();ioAdapter.sendBinary(z);h(z.length/128);c=0;clearInterval(virtualclass.clear);virtualclass.clear=
setInterval(g,B)}}function n(a){p.localtempCanvas.width=p.video.offsetWidth;p.localtempCanvas.height=p.video.offsetHeight;p.localtempCont.drawImage(p.video,0,0,p.video.offsetWidth,p.video.offsetHeight);a=Math.round(p.localtempCanvas.width/w);var b=Math.round(p.localtempCanvas.height/q),c=p.localtempCont.getImageData(0,0,p.video.offsetWidth,p.video.offsetHeight);d.Worker&&(sworker.postMessage({img:c.data,resA:q,resB:w,dw:a,dh:b,offsetWidth:p.video.offsetWidth,offsetHeight:p.video.offsetHeight,type:p.type},
[c.data.buffer]),sworker.onmessage=function(a){if(1==a.data.needFullScreen){a=virtualclass.getDataFullScreen(p.type);virtualclass.vutil.informIamSharing();ioAdapter.sendBinary(a);var b=a.length/128}else null!=a.data.masterSlice&&(ioAdapter.sendBinary(a.data.masterSlice),b=a.data.masterSlice.length/128);h(b);clearInterval(virtualclass.clear);virtualclass.clear=setInterval(g,B)});clearInterval(virtualclass.clear)}var q=Math.round(this.localtempCanvas.height/12),w=Math.round(this.localtempCanvas.width/
12),p=this;virtualclass.hasOwnProperty("wholeImage")&&clearInterval(virtualclass.wholeImage);virtualclass.hasOwnProperty("clear")&&clearInterval(virtualclass.clear);0==q&&0==w&&virtualclass.view.createErrorMsg("screensharereload","errorContainer","chatWidget");var B=1E3;virtualclass.getDataFullScreen=function(a){p.localtempCanvas.width=p.video.offsetWidth;p.localtempCanvas.height=p.video.offsetHeight;p.localtempCont.drawImage(p.video,0,0,p.video.offsetWidth,p.video.offsetHeight);var c=p.localtempCont.getImageData(0,
0,p.localtempCanvas.width,p.localtempCanvas.height);c=p.dc.encodeRGB(c.data);var f=b(p.localtempCanvas.height,4),g=b(p.localtempCanvas.width,4);a=new Uint8ClampedArray(["ss"==a?102:202,g[0],g[1],f[0],f[1]]);f=new Uint8ClampedArray(c.length+a.length);f.set(a);f.set(c,a.length);return f};clearInterval(virtualclass.clear);virtualclass.clear=setInterval(g,B)},getContainerDimension:function(){var a=document.getElementById(this.id+"Local");return{width:a.offsetWidth,height:a.offsetHeight}},drawImages:function(a){sdworker.postMessage({encodeArr:a,
cw:virtualclass.ss.localCanvas.width,ch:virtualclass.ss.localCanvas.height,dtype:"drgb"},[a.buffer])},dimensionStudentScreen:function(a,b){this.localCanvas=document.getElementById(virtualclass[g].local+"Video");this.localCont=virtualclass[g].localCanvas.getContext("2d");this.localCanvas.width=a;this.localCanvas.height=b;console.log("normal width "+this.localCanvas.width)},dimensionStudentScreenResize:function(a,b){this.hasOwnProperty("vac")||(this.vac=!0,this.localCanvas=document.getElementById(virtualclass[g].local+
"Video"),this.localCont=virtualclass[g].localCanvas.getContext("2d"));a.hasOwnProperty("d")&&(this.localCont.clearRect(0,0,this.localCanvas.width,this.localCanvas.height),this.localCanvas.width=a.d.w,this.localCanvas.height=a.d.h);a.hasOwnProperty("vc")&&(b=document.getElementById(virtualclass[g].local),b.style.width=a.vc.w+"px",b.style.height=a.vc.h+"px");"virtualclassScreenShare"==virtualclass.previous&&virtualclass.vutil.setScreenInnerTagsWidth(virtualclass.previous)},isAbleToScreenShare:function(){return roles.isStudent()&&
virtualclass.gObj.studentSSstatus.mesharing||roles.hasControls()&&!virtualclass.gObj.studentSSstatus.mesharing?!0:!1},html:{UI:function(a){a=virtualclass.ss.isAbleToScreenShare();var b=roles.hasControls(),c=virtualclass.recorder.recImgPlay;c=virtualclass.getTemplate("ssmainDiv")({control:a,recImg:c,scrctrl:b});virtualclass.vutil.insertAppLayout(c);b&&this.html.initScreenController();b=document.querySelector(".congrea #virtualclassApp");a?b.classList.remove("zoomCtrAdd"):b.classList.contains("zoomCtr")||
b.classList.add("zoomCtrAdd");if(roles.hasControls()&&virtualclass.gObj.studentSSstatus.mesharing){var f=this;setTimeout(function(){var a=document.querySelector("#screenController .share");virtualclass.gObj.studentSSstatus.shareToAll?(f.html.changeSsInfoSelf(a),a="sToAll"):(f.html.changeSsInfoShareToAll(a),a="sview");ioAdapter.mustSend({cf:a,firstSs:!0})},2E3);(a=document.querySelector("#virtualclassCont  #stopScreenShare"))&&a.addEventListener("click",function(){virtualclass.vutil.initDefaultApp();
ioAdapter.mustSendUser({cf:"stopSs"},virtualclass.gObj.whoIsSharing);var a=document.querySelector("#virtualclassCont.studentScreenSharing");a&&a.classList.remove("studentScreenSharing")})}},initScreenController:function(){var a=document.querySelector("#screenController .share");if(null!=a){var b=this;a.onclick=function(a){var c=a.currentTarget.classList;if(c.contains("selfView")){b.changeSsInfoSelf(a.currentTarget);var f="sToAll"}else c.contains("shareToAll")&&(b.changeSsInfoShareToAll(a.currentTarget),
f="sview");ioAdapter.mustSend({cf:f})}}},changeSsInfoSelf:function(a){a.classList.remove("selfView");a.classList.add("shareToAll");a.children[0].innerHTML=virtualclass.lang.getString("selfview");virtualclass.gObj.studentSSstatus.shareToAll=!0},changeSsInfoShareToAll:function(a){a.classList.remove("shareToAll");a.classList.add("selfView");a.children[0].innerHTML=virtualclass.lang.getString("sharetoall");virtualclass.gObj.studentSSstatus.shareToAll=!1},getDimension:function(a,b){return{height:a.height,
width:a.width}}},initPrevImage:function(){sworker.postMessage({initPrevImg:!0})},setCurrentApp:function(){virtualclass.hasOwnProperty("previousApp")&&"object"==typeof virtualclass.previousApp&&(virtualclass.currApp=virtualclass.previousApp.name,document.getElementById("virtualclassCont").dataset.currapp=virtualclass.currApp)},getScale:function(a,b){console.log("Screen type base width "+a);return b/a}}}})(window);(function(d){function c(a){document.body.removeChild(a.target)}var b,a={},f=1,g=1,h="VCE4 VCE5 VCE6 invalidcmid cmidmissing nomdlroot usermissing cnmissing sesseionkeymissing recorddatamissing keymissing invalidurl VCE2".split(" "),m={items:[],recImgPlay:!1,objn:0,playTimeout:"",totalSent:0,fileQueue:[],rnum:1,storeDone:0,emn:0,allFileFound:!1,waitServer:!1,waitPopup:!1,tempRecData:[],alreadyAskForPlay:!1,playStart:!1,error:0,mkDownloadLink:"",tillPlayTime:0,getPlayTotTime:!1,importfilepath:d.importfilepath,
exportfilepath:d.exportfilepath,sessionKey:randomString(11),alreadyDownload:!1,smallData:!1,uploadInProcess:!1,init:function(a){if("object"==typeof virtualclass.wb)var c=virtualclass.wb[virtualclass.gObj.currWb].vcan;if("undefined"!=typeof myfunc)this.objs=c.getStates("replayObjs");else{var f=this;if("fromplay"==a)virtualclass.storage.getAllObjs(["allData"],function(){f.play()});else{c=this.hasOwnProperty("prvNum")?this.prvNum:0;for(var g=0;g<a.length;g++)this.items.push(a[g]);for(k=0;k<a.length;k++){if(a[k].hasOwnProperty("bd"))for("a"==
a[k].bd?b=virtualclass.dtCon.base64DecToArrInt(a[k].recObjs):"c"==a[k].bd&&(b=virtualclass.dtCon.base64DecToArrclm(a[k].recObjs)),this.items[c].recObjs=b,g=0;g<b.length;g++)this.items[c].recObjs[g]=b[g];c++}this.hasOwnProperty("prvNum")||f.play();this.prvNum=c}}},initMakeAvailDownloadFile:function(){virtualclass.gObj.downloadProgress=!0;virtualclass.recorder.dataCame=setTimeout(function(){virtualclass.recorder.hasOwnProperty("recordDone")&&(virtualclass.recorder.alreadyDownload||(console.log("Recorder:- From Interval"),
virtualclass.recorder.makeAvailDownloadFile()),clearTimeout(virtualclass.recorder.dataCame))},1500)},replayFromStart:function(){var a=this.items;virtualclass.storage.config.endSession();virtualclass.popup.closeElem();disCommonChatInput();this.recImgPlay=!1;this.objn=0;this.playTimeout="";this.totalSent=0;this.fileQueue=[];this.rnum=1;this.emn=this.storeDone=0;this.waitPopup=this.waitServer=!1;this.tempRecData=[];this.playStart=this.alreadyAskForPlay=!1;this.error=0;this.mkDownloadLink="";this.tillPlayTime=
0;this.getPlayTotTime=!1;this.controller.ff=1;this.items=a;this.playProgressBar();this.play()},startUploadProcess:function(){virtualclass.recorder.startUpload=!0;virtualclass.recorder.uploadInProcess=!0;virtualclass.recorder.exportData(function(){});virtualclass.popup.sendBackOtherElems()},exportData:function(a){virtualclass.popup.openProgressBar();virtualclass.recorder.items=[];virtualclass.storage.getAllObjs(["allData"],function(){"function"==typeof a&&a()})},convertInto:function(a){if("string"==
typeof a.data)return a;a.data=a.data.buffer;return a},clearPopups:function(){virtualclass.popup.closeElem();virtualclass.pbar.renderProgressBar(0,0,"progressBar","progressValue");virtualclass.storage.config.endSession()},playProgressBar:function(){this.getPlayTotTime||(this.totPlayTime=this.items.reduce(function(a,b){return b.hasOwnProperty("playTime")?{playTime:a.playTime+b.playTime}:a.playTime}),this.getPlayTotTime=!0);if(0<this.tillPlayTime){this.tillPlayTime>this.totPlayTime&&(this.tillPlayTime=
this.totPlayTime);virtualclass.pbar.renderProgressBar(this.totPlayTime,this.tillPlayTime,"playProgressBar",void 0);var a=this.convertIntoReadable(this.tillPlayTime);document.getElementById("tillRepTime").innerHTML=a.m+" : "+a.s;"undefined"==typeof alreadyCalcTotTime&&(a=this.convertIntoReadable(this.totPlayTime),document.getElementById("totalRepTime").innerHTML=a.m+" : "+a.s,alreadyCalcTotTime=!0)}else virtualclass.pbar.renderProgressBar(this.totPlayTime,0,"playProgressBar",void 0)},convertIntoReadable:function(a){a/=
1E3;return{s:Math.floor(a%60),m:Math.floor(a/60)}},xhrsenddata:function(a,b,c){"undefined"!=typeof b&&(virtualclass.recorder.error=1);"undefined"!=typeof c&&(virtualclass.recorder.mkDownloadLink=c);if(1!=virtualclass.recorder.storeDone){"undefined"!=typeof earlierTimeout&&clearTimeout(earlierTimeout);if("undefined"==typeof a||""==a)a="first";virtualclass.recorder.rnum=a;virtualclass.storage.getrowData(["chunkData"],function(a,b){1==g&&a.hasOwnProperty("rdata")&&(virtualclass.recorder.rdlength=a.rdata.length);
if("string"==typeof a||"undefined"==typeof a)earlierTimeout=setTimeout(function(){virtualclass.recorder.xhrsenddata(virtualclass.recorder.rnum)},1E3);else if(a.hasOwnProperty("status")&&"done"==a.status)console.log("should invoked download function on "),virtualclass.recorder.storeDone=1,console.log("From here actuall recorder finished"),"undefined"!=typeof virtualclass.recorder.mkDownloadLink&&""!=virtualclass.recorder.mkDownloadLink?virtualclass.recorder.mkDownloadLink():setTimeout(function(){virtualclass.recorder.afterRecording()},
1E3);else if("undefined"!=typeof b&&(virtualclass.recorder.rnum=b),1==virtualclass.recorder.error)0==virtualclass.recorder.storeDone&&(virtualclass.recorder.xhrsenddata(virtualclass.recorder.rnum,"error"),virtualclass.recorder.rnum++);else{b=new FormData;b.append("record_data",JSON.stringify(a));b.append("user",virtualclass.gObj.uid);b.append("cn",g);b.append("sesseionkey",virtualclass.recorder.sessionKey);virtualclass.recorder.items=[];var c=roles.isStudent()&&virtualclass.gObj.has_ts_capability?
"https://local.vidya.io/fake.php":this.importfilepath;virtualclass.xhr.send(b,c,function(b){if("done"===b)virtualclass.pbar.renderProgressBar(a.totalStore,a.totalSent,"progressBar","progressValue"),virtualclass.recorder.rnum++,g++,virtualclass.recorder.xhrsenddata(virtualclass.recorder.rnum);else if("ERROR"===b)virtualclass.recorder.initMakeAvailDownloadFile();else if(0<=h.indexOf(b)){var c=document.querySelector("#totProgressCont"),f=document.querySelector("#totProgressCont .recordingError");null==
f?(b="<div class='recordingError'>"+virtualclass.lang.getString(b)+"</div>",c.insertAdjacentHTML("afterbegin",b)):f.innerHTML=virtualclass.lang.getString(b);roles.hasAdmin()&&virtualclass.recorder.initMakeAvailDownloadFile()}else console.log("Error message not found")})}},virtualclass.recorder.rnum)}},uploadFinishedBox:function(){document.getElementById("recordFinishedMessageBox").style.display="block";this.initRecordFinishEvent("recordingClose")},initRecordFinishEvent:function(a){var b=document.getElementById("recordingHeader");
b.innerHTML="";b.parentNode.classList.add("removeHeader");virtualclass.recorder.doSessionClear=!0;document.getElementById(a).addEventListener("click",function(){virtualclass.recorder.uploadInProcess=!1;setTimeout(function(){delete virtualclass.recorder.doSessionClear;document.getElementById("progressContainer").style.display="block";document.getElementById("recordFinishedMessageBox").style.display="none";b.innerHTML=virtualclass.lang.getString("uploadsession");b.parentNode.classList.remove("removeHeader");
virtualclass.recorder.startNewSessionAfterFinish();console.log("Socket "+io.sock.readyState);virtualclass.popup.closePopup();io.disconnect();setTimeout(function(){1!=io.sock.readyState&&io.wsconnect()},1500)},300)})},startNewSessionAfterFinish:function(){var a=document.getElementById("recordingContainer");a.classList.add("recordingFinished");console.log("Record :- after recording");virtualclass.clearSession();virtualclass.pbar.renderProgressBar(0,0,"progressBar","progressValue");virtualclass.pbar.renderProgressBar(0,
0,"indProgressBar","indProgressValue");a.classList.remove("recordingFinished")},afterRecording:function(){g=1;virtualclass.recorder.rdlength=0;document.getElementById("progressContainer").style.display="none";virtualclass.recorder.uploadFinishedBox()},makeAvailDownloadFile:function(){console.log("Recorder:- DOWNLLOAD MESSAGE");var a=document.getElementById("recordingContainer");a=d.getComputedStyle(a).display;"none"!=a&&"block"==a||setTimeout(function(){virtualclass.popup.openProgressBar();io.disconnect()},
3E3);var b=document.getElementById("downloadFileCont");null==b&&(b=document.createElement("div"),b.id="downloadFileCont");var f=document.createElement("div");f.id="errormsessage";f.innerHTML=virtualclass.lang.getString("msgForDownloadStart");var g=document.getElementById("progressContainer");g.style.display="none";b.appendChild(f);document.querySelector("#recordingContainer .rv-vanilla-modal-body").appendChild(b);this.alreadyDownload=!0;var h=this;virtualclass.storage.getAllDataForDownload(["chunkData"],
function(a){virtualclass.gObj.saveSession=!0;var m=document.createElement("button");m.id="downloadButton";m.className="cgText";m.innerHTML=virtualclass.lang.getString("downloadFile");var n=document.createElement("a");n.id="dlink";n.href="";n.download="session.vcp";n.innerHTML=virtualclass.lang.getString("download");roles.isStudent()&&virtualclass.gObj.has_ts_capability?f.innerHTML=virtualclass.lang.getString("filetsaveTS"):f.innerHTML=virtualclass.lang.getString("filenotsave");b.appendChild(m);var p=
document.getElementById("recordingHeader");p.innerHTML=virtualclass.lang.getString("downloadFile");var r=new Blob([a],{type:"application/virtualclass"});virtualclass.hasOwnProperty("prevScreen")&&virtualclass.prevScreen.hasOwnProperty("currentStream")&&virtualclass.prevScreen.unShareScreen();m.addEventListener("click",function(){null!=d.webkitURL?n.href=d.webkitURL.createObjectURL(r):(n.href=d.URL.createObjectURL(r),n.onclick=c,document.body.appendChild(n));n.click();p=document.getElementById("recordingHeader");
p.innerHTML=virtualclass.lang.getString("uploadsession");b.parentNode.removeChild(b);g.style.display="block";virtualclass.recorder.hasOwnProperty("dataCame")&&clearTimeout(virtualclass.recorder.dataCame);delete virtualclass.gObj.saveSession;virtualclass.gObj.has_ts_capability?(h.alreadyDownload=!1,virtualclass.recorder.hasOwnProperty("startUpload")&&delete virtualclass.recorder.startUpload,virtualclass.gObj.hasOwnProperty("downloadProgress")&&delete virtualclass.gObj.downloadProgress,virtualclass.recorder.storeDone=
0,virtualclass.popup.closeElem()):(virtualclass.clearSession(),io.disconnect(),io.init(virtualclass.uInfo));virtualclass.popup.closePopup()})})},sendDataToServer:function(){virtualclass.storage.db.transaction(["chunkData"],"readwrite").objectStore("chunkData").clear();virtualclass.popup.waitBlockAction("none");d.Worker&&(mvDataWorker.postMessage({rdata:virtualclass.recorder.items,makeChunk:!0}),mvDataWorker.onmessage=function(a){a.data.hasOwnProperty("done_problem")?console.log("done problem"):a.data.hasOwnProperty("status")&&
"done"==a.data.status&&(console.log("Recorder:- done"),delete virtualclass.recorder.startUpload,virtualclass.recorder.recordDone=!0);virtualclass.storage.chunkStorage(a.data)})},displayWaitPopupIfNot:function(){0==this.waitPopup&&(virtualclass.popup.sendBackOtherElems(),document.getElementById("recordingContainer").style.display="none",virtualclass.popup.waitBlockAction("block"),virtualclass.pbar.renderProgressBar(0,0,"downloadProgressBar","downloadProgressValue"),virtualclass.popup.waitBlock(),this.waitPopup=
!0)},requestDataFromServer:function(a,b){this.displayWaitPopupIfNot(virtualclass.lang.getString("plswaitwhile"));var c=new FormData;c.append("prvfile",b);c.append("fileBundelId",a);b=getUrlVars(exportfilepath);b.hasOwnProperty("cmid")&&c.append("id",b.cmid);virtualclass.xhr.send(c,exportfilepath,function(b){virtualclass.recorder.sendToWorker(b,a)})},sendToWorker:function(a,b){d.Worker&&(mvDataWorker.postMessage({rdata:a,getData:!0}),mvDataWorker.onmessage=function(a){f++;var c=virtualclass.recorder.isUptoBaseValue(a.data.alldata.totalSent,
a.data.alldata.totalStore,30);virtualclass.recorder.ctotalStore=a.data.alldata.totalStore;virtualclass.recorder.ctotalSent=a.data.alldata.totalSent;virtualclass.pbar.renderProgressBar(a.data.alldata.totalStore,a.data.alldata.totalSent,"downloadProgressBar","downloadProgressValue");c&&!virtualclass.recorder.alreadyAskForPlay?(a.data.alldata.totalSent>a.data.alldata.totalStore?virtualclass.recorder.askToPlay("completed"):virtualclass.recorder.askToPlay(),virtualclass.recorder.alreadyAskForPlay=!0,virtualclass.recorder.tempRecData.push(a.data.alldata.rdata)):
c&&virtualclass.recorder.playStart&&0==virtualclass.recorder.waitServer?virtualclass.recorder.init(a.data.alldata.rdata):(virtualclass.recorder.tempRecData.push(a.data.alldata.rdata),1==virtualclass.recorder.waitServer&&(virtualclass.recorder.alreadyPlayed=!0));a.data.alldata.rdata[a.data.alldata.rdata.length-1].hasOwnProperty("sessionEnd")?(console.log("Request file  Finished Here"),virtualclass.recorder.allFileFound=!0,1==virtualclass.recorder.waitServer&&(virtualclass.storage.config.endSession(),
a=virtualclass.recorder.tempRecData.reduce(function(a,b){return a.concat(b)}),virtualclass.recorder.objn=0,virtualclass.recorder.init(a),virtualclass.recorder.play(),virtualclass.recorder.waitServer=!1,virtualclass.popup.closeElem())):(console.log("request file"),virtualclass.recorder.requestDataFromServer(b,f))})},playInt:function(){var a=virtualclass.recorder.tempRecData.reduce(function(a,b){return a.concat(b)});virtualclass.popup.closeElem();virtualclass.recorder.init(a);virtualclass.recorder.playStart=
!0;virtualclass.recorder.tempRecData.length=0;localStorage.setItem("mySession","thisismyplaymode");virtualclass.recorder.initController()},askToPlay:function(a){"undefined"!=typeof a?document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("playsessionmsg"):document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("askplayMessage");document.getElementById("askPlay").style.display="block";a=document.getElementById("playButton");null!=a&&(a.style.display=
"block",a.addEventListener("click",this.playInt))},isUptoBaseValue:function(a,b,c){return a>=b*c/100?!0:!1},play:function(){if(0==this.objn){var b=document.getElementById("recPlay");this.doControlActive(b)}var c=this;this.controller.pause||("undefined"==typeof c.playTimeout&&""==c.playTimeout||clearTimeout(c.playTimeout),this.hasOwnProperty("playTime")||(this.playTime=this.items[0].playTime,a.data=JSON.parse(this.items[this.objn].recObjs),io.cfg=a.data,virtualclass.gObj.uRole="s"),"undefined"==typeof this.items[this.objn+
1]||this.items[this.objn].hasOwnProperty("sessionEnd")?(this.items[this.objn].hasOwnProperty("sessionEnd")||(a.data=this.items[this.objn].recObjs,io.onRecMessage(c.convertInto(a))),0==virtualclass.recorder.allFileFound?(virtualclass.recorder.waitServer=!0,virtualclass.recorder.waitPopup=!1,this.displayWaitPopupIfNot(),(virtualclass.recorder.hasOwnProperty("ctotalStore")||virtualclass.recorder.hasOwnProperty("ctotalSent"))&&virtualclass.pbar.renderProgressBar(virtualclass.recorder.ctotalStore,virtualclass.recorder.ctotalSent,
"downloadProgressBar","downloadProgressValue")):this.items[this.objn].hasOwnProperty("sessionEnd")&&(virtualclass.popup.replayWindow(),virtualclass.popup.sendBackOtherElems(),document.getElementById("replayClose").addEventListener("click",function(){d.close()}),document.getElementById("replayButton").addEventListener("click",function(){virtualclass.recorder.replayFromStart.call(virtualclass.recorder)}))):c.playTimeout=setTimeout(function(){var a={};a.data=c.items[c.objn].recObjs;try{io.onRecMessage(c.convertInto(a))}catch(z){console.log("PLAY ERROR "+
z.errorCode)}c.objn++;c.play.call(c);"object"==typeof c.items[c.objn]&&(c.playTime=c.items[c.objn].playTime/c.controller.ff,c.tillPlayTime+=c.playTime*c.controller.ff,c.allFileFound&&"object"==typeof c.items[c.objn+1]&&(c.playProgressBar(),virtualclass.popup.sendBackOtherElems()))},c.playTime))},initController:function(){if(null!=document.getElementById("playControllerCont")){for(var a=this,b=document.getElementsByClassName("ff"),c=0;c<b.length;c++)b[c].onclick=function(){var b=this.id.split("ff")[1];
a.controller.fastForward(parseInt(b,10));"replayFromStart"!=this.parentNode.id&&a.doControlActive(this)};document.getElementById("recPlay").addEventListener("click",function(){a.controller._play();a.doControlActive(this)});document.getElementById("recPause").addEventListener("click",function(){a.controller._pause();a.doControlActive(this)});document.getElementById("replayFromStart").addEventListener("click",function(){a.replayFromStart()})}},doControlActive:function(a){for(var b=document.getElementById("playControllerCont").getElementsByClassName("recButton"),
c=0;c<b.length;c++)b[c].classList.remove("controlActive");a.parentNode.classList.add("controlActive")},controller:{pause:!1,ff:1,_play:function(){this.ff=1;this.pause=!1;virtualclass.recorder.play()},_pause:function(){this.puase||(this.pause=!0)},fastForward:function(a){this.ff=a;this.pause=!1;virtualclass.recorder.play()}}};d.recorder=m})(window);
function randomString(d){for(var c="";0<d;--d)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.round(61*Math.random())];return c}function getUrlVars(d){for(var c=[],b=d.slice(d.indexOf("?")+1).split("&"),a=0;a<b.length;a++)d=b[a].split("="),c.push(d[0]),c[d[0]]=d[1];return c};(function(d){function c(a){"function"==typeof a&&(virtualclass.recorder.sendDataToServer(),setTimeout(function(){virtualclass.recorder.xhrsenddata()},100),a.apply(virtualclass.recorder))}var b,a=!1,f=!1;d.storage={dbVersion:6,sessionEndFlag:!1,init:function(a){this.reclaim=roles.isEducator();b=this;this.tables="wbData allData chunkData config dataAdapterAll dataUserAdapterAll executedStoreAll executedUserStoreAll dstdata pollStorage quizData dstall".split(" ");var c=d.indexedDB.open("vidya_apps",
b.dbVersion);c.onerror=function(a){console.log("Error opening db");console.dir(a);"InvalidStateError"==a.target.error.name&&alert(virtualclass.lang.getString("enablehistory"));indexedDB.deleteDatabase("vidya_apps").onsuccess=function(){b.init()}};c.onupgradeneeded=function(a){a=a.target.result;a.objectStoreNames.contains("wbData")||a.createObjectStore("wbData",{keyPath:"did"});a.objectStoreNames.contains("allData")||a.createObjectStore("allData",{autoIncrement:!0});a.objectStoreNames.contains("config")||
a.createObjectStore("config",{keyPath:"timeStamp",autoIncrement:!0});a.objectStoreNames.contains("chunkData")||a.createObjectStore("chunkData",{autoIncrement:!0});a.objectStoreNames.contains("dataAdapterAll")||a.createObjectStore("dataAdapterAll",{keyPath:"serialKey"});a.objectStoreNames.contains("dataUserAdapterAll")||a.createObjectStore("dataUserAdapterAll",{keyPath:"serialKey"});a.objectStoreNames.contains("executedStoreAll")||a.createObjectStore("executedStoreAll",{keyPath:"serialKey"});a.objectStoreNames.contains("executedUserStoreAll")||
a.createObjectStore("executedUserStoreAll",{keyPath:"serialKey"});a.objectStoreNames.contains("dstdata")||a.createObjectStore("dstdata",{keyPath:"timeStamp",autoIncrement:!0});a.objectStoreNames.contains("pollStorage")||a.createObjectStore("pollStorage",{keyPath:"timeStamp",autoIncrement:!0});a.objectStoreNames.contains("quizData")||a.createObjectStore("quizData",{keyPath:"quizkey"});a.objectStoreNames.contains("dstall")||a.createObjectStore("dstall",{keyPath:"timeStamp",autoIncrement:!0})};c.onsuccess=
function(c){b.db=c.target.result;for(c=0;c<b.tables.length;c++)try{b.db.transaction([b.tables[c]],"readwrite")}catch(n){indexedDB.deleteDatabase("vidya_apps").onsuccess=function(){b.init()};return}(new Date).getTime();virtualclass.gObj.sessionClear?b.config.endSession(!0):(c=b.tables.indexOf("wbData"),c=-1<c?b.tables.slice(c+1):b.tables,b.getAllObjs(c,function(a){if("undefined"==typeof a)b.config.createNewSession();else{var c=a.createdDate;(108E5<(new Date).getTime()-c||a.room!=wbUser.room)&&b.config.endSession()}},
"allData"));b.db.onerror=function(a){console.dir(a.target)};a()}},store:function(a){b.db.transaction(["wbData"],"readwrite").objectStore("wbData").put({repObjs:a,did:virtualclass.gObj.currWb,id:1});return!1},pollStore:function(a){setTimeout(function(){var c=b.db.transaction(["pollStorage"],"readwrite");c.objectStore("pollStorage");console.log("poll result data length"+JSON.parse(a).length);c.objectStore("pollStorage").add({pollResult:a,currTime:(new Date).getTime(),id:1});return!1},500)},wbDataRemove:function(a){b.db.transaction(["wbData"],
"readwrite").objectStore("wbData").delete(a)},dataExecutedStoreAll:function(a,c){var f=b.db.transaction(["executedStoreAll"],"readwrite");f.objectStore("executedStoreAll");f.objectStore("executedStoreAll").put({executedData:a,id:6,serialKey:c});f.onerror=function(a){a.preventDefault()}},dataAdapterAllStore:function(a,c){var f=b.db.transaction(["dataAdapterAll"],"readwrite");f.objectStore("dataAdapterAll");f.objectStore("dataAdapterAll").put({adaptData:a,id:5,serialKey:c});f.onerror=function(a){a.preventDefault()}},
dataUserAdapterAllStore:function(a,c){var f=b.db.transaction(["dataUserAdapterAll"],"readwrite");f.objectStore("dataUserAdapterAll");f.objectStore("dataUserAdapterAll").put({adaptUserData:a,id:7,serialKey:c});f.onerror=function(a){a.preventDefault()}},dataExecutedUserStoreAll:function(a,c){var f=b.db.transaction(["executedUserStoreAll"],"readwrite");f.objectStore("executedUserStoreAll");f.objectStore("executedUserStoreAll").put({executedUserData:a,id:8,serialKey:c});f.onerror=function(a){a.preventDefault()}},
completeStorage:function(a,c,f,d){var g=b.db.transaction(["allData"],"readwrite");"undefined"!=typeof d?g.objectStore("allData").add({recObjs:"",sessionEnd:!0,id:3}):"undefined"==typeof f?g.objectStore("allData").add({recObjs:c,playTime:a,id:3}):g.objectStore("allData").add({recObjs:c,playTime:a,id:3,bd:f.type})},chunkStorage:function(a){console.log("Chunk Storage");var c=b.db.transaction(["chunkData"],"readwrite");a.id=4;c.objectStore("chunkData").add(a)},wholeStore:function(a,c,f){c.peTime=d.pageEnter;
a=JSON.stringify(c);c=(new Date).getTime();"undefined"!=typeof this.prevTime&&c==this.prevTime&&(c+=1);var g=b.db.transaction(["allData"],"readwrite");"undefined"==typeof f?g.objectStore("allData").add({recObjs:a,timeStamp:c,id:3}):g.objectStore("allData").put({recObjs:a,timeStamp:this.prevTime,id:3});this.wholeStoreData=a;this.prevTime=c},quizStorage:function(a,c){var f=b.db.transaction(["quizData"],"readwrite");f.objectStore("quizData");f.objectStore("quizData").put({qzData:c,quizkey:a})},displayData:function(){b.db.transaction(["virtualclass"],
"readonly").objectStore("virtualclass").openCursor().onsuccess=b.handleResult},getAllObjs:function(a,c,f,d){c="undefined"!=typeof c?c:"";for(var g=0;g<a.length;g++)b.db.transaction(a[g],"readonly").objectStore(a[g]).openCursor().onsuccess=function(c,g){if(a[c]!=f)return function(f){"function"==typeof g?"undefined"!=typeof d?b[a[c]].handleResult(f,g,d):"chunkData"!=a[c]&&"quizData"!=a[c]&&"pollStorage"!=a[c]&&b[a[c]].handleResult(f,g):"undefined"!=typeof d?b[a[c]].handleResult(f,void 0,d):b[a[c]].handleResult(f)}}(g,
c)},getAllDataForDownload:function(a,c){var f=[];b.db.transaction(a,"readonly").objectStore(a[0]).openCursor().onsuccess=function(a){(a=a.target.result)?(f.push(a.value),a.continue()):0<f.length?c(JSON.stringify(f)):console.log("No data fetched from indexedDb")}},getAllDataOfPoll:function(a,c){var f=!1;try{b.db.transaction(["pollStorage"],"readwrite"),f=!0}catch(r){setTimeout(function(){b.getAllDataOfPoll(a,c)},500)}if(f){var g=[];b.db.transaction(["pollStorage"],"readwrite").objectStore("pollStorage").openCursor().onsuccess=
function(a){(a=a.target.result)?(g.push(a.value),a.continue()):0<g.length?c(g):console.log("No data fetched from indexedDb")}}},getrowData:function(a,c,f){a=b.db.transaction(a,"readonly").objectStore(a[0]);if("string"==typeof f&&"first"==f)a.openCursor().onsuccess=function(a){(a=a.target.result)?c(a.value,a.key):c("No Such Row")};else{var g=a.get(f);g.onerror=function(a){return"No Such Row"};g.onsuccess=function(a){c(g.result)}}},wbData:{handleResult:function(a,b){(a=a.target.result)?(a.value.hasOwnProperty("repObjs")&&
("object"==typeof virtualclass.wb?(console.log("Total Whiteboard Length "+JSON.parse(a.value.repObjs).length+" From indexeddb"),virtualclass.wb[virtualclass.gObj.currWb].utility.replayFromLocalStroage(JSON.parse(a.value.repObjs))):virtualclass.gObj.tempReplayObjs._doc_0_0=JSON.parse(a.value.repObjs),storeFirstObj=!0),a.continue()):"undefined"==typeof storeFirstObj&&"Whiteboard"==virtualclass.currApp&&virtualclass.wb[virtualclass.gObj.currWb].utility.makeUserAvailable()}},allData:{chunk:0,handleResult:function(a,
b){if(a=a.target.result){if(a.value.hasOwnProperty("recObjs")){if(a.value.hasOwnProperty("sessionEnd")){virtualclass.recorder.items.push({playTime:a.value.playTime,recObjs:a.value.recObjs,sessionEnd:!0});console.log("Start Upload Process");c(b);return}a.value.hasOwnProperty("bd")?virtualclass.recorder.items.push({playTime:a.value.playTime,recObjs:a.value.recObjs,bd:a.value.bd}):virtualclass.recorder.items.push({playTime:a.value.playTime,recObjs:a.value.recObjs})}a.continue()}}},dataAdapterAll:{handleResult:function(a,
b){if(a=a.target.result)a.value.hasOwnProperty("adaptData")&&(b=JSON.parse(a.value.adaptData),parseInt(a.value.serialKey)>ioAdapter.serial&&(ioAdapter.serial=parseInt(a.value.serialKey)),ioAdapter.adapterMustData[ioAdapter.serial]=b),a.continue()}},dataUserAdapterAll:{handleResult:function(a,b){if(a=a.target.result){if(a.value.hasOwnProperty("adaptUserData")){b=JSON.parse(a.value.adaptUserData);var c=a.value.serialKey.split("_"),f=parseInt(c[0]);c=parseInt(c[1]);ioAdapter.validateAllVariables(f);
c>ioAdapter.userSerial[f]&&(ioAdapter.userSerial[f]=c);ioAdapter.userAdapterMustData[f][c]=b}a.continue()}}},executedStoreAll:{handleResult:function(a,b){if(a=a.target.result){if(a.value.hasOwnProperty("executedData")){b=JSON.parse(a.value.executedData);var c=a.value.serialKey.split("_"),f=parseInt(c[0]);c=parseInt(c[1]);ioMissingPackets.validateAllVariables(f);ioMissingPackets.executedStore[f][c]=b}a.continue()}}},executedUserStoreAll:{handleResult:function(a,b){if(a=a.target.result){if(a.value.hasOwnProperty("executedUserData")){b=
JSON.parse(a.value.executedUserData);var c=a.value.serialKey.split("_"),f=parseInt(c[0]);c=parseInt(c[1]);ioMissingPackets.validateAllUserVariables(f);ioMissingPackets.executedUserStore[f][c]=b}a.continue()}}},config:{handleResult:function(a,b){if(a=a.target.result){if(a.value.hasOwnProperty("myconfig")){var c=JSON.parse(a.value.myconfig);"undefined"!=typeof b&&(mc=!0,b(c))}a.continue()}else"undefined"!=typeof b&&"undefined"==typeof mc&&b()},createNewSession:function(){virtualclass.recorder.sessionKey=
randomString(11);roles.hasAdmin()&&ioStorage.completeStorage(JSON.stringify(virtualclass.uInfo));virtualclass.makeAppReady(virtualclass.gObj.defaultApp);var a=(new Date).getTime();if("undefined"!=typeof b.db){var c=b.db.transaction(["config"],"readwrite").objectStore("config");a=JSON.stringify({createdDate:a,room:wbUser.room});c.add({myconfig:a,timeStamp:(new Date).getTime()})}else console.log("The Datbase is not created for Applicatoin.")},endSession:function(a){var c=document.querySelector("virtualclass"+
virtualclass.currApp);null!=c&&(c.style.display="none");virtualclass.gObj.video.audio.muteButtonToogle();c=document.querySelectorAll("#chat_div .ui-memblist-usr");if(null!=c&&0<c.length)for(var f=0;f<c.length;f++)null!=c[f]&&c[f].parentNode.removeChild(c[f]);virtualclass.gObj.precheckScrn&&virtualclass.vutil.prechkScrnShare();virtualclass.gObj.audioEnable=!0;virtualclass.storage.config.sessionEndFlag=!0;c=localStorage.getItem("nEd");f=localStorage.getItem("precheck");localStorage.clear();delete virtualclass.chat.vmstorage;
virtualclass.chat.vmstorage={};virtualclass.recorder.items=[];virtualclass.recorder.totalSent=0;virtualclass.gObj.tempReplayObjs.length=0;virtualclass.wb="";delete virtualclass.gObj.currWb;virtualclass.gObj.studentSSstatus.mesharing=!1;virtualclass.vutil.removeSharingClass();virtualclass.gObj.studentSSstatus.shareToAll=!1;virtualclass.gObj.studentSSstatus.sharing=!1;delete virtualclass.gObj.whoIsSharing;virtualclass.videoHost.gObj.stdStopSmallVid=!1;virtualclass.videoHost.gObj.videoSwitch=1;virtualclass.videoHost.gObj.allStdVideoOff=
!1;virtualclass.recorder.hasOwnProperty("startUpload")&&delete virtualclass.recorder.startUpload;virtualclass.gObj.hasOwnProperty("downloadProgress")&&delete virtualclass.gObj.downloadProgress;a||("object"==typeof virtualclass.wb&&(virtualclass.wb[virtualclass.gObj.currWb].utility.t_clearallInit(),virtualclass.wb[virtualclass.gObj.currWb].utility.makeDefaultValue(),"object"==typeof virtualclass.wb[virtualclass.gObj.currWb].replay&&(virtualclass.wb[virtualclass.gObj.currWb].replay.rendering=!1)),virtualclass.vutil.clearAllChat(),
virtualclass.editorRich.removeEditorData(),virtualclass.editorCode.removeEditorData(),virtualclass.pdfRender={});virtualclass.vutil.removeClass("audioWidget","fixed");virtualclass.hasOwnProperty("notPLayed")||virtualclass.storage.clearStorageData();virtualclass.wbCommon.removeAllContainers();virtualclass.gObj.wbCount=0;virtualclass.gObj.currSlide=0;virtualclass.currApp=virtualclass.gObj.defaultApp;virtualclass.gObj.hasOwnProperty("disableCamByUser")?virtualclass.user.control.audioDisable():virtualclass.user.control.audioWidgetEnable(!0);
virtualclass.user.control.allChatEnable();virtualclass.user.control.resetmediaSetting();roles.isStudent()&&(document.getElementById("videoHostContainer").style.display="block");roles.hasAdmin()&&(document.getElementById("virtualclassSessionEndTool").className=virtualclass.vutil.removeClassFromElement("virtualclassSessionEndTool","active"));"object"==typeof virtualclass.yts&&clearInterval(virtualclass.yts.tsc);"object"==typeof virtualclass.sharePt&&virtualclass.sharePt.UI.removeIframe();console.log("Session End.");
virtualclass.previous="virtualclass"+virtualclass.currApp;virtualclass.getContent=!1;virtualclass.recorder.storeDone=0;virtualclass.chat.removeChatHighLight("chatrm");virtualclass.setPrvUser();io.sock&&io.sock.close();null!=f&&localStorage.setItem("precheck",JSON.parse(f));null!=c?(console.log("Editor mode enable"),localStorage.setItem("editorRich",!0),localStorage.setItem("editorCode",!0),localStorage.removeItem("nEd")):console.log("Editor mode disable");console.log("New role before clear "+virtualclass.gObj.uRole);
b.config.createNewSession();console.log("New role after clear "+virtualclass.gObj.uRole);virtualclass.enablePreCheck||virtualclass.popup.waitMsg();"object"==typeof virtualclass.dts&&null!=virtualclass.dts&&virtualclass.dts.destroyDts();if("object"==typeof virtualclass.raiseHand&&null!=virtualclass.raiseHand)if(roles.hasControls())virtualclass.raiseHand.rhCount=0,virtualclass.raiseHand.rhCountR=0,(a=document.querySelector(".congrea .vmchat_bar_button .hand_bt.highlight"))&&a.classList.remove("highlight"),
document.querySelector(".congrea .vmchat_bar_button .hand_bt #notifyText").innerHTML="";else if(a=document.querySelector(".congrea .handRaise.disable"))a.classList.remove("disable"),a.classList.add("enable"),a.setAttribute("data-title",virtualclass.lang.getString("RaiseHandStdEnabled")),document.querySelector(".congrea .handRaise #icHr").setAttribute("data-action","enable"),virtualclass.raiseHand.stdRhEnable="enabled";if(a=document.querySelector(".congrea .slider.icon-all-audio-enable"))a.className=
"slider round congtooltip icon-all-audio-disable",a.setAttribute("data-action","disable"),a.setAttribute("data-title","Mute All");if(a=document.querySelector(".congrea .slider.icon-all-video-enable"))a.className="slider round congtooltip icon-all-video-disable",a.setAttribute("data-action","disable"),a.setAttribute("data-title","Disable Video");if(a=document.querySelector(".congrea #contrAudioAll.enable"))a.classList.remove("enable"),a.classList.add("disable"),(a=document.querySelector(".congrea #contrAudioAll input"))&&
a.removeAttribute("checked");if(a=document.querySelector(".congrea #contrVideoAll.enable"))a.classList.remove("enable"),a.classList.add("disable"),(a=document.querySelector(".congrea #contrVideoAll input"))&&a.removeAttribute("checked");!roles.hasControls()&&virtualclass.system.mediaDevices.hasWebcam&&virtualclass.videoHost.toggleVideoMsg("enable");(a=document.querySelector("#virtualclassCont.congrea .vmchat_room_bt.ui-state-highlight"))&&a.classList.remove("ui-state-highlight");(a=document.querySelector("#virtualclassCont.congrea.teacher #virtualclassAppRightPanel"))&&
a.classList.contains("vidHide")&&(a.classList.remove("vidHide"),a.classList.add("vidShow"));if(a=document.querySelector("#virtualclassCont.congrea.teacher #videoHostContainer"))a.classList.remove("hide"),a.classList.add("show");(a=document.querySelector("#virtualclassCont.congrea.student"))&&a.classList.contains("videoff")&&a.classList.remove("videoff");a=document.querySelector("#virtualclassCont #memlist");c=document.querySelector("#virtualclassCont #chatrm");f=document.querySelector("#user_list");
var g=document.querySelector("#chatroom_bt2");a&&!a.classList.contains("enable")&&(a.classList.add("enable"),a.classList.remove("disable"),c&&(c.classList.add("disable"),c.classList.remove("enable")));f.classList.contains("active")||f.classList.add("active");g.classList.remove("active");virtualclass.serverData.rawData={video:[],ppt:[],docs:[]};virtualclass.serverData.fetchAllData()}},shapesData:{handleResult:function(){virtualclass.recorder.items.push(JSON.parse(cursor.value.recObjs))}},dstStore:function(a){var c=
b.db.transaction(["dstdata"],"readwrite");c.objectStore("dstdata").clear();c.objectStore("dstdata").add({alldocs:a,timeStamp:(new Date).getTime(),id:9})},dstdata:{handleResult:function(b){(b=b.target.result)?(b.value.hasOwnProperty("alldocs")&&(console.log("document share store suman"),a=!0,virtualclass.gObj.docs=JSON.parse(b.value.alldocs)),b.continue()):a||(console.log("document share store init"),virtualclass.gObj.docs="init")}},dstAllStore:function(a){a=JSON.stringify(a);var c=b.db.transaction(["dstall"],
"readwrite");c.objectStore("dstall").clear();var f=JSON.stringify(virtualclass.dts.allNotes);c.objectStore("dstall").add({dstalldocs:a,allNotes:f,timeStamp:(new Date).getTime(),id:10})},dstall:{handleResult:function(a){(a=a.target.result)?(a.value.hasOwnProperty("dstalldocs")&&(console.log("document share store suman"),f=!0,virtualclass.gObj.dstAll=JSON.parse(a.value.dstalldocs),virtualclass.gObj.dstAllNotes=JSON.parse(a.value.allNotes)),a.continue()):f||(console.log("document share store init"),
virtualclass.gObj.dstAll="init")}},clearSingleTable:function(a){var b=this.db.transaction(a,"readwrite");"undefined"!=typeof b?(b.objectStore(a).clear(),console.log("Cleared IDDB Table "+a)):console.log("There is no table "+a+" at IDDB.");"dstdata"==a&&(virtualclass.gObj.docs="init");"dstall"==a&&(virtualclass.gObj.dstall="init")},clearStorageData:function(){ioAdapter.adapterMustData=[];ioAdapter.serial=-1;ioAdapter.userSerial=[];ioAdapter.userAdapterMustData=[];ioMissingPackets.executedStore=[];
ioMissingPackets.executedSerial={};ioMissingPackets.missRequest=[];ioMissingPackets.aheadPackets=[];ioMissingPackets.missRequestFlag=0;ioMissingPackets.executedUserStore=[];ioMissingPackets.executedUserSerial={};ioMissingPackets.missUserRequest=[];ioMissingPackets.aheadUserPackets=[];for(var a=ioMissingPackets.missUserRequestFlag=0;a<this.tables.length;a++)"allData"==this.tables[a]?virtualclass.vutil.isPlayMode()||this.clearSingleTable(this.tables[a]):this.clearSingleTable(this.tables[a])},getQuizData:function(a){var c=
!1;try{b.db.transaction(["quizData"],"readonly"),c=!0}catch(n){setTimeout(function(){b.getQuizData(a)},500)}if(c){var f=[];b.db.transaction(["quizData"],"readonly").objectStore("quizData").openCursor().onsuccess=function(b){(b=b.target.result)?(f[b.value.quizkey]=b.value.qzData,b.continue()):a(f)}}},clearTableData:function(a){b.db.transaction([a],"readwrite").objectStore(a).clear()},getWbData:function(a,c){var f=!1;try{b.db.transaction(["wbData"],"readwrite"),f=!0}catch(r){setTimeout(function(){b.getWbData(a,
c)},500)}if(f){console.log("GET DATA FROM LOCAL STORAGE");var g=b.db.transaction(["wbData"],"readwrite").objectStore("wbData").get(a);g.onsuccess=function(b){"undefined"!=typeof g.result?(console.log("Whiteboard start store from local storage "+a),virtualclass.gObj.tempReplayObjs[a]=[],virtualclass.gObj.tempReplayObjs[a]=JSON.parse(g.result.repObjs),c()):virtualclass.gObj.tempReplayObjs[a]="nodata"}}}}})(window);(function(d,c){d.user=function(b){return{assignRole:function(a,b,c){roles.hasControls()&&(roles.isEducator()||virtualclass.html.leftAppBar(),virtualclass.attachFunction(),"Whiteboard"==b&&d.virtualclass.wb[virtualclass.gObj.currWb].attachToolFunction(virtualclass.gObj.commandToolsWrapperId[virtualclass.gObj.currWb],!0,virtualclass.gObj.currWb),virtualclass.hasOwnProperty("previrtualclass")?virtualclass.vutil.makeActiveApp("virtualclass"+b,virtualclass.previrtualclass):virtualclass.vutil.makeActiveApp("virtualclass"+
b),"object"==typeof virtualclass.wb&&virtualclass.wb[virtualclass.gObj.currWb].utility.makeCanvasEnable())},teacherIsAlreadyExist:function(){for(var a=c.getElementById("chat_div").getElementsByClassName("ui-memblist-usr"),b,g=0;g<a.length;g++)if(b=a[g].getAttribute("data-role"),"t"==b||"e"==b)return!0;return!1},createControl:function(a,b){var f=c.createElement("div");f.id=a+"ControlContainer";f.className="controls";this.createControlDivs(f,a,b);return f},createControllerElement:function(a,b){var f=
c.createElement("span");f.id=a+b+"Img";var d=c.createElement("a");d.id=a+b+"Anch";d.className="congtooltip";d.appendChild(f);var m=c.createElement("div");m.id=a+b+"Cont";m.className="controleCont";m.appendChild(d);return[m,f]},createAssignControl:function(a,b,g,d){var f=this,h=this.createControllerElement(b,"contrAssign"),r=h[0],A=h[1];h=c.getElementById(b+"ControlContainer");null!=h?0>=h.getElementsByClassName("controleCont").length?h.appendChild(r):h.insertBefore(r,h.firstChild):a.appendChild(r);
virtualclass.user.control.changeAttribute(b,A,g,"assign","aRole");"undefined"!=typeof d&&(A.className+=" currTeacher");A.addEventListener("click",function(){f.control.init.call(f,A)})},createControlDivs:function(a,b,c){var f=this,g=!1,d=localStorage.getItem("virtualclass"+b);if(null!=d&&(g=!0,d=JSON.parse(d),d.hasOwnProperty("currTeacher")))if(virtualclass.gObj[b+"currTeacher"]={},1==d.currTeacher){var r=virtualclass.user.control.currTeacherAlready=!0;virtualclass.gObj[b+"currTeacher"].ct=!0}else virtualclass.gObj[b+
"currTeacher"].ct=!1;var A=roles.isEducator()?!1:!0,z=virtualclass.vutil.userIsOrginalTeacher(b);virtualclass.vutil.isUserTeacher(b);for(var t=0;t<c.length;t++)if("assign"==c[t]&&z)"undefined"!=typeof r?this.createAssignControl(a,b,A,r):this.createAssignControl(a,b,A);else if("audio"==c[t]){var v=this.createControllerElement(b,"contrAud"),q=v[0],w=v[1];a.appendChild(q);q=g&&d.hasOwnProperty("aud")?d.aud?!0:!1:!0;virtualclass.user.control.changeAttribute(b,w,q,"audio","aud");z&&w.addEventListener("click",
function(){f.control.init.call(f,w)});roles.hasAdmin()&&"false"==w.dataset.audioDisable&&(q=localStorage.getItem("allAudAction"),null!=q&&"disable"==q&&w.click())}else if("chat"==c[t]){v=this.createControllerElement(b,"contrChat");q=v[0];var p=v[1];a.appendChild(q);z&&p.addEventListener("click",function(){f.control.init.call(f,p)});var B=g&&d.hasOwnProperty("chat")?d.chat?!0:!1:!0;virtualclass.user.control.changeAttribute(b,p,B,"chat","chat")}else if("editorRich"==c[t]||"editorCode"==c[t]){if(roles.hasAdmin()){var G=
g&&d.hasOwnProperty(c[t])?d[c[t]]?!0:!1:!1;v=this.createControllerElement(b,"contr"+c[t]);q=v[0];v=v[1];q.className+=" controller"+c[t];a.appendChild(q);virtualclass.currApp!=virtualclass.vutil.capitalizeFirstLetter(c[t])&&(q.style.display="none");virtualclass.user.control.changeAttribute(b,v,G,c[t],c[t]);z&&v.addEventListener("click",f.closureEditor(f,v))}}else"RaiseHand"==c[t]&&(g&&d.hasOwnProperty("raiseHand"),virtualclass.user.control.changeAttribute(b,p,B,"RaiseHand","RaiseHand"))},closureEditor:function(a,
b){return function(){a.control.init.call(a,b)}},control:{toggleDisplayWriteModeMsgBox:function(a,b){var f=c.getElementById(a+"writeModeBox"),d=b?virtualclass.lang.getString("writemode"):virtualclass.lang.getString("readonlymode"),m=c.getElementById("virtualclass"+a+"Body");null==f&&null!=m&&(f=c.createElement("div"),f.id=a+"writeModeBox",m.appendChild(f));null!=f&&(f.className="writeModeBox",f.dataset.writeMode=b,f.innerHTML=d);"EditorRich"==a&&this.tooglDisplayEditorToolBar(b)},tooglDisplayEditorToolBar:function(a){var b=
c.getElementsByClassName("vceditor-toolbar"),g=b[0];0<b.length&&(a?(g.style.pointerEvents="visible",g.style.opacity="1"):(g.style.pointerEvents="none",g.style.opacity="0.5"))},received_editorRich:function(a){if(a.status){virtualclass.gObj.uid==a.toUser?"object"!=typeof virtualclass.editorRich.cm||virtualclass.isPlayMode||virtualclass.editorRich.cm.setOption("readOnly",!1):this.enable(a.toUser,"editorRich","editorRich","editorRich");virtualclass.isPlayMode&&virtualclass.editorRich.control.toggleDisplayWriteModeMsgBox(!1);
var b=!0}else virtualclass.gObj.uid==a.toUser?"object"==typeof virtualclass.editorRich.cm&&virtualclass.editorRich.cm.setOption("readOnly","nocursor"):this.disable(a.toUser,"editorRich","editorRich","editorRich"),b=!1;localStorage.setItem("editorRich",b);roles.hasAdmin()||this.toggleDisplayWriteModeMsgBox("EditorRich",b);!roles.hasAdmin()&&"iOS"==virtualclass.system.mybrowser.name&&virtualclass.system.isIPad()&&(a.status?virtualclass.editorRich.enableEditorByOuterLayer():virtualclass.editorRich.disableEditorByOuterLayer());
virtualclass.vutil.setReadModeWhenTeacherIsDisConn("editorRich")},received_editorCode:function(a){if(a.status){virtualclass.gObj.uid==a.toUser?"object"!=typeof virtualclass.editorCode.cm||virtualclass.isPlayMode||virtualclass.editorCode.cm.setOption("readOnly",!1):this.enable(a.toUser,"editorCode","editorCode","editorCode");virtualclass.isPlayMode&&virtualclass.editorCode.control.toggleDisplayWriteModeMsgBox(!1);var b=!0}else virtualclass.gObj.uid==a.toUser?"object"==typeof virtualclass.editorCode.cm&&
virtualclass.editorCode.cm.setOption("readOnly","nocursor"):this.disable(a.toUser,"editorCode","editorCode","editorCode"),b=!1;localStorage.setItem("editorCode",b);roles.hasAdmin()||this.toggleDisplayWriteModeMsgBox("EditorCode",b);!roles.hasAdmin()&&"iOS"==virtualclass.system.mybrowser.name&&virtualclass.system.isIPad()&&(a.status?virtualclass.editorCode.enableEditorByOuterLayer():virtualclass.editorCode.disableEditorByOuterLayer());virtualclass.vutil.setReadModeWhenTeacherIsDisConn("editorCode")},
onmessage:function(a){this["received_"+a.message.control](a.message)},addCurrTeacherToControl:function(a){var b=c.getElementById(a);null!=b&&(virtualclass.vutil.elemHasAnyClass(a)?b.classList.add("currTeacher"):b.className="currTeacher")},removeCurrTeacherFromControl:function(a){var b=c.getElementById(a);virtualclass.vutil.elemHasAnyClass(a)&&(b.classList.remove("currTeacher"),b=a.indexOf("contr"),a=a.substring(0,b),virtualclass.user.control.updateUser(a,"currTeacher",!1))},removeAudioFromParticipate:function(a){a=
c.getElementById(a+"contrAssignCont");null!=a&&a.parentNode.removeChild(a)},disable:function(a,b,g,d){g=c.getElementById(a+"contr"+g+"Img");null!=g&&virtualclass.user.control._disable(g,b,a,d)},_disable:function(a,b,c,d){a.parentNode.setAttribute("data-title",virtualclass.lang.getString(b+"Disable"));a.setAttribute("data-"+b+"-disable","true");a.className="icon-"+b+"Img block "+b+"Img";"assign"==b?(a.parentNode.classList.remove("tooltip"),this.addCurrTeacherToControl(a.id),a=localStorage.getItem("virtualclass"+
c),a=JSON.parse(a),virtualclass.gObj.hasOwnProperty(c+"currTeacher")?(virtualclass.gObj[c+"currTeacher"].ct||virtualclass.gObj.hasOwnProperty("controlAssign")&&virtualclass.gObj.controlAssign&&a.currTeacher)&&virtualclass.user.control.updateUser(c,"currTeacher",!0):virtualclass.gObj.hasOwnProperty("controlAssign")&&virtualclass.gObj.controlAssignId==c&&virtualclass.user.control.updateUser(c,"currTeacher",!0)):"audio"==b&&(a.className="icon-"+b+"DisImg block "+b+"DisImg");virtualclass.user.control.updateUser(c,
d,!1)},enable:function(a,b,g,d){g=c.getElementById(a+"contr"+g+"Img");null==g?console.log("Element is Null"):virtualclass.user.control._enable(g,b,a,d)},_enable:function(a,b,c,d){a.parentNode.setAttribute("data-title",virtualclass.lang.getString(b+"Enable"));a.setAttribute("data-"+b+"-disable","false");a.className="icon-"+b+"Img enable "+b+"Img";"RaiseHand"==b&&virtualclass.raiseHand._raiseHand(c);virtualclass.user.control.updateUser(c,d,!0)},changeAttribute:function(a,b,c,d,m){c?virtualclass.user.control._enable(b,
d,a,m):virtualclass.user.control._disable(b,d,a,m)},init:function(a,b,c){"undefined"==typeof c&&(c="Img");var f=a.id,g=f.indexOf("contr");g=f.substring(0,g);f=f.split("contr")[1];c=f.indexOf(c);c=f.substring(0,c);if("Assign"==c)virtualclass.vutil.appIsForEducator(virtualclass.currApp)&&(virtualclass.gObj.controlAssign=!0,virtualclass.gObj.controlAssignId=g,b="true"==a.getAttribute("data-assign-disable")?!0:!1,b||(this.control.changeAttribute(g,a,b,"assign","aRole"),virtualclass.user.control._assign(g),
virtualclass.user.control.changeAttrToAssign("block")),roles.hasAdmin()||virtualclass.user.control.removeAudioFromParticipate(g));else{var d;"stdscreen"==c?this.control._stdscreen.call(this.control,g):("Chat"==c?(a.className="contrChatBlock",f="chat"):f="Aud"==c?"audio":c,"undefined"!=typeof b?b=(d="enable"==b?!0:!1)?"enable":"block":"true"==a.getAttribute("data-"+f+"-disable")?(b="enable",d=!0):(b="block",d=!1),this.control.changeAttribute(g,a,d,f,virtualclass.vutil.smallizeFirstLetter(c)),this.control["_"+
f].call(this.control,g,b))}},init_old:function(a){var b=a.id,c=b.indexOf("contr");c=b.substring(0,c);b=b.split("contr")[1];var d=b.indexOf("Img");b=b.substring(0,d);"Assign"==b?(virtualclass.gObj.controlAssign=!0,virtualclass.gObj.controlAssignId=c,b="true"==a.getAttribute("data-assign-disable")?!0:!1,b||(this.control.changeAttribute(c,a,b,"assign","aRole"),virtualclass.user.control._assign(c),virtualclass.user.control.changeAttrToAssign("block")),roles.hasAdmin()||virtualclass.user.control.removeAudioFromParticipate(c)):
"Chat"==b?("true"==a.getAttribute("data-chat-disable")?(a.className="contrChatBlock",b="enable",this.control.changeAttribute(c,a,!0,"chat","chat")):(b="block",this.control.changeAttribute(c,a,!1,"chat","chat")),this.control._chat(c,b)):"Aud"==b&&("true"==a.getAttribute("data-audio-disable")?(b="enable",this.control.changeAttribute(c,a,!0,"audio","aud")):(b="block",this.control.changeAttribute(c,a,!1,"audio","aud")),this.control._audio(c,b))},_assign:function(a,b,g){virtualclass.vutil.assignRole();
virtualclass.vutil.removeAppPanel();virtualclass.system.setAppDimension();virtualclass.vutil.renderWhiteboardObjectsIfAny();if(!roles.hasAdmin()){var f=c.getElementById("vcanvas");f.className=f.className.replace(/\bteacher\b/," ");f.className="student"}localStorage.setItem("canvasDrwMsg",!0);f=c.getElementById("virtualclassScreenShareLocalVideo");null!=f&&"VIDEO"==f.tagName&&virtualclass.vutil.videoTeacher2Student("ScreenShare",!0);"ScreenShare"==virtualclass.currApp&&(virtualclass.ss.hasOwnProperty("currentStream")&&
virtualclass.ss.currentStream.getTracks()[0].stop(),virtualclass.ss="");"undefined"==typeof b&&(console.log("role transfer"),virtualclass.vutil.beforeSend({assignRole:!0,toUser:a,cf:"assignRole"},a),roles.hasAdmin()&&(b=c.getElementById(a+"contreditorRichImg"),"true"==b.dataset.editorrichDisable&&virtualclass.user.control.init.call(virtualclass.user,b),b=c.getElementById(a+"contreditorCodeImg"),"true"==b.dataset.editorcodeDisable&&virtualclass.user.control.init.call(virtualclass.user,b)));roles.hasAdmin()||
("undefined"==typeof g&&(g=a),a=c.getElementById(g+"ControlContainer").getElementsByClassName("controleCont")[0],a.removeChild(a.firstChild),localStorage.removeItem("aId"))},_chat:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({enc:!0,toUser:a,cf:"enc"},a):(virtualclass.user.control.updateUser(a,"chat",!1),virtualclass.vutil.beforeSend({dic:!0,toUser:a,cf:"dic"},a))},_audioAll:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({ena:!0,toUser:a,cf:"ena"},a):virtualclass.vutil.beforeSend({dia:!0,
toUser:a,cf:"dia"},a)},_editorRich:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({status:!0,control:"editorRich",toUser:a,cf:"control"},a):virtualclass.vutil.beforeSend({status:!1,control:"editorRich",toUser:a,cf:"control"},a)},_editorCode:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({status:!0,control:"editorCode",toUser:a,cf:"control"},a):virtualclass.vutil.beforeSend({status:!1,control:"editorCode",toUser:a,cf:"control"},a)},_audio:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({ena:!0,
toUser:a,cf:"ena"},a):virtualclass.vutil.beforeSend({dia:!0,toUser:a,cf:"dia"},a)},_RaiseHand:function(a,b){virtualclass.raiseHand.disableRaiseHand(a)},_stdscreen:function(a){virtualclass.vutil.beforeSend({reqscreen:!0,toUser:a,cf:"reqscreen"},a)},audioWidgetEnable:function(a){console.log("Audio enable true");localStorage.setItem("audEnable",JSON.stringify({ac:"true"}));if(null==localStorage.getItem("dvid")){var b=c.getElementById("speakerPressOnce");"undefined"==typeof a&&(b.className="active");
b.style.opacity="1";b.style.pointerEvents="visible"}},mediaWidgetDisable:function(a){virtualclass.system.mediaDevices.hasWebcam=!1;var b={ac:"false"},g=localStorage.getItem("audEnable");null!=g?(g=JSON.parse(g),"false"!=g.ac&&"undefined"!=typeof a&&(b.r=a)):"unefined"!=typeof a&&(b.r=a);console.log("audEnable "+b);a=c.getElementById("audioWidget");a.style.opacity="1";a.style.pointerEvents="visible";a.className="deactive";this.audioDisable();this.videoDisable();virtualclass.gObj.hasOwnProperty("video")&&
(virtualclass.gObj.video.audio.studentNotSpeak(),virtualclass.gObj.video.audio.clickOnceSpeaker("speakerPressOnce","alwaysDisable"));virtualclass.vutil.addClass("virtualclassCont","nowebcam")},audioDisable:function(){var a=c.getElementById("speakerPressOnce");null!=a&&(a.style.opacity="0.5",a.style.pointerEvents="none")},videoDisable:function(){var a=c.getElementById("congCtrBar");null!=a&&(a.style.opacity="0.5",a.style.pointerEvents="none")},videoEnable:function(){var a=c.getElementById("congCtrBar");
null!=a&&(a.style.opacity="1",a.style.pointerEvents="visible")},allChatDisable:function(){this.disableCommonChat();this.disbaleAllChatBox();this.disableOnLineUser()},disableCommonChat:function(){var a=c.getElementById("chatrm");null!=a&&this.makeElemDisable(a);if(a=c.querySelector("#virtualclassCont.congrea #ta_chrm2"))a.classList.add("disable"),a.disabled=!0},disbaleAllChatBox:function(){localStorage.setItem("chatEnable","false");var a=c.querySelector("#virtualclassAppRightPanel");a.classList.add("chat_disabled");
a.classList.remove("chat_enabled");a=c.getElementById("stickybar").getElementsByClassName("ui-chatbox");for(var b=0;b<a.length;b++)this.makeElemDisable(a[b])},disableOnLineUser:function(){for(var a=c.getElementsByClassName("ui-memblist-usr"),b=0;b<a.length;b++)a[b].style.pointerEvents="none"},makeElemDisable:function(a){"chatrm"!=a.id&&(virtualclass.vutil.elemHasAnyClass(a.id)?(a.classList.remove("enable"),a.classList.add("disable")):a.className="disable");a=a.getElementsByClassName("ui-chatbox-input-box")[0];
null!=a&&(a.disabled=!0)},allChatEnable:function(){localStorage.setItem("chatEnable","true");var a=c.querySelector("#virtualclassAppRightPanel");a.classList.remove("chat_disabled");a.classList.add("chat_enabled");if(a=c.querySelector("#virtualclassCont.congrea #ta_chrm2"))a.classList.remove("disable"),a.disabled=!1;a=c.getElementById("stickycontainer").getElementsByClassName("ui-chatbox");for(var b=0;b<a.length;b++)this.makeElemEnable(a[b]);var g=c.getElementsByClassName("ui-memblist-usr");for(b=
0;b<g.length;b++){g[b].classList.contains("mySelf")||(g[b].style.pointerEvents="visible");var d=g[b].querySelector(".icon-chatImg");d&&!d.classList.contains("enable")&&(d.classList.add("enable"),d.setAttribute("data-chat-disable","false"));(d=g[b].querySelector(".icon-editorRichImg"))&&d.classList.contains("enable")&&(d.classList.remove("enable"),d.classList.add("block"),d.parentNode.setAttribute("data-title",virtualclass.lang.getString("writemode")),d.setAttribute("data-editorrich-disable","true"));
(d=g[b].querySelector(".icon-editorCodeImg"))&&d.classList.contains("enable")&&(d.classList.remove("enable"),d.classList.add("block"),d.parentNode.setAttribute("data-title",virtualclass.lang.getString("editorCodeDisable")),d.setAttribute("data-editorcode-disable","true"));(d=g[b].querySelector(".icon-audioDisImg"))&&d.classList.contains("block")&&(d.parentNode.setAttribute("data-title",virtualclass.lang.getString("audioOn")),d.setAttribute("data-audio-disable","false"))}b=c.querySelector("#virtualclassCont #memlist.enable");
g=c.querySelector("#virtualclassCont #chatrm.enable");d=c.querySelector("#user_list");var m=c.querySelector("#chatroom_bt2");b&&!d.classList.contains("active")&&(d.classList.contains("active")||d.classList.add("active"),m.classList.remove("active"));g&&(m.classList.contains("active")||m.classList.add("active"),d.classList.remove("active"));c.getElementsByClassName("ui-memblist-usr");for(b=0;b<a.length;b++)this.makeElemEnable(a[b])},resetmediaSetting:function(){var a=c.getElementById("contrAudioAllImg");
a&&a.classList.contains("icon-all-audio-enable")&&(a.classList.remove("icon-all-audio-enable"),a.classList.add("icon-all-audio-disable"),a.setAttribute("data-title",virtualclass.lang.getString("muteAll")),"enable"==a.dataset.action&&(a.dataset.action="disable"));a=c.getElementById("videoSwitch");virtualclass.system.mediaDevices.hasWebcam&&a&&a.classList.contains("video")&&(a.classList.remove("video","off"),a.classList.add("video","on"),c.getElementById("rightCtlr").parentNode.setAttribute("data-title",
virtualclass.lang.getString("videooff")),virtualclass.videoHost.gObj.videoSwitch=1,virtualclass.videoHost.toggleVideoMsg("enable",!0))},makeElemEnable:function(a){virtualclass.vutil.elemHasAnyClass(a.id)?(a.classList.remove("disable"),a.classList.add("enable")):a.className="enable";a=a.getElementsByClassName("ui-chatbox-input-box")[0];null!=a&&(a.disabled=!1)},toggleAllEditorController:function(a,b){a=virtualclass.vutil.smallizeFirstLetter(a);var f=c.getElementsByClassName("controleCont");if(0<f.length)for(var d=
0;d<f.length;d++)if(0<f[d].id.indexOf(a)){var m=f[d].id.indexOf("Cont");0<m&&(m=f[d].id.substr(0,m),m=c.getElementById(m+"Img"),this.control.init.call(this,m,b))}},toggleDisplayEditorController:function(a,b){a=virtualclass.vutil.smallizeFirstLetter(a);a=c.getElementsByClassName("controller"+a);for(var f=0;f<a.length;f++)a[f].style.display=b},updateUser:function(a,b,c){var f=localStorage.getItem("virtualclass"+a),d={};null==f?d.id=a:d=JSON.parse(f);d[b]=c;localStorage["virtualclass"+d.id]=JSON.stringify(d);
return d},audioSign2:function(a,b){if("create"==b){if(null==c.getElementById(a.id+"AudEnableSign")){b=c.createElement("div");b.id=a.id+"AudEnableSign";var f=c.createElement("img");imgName="audioenable";f.id=a.id+imgName+"Img";f.src=d.whiteboardPath+"images/"+imgName+".png";var h=c.createElement("a");h.id=a.id+imgName+"Anch";h.className="audEnableSign tooltip controleCont";h.setAttribute("data-title",virtualclass.lang.getString("studentAudEnable"));h.appendChild(f);b.appendChild(h);c.getElementById(a.id+
"ControlContainer").appendChild(b)}}else a=c.getElementById(a.id+"AudEnableSign"),a.parentNode.removeChild(a)},audioSign:function(a,b){"create"==b?this.iconAttrManupulate(a.id,"icon-audioEnaGreen"):a.aud?this.iconAttrManupulate(a.id,"icon-audioImg"):this.iconAttrManupulate(a.id,"icon-audioDisImg")},iconAttrManupulate:function(a,b){a=c.getElementById(a+"contrAudImg");if(null!=a)for(var f=0;f<a.classList.length;f++)if("icon-"==a.classList[f].substring(0,5)){a.classList.remove(a.classList[f]);a.classList.add(b);
break}},shouldApply:function(a){var b=localStorage.getItem("virtualclass"+a);null!=b&&(b=JSON.parse(b),b.ad&&virtualclass.user.control.audioSign({id:a},"create"))},changeAttrToAssign:function(a){for(var b=c.getElementById("chatWidget").getElementsByClassName("assignImg"),d=0;d<b.length;d++)"enable"==a?(b[d].classList.remove("block"),b[d].classList.add("enable"),b[d].parentNode.classList.add("tooltip"),b[d].parentNode.setAttribute("data-title",virtualclass.lang.getString("transferControls")),b[d].setAttribute("data-assign-disable",
"false")):(b[d].classList.remove("enable"),b[d].classList.add("block"),b[d].parentNode.classList.remove("tooltip"),b[d].setAttribute("data-assign-disable","true"))}},displayStudentSpeaker:function(a){var b=c.getElementById("alwaysPress");null!=b&&(b.style.display=a?"block":"none")},toggleAllAudio:function(a){var b=c.getElementsByClassName("controleCont");if(0<b.length)for(var d=0;d<b.length;d++)if(0<b[d].id.indexOf("Aud")){var h=b[d].id.indexOf("Cont");0<h&&(h=b[d].id.substr(0,h),h=c.getElementById(h+
"Img"),this.control.init.call(this,h,a))}},toggleAllVideo:function(a){ioAdapter.mustSend({action:a,cf:"toggleVideo"})},UIaudioAll:function(a,b){var f=c.querySelector(".bulkUserActions #contrAudioAllImg"),d=localStorage.getItem("allAudAction");null!=d&&"disable"==d?(f.setAttribute("data-action","enable"),f.className="slider round icon-all-audio-enable congtooltip cgIcon",f.dataset.title=virtualclass.lang.getString("unmuteAll"),d=c.querySelector(".bulkUserActions #contrAudioAll input "),d.setAttribute("checked",
"true"),d=c.querySelector(".congrea #contrAudioAll"),d.classList.add("enable")):(f.setAttribute("data-action","disable"),f.className="slider round icon-all-audio-disable congtooltip cgIcon",f.dataset.title=virtualclass.lang.getString("muteAll"),d=c.querySelector(".bulkUserActions #contrAudioAll input "),d.removeAttribute("checked"),d=c.querySelector(".congrea #contrAudioAll"),d.classList.add("disable"));if(virtualclass.isPlayMode)anchorTag.pointerEvents="none",anchorTag.style.cursor="default";else{var m=
this;f.addEventListener("click",function(){c.querySelector(".bulkUserActions #contrAudioAllImg");var a=m.toogleAudioIcon();"undefined"!=typeof a&&(localStorage.setItem("allAudAction",a),m.toggleAllAudio.call(virtualclass.user,a))})}c.querySelector("#"+a+" ."+b)},UIvideoAll:function(){var a=c.querySelector(".bulkUserActions #contrVideoAllImg"),b=localStorage.getItem("allVideoAction");null!=b&&"disable"==b?(a.setAttribute("data-action","enable"),a.className="slider round icon-all-video-enable congtooltip cgIcon",
a.dataset.title=virtualclass.lang.getString("enableVideoAll"),b=c.querySelector(".bulkUserActions #contrVideoAll input "),b.setAttribute("checked","true"),b=c.querySelector(".congrea .bulkUserActions #contrVideoAll"),b.classList.add("enable")):(a.setAttribute("data-action","disable"),a.className="slider round icon-all-video-disable congtooltip cgIcon",a.dataset.title=virtualclass.lang.getString("disableAllVideo"),b=c.querySelector(".bulkUserActions #contrVideoAll input "),b.removeAttribute("checked"),
b=c.querySelector(".congrea .bulkUserActions #contrVideoAll"),b.classList.add("disable"));if(virtualclass.isPlayMode)anchorTag.pointerEvents="none",anchorTag.style.cursor="default";else{var d=this;a.addEventListener("click",function(){c.querySelector(".bulkUserActions #contrVideoAllImg");var a=d.toggleVideoIcon();"undefined"!=typeof a&&(localStorage.setItem("allVideoAction",a),d.toggleAllVideo(a))})}},chatBoxesSwitch:function(){if(virtualclass.chat.chatroombox)toggleCommonChatBox();else if(0==$("div#chat_room").length){var a=
c.createElement("ul");a.id="chat_room";c.body.appendChild(a);virtualclass.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:{name:"test"},title:lang.chatroom_header,offset:"20px",messageSent:function(a,b){$("#chat_room").chatroom("option","boxManager").addMsg(a.name,b)}});virtualclass.gObj.hasOwnProperty("chatEnable")&&!virtualclass.gObj.chatEnable&&(a=c.getElementById("chatrm"),null!=a&&virtualclass.user.control.makeElemDisable(a));a=c.getElementById("cc_arrow_button");a.classList.add("icon-arrow-down");
a.classList.remove("icon-arrow-up")}},toogleAudioIcon:function(){var a=c.querySelector(".bulkUserActions #contrAudioAllImg");if(null!=a)return actionToPerform=a.dataset.action,"enable"==a.dataset.action?(a.dataset.action="disable",a.className="slider round icon-all-audio-disable congtooltip",a.dataset.title=virtualclass.lang.getString("muteAll"),a=c.querySelector(".congrea .bulkUserActions #contrAudioAll"),a.classList.add("disable"),a.classList.remove("enable")):(a.dataset.action="enable",a.className=
"slider round icon-all-audio-enable congtooltip",a.dataset.title=virtualclass.lang.getString("unmuteAll"),a=c.querySelector(".congrea .bulkUserActions #contrAudioAll"),a.classList.add("enable"),a.classList.remove("disable")),actionToPerform},toggleVideoIcon:function(){var a=c.querySelector(".bulkUserActions #contrVideoAllImg");if(null!=a)return actionToPerform=a.dataset.action,"enable"==a.dataset.action?(a.dataset.action="disable",a.className="slider round icon-all-video-disable congtooltip",a.dataset.title=
virtualclass.lang.getString("disableAllVideo"),a=c.querySelector(".congrea .bulkUserActions #contrVideoAll"),a.classList.add("disable"),a.classList.remove("enable")):(a.dataset.action="enable",a.className="slider round icon-all-video-enable congtooltip",a.dataset.title=virtualclass.lang.getString("enableVideoAll"),a=c.querySelector(".congrea .bulkUserActions #contrVideoAll"),a.classList.add("enable"),a.classList.remove("disable")),actionToPerform},changeRoleOnFooter:function(a,b){c.getElementById("ml"+
a).dataset.role=b},initControlHandler:function(a){virtualclass.vutil.userIsOrginalTeacher(a);var b=this,d=c.querySelectorAll("#ml"+a+" .contImg"),h=!1,m=localStorage.getItem("virtualclass"+a);null!=m&&(h=!0,m=JSON.parse(m),m.hasOwnProperty("currTeacher")&&(virtualclass.gObj[a+"currTeacher"]={},1==m.currTeacher?(virtualclass.user.control.currTeacherAlready=!0,virtualclass.gObj[a+"currTeacher"].ct=!0):virtualclass.gObj[a+"currTeacher"].ct=!1));for(var n=0;n<d.length;n++)if(function(a){d[a].addEventListener("click",
function(){b.control.init.call(b,d[a])})}(n),-1<d[n].className.indexOf("chat")){var r=h&&m.hasOwnProperty("chat")?m.chat?!0:!1:!0;virtualclass.user.control.changeAttribute(a,d[n],r,"chat","chat")}else-1<d[n].className.indexOf("aud")?(r=h&&m.hasOwnProperty("aud")?m.aud?!0:!1:!0,virtualclass.user.control.changeAttribute(a,d[n],r,"audio","aud"),roles.hasAdmin()&&"false"==d[n].dataset.audioDisable&&(r=localStorage.getItem("allAudAction"),null!=r&&"disable"==r&&d[n].click())):-1<d[n].className.indexOf("RaiseHand")?
(r=h&&m.hasOwnProperty("raiseHand")?m.raiseHand?!0:!1:!1,virtualclass.user.control.changeAttribute(a,d[n],r,"RaiseHand","RaiseHand")):-1<d[n].className.indexOf("stdscreen")?virtualclass.gObj.studentSSstatus.hasOwnProperty("whoIsSharing")&&virtualclass.vutil.initssSharing(virtualclass.gObj.whoIsSharing):-1<d[n].className.indexOf("editorRich")?(r=h&&m.hasOwnProperty("editorRich")?m.editorRich?!0:!1:!1,virtualclass.user.control.changeAttribute(a,d[n],r,"editorRich","editorRich")):-1<d[n].className.indexOf("editorCode")&&
(r=h&&m.hasOwnProperty("editorCode")?m.editorCode?!0:!1:!1,virtualclass.user.control.changeAttribute(a,d[n],r,"editorCode","editorCode"))}}}})(window,document);(function(d){d.xhr={init:function(){this.httpObj=d.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");this.httpObj.upload.addEventListener("progress",this.onProgress);this.onReadStateChange();this.httpObj.onerror=function(c){virtualclass.recorder.initMakeAvailDownloadFile();console.log("Error "+c)};this.httpObj.onabort=function(c){console.log("Error abort "+c)}},onProgress:function(c){virtualclass.pbar.currVal=c.loaded;""!=virtualclass.pbar.prvVal&&"undefined"!=typeof virtualclass.pbar.prvVal||
virtualclass.isPlayMode||virtualclass.pbar.progressInit();virtualclass.pbar.renderProgressBar(c.total,c.loaded,"indProgressBar","indProgressValue")},onReadStateChange:function(){var c=this;this.httpObj.onreadystatechange=function(){4==c.httpObj.readyState&&"undefined"!=typeof c.cb&&(200==c.httpObj.status?c.cb(c.httpObj.responseText):c.cb("ERROR"))}},send:function(c,b,a){this.cb=a;this.httpObj.open("POST",b,!0);this.httpObj.send(c)},sendFormData:function(c,b,a){this.cb=a;this.httpObj.open("POST",b,
!0);this.httpObj.send(c)}}})(window);(function(d){d.xhrn={init:function(){this.httpObj=d.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");this.httpObj.upload.addEventListener("progress",this.onProgress);this.onReadStateChange();this.httpObj.onerror=function(c){console.log("Error "+c)};this.httpObj.onabort=function(c){console.log("Error abort "+c)}},onReadStateChange:function(){var c=this;this.httpObj.onreadystatechange=function(){4==c.httpObj.readyState&&"undefined"!=typeof c.cb&&(200==c.httpObj.status?c.cb(c.httpObj.responseText):
c.cb("ERROR"))}},sendData:function(c,b,a){this.cb=a;c=JSON.stringify(c);this.httpObj.open("POST",b);this.httpObj.setRequestHeader("x-api-key",wbUser.lkey);this.httpObj.setRequestHeader("x-congrea-authuser",wbUser.auth_user);this.httpObj.setRequestHeader("x-congrea-authpass",wbUser.auth_pass);this.httpObj.setRequestHeader("x-congrea-room",wbUser.room);this.httpObj.setRequestHeader("Content-Type","application/json");this.httpObj.withCredentials=!1;this.httpObj.send(c)},getAcess:function(c){this.cb=
c;this.httpObj.open("GET",virtualclass.api.access);this.httpObj.setRequestHeader("x-api-key",wbUser.lkey);this.httpObj.setRequestHeader("x-congrea-authuser",wbUser.auth_user);this.httpObj.setRequestHeader("x-congrea-authpass",wbUser.auth_pass);this.httpObj.setRequestHeader("x-congrea-room",wbUser.room);this.httpObj.setRequestHeader("Content-Type","application/json");this.httpObj.withCredentials=!0;this.httpObj.send()}}})(window);var PopUp=function(d,c){function b(a){this.init(a);return this}function a(a,b){var c={},f;for(f in a)Object.prototype.hasOwnProperty.call(a,f)&&(c[f]=a[f]);for(f in b)Object.prototype.hasOwnProperty.call(b,f)&&(c[f]=b[f]);return c}function f(a){var b=document.createElement("div");b.classList.add("rv-vanilla-modal-overlay");document.querySelector("body").appendChild(b);"function"===typeof a&&a()}"use strict";b.prototype.init=function(b){var c=this;this.settings=a({selector:"[data-rv-vanilla-modal]",
modalSelector:".rv-vanilla-modal",closeSelector:".rv-vanilla-modal-close",showModalClassName:"rv-vanilla-modal-is-open",showOverlay:!0},b);this.modalElements=document.querySelectorAll(this.settings.modalSelector);this.triggers=document.querySelectorAll(this.settings.selector);this.settings.showOverlay&&f(function(){c.overlayElement=document.querySelector(".rv-vanilla-modal-overlay")})};b.prototype.close=function(a){a.classList.remove(this.settings.showModalClassName);this.settings.showOverlay&&this.overlayElement.classList.remove("is-shown")};
b.prototype.open=function(a){document.getElementById("popupContainer").style.display="block";this.sendBackOtherElems();this.closeShownModal();a.classList.add(this.settings.showModalClassName);this.settings.showOverlay&&this.overlayElement.classList.add("is-shown")};b.prototype.each=function(a){[].forEach.call(this.triggers,function(b){"function"===typeof a&&a(b)})};b.prototype.closeShownModal=function(){var a=this.settings.showModalClassName;[].forEach.call(this.modalElements,function(b){b.classList.contains(a)&&
b.classList.remove(a)})};b.prototype.closeElem=function(){console.log("close popup");if(0==virtualclass.recorder.waitServer){var a=document.getElementById("virtualclassOptionsCont");null!=a&&(a.style.zIndex=100);a=document.getElementById("stickybar");null!=a&&(a.style.zIndex=1E3);a=document.getElementById("commandToolsWrapper");null!=a&&(a.style.pointerEvents="visible");a=document.getElementById("about-modal");null!=a&&virtualclass.popup.close(a);document.getElementById("sessionEndMsgCont").dataset.displaying=
"false";document.getElementById("uploadvideourl").dataset.displaying="false";a=document.getElementById("chatrm");null!=a&&(console.log("zIndex performing"),a.style.zIndex=1);document.querySelector("#networkStatusContainer").classList.remove("connecting-room")}};b.prototype.waitBlock=function(){var a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();document.getElementById("recordPlay").style.display="block";virtualclass.popup.replayWindowAction("none")};b.prototype.waitBlockAction=
function(a){document.getElementById("recordPlay").style.display=a};b.prototype.sendBackOtherElems=function(a){a=document.getElementById("virtualclassOptionsCont");null!=a&&(a.style.zIndex=0);a=document.getElementById("commandToolsWrapper");null!=a&&(a.style.pointerEvents="none");a=document.getElementById("stickybar");null!=a&&(a.style.zIndex=0);a=document.getElementById("chatrm");null==a||virtualclass.isPlayMode||(a.style.zIndex=0);a=document.getElementById("audioWidget");null!=a&&(a.style.zIndex=
0);a=document.getElementById("audioWidget");null!=a&&(a.style.zIndex=0);a=document.getElementById("memlist");null!=a&&(a.style.zIndex=0)};b.prototype.openProgressBar=function(a){a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();document.getElementById("recordingContainer").style.display="block"};b.prototype.replayWindow=function(){var a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();virtualclass.popup.replayWindowAction("block")};
b.prototype.sesseionEndWindow=function(){var a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();a=document.getElementById("sessionEndMsgCont");a.style.display="block";a.dataset.displaying=!0;document.getElementById("sessionEndClose").addEventListener("click",function(){virtualclass.popup.closeElem()})};b.prototype.validateurlPopup=function(){var a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();a=document.getElementById("uploadvideourl");
a.style.display="block";a.dataset.displaying=!0;document.getElementById("endSessionclose").addEventListener("click",function(){virtualclass.popup.closeElem()})};b.prototype.replayWindowAction=function(a){document.getElementById("replayContainer").style.display=a};b.prototype.progressBarAction=function(a){document.getElementById("recordingContainer").style.display=a};b.prototype.confirmInput=function(a,b,c,f,d,A){var g=document.getElementById("about-modal");virtualclass.popup.open(g);this.hideAllPopups();
g=document.getElementById("confirm");g.style.display="block";var h=g.getElementsByClassName("confirmChild");if(0<h.length)for(;1<=h.length;)h[0].parentNode.removeChild(h[0]);h=document.createElement("div");h.id="confirmMessage";h.className="confirmChild";h.innerHTML=a;g.appendChild(h);var m=this;a=function(){m.confirmInit(this.id,b,c,f,d,A)};h=document.createElement("div");h.id="confirmOk";h.className="confirmButton confirmChild";h.addEventListener("click",a);var n=document.createElement("button");
n.id="confirmOkButton";n.className="icon-check";n.innerHTML=virtualclass.lang.getString("confirmOk");h.appendChild(n);g.appendChild(h);h=document.createElement("div");h.id="confirmCancel";h.className="confirmButton confirmChild";h.addEventListener("click",a);a=document.createElement("button");a.id="confirmCancelButton";a.className="icon-close";a.innerHTML=virtualclass.lang.getString("confirmCancel");h.appendChild(a);g.appendChild(h)};b.prototype.pollPopUp=function(a,b){var c=document.getElementById("about-modal");
virtualclass.popup.open(c);this.hideAllPopups();c=document.getElementById("editPollCont");c.style.display="block";var f=this,d=function(){console.log(this.id);f.action(this.id,a,b)};if(null==document.getElementById("pollCancel")){var g=document.createElement("div");g.id="pollCancel";g.className="cancelBtn";g.addEventListener("click",d);var h=document.createElement("button");h.id="confirmCancelButton";h.className="icon-close";h.innerHTML=virtualclass.lang.getString("pollCancel");g.appendChild(h);c.appendChild(g)}document.getElementById("resetPoll").addEventListener("click",
d);document.getElementById("addMoreOption").addEventListener("click",d);document.getElementById("etSave").addEventListener("click",d);document.getElementById("saveNpublish").addEventListener("click",d)};b.prototype.action=function(a,b,c,f,d,A){b(a)};b.prototype.confirmInit=function(a,b,c,f,d,A){virtualclass.popup.closeElem();a="confirmOk"==a?virtualclass.popup.confirmOk():virtualclass.popup.confirmCancel();b(a,c,f,d,A)};b.prototype.confirmCancel=function(){return!1};b.prototype.confirmOk=function(){return!0};
b.prototype.waitMsg=function(a){var b=0;"undefined"!=typeof a&&(b=1300);setTimeout(function(){virtualclass.network.netWorkElementIsReady()},b);"undefined"!=typeof virtualclass.vutil&&virtualclass.vutil.sesionEndMsgBoxIsExisting()||this.hideAllPopups()};b.prototype.chromeExtMissing=function(){var a=document.getElementById("about-modal");a.dataset.currPopup="chromeExt";virtualclass.popup.open(a);this.hideAllPopups();document.getElementById("chromeExtMiss").style.display="block";document.getElementById("chromeExtClose").addEventListener("click",
function(){virtualclass.popup.closeElem();a.dataset.currPopup=""})};b.prototype.generalMsg=function(a){var b=document.getElementById("about-modal");virtualclass.popup.open(b);this.hideAllPopups();document.getElementById("generalMessage").style.display="block";document.querySelector("#generalMessageMsg").innerHTML=a;document.getElementById("generalMessageClose").addEventListener("click",function(){virtualclass.popup.closeElem()})};b.prototype.hideAllPopups=function(){for(var a=document.getElementsByClassName("popupWindow"),
b=0;b<a.length;b++)a[b].style.display="none"};b.prototype.closePopup=function(){virtualclass.popup.closeElem();"true"==document.getElementById("sessionEndMsgCont").dataset.displaying&&this.sesseionEndWindow()};return b}(window);(function(d){d.converter=function(){function c(a,b){a=a.replace(/[^A-Za-z0-9\+\/]/g,"");var c=a.length;b=b?Math.ceil((3*c+1>>2)/b)*b:3*c+1>>2;for(var f=new Uint8Array(b),d,n=0,r=0,A=0;A<c;A++){d=A&3;var z=a.charCodeAt(A);n|=(64<z&&91>z?z-65:96<z&&123>z?z-71:47<z&&58>z?z+4:43===z?62:47===z?63:0)<<6*(3-d);if(3===d||1===c-A){for(d=0;3>d&&r<b;d++,r++)f[r]=n>>>(16>>>d&24)&255;n=0}}return f}function b(a){return 26>a?a+65:52>a?a+71:62>a?a-4:62===a?43:63===a?47:65}return{base64EncArrInt:function(a){for(var b=
new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=0>a[c]?-1*a[c]+127:a[c];return this.base64EncArr(b)},base64EncArr:function(a){for(var c=2,d="",h=a.length,m=0,n=0;n<h;n++)if(c=n%3,0<n&&0===4*n/3%76&&(d+="\r\n"),m|=a[n]<<(16>>>c&24),2===c||1===a.length-n)d+=String.fromCharCode(b(m>>>18&63),b(m>>>12&63),b(m>>>6&63),b(m&63)),m=0;return d.substr(0,d.length-2+c)+(2===c?"":1===c?"=":"==")},base64DecToArrInt:function(a){a=c(a);for(var b=new Int8Array(a.length),d=0;d<a.length;d++)b[d]=128<=a[d]?-1*(a[d]-
127):a[d];return b},base64DecToArrclm:function(a){a=c(a);return new Uint8ClampedArray(a.buffer)}}}})(window);var progressBar={prvVal:"",currVal:"",progressInit:function(){var d=this;"undefined"!=typeof prvTimeout&&clearTimeout(prvTimeout);prvTimeout=setTimeout(function(){d.prvVal==d.currVal&&virtualclass.gObj.hasOwnProperty("downloadProgress")?virtualclass.recorder.initMakeAvailDownloadFile():(d.prvVal=d.currVal,d.progressInit())},5E4)},renderProgressBar:function(d,c,b,a){c>d&&(c=d,document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("playsessionmsg"));d=0==d&&0==c?0:Math.round(100*
c/d);b=document.getElementById(b);null!=b&&(b.style.width=d+"%");b=document.getElementById(a);null!=b&&(b.innerHTML=d+"%");100<=a&&(a=document.getElementById("recordingClose"),recordingClose.style.display="block",a.addEventListener("click",function(){virtualclass.popup.closeElem()}))}};if(!window.YT)var YT={loading:0,loaded:0};if(!window.YTConfig)var YTConfig={host:"http://www.youtube.com"};
YT.loading||(YT.loading=1,function(){var d=[];YT.ready=function(a){YT.loaded?a():d.push(a)};window.onYTReady=function(){YT.loaded=1;for(var a=0;a<d.length;a++)try{d[a]()}catch(f){}};YT.setConfig=function(a){for(var b in a)a.hasOwnProperty(b)&&(YTConfig[b]=a[b])};var c=document.createElement("script");c.type="text/javascript";c.id="www-widgetapi-script";c.src="https://s.ytimg.com/yts/jsbin/www-widgetapi-vfltoz0n9/www-widgetapi.js";c.async=!0;var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(c,
b)}());(function(d,c){var b=function(a){var f=0,d=-2,h=-1;return{retryForPalyer:1,player:"",init:function(a,b){if("undefined"!=typeof a){if("studentlayout"!=a.init)var f=a.init||a.yts&&a.yts.init;b=b||a.yts&&a.yts.startFrom}"undefined"!=typeof a.id&&(virtualclass.yts.vidId=a.id);if(!roles.hasAdmin()||roles.isEducator())if("undefined"==typeof f&&roles.isStudent())this.UI.defaultLayoutForStudent();else if(roles.hasControls()){if("undefined"!=typeof f)this.onYTIframApi(f,b,"fromReload")}else{if("undefined"!=
typeof a){if(a.hasOwnProperty("fromReload"))this.onYTIframApi(f,b,"fromReload");else"undefined"==typeof f?this.UI.defaultLayoutForStudent():"undefined"==typeof b?this.onYTIframApi(f):this.onYTIframApi(f,b);if(a=c.getElementById("messageLayoutVideo"))a.style.display="none"}}else if(virtualclass.videoUl.yts&&!b)f||(f=this.getVideoId(a.content_path)),this.onYTIframApi(f),ioAdapter.mustSend({yts:{init:f},cf:"yts"});else if("undefined"!=typeof b)this.onYTIframApi(f,b,"fromReload");$("#videoPlayerCont").css({display:"none"})},
destroyYT:function(){"object"==typeof virtualclass.yts.player&&("ScreenShare"==virtualclass.currApp&&ioAdapter.mustSend({yts:"destroyYT",cf:"yts"}),virtualclass.yts.player.destroy(),virtualclass.yts.player="",virtualclass.yts.hasOwnProperty("tsc")&&clearInterval(virtualclass.yts.tsc))},UI:{id:"virtualclassYts",class:"virtualclass",container:function(){c.getElementById(this.id)},defaultLayoutForStudent:function(){if(!c.getElementById("virtualclassVideo")){var a={control:roles.hasAdmin()?!0:!1};virtualclass.vutil.insertAppLayout((0,JST["templates/videoupload/videoupload.hbs"])(a))}},
inputURL:function(){},removeinputURL:function(){}},getVideoId:function(a){a=a.match(/^.*(?:(?:youtu\.be\/|v\/|vi\/|u\/\w\/|embed\/)|(?:(?:watch)?\?v(?:i)?=|&v(?:i)?=))([^#&\?]*).*/);return null!=a&&1<a.length&&(a=a[1].substring(0,11),11==a.length)?a:!1},onmessage:function(a){"object"!=typeof virtualclass.yts.player&&virtualclass.yts.init(a);if("string"==typeof a.yts)"play"==a.yts?this.player.playVideo():"pause"==a.yts?this.player.pauseVideo():"mute"==a.yts?this.player.mute():"unmute"==a.yts?this.player.unMute():
"destroyYT"==a.yts&&virtualclass.yts.destroyYT();else if(a.yts.hasOwnProperty("init")){virtualclass.videoUl.yts=!0;"object"==typeof virtualclass.yts.player&&(virtualclass.yts.player="");var b=c.querySelector("#virtualclassVideo #player");b&&b.parentNode.removeChild(b);b=c.querySelector("#virtualclassVideo");var f=c.createElement("div");f.id="player";b.appendChild(f);virtualclass.yts.init(a)}else a=parseInt(a.yts.seekto,10),this.player.hasOwnProperty("seekTo")&&this.player.seekTo(a)},onYTIframApi:function(a,
c,f){"undefined"!=typeof a&&(this.videoId=a);if("object"==typeof virtualclass.yts.player&&roles.hasControls())virtualclass.yts.player.loadVideoById(a);else{var d=0;roles.hasControls()&&(d=1);d={playerVars:{autohide:0,disablekb:1,enablejsapi:1,modestbranding:1,controls:d,rel:0,fs:0,showinfo:0,start:"undefined"!=typeof c?Math.round(c):0},videoId:a,events:{onReady:this.onPlayerReady}};"undefined"!=typeof c&&(d.start=c);console.log("Player object is CREATED");if("undefined"!=typeof f){var g=this;b.hasOwnProperty("ytApiReady")?
g.player=new YT.Player("player",d):(console.log("onYouTubeIframeAPIReady is not ready "),setTimeout(function(){g.onYTIframApi(a,c,f)},300))}else this.player=new YT.Player("player",d)}},triggerOnSeekChange:function(){console.log("there should happend something after each 2 second");if(0==f||-2==d||-1==h)f=this.player.getCurrentTime(),d=this.player.getPlayerState(),h=this.player.isMuted();else{var a=Math.abs(this.player.getCurrentTime()-f);f=this.player.getCurrentTime();console.log(f);console.log(this.player.getCurrentTime());
4<a&&this.ytOnSeek(this.player.getCurrentTime());this.player.getPlayerState()!=d&&3!=this.player.getPlayerState()&&(this.ytOnSeek(this.player.getCurrentTime()),this.ytOnChange(this.player.getPlayerState()),d=this.player.getPlayerState());this.player.isMuted()!=h&&(this.ytOnMuted(this.player.isMuted()),h=this.player.isMuted())}},ytOnMuted:function(a){a?ioAdapter.mustSend({yts:"mute",cf:"yts"}):ioAdapter.mustSend({yts:"unmute",cf:"yts"});console.log("MUTED "+a)},ytOnSeek:function(a){ioAdapter.mustSend({yts:{seekto:a},
cf:"yts"});console.log("SEEK CHANGED "+a)},ytOnChange:function(a){console.log("STATE CHANGED "+a);1==a?ioAdapter.mustSend({yts:"play",cf:"yts"}):2==a?ioAdapter.mustSend({yts:"pause",cf:"yts"}):0==a&&(a=virtualclass.videoUl.order.indexOf(virtualclass.yts.vidId),a<virtualclass.videoUl.order.length-1&&0<=a?virtualclass.videoUl.listEnd=!1:(virtualclass.videoUl.listEnd=!0,vidId=-1),virtualclass.videoUl.autoPlayFlag&&virtualclass.videoUl.autoPlayList(a+1))},onPlayerReady:function(a){if(roles.hasControls()){var b=
c.getElementById("submitURL");b&&(b.innerHTML=virtualclass.lang.getString("share"))}a.target.playVideo();virtualclass.yts.player.unMute();virtualclass.yts.player.setVolume(40);roles.hasControls()&&virtualclass.yts.seekChangeInterval()},seekChangeInterval:function(){virtualclass.yts.tsc=setInterval(function(){virtualclass.yts.triggerOnSeekChange()},2E3)}}};d.onYouTubeIframeAPIReady=function(){b.ytApiReady=!0;console.log("onYouTubeIframeAPIReady is ready now")};d.yts=b})(window,document);var CodeMirror=function(){function d(a,b){if(!(this instanceof d))return new d(a,b);this.options=b=b?Ta(b):{};Ta(vf,b,!1);t(b);var f=b.value;"string"==typeof f&&(f=new Ea(f,b.mode,null,b.lineSeparator));this.doc=f;var u=new d.inputStyles[b.inputStyle](this);a=this.display=new c(a,f,u);a.wrapper.CodeMirror=this;n(this);h(this);b.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap");b.autofocus&&!dc&&a.input.focus();p(this);this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,
focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,draggingText:!1,highlight:new ec,keySeq:null,specialChars:null};var g=this;ha&&11>pa&&setTimeout(function(){g.display.input.reset(!0)},20);wf(this);Yd||(xf(),Yd=!0);Jb(this);this.curOp.forceUpdate=!0;Zd(this,f);b.autofocus&&!dc||g.hasFocus()?setTimeout(fc(nd,this),20):gc(this);for(var x in Kb)if(Kb.hasOwnProperty(x))Kb[x](this,b[x],$d);J(this);b.finishInit&&b.finishInit(this);for(f=0;f<od.length;++f)od[f](this);Lb(this);wa&&b.lineWrapping&&
"optimizelegibility"==getComputedStyle(a.lineDiv).textRendering&&(a.lineDiv.style.textRendering="auto")}function c(a,b,c){this.input=c;this.scrollbarFiller=Q("div",null,"CodeMirror-scrollbar-filler");this.scrollbarFiller.setAttribute("cm-not-content","true");this.gutterFiller=Q("div",null,"CodeMirror-gutter-filler");this.gutterFiller.setAttribute("cm-not-content","true");this.lineDiv=Q("div",null,"CodeMirror-code");this.selectionDiv=Q("div",null,null,"position: relative; z-index: 1");this.cursorDiv=
Q("div",null,"CodeMirror-cursors");this.measure=Q("div",null,"CodeMirror-measure");this.lineMeasure=Q("div",null,"CodeMirror-measure");this.lineSpace=Q("div",[this.measure,this.lineMeasure,this.selectionDiv,this.cursorDiv,this.lineDiv],null,"position: relative; outline: none");this.mover=Q("div",[Q("div",[this.lineSpace],"CodeMirror-lines")],null,"position: relative");this.sizer=Q("div",[this.mover],"CodeMirror-sizer");this.sizerWidth=null;this.heightForcer=Q("div",null,null,"position: absolute; height: "+
ae+"px; width: 1px;");this.gutters=Q("div",null,"CodeMirror-gutters");this.lineGutter=null;this.scroller=Q("div",[this.sizer,this.heightForcer,this.gutters],"CodeMirror-scroll");this.scroller.setAttribute("tabIndex","-1");this.wrapper=Q("div",[this.scrollbarFiller,this.gutterFiller,this.scroller],"CodeMirror");ha&&8>pa&&(this.gutters.style.zIndex=-1,this.scroller.style.paddingRight=0);wa||ub&&dc||(this.scroller.draggable=!0);a&&(a.appendChild?a.appendChild(this.wrapper):a(this.wrapper));this.reportedViewFrom=
this.reportedViewTo=this.viewFrom=this.viewTo=b.first;this.view=[];this.externalMeasured=this.renderedView=null;this.lastWrapHeight=this.lastWrapWidth=this.viewOffset=0;this.updateLineNumbers=null;this.nativeBarWidth=this.barHeight=this.barWidth=0;this.scrollbarsClipped=!1;this.lineNumWidth=this.lineNumInnerWidth=this.lineNumChars=null;this.alignWidgets=!1;this.maxLine=this.cachedCharWidth=this.cachedTextHeight=this.cachedPaddingH=null;this.maxLineLength=0;this.maxLineChanged=!1;this.wheelDX=this.wheelDY=
this.wheelStartX=this.wheelStartY=null;this.shift=!1;this.activeTouch=this.selForContextMenu=null;c.init(this)}function b(b){b.doc.mode=d.getMode(b.options,b.doc.modeOption);a(b)}function a(a){a.doc.iter(function(a){a.stateAfter&&(a.stateAfter=null);a.styles&&(a.styles=null)});a.doc.frontier=a.doc.first;hc(a,100);a.state.modeGen++;a.curOp&&Fa(a)}function f(a){var b=vb(a.display),c=a.options.lineWrapping,f=c&&Math.max(5,a.display.scroller.clientWidth/ic(a.display)-3);return function(u){if(xb(a.doc,
u))return 0;var d=0;if(u.widgets)for(var g=0;g<u.widgets.length;g++)u.widgets[g].height&&(d+=u.widgets[g].height);return c?d+(Math.ceil(u.text.length/f)||1)*b:d+b}}function g(a){var b=a.doc,c=f(a);b.iter(function(a){var b=c(a);b!=a.height&&$a(a,b)})}function h(a){a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+a.options.theme.replace(/(^|\s)\s*/g," cm-s-");jc(a)}function m(a){n(a);Fa(a);setTimeout(function(){M(a)},20)}function n(a){var b=a.display.gutters,c=a.options.gutters;
yb(b);for(var f=0;f<c.length;++f){var u=c[f],d=b.appendChild(Q("div",null,"CodeMirror-gutter "+u));"CodeMirror-linenumbers"==u&&(a.display.lineGutter=d,d.style.width=(a.display.lineNumWidth||1)+"px")}b.style.display=f?"":"none";r(a)}function r(a){a.display.sizer.style.marginLeft=a.display.gutters.offsetWidth+"px"}function A(a){if(0==a.height)return 0;for(var b=a.text.length,c,f=a;c=zb(f,!0);)c=c.find(0,!0),f=c.from.line,b+=c.from.ch-c.to.ch;for(f=a;c=zb(f,!1);)c=c.find(0,!0),b-=f.text.length-c.from.ch,
f=c.to.line,b+=f.text.length-c.to.ch;return b}function z(a){var b=a.display;a=a.doc;b.maxLine=T(a,a.first);b.maxLineLength=A(b.maxLine);b.maxLineChanged=!0;a.iter(function(a){var c=A(a);c>b.maxLineLength&&(b.maxLineLength=c,b.maxLine=a)})}function t(a){var b=za(a.gutters,"CodeMirror-linenumbers");-1==b&&a.lineNumbers?a.gutters=a.gutters.concat(["CodeMirror-linenumbers"]):-1<b&&!a.lineNumbers&&(a.gutters=a.gutters.slice(0),a.gutters.splice(b,1))}function v(a){var b=a.display,c=b.gutters.offsetWidth,
f=Math.round(a.doc.height+pd(a.display));return{clientHeight:b.scroller.clientHeight,viewHeight:b.wrapper.clientHeight,scrollWidth:b.scroller.scrollWidth,clientWidth:b.scroller.clientWidth,viewWidth:b.wrapper.clientWidth,barLeft:a.options.fixedGutter?c:0,docHeight:f,scrollHeight:f+ab(a)+b.barHeight,nativeBarWidth:b.nativeBarWidth,gutterWidth:c}}function q(a,b,c){this.cm=c;var f=this.vert=Q("div",[Q("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),u=this.horiz=Q("div",[Q("div",null,null,
"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");a(f);a(u);U(f,"scroll",function(){f.clientHeight&&b(f.scrollTop,"vertical")});U(u,"scroll",function(){u.clientWidth&&b(u.scrollLeft,"horizontal")});this.checkedOverlay=!1;ha&&8>pa&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")}function w(){}function p(a){a.display.scrollbars&&(a.display.scrollbars.clear(),a.display.scrollbars.addClass&&kc(a.display.wrapper,a.display.scrollbars.addClass));a.display.scrollbars=new d.scrollbarModel[a.options.scrollbarStyle](function(b){a.display.wrapper.insertBefore(b,
a.display.scrollbarFiller);U(b,"mousedown",function(){a.state.focused&&setTimeout(function(){a.display.input.focus()},0)});b.setAttribute("cm-not-content","true")},function(b,c){"horizontal"==c?Mb(a,b):lc(a,b)},a);a.display.scrollbars.addClass&&nc(a.display.wrapper,a.display.scrollbars.addClass)}function B(a,b){b||(b=v(a));var c=a.display.barWidth,f=a.display.barHeight;G(a,b);for(b=0;4>b&&c!=a.display.barWidth||f!=a.display.barHeight;b++)c!=a.display.barWidth&&a.options.lineWrapping&&fa(a),G(a,v(a)),
c=a.display.barWidth,f=a.display.barHeight}function G(a,b){var c=a.display,f=c.scrollbars.update(b);c.sizer.style.paddingRight=(c.barWidth=f.right)+"px";c.sizer.style.paddingBottom=(c.barHeight=f.bottom)+"px";f.right&&f.bottom?(c.scrollbarFiller.style.display="block",c.scrollbarFiller.style.height=f.bottom+"px",c.scrollbarFiller.style.width=f.right+"px"):c.scrollbarFiller.style.display="";f.bottom&&a.options.coverGutterNextToScrollbar&&a.options.fixedGutter?(c.gutterFiller.style.display="block",c.gutterFiller.style.height=
f.bottom+"px",c.gutterFiller.style.width=b.gutterWidth+"px"):c.gutterFiller.style.display=""}function H(a,b,c){var f=c&&null!=c.top?Math.max(0,c.top):a.scroller.scrollTop;f=Math.floor(f-a.lineSpace.offsetTop);var u=c&&null!=c.bottom?c.bottom:f+a.wrapper.clientHeight;f=Ab(b,f);u=Ab(b,u);if(c&&c.ensure){var d=c.ensure.from.line;c=c.ensure.to.line;d<f?(f=d,u=Ab(b,bb(T(b,d))+a.wrapper.clientHeight)):Math.min(c,b.lastLine())>=u&&(f=Ab(b,bb(T(b,c))-a.wrapper.clientHeight),u=c)}return{from:f,to:Math.max(u,
f+1)}}function M(a){var b=a.display,c=b.view;if(b.alignWidgets||b.gutters.firstChild&&a.options.fixedGutter){for(var f=I(b)-b.scroller.scrollLeft+a.doc.scrollLeft,u=b.gutters.offsetWidth,d=f+"px",g=0;g<c.length;g++)if(!c[g].hidden){a.options.fixedGutter&&c[g].gutter&&(c[g].gutter.style.left=d);var h=c[g].alignable;if(h)for(var n=0;n<h.length;n++)h[n].style.left=d}a.options.fixedGutter&&(b.gutters.style.left=f+u+"px")}}function J(a){if(!a.options.lineNumbers)return!1;var b=a.doc;b=D(a.options,b.first+
b.size-1);var c=a.display;if(b.length!=c.lineNumChars){var f=c.measure.appendChild(Q("div",[Q("div",b)],"CodeMirror-linenumber CodeMirror-gutter-elt")),u=f.firstChild.offsetWidth;f=f.offsetWidth-u;c.lineGutter.style.width="";c.lineNumInnerWidth=Math.max(u,c.lineGutter.offsetWidth-f)+1;c.lineNumWidth=c.lineNumInnerWidth+f;c.lineNumChars=c.lineNumInnerWidth?b.length:-1;c.lineGutter.style.width=c.lineNumWidth+"px";r(a);return!0}return!1}function D(a,b){return String(a.lineNumberFormatter(b+a.firstLineNumber))}
function I(a){return a.scroller.getBoundingClientRect().left-a.sizer.getBoundingClientRect().left}function P(a,b,c){var f=a.display;this.viewport=b;this.visible=H(f,a.doc,b);this.editorIsHidden=!f.wrapper.offsetWidth;this.wrapperHeight=f.wrapper.clientHeight;this.wrapperWidth=f.wrapper.clientWidth;this.oldDisplayWidth=nb(a);this.force=c;this.dims=ua(a);this.events=[]}function K(a,b){var c=a.display,f=a.doc;if(b.editorIsHidden)return ob(a),!1;if(!b.force&&b.visible.from>=c.viewFrom&&b.visible.to<=
c.viewTo&&(null==c.updateLineNumbers||c.updateLineNumbers>=c.viewTo)&&c.renderedView==c.view&&0==be(a))return!1;J(a)&&(ob(a),b.dims=ua(a));var u=f.first+f.size,d=Math.max(b.visible.from-a.options.viewportMargin,f.first),g=Math.min(u,b.visible.to+a.options.viewportMargin);c.viewFrom<d&&20>d-c.viewFrom&&(d=Math.max(f.first,c.viewFrom));c.viewTo>g&&20>c.viewTo-g&&(g=Math.min(u,c.viewTo));pb&&(d=qd(a.doc,d),g=ce(a.doc,g));f=d!=c.viewFrom||g!=c.viewTo||c.lastWrapHeight!=b.wrapperHeight||c.lastWrapWidth!=
b.wrapperWidth;u=a.display;0==u.view.length||d>=u.viewTo||g<=u.viewFrom?(u.view=Hc(a,d,g),u.viewFrom=d):(u.viewFrom>d?u.view=Hc(a,d,u.viewFrom).concat(u.view):u.viewFrom<d&&(u.view=u.view.slice(Bb(a,d))),u.viewFrom=d,u.viewTo<g?u.view=u.view.concat(Hc(a,u.viewTo,g)):u.viewTo>g&&(u.view=u.view.slice(0,Bb(a,g))));u.viewTo=g;c.viewOffset=bb(T(a.doc,c.viewFrom));a.display.mover.style.top=c.viewOffset+"px";g=be(a);if(!f&&0==g&&!b.force&&c.renderedView==c.view&&(null==c.updateLineNumbers||c.updateLineNumbers>=
c.viewTo))return!1;d=cb();4<g&&(c.lineDiv.style.display="none");da(a,c.updateLineNumbers,b.dims);4<g&&(c.lineDiv.style.display="");c.renderedView=c.view;d&&cb()!=d&&d.offsetHeight&&d.focus();yb(c.cursorDiv);yb(c.selectionDiv);c.gutters.style.height=c.sizer.style.minHeight=0;f&&(c.lastWrapHeight=b.wrapperHeight,c.lastWrapWidth=b.wrapperWidth,hc(a,400));c.updateLineNumbers=null;return!0}function R(a,b){for(var c=b.viewport,f=!0;;f=!1){if(!f||!a.options.lineWrapping||b.oldDisplayWidth==nb(a))if(c&&null!=
c.top&&(c={top:Math.min(a.doc.height+pd(a.display)-rd(a),c.top)}),b.visible=H(a.display,a.doc,c),b.visible.from>=a.display.viewFrom&&b.visible.to<=a.display.viewTo)break;if(!K(a,b))break;fa(a);f=v(a);oc(a);C(a,f);B(a,f)}b.signal(a,"update",a);if(a.display.viewFrom!=a.display.reportedViewFrom||a.display.viewTo!=a.display.reportedViewTo)b.signal(a,"viewportChange",a,a.display.viewFrom,a.display.viewTo),a.display.reportedViewFrom=a.display.viewFrom,a.display.reportedViewTo=a.display.viewTo}function Z(a,
b){b=new P(a,b);if(K(a,b)){fa(a);R(a,b);var c=v(a);oc(a);C(a,c);B(a,c);b.finish()}}function C(a,b){a.display.sizer.style.minHeight=b.docHeight+"px";var c=b.docHeight+a.display.barHeight;a.display.heightForcer.style.top=c+"px";a.display.gutters.style.height=Math.max(c+ab(a),b.clientHeight)+"px"}function fa(a){a=a.display;for(var b=a.lineDiv.offsetTop,c=0;c<a.view.length;c++){var f=a.view[c];if(!f.hidden){if(ha&&8>pa){var u=f.node.offsetTop+f.node.offsetHeight;var d=u-b;b=u}else d=f.node.getBoundingClientRect(),
d=d.bottom-d.top;u=f.line.height-d;2>d&&(d=vb(a));if(.001<u||-.001>u)if($a(f.line,d),oa(f.line),f.rest)for(d=0;d<f.rest.length;d++)oa(f.rest[d])}}}function oa(a){if(a.widgets)for(var b=0;b<a.widgets.length;++b)a.widgets[b].height=a.widgets[b].node.offsetHeight}function ua(a){for(var b=a.display,c={},f={},u=b.gutters.clientLeft,d=b.gutters.firstChild,g=0;d;d=d.nextSibling,++g)c[a.options.gutters[g]]=d.offsetLeft+d.clientLeft+u,f[a.options.gutters[g]]=d.clientWidth;return{fixedPos:I(b),gutterTotalWidth:b.gutters.offsetWidth,
gutterLeft:c,gutterWidth:f,wrapperWidth:b.wrapper.clientWidth}}function da(a,b,c){function f(b){var c=b.nextSibling;wa&&Ua&&a.display.currentWheelTarget==b?b.style.display="none":b.parentNode.removeChild(b);return c}var u=a.display,d=a.options.lineNumbers,g=u.lineDiv,x=g.firstChild,E=u.view;u=u.viewFrom;for(var h=0;h<E.length;h++){var n=E[h];if(!n.hidden)if(n.node&&n.node.parentNode==g){for(;x!=n.node;)x=f(x);x=d&&null!=b&&b<=u&&n.lineNumber;n.changes&&(-1<za(n.changes,"gutter")&&(x=!1),X(a,n,u,c));
x&&(yb(n.lineNumber),n.lineNumber.appendChild(document.createTextNode(D(a.options,u))));x=n.node.nextSibling}else{var m=Ha(a,n,u,c);g.insertBefore(m,x)}u+=n.size}for(;x;)x=f(x)}function X(a,b,c,f){for(var u=0;u<b.changes.length;u++){var d=b.changes[u];if("text"==d){d=b;var g=d.text.className,x=qa(a,d);d.text==d.node&&(d.node=x.pre);d.text.parentNode.replaceChild(x.pre,d.text);d.text=x.pre;x.bgClass!=d.bgClass||x.textClass!=d.textClass?(d.bgClass=x.bgClass,d.textClass=x.textClass,V(d)):g&&(d.text.className=
g)}else if("gutter"==d)ja(a,b,c,f);else if("class"==d)V(b);else if("widget"==d){g=a;x=b;var E=f;x.alignable&&(x.alignable=null);for(var h=x.node.firstChild;h;h=d)d=h.nextSibling,"CodeMirror-linewidget"==h.className&&x.node.removeChild(h);Ia(g,x,E)}}b.changes=null}function aa(a){a.node==a.text&&(a.node=Q("div",null,null,"position: relative"),a.text.parentNode&&a.text.parentNode.replaceChild(a.node,a.text),a.node.appendChild(a.text),ha&&8>pa&&(a.node.style.zIndex=2));return a.node}function qa(a,b){var c=
a.display.externalMeasured;return c&&c.line==b.line?(a.display.externalMeasured=null,b.measure=c.measure,c.built):de(a,b)}function V(a){var b=a.bgClass?a.bgClass+" "+(a.line.bgClass||""):a.line.bgClass;b&&(b+=" CodeMirror-linebackground");if(a.background)b?a.background.className=b:(a.background.parentNode.removeChild(a.background),a.background=null);else if(b){var c=aa(a);a.background=c.insertBefore(Q("div",null,b),c.firstChild)}a.line.wrapClass?aa(a).className=a.line.wrapClass:a.node!=a.text&&(a.node.className=
"");a.text.className=(a.textClass?a.textClass+" "+(a.line.textClass||""):a.line.textClass)||""}function ja(a,b,c,f){b.gutter&&(b.node.removeChild(b.gutter),b.gutter=null);b.gutterBackground&&(b.node.removeChild(b.gutterBackground),b.gutterBackground=null);if(b.line.gutterClass){var u=aa(b);b.gutterBackground=Q("div",null,"CodeMirror-gutter-background "+b.line.gutterClass,"left: "+(a.options.fixedGutter?f.fixedPos:-f.gutterTotalWidth)+"px; width: "+f.gutterTotalWidth+"px");u.insertBefore(b.gutterBackground,
b.text)}var d=b.line.gutterMarkers;if(a.options.lineNumbers||d){u=aa(b);var g=b.gutter=Q("div",null,"CodeMirror-gutter-wrapper","left: "+(a.options.fixedGutter?f.fixedPos:-f.gutterTotalWidth)+"px");a.display.input.setUneditable(g);u.insertBefore(g,b.text);b.line.gutterClass&&(g.className+=" "+b.line.gutterClass);!a.options.lineNumbers||d&&d["CodeMirror-linenumbers"]||(b.lineNumber=g.appendChild(Q("div",D(a.options,c),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+f.gutterLeft["CodeMirror-linenumbers"]+
"px; width: "+a.display.lineNumInnerWidth+"px")));if(d)for(b=0;b<a.options.gutters.length;++b)c=a.options.gutters[b],(u=d.hasOwnProperty(c)&&d[c])&&g.appendChild(Q("div",[u],"CodeMirror-gutter-elt","left: "+f.gutterLeft[c]+"px; width: "+f.gutterWidth[c]+"px"))}}function Ha(a,b,c,f){var u=qa(a,b);b.text=b.node=u.pre;u.bgClass&&(b.bgClass=u.bgClass);u.textClass&&(b.textClass=u.textClass);V(b);ja(a,b,c,f);Ia(a,b,f);return b.node}function Ia(a,b,c){ia(a,b.line,b,c,!0);if(b.rest)for(var f=0;f<b.rest.length;f++)ia(a,
b.rest[f],b,c,!1)}function ia(a,b,c,f,d){if(b.widgets){var u=aa(c),g=0;for(b=b.widgets;g<b.length;++g){var x=b[g],E=Q("div",[x.node],"CodeMirror-linewidget");x.handleMouseEvents||E.setAttribute("cm-ignore-events","true");var h=x,O=E,ca=f;if(h.noHScroll){(c.alignable||(c.alignable=[])).push(O);var n=ca.wrapperWidth;O.style.left=ca.fixedPos+"px";h.coverGutter||(n-=ca.gutterTotalWidth,O.style.paddingLeft=ca.gutterTotalWidth+"px");O.style.width=n+"px"}h.coverGutter&&(O.style.zIndex=5,O.style.position=
"relative",h.noHScroll||(O.style.marginLeft=-ca.gutterTotalWidth+"px"));a.display.input.setUneditable(E);d&&x.above?u.insertBefore(E,c.gutter||c.text):u.appendChild(E);Aa(x,"redraw")}}}function ra(a){return L(a.line,a.ch)}function Za(a,b){return 0>Y(a,b)?b:a}function xa(a,b){return 0>Y(a,b)?a:b}function Sa(a){a.state.focused||(a.display.input.focus(),nd(a))}function Ja(a){return a.options.readOnly||a.doc.cantEdit}function ba(a,b,c,f,d){var u=a.doc;a.display.shift=!1;f||(f=u.sel);var g=a.state.pasteIncoming||
"paste"==d,x=u.splitLines(b),E=null;if(g&&1<f.ranges.length)if(Pa&&Pa.join("\n")==b){if(0==f.ranges.length%Pa.length){E=[];for(var h=0;h<Pa.length;h++)E.push(u.splitLines(Pa[h]))}}else x.length==f.ranges.length&&(E=Ic(x,function(a){return[a]}));for(h=f.ranges.length-1;0<=h;h--){var O=f.ranges[h],ca=O.from(),n=O.to();O.empty()&&(c&&0<c?ca=L(ca.line,ca.ch-c):a.state.overwrite&&!g&&(n=L(n.line,Math.min(T(u,n.line).text.length,n.ch+ka(x).length))));O=a.curOp.updateInput;ca={from:ca,to:n,text:E?E[h%E.length]:
x,origin:d||(g?"paste":a.state.cutIncoming?"cut":"+input")};Nb(a.doc,ca);Aa(a,"inputRead",a,ca)}b&&!g&&db(a,b);Ob(a);a.curOp.updateInput=O;a.curOp.typing=!0;a.state.pasteIncoming=a.state.cutIncoming=!1}function Ka(a,b){var c=a.clipboardData&&a.clipboardData.getData("text/plain");if(c)return a.preventDefault(),La(b,function(){ba(b,c,0,null,"paste")}),!0}function db(a,b){if(a.options.electricChars&&a.options.smartIndent)for(var c=a.doc.sel,f=c.ranges.length-1;0<=f;f--){var u=c.ranges[f];if(!(100<u.head.ch||
f&&c.ranges[f-1].head.line==u.head.line)){var d=a.getModeAt(u.head),g=!1;if(d.electricChars)for(var x=0;x<d.electricChars.length;x++){if(-1<b.indexOf(d.electricChars.charAt(x))){g=pc(a,u.head.line,"smart");break}}else d.electricInput&&d.electricInput.test(T(a.doc,u.head.line).text.slice(0,u.head.ch))&&(g=pc(a,u.head.line,"smart"));g&&Aa(a,"electricInput",a,u.head.line)}}}function Pb(a){for(var b=[],c=[],f=0;f<a.doc.sel.ranges.length;f++){var u=a.doc.sel.ranges[f].head.line;u={anchor:L(u,0),head:L(u+
1,0)};c.push(u);b.push(a.getRange(u.anchor,u.head))}return{text:b,ranges:c}}function qb(a){a.setAttribute("autocorrect","off");a.setAttribute("autocapitalize","off");a.setAttribute("spellcheck","false")}function rb(a){this.cm=a;this.prevInput="";this.pollingFast=!1;this.polling=new ec;this.hasSelection=this.inaccurateSelection=!1;this.composing=null}function Jc(){var a=Q("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none"),b=Q("div",[a],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");
wa?a.style.width="1000px":a.setAttribute("wrap","off");Qb&&(a.style.border="1px solid black");qb(a);return b}function Rb(a){this.cm=a;this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null;this.polling=new ec;this.gracePeriod=!1}function Kc(a,b){var c=sd(a,b.line);if(!c||c.hidden)return null;a=T(a.doc,b.line);c=ee(c,a,b.line);a=Va(a);var f="left";a&&(f=Lc(a,b.ch)%2?"right":"left");b=fe(c.map,b.ch,f);b.offset="right"==b.collapse?b.end:b.start;return b}function ib(a,
b){b&&(a.bad=!0);return a}function Sb(a,b,c){if(b==a.display.lineDiv){var f=a.display.lineDiv.childNodes[c];if(!f)return ib(a.clipPos(L(a.display.viewTo-1)),!0);b=null;c=0}else for(f=b;;f=f.parentNode){if(!f||f==a.display.lineDiv)return null;if(f.parentNode&&f.parentNode==a.display.lineDiv)break}for(var u=0;u<a.display.view.length;u++){var d=a.display.view[u];if(d.node==f)return td(d,b,c)}}function td(a,b,c){function f(b,c,f){for(var u=-1;u<(h?h.length:0);u++)for(var d=0>u?E.map:h[u],g=0;g<d.length;g+=
3){var x=d[g+2];if(x==b||x==c){c=na(0>u?a.line:a.rest[u]);u=d[g]+f;if(0>f||x!=b)u=d[g+(f?1:0)];return L(c,u)}}}var u=a.text.firstChild,d=!1;if(!b||!ud(u,b))return ib(L(na(a.line),0),!0);if(b==u&&(d=!0,b=u.childNodes[c],c=0,!b))return c=a.rest?ka(a.rest):a.line,ib(L(na(c),c.text.length),d);var g=3==b.nodeType?b:null,x=b;g||1!=b.childNodes.length||3!=b.firstChild.nodeType||(g=b.firstChild,c&&(c=g.nodeValue.length));for(;x.parentNode!=u;)x=x.parentNode;var E=a.measure,h=E.maps;if(b=f(g,x,c))return ib(b,
d);u=x.nextSibling;for(g=g?g.nodeValue.length-c:0;u;u=u.nextSibling){if(b=f(u,u.firstChild,0))return ib(L(b.line,b.ch-g),d);g+=u.textContent.length}x=x.previousSibling;for(g=c;x;x=x.previousSibling){if(b=f(x,x.firstChild,-1))return ib(L(b.line,b.ch+g),d);g+=u.textContent.length}}function Mc(a,b,c,f,d){function u(a){return function(b){return b.id==a}}function g(b){if(1==b.nodeType){var c=b.getAttribute("cm-text");if(null!=c)""==c&&(c=b.textContent.replace(/\u200b/g,"")),x+=c;else{c=b.getAttribute("cm-marker");
var O;if(c)b=a.findMarks(L(f,0),L(d+1,0),u(+c)),b.length&&(O=b[0].find())&&(x+=Cb(a.doc,O.from,O.to).join(h));else if("false"!=b.getAttribute("contenteditable")){for(O=0;O<b.childNodes.length;O++)g(b.childNodes[O]);/^(pre|div|p)$/i.test(b.nodeName)&&(E=!0)}}}else 3==b.nodeType&&(b=b.nodeValue)&&(E&&(x+=h,E=!1),x+=b)}for(var x="",E=!1,h=a.doc.lineSeparator();;){g(b);if(b==c)break;b=b.nextSibling}return x}function Ma(a,b){this.ranges=a;this.primIndex=b}function la(a,b){this.anchor=a;this.head=b}function Na(a,
b){b=a[b];a.sort(function(a,b){return Y(a.from(),b.from())});b=za(a,b);for(var c=1;c<a.length;c++){var f=a[c],u=a[c-1];if(0<=Y(u.to(),f.from())){var d=xa(u.from(),f.from()),g=Za(u.to(),f.to());f=u.empty()?f.from()==f.head:u.from()==u.head;c<=b&&--b;a.splice(--c,2,new la(f?g:d,f?d:g))}}return new Ma(a,b)}function sa(a,b){return new Ma([new la(a,b||a)],0)}function S(a,b){if(b.line<a.first)return L(a.first,0);var c=a.first+a.size-1;if(b.line>c)return L(c,T(a,c).text.length);a=T(a,b.line).text.length;
c=b.ch;b=null==c||c>a?L(b.line,a):0>c?L(b.line,0):b;return b}function jb(a,b){return b>=a.first&&b<a.first+a.size}function Db(a,b,c,f){return a.cm&&a.cm.display.shift||a.extend?(a=b.anchor,f&&(b=0>Y(c,a),b!=0>Y(f,a)?(a=c,c=f):b!=0>Y(c,f)&&(c=f)),new la(a,c)):new la(f||c,c)}function F(a,b,c,f){ma(a,new Ma([Db(a,a.sel.primary(),b,c)],0),f)}function N(a,b,c){for(var f=[],u=0;u<a.sel.ranges.length;u++)f[u]=Db(a,a.sel.ranges[u],b[u],null);b=Na(f,a.sel.primIndex);ma(a,b,c)}function ea(a,b,c,f){var u=a.sel.ranges.slice(0);
u[b]=c;ma(a,Na(u,a.sel.primIndex),f)}function Da(a,b){var c={ranges:b.ranges,update:function(b){this.ranges=[];for(var c=0;c<b.length;c++)this.ranges[c]=new la(S(a,b[c].anchor),S(a,b[c].head))}};va(a,"beforeSelectionChange",a,c);a.cm&&va(a.cm,"beforeSelectionChange",a.cm,c);return c.ranges!=b.ranges?Na(c.ranges,c.ranges.length-1):b}function Ga(a,b,c){var f=a.history.done,u=ka(f);u&&u.ranges?(f[f.length-1]=b,Wa(a,b,c)):ma(a,b,c)}function ma(a,b,c){Wa(a,b,c);b=a.sel;var f=a.cm?a.cm.curOp.id:NaN,u=a.history,
d=c&&c.origin,g;if(!(g=f==u.lastSelOp)&&(g=d&&u.lastSelOrigin==d)&&!(g=u.lastModTime==u.lastSelTime&&u.lastOrigin==d)){g=ka(u.done);var x=d.charAt(0);g="*"==x||"+"==x&&g.ranges.length==b.ranges.length&&g.somethingSelected()==b.somethingSelected()&&new Date-a.history.lastSelTime<=(a.cm?a.cm.options.historyEventDelay:500)}g?u.done[u.done.length-1]=b:Nc(b,u.done);u.lastSelTime=+new Date;u.lastSelOrigin=d;u.lastSelOp=f;c&&!1!==c.clearRedo&&ge(u.undone)}function Wa(a,b,c){if(Qa(a,"beforeSelectionChange")||
a.cm&&Qa(a.cm,"beforeSelectionChange"))b=Da(a,b);var f=c&&c.bias||(0>Y(b.primary().head,a.sel.primary().head)?-1:1);he(a,ie(a,b,f,!0));c&&!1===c.scroll||!a.cm||Ob(a.cm)}function he(a,b){b.equals(a.sel)||(a.sel=b,a.cm&&(a.cm.curOp.updateInput=a.cm.curOp.selectionChanged=!0,je(a.cm)),Aa(a,"cursorActivity",a))}function ke(a){he(a,ie(a,a.sel,null,!1),eb)}function ie(a,b,c,f){for(var u,d=0;d<b.ranges.length;d++){var g=b.ranges[d],x=Oc(a,g.anchor,c,f),h=Oc(a,g.head,c,f);if(u||x!=g.anchor||h!=g.head)u||
(u=b.ranges.slice(0,d)),u[d]=new la(x,h)}return u?Na(u,b.primIndex):b}function Oc(a,b,c,f){var u=!1,d=b,g=c||1;a.cantEdit=!1;a:for(;;){var x=T(a,d.line);if(x.markedSpans)for(var h=0;h<x.markedSpans.length;++h){var E=x.markedSpans[h],O=E.marker;if((null==E.from||(O.inclusiveLeft?E.from<=d.ch:E.from<d.ch))&&(null==E.to||(O.inclusiveRight?E.to>=d.ch:E.to>d.ch))){if(f&&(va(O,"beforeCursorEnter"),O.explicitlyCleared))if(x.markedSpans){--h;continue}else break;if(O.atomic){h=O.find(0>g?-1:1);if(0==Y(h,d)&&
(h.ch+=g,0>h.ch?h=h.line>a.first?S(a,L(h.line-1)):null:h.ch>x.text.length&&(h=h.line<a.first+a.size-1?L(h.line+1,0):null),!h)){if(u){if(!f)return Oc(a,b,c,!0);a.cantEdit=!0;return L(a.first,0)}u=!0;h=b;g=-g}d=h;continue a}}}return d}}function oc(a){a.display.input.showSelection(a.display.input.prepareSelection())}function le(a,b){for(var c=a.doc,f={},u=f.cursors=document.createDocumentFragment(),d=f.selection=document.createDocumentFragment(),g=0;g<c.sel.ranges.length;g++)if(!1!==b||g!=c.sel.primIndex){var x=
c.sel.ranges[g],h=x.empty();if(h||a.options.showCursorWhenSelecting){var n=a,m=u,p=kb(n,x.head,"div",null,null,!n.options.singleCursorHeightPerLine),q=m.appendChild(Q("div","\u00a0","CodeMirror-cursor"));q.style.left=p.left+"px";q.style.top=p.top+"px";q.style.height=Math.max(0,p.bottom-p.top)*n.options.cursorHeight+"px";p.other&&(n=m.appendChild(Q("div","\u00a0","CodeMirror-cursor CodeMirror-secondarycursor")),n.style.display="",n.style.left=p.other.left+"px",n.style.top=p.other.top+"px",n.style.height=
.85*(p.other.bottom-p.other.top)+"px")}h||Af(a,x,d)}return f}function Af(a,b,c){function f(a,b,c,f){0>b&&(b=0);b=Math.round(b);f=Math.round(f);x.appendChild(Q("div",null,"CodeMirror-selected","position: absolute; left: "+a+"px; top: "+b+"px; width: "+(null==c?n-a:c)+"px; height: "+(f-b)+"px"))}function u(b,c,u){var d=T(g,b),x=d.text.length,h,O;Bf(Va(d),c||0,null==u?x:u,function(g,m,ca){var p=Pc(a,L(b,g),"div",d,"left"),q;if(g==m){var F=p;ca=q=p.left}else F=Pc(a,L(b,m-1),"div",d,"right"),"rtl"==ca&&
(ca=p,p=F,F=ca),ca=p.left,q=F.right;null==c&&0==g&&(ca=E);3<F.top-p.top&&(f(ca,p.top,null,p.bottom),ca=E,p.bottom<F.top&&f(ca,p.bottom,null,F.top));null==u&&m==x&&(q=n);if(!h||p.top<h.top||p.top==h.top&&p.left<h.left)h=p;if(!O||F.bottom>O.bottom||F.bottom==O.bottom&&F.right>O.right)O=F;ca<E+1&&(ca=E);f(ca,F.top,q-ca,F.bottom)});return{start:h,end:O}}var d=a.display,g=a.doc,x=document.createDocumentFragment(),h=ne(a.display),E=h.left,n=Math.max(d.sizerWidth,nb(a)-d.sizer.offsetLeft)-h.right;d=b.from();
b=b.to();if(d.line==b.line)u(d.line,d.ch,b.ch);else{var m=T(g,d.line);h=T(g,b.line);h=fb(m)==fb(h);d=u(d.line,d.ch,h?m.text.length+1:null).end;b=u(b.line,h?0:null,b.ch).start;h&&(d.top<b.top-2?(f(d.right,d.top,null,d.bottom),f(E,b.top,b.left,b.bottom)):f(d.right,d.top,b.left-d.right,d.bottom));d.bottom<b.top&&f(E,d.bottom,null,b.top)}c.appendChild(x)}function vd(a){if(a.state.focused){var b=a.display;clearInterval(b.blinker);var c=!0;b.cursorDiv.style.visibility="";0<a.options.cursorBlinkRate?b.blinker=
setInterval(function(){b.cursorDiv.style.visibility=(c=!c)?"":"hidden"},a.options.cursorBlinkRate):0>a.options.cursorBlinkRate&&(b.cursorDiv.style.visibility="hidden")}}function hc(a,b){a.doc.mode.startState&&a.doc.frontier<a.display.viewTo&&a.state.highlight.set(b,fc(Cf,a))}function Cf(a){var b=a.doc;b.frontier<b.first&&(b.frontier=b.first);if(!(b.frontier>=a.display.viewTo)){var c=+new Date+a.options.workTime,f=Tb(b.mode,qc(a,b.frontier)),u=[];b.iter(b.frontier,Math.min(b.first+b.size,a.display.viewTo+
500),function(d){if(b.frontier>=a.display.viewFrom){var g=d.styles,x=oe(a,d,f,!0);d.styles=x.styles;var h=d.styleClasses;(x=x.classes)?d.styleClasses=x:h&&(d.styleClasses=null);h=!g||g.length!=d.styles.length||h!=x&&(!h||!x||h.bgClass!=x.bgClass||h.textClass!=x.textClass);for(x=0;!h&&x<g.length;++x)h=g[x]!=d.styles[x];h&&u.push(b.frontier);d.stateAfter=Tb(b.mode,f)}else wd(a,d.text,f),d.stateAfter=0==b.frontier%5?Tb(b.mode,f):null;++b.frontier;if(+new Date>c)return hc(a,a.options.workDelay),!0});
u.length&&La(a,function(){for(var b=0;b<u.length;b++)lb(a,u[b],"text")})}}function Df(a,b,c){for(var f,u,d=a.doc,g=c?-1:b-(a.doc.mode.innerMode?1E3:100);b>g;--b){if(b<=d.first)return d.first;var x=T(d,b-1);if(x.stateAfter&&(!c||b<=d.frontier))return b;x=Xa(x.text,null,a.options.tabSize);if(null==u||f>x)u=b-1,f=x}return u}function qc(a,b,c){var f=a.doc,u=a.display;if(!f.mode.startState)return!0;var d=Df(a,b,c),g=d>f.first&&T(f,d-1).stateAfter;g=g?Tb(f.mode,g):Ef(f.mode);f.iter(d,b,function(c){wd(a,
c.text,g);c.stateAfter=d==b-1||0==d%5||d>=u.viewFrom&&d<u.viewTo?Tb(f.mode,g):null;++d});c&&(f.frontier=d);return g}function pd(a){return a.mover.offsetHeight-a.lineSpace.offsetHeight}function ne(a){if(a.cachedPaddingH)return a.cachedPaddingH;var b=Ra(a.measure,Q("pre","x"));b=window.getComputedStyle?window.getComputedStyle(b):b.currentStyle;b={left:parseInt(b.paddingLeft),right:parseInt(b.paddingRight)};isNaN(b.left)||isNaN(b.right)||(a.cachedPaddingH=b);return b}function ab(a){return ae-a.display.nativeBarWidth}
function nb(a){return a.display.scroller.clientWidth-ab(a)-a.display.barWidth}function rd(a){return a.display.scroller.clientHeight-ab(a)-a.display.barHeight}function ee(a,b,c){if(a.line==b)return{map:a.measure.map,cache:a.measure.cache};for(var f=0;f<a.rest.length;f++)if(a.rest[f]==b)return{map:a.measure.maps[f],cache:a.measure.caches[f]};for(f=0;f<a.rest.length;f++)if(na(a.rest[f])>c)return{map:a.measure.maps[f],cache:a.measure.caches[f],before:!0}}function sd(a,b){if(b>=a.display.viewFrom&&b<a.display.viewTo)return a.display.view[Bb(a,
b)];if((a=a.display.externalMeasured)&&b>=a.lineN&&b<a.lineN+a.size)return a}function Qc(a,b){var c=na(b),f=sd(a,c);f&&!f.text?f=null:f&&f.changes&&(X(a,f,c,ua(a)),a.curOp.forceUpdate=!0);if(!f){var u=fb(b);f=na(u);u=a.display.externalMeasured=new pe(a.doc,u,f);u.lineN=f;f=u.built=de(a,u);u.text=f.pre;Ra(a.display.lineMeasure,f.pre);f=u}a=ee(f,b,c);return{line:b,view:f,rect:null,map:a.map,cache:a.cache,before:a.before,hasHeights:!1}}function xd(a,b,c,f,d){b.before&&(c=-1);var u=c+(f||"");if(b.cache.hasOwnProperty(u))a=
b.cache[u];else{b.rect||(b.rect=b.view.text.getBoundingClientRect());if(!b.hasHeights){var g=b.view,x=b.rect,h=a.options.lineWrapping,E=h&&nb(a);if(!g.measure.heights||h&&g.measure.width!=E){var O=g.measure.heights=[];if(h)for(g.measure.width=E,g=g.text.firstChild.getClientRects(),h=0;h<g.length-1;h++){E=g[h];var n=g[h+1];2<Math.abs(E.bottom-n.bottom)&&O.push((E.bottom+n.top)/2-x.top)}O.push(x.bottom-x.top)}b.hasHeights=!0}g=f;h=fe(b.map,c,g);f=h.node;x=h.start;E=h.end;c=h.collapse;if(3==f.nodeType){for(O=
0;4>O;O++){for(;x&&rc(b.line.text.charAt(h.coverStart+x));)--x;for(;h.coverStart+E<h.coverEnd&&rc(b.line.text.charAt(h.coverStart+E));)++E;if(ha&&9>pa&&0==x&&E==h.coverEnd-h.coverStart)var m=f.parentNode.getBoundingClientRect();else if(ha&&a.options.lineWrapping){var p=Ub(f,x,E).getClientRects();m=p.length?p["right"==g?p.length-1:0]:yd}else m=Ub(f,x,E).getBoundingClientRect()||yd;if(m.left||m.right||0==x)break;E=x;--x;c="right"}ha&&11>pa&&((p=!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==
screen.deviceXDPI)||(null!=zd?p=zd:(O=Ra(a.display.measure,Q("span","x")),p=O.getBoundingClientRect(),O=Ub(O,0,1).getBoundingClientRect(),p=zd=1<Math.abs(p.left-O.left)),p=!p),p||(p=screen.logicalXDPI/screen.deviceXDPI,O=screen.logicalYDPI/screen.deviceYDPI,m={left:m.left*p,right:m.right*p,top:m.top*O,bottom:m.bottom*O}))}else 0<x&&(c=g="right"),m=a.options.lineWrapping&&1<(p=f.getClientRects()).length?p["right"==g?p.length-1:0]:f.getBoundingClientRect();!(ha&&9>pa)||x||m&&(m.left||m.right)||(m=(m=
f.parentNode.getClientRects()[0])?{left:m.left,right:m.left+ic(a.display),top:m.top,bottom:m.bottom}:yd);p=m.top-b.rect.top;f=m.bottom-b.rect.top;x=(p+f)/2;g=b.view.measure.heights;for(O=0;O<g.length-1&&!(x<g[O]);O++);c={left:("right"==c?m.right:m.left)-b.rect.left,right:("left"==c?m.left:m.right)-b.rect.left,top:O?g[O-1]:0,bottom:g[O]};m.left||m.right||(c.bogus=!0);a.options.singleCursorHeightPerLine||(c.rtop=p,c.rbottom=f);a=c;a.bogus||(b.cache[u]=a)}return{left:a.left,right:a.right,top:d?a.rtop:
a.top,bottom:d?a.rbottom:a.bottom}}function fe(a,b,c){for(var f,d,u,g,x=0;x<a.length;x+=3){var h=a[x],E=a[x+1];if(b<h)d=0,u=1,g="left";else if(b<E)d=b-h,u=d+1;else if(x==a.length-3||b==E&&a[x+3]>b)u=E-h,d=u-1,b>=E&&(g="right");if(null!=d){f=a[x+2];h==E&&c==(f.insertLeft?"left":"right")&&(g=c);if("left"==c&&0==d)for(;x&&a[x-2]==a[x-3]&&a[x-1].insertLeft;)f=a[(x-=3)+2],g="left";if("right"==c&&d==E-h)for(;x<a.length-3&&a[x+3]==a[x+4]&&!a[x+5].insertLeft;)f=a[(x+=3)+2],g="right";break}}return{node:f,
start:d,end:u,collapse:g,coverStart:h,coverEnd:E}}function qe(a){if(a.measure&&(a.measure.cache={},a.measure.heights=null,a.rest))for(var b=0;b<a.rest.length;b++)a.measure.caches[b]={}}function re(a){a.display.externalMeasure=null;yb(a.display.lineMeasure);for(var b=0;b<a.display.view.length;b++)qe(a.display.view[b])}function jc(a){re(a);a.display.cachedCharWidth=a.display.cachedTextHeight=a.display.cachedPaddingH=null;a.options.lineWrapping||(a.display.maxLineChanged=!0);a.display.lineNumChars=null}
function Ad(a,b,c,f){if(b.widgets)for(var d=0;d<b.widgets.length;++d)if(b.widgets[d].above){var u=sc(b.widgets[d]);c.top+=u;c.bottom+=u}if("line"==f)return c;f||(f="local");b=bb(b);b="local"==f?b+a.display.lineSpace.offsetTop:b-a.display.viewOffset;if("page"==f||"window"==f)a=a.display.lineSpace.getBoundingClientRect(),b+=a.top+("window"==f?0:window.pageYOffset||(document.documentElement||document.body).scrollTop),f=a.left+("window"==f?0:window.pageXOffset||(document.documentElement||document.body).scrollLeft),
c.left+=f,c.right+=f;c.top+=b;c.bottom+=b;return c}function se(a,b,c){if("div"==c)return b;var f=b.left;b=b.top;"page"==c?(f-=window.pageXOffset||(document.documentElement||document.body).scrollLeft,b-=window.pageYOffset||(document.documentElement||document.body).scrollTop):"local"!=c&&c||(c=a.display.sizer.getBoundingClientRect(),f+=c.left,b+=c.top);a=a.display.lineSpace.getBoundingClientRect();return{left:f-a.left,top:b-a.top}}function Pc(a,b,c,f,d){f||(f=T(a.doc,b.line));var u=f;b=b.ch;f=xd(a,
Qc(a,f),b,d);return Ad(a,u,f,c)}function kb(a,b,c,f,d,g){function u(b,u){b=xd(a,d,b,u?"right":"left",g);u?b.left=b.right:b.right=b.left;return Ad(a,f,b,c)}function x(a,b){var c=h[b],f=c.level%2;a==Bd(c)&&b&&c.level<h[b-1].level?(c=h[--b],a=Cd(c)-(c.level%2?0:1),f=!0):a==Cd(c)&&b<h.length-1&&c.level<h[b+1].level&&(c=h[++b],a=Bd(c)-c.level%2,f=!1);return f&&a==c.to&&a>c.from?u(a-1):u(a,f)}f=f||T(a.doc,b.line);d||(d=Qc(a,f));var h=Va(f);b=b.ch;if(!h)return u(b);var E=Lc(h,b);E=x(b,E);null!=tc&&(E.other=
x(b,tc));return E}function te(a,b){var c=0;b=S(a.doc,b);a.options.lineWrapping||(c=ic(a.display)*b.ch);b=T(a.doc,b.line);a=bb(b)+a.display.lineSpace.offsetTop;return{left:c,right:c,top:a,bottom:a+b.height}}function Rc(a,b,c,f){a=L(a,b);a.xRel=f;c&&(a.outside=!0);return a}function Dd(a,b,c){var f=a.doc;c+=a.display.viewOffset;if(0>c)return Rc(f.first,0,!0,-1);var d=Ab(f,c),u=f.first+f.size-1;if(d>u)return Rc(f.first+f.size-1,T(f,u).text.length,!0,1);0>b&&(b=0);for(f=T(f,d);;)if(d=Ff(a,f,d,b,c),u=(f=
zb(f,!1))&&f.find(0,!0),f&&(d.ch>u.from.ch||d.ch==u.from.ch&&0<d.xRel))d=na(f=u.to.line);else return d}function Ff(a,b,c,f,d){function u(f){f=kb(a,L(c,f),"line",b,E);x=!0;if(g>f.bottom)return f.left-h;if(g<f.top)return f.left+h;x=!1;return f.left}var g=d-bb(b),x=!1,h=2*a.display.wrapper.clientWidth,E=Qc(a,b),n=Va(b),O=b.text.length;d=Sc(b);var m=Tc(b),p=u(d),ca=x,q=u(m),F=x;if(f>q)return Rc(c,m,F,1);for(;;){if(n?m==d||m==Ed(b,d,1):1>=m-d){n=f<p||f-p<=q-f?d:m;for(f-=n==d?p:q;rc(b.text.charAt(n));)++n;
return Rc(c,n,n==d?ca:F,-1>f?-1:1<f?1:0)}var r=Math.ceil(O/2),t=d+r;if(n){t=d;for(var w=0;w<r;++w)t=Ed(b,t,1)}w=u(t);if(w>f){m=t;q=w;if(F=x)q+=1E3;O=r}else d=t,p=w,ca=x,O-=r}}function vb(a){if(null!=a.cachedTextHeight)return a.cachedTextHeight;if(null==Eb){Eb=Q("pre");for(var b=0;49>b;++b)Eb.appendChild(document.createTextNode("x")),Eb.appendChild(Q("br"));Eb.appendChild(document.createTextNode("x"))}Ra(a.measure,Eb);b=Eb.offsetHeight/50;3<b&&(a.cachedTextHeight=b);yb(a.measure);return b||1}function ic(a){if(null!=
a.cachedCharWidth)return a.cachedCharWidth;var b=Q("span","xxxxxxxxxx"),c=Q("pre",[b]);Ra(a.measure,c);b=b.getBoundingClientRect();b=(b.right-b.left)/10;2<b&&(a.cachedCharWidth=b);return b||10}function Jb(a){a.curOp={cm:a,viewChanged:!1,startHeight:a.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++Gf};Vb?Vb.ops.push(a.curOp):a.curOp.ownsGroup=
Vb={ops:[a.curOp],delayedCallbacks:[]}}function Lb(a){if(a=a.curOp.ownsGroup)try{var b=a.delayedCallbacks,c=0;do{for(;c<b.length;c++)b[c].call(null);for(var f=0;f<a.ops.length;f++){var d=a.ops[f];if(d.cursorActivityHandlers)for(;d.cursorActivityCalled<d.cursorActivityHandlers.length;)d.cursorActivityHandlers[d.cursorActivityCalled++].call(null,d.cm)}}while(c<b.length)}finally{Vb=null;for(b=0;b<a.ops.length;b++)a.ops[b].cm.curOp=null;a=a.ops;for(b=0;b<a.length;b++){d=a[b];c=d.cm;var u=f=c.display;
!u.scrollbarsClipped&&u.scroller.offsetWidth&&(u.nativeBarWidth=u.scroller.offsetWidth-u.scroller.clientWidth,u.heightForcer.style.height=ab(c)+"px",u.sizer.style.marginBottom=-u.nativeBarWidth+"px",u.sizer.style.borderRightWidth=ab(c)+"px",u.scrollbarsClipped=!0);d.updateMaxLine&&z(c);d.mustUpdate=d.viewChanged||d.forceUpdate||null!=d.scrollTop||d.scrollToPos&&(d.scrollToPos.from.line<f.viewFrom||d.scrollToPos.to.line>=f.viewTo)||f.maxLineChanged&&c.options.lineWrapping;d.update=d.mustUpdate&&new P(c,
d.mustUpdate&&{top:d.scrollTop,ensure:d.scrollToPos},d.forceUpdate)}for(b=0;b<a.length;b++)d=a[b],d.updatedDisplay=d.mustUpdate&&K(d.cm,d.update);for(b=0;b<a.length;b++)if(d=a[b],c=d.cm,f=c.display,d.updatedDisplay&&fa(c),d.barMeasure=v(c),f.maxLineChanged&&!c.options.lineWrapping&&(u=f.maxLine.text.length,u=xd(c,Qc(c,f.maxLine),u,void 0),d.adjustWidthTo=u.left+3,c.display.sizerWidth=d.adjustWidthTo,d.barMeasure.scrollWidth=Math.max(f.scroller.clientWidth,f.sizer.offsetLeft+d.adjustWidthTo+ab(c)+
c.display.barWidth),d.maxScrollLeft=Math.max(0,f.sizer.offsetLeft+d.adjustWidthTo-nb(c))),d.updatedDisplay||d.selectionChanged)d.preparedSelection=f.input.prepareSelection();for(b=0;b<a.length;b++)d=a[b],c=d.cm,null!=d.adjustWidthTo&&(c.display.sizer.style.minWidth=d.adjustWidthTo+"px",d.maxScrollLeft<c.doc.scrollLeft&&Mb(c,Math.min(c.display.scroller.scrollLeft,d.maxScrollLeft),!0),c.display.maxLineChanged=!1),d.preparedSelection&&c.display.input.showSelection(d.preparedSelection),d.updatedDisplay&&
C(c,d.barMeasure),(d.updatedDisplay||d.startHeight!=c.doc.height)&&B(c,d.barMeasure),d.selectionChanged&&vd(c),c.state.focused&&d.updateInput&&c.display.input.reset(d.typing),d.focus&&d.focus==cb()&&Sa(d.cm);for(b=0;b<a.length;b++){d=a[b];c=d.cm;f=c.display;u=c.doc;d.updatedDisplay&&R(c,d.update);null==f.wheelStartX||null==d.scrollTop&&null==d.scrollLeft&&!d.scrollToPos||(f.wheelStartX=f.wheelStartY=null);null==d.scrollTop||f.scroller.scrollTop==d.scrollTop&&!d.forceScroll||(u.scrollTop=Math.max(0,
Math.min(f.scroller.scrollHeight-f.scroller.clientHeight,d.scrollTop)),f.scrollbars.setScrollTop(u.scrollTop),f.scroller.scrollTop=u.scrollTop);null==d.scrollLeft||f.scroller.scrollLeft==d.scrollLeft&&!d.forceScroll||(u.scrollLeft=Math.max(0,Math.min(f.scroller.scrollWidth-nb(c),d.scrollLeft)),f.scrollbars.setScrollLeft(u.scrollLeft),f.scroller.scrollLeft=u.scrollLeft,M(c));if(d.scrollToPos){var g=S(u,d.scrollToPos.from);var h=S(u,d.scrollToPos.to);var n=d.scrollToPos.margin;null==n&&(n=0);for(var m=
0;5>m;m++){var p=!1,q=kb(c,g),F=h&&h!=g?kb(c,h):q;F=Uc(c,Math.min(q.left,F.left),Math.min(q.top,F.top)-n,Math.max(q.left,F.left),Math.max(q.bottom,F.bottom)+n);var r=c.doc.scrollTop,t=c.doc.scrollLeft;null!=F.scrollTop&&(lc(c,F.scrollTop),1<Math.abs(c.doc.scrollTop-r)&&(p=!0));null!=F.scrollLeft&&(Mb(c,F.scrollLeft),1<Math.abs(c.doc.scrollLeft-t)&&(p=!0));if(!p)break}h=q;d.scrollToPos.isCursor&&c.state.focused&&(gb(c,"scrollCursorIntoView")||(n=c.display,m=n.sizer.getBoundingClientRect(),g=null,0>
h.top+m.top?g=!0:h.bottom+m.top>(window.innerHeight||document.documentElement.clientHeight)&&(g=!1),null==g||Hf||(h=Q("div","\u200b",null,"position: absolute; top: "+(h.top-n.viewOffset-c.display.lineSpace.offsetTop)+"px; height: "+(h.bottom-h.top+ab(c)+n.barHeight)+"px; left: "+h.left+"px; width: 2px;"),c.display.lineSpace.appendChild(h),h.scrollIntoView(g),c.display.lineSpace.removeChild(h))))}g=d.maybeHiddenMarkers;h=d.maybeUnhiddenMarkers;if(g)for(n=0;n<g.length;++n)g[n].lines.length||va(g[n],
"hide");if(h)for(n=0;n<h.length;++n)h[n].lines.length&&va(h[n],"unhide");f.wrapper.offsetHeight&&(u.scrollTop=c.display.scroller.scrollTop);d.changeObjs&&va(c,"changes",c,d.changeObjs);d.update&&d.update.finish()}}}function La(a,b){if(a.curOp)return b();Jb(a);try{return b()}finally{Lb(a)}}function ta(a,b){return function(){if("EditorRich"!=virtualclass.currApp||"onKeyDown"!=b.name||!arguments[0].ctrlKey||90!=arguments[0].keyCode&&89!=arguments[0].keyCode){if(a.curOp)return b.apply(a,arguments);Jb(a);
try{return b.apply(a,arguments)}finally{Lb(a)}}else virtualclass.editorRich.undoManager(arguments[0].keyCode)}}function ya(a){return function(){if(this.curOp)return a.apply(this,arguments);Jb(this);try{return a.apply(this,arguments)}finally{Lb(this)}}}function Ba(a){return function(){var b=this.cm;if(!b||b.curOp)return a.apply(this,arguments);Jb(b);try{return a.apply(this,arguments)}finally{Lb(b)}}}function pe(a,b,c){for(var f=this.line=b,d;f=zb(f,!1);)f=f.find(1,!0).line,(d||(d=[])).push(f);this.size=
(this.rest=d)?na(ka(this.rest))-c+1:1;this.node=this.text=null;this.hidden=xb(a,b)}function Hc(a,b,c){var f=[],d;for(d=b;d<c;)b=new pe(a.doc,T(a.doc,d),d),d+=b.size,f.push(b);return f}function Fa(a,b,c,f){null==b&&(b=a.doc.first);null==c&&(c=a.doc.first+a.doc.size);f||(f=0);var d=a.display;f&&c<d.viewTo&&(null==d.updateLineNumbers||d.updateLineNumbers>b)&&(d.updateLineNumbers=b);a.curOp.viewChanged=!0;if(b>=d.viewTo)pb&&qd(a.doc,b)<d.viewTo&&ob(a);else if(c<=d.viewFrom)pb&&ce(a.doc,c+f)>d.viewFrom?
ob(a):(d.viewFrom+=f,d.viewTo+=f);else if(b<=d.viewFrom&&c>=d.viewTo)ob(a);else if(b<=d.viewFrom){var u=Vc(a,c,c+f,1);u?(d.view=d.view.slice(u.index),d.viewFrom=u.lineN,d.viewTo+=f):ob(a)}else if(c>=d.viewTo)(u=Vc(a,b,b,-1))?(d.view=d.view.slice(0,u.index),d.viewTo=u.lineN):ob(a);else{u=Vc(a,b,b,-1);var g=Vc(a,c,c+f,1);u&&g?(d.view=d.view.slice(0,u.index).concat(Hc(a,u.lineN,g.lineN)).concat(d.view.slice(g.index)),d.viewTo+=f):ob(a)}if(a=d.externalMeasured)c<a.lineN?a.lineN+=f:b<a.lineN+a.size&&(d.externalMeasured=
null)}function lb(a,b,c){a.curOp.viewChanged=!0;var f=a.display,d=a.display.externalMeasured;d&&b>=d.lineN&&b<d.lineN+d.size&&(f.externalMeasured=null);b<f.viewFrom||b>=f.viewTo||(a=f.view[Bb(a,b)],null!=a.node&&(a=a.changes||(a.changes=[]),-1==za(a,c)&&a.push(c)))}function ob(a){a.display.viewFrom=a.display.viewTo=a.doc.first;a.display.view=[];a.display.viewOffset=0}function Bb(a,b){if(b>=a.display.viewTo)return null;b-=a.display.viewFrom;if(0>b)return null;a=a.display.view;for(var c=0;c<a.length;c++)if(b-=
a[c].size,0>b)return c}function Vc(a,b,c,f){var d=Bb(a,b),u=a.display.view;if(!pb||c==a.doc.first+a.doc.size)return{index:d,lineN:c};for(var g=0,x=a.display.viewFrom;g<d;g++)x+=u[g].size;if(x!=b){if(0<f){if(d==u.length-1)return null;b=x+u[d].size-b;d++}else b=x-b;c+=b}for(;qd(a.doc,c)!=c;){if(d==(0>f?0:u.length-1))return null;c+=f*u[d-(0>f?1:0)].size;d+=f}return{index:d,lineN:c}}function be(a){a=a.display.view;for(var b=0,c=0;c<a.length;c++){var f=a[c];f.hidden||f.node&&!f.changes||++b}return b}function wf(a){function b(){f.activeTouch&&
(d=setTimeout(function(){f.activeTouch=null},1E3),u=f.activeTouch,u.end=+new Date)}function c(a,b){if(null==b.left)return!0;var c=b.left-a.left;a=b.top-a.top;return 400<c*c+a*a}var f=a.display;U(f.scroller,"mousedown",ta(a,ue));ha&&11>pa?U(f.scroller,"dblclick",ta(a,function(b){if(!gb(a,b)){var c=Wb(a,b);!c||Fd(a,b,"gutterClick",!0,Aa)||mb(a.display,b)||(Ca(b),b=a.findWordAt(c),F(a.doc,b.anchor,b.head))}})):U(f.scroller,"dblclick",function(b){gb(a,b)||Ca(b)});Gd||U(f.scroller,"contextmenu",function(b){ve(a,
b)});var d,u={end:0};U(f.scroller,"touchstart",function(a){if(1!=a.touches.length)var b=!1;else b=a.touches[0],b=1>=b.radiusX&&1>=b.radiusY;b||(clearTimeout(d),b=+new Date,f.activeTouch={start:b,moved:!1,prev:300>=b-u.end?u:null},1==a.touches.length&&(f.activeTouch.left=a.touches[0].pageX,f.activeTouch.top=a.touches[0].pageY))});U(f.scroller,"touchmove",function(){f.activeTouch&&(f.activeTouch.moved=!0)});U(f.scroller,"touchend",function(d){var u=f.activeTouch;if(u&&!mb(f,d)&&null!=u.left&&!u.moved&&
300>new Date-u.start){var g=a.coordsChar(f.activeTouch,"page");u=!u.prev||c(u,u.prev)?new la(g,g):!u.prev.prev||c(u,u.prev.prev)?a.findWordAt(g):new la(L(g.line,0),S(a.doc,L(g.line+1,0)));a.setSelection(u.anchor,u.head);a.focus();Ca(d)}b()});U(f.scroller,"touchcancel",b);U(f.scroller,"scroll",function(){f.scroller.clientHeight&&(lc(a,f.scroller.scrollTop),Mb(a,f.scroller.scrollLeft,!0),va(a,"scroll",a))});U(f.scroller,"mousewheel",function(b){we(a,b)});U(f.scroller,"DOMMouseScroll",function(b){we(a,
b)});U(f.wrapper,"scroll",function(){f.wrapper.scrollTop=f.wrapper.scrollLeft=0});f.dragFunctions={simple:function(b){gb(a,b)||Hd(b)},start:function(b){if(ha&&(!a.state.draggingText||100>+new Date-xe))Hd(b);else if(!gb(a,b)&&!mb(a.display,b)&&(b.dataTransfer.setData("Text",a.getSelection()),b.dataTransfer.setDragImage&&!ye)){var c=Q("img",null,null,"position: fixed; left: 0; top: 0;");c.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";Ya&&(c.width=c.height=1,a.display.wrapper.appendChild(c),
c._top=c.offsetTop);b.dataTransfer.setDragImage(c,0,0);Ya&&c.parentNode.removeChild(c)}},drop:ta(a,If)};var g=f.input.getField();U(g,"keyup",function(b){ze.call(a,b)});U(g,"keydown",ta(a,Ae));U(g,"keypress",ta(a,Be));U(g,"focus",fc(nd,a));U(g,"blur",fc(gc,a))}function Jf(a){var b=a.display;if(b.lastWrapHeight!=b.wrapper.clientHeight||b.lastWrapWidth!=b.wrapper.clientWidth)b.cachedCharWidth=b.cachedTextHeight=b.cachedPaddingH=null,b.scrollbarsClipped=!1,a.setSize()}function mb(a,b){for(b=b.target||
b.srcElement;b!=a.wrapper;b=b.parentNode)if(!b||1==b.nodeType&&"true"==b.getAttribute("cm-ignore-events")||b.parentNode==a.sizer&&b!=a.mover)return!0}function Wb(a,b,c,f){var d=a.display;if(!c&&"true"==(b.target||b.srcElement).getAttribute("cm-not-content"))return null;c=d.lineSpace.getBoundingClientRect();try{var u=b.clientX-c.left;var g=b.clientY-c.top}catch(yf){return null}b=Dd(a,u,g);var x;f&&1==b.xRel&&(x=T(a.doc,b.line).text).length==b.ch&&(f=Xa(x,x.length,a.options.tabSize)-x.length,b=L(b.line,
Math.max(0,Math.round((u-ne(a.display).left)/ic(a.display))-f)));return b}function ue(a){var b=this.display;if(!(b.activeTouch&&b.input.supportsTouch()||gb(this,a)))if(b.shift=a.shiftKey,mb(b,a))wa||(b.scroller.draggable=!1,setTimeout(function(){b.scroller.draggable=!0},100));else if(!Fd(this,a,"gutterClick",!0,Aa)){var c=Wb(this,a);window.focus();switch(Ce(a)){case 1:c?Kf(this,a,c):(a.target||a.srcElement)==b.scroller&&Ca(a);break;case 2:wa&&(this.state.lastMiddleDown=+new Date);c&&F(this.doc,c);
setTimeout(function(){b.input.focus()},20);Ca(a);break;case 3:Gd?ve(this,a):Lf(this)}}}function Kf(a,b,c){ha?setTimeout(fc(Sa,a),0):a.curOp.focus=cb();var f=+new Date;if(Wc&&Wc.time>f-400&&0==Y(Wc.pos,c))var d="triple";else Xc&&Xc.time>f-400&&0==Y(Xc.pos,c)?(d="double",Wc={time:f,pos:c}):(d="single",Xc={time:f,pos:c});f=a.doc.sel;var u=Ua?b.metaKey:b.ctrlKey,g;a.options.dragDrop&&Mf&&!Ja(a)&&"single"==d&&-1<(g=f.contains(c))&&(0>Y((g=f.ranges[g]).from(),c)||0<c.xRel)&&(0<Y(g.to(),c)||0>c.xRel)?Nf(a,
b,c,u):Of(a,b,c,d,u)}function Nf(a,b,c,f){var d=a.display,u=+new Date,g=ta(a,function(x){wa&&(d.scroller.draggable=!1);a.state.draggingText=!1;hb(document,"mouseup",g);hb(d.scroller,"drop",g);10>Math.abs(b.clientX-x.clientX)+Math.abs(b.clientY-x.clientY)&&(Ca(x),!f&&+new Date-200<u&&F(a.doc,c),wa||ha&&9==pa?setTimeout(function(){document.body.focus();d.input.focus()},20):d.input.focus())});wa&&(d.scroller.draggable=!0);a.state.draggingText=g;d.scroller.dragDrop&&d.scroller.dragDrop();U(document,"mouseup",
g);U(d.scroller,"drop",g)}function Of(a,b,c,f,d){function u(b){if(0!=Y(F,b))if(F=b,"rect"==f){var d=[],u=a.options.tabSize,g=Xa(T(E,c.line).text,c.ch,u),x=Xa(T(E,b.line).text,b.ch,u),h=Math.min(g,x);g=Math.max(g,x);x=Math.min(c.line,b.line);for(var m=Math.min(a.lastLine(),Math.max(c.line,b.line));x<=m;x++){var q=T(E,x).text,ca=De(q,h,u);h==g?d.push(new la(L(x,ca),L(x,ca))):q.length>ca&&d.push(new la(L(x,ca),L(x,De(q,g,u))))}d.length||d.push(new la(c,c));ma(E,Na(n.ranges.slice(0,p).concat(d),p),{origin:"*mouse",
scroll:!1});a.scrollIntoView(b)}else d=O,u=d.anchor,h=b,"single"!=f&&(b="double"==f?a.findWordAt(b):new la(L(b.line,0),S(E,L(b.line+1,0))),0<Y(b.anchor,u)?(h=b.head,u=xa(d.from(),b.anchor)):(h=b.anchor,u=Za(d.to(),b.head))),d=n.ranges.slice(0),d[p]=new la(S(E,u),h),ma(E,Na(d,p),Id)}function g(b){var c=++r,d=Wb(a,b,!0,"rect"==f);if(d)if(0!=Y(d,F)){a.curOp.focus=cb();u(d);var x=H(h,E);(d.line>=x.to||d.line<x.from)&&setTimeout(ta(a,function(){r==c&&g(b)}),150)}else{var n=b.clientY<ca.top?-20:b.clientY>
ca.bottom?20:0;n&&setTimeout(ta(a,function(){r==c&&(h.scroller.scrollTop+=n,g(b))}),50)}}function x(a){r=Infinity;Ca(a);h.input.focus();hb(document,"mousemove",t);hb(document,"mouseup",w);E.history.lastSelOrigin=null}var h=a.display,E=a.doc;Ca(b);var n=E.sel,m=n.ranges;if(d&&!b.shiftKey){var p=E.sel.contains(c);var O=-1<p?m[p]:new la(c,c)}else O=E.sel.primary(),p=E.sel.primIndex;if(b.altKey)f="rect",d||(O=new la(c,c)),c=Wb(a,b,!0,!0),p=-1;else if("double"==f){var q=a.findWordAt(c);O=a.display.shift||
E.extend?Db(E,O,q.anchor,q.head):q}else"triple"==f?(q=new la(L(c.line,0),S(E,L(c.line+1,0))),O=a.display.shift||E.extend?Db(E,O,q.anchor,q.head):q):O=Db(E,O,c);d?-1==p?(p=m.length,ma(E,Na(m.concat([O]),p),{scroll:!1,origin:"*mouse"})):1<m.length&&m[p].empty()&&"single"==f&&!b.shiftKey?(ma(E,Na(m.slice(0,p).concat(m.slice(p+1)),0)),n=E.sel):ea(E,p,O,Id):(p=0,ma(E,new Ma([O],0),Id),n=E.sel);var F=c,ca=h.wrapper.getBoundingClientRect(),r=0,t=ta(a,function(a){Ce(a)?g(a):x(a)}),w=ta(a,x);U(document,"mousemove",
t);U(document,"mouseup",w)}function Fd(a,b,c,f,d){try{var u=b.clientX,g=b.clientY}catch(zf){return!1}if(u>=Math.floor(a.display.gutters.getBoundingClientRect().right))return!1;f&&Ca(b);f=a.display;var x=f.lineDiv.getBoundingClientRect();if(g>x.bottom||!Qa(a,c))return Jd(b);g-=x.top-f.viewOffset;for(x=0;x<a.options.gutters.length;++x){var h=f.gutters.childNodes[x];if(h&&h.getBoundingClientRect().right>=u)return u=Ab(a.doc,g),d(a,c,a,u,a.options.gutters[x],b),Jd(b)}}function If(a){var b=this;if(!gb(b,
a)&&!mb(b.display,a)){Ca(a);ha&&(xe=+new Date);var c=Wb(b,a,!0),f=a.dataTransfer.files;if(c&&!Ja(b))if(f&&f.length&&window.FileReader&&window.File){var d=f.length,u=Array(d),g=0;a=function(a,f){var x=new FileReader;x.onload=ta(b,function(){u[f]=x.result;if(++g==d){c=S(b.doc,c);var a={from:c,to:c,text:b.doc.splitLines(u.join(b.doc.lineSeparator())),origin:"paste"};Nb(b.doc,a);Ga(b.doc,sa(c,Fb(a)))}});x.readAsText(a)};for(var h=0;h<d;++h)a(f[h],h)}else if(b.state.draggingText&&-1<b.doc.sel.contains(c))b.state.draggingText(a),
setTimeout(function(){b.display.input.focus()},20);else try{if(u=a.dataTransfer.getData("Text")){if(b.state.draggingText&&(Ua?!a.altKey:!a.ctrlKey))var n=b.listSelections();Wa(b.doc,sa(c,c));if(n)for(h=0;h<n.length;++h)Xb(b.doc,"",n[h].anchor,n[h].head,"drag");b.replaceSelection(u,"around","paste");b.display.input.focus()}}catch(zf){}}}function lc(a,b){2>Math.abs(a.doc.scrollTop-b)||(a.doc.scrollTop=b,ub||Z(a,{top:b}),a.display.scroller.scrollTop!=b&&(a.display.scroller.scrollTop=b),a.display.scrollbars.setScrollTop(b),
ub&&Z(a),hc(a,100))}function Mb(a,b,c){(c?b==a.doc.scrollLeft:2>Math.abs(a.doc.scrollLeft-b))||(b=Math.min(b,a.display.scroller.scrollWidth-a.display.scroller.clientWidth),a.doc.scrollLeft=b,M(a),a.display.scroller.scrollLeft!=b&&(a.display.scroller.scrollLeft=b),a.display.scrollbars.setScrollLeft(b))}function we(a,b){var c=Ee(b),f=c.x;c=c.y;var d=a.display,u=d.scroller;if(f&&u.scrollWidth>u.clientWidth||c&&u.scrollHeight>u.clientHeight){if(c&&Ua&&wa){var g=b.target,x=d.view;a:for(;g!=u;g=g.parentNode)for(var h=
0;h<x.length;h++)if(x[h].node==g){a.display.currentWheelTarget=g;break a}}!f||ub||Ya||null==Oa?(c&&null!=Oa&&(b=c*Oa,g=a.doc.scrollTop,x=g+d.wrapper.clientHeight,0>b?g=Math.max(0,g+b-50):x=Math.min(a.doc.height,x+b+50),Z(a,{top:g,bottom:x})),20>Yc&&(null==d.wheelStartX?(d.wheelStartX=u.scrollLeft,d.wheelStartY=u.scrollTop,d.wheelDX=f,d.wheelDY=c,setTimeout(function(){if(null!=d.wheelStartX){var a=u.scrollLeft-d.wheelStartX,b=u.scrollTop-d.wheelStartY;a=b&&d.wheelDY&&b/d.wheelDY||a&&d.wheelDX&&a/d.wheelDX;
d.wheelStartX=d.wheelStartY=null;a&&(Oa=(Oa*Yc+a)/(Yc+1),++Yc)}},200)):(d.wheelDX+=f,d.wheelDY+=c))):(c&&lc(a,Math.max(0,Math.min(u.scrollTop+c*Oa,u.scrollHeight-u.clientHeight))),Mb(a,Math.max(0,Math.min(u.scrollLeft+f*Oa,u.scrollWidth-u.clientWidth))),Ca(b),d.wheelStartX=null)}}function Zc(a,b,c){if("string"==typeof b&&(b=$c[b],!b))return!1;a.display.input.ensurePolled();var f=a.display.shift,d=!1;try{Ja(a)&&(a.state.suppressEdits=!0),c&&(a.display.shift=!1),d=b(a)!=Fe}finally{a.display.shift=f,
a.state.suppressEdits=!1}return d}function Pf(a,b,c){for(var f=0;f<a.state.keyMaps.length;f++){var d=uc(b,a.state.keyMaps[f],c,a);if(d)return d}return a.options.extraKeys&&uc(b,a.options.extraKeys,c,a)||uc(b,a.options.keyMap,c,a)}function ad(a,b,c,f){var d=a.state.keySeq;if(d){if(Qf(b))return"handled";Rf.set(50,function(){a.state.keySeq==d&&(a.state.keySeq=null,a.display.input.reset())});b=d+" "+b}f=Pf(a,b,f);"multi"==f&&(a.state.keySeq=b);"handled"==f&&Aa(a,"keyHandled",a,b,c);if("handled"==f||"multi"==
f)Ca(c),vd(a);return d&&!f&&/'$/.test(b)?(Ca(c),!0):!!f}function Ge(a,b){var c=Sf(b,!0);return c?b.shiftKey&&!a.state.keySeq?ad(a,"Shift-"+c,b,function(b){return Zc(a,b,!0)})||ad(a,c,b,function(b){if("string"==typeof b?/^go[A-Z]/.test(b):b.motion)return Zc(a,b)}):ad(a,c,b,function(b){return Zc(a,b)}):!1}function Tf(a,b,c){return ad(a,"'"+c+"'",b,function(b){return Zc(a,b,!0)})}function Ae(a){this.curOp.focus=cb();if(!gb(this,a)){ha&&11>pa&&27==a.keyCode&&(a.returnValue=!1);var b=a.keyCode;this.display.shift=
16==b||a.shiftKey;var c=Ge(this,a);Ya&&(Kd=c?b:null,!c&&88==b&&!He&&(Ua?a.metaKey:a.ctrlKey)&&this.replaceSelection("",null,"cut"));18!=b||/\bCodeMirror-crosshair\b/.test(this.display.lineDiv.className)||Uf(this)}}function Uf(a){function b(a){18!=a.keyCode&&a.altKey||(kc(c,"CodeMirror-crosshair"),hb(document,"keyup",b),hb(document,"mouseover",b))}var c=a.display.lineDiv;nc(c,"CodeMirror-crosshair");U(document,"keyup",b);U(document,"mouseover",b)}function ze(a){16==a.keyCode&&(this.doc.sel.shift=!1);
gb(this,a)}function Be(a){if(!(mb(this.display,a)||gb(this,a)||a.ctrlKey&&!a.altKey||Ua&&a.metaKey)){var b=a.keyCode,c=a.charCode;if(Ya&&b==Kd)Kd=null,Ca(a);else if(!Ya||a.which&&!(10>a.which)||!Ge(this,a))if(b=String.fromCharCode(null==c?b:c),!Tf(this,a,b))this.display.input.onKeyPress(a)}}function Lf(a){a.state.delayingBlurEvent=!0;setTimeout(function(){a.state.delayingBlurEvent&&(a.state.delayingBlurEvent=!1,gc(a))},100)}function nd(a){a.state.delayingBlurEvent&&(a.state.delayingBlurEvent=!1);
"nocursor"!=a.options.readOnly&&(a.state.focused||(va(a,"focus",a),a.state.focused=!0,nc(a.display.wrapper,"CodeMirror-focused"),a.curOp||a.display.selForContextMenu==a.doc.sel||(a.display.input.reset(),wa&&setTimeout(function(){a.display.input.reset(!0)},20)),a.display.input.receivedFocus()),vd(a))}function gc(a){a.state.delayingBlurEvent||(a.state.focused&&(va(a,"blur",a),a.state.focused=!1,kc(a.display.wrapper,"CodeMirror-focused")),clearInterval(a.display.blinker),setTimeout(function(){a.state.focused||
(a.display.shift=!1)},150))}function ve(a,b){var c;(c=mb(a.display,b))||(c=Qa(a,"gutterContextMenu")?Fd(a,b,"gutterContextMenu",!1,va):!1);if(!c)a.display.input.onContextMenu(b)}function Ie(a,b){if(0>Y(a,b.from))return a;if(0>=Y(a,b.to))return Fb(b);var c=a.line+b.text.length-(b.to.line-b.from.line)-1,f=a.ch;a.line==b.to.line&&(f+=Fb(b).ch-b.to.ch);return L(c,f)}function Ld(a,b){for(var c=[],f=0;f<a.sel.ranges.length;f++){var d=a.sel.ranges[f];c.push(new la(Ie(d.anchor,b),Ie(d.head,b)))}return Na(c,
a.sel.primIndex)}function Je(a,b,c){return a.line==b.line?L(c.line,a.ch-b.ch+c.ch):L(c.line+(a.line-b.line),a.ch)}function Ke(a,b,c){b={canceled:!1,from:b.from,to:b.to,text:b.text,origin:b.origin,cancel:function(){this.canceled=!0}};c&&(b.update=function(b,c,f,d){b&&(this.from=S(a,b));c&&(this.to=S(a,c));f&&(this.text=f);void 0!==d&&(this.origin=d)});va(a,"beforeChange",a,b);a.cm&&va(a.cm,"beforeChange",a.cm,b);return b.canceled?null:{from:b.from,to:b.to,text:b.text,origin:b.origin}}function Nb(a,
b,c){if(a.cm){if(!a.cm.curOp)return ta(a.cm,Nb)(a,b,c);if(a.cm.state.suppressEdits)return}if(Qa(a,"beforeChange")||a.cm&&Qa(a.cm,"beforeChange"))if(b=Ke(a,b,!0),!b)return;if(c=Le&&!c&&Vf(a,b.from,b.to))for(var f=c.length-1;0<=f;--f)Me(a,{from:c[f].from,to:c[f].to,text:f?[""]:b.text});else Me(a,b)}function Me(a,b){if(1!=b.text.length||""!=b.text[0]||0!=Y(b.from,b.to)){var c=Ld(a,b);Ne(a,b,c,a.cm?a.cm.curOp.id:NaN);vc(a,b,c,Md(a,b));var f=[];Gb(a,function(a,c){c||-1!=za(f,a.history)||(Oe(a.history,
b),f.push(a.history));vc(a,b,null,Md(a,b))})}}function bd(a,b,c){if(!a.cm||!a.cm.state.suppressEdits){for(var f=a.history,d,g=a.sel,u="undo"==b?f.done:f.undone,x="undo"==b?f.undone:f.done,h=0;h<u.length&&(d=u[h],c?!d.ranges||d.equals(a.sel):d.ranges);h++);if(h!=u.length){for(f.lastOrigin=f.lastSelOrigin=null;;)if(d=u.pop(),d.ranges){Nc(d,x);if(c&&!d.equals(a.sel)){ma(a,d,{clearRedo:!1});return}g=d}else break;c=[];Nc(g,x);x.push({changes:c,generation:f.generation});f.generation=d.generation||++f.maxGeneration;
f=Qa(a,"beforeChange")||a.cm&&Qa(a.cm,"beforeChange");for(h=d.changes.length-1;0<=h;--h){var E=d.changes[h];E.origin=b;if(f&&!Ke(a,E,!1)){u.length=0;break}c.push(Nd(a,E));g=h?Ld(a,E):ka(u);vc(a,E,g,Pe(a,E));!h&&a.cm&&a.cm.scrollIntoView({from:E.from,to:Fb(E)});var n=[];Gb(a,function(a,b){b||-1!=za(n,a.history)||(Oe(a.history,E),n.push(a.history));vc(a,E,null,Pe(a,E))})}}}}function Qe(a,b){if(0!=b&&(a.first+=b,a.sel=new Ma(Ic(a.sel.ranges,function(a){return new la(L(a.anchor.line+b,a.anchor.ch),L(a.head.line+
b,a.head.ch))}),a.sel.primIndex),a.cm)){Fa(a.cm,a.first,a.first-b,b);for(var c=a.cm.display,f=c.viewFrom;f<c.viewTo;f++)lb(a.cm,f,"gutter")}}function vc(a,b,c,f){if(a.cm&&!a.cm.curOp)return ta(a.cm,vc)(a,b,c,f);if(b.to.line<a.first)Qe(a,b.text.length-1-(b.to.line-b.from.line));else if(!(b.from.line>a.lastLine())){if(b.from.line<a.first){var d=b.text.length-1-(a.first-b.from.line);Qe(a,d);b={from:L(a.first,0),to:L(b.to.line+d,b.to.ch),text:[ka(b.text)],origin:b.origin}}d=a.lastLine();b.to.line>d&&
(b={from:b.from,to:L(d,T(a,d).text.length),text:[b.text[0]],origin:b.origin});b.removed=Cb(a,b.from,b.to);c||(c=Ld(a,b));a.cm?Wf(a.cm,b,f):Od(a,b,f);Wa(a,c,eb)}}function Wf(a,b,c){var d=a.doc,g=a.display,u=b.from,x=b.to,h=!1,E=u.line;a.options.lineWrapping||(E=na(fb(T(d,u.line))),d.iter(E,x.line+1,function(a){if(a==g.maxLine)return h=!0}));-1<d.sel.contains(b.from,b.to)&&je(a);Od(d,b,c,f(a));a.options.lineWrapping||(d.iter(E,u.line+b.text.length,function(a){var b=A(a);b>g.maxLineLength&&(g.maxLine=
a,g.maxLineLength=b,g.maxLineChanged=!0,h=!1)}),h&&(a.curOp.updateMaxLine=!0));d.frontier=Math.min(d.frontier,u.line);hc(a,400);c=b.text.length-(x.line-u.line)-1;b.full?Fa(a):u.line!=x.line||1!=b.text.length||Re(a.doc,b)?Fa(a,u.line,x.line+1,c):lb(a,u.line,"text");c=Qa(a,"changes");if((d=Qa(a,"change"))||c)b={from:u,to:x,text:b.text,removed:b.removed,origin:b.origin},d&&Aa(a,"change",a,b),c&&(a.curOp.changeObjs||(a.curOp.changeObjs=[])).push(b);a.display.selForContextMenu=null}function Xb(a,b,c,f,
d){f||(f=c);if(0>Y(f,c)){var g=f;f=c;c=g}"string"==typeof b&&(b=a.splitLines(b));Nb(a,{from:c,to:f,text:b,origin:d})}function Uc(a,b,c,f,d){var g=a.display,u=vb(a.display);0>c&&(c=0);var x=a.curOp&&null!=a.curOp.scrollTop?a.curOp.scrollTop:g.scroller.scrollTop,h=rd(a),n={};d-c>h&&(d=c+h);var E=a.doc.height+pd(g),m=c<u;u=d>E-u;c<x?n.scrollTop=m?0:c:d>x+h&&(c=Math.min(c,(u?E:d)-h),c!=x&&(n.scrollTop=c));x=a.curOp&&null!=a.curOp.scrollLeft?a.curOp.scrollLeft:g.scroller.scrollLeft;a=nb(a)-(a.options.fixedGutter?
g.gutters.offsetWidth:0);(g=f-b>a)&&(f=b+a);10>b?n.scrollLeft=0:b<x?n.scrollLeft=Math.max(0,b-(g?0:10)):f>a+x-3&&(n.scrollLeft=f+(g?0:10)-a);return n}function cd(a,b,c){null==b&&null==c||dd(a);null!=b&&(a.curOp.scrollLeft=(null==a.curOp.scrollLeft?a.doc.scrollLeft:a.curOp.scrollLeft)+b);null!=c&&(a.curOp.scrollTop=(null==a.curOp.scrollTop?a.doc.scrollTop:a.curOp.scrollTop)+c)}function Ob(a){dd(a);var b=a.getCursor(),c=b,f=b;a.options.lineWrapping||(c=b.ch?L(b.line,b.ch-1):b,f=L(b.line,b.ch+1));a.curOp.scrollToPos=
{from:c,to:f,margin:a.options.cursorScrollMargin,isCursor:!0}}function dd(a){var b=a.curOp.scrollToPos;if(b){a.curOp.scrollToPos=null;var c=te(a,b.from),f=te(a,b.to);b=Uc(a,Math.min(c.left,f.left),Math.min(c.top,f.top)-b.margin,Math.max(c.right,f.right),Math.max(c.bottom,f.bottom)+b.margin);a.scrollTo(b.scrollLeft,b.scrollTop)}}function pc(a,b,c,f){var d=a.doc,g;null==c&&(c="add");"smart"==c&&(d.mode.indent?g=qc(a,b):c="prev");var u=a.options.tabSize,h=T(d,b),x=Xa(h.text,null,u);h.stateAfter&&(h.stateAfter=
null);var n=h.text.match(/^\s*/)[0];if(!f&&!/\S/.test(h.text)){var E=0;c="not"}else if("smart"==c&&(E=d.mode.indent(g,h.text.slice(n.length),h.text),E==Fe||150<E)){if(!f)return;c="prev"}"prev"==c?E=b>d.first?Xa(T(d,b-1).text,null,u):0:"add"==c?E=x+a.options.indentUnit:"subtract"==c?E=x-a.options.indentUnit:"number"==typeof c&&(E=x+c);E=Math.max(0,E);c="";f=0;if(a.options.indentWithTabs)for(a=Math.floor(E/u);a;--a)f+=u,c+="\t";f<E&&(c+=Se(E-f));if(c!=n)return Xb(d,c,L(b,0),L(b,n.length),"+input"),
h.stateAfter=null,!0;for(a=0;a<d.sel.ranges.length;a++)if(u=d.sel.ranges[a],u.head.line==b&&u.head.ch<n.length){f=L(b,n.length);ea(d,a,new la(f,f));break}}function ed(a,b,c,f){var d=b,g=b;"number"==typeof b?g=T(a,Math.max(a.first,Math.min(b,a.first+a.size-1))):d=na(b);if(null==d)return null;f(g,d)&&a.cm&&lb(a.cm,d,c);return g}function Yb(a,b){for(var c=a.doc.sel.ranges,f=[],d=0;d<c.length;d++){for(var g=b(c[d]);f.length&&0>=Y(g.from,ka(f).to);){var u=f.pop();if(0>Y(u.from,g.from)){g.from=u.from;break}}f.push(g)}La(a,
function(){for(var b=f.length-1;0<=b;b--)Xb(a.doc,"",f[b].from,f[b].to,"+delete");Ob(a)})}function Pd(a,b,c,f,d){function g(b){var f=(d?Ed:Te)(n,h,c,!0);if(null==f){if(b=!b)b=u+c,b<a.first||b>=a.first+a.size?b=E=!1:(u=b,b=n=T(a,b));if(b)h=d?(0>c?Tc:Sc)(n):0>c?n.text.length:0;else return E=!1}else h=f;return!0}var u=b.line,h=b.ch,x=c,n=T(a,u),E=!0;if("char"==f)g();else if("column"==f)g(!0);else if("word"==f||"group"==f){var m=null;f="group"==f;b=a.cm&&a.cm.getHelper(b,"wordChars");for(var p=!0;!(0>
c)||g(!p);p=!1){var q=n.text.charAt(h)||"\n";q=fd(q,b)?"w":f&&"\n"==q?"n":!f||/\s/.test(q)?null:"p";!f||p||q||(q="s");if(m&&m!=q){0>c&&(c=1,g());break}q&&(m=q);if(0<c&&!g(!p))break}}x=Oc(a,L(u,h),x,!0);E||(x.hitSide=!0);return x}function Ue(a,b,c,f){var d=a.doc,g=b.left,u;for("page"==f?u=b.top+c*(Math.min(a.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight)-(0>c?1.5:.5)*vb(a.display)):"line"==f&&(u=0<c?b.bottom+3:b.top-3);;){b=Dd(a,g,u);if(!b.outside)break;if(0>
c?0>=u:u>=d.height){b.hitSide=!0;break}u+=5*c}return b}function W(a,b,c,f){d.defaults[a]=b;c&&(Kb[a]=f?function(a,b,f){f!=$d&&c(a,b,f)}:c)}function Xf(a){var b=a.split(/-(?!$)/);a=b[b.length-1];for(var c,f,d,g,u=0;u<b.length-1;u++){var h=b[u];if(/^(cmd|meta|m)$/i.test(h))g=!0;else if(/^a(lt)?$/i.test(h))c=!0;else if(/^(c|ctrl|control)$/i.test(h))f=!0;else if(/^s(hift)$/i.test(h))d=!0;else throw Error("Unrecognized modifier name: "+h);}c&&(a="Alt-"+a);f&&(a="Ctrl-"+a);g&&(a="Cmd-"+a);d&&(a="Shift-"+
a);return a}function gd(a){return"string"==typeof a?sb[a]:a}function Zb(a,b,c,f,d){if(f&&f.shared)return Yf(a,b,c,f,d);if(a.cm&&!a.cm.curOp)return ta(a.cm,Zb)(a,b,c,f,d);var g=new Hb(a,d);d=Y(b,c);f&&Ta(f,g,!1);if(0<d||0==d&&!1!==g.clearWhenEmpty)return g;g.replacedWith&&(g.collapsed=!0,g.widgetNode=Q("span",[g.replacedWith],"CodeMirror-widget"),f.handleMouseEvents||g.widgetNode.setAttribute("cm-ignore-events","true"),f.insertLeft&&(g.widgetNode.insertLeft=!0));if(g.collapsed){if(Ve(a,b.line,b,c,
g)||b.line!=c.line&&Ve(a,c.line,b,c,g))throw Error("Inserting collapsed marker partially overlapping an existing one");pb=!0}g.addToHistory&&Ne(a,{from:b,to:c,origin:"markText"},a.sel,NaN);var u=b.line,h=a.cm,x;a.iter(u,c.line+1,function(a){h&&g.collapsed&&!h.options.lineWrapping&&fb(a)==h.display.maxLine&&(x=!0);g.collapsed&&u!=b.line&&$a(a,0);var f=new hd(g,u==b.line?b.ch:null,u==c.line?c.ch:null);a.markedSpans=a.markedSpans?a.markedSpans.concat([f]):[f];f.marker.attachLine(a);++u});g.collapsed&&
a.iter(b.line,c.line+1,function(b){xb(a,b)&&$a(b,0)});g.clearOnEnter&&U(g,"beforeCursorEnter",function(){g.clear()});g.readOnly&&(Le=!0,(a.history.done.length||a.history.undone.length)&&a.clearHistory());g.collapsed&&(g.id=++Qd,g.atomic=!0);if(h){x&&(h.curOp.updateMaxLine=!0);if(g.collapsed)Fa(h,b.line,c.line+1);else if(g.className||g.title||g.startStyle||g.endStyle||g.css)for(f=b.line;f<=c.line;f++)lb(h,f,"text");g.atomic&&ke(h.doc);Aa(h,"markerAdded",h,g)}return g}function Yf(a,b,c,f,d){f=Ta(f);
f.shared=!1;var g=[Zb(a,b,c,f,d)],u=g[0],h=f.widgetNode;Gb(a,function(a){h&&(f.widgetNode=h.cloneNode(!0));g.push(Zb(a,S(a,b),S(a,c),f,d));for(var x=0;x<a.linked.length;++x)if(a.linked[x].isParent)return;u=ka(g)});return new id(g,u)}function We(a){return a.findMarks(L(a.first,0),a.clipPos(L(a.lastLine())),function(a){return a.parent})}function Zf(a){for(var b=0;b<a.length;b++){var c=a[b],f=[c.primary.doc];Gb(c.primary.doc,function(a){f.push(a)});for(var d=0;d<c.markers.length;d++){var g=c.markers[d];
-1==za(f,g.doc)&&(g.parent=null,c.markers.splice(d--,1))}}}function hd(a,b,c){this.marker=a;this.from=b;this.to=c}function wc(a,b){if(a)for(var c=0;c<a.length;++c){var f=a[c];if(f.marker==b)return f}}function Md(a,b){if(b.full)return null;var c=jb(a,b.from.line)&&T(a,b.from.line).markedSpans,f=jb(a,b.to.line)&&T(a,b.to.line).markedSpans;if(!c&&!f)return null;a=b.from.ch;var d=b.to.ch,g=0==Y(b.from,b.to);if(c)for(var u=0,h;u<c.length;++u){var x=c[u],n=x.marker;if(null==x.from||(n.inclusiveLeft?x.from<=
a:x.from<a)||!(x.from!=a||"bookmark"!=n.type||g&&x.marker.insertLeft)){var m=null==x.to||(n.inclusiveRight?x.to>=a:x.to>a);(h||(h=[])).push(new hd(n,x.from,m?null:x.to))}}c=h;var p;if(f)for(h=0;h<f.length;++h)if(u=f[h],x=u.marker,null==u.to||(x.inclusiveRight?u.to>=d:u.to>d)||u.from==d&&"bookmark"==x.type&&(!g||u.marker.insertLeft))n=null==u.from||(x.inclusiveLeft?u.from<=d:u.from<d),(p||(p=[])).push(new hd(x,n?null:u.from-d,null==u.to?null:u.to-d));d=1==b.text.length;g=ka(b.text).length+(d?a:0);
if(c)for(f=0;f<c.length;++f)if(h=c[f],null==h.to)(u=wc(p,h.marker),u)?d&&(h.to=null==u.to?null:u.to+g):h.to=a;if(p)for(f=0;f<p.length;++f)h=p[f],null!=h.to&&(h.to+=g),null==h.from?(u=wc(c,h.marker),u||(h.from=g,d&&(c||(c=[])).push(h))):(h.from+=g,d&&(c||(c=[])).push(h));c&&(c=Xe(c));p&&p!=c&&(p=Xe(p));a=[c];if(!d){b=b.text.length-2;var q;if(0<b&&c)for(f=0;f<c.length;++f)null==c[f].to&&(q||(q=[])).push(new hd(c[f].marker,null,null));for(f=0;f<b;++f)a.push(q);a.push(p)}return a}function Xe(a){for(var b=
0;b<a.length;++b){var c=a[b];null!=c.from&&c.from==c.to&&!1!==c.marker.clearWhenEmpty&&a.splice(b--,1)}return a.length?a:null}function Pe(a,b){var c;if(c=b["spans_"+a.id]){for(var f=0,d=[];f<b.text.length;++f)d.push($f(c[f]));c=d}else c=null;a=Md(a,b);if(!c)return a;if(!a)return c;for(b=0;b<c.length;++b)if(f=c[b],d=a[b],f&&d){var g=0;a:for(;g<d.length;++g){for(var u=d[g],h=0;h<f.length;++h)if(f[h].marker==u.marker)continue a;f.push(u)}}else d&&(c[b]=d);return c}function Vf(a,b,c){var f=null;a.iter(b.line,
c.line+1,function(a){if(a.markedSpans)for(var b=0;b<a.markedSpans.length;++b){var c=a.markedSpans[b].marker;!c.readOnly||f&&-1!=za(f,c)||(f||(f=[])).push(c)}});if(!f)return null;a=[{from:b,to:c}];for(b=0;b<f.length;++b){c=f[b];for(var d=c.find(0),g=0;g<a.length;++g){var u=a[g];if(!(0>Y(u.to,d.from)||0<Y(u.from,d.to))){var h=[g,1],x=Y(u.from,d.from),n=Y(u.to,d.to);(0>x||!c.inclusiveLeft&&!x)&&h.push({from:u.from,to:d.from});(0<n||!c.inclusiveRight&&!n)&&h.push({from:d.to,to:u.to});a.splice.apply(a,
h);g+=h.length-1}}}return a}function Ye(a){var b=a.markedSpans;if(b){for(var c=0;c<b.length;++c)b[c].marker.detachLine(a);a.markedSpans=null}}function Ze(a,b){if(b){for(var c=0;c<b.length;++c)b[c].marker.attachLine(a);a.markedSpans=b}}function $e(a,b){var c=a.lines.length-b.lines.length;if(0!=c)return c;c=a.find();var f=b.find(),d=Y(c.from,f.from)||(a.inclusiveLeft?-1:0)-(b.inclusiveLeft?-1:0);return d?-d:(c=Y(c.to,f.to)||(a.inclusiveRight?1:0)-(b.inclusiveRight?1:0))?c:b.id-a.id}function zb(a,b){a=
pb&&a.markedSpans;if(a)for(var c,f=0;f<a.length;++f)if(c=a[f],c.marker.collapsed&&null==(b?c.from:c.to)&&(!d||0>$e(d,c.marker)))var d=c.marker;return d}function Ve(a,b,c,f,d){a=T(a,b);if(a=pb&&a.markedSpans)for(b=0;b<a.length;++b){var g=a[b];if(g.marker.collapsed){var u=g.marker.find(0),h=Y(u.from,c)||(g.marker.inclusiveLeft?-1:0)-(d.inclusiveLeft?-1:0),x=Y(u.to,f)||(g.marker.inclusiveRight?1:0)-(d.inclusiveRight?1:0);if(!(0<=h&&0>=x||0>=h&&0<=x)&&(0>=h&&(0<Y(u.to,c)||g.marker.inclusiveRight&&d.inclusiveLeft)||
0<=h&&(0>Y(u.from,f)||g.marker.inclusiveLeft&&d.inclusiveRight)))return!0}}}function fb(a){for(var b;b=zb(a,!0);)a=b.find(-1,!0).line;return a}function qd(a,b){a=T(a,b);var c=fb(a);return a==c?b:na(c)}function ce(a,b){if(b>a.lastLine())return b;var c=T(a,b);if(!xb(a,c))return b;for(;a=zb(c,!1);)c=a.find(1,!0).line;return na(c)+1}function xb(a,b){var c=pb&&b.markedSpans;if(c)for(var f,d=0;d<c.length;++d)if(f=c[d],f.marker.collapsed&&(null==f.from||!f.marker.widgetNode&&0==f.from&&f.marker.inclusiveLeft&&
Rd(a,b,f)))return!0}function Rd(a,b,c){if(null==c.to)return b=c.marker.find(1,!0),Rd(a,b.line,wc(b.line.markedSpans,c.marker));if(c.marker.inclusiveRight&&c.to==b.text.length)return!0;for(var f,d=0;d<b.markedSpans.length;++d)if(f=b.markedSpans[d],f.marker.collapsed&&!f.marker.widgetNode&&f.from==c.to&&(null==f.to||f.to!=c.from)&&(f.marker.inclusiveLeft||c.marker.inclusiveRight)&&Rd(a,b,f))return!0}function sc(a){if(null!=a.height)return a.height;var b=a.doc.cm;if(!b)return 0;if(!ud(document.body,
a.node)){var c="position: relative;";a.coverGutter&&(c+="margin-left: -"+b.display.gutters.offsetWidth+"px;");a.noHScroll&&(c+="width: "+b.display.wrapper.clientWidth+"px;");Ra(b.display.measure,Q("div",[a.node],null,c))}return a.height=a.node.offsetHeight}function ag(a,b,c,f){var d=new jd(a,c,f),g=a.cm;g&&d.noHScroll&&(g.display.alignWidgets=!0);ed(a,b,"widget",function(b){var c=b.widgets||(b.widgets=[]);null==d.insertAt?c.push(d):c.splice(Math.min(c.length-1,Math.max(0,d.insertAt)),0,d);d.line=
b;g&&!xb(a,b)&&(c=bb(b)<a.scrollTop,$a(b,b.height+sc(d)),c&&cd(g,null,d.height),g.curOp.forceUpdate=!0);return!0});return d}function af(a,b){if(a)for(;;){var c=a.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!c)break;a=a.slice(0,c.index)+a.slice(c.index+c[0].length);var f=c[1]?"bgClass":"textClass";null==b[f]?b[f]=c[2]:(new RegExp("(?:^|s)"+c[2]+"(?:$|s)")).test(b[f])||(b[f]+=" "+c[2])}return a}function bf(a,b){if(a.blankLine)return a.blankLine(b);if(a.innerMode&&(a=d.innerMode(a,b),a.mode.blankLine))return a.mode.blankLine(a.state)}
function Sd(a,b,c,f){for(var g=0;10>g;g++){f&&(f[0]=d.innerMode(a,c).mode);var u=a.token(b,c);if(b.pos>b.start)return u}throw Error("Mode "+a.name+" failed to advance stream.");}function cf(a,b,c,f){function d(a){return{start:n.start,end:n.pos,string:n.current(),type:p||null,state:a?Tb(g.mode,x):x}}var g=a.doc,u=g.mode;b=S(g,b);var h=T(g,b.line),x=qc(a,b.line,c),n=new kd(h.text,a.options.tabSize),m;for(f&&(m=[]);(f||n.pos<b.ch)&&!n.eol();){n.start=n.pos;var p=Sd(u,n,x);f&&m.push(d(!0))}return f?m:
d()}function df(a,b,c,f,d,g,h){var u=c.flattenSpans;null==u&&(u=a.options.flattenSpans);var x=0,n=null,m=new kd(b,a.options.tabSize),p=a.options.addModeClass&&[null];for(""==b&&af(bf(c,f),g);!m.eol();){if(m.pos>a.options.maxHighlightLength){u=!1;h&&wd(a,b,f,m.pos);m.pos=b.length;var q=null}else q=af(Sd(c,m,f,p),g);if(p){var E=p[0].name;E&&(q="m-"+(q?E+" "+q:E))}if(!u||n!=q){for(;x<m.start;)x=Math.min(m.start,x+5E4),d(x,n);n=q}m.start=m.pos}for(;x<m.pos;)a=Math.min(m.pos,x+5E4),d(a,n),x=a}function oe(a,
b,c,f){var d=[a.state.modeGen],g={};df(a,b.text,a.doc.mode,c,function(a,b){d.push(a,b)},g,f);for(c=0;c<a.state.overlays.length;++c){var u=a.state.overlays[c],h=1,x=0;df(a,b.text,u.mode,!0,function(a,b){for(var c=h;x<a;){var f=d[h];f>a&&d.splice(h,1,a,d[h+1],f);h+=2;x=Math.min(a,f)}if(b)if(u.opaque)d.splice(c,h-c,a,"cm-overlay "+b),h=c+2;else for(;c<h;c+=2)a=d[c+1],d[c+1]=(a?a+" ":"")+"cm-overlay "+b},g)}return{styles:d,classes:g.bgClass||g.textClass?g:null}}function ef(a,b,c){if(!b.styles||b.styles[0]!=
a.state.modeGen){var f=oe(a,b,b.stateAfter=qc(a,na(b)));b.styles=f.styles;f.classes?b.styleClasses=f.classes:b.styleClasses&&(b.styleClasses=null);c===a.doc.frontier&&a.doc.frontier++}return b.styles}function wd(a,b,c,f){var d=a.doc.mode,g=new kd(b,a.options.tabSize);g.start=g.pos=f||0;for(""==b&&bf(d,c);!g.eol()&&g.pos<=a.options.maxHighlightLength;)Sd(d,g,c),g.start=g.pos}function ff(a,b){if(!a||/^\s*$/.test(a))return null;b=b.addModeClass?bg:cg;return b[a]||(b[a]=a.replace(/\S+/g,"cm-$&"))}function de(a,
b){var c=Q("span",null,null,wa?"padding-right: .1px":null);c={pre:Q("pre",[c],"CodeMirror-line"),content:c,col:0,pos:0,cm:a,splitSpaces:(ha||wa)&&a.getOption("lineWrapping")};b.measure={};for(var f=0;f<=(b.rest?b.rest.length:0);f++){var d=f?b.rest[f-1]:b.line,g;c.pos=0;c.addToken=dg;if(null!=Td)var u=Td;else{u=Ra(a.display.measure,document.createTextNode("A\u062eA"));var h=Ub(u,0,1).getBoundingClientRect();u=h&&h.left!=h.right?Td=3>Ub(u,1,2).getBoundingClientRect().right-h.right:!1}u&&(g=Va(d))&&
(c.addToken=eg(c.addToken,g));c.map=[];var x=b!=a.display.externalMeasured&&na(d);a:{var n=h=u=void 0,m=void 0,p=void 0,q=void 0,F=void 0,r=c;x=ef(a,d,x);var t=d.markedSpans,w=d.text,B=0;if(t){var qa=w.length,N=0;aa=1;for(var v="",V=0;;){if(V==N){p=m=n=h=q="";u=null;V=Infinity;for(var z=[],C=0;C<t.length;++C){var ea=t[C],A=ea.marker;"bookmark"==A.type&&ea.from==N&&A.widgetNode?z.push(A):ea.from<=N&&(null==ea.to||ea.to>N||A.collapsed&&ea.to==N&&ea.from==N)?(null!=ea.to&&ea.to!=N&&V>ea.to&&(V=ea.to,
m=""),A.className&&(p+=" "+A.className),A.css&&(q=A.css),A.startStyle&&ea.from==N&&(n+=" "+A.startStyle),A.endStyle&&ea.to==V&&(m+=" "+A.endStyle),A.title&&!h&&(h=A.title),A.collapsed&&(!u||0>$e(u.marker,A))&&(u=ea)):ea.from>N&&V>ea.from&&(V=ea.from)}if(u&&(u.from||0)==N){gf(r,(null==u.to?qa+1:u.to)-N,u.marker,null==u.from);if(null==u.to)break a;u.to==N&&(u=!1)}if(!u&&z.length)for(C=0;C<z.length;++C)gf(r,0,z[C])}if(N>=qa)break;for(z=Math.min(qa,V);;){if(v){C=N+v.length;u||(ea=C>z?v.slice(0,z-N):v,
r.addToken(r,ea,F?F+p:p,n,N+ea.length==V?m:"",h,q));if(C>=z){v=v.slice(z-N);N=z;break}N=C;n=""}v=w.slice(B,B=x[aa++]);F=ff(x[aa++],r.cm.options)}}}else for(var aa=1;aa<x.length;aa+=2)r.addToken(r,w.slice(B,B=x[aa]),ff(x[aa+1],r.cm.options))}d.styleClasses&&(d.styleClasses.bgClass&&(c.bgClass=Ud(d.styleClasses.bgClass,c.bgClass||"")),d.styleClasses.textClass&&(c.textClass=Ud(d.styleClasses.textClass,c.textClass||"")));0==c.map.length&&c.map.push(0,0,c.content.appendChild(fg(a.display.measure)));0==
f?(b.measure.map=c.map,b.measure.cache={}):((b.measure.maps||(b.measure.maps=[])).push(c.map),(b.measure.caches||(b.measure.caches=[])).push({}))}wa&&/\bcm-tab\b/.test(c.content.lastChild.className)&&(c.content.className="cm-tab-wrap-hack");va(a,"renderLine",a,b.line,c.pre);c.pre.className&&(c.textClass=Ud(c.pre.className,c.textClass||""));return c}function dg(a,b,c,f,d,g,h){if(b){var u=a.splitSpaces?b.replace(/ {3,}/g,gg):b,x=a.cm.state.specialChars,n=!1;if(x.test(b)){F=document.createDocumentFragment();
for(var m=0;;){x.lastIndex=m;var p=x.exec(b),q=p?p.index-m:b.length-m;if(q){var E=document.createTextNode(u.slice(m,m+q));ha&&9>pa?F.appendChild(Q("span",[E])):F.appendChild(E);a.map.push(a.pos,a.pos+q,E);a.col+=q;a.pos+=q}if(!p)break;m+=q+1;"\t"==p[0]?(E=a.cm.options.tabSize,p=E-a.col%E,E=F.appendChild(Q("span",Se(p),"cm-tab")),E.setAttribute("role","presentation"),E.setAttribute("cm-text","\t"),a.col+=p):("\r"==p[0]||"\n"==p[0]?(E=F.appendChild(Q("span","\r"==p[0]?"\u240d":"\u2424","cm-invalidchar")),
E.setAttribute("cm-text",p[0])):(E=a.cm.options.specialCharPlaceholder(p[0]),E.setAttribute("cm-text",p[0]),ha&&9>pa?F.appendChild(Q("span",[E])):F.appendChild(E)),a.col+=1);a.map.push(a.pos,a.pos+1,E);a.pos++}}else{a.col+=b.length;var F=document.createTextNode(u);a.map.push(a.pos,a.pos+b.length,F);ha&&9>pa&&(n=!0);a.pos+=b.length}if(c||f||d||n||h)return b=c||"",f&&(b+=f),d&&(b+=d),f=Q("span",[F],b,h),g&&(f.title=g),a.content.appendChild(f);a.content.appendChild(F)}}function gg(a){for(var b=" ",c=
0;c<a.length-2;++c)b+=c%2?" ":"\u00a0";return b+" "}function eg(a,b){return function(c,f,d,g,u,h,x){d=d?d+" cm-force-border":"cm-force-border";for(var n=c.pos,m=n+f.length;;){for(var p=0;p<b.length;p++){var q=b[p];if(q.to>n&&q.from<=n)break}if(q.to>=m)return a(c,f,d,g,u,h,x);a(c,f.slice(0,q.to-n),d,g,null,h,x);g=null;f=f.slice(q.to-n);n=q.to}}}function gf(a,b,c,f){var d=!f&&c.widgetNode;d&&a.map.push(a.pos,a.pos+b,d);!f&&a.cm.display.input.needsContentAttribute&&(d||(d=a.content.appendChild(document.createElement("span"))),
d.setAttribute("cm-marker",c.id));d&&(a.cm.display.input.setUneditable(d),a.content.appendChild(d));a.pos+=b}function Re(a,b){return 0==b.from.ch&&0==b.to.ch&&""==ka(b.text)&&(!a.cm||a.cm.options.wholeLineUpdateBefore)}function Od(a,b,c,f){function d(a,c,d){a.text=c;a.stateAfter&&(a.stateAfter=null);a.styles&&(a.styles=null);null!=a.order&&(a.order=null);Ye(a);Ze(a,d);c=f?f(a):1;c!=a.height&&$a(a,c);Aa(a,"change",a,b)}function g(a,b){for(var d=[];a<b;++a)d.push(new xc(x[a],c?c[a]:null,f));return d}
var u=b.from,h=b.to,x=b.text,n=T(a,u.line),m=T(a,h.line),p=ka(x),q=c?c[x.length-1]:null,F=h.line-u.line;if(b.full)a.insert(0,g(0,x.length)),a.remove(x.length,a.size-x.length);else if(Re(a,b)){var E=g(0,x.length-1);d(m,m.text,q);F&&a.remove(u.line,F);E.length&&a.insert(u.line,E)}else n==m?1==x.length?d(n,n.text.slice(0,u.ch)+p+n.text.slice(h.ch),q):(E=g(1,x.length-1),E.push(new xc(p+n.text.slice(h.ch),q,f)),d(n,n.text.slice(0,u.ch)+x[0],c?c[0]:null),a.insert(u.line+1,E)):1==x.length?(d(n,n.text.slice(0,
u.ch)+x[0]+m.text.slice(h.ch),c?c[0]:null),a.remove(u.line+1,F)):(d(n,n.text.slice(0,u.ch)+x[0],c?c[0]:null),d(m,p+m.text.slice(h.ch),q),E=g(1,x.length-1),1<F&&a.remove(u.line+1,F-1),a.insert(u.line+1,E));Aa(a,"change",a,b)}function yc(a){this.lines=a;this.parent=null;for(var b=0,c=0;b<a.length;++b)a[b].parent=this,c+=a[b].height;this.height=c}function zc(a){this.children=a;for(var b=0,c=0,f=0;f<a.length;++f){var d=a[f];b+=d.chunkSize();c+=d.height;d.parent=this}this.size=b;this.height=c;this.parent=
null}function Gb(a,b,c){function f(a,d,g){if(a.linked)for(var u=0;u<a.linked.length;++u){var h=a.linked[u];if(h.doc!=d){var x=g&&h.sharedHist;if(!c||x)b(h.doc,x),f(h.doc,a,x)}}}f(a,null,!0)}function Zd(a,c){if(c.cm)throw Error("This document is already in use.");a.doc=c;c.cm=a;g(a);b(a);a.options.lineWrapping||z(a);a.options.mode=c.modeOption;Fa(a)}function T(a,b){b-=a.first;if(0>b||b>=a.size)throw Error("There is no line "+(b+a.first)+" in the document.");for(;!a.lines;)for(var c=0;;++c){var f=a.children[c],
d=f.chunkSize();if(b<d){a=f;break}b-=d}return a.lines[b]}function Cb(a,b,c){var f=[],d=b.line;a.iter(b.line,c.line+1,function(a){a=a.text;d==c.line&&(a=a.slice(0,c.ch));d==b.line&&(a=a.slice(b.ch));f.push(a);++d});return f}function Vd(a,b,c){var f=[];a.iter(b,c,function(a){f.push(a.text)});return f}function $a(a,b){if(b-=a.height)for(;a;a=a.parent)a.height+=b}function na(a){if(null==a.parent)return null;var b=a.parent;a=za(b.lines,a);for(var c=b.parent;c;b=c,c=c.parent)for(var f=0;c.children[f]!=
b;++f)a+=c.children[f].chunkSize();return a+b.first}function Ab(a,b){var c=a.first;a:do{for(var f=0;f<a.children.length;++f){var d=a.children[f],g=d.height;if(b<g){a=d;continue a}b-=g;c+=d.chunkSize()}return c}while(!a.lines);for(f=0;f<a.lines.length;++f){d=a.lines[f].height;if(b<d)break;b-=d}return c+f}function bb(a){a=fb(a);for(var b=0,c=a.parent,f=0;f<c.lines.length;++f){var d=c.lines[f];if(d==a)break;else b+=d.height}for(a=c.parent;a;c=a,a=c.parent)for(f=0;f<a.children.length&&(d=a.children[f],
d!=c);++f)b+=d.height;return b}function Va(a){var b=a.order;null==b&&(b=a.order=hg(a.text));return b}function ld(a){this.done=[];this.undone=[];this.undoDepth=Infinity;this.lastModTime=this.lastSelTime=0;this.lastOrigin=this.lastSelOrigin=this.lastOp=this.lastSelOp=null;this.generation=this.maxGeneration=a||1}function Nd(a,b){var c={from:ra(b.from),to:Fb(b),text:Cb(a,b.from,b.to)};hf(a,c,b.from.line,b.to.line+1);Gb(a,function(a){hf(a,c,b.from.line,b.to.line+1)},!0);return c}function ge(a){for(;a.length;)if(ka(a).ranges)a.pop();
else break}function Ne(a,b,c,f){var d=a.history;d.undone.length=0;var g=+new Date,u;if(u=d.lastOp==f||d.lastOrigin==b.origin&&b.origin&&("+"==b.origin.charAt(0)&&a.cm&&d.lastModTime>g-a.cm.options.historyEventDelay||"*"==b.origin.charAt(0))){if(d.lastOp==f){ge(d.done);var h=ka(d.done)}else d.done.length&&!ka(d.done).ranges?h=ka(d.done):1<d.done.length&&!d.done[d.done.length-2].ranges?(d.done.pop(),h=ka(d.done)):h=void 0;u=h}if(u){var x=ka(h.changes);0==Y(b.from,b.to)&&0==Y(b.from,x.to)?x.to=Fb(b):
h.changes.push(Nd(a,b))}else for((h=ka(d.done))&&h.ranges||Nc(a.sel,d.done),h={changes:[Nd(a,b)],generation:d.generation},d.done.push(h);d.done.length>d.undoDepth;)d.done.shift(),d.done[0].ranges||d.done.shift();d.done.push(c);d.generation=++d.maxGeneration;d.lastModTime=d.lastSelTime=g;d.lastOp=d.lastSelOp=f;d.lastOrigin=d.lastSelOrigin=b.origin;x||va(a,"historyAdded")}function Nc(a,b){var c=ka(b);c&&c.ranges&&c.equals(a)||b.push(a)}function hf(a,b,c,f){var d=b["spans_"+a.id],g=0;a.iter(Math.max(a.first,
c),Math.min(a.first+a.size,f),function(c){c.markedSpans&&((d||(d=b["spans_"+a.id]={}))[g]=c.markedSpans);++g})}function $f(a){if(!a)return null;for(var b=0,c;b<a.length;++b)a[b].marker.explicitlyCleared?c||(c=a.slice(0,b)):c&&c.push(a[b]);return c?c.length?c:null:a}function $b(a,b,c){for(var f=0,d=[];f<a.length;++f){var g=a[f];if(g.ranges)d.push(c?Ma.prototype.deepCopy.call(g):g);else{g=g.changes;var u=[];d.push({changes:u});for(var h=0;h<g.length;++h){var x=g[h],n;u.push({from:x.from,to:x.to,text:x.text});
if(b)for(var m in x)(n=m.match(/^spans_(\d+)$/))&&-1<za(b,Number(n[1]))&&(ka(u)[m]=x[m],delete x[m])}}}return d}function jf(a,b,c,f){c<a.line?a.line+=f:b<a.line&&(a.line=b,a.ch=0)}function kf(a,b,c,f){for(var d=0;d<a.length;++d){var g=a[d],u=!0;if(g.ranges){g.copied||(g=a[d]=g.deepCopy(),g.copied=!0);for(var h=0;h<g.ranges.length;h++)jf(g.ranges[h].anchor,b,c,f),jf(g.ranges[h].head,b,c,f)}else{for(h=0;h<g.changes.length;++h){var x=g.changes[h];if(c<x.from.line)x.from=L(x.from.line+f,x.from.ch),x.to=
L(x.to.line+f,x.to.ch);else if(b<=x.to.line){u=!1;break}}u||(a.splice(0,d+1),d=0)}}}function Oe(a,b){var c=b.from.line,f=b.to.line;b=b.text.length-(f-c)-1;kf(a.done,c,f,b);kf(a.undone,c,f,b)}function Jd(a){return null!=a.defaultPrevented?a.defaultPrevented:0==a.returnValue}function Ce(a){var b=a.which;null==b&&(a.button&1?b=1:a.button&2?b=3:a.button&4&&(b=2));Ua&&a.ctrlKey&&1==b&&(b=3);return b}function Aa(a,b){function c(a){return function(){a.apply(null,d)}}var f=a._handlers&&a._handlers[b];if(f){var d=
Array.prototype.slice.call(arguments,2);if(Vb)var g=Vb.delayedCallbacks;else Ac?g=Ac:(g=Ac=[],setTimeout(ig,0));for(var u=0;u<f.length;++u)g.push(c(f[u]))}}function ig(){var a=Ac;Ac=null;for(var b=0;b<a.length;++b)a[b]()}function gb(a,b,c){"string"==typeof b&&(b={type:b,preventDefault:function(){this.defaultPrevented=!0}});va(a,c||b.type,a,b);return Jd(b)||b.codemirrorIgnore}function je(a){var b=a._handlers&&a._handlers.cursorActivity;if(b){a=a.curOp.cursorActivityHandlers||(a.curOp.cursorActivityHandlers=
[]);for(var c=0;c<b.length;++c)-1==za(a,b[c])&&a.push(b[c])}}function Qa(a,b){return(a=a._handlers&&a._handlers[b])&&0<a.length}function ac(a){a.prototype.on=function(a,b){U(this,a,b)};a.prototype.off=function(a,b){hb(this,a,b)}}function ec(){this.id=null}function De(a,b,c){for(var f=0,d=0;;){var g=a.indexOf("\t",f);-1==g&&(g=a.length);var u=g-f;if(g==a.length||d+u>=b)return f+Math.min(u,b-d);d+=g-f;d+=c-d%c;f=g+1;if(d>=b)return f}}function Se(a){for(;md.length<=a;)md.push(ka(md)+" ");return md[a]}
function ka(a){return a[a.length-1]}function za(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return c;return-1}function Ic(a,b){for(var c=[],f=0;f<a.length;f++)c[f]=b(a[f],f);return c}function Bc(){}function lf(a,b){Object.create?a=Object.create(a):(Bc.prototype=a,a=new Bc);b&&Ta(b,a);return a}function Ta(a,b,c){b||(b={});for(var f in a)!a.hasOwnProperty(f)||!1===c&&b.hasOwnProperty(f)||(b[f]=a[f]);return b}function fc(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,
b)}}function fd(a,b){return b?-1<b.source.indexOf("\\w")&&mf(a)?!0:b.test(a):mf(a)}function nf(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!1;return!0}function rc(a){return 768<=a.charCodeAt(0)&&jg.test(a)}function Q(a,b,c,f){a=document.createElement(a);c&&(a.className=c);f&&(a.style.cssText=f);if("string"==typeof b)a.appendChild(document.createTextNode(b));else if(b)for(c=0;c<b.length;++c)a.appendChild(b[c]);return a}function yb(a){for(var b=a.childNodes.length;0<b;--b)a.removeChild(a.firstChild);
return a}function Ra(a,b){return yb(a).appendChild(b)}function cb(){for(var a=document.activeElement;a&&a.root&&a.root.activeElement;)a=a.root.activeElement;return a}function Cc(a){return new RegExp("(^|\\s)"+a+"(?:$|\\s)\\s*")}function Ud(a,b){a=a.split(" ");for(var c=0;c<a.length;c++)a[c]&&!Cc(a[c]).test(b)&&(b+=" "+a[c]);return b}function of(a){if(document.body.getElementsByClassName)for(var b=document.body.getElementsByClassName("CodeMirror"),c=0;c<b.length;c++){var f=b[c].CodeMirror;f&&a(f)}}
function xf(){var a;U(window,"resize",function(){null==a&&(a=setTimeout(function(){a=null;of(Jf)},100))});U(window,"blur",function(){of(gc)})}function fg(a){if(null==Wd){var b=Q("span","\u200b");Ra(a,Q("span",[b,document.createTextNode("x")]));0!=a.firstChild.offsetHeight&&(Wd=1>=b.offsetWidth&&2<b.offsetHeight&&!(ha&&8>pa))}a=Wd?Q("span","\u200b"):Q("span","\u00a0",null,"display: inline-block; width: 1px; margin-right: -1px");a.setAttribute("cm-text","");return a}function Bf(a,b,c,f){if(!a)return f(b,
c,"ltr");for(var d=!1,g=0;g<a.length;++g){var u=a[g];if(u.from<c&&u.to>b||b==c&&u.to==b)f(Math.max(u.from,b),Math.min(u.to,c),1==u.level?"rtl":"ltr"),d=!0}d||f(b,c,"ltr")}function Bd(a){return a.level%2?a.to:a.from}function Cd(a){return a.level%2?a.from:a.to}function Sc(a){return(a=Va(a))?Bd(a[0]):0}function Tc(a){var b=Va(a);return b?Cd(ka(b)):a.text.length}function pf(a,b){var c=T(a.doc,b);a=fb(c);a!=c&&(b=na(a));a=(c=Va(a))?c[0].level%2?Tc(a):Sc(a):0;return L(b,a)}function qf(a,b){var c=pf(a,b.line);
a=T(a.doc,c.line);var f=Va(a);return f&&0!=f[0].level?c:(a=Math.max(0,a.text.search(/\S/)),L(c.line,b.line==c.line&&b.ch<=a&&b.ch?0:a))}function Lc(a,b){tc=null;for(var c=0,f;c<a.length;++c){var d=a[c];if(d.from<b&&d.to>b)return c;if(d.from==b||d.to==b)if(null==f)f=c;else{b=d.level;var g=a[f].level;a=a[0].level;a=b==a?!0:g==a?!1:b<g;if(a)return d.from!=d.to&&(tc=f),c;d.from!=d.to&&(tc=c);break}}return f}function Xd(a,b,c,f){if(!f)return b+c;do b+=c;while(0<b&&rc(a.text.charAt(b)));return b}function Ed(a,
b,c,f){var d=Va(a);if(!d)return Te(a,b,c,f);var g=Lc(d,b),u=d[g];for(b=Xd(a,b,u.level%2?-c:c,f);;){if(b>u.from&&b<u.to)return b;if(b==u.from||b==u.to){if(Lc(d,b)==g)return b;u=d[g+c];return 0<c==u.level%2?u.to:u.from}u=d[g+=c];if(!u)return null;b=0<c==u.level%2?Xd(a,u.to,-1,f):Xd(a,u.from,1,f)}}function Te(a,b,c,f){b+=c;if(f)for(;0<b&&rc(a.text.charAt(b));)b+=c;return 0>b||b>a.text.length?null:b}var ub=/gecko\/\d/i.test(navigator.userAgent),rf=/MSIE \d/.test(navigator.userAgent),sf=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),
ha=rf||sf,pa=ha&&(rf?document.documentMode||6:sf[1]),wa=/WebKit\//.test(navigator.userAgent),kg=wa&&/Qt\/\d+\.\d+/.test(navigator.userAgent),lg=/Chrome\//.test(navigator.userAgent),Ya=/Opera\//.test(navigator.userAgent),ye=/Apple Computer/.test(navigator.vendor),mg=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),Hf=/PhantomJS/.test(navigator.userAgent),Qb=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),dc=Qb||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),
Ua=Qb||/Mac/.test(navigator.platform),ng=/win/i.test(navigator.platform),Ib=Ya&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);Ib&&(Ib=Number(Ib[1]));Ib&&15<=Ib&&(Ya=!1,wa=!0);var tf=Ua&&(kg||Ya&&(null==Ib||12.11>Ib)),Gd=ub||ha&&9<=pa,Le=!1,pb=!1;q.prototype=Ta({update:function(a){var b=a.scrollWidth>a.clientWidth+1,c=a.scrollHeight>a.clientHeight+1,f=a.nativeBarWidth;c?(this.vert.style.display="block",this.vert.style.bottom=b?f+"px":"0",this.vert.firstChild.style.height=Math.max(0,a.scrollHeight-
a.clientHeight+(a.viewHeight-(b?f:0)))+"px"):(this.vert.style.display="",this.vert.firstChild.style.height="0");b?(this.horiz.style.display="block",this.horiz.style.right=c?f+"px":"0",this.horiz.style.left=a.barLeft+"px",this.horiz.firstChild.style.width=a.scrollWidth-a.clientWidth+(a.viewWidth-a.barLeft-(c?f:0))+"px"):(this.horiz.style.display="",this.horiz.firstChild.style.width="0");!this.checkedOverlay&&0<a.clientHeight&&(0==f&&this.overlayHack(),this.checkedOverlay=!0);return{right:c?f:0,bottom:b?
f:0}},setScrollLeft:function(a){this.horiz.scrollLeft!=a&&(this.horiz.scrollLeft=a)},setScrollTop:function(a){this.vert.scrollTop!=a&&(this.vert.scrollTop=a)},overlayHack:function(){this.horiz.style.minHeight=this.vert.style.minWidth=Ua&&!mg?"12px":"18px";var a=this,b=function(b){(b.target||b.srcElement)!=a.vert&&(b.target||b.srcElement)!=a.horiz&&ta(a.cm,ue)(b)};U(this.vert,"mousedown",b);U(this.horiz,"mousedown",b)},clear:function(){var a=this.horiz.parentNode;a.removeChild(this.horiz);a.removeChild(this.vert)}},
q.prototype);w.prototype=Ta({update:function(){return{bottom:0,right:0}},setScrollLeft:function(){},setScrollTop:function(){},clear:function(){}},w.prototype);d.scrollbarModel={"native":q,"null":w};P.prototype.signal=function(a,b){Qa(a,b)&&this.events.push(arguments)};P.prototype.finish=function(){for(var a=0;a<this.events.length;a++)va.apply(null,this.events[a])};var L=d.Pos=function(a,b){if(!(this instanceof L))return new L(a,b);this.line=a;this.ch=b},Y=d.cmpPos=function(a,b){return a.line-b.line||
a.ch-b.ch},Pa=null;rb.prototype=Ta({init:function(a){function b(a){if(f.somethingSelected())Pa=f.getSelections(),c.inaccurateSelection&&(c.prevInput="",c.inaccurateSelection=!1,g.value=Pa.join("\n"),bc(g));else if(f.options.lineWiseCopyCut){var b=Pb(f);Pa=b.text;"cut"==a.type?f.setSelections(b.ranges,null,eb):(c.prevInput="",g.value=b.text.join("\n"),bc(g))}else return;"cut"==a.type&&(f.state.cutIncoming=!0)}var c=this,f=this.cm,d=this.wrapper=Jc(),g=this.textarea=d.firstChild;a.wrapper.insertBefore(d,
a.wrapper.firstChild);Qb&&(g.style.width="0px");U(g,"input",function(){ha&&9<=pa&&c.hasSelection&&(c.hasSelection=null);c.poll()});U(g,"paste",function(a){if(Ka(a,f))return!0;f.state.pasteIncoming=!0;c.fastPoll()});U(g,"cut",b);U(g,"copy",b);U(a.scroller,"paste",function(b){mb(a,b)||(f.state.pasteIncoming=!0,c.focus())});U(a.lineSpace,"selectstart",function(b){mb(a,b)||Ca(b)});U(g,"compositionstart",function(){var a=f.getCursor("from");c.composing={start:a,range:f.markText(a,f.getCursor("to"),{className:"CodeMirror-composing"})}});
U(g,"compositionend",function(){c.composing&&(c.poll(),c.composing.range.clear(),c.composing=null)})},prepareSelection:function(){var a=this.cm,b=a.display,c=a.doc,f=le(a);if(a.options.moveInputWithCursor){a=kb(a,c.sel.primary().head,"div");c=b.wrapper.getBoundingClientRect();var d=b.lineDiv.getBoundingClientRect();f.teTop=Math.max(0,Math.min(b.wrapper.clientHeight-10,a.top+d.top-c.top));f.teLeft=Math.max(0,Math.min(b.wrapper.clientWidth-10,a.left+d.left-c.left))}return f},showSelection:function(a){var b=
this.cm.display;Ra(b.cursorDiv,a.cursors);Ra(b.selectionDiv,a.selection);null!=a.teTop&&(this.wrapper.style.top=a.teTop+"px",this.wrapper.style.left=a.teLeft+"px")},reset:function(a){if(!this.contextMenuPending){var b=this.cm,c=b.doc;if(b.somethingSelected()){this.prevInput="";var f=c.sel.primary();var d=(f=He&&(100<f.to().line-f.from().line||1E3<(d=b.getSelection()).length))?"-":d||b.getSelection();this.textarea.value=d;b.state.focused&&bc(this.textarea);ha&&9<=pa&&(this.hasSelection=d)}else a||
(this.prevInput=this.textarea.value="",ha&&9<=pa&&(this.hasSelection=null));this.inaccurateSelection=f}},getField:function(){return this.textarea},supportsTouch:function(){return!1},focus:function(){if("nocursor"!=this.cm.options.readOnly&&(!dc||cb()!=this.textarea))try{this.textarea.focus()}catch(u){}},blur:function(){this.textarea.blur()},resetPosition:function(){this.wrapper.style.top=this.wrapper.style.left=0},receivedFocus:function(){this.slowPoll()},slowPoll:function(){var a=this;a.pollingFast||
a.polling.set(this.cm.options.pollInterval,function(){a.poll();a.cm.state.focused&&a.slowPoll()})},fastPoll:function(){function a(){c.poll()||b?(c.pollingFast=!1,c.slowPoll()):(b=!0,c.polling.set(60,a))}var b=!1,c=this;c.pollingFast=!0;c.polling.set(20,a)},poll:function(){var a=this.cm,b=this.textarea,c=this.prevInput;if(this.contextMenuPending||!a.state.focused||og(b)&&!c&&!this.composing||Ja(a)||a.options.disableInput||a.state.keySeq)return!1;var f=b.value;if(f==c&&!a.somethingSelected())return!1;
if(ha&&9<=pa&&this.hasSelection===f||Ua&&/[\uf700-\uf7ff]/.test(f))return a.display.input.reset(),!1;if(a.doc.sel==a.display.selForContextMenu){var d=f.charCodeAt(0);8203!=d||c||(c="\u200b");if(8666==d)return this.reset(),this.cm.execCommand("undo")}var g=0;for(d=Math.min(c.length,f.length);g<d&&c.charCodeAt(g)==f.charCodeAt(g);)++g;var h=this;La(a,function(){ba(a,f.slice(g),c.length-g,null,h.composing?"*compose":null);1E3<f.length||-1<f.indexOf("\n")?b.value=h.prevInput="":h.prevInput=f;h.composing&&
(h.composing.range.clear(),h.composing.range=a.markText(h.composing.start,a.getCursor("to"),{className:"CodeMirror-composing"}))});return!0},ensurePolled:function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},onKeyPress:function(){ha&&9<=pa&&(this.hasSelection=null);this.fastPoll()},onContextMenu:function(a){function b(){if(null!=u.selectionStart){var a=d.somethingSelected(),b="\u200b"+(a?u.value:"");u.value="\u21da";u.value=b;f.prevInput=a?"":"\u200b";u.selectionStart=1;u.selectionEnd=
b.length;g.selForContextMenu=d.doc.sel}}function c(){f.contextMenuPending=!1;f.wrapper.style.position="relative";u.style.cssText=m;ha&&9>pa&&g.scrollbars.setScrollTop(g.scroller.scrollTop=n);if(null!=u.selectionStart){(!ha||ha&&9>pa)&&b();var a=0,c=function(){g.selForContextMenu==d.doc.sel&&0==u.selectionStart&&0<u.selectionEnd&&"\u200b"==f.prevInput?ta(d,$c.selectAll)(d):10>a++?g.detectingSelectAll=setTimeout(c,500):g.input.reset()};g.detectingSelectAll=setTimeout(c,200)}}var f=this,d=f.cm,g=d.display,
u=f.textarea,h=Wb(d,a),n=g.scroller.scrollTop;if(h&&!Ya){d.options.resetSelectionOnContextMenu&&-1==d.doc.sel.contains(h)&&ta(d,ma)(d.doc,sa(h),eb);var m=u.style.cssText;f.wrapper.style.position="absolute";u.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(a.clientY-5)+"px; left: "+(a.clientX-5)+"px; z-index: 1000; background: "+(ha?"rgba(255, 255, 255, .05)":"transparent")+"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";
if(wa)var p=window.scrollY;g.input.focus();wa&&window.scrollTo(null,p);g.input.reset();d.somethingSelected()||(u.value=f.prevInput=" ");f.contextMenuPending=!0;g.selForContextMenu=d.doc.sel;clearTimeout(g.detectingSelectAll);ha&&9<=pa&&b();if(Gd){Hd(a);var q=function(){hb(window,"mouseup",q);setTimeout(c,20)};U(window,"mouseup",q)}else setTimeout(c,50)}},setUneditable:Bc,needsContentAttribute:!1},rb.prototype);Rb.prototype=Ta({init:function(a){function b(a){if(f.somethingSelected())Pa=f.getSelections(),
"cut"==a.type&&f.replaceSelection("",null,"cut");else if(f.options.lineWiseCopyCut){var b=Pb(f);Pa=b.text;"cut"==a.type&&f.operation(function(){f.setSelections(b.ranges,0,eb);f.replaceSelection("",null,"cut")})}else return;if(a.clipboardData&&!Qb)a.preventDefault(),a.clipboardData.clearData(),a.clipboardData.setData("text/plain",Pa.join("\n"));else{var c=Jc();a=c.firstChild;f.display.lineSpace.insertBefore(c,f.display.lineSpace.firstChild);a.value=Pa.join("\n");var d=document.activeElement;bc(a);
setTimeout(function(){f.display.lineSpace.removeChild(c);d.focus()},50)}}var c=this,f=c.cm;a=c.div=a.lineDiv;a.contentEditable="true";qb(a);U(a,"paste",function(a){Ka(a,f)});U(a,"compositionstart",function(a){a=a.data;c.composing={sel:f.doc.sel,data:a,startData:a};if(a){var b=f.doc.sel.primary(),d=f.getLine(b.head.line).indexOf(a,Math.max(0,b.head.ch-a.length));-1<d&&d<=b.head.ch&&(c.composing.sel=sa(L(b.head.line,d),L(b.head.line,d+a.length)))}});U(a,"compositionupdate",function(a){c.composing.data=
a.data});U(a,"compositionend",function(a){var b=c.composing;b&&(a.data==b.startData||/\u200b/.test(a.data)||(b.data=a.data),setTimeout(function(){b.handled||c.applyComposition(b);c.composing==b&&(c.composing=null)},50))});U(a,"touchstart",function(){c.forceCompositionEnd()});U(a,"input",function(){c.composing||c.pollContent()||La(c.cm,function(){Fa(f)})});U(a,"copy",b);U(a,"cut",b)},prepareSelection:function(){var a=le(this.cm,!1);a.focus=this.cm.state.focused;return a},showSelection:function(a){a&&
this.cm.display.view.length&&(a.focus&&this.showPrimarySelection(),this.showMultipleSelections(a))},showPrimarySelection:function(){var a=window.getSelection(),b=this.cm.doc.sel.primary(),c=Sb(this.cm,a.anchorNode,a.anchorOffset),f=Sb(this.cm,a.focusNode,a.focusOffset);if(!c||c.bad||!f||f.bad||0!=Y(xa(c,f),b.from())||0!=Y(Za(c,f),b.to()))if(c=Kc(this.cm,b.from()),f=Kc(this.cm,b.to()),c||f){var d=this.cm.display.view;b=a.rangeCount&&a.getRangeAt(0);c?f||(f=d[d.length-1].measure,f=f.maps?f.maps[f.maps.length-
1]:f.map,f={node:f[f.length-1],offset:f[f.length-2]-f[f.length-3]}):c={node:d[0].measure.map[2],offset:0};try{var g=Ub(c.node,c.offset,f.offset,f.node)}catch(ug){}g&&(a.removeAllRanges(),a.addRange(g),b&&null==a.anchorNode?a.addRange(b):ub&&this.startGracePeriod());this.rememberSelection()}},startGracePeriod:function(){var a=this;clearTimeout(this.gracePeriod);this.gracePeriod=setTimeout(function(){a.gracePeriod=!1;a.selectionChanged()&&a.cm.operation(function(){a.cm.curOp.selectionChanged=!0})},
20)},showMultipleSelections:function(a){Ra(this.cm.display.cursorDiv,a.cursors);Ra(this.cm.display.selectionDiv,a.selection)},rememberSelection:function(){var a=window.getSelection();this.lastAnchorNode=a.anchorNode;this.lastAnchorOffset=a.anchorOffset;this.lastFocusNode=a.focusNode;this.lastFocusOffset=a.focusOffset},selectionInEditor:function(){var a=window.getSelection();if(!a.rangeCount)return!1;a=a.getRangeAt(0).commonAncestorContainer;return ud(this.div,a)},focus:function(){"nocursor"!=this.cm.options.readOnly&&
this.div.focus()},blur:function(){this.div.blur()},getField:function(){return this.div},supportsTouch:function(){return!0},receivedFocus:function(){function a(){b.cm.state.focused&&(b.pollSelection(),b.polling.set(b.cm.options.pollInterval,a))}var b=this;this.selectionInEditor()?this.pollSelection():La(this.cm,function(){b.cm.curOp.selectionChanged=!0});this.polling.set(this.cm.options.pollInterval,a)},selectionChanged:function(){var a=window.getSelection();return a.anchorNode!=this.lastAnchorNode||
a.anchorOffset!=this.lastAnchorOffset||a.focusNode!=this.lastFocusNode||a.focusOffset!=this.lastFocusOffset},pollSelection:function(){if(!this.composing&&!this.gracePeriod&&this.selectionChanged()){var a=window.getSelection(),b=this.cm;this.rememberSelection();var c=Sb(b,a.anchorNode,a.anchorOffset),f=Sb(b,a.focusNode,a.focusOffset);c&&f&&La(b,function(){ma(b.doc,sa(c,f),eb);if(c.bad||f.bad)b.curOp.selectionChanged=!0})}},pollContent:function(){var a=this.cm,b=a.display,c=a.doc.sel.primary(),f=c.from();
c=c.to();if(f.line<b.viewFrom||c.line>b.viewTo-1)return!1;var d;f.line==b.viewFrom||0==(d=Bb(a,f.line))?(f=na(b.view[0].line),d=b.view[0].node):(f=na(b.view[d].line),d=b.view[d-1].node.nextSibling);var g=Bb(a,c.line);g==b.view.length-1?(c=b.viewTo-1,b=b.lineDiv.lastChild):(c=na(b.view[g+1].line)-1,b=b.view[g+1].node.previousSibling);b=a.doc.splitLines(Mc(a,d,b,f,c));for(d=Cb(a.doc,L(f,0),L(c,T(a.doc,c).text.length));1<b.length&&1<d.length;)if(ka(b)==ka(d))b.pop(),d.pop(),c--;else if(b[0]==d[0])b.shift(),
d.shift(),f++;else break;var h=0;g=0;for(var n=b[0],m=d[0],p=Math.min(n.length,m.length);h<p&&n.charCodeAt(h)==m.charCodeAt(h);)++h;n=ka(b);m=ka(d);for(p=Math.min(n.length-(1==b.length?h:0),m.length-(1==d.length?h:0));g<p&&n.charCodeAt(n.length-g-1)==m.charCodeAt(m.length-g-1);)++g;b[b.length-1]=n.slice(0,n.length-g);b[0]=b[0].slice(h);f=L(f,h);c=L(c,d.length?ka(d).length-g:0);if(1<b.length||b[0]||Y(f,c))return Xb(a.doc,b,f,c,"+input"),!0},ensurePolled:function(){this.forceCompositionEnd()},reset:function(){this.forceCompositionEnd()},
forceCompositionEnd:function(){this.composing&&!this.composing.handled&&(this.applyComposition(this.composing),this.composing.handled=!0,this.div.blur(),this.div.focus())},applyComposition:function(a){a.data&&a.data!=a.startData&&ta(this.cm,ba)(this.cm,a.data,0,a.sel)},setUneditable:function(a){a.setAttribute("contenteditable","false")},onKeyPress:function(a){a.preventDefault();ta(this.cm,ba)(this.cm,String.fromCharCode(null==a.charCode?a.keyCode:a.charCode),0)},onContextMenu:Bc,resetPosition:Bc,
needsContentAttribute:!0},Rb.prototype);d.inputStyles={textarea:rb,contenteditable:Rb};Ma.prototype={primary:function(){return this.ranges[this.primIndex]},equals:function(a){if(a==this)return!0;if(a.primIndex!=this.primIndex||a.ranges.length!=this.ranges.length)return!1;for(var b=0;b<this.ranges.length;b++){var c=this.ranges[b],f=a.ranges[b];if(0!=Y(c.anchor,f.anchor)||0!=Y(c.head,f.head))return!1}return!0},deepCopy:function(){for(var a=[],b=0;b<this.ranges.length;b++)a[b]=new la(ra(this.ranges[b].anchor),
ra(this.ranges[b].head));return new Ma(a,this.primIndex)},somethingSelected:function(){for(var a=0;a<this.ranges.length;a++)if(!this.ranges[a].empty())return!0;return!1},contains:function(a,b){b||(b=a);for(var c=0;c<this.ranges.length;c++){var f=this.ranges[c];if(0<=Y(b,f.from())&&0>=Y(a,f.to()))return c}return-1}};la.prototype={from:function(){return xa(this.anchor,this.head)},to:function(){return Za(this.anchor,this.head)},empty:function(){return this.head.line==this.anchor.line&&this.head.ch==
this.anchor.ch}};var yd={left:0,right:0,top:0,bottom:0},Eb,Vb=null,Gf=0,Xc,Wc,xe=0,Yc=0,Oa=null;ha?Oa=-.53:ub?Oa=15:lg?Oa=-.7:ye&&(Oa=-1/3);var Ee=function(a){var b=a.wheelDeltaX,c=a.wheelDeltaY;null==b&&a.detail&&a.axis==a.HORIZONTAL_AXIS&&(b=a.detail);null==c&&a.detail&&a.axis==a.VERTICAL_AXIS?c=a.detail:null==c&&(c=a.wheelDelta);return{x:b,y:c}};d.wheelEventPixels=function(a){a=Ee(a);a.x*=Oa;a.y*=Oa;return a};var Rf=new ec,Kd=null,Fb=d.changeEnd=function(a){return a.text?L(a.from.line+a.text.length-
1,ka(a.text).length+(1==a.text.length?a.from.ch:0)):a.to};d.prototype={constructor:d,focus:function(){window.focus();this.display.input.focus()},setOption:function(a,b){var c=this.options,f=c[a];if(c[a]!=b||"mode"==a)c[a]=b,Kb.hasOwnProperty(a)&&ta(this,Kb[a])(this,b,f)},getOption:function(a){return this.options[a]},getDoc:function(){return this.doc},addKeyMap:function(a,b){this.state.keyMaps[b?"push":"unshift"](gd(a))},removeKeyMap:function(a){for(var b=this.state.keyMaps,c=0;c<b.length;++c)if(b[c]==
a||b[c].name==a)return b.splice(c,1),!0},addOverlay:ya(function(a,b){var c=a.token?a:d.getMode(this.options,a);if(c.startState)throw Error("Overlays may not be stateful.");this.state.overlays.push({mode:c,modeSpec:a,opaque:b&&b.opaque});this.state.modeGen++;Fa(this)}),removeOverlay:ya(function(a){for(var b=this.state.overlays,c=0;c<b.length;++c){var f=b[c].modeSpec;if(f==a||"string"==typeof a&&f.name==a){b.splice(c,1);this.state.modeGen++;Fa(this);break}}}),indentLine:ya(function(a,b,c){"string"!=
typeof b&&"number"!=typeof b&&(b=null==b?this.options.smartIndent?"smart":"prev":b?"add":"subtract");jb(this.doc,a)&&pc(this,a,b,c)}),indentSelection:ya(function(a){for(var b=this.doc.sel.ranges,c=-1,f=0;f<b.length;f++){var d=b[f];if(d.empty())d.head.line>c&&(pc(this,d.head.line,a,!0),c=d.head.line,f==this.doc.sel.primIndex&&Ob(this));else{var g=d.from();d=d.to();var h=Math.max(c,g.line);c=Math.min(this.lastLine(),d.line-(d.ch?0:1))+1;for(d=h;d<c;++d)pc(this,d,a);d=this.doc.sel.ranges;0==g.ch&&b.length==
d.length&&0<d[f].from().ch&&ea(this.doc,f,new la(g,d[f].to()),eb)}}}),getTokenAt:function(a,b){return cf(this,a,b)},getLineTokens:function(a,b){return cf(this,L(a),b,!0)},getTokenTypeAt:function(a){a=S(this.doc,a);var b=ef(this,T(this.doc,a.line)),c=0,f=(b.length-1)/2;a=a.ch;if(0==a)b=b[2];else for(;;){var d=c+f>>1;if((d?b[2*d-1]:0)>=a)f=d;else if(b[2*d+1]<a)c=d+1;else{b=b[2*d+2];break}}c=b?b.indexOf("cm-overlay "):-1;return 0>c?b:0==c?null:b.slice(0,c-1)},getModeAt:function(a){var b=this.doc.mode;
return b.innerMode?d.innerMode(b,this.getTokenAt(a).state).mode:b},getHelper:function(a,b){return this.getHelpers(a,b)[0]},getHelpers:function(a,b){var c=[];if(!cc.hasOwnProperty(b))return c;var f=cc[b];a=this.getModeAt(a);if("string"==typeof a[b])f[a[b]]&&c.push(f[a[b]]);else if(a[b])for(var d=0;d<a[b].length;d++){var g=f[a[b][d]];g&&c.push(g)}else a.helperType&&f[a.helperType]?c.push(f[a.helperType]):f[a.name]&&c.push(f[a.name]);for(d=0;d<f._global.length;d++)b=f._global[d],b.pred(a,this)&&-1==
za(c,b.val)&&c.push(b.val);return c},getStateAfter:function(a,b){var c=this.doc;a=Math.max(c.first,Math.min(null==a?c.first+c.size-1:a,c.first+c.size-1));return qc(this,a+1,b)},cursorCoords:function(a,b){var c=this.doc.sel.primary();a=null==a?c.head:"object"==typeof a?S(this.doc,a):a?c.from():c.to();return kb(this,a,b||"page")},charCoords:function(a,b){return Pc(this,S(this.doc,a),b||"page")},coordsChar:function(a,b){a=se(this,a,b||"page");return Dd(this,a.left,a.top)},lineAtHeight:function(a,b){a=
se(this,{top:a,left:0},b||"page").top;return Ab(this.doc,a+this.display.viewOffset)},heightAtLine:function(a,b){var c=!1;if("number"==typeof a){var f=this.doc.first+this.doc.size-1;a<this.doc.first?a=this.doc.first:a>f&&(a=f,c=!0);a=T(this.doc,a)}return Ad(this,a,{top:0,left:0},b||"page").top+(c?this.doc.height-bb(a):0)},defaultTextHeight:function(){return vb(this.display)},defaultCharWidth:function(){return ic(this.display)},setGutterMarker:ya(function(a,b,c){return ed(this.doc,a,"gutter",function(a){var f=
a.gutterMarkers||(a.gutterMarkers={});f[b]=c;!c&&nf(f)&&(a.gutterMarkers=null);return!0})}),clearGutter:ya(function(a){var b=this,c=b.doc,f=c.first;c.iter(function(c){c.gutterMarkers&&c.gutterMarkers[a]&&(c.gutterMarkers[a]=null,lb(b,f,"gutter"),nf(c.gutterMarkers)&&(c.gutterMarkers=null));++f})}),lineInfo:function(a){if("number"==typeof a){if(!jb(this.doc,a))return null;var b=a;a=T(this.doc,a);if(!a)return null}else if(b=na(a),null==b)return null;return{line:b,handle:a,text:a.text,gutterMarkers:a.gutterMarkers,
textClass:a.textClass,bgClass:a.bgClass,wrapClass:a.wrapClass,widgets:a.widgets}},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(a,b,c,f,d){var g=this.display;a=kb(this,S(this.doc,a));var h=a.bottom,u=a.left;b.style.position="absolute";b.setAttribute("cm-ignore-events","true");this.display.input.setUneditable(b);g.sizer.appendChild(b);if("over"==f)h=a.top;else if("above"==f||"near"==f){var n=Math.max(g.wrapper.clientHeight,this.doc.height),m=Math.max(g.sizer.clientWidth,
g.lineSpace.clientWidth);("above"==f||a.bottom+b.offsetHeight>n)&&a.top>b.offsetHeight?h=a.top-b.offsetHeight:a.bottom+b.offsetHeight<=n&&(h=a.bottom);u+b.offsetWidth>m&&(u=m-b.offsetWidth)}b.style.top=h+"px";b.style.left=b.style.right="";"right"==d?(u=g.sizer.clientWidth-b.offsetWidth,b.style.right="0px"):("left"==d?u=0:"middle"==d&&(u=(g.sizer.clientWidth-b.offsetWidth)/2),b.style.left=u+"px");c&&(a=Uc(this,u,h,u+b.offsetWidth,h+b.offsetHeight),null!=a.scrollTop&&lc(this,a.scrollTop),null!=a.scrollLeft&&
Mb(this,a.scrollLeft))},triggerOnKeyDown:ya(Ae),triggerOnKeyPress:ya(Be),triggerOnKeyUp:ze,execCommand:function(a){if($c.hasOwnProperty(a))return $c[a].call(null,this)},triggerElectric:ya(function(a){db(this,a)}),findPosH:function(a,b,c,f){var d=1;0>b&&(d=-1,b=-b);var g=0;for(a=S(this.doc,a);g<b&&(a=Pd(this.doc,a,d,c,f),!a.hitSide);++g);return a},moveH:ya(function(a,b){var c=this;c.extendSelectionsBy(function(f){return c.display.shift||c.doc.extend||f.empty()?Pd(c.doc,f.head,a,b,c.options.rtlMoveVisually):
0>a?f.from():f.to()},Dc)}),deleteH:ya(function(a,b){var c=this.doc;this.doc.sel.somethingSelected()?c.replaceSelection("",null,"+delete"):Yb(this,function(f){var d=Pd(c,f.head,a,b,!1);return 0>a?{from:d,to:f.head}:{from:f.head,to:d}})}),findPosV:function(a,b,c,f){var d=1;0>b&&(d=-1,b=-b);var g=0;for(a=S(this.doc,a);g<b&&(a=kb(this,a,"div"),null==f?f=a.left:a.left=f,a=Ue(this,a,d,c),!a.hitSide);++g);return a},moveV:ya(function(a,b){var c=this,f=this.doc,d=[],g=!c.display.shift&&!f.extend&&f.sel.somethingSelected();
f.extendSelectionsBy(function(h){if(g)return 0>a?h.from():h.to();var u=kb(c,h.head,"div");null!=h.goalColumn&&(u.left=h.goalColumn);d.push(u.left);var n=Ue(c,u,a,b);"page"==b&&h==f.sel.primary()&&cd(c,null,Pc(c,n,"div").top-u.top);return n},Dc);if(d.length)for(var h=0;h<f.sel.ranges.length;h++)f.sel.ranges[h].goalColumn=d[h]}),findWordAt:function(a){var b=T(this.doc,a.line).text,c=a.ch,f=a.ch;if(b){var d=this.getHelper(a,"wordChars");(0>a.xRel||f==b.length)&&c?--c:++f;var g=b.charAt(c);for(g=fd(g,
d)?function(a){return fd(a,d)}:/\s/.test(g)?function(a){return/\s/.test(a)}:function(a){return!/\s/.test(a)&&!fd(a)};0<c&&g(b.charAt(c-1));)--c;for(;f<b.length&&g(b.charAt(f));)++f}return new la(L(a.line,c),L(a.line,f))},toggleOverwrite:function(a){if(null==a||a!=this.state.overwrite)(this.state.overwrite=!this.state.overwrite)?nc(this.display.cursorDiv,"CodeMirror-overwrite"):kc(this.display.cursorDiv,"CodeMirror-overwrite"),va(this,"overwriteToggle",this,this.state.overwrite)},hasFocus:function(){return this.display.input.getField()==
cb()},scrollTo:ya(function(a,b){null==a&&null==b||dd(this);null!=a&&(this.curOp.scrollLeft=a);null!=b&&(this.curOp.scrollTop=b)}),getScrollInfo:function(){var a=this.display.scroller;return{left:a.scrollLeft,top:a.scrollTop,height:a.scrollHeight-ab(this)-this.display.barHeight,width:a.scrollWidth-ab(this)-this.display.barWidth,clientHeight:rd(this),clientWidth:nb(this)}},scrollIntoView:ya(function(a,b){null==a?(a={from:this.doc.sel.primary().head,to:null},null==b&&(b=this.options.cursorScrollMargin)):
"number"==typeof a?a={from:L(a,0),to:null}:null==a.from&&(a={from:a,to:null});a.to||(a.to=a.from);a.margin=b||0;null!=a.from.line?(dd(this),this.curOp.scrollToPos=a):(a=Uc(this,Math.min(a.from.left,a.to.left),Math.min(a.from.top,a.to.top)-a.margin,Math.max(a.from.right,a.to.right),Math.max(a.from.bottom,a.to.bottom)+a.margin),this.scrollTo(a.scrollLeft,a.scrollTop))}),setSize:ya(function(a,b){function c(a){return"number"==typeof a||/^\d+$/.test(String(a))?a+"px":a}var f=this;null!=a&&(f.display.wrapper.style.width=
c(a));null!=b&&(f.display.wrapper.style.height=c(b));f.options.lineWrapping&&re(this);var d=f.display.viewFrom;f.doc.iter(d,f.display.viewTo,function(a){if(a.widgets)for(var b=0;b<a.widgets.length;b++)if(a.widgets[b].noHScroll){lb(f,d,"widget");break}++d});f.curOp.forceUpdate=!0;va(f,"refresh",this)}),operation:function(a){return La(this,a)},refresh:ya(function(){var a=this.display.cachedTextHeight;Fa(this);this.curOp.forceUpdate=!0;jc(this);this.scrollTo(this.doc.scrollLeft,this.doc.scrollTop);r(this);
(null==a||.5<Math.abs(a-vb(this.display)))&&g(this);va(this,"refresh",this)}),swapDoc:ya(function(a){var b=this.doc;b.cm=null;Zd(this,a);jc(this);this.display.input.reset();this.scrollTo(a.scrollLeft,a.scrollTop);this.curOp.forceScroll=!0;Aa(this,"swapDoc",this,b);return b}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};
ac(d);var vf=d.defaults={},Kb=d.optionHandlers={},$d=d.Init={toString:function(){return"CodeMirror.Init"}};W("value","",function(a,b){a.setValue(b)},!0);W("mode",null,function(a,c){a.doc.modeOption=c;b(a)},!0);W("indentUnit",2,b,!0);W("indentWithTabs",!1);W("smartIndent",!0);W("tabSize",4,function(b){a(b);jc(b);Fa(b)},!0);W("lineSeparator",null,function(a,b){if(a.doc.lineSep=b){var c=[],f=a.doc.first;a.doc.iter(function(a){for(var d=0;;){var g=a.text.indexOf(b,d);if(-1==g)break;d=g+b.length;c.push(L(f,
g))}f++});for(var d=c.length-1;0<=d;d--)Xb(a.doc,b,c[d],L(c[d].line,c[d].ch+b.length))}});W("specialChars",/[\t\u0000-\u0019\u00ad\u200b-\u200f\u2028\u2029\ufeff]/g,function(a,b,c){a.state.specialChars=new RegExp(b.source+(b.test("\t")?"":"|\t"),"g");c!=d.Init&&a.refresh()});W("specialCharPlaceholder",function(a){var b=Q("span","\u2022","cm-invalidchar");b.title="\\u"+a.charCodeAt(0).toString(16);b.setAttribute("aria-label",b.title);return b},function(a){a.refresh()},!0);W("electricChars",!0);W("inputStyle",
dc?"contenteditable":"textarea",function(){throw Error("inputStyle can not (yet) be changed in a running editor");},!0);W("rtlMoveVisually",!ng);W("wholeLineUpdateBefore",!0);W("theme","default",function(a){h(a);m(a)},!0);W("keyMap","default",function(a,b,c){b=gd(b);(c=c!=d.Init&&gd(c))&&c.detach&&c.detach(a,b);b.attach&&b.attach(a,c||null)});W("extraKeys",null);W("lineWrapping",!1,function(a){a.options.lineWrapping?(nc(a.display.wrapper,"CodeMirror-wrap"),a.display.sizer.style.minWidth="",a.display.sizerWidth=
null):(kc(a.display.wrapper,"CodeMirror-wrap"),z(a));g(a);Fa(a);jc(a);setTimeout(function(){B(a)},100)},!0);W("gutters",[],function(a){t(a.options);m(a)},!0);W("fixedGutter",!0,function(a,b){a.display.gutters.style.left=b?I(a.display)+"px":"0";a.refresh()},!0);W("coverGutterNextToScrollbar",!1,function(a){B(a)},!0);W("scrollbarStyle","native",function(a){p(a);B(a);a.display.scrollbars.setScrollTop(a.doc.scrollTop);a.display.scrollbars.setScrollLeft(a.doc.scrollLeft)},!0);W("lineNumbers",!1,function(a){t(a.options);
m(a)},!0);W("firstLineNumber",1,m,!0);W("lineNumberFormatter",function(a){return a},m,!0);W("showCursorWhenSelecting",!1,oc,!0);W("resetSelectionOnContextMenu",!0);W("lineWiseCopyCut",!0);W("readOnly",!1,function(a,b){"nocursor"==b?(gc(a),a.display.input.blur(),a.display.disabled=!0):(a.display.disabled=!1,b||a.display.input.reset())});W("disableInput",!1,function(a,b){b||a.display.input.reset()},!0);W("dragDrop",!0,function(a,b,c){!b!=!(c&&c!=d.Init)&&(c=a.display.dragFunctions,b=b?U:hb,b(a.display.scroller,
"dragstart",c.start),b(a.display.scroller,"dragenter",c.simple),b(a.display.scroller,"dragover",c.simple),b(a.display.scroller,"drop",c.drop))});W("cursorBlinkRate",530);W("cursorScrollMargin",0);W("cursorHeight",1,oc,!0);W("singleCursorHeightPerLine",!0,oc,!0);W("workTime",100);W("workDelay",100);W("flattenSpans",!0,a,!0);W("addModeClass",!1,a,!0);W("pollInterval",100);W("undoDepth",200,function(a,b){a.doc.history.undoDepth=b});W("historyEventDelay",1250);W("viewportMargin",10,function(a){a.refresh()},
!0);W("maxHighlightLength",1E4,a,!0);W("moveInputWithCursor",!0,function(a,b){b||a.display.input.resetPosition()});W("tabindex",null,function(a,b){a.display.input.getField().tabIndex=b||""});W("autofocus",null);var uf=d.modes={},Ec=d.mimeModes={};d.defineMode=function(a,b){d.defaults.mode||"null"==a||(d.defaults.mode=a);2<arguments.length&&(b.dependencies=Array.prototype.slice.call(arguments,2));uf[a]=b};d.defineMIME=function(a,b){Ec[a]=b};d.resolveMode=function(a){if("string"==typeof a&&Ec.hasOwnProperty(a))a=
Ec[a];else if(a&&"string"==typeof a.name&&Ec.hasOwnProperty(a.name)){var b=Ec[a.name];"string"==typeof b&&(b={name:b});a=lf(b,a);a.name=b.name}else if("string"==typeof a&&/^[\w\-]+\/[\w\-]+\+xml$/.test(a))return d.resolveMode("application/xml");return"string"==typeof a?{name:a}:a||{name:"null"}};d.getMode=function(a,b){b=d.resolveMode(b);var c=uf[b.name];if(!c)return d.getMode(a,"text/plain");a=c(a,b);if(Fc.hasOwnProperty(b.name)){c=Fc[b.name];for(var f in c)c.hasOwnProperty(f)&&(a.hasOwnProperty(f)&&
(a["_"+f]=a[f]),a[f]=c[f])}a.name=b.name;b.helperType&&(a.helperType=b.helperType);if(b.modeProps)for(f in b.modeProps)a[f]=b.modeProps[f];return a};d.defineMode("null",function(){return{token:function(a){a.skipToEnd()}}});d.defineMIME("text/plain","null");var Fc=d.modeExtensions={};d.extendMode=function(a,b){a=Fc.hasOwnProperty(a)?Fc[a]:Fc[a]={};Ta(b,a)};d.defineExtension=function(a,b){d.prototype[a]=b};d.defineDocExtension=function(a,b){Ea.prototype[a]=b};d.defineOption=W;var od=[];d.defineInitHook=
function(a){od.push(a)};var cc=d.helpers={};d.registerHelper=function(a,b,c){cc.hasOwnProperty(a)||(cc[a]=d[a]={_global:[]});cc[a][b]=c};d.registerGlobalHelper=function(a,b,c,f){d.registerHelper(a,b,f);cc[a]._global.push({pred:c,val:f})};var Tb=d.copyState=function(a,b){if(!0===b)return b;if(a.copyState)return a.copyState(b);a={};for(var c in b){var f=b[c];f instanceof Array&&(f=f.concat([]));a[c]=f}return a},Ef=d.startState=function(a,b,c){return a.startState?a.startState(b,c):!0};d.innerMode=function(a,
b){for(;a.innerMode;){var c=a.innerMode(b);if(!c||c.mode==a)break;b=c.state;a=c.mode}return c||{mode:a,state:b}};var $c=d.commands={selectAll:function(a){a.setSelection(L(a.firstLine(),0),L(a.lastLine()),eb)},singleSelection:function(a){a.setSelection(a.getCursor("anchor"),a.getCursor("head"),eb)},killLine:function(a){Yb(a,function(b){if(b.empty()){var c=T(a.doc,b.head.line).text.length;return b.head.ch==c&&b.head.line<a.lastLine()?{from:b.head,to:L(b.head.line+1,0)}:{from:b.head,to:L(b.head.line,
c)}}return{from:b.from(),to:b.to()}})},deleteLine:function(a){Yb(a,function(b){return{from:L(b.from().line,0),to:S(a.doc,L(b.to().line+1,0))}})},delLineLeft:function(a){Yb(a,function(a){return{from:L(a.from().line,0),to:a.from()}})},delWrappedLineLeft:function(a){Yb(a,function(b){var c=a.charCoords(b.head,"div").top+5;return{from:a.coordsChar({left:0,top:c},"div"),to:b.from()}})},delWrappedLineRight:function(a){Yb(a,function(b){var c=a.charCoords(b.head,"div").top+5;c=a.coordsChar({left:a.display.lineDiv.offsetWidth+
100,top:c},"div");return{from:b.from(),to:c}})},undo:function(a){a.undo()},redo:function(a){a.redo()},undoSelection:function(a){a.undoSelection()},redoSelection:function(a){a.redoSelection()},goDocStart:function(a){a.extendSelection(L(a.firstLine(),0))},goDocEnd:function(a){a.extendSelection(L(a.lastLine()))},goLineStart:function(a){a.extendSelectionsBy(function(b){return pf(a,b.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(a){a.extendSelectionsBy(function(b){return qf(a,b.head)},
{origin:"+move",bias:1})},goLineEnd:function(a){a.extendSelectionsBy(function(b){b=b.head.line;for(var c,f=T(a.doc,b);c=zb(f,!1);)f=c.find(1,!0).line,b=null;c=(c=Va(f))?c[0].level%2?Sc(f):Tc(f):f.text.length;return L(null==b?na(f):b,c)},{origin:"+move",bias:-1})},goLineRight:function(a){a.extendSelectionsBy(function(b){b=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:b},"div")},Dc)},goLineLeft:function(a){a.extendSelectionsBy(function(b){b=a.charCoords(b.head,
"div").top+5;return a.coordsChar({left:0,top:b},"div")},Dc)},goLineLeftSmart:function(a){a.extendSelectionsBy(function(b){var c=a.charCoords(b.head,"div").top+5;c=a.coordsChar({left:0,top:c},"div");return c.ch<a.getLine(c.line).search(/\S/)?qf(a,b.head):c},Dc)},goLineUp:function(a){a.moveV(-1,"line")},goLineDown:function(a){a.moveV(1,"line")},goPageUp:function(a){a.moveV(-1,"page")},goPageDown:function(a){a.moveV(1,"page")},goCharLeft:function(a){a.moveH(-1,"char")},goCharRight:function(a){a.moveH(1,
"char")},goColumnLeft:function(a){a.moveH(-1,"column")},goColumnRight:function(a){a.moveH(1,"column")},goWordLeft:function(a){a.moveH(-1,"word")},goGroupRight:function(a){a.moveH(1,"group")},goGroupLeft:function(a){a.moveH(-1,"group")},goWordRight:function(a){a.moveH(1,"word")},delCharBefore:function(a){a.deleteH(-1,"char")},delCharAfter:function(a){a.deleteH(1,"char")},delWordBefore:function(a){a.deleteH(-1,"word")},delWordAfter:function(a){a.deleteH(1,"word")},delGroupBefore:function(a){a.deleteH(-1,
"group")},delGroupAfter:function(a){a.deleteH(1,"group")},indentAuto:function(a){a.indentSelection("smart")},indentMore:function(a){a.indentSelection("add")},indentLess:function(a){a.indentSelection("subtract")},insertTab:function(a){a.replaceSelection("\t")},insertSoftTab:function(a){for(var b=[],c=a.listSelections(),f=a.options.tabSize,d=0;d<c.length;d++){var g=c[d].from();g=Xa(a.getLine(g.line),g.ch,f);b.push(Array(f-g%f+1).join(" "))}a.replaceSelections(b)},defaultTab:function(a){a.somethingSelected()?
a.indentSelection("add"):a.execCommand("insertTab")},transposeChars:function(a){La(a,function(){for(var b=a.listSelections(),c=[],f=0;f<b.length;f++){var d=b[f].head,g=T(a.doc,d.line).text;if(g)if(d.ch==g.length&&(d=new L(d.line,d.ch-1)),0<d.ch)d=new L(d.line,d.ch+1),a.replaceRange(g.charAt(d.ch-1)+g.charAt(d.ch-2),L(d.line,d.ch-2),d,"+transpose");else if(d.line>a.doc.first){var h=T(a.doc,d.line-1).text;h&&a.replaceRange(g.charAt(0)+a.doc.lineSeparator()+h.charAt(h.length-1),L(d.line-1,h.length-1),
L(d.line,1),"+transpose")}c.push(new la(d,d))}a.setSelections(c)})},newlineAndIndent:function(a){La(a,function(){for(var b=a.listSelections().length,c=0;c<b;c++){var f=a.listSelections()[c];a.replaceRange(a.doc.lineSeparator(),f.anchor,f.head,"+input");a.indentLine(f.from().line+1,null,!0);Ob(a)}})},toggleOverwrite:function(a){a.toggleOverwrite()}},sb=d.keyMap={};sb.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",
PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"};sb.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart",
"Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"};sb.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft",
"Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"};sb.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft",
"Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]};sb["default"]=
Ua?sb.macDefault:sb.pcDefault;d.normalizeKeyMap=function(a){var b={},c;for(c in a)if(a.hasOwnProperty(c)){var f=a[c];if(!/^(name|fallthrough|(de|at)tach)$/.test(c)){if("..."!=f)for(var d=Ic(c.split(" "),Xf),g=0;g<d.length;g++){if(g==d.length-1){var h=d.join(" ");var n=f}else h=d.slice(0,g+1).join(" "),n="...";var u=b[h];if(!u)b[h]=n;else if(u!=n)throw Error("Inconsistent bindings for "+h);}delete a[c]}}for(var m in b)a[m]=b[m];return a};var uc=d.lookupKey=function(a,b,c,f){b=gd(b);var d=b.call?b.call(a,
f):b[a];if(!1===d)return"nothing";if("..."===d)return"multi";if(null!=d&&c(d))return"handled";if(b.fallthrough){if("[object Array]"!=Object.prototype.toString.call(b.fallthrough))return uc(a,b.fallthrough,c,f);for(d=0;d<b.fallthrough.length;d++){var g=uc(a,b.fallthrough[d],c,f);if(g)return g}}},Qf=d.isModifierKey=function(a){a="string"==typeof a?a:tb[a.keyCode];return"Ctrl"==a||"Alt"==a||"Shift"==a||"Mod"==a},Sf=d.keyName=function(a,b){if(Ya&&34==a.keyCode&&a["char"])return!1;var c=tb[a.keyCode],
f=c;if(null==f||a.altGraphKey)return!1;a.altKey&&"Alt"!=c&&(f="Alt-"+f);(tf?a.metaKey:a.ctrlKey)&&"Ctrl"!=c&&(f="Ctrl-"+f);(tf?a.ctrlKey:a.metaKey)&&"Cmd"!=c&&(f="Cmd-"+f);!b&&a.shiftKey&&"Shift"!=c&&(f="Shift-"+f);return f};d.fromTextArea=function(a,b){function c(){a.value=m.getValue()}b=b?Ta(b):{};b.value=a.value;!b.tabindex&&a.tabIndex&&(b.tabindex=a.tabIndex);!b.placeholder&&a.placeholder&&(b.placeholder=a.placeholder);if(null==b.autofocus){var f=cb();b.autofocus=f==a||null!=a.getAttribute("autofocus")&&
f==document.body}if(a.form&&(U(a.form,"submit",c),!b.leaveSubmitMethodAlone)){var g=a.form,h=g.submit;try{var n=g.submit=function(){c();g.submit=h;g.submit();g.submit=n}}catch(yf){}}b.finishInit=function(b){b.save=c;b.getTextArea=function(){return a};b.toTextArea=function(){b.toTextArea=isNaN;c();a.parentNode.removeChild(b.getWrapperElement());a.style.display="";a.form&&(hb(a.form,"submit",c),"function"==typeof a.form.submit&&(a.form.submit=h))}};a.style.display="none";var m=d(function(b){a.parentNode.insertBefore(b,
a.nextSibling)},b);return m};var kd=d.StringStream=function(a,b){this.pos=this.start=0;this.string=a;this.tabSize=b||8;this.lineStart=this.lastColumnPos=this.lastColumnValue=0};kd.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(a){var b=this.string.charAt(this.pos);if("string"==
typeof a?b==a:b&&(a.test?a.test(b):a(b)))return++this.pos,b},eatWhile:function(a){for(var b=this.pos;this.eat(a););return this.pos>b},eatSpace:function(){for(var a=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>a},skipToEnd:function(){this.pos=this.string.length},skipTo:function(a){a=this.string.indexOf(a,this.pos);if(-1<a)return this.pos=a,!0},backUp:function(a){this.pos-=a},column:function(){this.lastColumnPos<this.start&&(this.lastColumnValue=Xa(this.string,
this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start);return this.lastColumnValue-(this.lineStart?Xa(this.string,this.lineStart,this.tabSize):0)},indentation:function(){return Xa(this.string,null,this.tabSize)-(this.lineStart?Xa(this.string,this.lineStart,this.tabSize):0)},match:function(a,b,c){if("string"==typeof a){var f=function(a){return c?a.toLowerCase():a},d=this.string.substr(this.pos,a.length);if(f(d)==f(a))return!1!==b&&(this.pos+=a.length),!0}else{if((a=
this.string.slice(this.pos).match(a))&&0<a.index)return null;a&&!1!==b&&(this.pos+=a[0].length);return a}},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(a,b){this.lineStart+=a;try{return b()}finally{this.lineStart-=a}}};var Qd=0,Hb=d.TextMarker=function(a,b){this.lines=[];this.type=b;this.doc=a;this.id=++Qd};ac(Hb);Hb.prototype.clear=function(){if(!this.explicitlyCleared){var a=this.doc.cm,b=a&&!a.curOp;b&&Jb(a);if(Qa(this,"clear")){var c=this.find();c&&
Aa(this,"clear",c.from,c.to)}for(var f=c=null,d=0;d<this.lines.length;++d){var g=this.lines[d],h=wc(g.markedSpans,this);a&&!this.collapsed?lb(a,na(g),"text"):a&&(null!=h.to&&(f=na(g)),null!=h.from&&(c=na(g)));for(var n=g,m=void 0,p=g.markedSpans,q=h,F=0;F<p.length;++F)p[F]!=q&&(m||(m=[])).push(p[F]);n.markedSpans=m;null==h.from&&this.collapsed&&!xb(this.doc,g)&&a&&$a(g,vb(a.display))}if(a&&this.collapsed&&!a.options.lineWrapping)for(d=0;d<this.lines.length;++d)g=fb(this.lines[d]),h=A(g),h>a.display.maxLineLength&&
(a.display.maxLine=g,a.display.maxLineLength=h,a.display.maxLineChanged=!0);null!=c&&a&&this.collapsed&&Fa(a,c,f+1);this.lines.length=0;this.explicitlyCleared=!0;this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,a&&ke(a.doc));a&&Aa(a,"markerCleared",a,this);b&&Lb(a);this.parent&&this.parent.clear()}};Hb.prototype.find=function(a,b){null==a&&"bookmark"==this.type&&(a=1);for(var c,f,d=0;d<this.lines.length;++d){var g=this.lines[d],h=wc(g.markedSpans,this);if(null!=h.from&&(c=L(b?g:na(g),h.from),
-1==a))return c;if(null!=h.to&&(f=L(b?g:na(g),h.to),1==a))return f}return c&&{from:c,to:f}};Hb.prototype.changed=function(){var a=this.find(-1,!0),b=this,c=this.doc.cm;a&&c&&La(c,function(){var f=a.line,d=na(a.line);if(d=sd(c,d))qe(d),c.curOp.selectionChanged=c.curOp.forceUpdate=!0;c.curOp.updateMaxLine=!0;xb(b.doc,f)||null==b.height||(d=b.height,b.height=null,(d=sc(b)-d)&&$a(f,f.height+d))})};Hb.prototype.attachLine=function(a){if(!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;b.maybeHiddenMarkers&&
-1!=za(b.maybeHiddenMarkers,this)||(b.maybeUnhiddenMarkers||(b.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(a)};Hb.prototype.detachLine=function(a){this.lines.splice(za(this.lines,a),1);!this.lines.length&&this.doc.cm&&(a=this.doc.cm.curOp,(a.maybeHiddenMarkers||(a.maybeHiddenMarkers=[])).push(this))};Qd=0;var id=d.SharedTextMarker=function(a,b){this.markers=a;this.primary=b;for(b=0;b<a.length;++b)a[b].parent=this};ac(id);id.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=
!0;for(var a=0;a<this.markers.length;++a)this.markers[a].clear();Aa(this,"clear")}};id.prototype.find=function(a,b){return this.primary.find(a,b)};var jd=d.LineWidget=function(a,b,c){if(c)for(var f in c)c.hasOwnProperty(f)&&(this[f]=c[f]);this.doc=a;this.node=b};ac(jd);jd.prototype.clear=function(){var a=this.doc.cm,b=this.line.widgets,c=this.line,f=na(c);if(null!=f&&b){for(var d=0;d<b.length;++d)b[d]==this&&b.splice(d--,1);b.length||(c.widgets=null);var g=sc(this);$a(c,Math.max(0,c.height-g));a&&
La(a,function(){var b=-g;bb(c)<(a.curOp&&a.curOp.scrollTop||a.doc.scrollTop)&&cd(a,null,b);lb(a,f,"widget")})}};jd.prototype.changed=function(){var a=this.height,b=this.doc.cm,c=this.line;this.height=null;var f=sc(this)-a;f&&($a(c,c.height+f),b&&La(b,function(){b.curOp.forceUpdate=!0;bb(c)<(b.curOp&&b.curOp.scrollTop||b.doc.scrollTop)&&cd(b,null,f)}))};var xc=d.Line=function(a,b,c){this.text=a;Ze(this,b);this.height=c?c(this):1};ac(xc);xc.prototype.lineNo=function(){return na(this)};var cg={},bg=
{};yc.prototype={chunkSize:function(){return this.lines.length},removeInner:function(a,b){for(var c=a,f=a+b;c<f;++c){var d=this.lines[c];this.height-=d.height;var g=d;g.parent=null;Ye(g);Aa(d,"delete")}this.lines.splice(a,b)},collapse:function(a){a.push.apply(a,this.lines)},insertInner:function(a,b,c){this.height+=c;this.lines=this.lines.slice(0,a).concat(b).concat(this.lines.slice(a));for(a=0;a<b.length;++a)b[a].parent=this},iterN:function(a,b,c){for(b=a+b;a<b;++a)if(c(this.lines[a]))return!0}};
zc.prototype={chunkSize:function(){return this.size},removeInner:function(a,b){this.size-=b;for(var c=0;c<this.children.length;++c){var f=this.children[c],d=f.chunkSize();if(a<d){var g=Math.min(b,d-a),h=f.height;f.removeInner(a,g);this.height-=h-f.height;d==g&&(this.children.splice(c--,1),f.parent=null);if(0==(b-=g))break;a=0}else a-=d}25>this.size-b&&(1<this.children.length||!(this.children[0]instanceof yc))&&(a=[],this.collapse(a),this.children=[new yc(a)],this.children[0].parent=this)},collapse:function(a){for(var b=
0;b<this.children.length;++b)this.children[b].collapse(a)},insertInner:function(a,b,c){this.size+=b.length;this.height+=c;for(var f=0;f<this.children.length;++f){var d=this.children[f],g=d.chunkSize();if(a<=g){d.insertInner(a,b,c);if(d.lines&&50<d.lines.length){for(;50<d.lines.length;)a=d.lines.splice(d.lines.length-25,25),a=new yc(a),d.height-=a.height,this.children.splice(f+1,0,a),a.parent=this;this.maybeSpill()}break}a-=g}},maybeSpill:function(){if(!(10>=this.children.length)){var a=this;do{var b=
a.children.splice(a.children.length-5,5);b=new zc(b);if(a.parent){a.size-=b.size;a.height-=b.height;var c=za(a.parent.children,a);a.parent.children.splice(c+1,0,b)}else c=new zc(a.children),c.parent=a,a.children=[c,b],a=c;b.parent=a.parent}while(10<a.children.length);a.parent.maybeSpill()}},iterN:function(a,b,c){for(var f=0;f<this.children.length;++f){var d=this.children[f],g=d.chunkSize();if(a<g){g=Math.min(b,g-a);if(d.iterN(a,g,c))return!0;if(0==(b-=g))break;a=0}else a-=g}}};var pg=0,Ea=d.Doc=function(a,
b,c,f){if(!(this instanceof Ea))return new Ea(a,b,c,f);null==c&&(c=0);zc.call(this,[new yc([new xc("",null)])]);this.first=c;this.scrollTop=this.scrollLeft=0;this.cantEdit=!1;this.cleanGeneration=1;this.frontier=c;c=L(c,0);this.sel=sa(c);this.history=new ld(null);this.id=++pg;this.modeOption=b;this.lineSep=f;"string"==typeof a&&(a=this.splitLines(a));Od(this,{from:c,to:c,text:a});ma(this,sa(c),eb)};Ea.prototype=lf(zc.prototype,{constructor:Ea,iter:function(a,b,c){c?this.iterN(a-this.first,b-a,c):
this.iterN(this.first,this.first+this.size,a)},insert:function(a,b){for(var c=0,f=0;f<b.length;++f)c+=b[f].height;this.insertInner(a-this.first,b,c)},remove:function(a,b){this.removeInner(a-this.first,b)},getValue:function(a){var b=Vd(this,this.first,this.first+this.size);return!1===a?b:b.join(a||this.lineSeparator())},setValue:Ba(function(a){var b=L(this.first,0),c=this.first+this.size-1;Nb(this,{from:b,to:L(c,T(this,c).text.length),text:this.splitLines(a),origin:"setValue",full:!0},!0);ma(this,
sa(b))}),replaceRange:function(a,b,c,f){b=S(this,b);c=c?S(this,c):b;Xb(this,a,b,c,f)},getRange:function(a,b,c){a=Cb(this,S(this,a),S(this,b));return!1===c?a:a.join(c||this.lineSeparator())},getLine:function(a){return(a=this.getLineHandle(a))&&a.text},getLineHandle:function(a){if(jb(this,a))return T(this,a)},getLineNumber:function(a){return na(a)},getLineHandleVisualStart:function(a){"number"==typeof a&&(a=T(this,a));return fb(a)},lineCount:function(){return this.size},firstLine:function(){return this.first},
lastLine:function(){return this.first+this.size-1},clipPos:function(a){return S(this,a)},getCursor:function(a){var b=this.sel.primary();return null==a||"head"==a?b.head:"anchor"==a?b.anchor:"end"==a||"to"==a||!1===a?b.to():b.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:Ba(function(a,b,c){a=S(this,"number"==typeof a?L(a,b||0):a);ma(this,sa(a,null),c)}),setSelection:Ba(function(a,b,c){var f=S(this,a);a=S(this,b||
a);ma(this,sa(f,a),c)}),extendSelection:Ba(function(a,b,c){F(this,S(this,a),b&&S(this,b),c)}),extendSelections:Ba(function(a,b){b=[];for(var c=0;c<a.length;c++)b[c]=S(this,a[c]);N(this,b)}),extendSelectionsBy:Ba(function(a,b){N(this,Ic(this.sel.ranges,a),b)}),setSelections:Ba(function(a,b,c){if(a.length){for(var f=0,d=[];f<a.length;f++)d[f]=new la(S(this,a[f].anchor),S(this,a[f].head));null==b&&(b=Math.min(a.length-1,this.sel.primIndex));ma(this,Na(d,b),c)}}),addSelection:Ba(function(a,b,c){var f=
this.sel.ranges.slice(0);f.push(new la(S(this,a),S(this,b||a)));ma(this,Na(f,f.length-1),c)}),getSelection:function(a){for(var b=this.sel.ranges,c,f=0;f<b.length;f++){var d=Cb(this,b[f].from(),b[f].to());c=c?c.concat(d):d}return!1===a?c:c.join(a||this.lineSeparator())},getSelections:function(a){for(var b=[],c=this.sel.ranges,f=0;f<c.length;f++){var d=Cb(this,c[f].from(),c[f].to());!1!==a&&(d=d.join(a||this.lineSeparator()));b[f]=d}return b},replaceSelection:function(a,b,c){for(var f=[],d=0;d<this.sel.ranges.length;d++)f[d]=
a;this.replaceSelections(f,b,c||"+input")},replaceSelections:Ba(function(a,b,c){for(var f=[],d=this.sel,g=0;g<d.ranges.length;g++){var h=d.ranges[g];f[g]={from:h.from(),to:h.to(),text:this.splitLines(a[g]),origin:c}}if(g=b&&"end"!=b){g=[];c=a=L(this.first,0);for(d=0;d<f.length;d++){var n=f[d];h=Je(n.from,a,c);var m=Je(Fb(n),a,c);a=n.to;c=m;"around"==b?(n=this.sel.ranges[d],n=0>Y(n.head,n.anchor),g[d]=new la(n?m:h,n?h:m)):g[d]=new la(h,h)}g=new Ma(g,this.sel.primIndex)}b=g;for(g=f.length-1;0<=g;g--)Nb(this,
f[g]);b?Ga(this,b):this.cm&&Ob(this.cm)}),undo:Ba(function(){bd(this,"undo")}),redo:Ba(function(){bd(this,"redo")}),undoSelection:Ba(function(){bd(this,"undo",!0)}),redoSelection:Ba(function(){bd(this,"redo",!0)}),setExtending:function(a){this.extend=a},getExtending:function(){return this.extend},historySize:function(){for(var a=this.history,b=0,c=0,f=0;f<a.done.length;f++)a.done[f].ranges||++b;for(f=0;f<a.undone.length;f++)a.undone[f].ranges||++c;return{undo:b,redo:c}},clearHistory:function(){this.history=
new ld(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(a){a&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null);return this.history.generation},isClean:function(a){return this.history.generation==(a||this.cleanGeneration)},getHistory:function(){return{done:$b(this.history.done),undone:$b(this.history.undone)}},setHistory:function(a){var b=this.history=new ld(this.history.maxGeneration);b.done=$b(a.done.slice(0),
null,!0);b.undone=$b(a.undone.slice(0),null,!0)},addLineClass:Ba(function(a,b,c){return ed(this,a,"gutter"==b?"gutter":"class",function(a){var f="text"==b?"textClass":"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass";if(a[f]){if(Cc(c).test(a[f]))return!1;a[f]+=" "+c}else a[f]=c;return!0})}),removeLineClass:Ba(function(a,b,c){return ed(this,a,"gutter"==b?"gutter":"class",function(a){var f="text"==b?"textClass":"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass",d=a[f];if(d)if(null==
c)a[f]=null;else{var g=d.match(Cc(c));if(!g)return!1;var h=g.index+g[0].length;a[f]=d.slice(0,g.index)+(g.index&&h!=d.length?" ":"")+d.slice(h)||null}else return!1;return!0})}),addLineWidget:Ba(function(a,b,c){return ag(this,a,b,c)}),removeLineWidget:function(a){a.clear()},markText:function(a,b,c){return Zb(this,S(this,a),S(this,b),c,"range")},setBookmark:function(a,b){b={replacedWith:b&&(null==b.nodeType?b.widget:b),insertLeft:b&&b.insertLeft,clearWhenEmpty:!1,shared:b&&b.shared,handleMouseEvents:b&&
b.handleMouseEvents};a=S(this,a);return Zb(this,a,a,b,"bookmark")},findMarksAt:function(a){a=S(this,a);var b=[],c=T(this,a.line).markedSpans;if(c)for(var f=0;f<c.length;++f){var d=c[f];(null==d.from||d.from<=a.ch)&&(null==d.to||d.to>=a.ch)&&b.push(d.marker.parent||d.marker)}return b},findMarks:function(a,b,c){a=S(this,a);b=S(this,b);var f=[],d=a.line;this.iter(a.line,b.line+1,function(g){if(g=g.markedSpans)for(var h=0;h<g.length;h++){var n=g[h];d==a.line&&a.ch>n.to||null==n.from&&d!=a.line||d==b.line&&
n.from>b.ch||c&&!c(n.marker)||f.push(n.marker.parent||n.marker)}++d});return f},getAllMarks:function(){var a=[];this.iter(function(b){if(b=b.markedSpans)for(var c=0;c<b.length;++c)null!=b[c].from&&a.push(b[c].marker)});return a},posFromIndex:function(a){var b,c=this.first;this.iter(function(f){f=f.text.length+1;if(f>a)return b=a,!0;a-=f;++c});return S(this,L(c,b))},indexFromPos:function(a){a=S(this,a);var b=a.ch;if(a.line<this.first||0>a.ch)return 0;this.iter(this.first,a.line,function(a){b+=a.text.length+
1});return b},copy:function(a){var b=new Ea(Vd(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep);b.scrollTop=this.scrollTop;b.scrollLeft=this.scrollLeft;b.sel=this.sel;b.extend=!1;a&&(b.history.undoDepth=this.history.undoDepth,b.setHistory(this.getHistory()));return b},linkedDoc:function(a){a||(a={});var b=this.first,c=this.first+this.size;null!=a.from&&a.from>b&&(b=a.from);null!=a.to&&a.to<c&&(c=a.to);b=new Ea(Vd(this,b,c),a.mode||this.modeOption,b,this.lineSep);a.sharedHist&&
(b.history=this.history);(this.linked||(this.linked=[])).push({doc:b,sharedHist:a.sharedHist});b.linked=[{doc:this,isParent:!0,sharedHist:a.sharedHist}];a=We(this);for(c=0;c<a.length;c++){var f=a[c],d=f.find(),g=b.clipPos(d.from);d=b.clipPos(d.to);Y(g,d)&&(g=Zb(b,g,d,f.primary,f.primary.type),f.markers.push(g),g.parent=f)}return b},unlinkDoc:function(a){a instanceof d&&(a=a.doc);if(this.linked)for(var b=0;b<this.linked.length;++b)if(this.linked[b].doc==a){this.linked.splice(b,1);a.unlinkDoc(this);
Zf(We(this));break}if(a.history==this.history){var c=[a.id];Gb(a,function(a){c.push(a.id)},!0);a.history=new ld(null);a.history.done=$b(this.history.done,c);a.history.undone=$b(this.history.undone,c)}},iterLinkedDocs:function(a){Gb(this,a)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(a){return this.lineSep?a.split(this.lineSep):qg(a)},lineSeparator:function(){return this.lineSep||"\n"}});Ea.prototype.eachLine=Ea.prototype.iter;var rg="iter insert remove copy getEditor constructor".split(" "),
Gc;for(Gc in Ea.prototype)Ea.prototype.hasOwnProperty(Gc)&&0>za(rg,Gc)&&(d.prototype[Gc]=function(a){return function(){return a.apply(this.doc,arguments)}}(Ea.prototype[Gc]));ac(Ea);var Ca=d.e_preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},sg=d.e_stopPropagation=function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},Hd=d.e_stop=function(a){Ca(a);sg(a)},U=d.on=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+
b,c):(a=a._handlers||(a._handlers={}),(a[b]||(a[b]=[])).push(c))},hb=d.off=function(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,!1);else if(a.detachEvent)a.detachEvent("on"+b,c);else if(a=a._handlers&&a._handlers[b])for(b=0;b<a.length;++b)if(a[b]==c){a.splice(b,1);break}},va=d.signal=function(a,b){var c=a._handlers&&a._handlers[b];if(c)for(var f=Array.prototype.slice.call(arguments,2),d=0;d<c.length;++d)c[d].apply(null,f)},Ac=null,ae=30,Fe=d.Pass={toString:function(){return"CodeMirror.Pass"}},
eb={scroll:!1},Id={origin:"*mouse"},Dc={origin:"+move"};ec.prototype.set=function(a,b){clearTimeout(this.id);this.id=setTimeout(b,a)};var Xa=d.countColumn=function(a,b,c,f,d){null==b&&(b=a.search(/[^\s\u00a0]/),-1==b&&(b=a.length));f=f||0;for(d=d||0;;){var g=a.indexOf("\t",f);if(0>g||g>=b)return d+(b-f);d+=g-f;d+=c-d%c;f=g+1}},md=[""],bc=function(a){a.select()};Qb?bc=function(a){a.selectionStart=0;a.selectionEnd=a.value.length}:ha&&(bc=function(a){try{a.select()}catch(x){}});var tg=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,
mf=d.isWordChar=function(a){return/\w/.test(a)||"\u0080"<a&&(a.toUpperCase()!=a.toLowerCase()||tg.test(a))},jg=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;
var Ub=document.createRange?function(a,b,c,f){var d=document.createRange();d.setEnd(f||a,c);d.setStart(a,b);return d}:function(a,b,c){var f=document.body.createTextRange();try{f.moveToElementText(a.parentNode)}catch(ca){return f}f.collapse(!0);f.moveEnd("character",c);f.moveStart("character",b);return f};var ud=d.contains=function(a,b){3==b.nodeType&&(b=b.parentNode);if(a.contains)return a.contains(b);do if(11==b.nodeType&&(b=b.host),b==a)return!0;while(b=b.parentNode)};ha&&11>pa&&(cb=function(){try{return document.activeElement}catch(u){return document.body}});
var kc=d.rmClass=function(a,b){var c=a.className;if(b=Cc(b).exec(c)){var f=c.slice(b.index+b[0].length);a.className=c.slice(0,b.index)+(f?b[1]+f:"")}},nc=d.addClass=function(a,b){var c=a.className;Cc(b).test(c)||(a.className+=(c?" ":"")+b)},Yd=!1,Mf=function(){if(ha&&9>pa)return!1;var a=Q("div");return"draggable"in a||"dragDrop"in a}(),Wd,Td,qg=d.splitLines=3!="\n\nb".split(/\n/).length?function(a){for(var b=0,c=[],f=a.length;b<=f;){var d=a.indexOf("\n",b);-1==d&&(d=a.length);var g=a.slice(b,"\r"==
a.charAt(d-1)?d-1:d),h=g.indexOf("\r");-1!=h?(c.push(g.slice(0,h)),b+=h+1):(c.push(g),b=d+1)}return c}:function(a){return a.split(/\r\n?|\n/)},og=window.getSelection?function(a){try{return a.selectionStart!=a.selectionEnd}catch(x){return!1}}:function(a){try{var b=a.ownerDocument.selection.createRange()}catch(E){}return b&&b.parentElement()==a?0!=b.compareEndPoints("StartToEnd",b):!1},He=function(){var a=Q("div");if("oncopy"in a)return!0;a.setAttribute("oncopy","return;");return"function"==typeof a.oncopy}(),
zd=null,tb={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",107:"=",109:"-",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",
63276:"PageUp",63277:"PageDown",63302:"Insert"};d.keyNames=tb;(function(){for(var a=0;10>a;a++)tb[a+48]=tb[a+96]=String(a);for(a=65;90>=a;a++)tb[a]=String.fromCharCode(a);for(a=1;12>=a;a++)tb[a+111]=tb[a+63235]="F"+a})();var tc,hg=function(){function a(a){return 247>=a?"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN".charAt(a):
1424<=a&&1524>=a?"R":1536<=a&&1773>=a?"rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm".charAt(a-1536):1774<=a&&2220>=a?"r":8192<=a&&8203>=a?"w":8204==a?"b":"L"}function b(a,b,c){this.level=a;this.from=b;this.to=c}var c=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,f=/[stwN]/,d=/[LRr]/,g=/[Lb1n]/,h=/[1n]/;return function(n){if(!c.test(n))return!1;
for(var m=n.length,p=[],q=0,F;q<m;++q)p.push(a(n.charCodeAt(q)));q=0;for(var r="L";q<m;++q)F=p[q],"m"==F?p[q]=r:r=F;q=0;for(r="L";q<m;++q)F=p[q],"1"==F&&"r"==r?p[q]="n":d.test(F)&&(r=F,"r"==F&&(p[q]="R"));q=1;for(r=p[0];q<m-1;++q)F=p[q],"+"==F&&"1"==r&&"1"==p[q+1]?p[q]="1":","!=F||r!=p[q+1]||"1"!=r&&"n"!=r||(p[q]=r),r=F;for(q=0;q<m;++q)if(F=p[q],","==F)p[q]="N";else if("%"==F){for(r=q+1;r<m&&"%"==p[r];++r);var t=q&&"!"==p[q-1]||r<m&&"1"==p[r]?"1":"N";for(F=q;F<r;++F)p[F]=t;q=r-1}q=0;for(r="L";q<m;++q)F=
p[q],"L"==r&&"1"==F?p[q]="L":d.test(F)&&(r=F);for(q=0;q<m;++q)if(f.test(p[q])){for(r=q+1;r<m&&f.test(p[r]);++r);F="L"==(r<m?p[r]:"L");t="L"==(q?p[q-1]:"L")||F?"L":"R";for(F=q;F<r;++F)p[F]=t;q=r-1}r=[];var u;for(q=0;q<m;)if(g.test(p[q])){F=q;for(++q;q<m&&g.test(p[q]);++q);r.push(new b(0,F,q))}else{var w=q;t=r.length;for(++q;q<m&&"L"!=p[q];++q);for(F=w;F<q;)if(h.test(p[F])){w<F&&r.splice(t,0,new b(1,w,F));w=F;for(++F;F<q&&h.test(p[F]);++F);r.splice(t,0,new b(2,w,F));w=F}else++F;w<q&&r.splice(t,0,new b(1,
w,q))}1==r[0].level&&(u=n.match(/^\s+/))&&(r[0].from=u[0].length,r.unshift(new b(0,0,u[0].length)));1==ka(r).level&&(u=n.match(/\s+$/))&&(ka(r).to-=u[0].length,r.push(new b(0,m-u[0].length,m)));2==r[0].level&&r.unshift(new b(1,r[0].to,r[0].to));r[0].level!=ka(r).level&&r.push(new b(r[0].level,m,m));return r}}();d.version="5.5.1";return d}();(function(d){d(CodeMirror)})(function(d){var c=/^(\s*)(>[> ]*|[*+-]\s|(\d+)([.)]))(\s*)/,b=/^(\s*)(>[> ]*|[*+-]|(\d+)[.)])(\s*)$/,a=/[*+-]\s/;d.commands.newlineAndIndentContinueMarkdownList=function(f){if(f.getOption("disableInput"))return d.Pass;for(var g=f.listSelections(),h=[],m=0;m<g.length;m++){var n=g[m].head,r=f.getStateAfter(n.line),A=!1!==r.list,z=0!==r.quote,t=f.getLine(n.line);r=c.exec(t);if(!g[m].empty()||!A&&!z||!r){f.execCommand("newlineAndIndent");return}b.test(t)?(f.replaceRange("",
{line:n.line,ch:0},{line:n.line,ch:n.ch+1}),h[m]="\n"):(n=r[1],A=r[5],r=a.test(r[2])||0<=r[2].indexOf(">")?r[2]:parseInt(r[3],10)+1+r[4],h[m]="\n"+n+r+A)}f.replaceSelections(h)}});(function(d){"object"==typeof exports&&"object"==typeof module?d(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],d):d(CodeMirror)})(function(d){var c={autoSelfClosers:{area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,menuitem:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},contextGrabbers:{dd:{dd:!0,
dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!0,
caseFold:!0},b={autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1,allowMissingTagName:!1,caseFold:!1};d.defineMode("xml",function(a,f){function g(a,b){function c(c){b.tokenize=c;return c(a,b)}var f=a.next();if("<"==f){if(a.eat("!"))return a.eat("[")?a.match("CDATA[")?c(n("atom","]]\x3e")):null:a.match("--")?c(n("comment","--\x3e")):a.match("DOCTYPE",!0,!0)?(a.eatWhile(/[\w\._\-]/),c(r(1))):null;if(a.eat("?"))return a.eatWhile(/[\w\._\-]/),b.tokenize=
n("meta","?>"),"meta";K=a.eat("/")?"closeTag":"openTag";b.tokenize=h;return"tag bracket"}if("&"==f)return(a.eat("#")?a.eat("x")?a.eatWhile(/[a-fA-F\d]/)&&a.eat(";"):a.eatWhile(/[\d]/)&&a.eat(";"):a.eatWhile(/[\w\.\-:]/)&&a.eat(";"))?"atom":"error";a.eatWhile(/[^&<]/);return null}function h(a,b){var c=a.next();if(">"==c||"/"==c&&a.eat(">"))return b.tokenize=g,K=">"==c?"endTag":"selfcloseTag","tag bracket";if("="==c)return K="equals",null;if("<"==c)return b.tokenize=g,b.state=v,b.tagName=b.tagStart=
null,(a=b.tokenize(a,b))?a+" tag error":"tag error";if(/['"]/.test(c))return b.tokenize=m(c),b.stringStartCol=a.column(),b.tokenize(a,b);a.match(/^[^\s\u00a0=<>"']*[^\s\u00a0=<>"'\/]/);return"word"}function m(a){var b=function(b,c){for(;!b.eol();)if(b.next()==a){c.tokenize=h;break}return"string"};b.isInAttribute=!0;return b}function n(a,b){return function(c,f){for(;!c.eol();){if(c.match(b)){f.tokenize=g;break}c.next()}return a}}function r(a){return function(b,c){for(var f;null!=(f=b.next());){if("<"==
f)return c.tokenize=r(a+1),c.tokenize(b,c);if(">"==f)if(1==a){c.tokenize=g;break}else return c.tokenize=r(a-1),c.tokenize(b,c)}return"meta"}}function A(a,b,c){this.prev=a.context;this.tagName=b;this.indent=a.indented;this.startOfLine=c;if(I.doNotIndent.hasOwnProperty(b)||a.context&&a.context.noIndent)this.noIndent=!0}function z(a){a.context&&(a.context=a.context.prev)}function t(a,b){for(var c;a.context;){c=a.context.tagName;if(!I.contextGrabbers.hasOwnProperty(c)||!I.contextGrabbers[c].hasOwnProperty(b))break;
z(a)}}function v(a,b,c){return"openTag"==a?(c.tagStart=b.column(),q):"closeTag"==a?w:v}function q(a,b,c){if("word"==a)return c.tagName=b.current(),R="tag",G;if(I.allowMissingTagName&&"endTag"==a)return R="tag bracket",G(a,b,c);R="error";return q}function w(a,b,c){if("word"==a){a=b.current();c.context&&c.context.tagName!=a&&I.implicitlyClosed.hasOwnProperty(c.context.tagName)&&z(c);if(c.context&&c.context.tagName==a||!1===I.matchClosing)return R="tag",p;R="tag error";return B}if(I.allowMissingTagName&&
"endTag"==a)return R="tag bracket",p(a,b,c);R="error";return B}function p(a,b,c){if("endTag"!=a)return R="error",p;z(c);return v}function B(a,b,c){R="error";return p(a,b,c)}function G(a,b,c){if("word"==a)return R="attribute",H;if("endTag"==a||"selfcloseTag"==a){b=c.tagName;var f=c.tagStart;c.tagName=c.tagStart=null;"selfcloseTag"==a||I.autoSelfClosers.hasOwnProperty(b)?t(c,b):(t(c,b),c.context=new A(c,b,f==c.indented));return v}R="error";return G}function H(a,b,c){if("equals"==a)return M;I.allowMissing||
(R="error");return G(a,b,c)}function M(a,b,c){if("string"==a)return J;if("word"==a&&I.allowUnquoted)return R="string",G;R="error";return G(a,b,c)}function J(a,b,c){return"string"==a?J:G(a,b,c)}var D=a.indentUnit,I={};a=f.htmlMode?c:b;for(var P in a)I[P]=a[P];for(P in f)I[P]=f[P];var K,R;g.isInText=!0;return{startState:function(a){var b={tokenize:g,state:v,indented:a||0,tagName:null,tagStart:null,context:null};null!=a&&(b.baseIndent=a);return b},token:function(a,b){!b.tagName&&a.sol()&&(b.indented=
a.indentation());if(a.eatSpace())return null;K=null;var c=b.tokenize(a,b);(c||K)&&"comment"!=c&&(R=null,b.state=b.state(K||c,a,b),R&&(c="error"==R?c+" error":R));return c},indent:function(a,b,c){var f=a.context;if(a.tokenize.isInAttribute)return a.tagStart==a.indented?a.stringStartCol+1:a.indented+D;if(f&&f.noIndent)return d.Pass;if(a.tokenize!=h&&a.tokenize!=g)return c?c.match(/^(\s*)/)[0].length:0;if(a.tagName)return!1!==I.multilineTagIndentPastTag?a.tagStart+a.tagName.length+2:a.tagStart+D*(I.multilineTagIndentFactor||
1);if(I.alignCDATA&&/<!\[CDATA\[/.test(b))return 0;if((b=b&&/^<(\/)?([\w_:\.-]*)/.exec(b))&&b[1])for(;f;)if(f.tagName==b[2]){f=f.prev;break}else if(I.implicitlyClosed.hasOwnProperty(f.tagName))f=f.prev;else break;else if(b)for(;f;)if((c=I.contextGrabbers[f.tagName])&&c.hasOwnProperty(b[2]))f=f.prev;else break;for(;f&&f.prev&&!f.startOfLine;)f=f.prev;return f?f.indent+D:a.baseIndent||0},electricInput:/<\/[\s\w:]+>$/,blockCommentStart:"\x3c!--",blockCommentEnd:"--\x3e",configuration:I.htmlMode?"html":
"xml",helperType:I.htmlMode?"html":"xml",skipAttribute:function(a){a.state==M&&(a.state=G)}}});d.defineMIME("text/xml","xml");d.defineMIME("application/xml","xml");d.mimeModes.hasOwnProperty("text/html")||d.defineMIME("text/html",{name:"xml",htmlMode:!0})});(function(d){d(CodeMirror)})(function(d){d.defineMode("markdown",function(c,b){function a(a,b,c){b.f=b.inline=c;return c(a,b)}function f(a){return!a||!/\S/.test(a.string)}function g(a){a.linkTitle=!1;a.em=!1;a.strong=!1;a.strikethrough=!1;a.quote=0;a.indentedCode=!1;M||a.f!=m||(a.f=t,a.block=h);a.trailingSpace=0;a.trailingSpaceNewLine=!1;a.prevLine=a.thisLine;return a.thisLine=null}function h(g,h){var m=g.sol(),q=!1!==h.list,r=h.indentedCode;h.indentedCode=!1;q&&(0<=h.indentationDiff?(4>h.indentationDiff&&
(h.indentation-=h.indentationDiff),h.list=null):0<h.indentation?(h.list=null,h.listDepth=Math.floor(h.indentation/4)):(h.list=!1,h.listDepth=0));var t=null;if(4<=h.indentationDiff)return g.skipToEnd(),r||f(h.prevLine)?(h.indentation-=4,h.indentedCode=!0,I.code):null;if(g.eatSpace())return null;if((t=g.match(fa))&&6>=t[1].length)return h.header=t[1].length,b.highlightFormatting&&(h.formatting="header"),h.f=h.inline,A(h);if(f(h.prevLine)||h.quote||q||r||!(t=g.match(oa))){if(g.eat(">"))return h.quote=
m?1:h.quote+1,b.highlightFormatting&&(h.formatting="quote"),g.eatSpace(),A(h);if("["===g.peek())return a(g,h,p);if(g.match(K,!0))return h.hr=!0,I.hr;if((f(h.prevLine)||q)&&(g.match(R,!1)||g.match(Z,!1)))return g.match(R,!0)?m="ul":(g.match(Z,!0),m="ol"),h.indentation=g.column()+g.current().length,h.list=!0,h.listDepth++,b.taskLists&&g.match(C,!1)&&(h.taskList=!0),h.f=h.inline,b.highlightFormatting&&(h.formatting=["list","list-"+m]),A(h);if(b.fencedCodeBlocks&&(t=g.match(da,!0)))return h.fencedChars=
t[1],g=t[2],d.findModeByName&&(m=d.findModeByName(g))&&(g=m.mime||m.mimes[0]),g=d.getMode(c,g),h.localMode="null"==g.name?null:g,h.localMode&&(h.localState=h.localMode.startState()),h.f=h.block=n,b.highlightFormatting&&(h.formatting="code-block"),h.code=!0,A(h)}else return h.header="="==t[0].charAt(0)?1:2,b.highlightFormatting&&(h.formatting="header"),h.f=h.inline,A(h);return a(g,h,h.inline)}function m(a,b){var c=J.token(a,b.htmlState);if(M&&null===b.htmlState.tagStart&&!b.htmlState.context&&b.htmlState.tokenize.isInText||
b.md_inside&&-1<a.current().indexOf(">"))b.f=t,b.block=h,b.htmlState=null;return c}function n(a,b){if(a.sol()&&b.fencedChars&&a.match(b.fencedChars,!1))return b.localMode=b.localState=null,b.f=b.block=r,null;if(b.localMode)return b.localMode.token(a,b.localState);a.skipToEnd();return I.code}function r(a,c){a.match(c.fencedChars);c.block=h;c.f=t;c.fencedChars=null;b.highlightFormatting&&(c.formatting="code-block");c.code=!0;a=A(c);c.code=!1;return a}function A(a){var c=[];if(a.formatting){c.push(I.formatting);
"string"===typeof a.formatting&&(a.formatting=[a.formatting]);for(var f=0;f<a.formatting.length;f++)c.push(I.formatting+"-"+a.formatting[f]),"header"===a.formatting[f]&&c.push(I.formatting+"-"+a.formatting[f]+"-"+a.header),"quote"===a.formatting[f]&&(!b.maxBlockquoteDepth||b.maxBlockquoteDepth>=a.quote?c.push(I.formatting+"-"+a.formatting[f]+"-"+a.quote):c.push("error"))}if(a.taskOpen)return c.push("meta"),c.length?c.join(" "):null;if(a.taskClosed)return c.push("property"),c.length?c.join(" "):null;
a.linkHref?c.push(I.linkHref,"url"):(a.strong&&c.push(I.strong),a.em&&c.push(I.em),a.strikethrough&&c.push(I.strikethrough),a.linkText&&c.push(I.linkText),a.code&&c.push(I.code));a.header&&c.push(I.header,I.header+"-"+a.header);a.quote&&(c.push(I.quote),!b.maxBlockquoteDepth||b.maxBlockquoteDepth>=a.quote?c.push(I.quote+"-"+a.quote):c.push(I.quote+"-"+b.maxBlockquoteDepth));!1!==a.list&&((f=(a.listDepth-1)%3)?1===f?c.push(I.list2):c.push(I.list3):c.push(I.list1));a.trailingSpaceNewLine?c.push("trailing-space-new-line"):
a.trailingSpace&&c.push("trailing-space-"+(a.trailingSpace%2?"a":"b"));return c.length?c.join(" "):null}function z(a,b){if(a.match(ua,!0))return A(b)}function t(a,c){var f=c.text(a,c);if("undefined"!==typeof f)return f;if(c.list)return c.list=null,A(c);if(c.taskList)return"x"!==a.match(C,!0)[1]?c.taskOpen=!0:c.taskClosed=!0,b.highlightFormatting&&(c.formatting="task"),c.taskList=!1,A(c);c.taskOpen=!1;c.taskClosed=!1;if(c.header&&a.match(/^#+$/,!0))return b.highlightFormatting&&(c.formatting="header"),
A(c);f=a.sol();var g=a.next();if("\\"===g&&(a.next(),b.highlightFormatting))return a=A(c),c=I.formatting+"-escape",a?a+" "+c:c;if(c.linkTitle){c.linkTitle=!1;var h=g;"("===g&&(h=")");h=(h+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");if(a.match(new RegExp("^\\s*(?:[^"+h+"\\\\]+|\\\\\\\\|\\\\.)"+h),!0))return I.linkHref}if("`"===g){f=c.formatting;b.highlightFormatting&&(c.formatting="code");g=A(c);h=a.pos;a.eatWhile("`");a=1+a.pos-h;if(c.code){if(a===D)return c.code=!1,g;c.formatting=f}else D=a,c.code=
!0;return A(c)}if(c.code)return A(c);if("!"===g&&a.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return a.match(/\[[^\]]*\]/),c.inline=c.f=q,I.image;if("["===g&&a.match(/.*\](\(.*\)| ?\[.*\])/,!1))return c.linkText=!0,b.highlightFormatting&&(c.formatting="link"),A(c);if("]"===g&&c.linkText&&a.match(/\(.*\)| ?\[.*\]/,!1))return b.highlightFormatting&&(c.formatting="link"),a=A(c),c.linkText=!1,c.inline=c.f=q,a;if("<"===g&&a.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1))return c.f=c.inline=v,b.highlightFormatting&&
(c.formatting="link"),a=A(c),(a?a+" ":"")+I.linkInline;if("<"===g&&a.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1))return c.f=c.inline=v,b.highlightFormatting&&(c.formatting="link"),a=A(c),(a?a+" ":"")+I.linkEmail;if("<"===g&&a.match(/^(!--|\w)/,!1))return f=a.string.indexOf(">",a.pos),-1!=f&&(f=a.string.substring(a.start,f),/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(f)&&(c.md_inside=!0)),a.backUp(1),c.htmlState=d.startState(J),f=m,c.f=c.block=f,f(a,c);if("<"===g&&a.match(/^\/\w*?>/))return c.md_inside=
!1,"tag";h=!1;if(!b.underscoresBreakWords&&"_"===g&&"_"!==a.peek()&&a.match(/(\w)/,!1)){var n=a.pos-2;0<=n&&(n=a.string.charAt(n),"_"!==n&&n.match(/(\w)/,!1)&&(h=!0))}if("*"===g||"_"===g&&!h){if(!f||" "!==a.peek()){if(c.strong===g&&a.eat(g))return b.highlightFormatting&&(c.formatting="strong"),g=A(c),c.strong=!1,g;if(!c.strong&&a.eat(g))return c.strong=g,b.highlightFormatting&&(c.formatting="strong"),A(c);if(c.em===g)return b.highlightFormatting&&(c.formatting="em"),g=A(c),c.em=!1,g;if(!c.em)return c.em=
g,b.highlightFormatting&&(c.formatting="em"),A(c)}}else if(" "===g&&(a.eat("*")||a.eat("_"))){if(" "===a.peek())return A(c);a.backUp(1)}if(b.strikethrough)if("~"===g&&a.eatWhile(g)){if(c.strikethrough)return b.highlightFormatting&&(c.formatting="strikethrough"),g=A(c),c.strikethrough=!1,g;if(a.match(/^[^\s]/,!1))return c.strikethrough=!0,b.highlightFormatting&&(c.formatting="strikethrough"),A(c)}else if(" "===g&&a.match(/^~~/,!0)){if(" "===a.peek())return A(c);a.backUp(2)}" "===g&&(a.match(/ +$/,
!1)?c.trailingSpace++:c.trailingSpace&&(c.trailingSpaceNewLine=!0));return A(c)}function v(a,c){if(">"===a.next())return c.f=c.inline=t,b.highlightFormatting&&(c.formatting="link"),a=A(c),(a?a+" ":"")+I.linkInline;a.match(/^[^>]+/,!0);return I.linkInline}function q(a,c){if(a.eatSpace())return null;a=a.next();return"("===a||"["===a?(c.f=c.inline=w("("===a?")":"]"),b.highlightFormatting&&(c.formatting="link-string"),c.linkHref=!0,A(c)):"error"}function w(a){return function(c,f){if(c.next()===a)return f.f=
f.inline=t,b.highlightFormatting&&(f.formatting="link-string"),c=A(f),f.linkHref=!1,c;c.match(H(a),!0)&&c.backUp(1);f.linkHref=!0;return A(f)}}function p(c,f){return c.match(/^[^\]]*\]:/,!1)?(f.f=B,c.next(),b.highlightFormatting&&(f.formatting="link"),f.linkText=!0,A(f)):a(c,f,t)}function B(a,c){if(a.match(/^\]:/,!0))return c.f=c.inline=G,b.highlightFormatting&&(c.formatting="link"),a=A(c),c.linkText=!1,a;a.match(/^[^\]]+/,!0);return I.linkText}function G(a,b){if(a.eatSpace())return null;a.match(/^[^\s]+/,
!0);void 0===a.peek()?b.linkTitle=!0:a.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0);b.f=b.inline=t;return I.linkHref+" url"}function H(a){X[a]||(a=(a+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),X[a]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+a+")"));return X[a]}var M=d.modes.hasOwnProperty("xml"),J=d.getMode(c,M?{name:"xml",htmlMode:!0}:"text/plain");void 0===b.highlightFormatting&&(b.highlightFormatting=!1);void 0===b.maxBlockquoteDepth&&(b.maxBlockquoteDepth=
0);void 0===b.underscoresBreakWords&&(b.underscoresBreakWords=!0);void 0===b.taskLists&&(b.taskLists=!1);void 0===b.strikethrough&&(b.strikethrough=!1);void 0===b.tokenTypeOverrides&&(b.tokenTypeOverrides={});var D=0,I={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"tag",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough"},P;for(P in I)I.hasOwnProperty(P)&&
b.tokenTypeOverrides[P]&&(I[P]=b.tokenTypeOverrides[P]);var K=/^([*\-_])(?:\s*\1){2,}\s*$/,R=/^[*\-+]\s+/,Z=/^[0-9]+([.)])\s+/,C=/^\[(x| )\](?=\s)/,fa=b.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,oa=/^ *(?:={1,}|-{1,})\s*$/,ua=/^[^#!\[\]*_\\<>` "'(~]+/,da=new RegExp("^("+(!0===b.fencedCodeBlocks?"~~~+|```+":b.fencedCodeBlocks)+")[ \\t]*([\\w+#]*)"),X=[],aa={startState:function(){return{f:h,prevLine:null,thisLine:null,block:h,htmlState:null,indentation:0,inline:t,text:z,formatting:!1,linkText:!1,
linkHref:!1,linkTitle:!1,em:!1,strong:!1,header:0,hr:!1,taskList:!1,list:!1,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:!1,strikethrough:!1,fencedChars:null}},copyState:function(a){return{f:a.f,prevLine:a.prevLine,thisLine:a.this,block:a.block,htmlState:a.htmlState&&d.copyState(J,a.htmlState),indentation:a.indentation,localMode:a.localMode,localState:a.localMode?d.copyState(a.localMode,a.localState):null,inline:a.inline,text:a.text,formatting:!1,linkTitle:a.linkTitle,code:a.code,em:a.em,
strong:a.strong,strikethrough:a.strikethrough,header:a.header,hr:a.hr,taskList:a.taskList,list:a.list,listDepth:a.listDepth,quote:a.quote,indentedCode:a.indentedCode,trailingSpace:a.trailingSpace,trailingSpaceNewLine:a.trailingSpaceNewLine,md_inside:a.md_inside,fencedChars:a.fencedChars}},token:function(a,b){b.formatting=!1;if(a!=b.thisLine){var c=b.header||b.hr;b.header=0;b.hr=!1;if(a.match(/^\s*$/,!0)||c){g(b);if(!c)return null;b.prevLine=null}b.prevLine=b.thisLine;b.thisLine=a;b.taskList=!1;b.trailingSpace=
0;b.trailingSpaceNewLine=!1;b.f=b.block;c=a.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length;var f=4*Math.floor((c-b.indentation)/4);4<f&&(f=4);f=b.indentation+f;b.indentationDiff=f-b.indentation;b.indentation=f;if(0<c)return null}return b.f(a,b)},innerMode:function(a){return a.block==m?{state:a.htmlState,mode:J}:a.localState?{state:a.localState,mode:a.localMode}:{state:a,mode:aa}},blankLine:g,getType:A,fold:"markdown"};return aa},"xml");d.defineMIME("text/x-markdown","markdown")});Server=function(d){function c(b,a){this.document=b;this.operations=a||[]}c.prototype.receiveOperation=function(b,a){console.log("Operations "+this.operations.length+" Revision "+b);if(0>b||this.operations.length<b)return console.log("operation revision "+b+" not in history"),!1;b=this.operations.slice(b);for(var c=a.constructor.transform,d=0;d<b.length;d++)a=c(a,b[d])[0];this.document=a.apply(this.document);this.operations.push(a);return a};return c}(this);
"object"===typeof module&&(module.exports=ot.Server);(function(d){var c={makeEventEmitter:function(b,a){b.prototype.allowedEvents_=a;b.prototype.on=function(a,b,c){this.validateEventType_(a);this.eventListeners_=this.eventListeners_||{};this.eventListeners_[a]=this.eventListeners_[a]||[];this.eventListeners_[a].push({callback:b,context:c})};b.prototype.off=function(a,b){this.validateEventType_(a);this.eventListeners_=this.eventListeners_||{};a=this.eventListeners_[a]||[];for(var c=0;c<a.length;c++)if(a[c].callback===b){a.splice(c,1);break}};b.prototype.trigger=
function(a){this.eventListeners_=this.eventListeners_||{};for(var b=this.eventListeners_[a]||[],c=0;c<b.length;c++)b[c].callback.apply(b[c].context,Array.prototype.slice.call(arguments,1))};b.prototype.validateEventType_=function(a){if(this.allowedEvents_){for(var b=!1,c=0;c<this.allowedEvents_.length;c++)if(this.allowedEvents_[c]===a){b=!0;break}if(!b)throw Error('Unknown event "'+a+'"');}}},elt:function(b,a,f){b=document.createElement(b);if("string"===typeof a)c.setTextContent(b,a);else if(a)for(var d=
0;d<a.length;++d)b.appendChild(a[d]);for(var h in f||{})b.setAttribute(h,f[h]);return b},setTextContent:function(b,a){b.innerHTML="";b.appendChild(document.createTextNode(a))},on:function(b,a,c,d){b.addEventListener?b.addEventListener(a,c,d||!1):b.attachEvent&&b.attachEvent("on"+a,c)},off:function(b,a,c,d){b.removeEventListener?b.removeEventListener(a,c,d||!1):b.detachEvent&&b.detachEvent("on"+a,c)},preventDefault:function(b){b.preventDefault?b.preventDefault():b.returnValue=!1},stopPropagation:function(b){b.stopPropagation?
b.stopPropagation():b.cancelBubble=!0},stopEvent:function(b){c.preventDefault(b);c.stopPropagation(b)},stopEventAnd:function(b){return function(a){b(a);c.stopEvent(a);return!1}},trim:function(b){return b.replace(/^\s+/g,"").replace(/\s+$/g,"")},stringEndsWith:function(b,a){for(var c="string"==typeof a?[a]:a,d=0;d<c.length;d++)if(a=c[d],-1!==b.indexOf(a,b.length-a.length))return!0;return!1},assert:function(b,a){if(!b)throw Error(a||"assertion error");},log:function(){if("undefined"!==typeof console&&
"undefined"!==typeof console.log){for(var b=["Vceditor:"],a=0;a<arguments.length;a++)b.push(arguments[a]);console.log.apply(console,b)}}};d.utils=c})(window);(function(d){var c=function(b){function a(a){this.imageInsertionUI=a;this.element_=this.makeElement_()}var c=d.utils;c.makeEventEmitter(a,"bold italic underline strike font font-size color left center right unordered-list ordered-list todo-list indent-increase indent-decrease undo redo insert-image".split(" "));a.prototype.element=function(){return this.element_};a.prototype.makeButton_=function(a,b){var f=this;b=c.elt("a",[c.elt("span","",{"class":"vceditor-tb-"+(b||a)})],{"class":"vceditor-btn"});
c.on(b,"click",c.stopEventAnd(function(){f.trigger(a)}));return b};a.prototype.makeElement_=function(){var a=this.makeFontDropdown_(),b=this.makeFontSizeDropdown_(),f=this.makeColorDropdown_();a=[c.elt("div",[a],{"class":"vceditor-btn-group"}),c.elt("div",[b],{"class":"vceditor-btn-group"}),c.elt("div",[f],{"class":"vceditor-btn-group"}),c.elt("div",[this.makeButton_("bold"),this.makeButton_("italic"),this.makeButton_("underline"),this.makeButton_("strike","strikethrough")],{"class":"vceditor-btn-group"}),
c.elt("div",[this.makeButton_("unordered-list","list-2"),this.makeButton_("ordered-list","numbered-list"),this.makeButton_("todo-list","list")],{"class":"vceditor-btn-group"}),c.elt("div",[this.makeButton_("indent-decrease"),this.makeButton_("indent-increase")],{"class":"vceditor-btn-group"}),c.elt("div",[this.makeButton_("left","paragraph-left"),this.makeButton_("center","paragraph-center"),this.makeButton_("right","paragraph-right")],{"class":"vceditor-btn-group"}),c.elt("div",[this.makeButton_("undo"),
this.makeButton_("redo")],{"class":"vceditor-btn-group"})];this.imageInsertionUI&&a.push(c.elt("div",[this.makeButton_("insert-image")],{"class":"vceditor-btn-group"}));a=c.elt("div",a,{"class":"vceditor-toolbar-wrapper"});b=c.elt("div",null,{"class":"vceditor-toolbar"});b.appendChild(a);return b};a.prototype.makeFontDropdown_=function(){for(var a="Arial;Comic Sans MS;Courier New;Impact;Times New Roman;Verdana".split(";"),b=[],f=0;f<a.length;f++){var d=c.elt("span",a[f]);d.setAttribute("style","font-family:"+
a[f]);b.push({content:d,value:a[f]})}return this.makeDropdown_("Font","font",b)};a.prototype.makeFontSizeDropdown_=function(){for(var a=[9,10,12,14,18,24,32,42],b=[],f=0;f<a.length;f++){var d=c.elt("span",a[f].toString());d.setAttribute("style","font-size:"+a[f]+"px; line-height:"+(a[f]-6)+"px;");b.push({content:d,value:a[f]})}return this.makeDropdown_("Size","font-size",b,"px")};a.prototype.makeColorDropdown_=function(){for(var a="black red green blue yellow cyan magenta grey".split(" "),b=[],f=
0;f<a.length;f++){var d=c.elt("div");d.className="vceditor-color-dropdown-item";d.setAttribute("style","background-color:"+a[f]);b.push({content:d,value:a[f]})}return this.makeDropdown_("Color","color",b)};a.prototype.makeDropdown_=function(a,b,f,d){function g(){v&&(m.style.display="",c.off(document,"click",g,!0),v=!1);q=!0;setTimeout(function(){q=!1},0)}function h(a,f){"object"!==typeof a&&(a=document.createTextNode(String(a)));a=c.elt("a",[a]);c.on(a,"click",c.stopEventAnd(function(){g();n.trigger(b,
f+d)}));m.appendChild(a)}d=d||"";var n=this;a=c.elt("a",a+" \u25be",{"class":"vceditor-btn vceditor-dropdown"});var m=c.elt("ul",[],{"class":"vceditor-dropdown-menu"});a.appendChild(m);for(var v=!1,q=!1,w=0;w<f.length;w++)h(f[w].content,f[w].value);c.on(a,"click",c.stopEventAnd(function(){q||v||(m.style.display="block",c.on(document,"click",g,!0),v=!0)}));return a};return a}();d.RichTextToolbar=c})(window);(function(d){var c=function(){function b(b,c,d){this.type=b;this.attributes=this.text=this.chars=null;"insert"===b?(this.text=c,a.assert("string"===typeof this.text),this.attributes=d||{},a.assert("object"===typeof this.attributes)):"delete"===b?(this.chars=c,a.assert("number"===typeof this.chars)):"retain"===b&&(this.chars=c,a.assert("number"===typeof this.chars),this.attributes=d||{},a.assert("object"===typeof this.attributes))}var a=d.utils;b.prototype.isInsert=function(){return"insert"===this.type};
b.prototype.isDelete=function(){return"delete"===this.type};b.prototype.isRetain=function(){return"retain"===this.type};b.prototype.equals=function(a){return this.type===a.type&&this.text===a.text&&this.chars===a.chars&&this.attributesEqual(a.attributes)};b.prototype.attributesEqual=function(a){for(var b in this.attributes)if(this.attributes[b]!==a[b])return!1;for(b in a)if(this.attributes[b]!==a[b])return!1;return!0};b.prototype.hasEmptyAttributes=function(){var a=!0,b;for(b in this.attributes){a=
!1;break}return a};return b}();d.TextOp=c})(window);(function(d){TextOperation=function(){function c(){if(!this||this.constructor!==c)return new c;this.ops=[];this.targetLength=this.baseLength=0}function b(a){a=a.ops;switch(a.length){case 1:return a[0];case 2:return a[0].isRetain()?a[1]:a[1].isRetain()?a[0]:null;case 3:if(a[0].isRetain()&&a[2].isRetain())return a[1]}return null}function a(a){return a.ops[0].isRetain()?a.ops[0].chars:0}var f=d.TextOp,g=d.utils;c.prototype.equals=function(a){if(this.baseLength!==a.baseLength||this.targetLength!==a.targetLength||
this.ops.length!==a.ops.length)return!1;for(var b=0;b<this.ops.length;b++)if(!this.ops[b].equals(a.ops[b]))return!1;return!0};c.prototype.retain=function(a,b){if("number"!==typeof a||0>a)throw Error("retain expects a positive integer.");if(0===a)return this;this.baseLength+=a;this.targetLength+=a;b=b||{};var c=0<this.ops.length?this.ops[this.ops.length-1]:null;c&&c.isRetain()&&c.attributesEqual(b)?c.chars+=a:this.ops.push(new f("retain",a,b));return this};c.prototype.insert=function(a,b){if("string"!==
typeof a)throw Error("insert expects a string");if(""===a)return this;b=b||{};this.targetLength+=a.length;var c=0<this.ops.length?this.ops[this.ops.length-1]:null,d=1<this.ops.length?this.ops[this.ops.length-2]:null;c&&c.isInsert()&&c.attributesEqual(b)?c.text+=a:c&&c.isDelete()?d&&d.isInsert()&&d.attributesEqual(b)?d.text+=a:(this.ops[this.ops.length-1]=new f("insert",a,b),this.ops.push(c)):this.ops.push(new f("insert",a,b));return this};c.prototype["delete"]=function(a){"string"===typeof a&&(a=
a.length);if("number"!==typeof a||0>a)throw Error("delete expects a positive integer or a string");if(0===a)return this;this.baseLength+=a;var b=0<this.ops.length?this.ops[this.ops.length-1]:null;b&&b.isDelete()?b.chars+=a:this.ops.push(new f("delete",a));return this};c.prototype.isNoop=function(){return 0===this.ops.length||1===this.ops.length&&this.ops[0].isRetain()&&this.ops[0].hasEmptyAttributes()};c.prototype.clone=function(){for(var a=new c,b=0;b<this.ops.length;b++)if(this.ops[b].isRetain())a.retain(this.ops[b].chars,
this.ops[b].attributes);else if(this.ops[b].isInsert())a.insert(this.ops[b].text,this.ops[b].attributes);else a["delete"](this.ops[b].chars);return a};c.prototype.toString=function(){return(Array.prototype.map||function(a){for(var b=[],c=0,f=this.length;c<f;c++)b[c]=a(this[c]);return b}).call(this.ops,function(a){return a.isRetain()?"retain "+a.chars:a.isInsert()?"insert '"+a.text+"'":"delete "+a.chars}).join(", ")};c.prototype.toJSON=function(){for(var a=[],b=0;b<this.ops.length;b++)this.ops[b].hasEmptyAttributes()||
a.push(this.ops[b].attributes),"retain"===this.ops[b].type?a.push(this.ops[b].chars):"insert"===this.ops[b].type?a.push(this.ops[b].text):"delete"===this.ops[b].type&&a.push(-this.ops[b].chars);0===a.length&&a.push(0);return a};c.fromJSON=function(a){for(var b=new c,f=0,d=a.length;f<d;f++){var h=a[f],z={};"object"===typeof h&&(z=h,f++,h=a[f]);if("number"===typeof h)if(0<h)b.retain(h,z);else b["delete"](-h);else g.assert("string"===typeof h),b.insert(h,z)}return b};c.prototype.apply=function(a,b,c){b=
b||[];c=c||[];if(a.length!==this.baseLength)throw Error("The operation's base length must be equal to the string's length.");for(var f=[],d=0,h,n,m=0,q=this.ops,w=0,p=q.length;w<p;w++){var B=q[w];if(B.isRetain()){if(m+B.chars>a.length)throw Error("Operation can't retain more characters than are left in the string.");f[d++]=a.slice(m,m+B.chars);for(h=0;h<B.chars;h++){var G=b[m+h]||{},H={};for(n in G)H[n]=G[n],g.assert(!1!==H[n]);for(n in B.attributes)!1===B.attributes[n]?delete H[n]:H[n]=B.attributes[n],
g.assert(!1!==H[n]);c.push(H)}m+=B.chars}else if(B.isInsert())for(f[d++]=B.text,h=0;h<B.text.length;h++){G={};for(n in B.attributes)G[n]=B.attributes[n],g.assert(!1!==G[n]);c.push(G)}else m+=B.chars}if(m!==a.length)throw Error("The operation didn't operate on the whole string.");a=f.join("");g.assert(a.length===c.length);return a};c.prototype.invert=function(a){for(var b=0,f=new c,d=this.ops,g=0,h=d.length;g<h;g++){var t=d[g];if(t.isRetain())f.retain(t.chars),b+=t.chars;else if(t.isInsert())f["delete"](t.text.length);
else f.insert(a.slice(b,b+t.chars)),b+=t.chars}return f};c.prototype.compose=function(a){function b(a,b,c){var f={},d;for(d in a)f[d]=a[d];for(d in b)c&&!1===b[d]?delete f[d]:f[d]=b[d];return f}if(this.targetLength!==a.baseLength)throw Error("The base length of the second operation has to be the target length of the first operation");var f=new c,d=this.clone().ops;a=a.clone().ops;for(var g=0,h=0,t=d[g++],v=a[h++],q;"undefined"!==typeof t||"undefined"!==typeof v;)if(t&&t.isDelete())f["delete"](t.chars),
t=d[g++];else if(v&&v.isInsert())f.insert(v.text,v.attributes),v=a[h++];else{if("undefined"===typeof t)throw Error("Cannot compose operations: first operation is too short.");if("undefined"===typeof v)throw Error("Cannot compose operations: first operation is too long.");if(t.isRetain()&&v.isRetain())q=b(t.attributes,v.attributes),t.chars>v.chars?(f.retain(v.chars,q),t.chars-=v.chars,v=a[h++]):t.chars===v.chars?(f.retain(t.chars,q),t=d[g++],v=a[h++]):(f.retain(t.chars,q),v.chars-=t.chars,t=d[g++]);
else if(t.isInsert()&&v.isDelete())t.text.length>v.chars?(t.text=t.text.slice(v.chars),v=a[h++]):t.text.length===v.chars?(t=d[g++],v=a[h++]):(v.chars-=t.text.length,t=d[g++]);else if(t.isInsert()&&v.isRetain())q=b(t.attributes,v.attributes,!0),t.text.length>v.chars?(f.insert(t.text.slice(0,v.chars),q),t.text=t.text.slice(v.chars),v=a[h++]):t.text.length===v.chars?(f.insert(t.text,q),t=d[g++],v=a[h++]):(f.insert(t.text,q),v.chars-=t.text.length,t=d[g++]);else if(t.isRetain()&&v.isDelete())t.chars>
v.chars?(f["delete"](v.chars),t.chars-=v.chars,v=a[h++]):t.chars===v.chars?(f["delete"](v.chars),t=d[g++],v=a[h++]):(f["delete"](t.chars),v.chars-=t.chars,t=d[g++]);else throw Error("This shouldn't happen: op1: "+JSON.stringify(t)+", op2: "+JSON.stringify(v));}return f};c.prototype.shouldBeComposedWith=function(c){if(this.isNoop()||c.isNoop())return!0;var f=a(this),d=a(c),g=b(this);c=b(c);return g&&c?g.isInsert()&&c.isInsert()?f+g.text.length===d:g.isDelete()&&c.isDelete()?d+c.chars===f||f===d:!1:
!1};c.prototype.shouldBeComposedWithInverted=function(c){if(this.isNoop()||c.isNoop())return!0;var f=a(this),d=a(c),g=b(this);c=b(c);return g&&c?g.isInsert()&&c.isInsert()?f+g.text.length===d||f===d:g.isDelete()&&c.isDelete()?d+c.chars===f:!1:!1};c.transformAttributes=function(a,b){var c={},f={},d,h={};for(d in a)h[d]=!0;for(d in b)h[d]=!0;for(d in h){h=a[d];var m=b[d];g.assert(null!=h||null!=m);null==h?f[d]=m:null==m?c[d]=h:h!==m&&(c[d]=h)}return[c,f]};c.transform=function(a,b){if(a.baseLength!==
b.baseLength)throw Error("Both operations have to have the same base length");var f=new c,d=new c;a=a.clone().ops;b=b.clone().ops;for(var g=0,h=0,m=a[g++],v=b[h++];"undefined"!==typeof m||"undefined"!==typeof v;)if(m&&m.isInsert())f.insert(m.text,m.attributes),d.retain(m.text.length),m=a[g++];else if(v&&v.isInsert())f.retain(v.text.length),d.insert(v.text,v.attributes),v=b[h++];else{if("undefined"===typeof m)throw Error("Cannot transform operations: first operation is too short.");if("undefined"===
typeof v)throw Error("Cannot transform operations: first operation is too long.");if(m.isRetain()&&v.isRetain()){var q=c.transformAttributes(m.attributes,v.attributes);if(m.chars>v.chars){var w=v.chars;m.chars-=v.chars;v=b[h++]}else m.chars===v.chars?(w=v.chars,m=a[g++],v=b[h++]):(w=m.chars,v.chars-=m.chars,m=a[g++]);f.retain(w,q[0]);d.retain(w,q[1])}else if(m.isDelete()&&v.isDelete())m.chars>v.chars?(m.chars-=v.chars,v=b[h++]):m.chars===v.chars?(m=a[g++],v=b[h++]):(v.chars-=m.chars,m=a[g++]);else if(m.isDelete()&&
v.isRetain())m.chars>v.chars?(w=v.chars,m.chars-=v.chars,v=b[h++]):m.chars===v.chars?(w=v.chars,m=a[g++],v=b[h++]):(w=m.chars,v.chars-=m.chars,m=a[g++]),f["delete"](w);else if(m.isRetain()&&v.isDelete())m.chars>v.chars?(w=v.chars,m.chars-=v.chars,v=b[h++]):m.chars===v.chars?(w=m.chars,m=a[g++],v=b[h++]):(w=m.chars,v.chars-=m.chars,m=a[g++]),d["delete"](w);else throw Error("The two operations aren't compatible");}return[f,d]};return c}();d.TextOperation=TextOperation})(window);(function(d){var c=function(b){function a(a,b){this.wrapped=a;this.meta=b}function c(a,b){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c])}function d(a,b){return a&&"object"===typeof a&&"function"===typeof a.transform?a.transform(b):a}a.prototype.apply=function(){return this.wrapped.apply.apply(this.wrapped,arguments)};a.prototype.invert=function(){var b=this.meta;return new a(this.wrapped.invert.apply(this.wrapped,arguments),b&&"object"===typeof b&&"function"===typeof b.invert?b.invert.apply(b,arguments):
b)};a.prototype.compose=function(b){var f=this.wrapped.compose(b.wrapped);var d=this.meta;b=b.meta;if(d&&"object"===typeof d)if("function"===typeof d.compose)d=d.compose(b);else{var g={};c(d,g);c(b,g);d=g}else d=b;return new a(f,d)};a.transform=function(b,c){var f=b.wrapped.constructor.transform;f=f(b.wrapped,c.wrapped);return[new a(f[0],d(b.meta,c.wrapped)),new a(f[1],d(c.meta,b.wrapped))]};return a}();d.WrappedOperation=c})(window);(function(d){var c=function(){function b(a,b){this.position=a;this.selectionEnd=b}b.fromJSON=function(a){return new b(a.position,a.selectionEnd)};b.prototype.equals=function(a){return this.position===a.position&&this.selectionEnd===a.selectionEnd};b.prototype.compose=function(a){return a};b.prototype.transform=function(a){function c(b){for(var c=b,f=a.ops,d=0,g=a.ops.length;d<g&&!(f[d].isRetain()?b-=f[d].chars:f[d].isInsert()?c+=f[d].text.length:(c-=Math.min(b,f[d].chars),b-=f[d].chars),0>b);d++);
return c}var d=c(this.position);return this.position===this.selectionEnd?new b(d,d):new b(d,c(this.selectionEnd))};return b}();d.Cursor=c})(window);(function(d){var c=function(){function b(a){this.maxItems=a||50;this.state="normal";this.dontCompose=!1;this.undoStack=[];this.redoStack=[]}function a(a,b){for(var c=[],f=b.constructor,d=a.length-1;0<=d;d--)b=f.transform(a[d],b),"function"===typeof b[0].isNoop&&b[0].isNoop()||c.push(b[0]),b=b[1];return c.reverse()}b.prototype.add=function(a,b){if("undoing"===this.state)this.redoStack.push(a),this.dontCompose=!0;else if("redoing"===this.state)this.undoStack.push(a),this.dontCompose=!0;else{var c=this.undoStack;
!this.dontCompose&&b&&0<c.length?c.push(a.compose(c.pop())):(c.push(a),c.length>this.maxItems&&c.shift());this.dontCompose=!1;this.redoStack=[]}};b.prototype.transform=function(b){this.undoStack=a(this.undoStack,b);this.redoStack=a(this.redoStack,b)};b.prototype.performUndo=function(a){this.state="undoing";if(0===this.undoStack.length)throw Error("undo not possible");a(this.undoStack.pop());this.state="normal"};b.prototype.performRedo=function(a){this.state="redoing";if(0===this.redoStack.length)throw Error("redo not possible");
a(this.redoStack.pop());this.state="normal"};b.prototype.canUndo=function(){return 0!==this.undoStack.length};b.prototype.canRedo=function(){return 0!==this.redoStack.length};b.prototype.isUndoing=function(){return"undoing"===this.state};b.prototype.isRedoing=function(){return"redoing"===this.state};return b}();d.UndoManager=c})(window);(function(d){var c=function(){function b(a){this.revision=a;this.state=h}function a(){}function c(a){this.outstanding=a}function d(a,b){this.outstanding=a;this.buffer=b}b.prototype.setState=function(a){this.state=a};b.prototype.applyClient=function(a){this.setState(this.state.applyClient(this,a))};b.prototype.applyServer=function(a){this.revision++;this.setState(this.state.applyServer(this,a))};b.prototype.serverAck=function(){this.revision++;this.setState(this.state.serverAck(this))};b.prototype.serverRetry=
function(){this.setState(this.state.serverRetry(this))};b.prototype.transformCursor=function(a){return this.state.transformCursor(a)};b.prototype.sendOperation=function(a){throw Error("sendOperation must be defined in child class");};b.prototype.applyOperation=function(a){throw Error("applyOperation must be defined in child class");};b.Synchronized=a;a.prototype.applyClient=function(a,b){a.sendOperation(a.revision,b);return new c(b)};a.prototype.applyServer=function(a,b){a.applyOperation(b);return this};
a.prototype.transformCursor=function(a){return a};a.prototype.serverAck=function(a){throw Error("There is no pending operation.");};a.prototype.serverRetry=function(a){throw Error("There is no pending operation.");};var h=new a;b.AwaitingConfirm=c;c.prototype.applyClient=function(a,b){return new d(this.outstanding,b)};c.prototype.applyServer=function(a,b){b=b.constructor.transform(this.outstanding,b);a.applyOperation(b[1]);return new c(b[0])};c.prototype.serverAck=function(a){return h};c.prototype.serverRetry=
function(a){a.sendOperation(this.outstanding);return this};c.prototype.transformCursor=function(a){return a.transform(this.outstanding)};b.AwaitingWithBuffer=d;d.prototype.applyClient=function(a,b){a=this.buffer.compose(b);return new d(this.outstanding,a)};d.prototype.applyServer=function(a,b){var c=b.constructor.transform;b=c(this.outstanding,b);c=c(this.buffer,b[1]);a.applyOperation(c[1]);return new d(b[0],c[0])};d.prototype.serverRetry=function(a){var b=this.outstanding.compose(this.buffer);a.sendOperation(b);
return new c(b)};d.prototype.serverAck=function(a){a.sendOperation(a.revision,this.buffer);return new c(this.buffer)};d.prototype.transformCursor=function(a){return a.transform(this.outstanding).transform(this.buffer)};return b}();d.Client=c})(window);(function(d){var c=0,b=0,a=null;"use strict";var f=function(){function f(a,b){this.cursorBefore=a;this.cursorAfter=b}function h(a,b){this.id=a;this.editorAdapter=b;this.li=document.createElement("li")}function m(a,b,c,f){r.call(this,a);this.serverAdapter=c;this.editorAdapter=f;this.undoManager=new z;this.clients={};var d=this;this.editorAdapter.registerCallbacks({change:function(a,b){d.onChange(a,b)},cursorActivity:function(){d.onCursorActivity()},blur:function(){d.onBlur()},focus:function(){d.onFocus()}});
this.editorAdapter.registerUndo(function(){d.undo()});this.editorAdapter.registerRedo(function(){d.redo()});this.serverAdapter.registerCallbacks({client_left:function(a){d.onClientLeft(a)},set_name:function(a,b){d.getClientObject(a).setName(b)},ack:function(){d.serverAck()},operation:function(a){d.applyServer(t.fromJSON(a))},cursor:function(a,b){b?d.getClientObject(a).updateCursor(d.transformCursor(A.fromJSON(b))):d.getClientObject(a).removeCursor()},clients:function(a){for(var b in d.clients)if(d.clients.hasOwnProperty(b)&&
!a.hasOwnProperty(b))d.onClientLeft(b);for(b in a)if(a.hasOwnProperty(b)){var c=d.getClientObject(b);a[b].name&&c.setName(a[b].name);(c=a[b].selection)?d.clients[b].updateSelection(d.transformSelection(Selection.fromJSON(c))):d.clients[b].removeSelection()}},reconnect:function(){d.serverReconnect()}})}function n(a){return a[a.length-1]}var r=d.Client,A=d.Cursor,z=d.UndoManager,t=d.TextOperation,v=d.WrappedOperation;f.prototype.invert=function(){return new f(this.cursorAfter,this.cursorBefore)};f.prototype.compose=
function(a){return new f(this.cursorBefore,a.cursorAfter)};f.prototype.transform=function(a){return new f(this.cursorBefore?this.cursorBefore.transform(a):null,this.cursorAfter?this.cursorAfter.transform(a):null)};h.prototype.setColor=function(a){this.color=a};h.prototype.updateCursor=function(a){this.color="#86BA7D";this.removeCursor();this.cursor=a;this.mark=this.editorAdapter.setOtherCursor(a,this.color,this.id)};h.prototype.removeCursor=function(){this.mark&&this.mark.clear()};(function(a,b){function c(){}
c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a})(m,r);m.prototype.getClientObject=function(a){var b=this.clients[a];return b?b:this.clients[a]=new h(a,this.editorAdapter)};m.prototype.applyUnredo=function(a){this.undoManager.add(this.editorAdapter.invertOperation(a));this.editorAdapter.applyOperation(a.wrapped);(this.cursor=a.meta.cursorAfter)&&this.editorAdapter.setCursor(this.cursor);this.applyClient(a.wrapped)};m.prototype.undo=function(){var a=this;this.undoManager.canUndo()&&
this.undoManager.performUndo(function(b){a.applyUnredo(b)})};m.prototype.redo=function(){var a=this;this.undoManager.canRedo()&&this.undoManager.performRedo(function(b){a.applyUnredo(b)})};m.prototype.onChange=function(a,b){var c=this.cursor;this.updateCursor();var d=0<this.undoManager.undoStack.length&&b.shouldBeComposedWithInverted(n(this.undoManager.undoStack).wrapped);c=new f(this.cursor,c);this.undoManager.add(new v(b,c),d);this.applyClient(a)};m.prototype.updateCursor=function(){this.cursor=
this.editorAdapter.getCursor()};m.prototype.onCursorActivity=function(){var a=this.cursor;this.updateCursor();!this.focused||a&&this.cursor.equals(a)||this.sendCursor(this.cursor)};m.prototype.onBlur=function(){this.cursor=null;this.sendCursor(null);this.focused=!1};m.prototype.onFocus=function(){this.focused=!0;this.onCursorActivity()};m.prototype.sendCursor=function(f){if(!(this.state instanceof r.AwaitingWithBuffer)){if(null!=f&&f.hasOwnProperty("position"))var d=f.position;if(null!=f&&f.hasOwnProperty("selectionEnd"))var g=
f.selectionEnd;if(0===c)null!=d&&null!=g?(this.serverAdapter.sendCursor(f),c=1):this.serverAdapter.sendCursor(f);else if(null!=d&&null!=g){null!=a&&clearTimeout(a);b=f;var h=this;a=setTimeout(function(){h.serverAdapter.sendCursor(f);b=null},300)}else null!=b&&(this.serverAdapter.sendCursor(b),b=null),this.serverAdapter.sendCursor(f),c=0;g=d=null}};m.prototype.sendOperation=function(a,b){this.serverAdapter.sendOperation(a,b.toJSON(),this.cursor,this.editorAdapter.cm.options.keyMap)};m.prototype.applyOperation=
function(a){this.editorAdapter.applyOperation(a);this.updateCursor();this.undoManager.transform(new v(a,null))};m.prototype.emitStatus=function(){var a=this;setTimeout(function(){a.trigger("synced",a.state instanceof r.Synchronized)},0)};return m}();d.EditorClient=f})(window);(function(d){var c=function(){function b(a,b){this.pos=a;this.length=b}b.prototype.end=function(){return this.pos+this.length};return b}();d.Span=c})(window);(function(d){var c=function(){function b(a,b){if(!a)throw Error("AnnotationList assertion failed"+(b?": "+b:""));}function a(a,b){this.pos=a;this.length=b.length;this.annotation=b.annotation;this.attachedObject_=b.attachedObject}function c(a,b){this.pos=a;this.length=b.length;this.annotation=b.annotation;this.node_=b}function g(a){this.head_=new h(0,n);this.changeHandler_=a}function h(a,b){this.length=a;this.annotation=b;this.next=this.attachedObject=null}var m=d.Span;a.prototype.getAttachedObject=
function(){return this.attachedObject_};c.prototype.attachObject=function(a){this.node_.attachedObject=a};var n={equals:function(){return!1}};g.prototype.insertAnnotatedSpan=function(a,c){this.wrapOperation_(new m(a.pos,0),function(f,d){b(!d||null===d.next);var g=new h(a.length,c);if(d){b(a.pos>f&&a.pos<f+d.length);var m=new h(0,n);m.next=new h(a.pos-f,d.annotation);m.next.next=g;g.next=new h(f+d.length-a.pos,d.annotation);return m.next}return g})};g.prototype.removeSpan=function(a){0!==a.length&&
this.wrapOperation_(a,function(c,f){b(null!==f);var d=new h(0,n),g=d;a.pos>c&&(g.next=new h(a.pos-c,f.annotation),g=g.next);for(;a.end()>c+f.length;)c+=f.length,f=f.next;c=c+f.length-a.end();0<c&&(g.next=new h(c,f.annotation));return d.next})};g.prototype.updateSpan=function(a,c){0!==a.length&&this.wrapOperation_(a,function(f,d){b(null!==d);var g=new h(0,n),m=g,r=f,p=a.pos-r;b(p<d.length);0<p&&(m.next=new h(p,d.annotation),m=m.next,r+=m.length);for(;null!==d&&a.end()>=f+d.length;)r=f+d.length-r,m.next=
new h(r,c(d.annotation,r)),m=m.next,f+=d.length,d=d.next,r=f;p=a.end()-r;0<p&&(b(p<d.length),m.next=new h(p,c(d.annotation,p)),m=m.next,r+=m.length,m.next=new h(f+d.length-r,d.annotation));return g.next})};g.prototype.wrapOperation_=function(b,f){if(0>b.pos)throw Error("Span start cannot be negative.");var d=[],g=[];b=this.getAffectedNodes_(b);if(null!==b.start){var n=b.end.next;b.end.next=null}else n=b.succ;var m=f(b.startPos,b.start),r=!1;f=!1;if(m){this.mergeNodesWithSameAnnotations_(m);if(b.pred&&
b.pred.annotation.equals(m.annotation)){r=!0;m.length+=b.pred.length;b.beforePred.next=m;var p=b.predPos}else b.beforeStart.next=m,p=b.startPos;for(;m.next;)g.push(new c(p,m)),p+=m.length,m=m.next;b.succ&&b.succ.annotation.equals(m.annotation)?(m.length+=b.succ.length,f=!0,m.next=b.succ.next):m.next=n;g.push(new c(p,m))}else b.pred&&b.succ&&b.pred.annotation.equals(b.succ.annotation)?(f=r=!0,m=new h(b.pred.length+b.succ.length,b.pred.annotation),b.beforePred.next=m,m.next=b.succ.next,g.push(new c(b.startPos-
b.pred.length,m))):b.beforeStart.next=n;r&&d.push(new a(b.predPos,b.pred));n=b.startPos;for(m=b.start;null!==m;)d.push(new a(n,m)),n+=m.length,m=m.next;f&&d.push(new a(n,b.succ));this.changeHandler_(d,g)};g.prototype.getAffectedNodes_=function(a){for(var b={},c=null,f=this.head_,d=f.next,g=0;null!==d&&a.pos>=g+d.length;)g+=d.length,c=f,f=d,d=d.next;if(null===d&&(0!==a.length||a.pos!==g))throw Error("Span start exceeds the bounds of the AnnotationList.");b.startPos=g;b.start=0===a.length&&a.pos===
g?null:d;b.beforeStart=f;g===a.pos&&0<g?(b.pred=f,b.predPos=g-f.length,b.beforePred=c):b.pred=null;for(;null!==d&&a.end()>g;)g+=d.length,f=d,d=d.next;if(a.end()>g)throw Error("Span end exceeds the bounds of the AnnotationList.");0===a.length&&a.end()===g?b.end=null:b.end=f;b.succ=g===a.end()?d:null;return b};g.prototype.mergeNodesWithSameAnnotations_=function(a){if(a)for(var b=null;a;)b&&b.annotation.equals(a.annotation)?(b.length+=a.length,b.next=a.next):b=a,a=a.next};g.prototype.forEach=function(a){for(var b=
this.head_.next;null!==b;)a(b.length,b.annotation,b.attachedObject),b=b.next};g.prototype.getAnnotatedSpansForPos=function(b){for(var c=0,f=this.head_.next,d=null;null!==f&&c+f.length<=b;)c+=f.length,d=f,f=f.next;if(null===f&&c!==b)throw Error("pos exceeds the bounds of the AnnotationList");var g=[];c===b&&d&&g.push(new a(c-d.length,d));f&&g.push(new a(c,f));return g};g.prototype.getAnnotatedSpansForSpan=function(a){if(0===a.length)return[];var b=[],c=this.getAffectedNodes_(a),f=c.startPos;for(c=
c.start;null!==c&&f<a.end();){var d=Math.max(f,a.pos),g=Math.min(f+c.length,a.end());d=new m(d,g-d);d.annotation=c.annotation;b.push(d);f+=c.length;c=c.next}return b};g.prototype.count=function(){for(var a=0,c=this.head_.next,f=null;null!==c;)f&&b(!f.annotation.equals(c.annotation)),f=c,c=c.next,a++;return a};h.prototype.clone=function(){var a=new h(this.spanLength,this.annotation);a.next=this.next;return a};return g}();d.AnnotationList=c})(window);(function(d){d.AttributeConstants={BOLD:"b",ITALIC:"i",UNDERLINE:"u",STRIKE:"s",FONT:"f",FONT_SIZE:"fs",COLOR:"c",BACKGROUND_COLOR:"bc",ENTITY_SENTINEL:"ent",LINE_SENTINEL:"l",LINE_INDENT:"li",LINE_ALIGN:"la",LIST_TYPE:"lt"}})(window);(function(d){var c=function(){function b(c){if(!(this instanceof b))return new b(c);this.attributes=c||{};this.attributes[a.LINE_SENTINEL]=!0}var a=d.AttributeConstants;b.LIST_TYPE={NONE:!1,ORDERED:"o",UNORDERED:"u",TODO:"t",TODOCHECKED:"tc"};b.prototype.cloneWithNewAttribute_=function(a,c){var f={},d;for(d in this.attributes)f[d]=this.attributes[d];!1===c?delete f[a]:f[a]=c;return new b(f)};b.prototype.indent=function(b){return this.cloneWithNewAttribute_(a.LINE_INDENT,b)};b.prototype.align=function(b){return this.cloneWithNewAttribute_(a.LINE_ALIGN,
b)};b.prototype.listItem=function(b){vceditor.utils.assert(!1===b||"u"===b||"o"===b||"t"===b||"tc"===b);return this.cloneWithNewAttribute_(a.LIST_TYPE,b)};b.prototype.getIndent=function(){return this.attributes[a.LINE_INDENT]||0};b.prototype.getAlign=function(){return this.attributes[a.LINE_ALIGN]||0};b.prototype.getListItem=function(){return this.attributes[a.LIST_TYPE]||!1};return b}();d.LineFormatting=c})(window);(function(d){var c=function(){function b(a){return a===h.ORDERED?"</ol>":"</ul>"}function a(a,b){return a===b||a===h.TODO&&b===h.TODOCHECKED||a===h.TODOCHECKED&&b===h.TODO}var c=d.utils,g=d.AttributeConstants,h=d.LineFormatting.LIST_TYPE;return function(f,d){for(var n="",m=!0,z=[],t=!1,v=!0,q=!0,w=0,p=f.ops[w],B=!1;p;){c.assert(p.isInsert());var G=p.attributes;if(m){m=!1;var H=0,M=null,J="left";g.LINE_SENTINEL in G&&(H=G[g.LINE_INDENT]||0,M=G[g.LIST_TYPE]||null,J=G[g.LINE_ALIGN]||"left");M&&(H=H||
1);t?(n+="</li>",t=!1):v||(q&&(n+="<br/>"),n+="</div>");v=!1;for(c.assert(0<=H,"Indent must not be negative.");z.length>H||H===z.length&&null!==M&&!a(M,z[z.length-1]);)n+=b(z.pop());for(;z.length<H;)q=M||h.UNORDERED,B=M==h.TODO||M==h.TODOCHECKED||B,n+=q===h.ORDERED?"<ol>":q===h.UNORDERED?"<ul>":'<ul class="vceditor-todo">',z.push(q);q="left"!==J?' style="text-align:'+J+'"':"";if(M){t="";switch(M){case h.TODOCHECKED:t=' class="vceditor-checked"';break;case h.TODO:t=' class="vceditor-unchecked"'}n+=
"<li"+t+q+">";t=!0}else n+="<div"+q+">";q=!0}if(g.LINE_SENTINEL in G)p=f.ops[++w];else if(g.ENTITY_SENTINEL in G){for(M=0;M<p.text.length;M++)H=vceditor.Entity.fromAttributes(G),H=d.exportToElement(H),n+=H.outerHTML;p=f.ops[++w]}else{H=M="";for(var D in G){J=G[D];var I;if(D===g.BOLD||D===g.ITALIC||D===g.UNDERLINE||D===g.STRIKE){c.assert(!0===J);var P=I=D}else D===g.FONT_SIZE?(P='span style="font-size: '+J,P+="string"!==typeof J||-1===J.indexOf("px",J.length-2)?'px"':'"',I="span"):D===g.FONT?(P='span style="font-family: '+
J+'"',I="span"):D===g.COLOR?(P='span style="color: '+J+'"',I="span"):D===g.BACKGROUND_COLOR?(P='span style="background-color: '+J+'"',I="span"):c.log(!1,"Encountered unknown attribute while rendering html: "+D);P&&(M+="<"+P+">");I&&(H="</"+I+">"+H)}J=p.text;var K=J.indexOf("\n");0<=K?(m=!0,p=K<J.length-1?new vceditor.TextOp("insert",J.substr(K+1),G):f.ops[++w],J=J.substr(0,K)):p=f.ops[++w];J=J.replace(/  +/g,function(a){return Array(a.length+1).join("\u00a0")}).replace(/^ /,"\u00a0").replace(/ $/,
"\u00a0");0<J.length&&(q=!1);n+=M+J.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00a0/g,"&nbsp;")+H}}t?n+="</li>":v||(q&&(n+="&nbsp;"),n+="</div>");for(;0<z.length;)n+=b(z.pop());B&&(n='<style>ul.vceditor-todo { list-style: none; margin-left: 0; padding-left: 0; } ul.vceditor-todo > li { padding-left: 1em; text-indent: -1em; } ul.vceditor-todo > li:before { content: "\\2610"; padding-right: 5px; } ul.vceditor-todo > li.vceditor-checked:before { content: "\\2611"; padding-right: 5px; }</style>\n'+
n);return n}}();d.SerializeHtml=c})(window);(function(d){var c=function(){function b(a,b,c){this.listType=a||m.UNORDERED;this.lineFormatting=b||vceditor.LineFormatting();this.textFormatting=c||vceditor.Formatting()}function a(){this.lines=[];this.currentLine=[];this.currentLineListItemType=null}function c(a,b,c){if(a.nodeType===r.ELEMENT_NODE){var f=n.fromElement(a);if(f){c.currentLine.push(new vceditor.Text(vceditor.sentinelConstants.ENTITY_SENTINEL_CHARACTER,new vceditor.Formatting(f.toAttributes())));return}}switch(a.nodeType){case r.TEXT_NODE:a=
a.nodeValue.replace(/[ \n\t]+/g," ");c.currentLine.push(vceditor.Text(a,b.textFormatting));break;case r.ELEMENT_NODE:switch(f=a.getAttribute("style")||"",b=h(b,f),a.nodeName.toLowerCase()){case "div":case "h1":case "h2":case "h3":case "p":c.newlineIfNonEmpty(b);g(a,b,c);c.newlineIfNonEmpty(b);break;case "center":b=b.withAlign("center");c.newlineIfNonEmpty(b);g(a,b.withAlign("center"),c);c.newlineIfNonEmpty(b);break;case "b":case "strong":g(a,b.withTextFormatting(b.textFormatting.bold(!0)),c);break;
case "u":g(a,b.withTextFormatting(b.textFormatting.underline(!0)),c);break;case "i":case "em":g(a,b.withTextFormatting(b.textFormatting.italic(!0)),c);break;case "s":g(a,b.withTextFormatting(b.textFormatting.strike(!0)),c);break;case "font":f=a.getAttribute("face");var d=a.getAttribute("color"),w=parseInt(a.getAttribute("size"));f&&(b=b.withTextFormatting(b.textFormatting.font(f)));d&&(b=b.withTextFormatting(b.textFormatting.color(d)));w&&(b=b.withTextFormatting(b.textFormatting.fontSize(w)));g(a,
b,c);break;case "br":c.newline(b);break;case "ul":c.newlineIfNonEmptyOrListItem(b);f="vceditor-todo"===a.getAttribute("class")?m.TODO:m.UNORDERED;g(a,b.withListType(f).withIncreasedIndent(),c);c.newlineIfNonEmpty(b);break;case "ol":c.newlineIfNonEmptyOrListItem(b);g(a,b.withListType(m.ORDERED).withIncreasedIndent(),c);c.newlineIfNonEmpty(b);break;case "li":c.newlineIfNonEmptyOrListItem(b);f="vceditor-checked"===a.getAttribute("class")?m.TODOCHECKED:b.listType;c.makeListItem(f);f=c.currentLine;g(a,
b,c);(f===c.currentLine||0<c.currentLine.length)&&c.newline(b);break;case "style":break;default:g(a,b,c)}}}function g(a,b,f){if(a.hasChildNodes())for(var d=0;d<a.childNodes.length;d++)c(a.childNodes[d],b,f)}function h(a,b){var c=a.textFormatting,f=a.lineFormatting;b=b.split(";");for(var d=0;d<b.length;d++){var g=b[d].split(":");if(2===g.length){var h=vceditor.utils.trim(g[0]).toLowerCase();g=vceditor.utils.trim(g[1]).toLowerCase();switch(h){case "text-decoration":h=0<=g.indexOf("underline");g=0<=
g.indexOf("line-through");c=c.underline(h).strike(g);break;case "font-weight":g="bold"===g||600<=parseInt(g);c=c.bold(g);break;case "font-style":c=c.italic("italic"===g||"oblique"===g);break;case "color":c=c.color(g);break;case "background-color":c=c.backgroundColor(g);break;case "text-align":f=f.align(g);break;case "font-size":h=null;vceditor.utils.stringEndsWith(g,"px pt % em xx-small x-small small medium large x-large xx-large smaller larger".split(" "))?h=g:parseInt(g)&&(h=parseInt(g)+"px");h&&
(c=c.fontSize(h));break;case "font-family":g=vceditor.utils.trim(g.split(",")[0]),g=g.replace(/['"]/g,""),g=g.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}),c=c.font(g)}}}return a.withLineFormatting(f).withTextFormatting(c)}var m=d.LineFormatting.LIST_TYPE;b.prototype.withTextFormatting=function(a){return new b(this.listType,this.lineFormatting,a)};b.prototype.withLineFormatting=function(a){return new b(this.listType,a,this.textFormatting)};b.prototype.withListType=
function(a){return new b(a,this.lineFormatting,this.textFormatting)};b.prototype.withIncreasedIndent=function(){var a=this.lineFormatting.indent(this.lineFormatting.getIndent()+1);return new b(this.listType,a,this.textFormatting)};b.prototype.withAlign=function(a){a=this.lineFormatting.align(a);return new b(this.listType,a,this.textFormatting)};a.prototype.newlineIfNonEmpty=function(a){this.cleanLine_();0<this.currentLine.length&&this.newline(a)};a.prototype.newlineIfNonEmptyOrListItem=function(a){this.cleanLine_();
(0<this.currentLine.length||null!==this.currentLineListItemType)&&this.newline(a)};a.prototype.newline=function(a){this.cleanLine_();a=a.lineFormatting;null!==this.currentLineListItemType&&(a=a.listItem(this.currentLineListItemType),this.currentLineListItemType=null);this.lines.push(vceditor.Line(this.currentLine,a));this.currentLine=[]};a.prototype.makeListItem=function(a){this.currentLineListItemType=a};a.prototype.cleanLine_=function(){if(0<this.currentLine.length){var a=this.currentLine.length-
1;this.currentLine[0].text=this.currentLine[0].text.replace(/^ +/,"");this.currentLine[a].text=this.currentLine[a].text.replace(/ +$/g,"");for(a=0;a<this.currentLine.length;a++)this.currentLine[a].text=this.currentLine[a].text.replace(/\u00a0/g," ")}1===this.currentLine.length&&""===this.currentLine[0].text&&(this.currentLine=[])};var n,r=r||{ELEMENT_NODE:1,TEXT_NODE:3};return function(f,d){var g=(vceditor.document||document).createElement("div");g.innerHTML=f;n=d;f=new a;d=new b;c(g,d,f);return f.lines}}();
d.ParseHtml=c})(window);(function(d){RichTextCodeMirrorAdapter=function(){function c(b){this.rtcm=b;this.cm=b.codeMirror;a(this,"onChange");a(this,"onAttributesChange");a(this,"onCursorActivity");a(this,"onFocus");a(this,"onBlur");this.rtcm.on("change",this.onChange);this.rtcm.on("attributesChange",this.onAttributesChange);this.cm.on("cursorActivity",this.onCursorActivity);this.cm.on("focus",this.onFocus);this.cm.on("blur",this.onBlur)}function b(a){var b=a.lineCount()-1;return a.indexFromPos({line:b,ch:a.getLine(b).length})}
function a(a,b){var c=a[b];a[b]=function(){c.apply(a,arguments)}}function f(a){for(var b in a)return!1;return!0}var g=d.TextOperation,h=d.WrappedOperation,m=d.Cursor;c.prototype.detach=function(){this.rtcm.off("change",this.onChange);this.rtcm.off("attributesChange",this.onAttributesChange);this.cm.off("cursorActivity",this.onCursorActivity);this.cm.off("focus",this.onFocus);this.cm.off("blur",this.onBlur)};c.operationFromCodeMirrorChanges=function(a,c){c=b(c);for(var f=(new g).retain(c),d=(new g).retain(c),
h=a.length-1;0<=h;h--){var n=a[h],m=n.start,r=c-m-n.text.length;f=(new g).retain(m)["delete"](n.removed.length).insert(n.text,n.attributes).retain(r).compose(f);d=d.compose((new g).retain(m)["delete"](n.text.length).insert(n.removed,n.removedAttributes).retain(r));c+=n.removed.length-n.text.length}return[f,d]};c.operationFromAttributesChanges=function(a,c){c=b(c);for(var f=new g,d=new g,h=0,n=0;n<a.length;n++){var m=a[n];h=m.start-h;if(!(0<=h))throw Error("assertion error");f.retain(h);d.retain(h);
h=m.end-m.start;f.retain(h,m.attributes);d.retain(h,m.attributesInverse);h=m.start+h}f.retain(c-h);d.retain(c-h);return[f,d]};c.applyOperationToCodeMirror=function(a,b){10<a.ops.length&&b.codeMirror.getWrapperElement().setAttribute("style","display: none");for(var c=a.ops,d=0,g=0,h=c.length;g<h;g++){var n=c[g];n.isRetain()?(f(n.attributes)||b.updateTextAttributes(d,d+n.chars,function(a){for(var b in n.attributes)!1===n.attributes[b]?delete a[b]:a[b]=n.attributes[b]},"RTCMADAPTER",!0),d+=n.chars):
n.isInsert()?(b.insertText(d,n.text,n.attributes,"RTCMADAPTER"),d+=n.text.length):n.isDelete()&&b.removeText(d,d+n.chars,"RTCMADAPTER")}10<a.ops.length&&(b.codeMirror.getWrapperElement().setAttribute("style",""),b.codeMirror.refresh())};c.prototype.registerCallbacks=function(a){this.callbacks=a};c.prototype.onChange=function(a,b){"RTCMADAPTER"!==b[0].origin&&(a=c.operationFromCodeMirrorChanges(b,this.cm),this.trigger("change",a[0],a[1]))};c.prototype.onAttributesChange=function(a,b){"RTCMADAPTER"!==
b[0].origin&&(a=c.operationFromAttributesChanges(b,this.cm),this.trigger("change",a[0],a[1]))};c.prototype.onCursorActivity=function(){this.trigger("cursorActivity")};c.prototype.onFocus=function(){this.trigger("focus")};c.prototype.onBlur=function(){this.cm.somethingSelected()||this.trigger("blur")};c.prototype.getValue=function(){return this.cm.getValue()};c.prototype.getCursor=function(){var a=this.cm,b=a.getCursor(),c=a.indexFromPos(b);if(a.somethingSelected()){var f=a.getCursor(!0);b=0===(b.line<
f.line?-1:b.line>f.line?1:b.ch<f.ch?-1:b.ch>f.ch?1:0)?a.getCursor(!1):f;a=a.indexFromPos(b)}else a=c;return new m(c,a)};c.prototype.setCursor=function(a){this.cm.setSelection(this.cm.posFromIndex(a.position),this.cm.posFromIndex(a.selectionEnd))};c.prototype.addStyleRule=function(a){if("undefined"!==typeof document&&null!==document){if(!this.addedStyleRules){this.addedStyleRules={};var b=document.createElement("style");document.documentElement.getElementsByTagName("head")[0].appendChild(b);this.addedStyleSheet=
b.sheet}if(!this.addedStyleRules[a])return this.addedStyleRules[a]=!0,this.addedStyleSheet.insertRule(a,0)}};c.prototype.setOtherCursor=function(a,b,c){var f=this.cm.posFromIndex(a.position);if("string"===typeof b&&b.match(/^#[a-fA-F0-9]{3,6}$/)){var d=this.rtcm.end();if("object"===typeof a&&"number"===typeof a.position&&"number"===typeof a.selectionEnd&&!(0>a.position||a.position>d||0>a.selectionEnd||a.selectionEnd>d)){var g=this.cm.cursorCoords(f);d=document.createElement("span");d.className="other-client";
d.id="cursorId"+c;d.style.borderLeftWidth="3px";d.style.borderLeftStyle="solid";d.style.borderLeftColor=b;d.style.marginLeft=d.style.marginRight="-3px";d.style.height=.9*(g.bottom-g.top)+"px";d.setAttribute("data-clientname",virtualclass.vutil.getUserInfo("name",c,virtualclass.connectedUsers));d.setAttribute("data-clientid",c);d.style.position="relative";g=document.getElementById("cursorId"+c);null!=g&&g.parentNode.removeChild(g);if(c!=virtualclass.gObj.uid){if(a.position===a.selectionEnd)return d.style.zIndex=
0,this.cm.setBookmark(f,{widget:d,insertLeft:!0});this.cm.setBookmark(f,{widget:d,insertLeft:!0});c="selection-"+b.replace("#","");this.addStyleRule("."+c+" { background: "+b+"; }");a.selectionEnd>a.position?(b=f,a=this.cm.posFromIndex(a.selectionEnd)):(b=this.cm.posFromIndex(a.selectionEnd),a=f);return this.cm.markText(b,a,{className:c})}}}};c.prototype.trigger=function(a){var b=Array.prototype.slice.call(arguments,1),c=this.callbacks&&this.callbacks[a];c&&c.apply(this,b)};c.prototype.applyOperation=
function(a){c.applyOperationToCodeMirror(a,this.rtcm)};c.prototype.registerUndo=function(a){this.cm.undo=a};c.prototype.registerRedo=function(a){this.cm.redo=a};c.prototype.invertOperation=function(a){for(var b=0,c=this.rtcm.codeMirror,d,m,n=new g,q=0;q<a.wrapped.ops.length;q++){var w=a.wrapped.ops[q];if(w.isRetain())if(f(w.attributes))n.retain(w.chars),b+=w.chars;else for(d=this.rtcm.getAttributeSpans(b,b+w.chars),m=0;m<d.length;m++){var p={},B;for(B in w.attributes){var G=w.attributes[B],H=d[m].attributes[B];
!1===G?H&&(p[B]=H):G!==H&&(p[B]=H||!1)}n.retain(d[m].length,p);b+=d[m].length}else if(w.isInsert())n["delete"](w.text.length);else if(w.isDelete()){p=c.getRange(c.posFromIndex(b),c.posFromIndex(b+w.chars));d=this.rtcm.getAttributeSpans(b,b+w.chars);for(m=G=0;m<d.length;m++)n.insert(p.substr(G,d[m].length),d[m].attributes),G+=d[m].length;b+=w.chars}}return new h(n,a.meta.invert())};return c}();d.Client=RichTextCodeMirrorAdapter})(window);otAdapter=function(){function d(c,b){b=b.charAt(0).toLowerCase()+b.slice(1);var a=Vceditor.getvcEditor();c.operations&&c.revision>c.operations.length?(b=[],b[c.revision-c.operations.length-1]=null,this.operations=b.concat(c.operations)):this.operations=c.operations?c.operations:[];this.server=new a.Server(c.doc,this.operations);this.trigger=function(a){this.callbacks[a].apply(this,Array.prototype.slice.call(arguments,1))};this.teacherOT=function(a){a=this.doOT(a);"undefined"!=typeof a&&this.preSend(a,
!0)};this.doOT=function(b){if(1!==this.myOTrequestData)try{if("virtualclass-editor-operation"==b.eddata){var c=JSON.parse(b.data),f=new a.WrappedOperation(a.TextOperation.fromJSON(c.operation),c.cursor&&a.Cursor.fromJSON(c.cursor)),d=this.server.receiveOperation(c.revision,f);if(!d){console.log("there is some problem on revision of history");return}b.data=d.wrapped.toJSON();b.meta=d.meta}return b}catch(n){console.log("ERROR "+n),roles.isTeacher()&&(this.myOTrequestData=1,virtualclass[b.et].responseToRequest())}};
this.processOp=function(a){if(1!==this.myrequestData&&1!==this.myOTrequestData)try{var b=a.message;b.hasOwnProperty("edFrom")&&(a.fromUser.userid=b.edFrom);b.hasOwnProperty("eddata")?"virtualclass-editor-cursor"==b.eddata?this.trigger("cursor",a.fromUser.userid,JSON.parse(b.data)):"selection"==b.eddata?this.trigger("selection",virtualclass.gObj.uid,b.data):"virtualclass-editor-operation"==b.eddata&&(this.trigger("operation",b.data),this.trigger("cursor",a.fromUser.userid,b.meta),this.storeOperationIfStudent(b)):
console.log("Editor : processOP - No EDDATA")}catch(h){roles.hasAdmin()?(this.myOTrequestData=1,virtualclass[a.message.et].responseToRequest(),console.log("Teacher : send whlole editor data ")):(this.removeOperations(a),virtualclass[a.message.et].requestData(),this.myrequestData=1,console.log("Student : send whlole editor data "))}};this.storeOperationIfStudent=function(b){if(!roles.hasAdmin()){var c={};c.wrapped=a.TextOperation.fromJSON(b.data);c.meta=b.meta;this.server.operations.push(c)}};this.receivedMessage=
function(a){if(!virtualclass.isPlayMode||"object"!=typeof a.toUser){var b=a.message;if("t"!=a.fromUser.role&&"e"!=a.fromUser.role||b.hasOwnProperty("edFrom"))if(b.hasOwnProperty("edFrom")||"t"==a.fromUser.role||"e"==a.fromUser.role)if(b.edFrom==virtualclass.gObj.uid){if("virtualclass-editor-operation"==b.eddata)try{this.trigger("ack"),this.storeOperationIfStudent(b)}catch(h){1===ioMissingPackets.missRequestFlag&&(virtualclass[b.et].cmClient.revision--,this.processOp(a),console.log("Failed Acknolwdgement processOp()")),
console.log("ACK Too Late "+h)}}else this.processOp(a);else b=this.doOT(b),"undefined"!=typeof b&&(a.message=b,b.edFrom=a.fromUser.userid,this.preSend(b,!0));else if(roles.hasAdmin()){if("virtualclass-editor-operation"==b.eddata)try{this.trigger("ack")}catch(h){console.log("ACK Too Late "+h)}}else this.processOp(a)}};this.removeOperations=function(a){a=a.message.et;this.server.operations=[];this.server.document="";virtualclass[a].cmClient.revision=0;if(null!=b){var b=document.getElementById("virtualclassEditorRichBody");
b.parentNode.removeChild(b)}}}d.myrequestData=0;d.myOTrequestData=0;d.prototype.sendOperation=function(c,b,a,f){if("undefined"!=typeof f)var d="richtext"==f?"editorRich":"editorCode";b={eddata:"virtualclass-editor-operation",data:JSON.stringify({revision:c,operation:b,cursor:a}),et:d,cf:"eddata"};console.log("from send operation "+c);this.beforeSend(b);console.log("send operation")};d.prototype.sendSelection=function(c){this.beforeSend({eddata:"selection",data:JSON.stringify(c),cf:"eddata"})};d.prototype.sendCursor=
function(c){this.beforeSend({eddata:"virtualclass-editor-cursor",data:JSON.stringify(c),cf:"eddata"})};d.prototype.registerCallbacks=function(c){this.callbacks=c};d.prototype.beforeSend=function(c){if(1!=this.myrequestData)if(roles.hasAdmin())this.teacherOT(c);else{var b=virtualclass.vutil.whoIsTeacher();c=this.setEditorTypeOnPacket(c);ioAdapter.mustSendUser(c,b)}};d.prototype.setEditorTypeOnPacket=function(c){if(c.hasOwnProperty("eddata")&&"initVcEditor"!=c.eddata&&"virtualclass-editor-operation"!=
c.eddata)if("EditorRich"==virtualclass.currApp||"editorRich"==virtualclass.currApp)c.et="editorRich";else if("EditorCode"==virtualclass.currApp||"editorCode"==virtualclass.currApp)c.et="editorCode";return c};d.prototype.preSend=function(c,b){c=this.setEditorTypeOnPacket(c);"undefined"==typeof b||0==b||null==b?ioAdapter.mustSend(c):setTimeout(function(){ioAdapter.mustSendAll(c)},300)};return d}();var Vceditor=function(){var d=d||{};d.utils=window.utils;d=d||{};d.Span=window.Span;d.TextOp=window.TextOp;d.TextOperation=window.TextOperation;"object"===typeof module&&(module.exports=d.TextOperation);d.AnnotationList=window.AnnotationList;d.Cursor=window.Cursor;d.RichTextToolbar=window.RichTextToolbar;d.WrappedOperation=window.WrappedOperation;d.UndoManager=window.UndoManager;d.Client=window.Client;Client=d.Client;d.EditorClient=window.EditorClient;d.utils.makeEventEmitter(d.EditorClient,["synced"]);
d.AttributeConstants=window.AttributeConstants;d.sentinelConstants={LINE_SENTINEL_CHARACTER:"\ue000",ENTITY_SENTINEL_CHARACTER:"\ue001"};d.EntityManager=function(){function c(){this.entities_={};var a="src alt width height style class".split(" ");this.register("img",{render:function(a){b.assert(a.src,"image entity should have 'src'!");for(var c="src alt width height style class".split(" "),f="<img ",d=0;d<c.length;d++){var n=c[d];n in a&&(f+=" "+n+'="'+a[n]+'"')}return f+">"},fromElement:function(b){for(var c=
{},f=0;f<a.length;f++){var d=a[f];b.hasAttribute(d)&&(c[d]=b.getAttribute(d))}return c}})}var b=d.utils;c.prototype.register=function(a,b){d.utils.assert(b.render,"Entity options should include a 'render' function!");d.utils.assert(b.fromElement,"Entity options should include a 'fromElement' function!");this.entities_[a]=b};c.prototype.renderToElement=function(a,b){return this.tryRenderToElement_(a,"render",b)};c.prototype.exportToElement=function(a){var b=this.tryRenderToElement_(a,"export")||this.tryRenderToElement_(a,
"getHtml")||this.tryRenderToElement_(a,"render");b.setAttribute("data-vceditor-entity",a.type);return b};c.prototype.updateElement=function(a,b){var c=a.type;a=a.info;this.entities_[c]&&"undefined"!=typeof this.entities_[c].update&&this.entities_[c].update(a,b)};c.prototype.fromElement=function(a){var b=a.getAttribute("data-vceditor-entity");b||(b=a.nodeName.toLowerCase());if(b&&this.entities_[b])return a=this.entities_[b].fromElement(a),new d.Entity(b,a)};c.prototype.tryRenderToElement_=function(a,
b,c){var f=a.type;a=a.info;if(this.entities_[f]&&this.entities_[f][b]&&(b=this.entities_[f][b](a,c,d.document||window&&window.document))){if("string"===typeof b)return f=(d.document||document).createElement("div"),f.innerHTML=b,f.childNodes[0];if("object"===typeof b)return d.utils.assert("undefined"!==typeof b.nodeType,"Error rendering "+f+" entity.  render() function must return an html string or a DOM element."),b}};c.prototype.entitySupportsUpdate=function(a){return this.entities_[a]&&this.entities_[a].update};
return c}();d=d||{};d.Entity=window.entity;d.Entity=function(){function c(a,b){if(!(this instanceof c))return new c(a,b);this.type=a;this.info=b||{}}var b=d.AttributeConstants.ENTITY_SENTINEL,a=b+"_";c.prototype.toAttributes=function(){var c={};c[b]=this.type;for(var d in this.info)c[a+d]=this.info[d];return c};c.fromAttributes=function(f){var d=f[b],h={},m;for(m in f)0===m.indexOf(a)&&(h[m.substr(a.length)]=f[m]);return new c(d,h)};return c}();d.RichTextCodeMirror=function(){function c(a,b,c){this.codeMirror=
a;this.options_=c||{};this.entityManager_=b;this.currentAttributes_=null;var f=this;this.annotationList_=new h(function(a,b){f.onAnnotationsChanged_(a,b)});this.initAnnotationList_();g(this,"onCodeMirrorBeforeChange_");g(this,"onCodeMirrorChange_");g(this,"onCursorActivity_");if(/^4\./.test(CodeMirror.version))this.codeMirror.on("changes",this.onCodeMirrorChange_);else this.codeMirror.on("change",this.onCodeMirrorChange_);this.codeMirror.on("beforeChange",this.onCodeMirrorBeforeChange_);this.codeMirror.on("cursorActivity",
this.onCursorActivity_);this.changeId_=0;this.outstandingChanges_={};this.dirtyLines_=[]}function b(a,b){return a.line-b.line||a.ch-b.ch}function a(a){if(0===a.length)return 0;for(var b=0,c=0;c<a.length;c++)b+=a[c].length;return b+a.length-1}function f(a){this.attributes=a||{}}function g(a,b){var c=a[b];a[b]=function(){c.apply(a,arguments)}}var h=d.AnnotationList,m=d.Span,n=d.utils,r=d.AttributeConstants,A={c:"color",bc:"background-color",fs:"font-size",li:function(a){return"padding-left: "+40*a+
"px"}},z={};n.makeEventEmitter(c,["change","attributesChange","newLine"]);var t=d.sentinelConstants.LINE_SENTINEL_CHARACTER,v=d.sentinelConstants.ENTITY_SENTINEL_CHARACTER;c.prototype.detach=function(){this.codeMirror.off("beforeChange",this.onCodeMirrorBeforeChange_);this.codeMirror.off("change",this.onCodeMirrorChange_);this.codeMirror.off("changes",this.onCodeMirrorChange_);this.codeMirror.off("cursorActivity",this.onCursorActivity_);this.clearAnnotations_()};c.prototype.toggleAttribute=function(a,
b){b=b||!0;if(this.emptySelection_()){var c=this.getCurrentAttributes_();c[a]===b?delete c[a]:c[a]=b;this.currentAttributes_=c}else b=this.getCurrentAttributes_()[a]!==b?b:!1,this.setAttribute(a,b)};c.prototype.setAttribute=function(a,b){var c=this.codeMirror;this.emptySelection_()?(c=this.getCurrentAttributes_(),!1===b?delete c[a]:c[a]=b,this.currentAttributes_=c):(this.updateTextAttributes(c.indexFromPos(c.getCursor("start")),c.indexFromPos(c.getCursor("end")),function(c){!1===b?delete c[a]:c[a]=
b}),this.updateCurrentAttributes_())};c.prototype.updateTextAttributes=function(a,b,c,d,g){var h=[],n=a,p=this;this.annotationList_.updateSpan(new m(a,b-a),function(a,b){var m={};for(q in a.attributes)m[q]=a.attributes[q];m[r.LINE_SENTINEL]&&!g||c(m);var q={};var B={};p.computeChangedAttributes_(a.attributes,m,q,B);a:{for(var w in q){a=!1;break a}a=!0}a||h.push({start:n,end:n+b,attributes:q,attributesInverse:B,origin:d});n+=b;return new f(m)});0<h.length&&this.trigger("attributesChange",this,h)};
c.prototype.computeChangedAttributes_=function(a,b,c,f){var d={},g;for(g in a)d[g]=!0;for(g in b)d[g]=!0;for(g in d)g in b?g in a?a[g]!==b[g]&&(c[g]=b[g],f[g]=a[g]):(c[g]=b[g],f[g]=!1):(c[g]=!1,f[g]=a[g])};c.prototype.toggleLineAttribute=function(a,b){var c=this.getCurrentLineAttributes_();this.setLineAttribute(a,a in c&&c[a]===b?!1:b)};c.prototype.setLineAttribute=function(a,b){this.updateLineAttributesForSelection(function(c){!1===b?delete c[a]:c[a]=b})};c.prototype.updateLineAttributesForSelection=
function(a){var b=this.codeMirror,c=b.getCursor("start"),f=b.getCursor("end");c=c.line;var d=f.line;b=b.getLine(d);f=this.areLineSentinelCharacters_(b.substr(0,f.ch));d>c&&f&&d--;this.updateLineAttributes(c,d,a)};c.prototype.updateLineAttributes=function(a,b,c){for(;a<=b;a++){var f=this.codeMirror.getLine(a),d=this.codeMirror.indexFromPos({line:a,ch:0});f[0]!==t?(f={},f[r.LINE_SENTINEL]=!0,c(f),this.insertText(d,t,f)):this.updateTextAttributes(d,d+1,c,null,!0)}};c.prototype.replaceText=function(a,
b,c,f,d){this.changeId_++;var g="cmrt-"+this.changeId_;this.outstandingChanges_[g]={origOrigin:d,attributes:f};f=this.codeMirror;a=f.posFromIndex(a);b="number"===typeof b?f.posFromIndex(b):null;f.replaceRange(c,a,b,g)};c.prototype.insertText=function(a,b,c,f){var d=this.codeMirror,g=d.getCursor(),h="RTCMADAPTER"==f&&!d.somethingSelected()&&a==d.indexFromPos(g);this.replaceText(a,null,b,c,f);h&&d.setCursor(g)};c.prototype.removeText=function(a,b,c){var f=this.codeMirror;f.replaceRange("",f.posFromIndex(a),
f.posFromIndex(b),c)};c.prototype.insertEntityAtCursor=function(a,b,c){var f=this.codeMirror;f=f.indexFromPos(f.getCursor("head"));this.insertEntityAt(f,a,b,c)};c.prototype.insertEntityAt=function(a,b,c,f){this.insertEntity_(a,new d.Entity(b,c),f)};c.prototype.insertEntity_=function(a,b,c){this.replaceText(a,null,v,b.toAttributes(),c)};c.prototype.getAttributeSpans=function(a,b){var c=[];a=this.annotationList_.getAnnotatedSpansForSpan(new m(a,b-a));for(b=0;b<a.length;b++)c.push({length:a[b].length,
attributes:a[b].annotation.attributes});return c};c.prototype.end=function(){var a=this.codeMirror.lineCount()-1;return this.codeMirror.indexFromPos({line:a,ch:this.codeMirror.getLine(a).length})};c.prototype.getRange=function(a,b){a=this.codeMirror.posFromIndex(a);b=this.codeMirror.posFromIndex(b);return this.codeMirror.getRange(a,b)};c.prototype.initAnnotationList_=function(){var a=this.end();0!==a&&this.annotationList_.insertAnnotatedSpan(new m(0,a),new f)};c.prototype.onAnnotationsChanged_=function(a,
b){var c,f={};this.tryToUpdateEntitiesInPlace(a,b);for(var d=0;d<a.length;d++)r.LINE_SENTINEL in a[d].annotation.attributes&&(f[this.codeMirror.posFromIndex(a[d].pos).line]=!0),(c=a[d].getAttachedObject())&&c.clear();for(d=0;d<b.length;d++){c=b[d].annotation;var g=r.LINE_SENTINEL in c.attributes,h=r.ENTITY_SENTINEL in c.attributes;a=this.codeMirror.posFromIndex(b[d].pos);g?f[a.line]=!0:h?this.markEntity_(b[d]):(c=this.getClassNameForAttributes_(c.attributes),""!==c&&(g=this.codeMirror.posFromIndex(b[d].pos+
b[d].length),c=this.codeMirror.markText(a,g,{className:c}),b[d].attachObject(c)))}for(var m in f)this.dirtyLines_.push(this.codeMirror.getLineHandle(Number(m))),this.queueLineMarking_()};c.prototype.tryToUpdateEntitiesInPlace=function(a,b){for(var c=a.length;c--;)for(var f=a[c],d=b.length;d--;){var g=b[d];if(f.pos==g.pos&&f.annotation.attributes.ent&&f.annotation.attributes.ent==g.annotation.attributes.ent&&this.entityManager_.entitySupportsUpdate(g.annotation.attributes.ent)){a.splice(c,1);b.splice(d,
1);var h=f.getAttachedObject();h.update(g.annotation.attributes);g.attachObject(h)}}};c.prototype.queueLineMarking_=function(){if(null==this.lineMarkTimeout_){var a=this;this.lineMarkTimeout_=setTimeout(function(){a.lineMarkTimeout_=null;for(var b=[],c=0;c<a.dirtyLines_.length;c++){var f=a.codeMirror.getLineNumber(a.dirtyLines_[c]);b.push(Number(f))}a.dirtyLines_=[];b.sort(function(a,b){return a-b});f=-1;for(c=0;c<b.length;c++){var d=b[c];d>f&&(f=a.markLineSentinelCharactersForChangedLines_(d,d))}},
0)}};c.prototype.addStyleWithCSS_=function(a){var b=document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css";c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a));b.appendChild(c)};c.prototype.getClassNameForAttributes_=function(a){var b="",c;for(c in a){var f=a[c];if(c===r.LINE_SENTINEL)d.utils.assert(!0===f,"LINE_SENTINEL attribute should be true if it exists.");else{var g=(this.options_.cssPrefix||"cmrt-")+c;if(!0!==f){c===r.FONT_SIZE&&
"string"!==typeof f&&(f+="px");var h=f.toString().toLowerCase().replace(/[^a-z0-9-_]/g,"-");g+="-"+h;A[c]&&(z[c]||(z[c]={}),z[c][h]||(z[c][h]=!0,h=A[c],f="function"===typeof h?h(f):h+": "+f,this.addStyleWithCSS_((c==r.LINE_INDENT?"pre."+g:"."+g)+" { "+f+" }")))}b=b+" "+g}}return b};c.prototype.markEntity_=function(a){for(var b=d.Entity.fromAttributes(a.annotation.attributes),c=this.codeMirror,f=this,g=[],h=0;h<a.length;h++){var m=c.posFromIndex(a.pos+h),n=c.posFromIndex(a.pos+h+1),q={collapsed:!0,
atomic:!0,inclusiveLeft:!1,inclusiveRight:!1},r=this.createEntityHandle_(b,a.pos),t=this.entityManager_.renderToElement(b,r);t&&(q.replacedWith=t);m=c.markText(m,n,q);g.push(m);r.setMarker(m)}a.attachObject({clear:function(){for(var a=0;a<g.length;a++)g[a].clear()},update:function(a){a=d.Entity.fromAttributes(a);for(var b=0;b<g.length;b++)f.entityManager_.updateElement(a,g[b].replacedWith)}});this.queueRefresh_()};c.prototype.queueRefresh_=function(){var a=this;this.refreshTimer_||(this.refreshTimer_=
setTimeout(function(){a.codeMirror.refresh();a.refreshTimer_=null},0))};c.prototype.createEntityHandle_=function(a,b){function c(){if(f){var a=f.find();return a?g.codeMirror.indexFromPos(a.from):null}return b}var f=null,g=this;return{find:c,remove:function(){var a=c();null!=a&&(g.codeMirror.focus(),g.removeText(a,a+1))},replace:function(b){var f=d.AttributeConstants.ENTITY_SENTINEL,h=f+"_",m=c();g.updateTextAttributes(m,m+1,function(c){for(var d in c)delete c[d];c[f]=a.type;for(var g in b)c[h+g]=
b[g]})},setMarker:function(a){f=a}}};c.prototype.lineClassRemover_=function(a){var b=this.codeMirror,c=b.getLineHandle(a);return{clear:function(){b.removeLineClass(c,"text",".*")}}};c.prototype.emptySelection_=function(){var a=this.codeMirror.getCursor("start"),b=this.codeMirror.getCursor("end");return a.line===b.line&&a.ch===b.ch};c.prototype.onCodeMirrorBeforeChange_=function(a,b){if("+input"===b.origin||"paste"===b.origin){a=[];for(var c=0;c<b.text.length;c++){var f=b.text[c];f=f.replace(new RegExp("["+
t+v+"]","g"),"");a.push(f)}b.update(b.from,b.to,a)}};c.prototype.onCodeMirrorChange_=function(a,b){if("object"===typeof b.from){for(a=[];b;)a.push(b),b=b.next;b=a}a=this.convertCoordinateSystemForChanges_(b);for(var c=[],d=0;d<a.length;d++){var g=a[d],h=g.start,n=g.text,q=g.removed,r=g.origin;if(0<q.length){for(var t=this.annotationList_.getAnnotatedSpansForSpan(new m(h,q.length)),v=0,w=0;w<t.length;w++){var z=t[w];c.push({start:h,end:h+z.length,removedAttributes:z.annotation.attributes,removed:q.substr(v,
z.length),attributes:{},text:"",origin:g.origin});v+=z.length}this.annotationList_.removeSpan(new m(h,q.length))}0<n.length&&("+input"===g.origin||"paste"===g.origin?g=this.currentAttributes_||{}:r in this.outstandingChanges_?(g=this.outstandingChanges_[r].attributes,r=this.outstandingChanges_[r].origOrigin,delete this.outstandingChanges_[r]):g={},this.annotationList_.insertAnnotatedSpan(new m(h,n.length),new f(g)),c.push({start:h,end:h,removedAttributes:{},removed:"",text:n,attributes:g,origin:r}))}this.markLineSentinelCharactersForChanges_(b);
0<c.length&&this.trigger("change",this,c)};c.prototype.convertCoordinateSystemForChanges_=function(c){function f(c,f){return function(d){if(0>=b(d,f.from))return c(d);if(0>=b(f.to,d)){var g=d.line+f.text.length-1-(f.to.line-f.from.line);if(f.to.line<d.line)d=d.ch;else if(1>=f.text.length)d=d.ch-(f.to.ch-f.from.ch)+a(f.text);else{var h=f.text;d=d.ch-f.to.ch+h[h.length-1].length}return c({line:g,ch:d})+a(f.removed)-a(f.text)}return f.from.line===d.line?c(f.from)+d.ch-f.from.ch:c(f.from)+a(f.removed.slice(0,
d.line-f.from.line))+1+d.ch}}for(var d=this,g=function(a){return d.codeMirror.indexFromPos(a)},h=[],m=c.length-1;0<=m;m--){var n=c[m];g=f(g,n);var q=g(n.from),r=n.removed.join("\n"),t=n.text.join("\n");h.unshift({start:q,end:q+r.length,removed:r,text:t,origin:n.origin})}return h};c.prototype.markLineSentinelCharactersForChanges_=function(a){for(var b=Number.MAX_VALUE,c=-1,f=0;f<a.length;f++){var d=a[f],g=d.from.line;if(1<d.removed.length||0<=d.removed[0].indexOf(t))b=Math.min(b,g),c=Math.max(c,g);
1<d.text.length?(b=Math.min(b,g),c=Math.max(c,g+d.text.length-1)):0<=d.text[0].indexOf(t)&&(b=Math.min(b,g),c=Math.max(c,g))}c=Math.min(c,this.codeMirror.lineCount()-1);this.markLineSentinelCharactersForChangedLines_(b,c)};c.prototype.markLineSentinelCharactersForChangedLines_=function(a,b){if(a<Number.MAX_VALUE)for(;0<a&&this.lineIsListItemOrIndented_(a-1);)a--;if(-1<b)for(var c=this.codeMirror.lineCount();b+1<c&&this.lineIsListItemOrIndented_(b+1);)b++;c=[];for(var f=this.codeMirror;a<=b;a++){var d=
f.getLine(a),g=f.getLineHandle(a);f.removeLineClass(g,"text",".*");if(0<d.length)for(g=d.indexOf(t);0<=g;){for(var h=g;g<d.length&&d[g]===t;){for(var m=f.findMarksAt({line:a,ch:g}),n=0;n<m.length;n++)m[n].isForLineSentinel&&m[n].clear();g++}this.markLineSentinelCharacters_(a,h,g,c);g=d.indexOf(t,g)}else c=[]}return b};c.prototype.markLineSentinelCharacters_=function(a,b,c,f){var d=this.codeMirror,g=null,h=null,m=function(){var a=h.find();return a?a.from.line:null};if(0===b){var n=this.getLineAttributes_(a),
p=n[r.LIST_TYPE],q=n[r.LINE_INDENT]||0;for(p&&0===q&&(q=1);q>=f.length;)f.push(1);"o"===p?(g=this.makeOrderedListElement_(f[q]),f[q]++):"u"===p?(g=this.makeUnorderedListElement_(),f[q]=1):"t"===p?(g=this.makeTodoListElement_(!1,m),f[q]=1):"tc"===p&&(g=this.makeTodoListElement_(!0,m),f[q]=1);m=this.getClassNameForAttributes_(n);""!==m&&this.codeMirror.addLineClass(a,"text",m);f=f.slice(0,q+1)}f={inclusiveLeft:!0,collapsed:!0};g&&(f.replacedWith=g);h=d.markText({line:a,ch:b},{line:a,ch:c},f);h.isForLineSentinel=
!0};c.prototype.makeOrderedListElement_=function(a){return n.elt("div",a+".",{"class":"vceditor-list-left"})};c.prototype.makeUnorderedListElement_=function(){return n.elt("div","\u2022",{"class":"vceditor-list-left"})};c.prototype.toggleTodo=function(a){var b=r.LIST_TYPE,c=this.getCurrentLineAttributes_(),f;b in c&&("t"===c[b]||"tc"===c[b])?"t"===c[b]?f="tc":"tc"===c[b]&&(f=a?"t":!1):f="t";this.setLineAttribute(b,f)};c.prototype.makeTodoListElement_=function(a,b){var c={type:"checkbox","class":"vceditor-todo-left"};
a&&(c.checked=!0);a=n.elt("input",!1,c);var f=this;n.on(a,"click",n.stopEventAnd(function(a){f.codeMirror.setCursor({line:b(),ch:1});f.toggleTodo(!0)}));return a};c.prototype.lineIsListItemOrIndented_=function(a){a=this.getLineAttributes_(a);return!1!==(a[r.LIST_TYPE]||!1)||0!==(a[r.LINE_INDENT]||0)};c.prototype.onCursorActivity_=function(){var a=this;clearTimeout(a.cursorTimeout);a.cursorTimeout=setTimeout(function(){a.updateCurrentAttributes_()},1)};c.prototype.getCurrentAttributes_=function(){this.currentAttributes_||
this.updateCurrentAttributes_();return this.currentAttributes_};c.prototype.updateCurrentAttributes_=function(){var a=this.codeMirror,b=a.indexFromPos(a.getCursor("anchor")),c=a.indexFromPos(a.getCursor("head"));a=c;if(b>c){for(;a<this.end();){b=this.getRange(a,a+1);if("\n"!==b&&b!==t)break;a++}a<this.end()&&a++}else for(;0<a;){b=this.getRange(a-1,a);if("\n"!==b&&b!==t)break;a--}b=this.annotationList_.getAnnotatedSpansForPos(a);this.currentAttributes_={};a={};0<b.length&&!(r.LINE_SENTINEL in b[0].annotation.attributes)?
a=b[0].annotation.attributes:1<b.length&&(d.utils.assert(!(r.LINE_SENTINEL in b[1].annotation.attributes),"Cursor can't be between two line sentinel characters."),a=b[1].annotation.attributes);for(var f in a)"l"!==f&&"lt"!==f&&"li"!==f&&0!==f.indexOf(r.ENTITY_SENTINEL)&&(this.currentAttributes_[f]=a[f])};c.prototype.getCurrentLineAttributes_=function(){var a=this.codeMirror,b=a.getCursor("anchor");a=a.getCursor("head");var c=a.line;0===a.ch&&b.line<a.line&&c--;return this.getLineAttributes_(c)};c.prototype.getLineAttributes_=
function(a){var b={},c=this.codeMirror.getLine(a);if(0<c.length&&c[0]===t){a=this.codeMirror.indexFromPos({line:a,ch:0});a=this.annotationList_.getAnnotatedSpansForSpan(new m(a,1));d.utils.assert(1===a.length);for(var f in a[0].annotation.attributes)b[f]=a[0].annotation.attributes[f]}return b};c.prototype.clearAnnotations_=function(){this.annotationList_.updateSpan(new m(0,this.end()),function(a,b){return new f({})})};c.prototype.newline=function(){var a=this.codeMirror,b=this;if(this.emptySelection_()){var c=
a.getCursor("head").line,f=this.getLineAttributes_(c),d=f[r.LIST_TYPE];d&&1===a.getLine(c).length?this.updateLineAttributes(c,c,function(a){delete a[r.LIST_TYPE];delete a[r.LINE_INDENT]}):(a.replaceSelection("\n","end","+input"),this.updateLineAttributes(c+1,c+1,function(a){for(var g in f)a[g]=f[g];"tc"===d&&(a[r.LIST_TYPE]="t");b.trigger("newLine",{line:c+1,attr:a})}))}else a.replaceSelection("\n","end","+input")};c.prototype.deleteLeft=function(){var a=this.codeMirror,b=a.getCursor("head"),c=this.getLineAttributes_(b.line),
f=c[r.LIST_TYPE];c=c[r.LINE_INDENT];var d=this.emptySelection_()&&1===b.ch;d&&f?this.updateLineAttributes(b.line,b.line,function(a){delete a[r.LIST_TYPE];delete a[r.LINE_INDENT]}):d&&c&&0<c?this.updateLineAttributes(b.line,b.line,function(a){a[r.LINE_INDENT]--}):a.deleteH(-1,"char")};c.prototype.deleteRight=function(){var a=this.codeMirror,b=a.getCursor("head"),c=a.getLine(b.line);c=this.areLineSentinelCharacters_(c);var f=b.line+1<a.lineCount()?a.getLine(b.line+1):"";this.emptySelection_()&&c&&f[0]===
t?a.replaceRange("",{line:b.line,ch:0},{line:b.line+1,ch:0},"+input"):a.deleteH(1,"char")};c.prototype.indent=function(){this.updateLineAttributesForSelection(function(a){var b=a[r.LIST_TYPE];a[r.LINE_INDENT]?a[r.LINE_INDENT]++:a[r.LINE_INDENT]=b?2:1})};c.prototype.unindent=function(){this.updateLineAttributesForSelection(function(a){var b=a[r.LINE_INDENT];b&&1<b?a[r.LINE_INDENT]=b-1:(delete a[r.LIST_TYPE],delete a[r.LINE_INDENT])})};c.prototype.getText=function(){return this.codeMirror.getValue().replace(new RegExp(t,
"g"),"")};c.prototype.areLineSentinelCharacters_=function(a){for(var b=0;b<a.length;b++)if(a[b]!==t)return!1;return!0};f.prototype.equals=function(a){if(!(a instanceof f))return!1;for(var b in this.attributes)if(a.attributes[b]!==this.attributes[b])return!1;for(b in a.attributes)if(a.attributes[b]!==this.attributes[b])return!1;return!0};return c}();d=d||{};d.RichTextCodeMirrorAdapter=window.RichTextCodeMirrorAdapter;d=d||{};d.Formatting=function(){function c(a){if(!(this instanceof c))return new c(a);
this.attributes=a||{}}var b=d.AttributeConstants;c.prototype.cloneWithNewAttribute_=function(a,b){var f={},d;for(d in this.attributes)f[d]=this.attributes[d];!1===b?delete f[a]:f[a]=b;return new c(f)};c.prototype.bold=function(a){return this.cloneWithNewAttribute_(b.BOLD,a)};c.prototype.italic=function(a){return this.cloneWithNewAttribute_(b.ITALIC,a)};c.prototype.underline=function(a){return this.cloneWithNewAttribute_(b.UNDERLINE,a)};c.prototype.strike=function(a){return this.cloneWithNewAttribute_(b.STRIKE,
a)};c.prototype.font=function(a){return this.cloneWithNewAttribute_(b.FONT,a)};c.prototype.fontSize=function(a){return this.cloneWithNewAttribute_(b.FONT_SIZE,a)};c.prototype.color=function(a){return this.cloneWithNewAttribute_(b.COLOR,a)};c.prototype.backgroundColor=function(a){return this.cloneWithNewAttribute_(b.BACKGROUND_COLOR,a)};return c}();d=d||{};d.Text=function(){function c(b,a){if(!(this instanceof c))return new c(b,a);this.text=b;this.formatting=a||d.Formatting()}return c}();d.LineFormatting=
window.LineFormatting;d.Line=function(){function c(b,a){if(!(this instanceof c))return new c(b,a);"[object Array]"!==Object.prototype.toString.call(b)&&(b="undefined"===typeof b?[]:[b]);this.textPieces=b;this.formatting=a||d.LineFormatting()}return c}();d.ParseHtml=window.ParseHtml;d.SerializeHtml=window.SerializeHtml;d.textPiecesToInserts=function(c,b){function a(a,b){a instanceof d.Text&&(b=a.formatting.attributes,a=a.text);g.push({string:a,attributes:b});c="\n"===a[a.length-1]}function f(b){c&&
a(d.sentinelConstants.LINE_SENTINEL_CHARACTER,b.formatting.attributes);for(var f=0;f<b.textPieces.length;f++)a(b.textPieces[f]);a("\n")}for(var g=[],h=0;h<b.length;h++)b[h]instanceof d.Line?f(b[h]):a(b[h]);return g};d=d||{};d.Vceditor=function(c){function b(c,f,d,g){if(!(this instanceof b))return new b(c,f,d,g);if(!q&&!w)throw Error("Couldn't find CodeMirror or ACE.  Did you forget to include codemirror.js or ace.js?");if(q&&f instanceof q)this.codeMirror_=this.editor_=f,c=this.codeMirror_.getValue(),
""!==c&&console.log("Can't initialize Vceditor with a CodeMirror instance that already contains text.");else if(w&&f&&f.session instanceof w.EditSession){if(this.ace_=this.editor_=f,c=this.ace_.getValue(),""!==c)throw Error("Can't initialize Vceditor with an ACE instance that already contains text.");}else this.codeMirror_=this.editor_=new q(f);c=this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_.container;this.vcEditorWrapper_=v.elt("div",null,{"class":"vceditor"});c.parentNode.replaceChild(this.vcEditorWrapper_,
c);this.vcEditorWrapper_.appendChild(c);v.on(c,"dragstart",v.stopEvent);this.editor_.vceditor=this;this.options_=d||{};this.getOption("richTextShortcuts",!1)&&(q.keyMap.richtext||this.initializeKeyMap_(),this.codeMirror_.setOption("keyMap","richtext"),this.vcEditorWrapper_.className+=" vceditor-richtext");this.imageInsertionUI=this.getOption("imageInsertionUI",!0);this.getOption("richTextToolbar",!1)&&(this.addToolbar_(),this.vcEditorWrapper_.className+=" vceditor-richtext vceditor-with-toolbar");
this.addPoweredByLogo_();this.codeMirror_&&this.codeMirror_.refresh();this.getOption("userColor",a("JqrwCaZm29-CLg-Pfz2"));this.entityManager_=new z;c=g.revision;f=[];this.codeMirror_?(this.richTextCodeMirror_=new m(this.codeMirror_,this.entityManager_,{cssPrefix:"vceditor-"}),this.editorAdapter_=new h(this.richTextCodeMirror_)):this.editorAdapter_=new r(this.ace_);d.hasOwnProperty("richTextToolbar")?(virtualclass.editorRich.vcAdapter=new otAdapter(g,"EditorRich"),virtualclass.editorRich.cmClient=
new A(c,f,virtualclass.editorRich.vcAdapter,this.editorAdapter_)):(virtualclass.editorCode.vcAdapter=new otAdapter(g,"EditorCode"),virtualclass.editorCode.cmClient=new A(c,f,virtualclass.editorCode.vcAdapter,this.editorAdapter_));"Microsoft Internet Explorer"==navigator.appName&&navigator.userAgent.match(/MSIE 8\./)&&(window.onload=function(){var a=document.getElementsByTagName("head")[0],b=document.createElement("style");b.type="text/css";b.styleSheet.cssText=":before,:after{content:none !important;}";
a.appendChild(b);setTimeout(function(){a.removeChild(b)},0)})}function a(a){for(var b=1,c=0;c<a.length;c++)b=17*(b+a.charCodeAt(c))%360;return g(b/360,1,.85)}function f(a,b,c){function f(a){a=Math.round(255*a).toString(16);return 1===a.length?"0"+a:a}return"#"+f(a)+f(b)+f(c)}function g(a,b,c){if(0===b)return f(c,c,c);var d=.5>c?c*(1+b):c+b-b*c,g=2*c-d;b=function(a){0>a&&(a+=1);1<a&&--a;return 1>6*a?g+6*(d-g)*a:1>2*a?d:2>3*a?g+6*(d-g)*(2/3-a):g};return f(b(a+1/3),b(a),b(a-1/3))}if(!d.RichTextCodeMirrorAdapter)throw Error("Oops! It looks like you're trying to include lib/vceditor.js directly.  This is actually one of many source files that make up vceditor.  You want dist/vceditor.js instead.");
var h=d.RichTextCodeMirrorAdapter,m=d.RichTextCodeMirror,n=d.RichTextToolbar,r=d.ACEAdapter,A=d.EditorClient,z=d.EntityManager,t=d.AttributeConstants,v=d.utils,q=c.CodeMirror,w=c.ace;v.makeEventEmitter(b);b.fromCodeMirror=b;b.fromACE=b;b.prototype.dispose=function(){this.zombie_=!0;var a=this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_.container;this.vcEditorWrapper_.removeChild(a);this.vcEditorWrapper_.parentNode.replaceChild(a,this.vcEditorWrapper_);this.editor_.vceditor=null;this.codeMirror_&&
"richtext"===this.codeMirror_.getOption("keyMap")&&this.codeMirror_.setOption("keyMap","default");this.vcAdapter.dispose();this.editorAdapter_.detach();this.richTextCodeMirror_&&this.richTextCodeMirror_.detach()};b.prototype.setUserId=function(a){this.vcAdapter.setUserId(a)};b.prototype.setUserColor=function(a){this.vcAdapter.setColor(a)};b.prototype.getText=function(){this.assertReady_("getText");return this.codeMirror_?this.richTextCodeMirror_.getText():this.ace_.getSession().getDocument().getValue()};
b.prototype.setText=function(a){if(this.ace_)return this.ace_.getSession().getDocument().setValue(a);this.codeMirror_.getWrapperElement().setAttribute("style","display: none");this.codeMirror_.setValue("");this.insertText(0,a);this.codeMirror_.getWrapperElement().setAttribute("style","");this.codeMirror_.refresh()};b.prototype.insertTextAtCursor=function(a){this.insertText(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),a)};b.prototype.insertText=function(a,b){v.assert(!this.ace_,"Not supported for ace yet.");
this.assertReady_("insertText");"[object Array]"!==Object.prototype.toString.call(b)&&(b=[b]);b=d.textPiecesToInserts(0===a,b);for(var c=0;c<b.length;c++){var f=b[c].string;this.richTextCodeMirror_.insertText(a,f,b[c].attributes);a+=f.length}};b.prototype.getOperationForSpan=function(a,b){var c=this.richTextCodeMirror_.getRange(a,b);a=this.richTextCodeMirror_.getAttributeSpans(a,b);b=0;for(var f=new d.TextOperation,g=0;g<a.length;g++)f.insert(c.substr(b,a[g].length),a[g].attributes),b+=a[g].length;
return f};b.prototype.getHtml=function(){return this.getHtmlFromRange(null,null)};b.prototype.getHtmlFromSelection=function(){var a=this.codeMirror_.getCursor("start"),b=this.codeMirror_.getCursor("end");a=this.codeMirror_.indexFromPos(a);b=this.codeMirror_.indexFromPos(b);return this.getHtmlFromRange(a,b)};b.prototype.getHtmlFromRange=function(a,b){a=null!=a&&null!=b?this.getOperationForSpan(a,b):this.getOperationForSpan(0,this.codeMirror_.getValue().length);return d.SerializeHtml(a,this.entityManager_)};
b.prototype.insertHtml=function(a,b){b=d.ParseHtml(b,this.entityManager_);this.insertText(a,b)};b.prototype.insertHtmlAtCursor=function(a){this.insertHtml(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),a)};b.prototype.setHtml=function(a){a=d.ParseHtml(a,this.entityManager_);this.setText(a)};b.prototype.isHistoryEmpty=function(){this.assertReady_("isHistoryEmpty");return this.vcAdapter.isHistoryEmpty()};b.prototype.bold=function(){this.richTextCodeMirror_.toggleAttribute(t.BOLD);this.codeMirror_.focus()};
b.prototype.italic=function(){this.richTextCodeMirror_.toggleAttribute(t.ITALIC);this.codeMirror_.focus()};b.prototype.underline=function(){this.richTextCodeMirror_.toggleAttribute(t.UNDERLINE);this.codeMirror_.focus()};b.prototype.strike=function(){this.richTextCodeMirror_.toggleAttribute(t.STRIKE);this.codeMirror_.focus()};b.prototype.fontSize=function(a){this.richTextCodeMirror_.setAttribute(t.FONT_SIZE,a);this.codeMirror_.focus()};b.prototype.font=function(a){this.richTextCodeMirror_.setAttribute(t.FONT,
a);this.codeMirror_.focus()};b.prototype.color=function(a){this.richTextCodeMirror_.setAttribute(t.COLOR,a);this.codeMirror_.focus()};b.prototype.highlight=function(){this.richTextCodeMirror_.toggleAttribute(t.BACKGROUND_COLOR,"rgba(255,255,0,.65)");this.codeMirror_.focus()};b.prototype.align=function(a){if("left"!==a&&"center"!==a&&"right"!==a)throw Error('align() must be passed "left", "center", or "right".');this.richTextCodeMirror_.setLineAttribute(t.LINE_ALIGN,a);this.codeMirror_.focus()};b.prototype.orderedList=
function(){this.richTextCodeMirror_.toggleLineAttribute(t.LIST_TYPE,"o");this.codeMirror_.focus()};b.prototype.unorderedList=function(){this.richTextCodeMirror_.toggleLineAttribute(t.LIST_TYPE,"u");this.codeMirror_.focus()};b.prototype.todo=function(){this.richTextCodeMirror_.toggleTodo();this.codeMirror_.focus()};b.prototype.newline=function(){this.richTextCodeMirror_.newline()};b.prototype.deleteLeft=function(){this.richTextCodeMirror_.deleteLeft()};b.prototype.deleteRight=function(){this.richTextCodeMirror_.deleteRight()};
b.prototype.indent=function(){this.richTextCodeMirror_.indent();this.codeMirror_.focus()};b.prototype.unindent=function(){this.richTextCodeMirror_.unindent();this.codeMirror_.focus()};b.prototype.undo=function(){this.codeMirror_.undo()};b.prototype.redo=function(){this.codeMirror_.redo()};b.prototype.insertEntity=function(a,b,c){this.richTextCodeMirror_.insertEntityAtCursor(a,b,c)};b.prototype.insertEntityAt=function(a,b,c,f){this.richTextCodeMirror_.insertEntityAt(a,b,c,f)};b.prototype.registerEntity=
function(a,b){this.entityManager_.register(a,b)};b.prototype.getOption=function(a,b){return a in this.options_?this.options_[a]:b};b.prototype.assertReady_=function(a){if(!this.ready_)throw Error('You must wait for the "ready" event before calling '+a+".");if(this.zombie_)throw Error("You can't use a Vceditor after calling dispose()!");};b.prototype.makeImageDialog_=function(){this.makeDialog_("img",virtualclass.lang.getString("InsertimageURL"))};b.prototype.makeDialog_=function(a,b){var c=this;b=
v.elt("input",null,{"class":"vceditor-dialog-input",id:a,type:"text",placeholder:b,autofocus:"autofocus"});var f=v.elt("a","Submit",{"class":"vceditor-btn",id:"submitbtn"});v.on(f,"click",v.stopEventAnd(function(){var b=document.getElementById("overlay");b.style.visibility="hidden";var f=document.getElementById(a).value;null!==f&&c.insertEntity(a,{src:f});c.vcEditorWrapper_.removeChild(b)}));var d=v.elt("a","Cancel",{"class":"vceditor-btn"});v.on(d,"click",v.stopEventAnd(function(){var a=document.getElementById("overlay");
a.style.visibility="hidden";c.vcEditorWrapper_.removeChild(a)}));f=v.elt("div",[f,d],{"class":"vceditor-btn-group"});b=v.elt("div",[b,f],{"class":"vceditor-dialog-div"});b=v.elt("div",[b],{"class":"vceditor-dialog",id:"overlay"});this.vcEditorWrapper_.appendChild(b)};b.prototype.addToolbar_=function(){this.toolbar=new n(this.imageInsertionUI);this.toolbar.on("undo",this.undo,this);this.toolbar.on("redo",this.redo,this);this.toolbar.on("bold",this.bold,this);this.toolbar.on("italic",this.italic,this);
this.toolbar.on("underline",this.underline,this);this.toolbar.on("strike",this.strike,this);this.toolbar.on("font-size",this.fontSize,this);this.toolbar.on("font",this.font,this);this.toolbar.on("color",this.color,this);this.toolbar.on("left",function(){this.align("left")},this);this.toolbar.on("center",function(){this.align("center")},this);this.toolbar.on("right",function(){this.align("right")},this);this.toolbar.on("ordered-list",this.orderedList,this);this.toolbar.on("unordered-list",this.unorderedList,
this);this.toolbar.on("todo-list",this.todo,this);this.toolbar.on("indent-increase",this.indent,this);this.toolbar.on("indent-decrease",this.unindent,this);this.toolbar.on("insert-image",this.makeImageDialog_,this);this.vcEditorWrapper_.insertBefore(this.toolbar.element(),this.vcEditorWrapper_.firstChild)};b.prototype.addPoweredByLogo_=function(){};b.prototype.initializeKeyMap_=function(){function a(a){return function(b){setTimeout(function(){a.call(b.vceditor)},0)}}this.getOption("readOnly")?q.keyMap.richtext=
{fallthrough:["default"]}:q.keyMap.richtext={"Ctrl-B":a(this.bold),"Cmd-B":a(this.bold),"Ctrl-I":a(this.italic),"Cmd-I":a(this.italic),"Ctrl-U":a(this.underline),"Cmd-U":a(this.underline),"Ctrl-H":a(this.highlight),"Cmd-H":a(this.highlight),Enter:a(this.newline),Delete:a(this.deleteRight),Backspace:a(this.deleteLeft),Tab:a(this.indent),"Shift-Tab":a(this.unindent),fallthrough:["default"]}};return b}(this);d.Vceditor.Formatting=d.Formatting;d.Vceditor.Text=d.Text;d.Vceditor.Entity=d.Entity;d.Vceditor.LineFormatting=
d.LineFormatting;d.Vceditor.Line=d.Line;d.Vceditor.TextOperation=d.TextOperation;d.Vceditor.RichTextCodeMirrorAdapter=d.RichTextCodeMirrorAdapter;d.Server=Server;d.Vceditor.getvcEditor=function(){return d};return d.Vceditor}();window.Vceditor=Vceditor;(function(d){var c=function(a){return a.map(function(a){return{operation:a.wrapped.toJSON()}})},b=function(a){var b=Vceditor.getvcEditor();return a.map(function(a){return new b.WrappedOperation(b.TextOperation.fromJSON(a.operation),a.cursor&&b.Cursor.fromJSON(a.cursor))})};d.editor=function(a,f,d){this.etype=a;if("editorRich"==a)var g={lineWrapping:!0},m={richTextToolbar:!0,richTextShortcuts:!0,readOnly:!1};else g={lineNumbers:!0,mode:"markdown",readOnly:!1},m={defaultText:"Markdown Editor "};return{etype:a,
cm:"",vcAdapter:"",initialised:!1,prvEdRev:0,dataReqTry:0,stroageData:localStorage.getItem(this.etype+"_allEditorOperations"),tempstroageDataRev:localStorage.getItem(this.etype+"_edOperationRev"),readonly:!1,veryInit:function(){if(null!=this.stroageData&&""!=this.stroageData){this.stroageDataRev=null==this.tempstroageDataRev?0:this.tempstroageDataRev;var a=JSON.parse(this.stroageData);a=JSON.parse(a.data);console.log("Current Editor type "+virtualclass.currAppEditorType);virtualclass.hasOwnProperty("currAppEditor")?
virtualclass.currAppEditorType==this.etype?this.initialiseDataWithEditor(a,"displayEditor",virtualclass.currAppEditorType):this.initialiseDataWithEditor(a):this.initialiseDataWithEditor(a)}virtualclass.gObj.editorInitDone++},init:function(a,b,c,f){var d={};"undefined"!=typeof a&&(d.revision=a);"undefined"!=typeof b&&(d.clients=b);"undefined"!=typeof c&&(d.doc=c);"undefined"!=typeof f&&(d.operations=f);this.cm||"object"==typeof this.cm?virtualclass.dispvirtualclassLayout(virtualclass.currApp):(this.codemirrorWithLayout(g),
this.createEditorClient(m,d));roles.hasControls()?(roles.hasAdmin()&&this.createAllEditorController(),virtualclass.gObj.studentSSstatus.sharing||ioAdapter.mustSendAll({eddata:"init",et:this.etype,cf:"eddata"})):roles.hasAdmin()&&this.createAllEditorController()},createAllEditorController:function(){var a=this.etype,b="all"+a+"Container";if(null==document.getElementById(b)){console.log("For Enable all, Button is creating");var c,f=virtualclass.getTemplate("edenableall","editor")({type1:a});$("#virtualclass"+
virtualclass.vutil.capitalizeFirstLetter(a)+"Body").append(f);f=document.getElementById(b+"Anch");var d=localStorage.getItem(a+"mode");null!==d&&("editorRich"==a&&"disable"==d||"editorCode"==a&&"disable"==d)&&(f.dataset.action="disable");console.log("Editor type "+a);f.addEventListener("click",function(){console.log("Editor type "+a+" clicked");var f=document.getElementById(b+"Anch");null!=f&&(c=f.dataset.action,"enable"==f.dataset.action?(f.dataset.action="disable",f.classList.remove("icon-collaboratecrose"),
f.classList.add("icon-collaborate"),f.parentNode.setAttribute("data-title",virtualclass.lang.getString("offcollaboration"))):(f.classList.remove("icon-collaborate"),f.classList.add("icon-collaboratecrose"),f.dataset.action="enable",f.parentNode.setAttribute("data-title",virtualclass.lang.getString("oncollaboration"))));localStorage.setItem(a+"mode",f.dataset.action);virtualclass.user.control.toggleAllEditorController.call(virtualclass.user,a,c)})}},removeScrollFromFireFox:function(a){a=virtualclass.vutil.capitalizeFirstLetter(a);
setTimeout(function(){var b=document.querySelector("#virtualclass"+a+"Body .CodeMirror-vscrollbar"),c=document.querySelector("#virtualclass"+a+"Body .CodeMirror"),f=document.querySelector("#virtualclass"+a+"Body .CodeMirror-code");b.style.display=f.offsetHeight>c.offsetHeight-25?"block":""},20)},createEditorClient:function(a,b){roles.hasAdmin()&&(this.cm.setOption("readOnly",!1),this.createAllEditorController(),a.readOnly=!1);virtualclass.isPlayMode&&(this.readOnlyMode("enable","notCreateSyncBox"),
this.cm.setOption("readOnly","nocursor"));Vceditor.fromCodeMirror({},this.cm,a,b);"Firefox"==virtualclass.system.mybrowser.detection()[0]&&this.removeScrollFromFireFox(this.etype)},disableEditorByOuterLayer:function(){var a=document.querySelector("#virtualclass"+virtualclass.vutil.capitalizeFirstLetter(this.etype)+"Body .CodeMirror.cm-s-default");null!=a&&(a.style.pointerEvents="none");console.log("Disable editor for ios")},enableEditorByOuterLayer:function(){var a=document.querySelector("#virtualclass"+
virtualclass.vutil.capitalizeFirstLetter(this.etype)+"Body .CodeMirror.cm-s-default");null!=a&&(a.style.pointerEvents="visible");console.log("Enable editor for ios")},codemirrorWithLayout:function(a){this.UI.container(this.etype);document.getElementById(this.UI.edId);"object"!=typeof this.cm&&(console.log("Code mirror instance is created "),this.cm=CodeMirror(document.getElementById(this.UI.edId),a))},requestData:function(){var a=virtualclass.vutil.whoIsTeacher();this.readOnlyMode("enable");ioAdapter.mustSendUser({eddata:"requestForEditorData",
et:this.etype,cf:"eddata"},a)},readOnlyMode:function(a,b){"object"==typeof this.cm&&("enable"==a?this.readonly||(this.cm.setOption("readOnly","nocursor"),"undefined"==typeof b&&this.UI.createSynchMessageBox(),this.readonly="nocursor"):this.readonly&&!virtualclass.isPlayMode&&(this.cm.setOption("readOnly",!1),this.readonly=!1,this.UI.hideSynchMessageBox()),virtualclass.vutil.setReadModeWhenTeacherIsDisConn(virtualclass.vutil.smallizeFirstLetter(this.etype)))},isVcAdapterIsReady:function(a){return virtualclass[a].hasOwnProperty("vcAdapter")&&
"object"==typeof virtualclass[a].vcAdapter},receivedOperations:{currAppEditor:function(a){a.fromUser.userid!=virtualclass.gObj.userid&&(console.log("curr app editor"),virtualclass.currAppEditor=!0,virtualclass.currAppEditorType=a.message.et,virtualclass.dispvirtualclassLayout(virtualclass.currAppEditorType))},init:function(a,b){"s"==a.fromUser.role||a.fromUser.userid==virtualclass.gObj.uid&&"1"!=wbUser.virtualclassPlay||virtualclass.makeAppReady(b)},initVcEditor:function(a){console.log("received whole data");
roles.hasView()&&"function"==typeof virtualclass[a.message.et].vcAdapter.removeOperations&&virtualclass[a.message.et].vcAdapter.removeOperations(a);if(!roles.hasControls()||roles.hasControls()&&a.fromUser.userid!=virtualclass.gObj.uid&&(a.message.hasOwnProperty("resFromUser")||a.message.hasOwnProperty("allEdData"))){var b=JSON.parse(a.message.data);a.message.hasOwnProperty("layoutEd")?this.initialiseDataWithEditor(b,a.message):this.initialiseDataWithEditor(b)}},requestForEditorData:function(a){a.fromUser.userid!=
virtualclass.gObj.uid?"object"!=typeof this.vcAdapter||0==this.vcAdapter.operations.length?ioAdapter.mustSendAll({eddata:"noDataForEditor",cf:"eddata"}):this.responseToRequest(a.fromUser.userid):console.log("Cannot send requestForEditorData to self")},noDataForEditor:function(){roles.hasControls()},"virtualclass-editor-operation":function(a){"object"==typeof this.vcAdapter&&(this.readOnlyMode("disable"),this.vcAdapter.receivedMessage(a))},"virtualclass-editor-cursor":function(a){"object"==typeof this.vcAdapter&&
this.vcAdapter.receivedMessage(a)},select:function(){"object"==typeof this.vcAdapter&&this.vcAdapter.receivedMessage(e)}},onmessage:function(a,b){this.receivedOperations[a.message.eddata].call(this,a,b);"object"!=typeof this.vcAdapter&&(roles.hasAdmin()&&"virtualclass-editor-operation"==a.message.eddata&&(virtualclass.makeAppReady(b),this.vcAdapter.receivedMessage(a,onmessage)),console.log("virtualclass adapter is not ready for editor"))},UI:{id:f,class:"vmApp virtualclass",edId:d,container:function(a){null==
document.getElementById(this.id)&&(a=virtualclass.getTemplate("editorrich","editor")({type:virtualclass.vutil.capitalizeFirstLetter(a),"class":a}),virtualclass.vutil.insertAppLayout(a))},createSynchMessageBox:function(){if(null!=document.getElementById("synchMessageBox"))this.showSynchMessageBox();else{var a=virtualclass.getTemplate("messagebox","editor")();document.getElementById(this.id).insertAdjacentHTML("afterbegin",a)}},showSynchMessageBox:function(){var a=document.getElementById("synchMessageBox");
null!=a&&(a.style.display="block")},hideSynchMessageBox:function(){var a=document.getElementById("synchMessageBox");null!=a&&(a.style.display="none")}},responseToRequest:function(a){var b=this.getWrappedOperations(!0);b.layoutEd="1";roles.isTeacher()&&(b.capp=virtualclass.currApp);b.et=this.etype;a?(b.resFromUser=!0,ioAdapter.mustSendUser(b,a),console.log("Sending responseToRequest to "+a)):(b.allEdData=!0,ioAdapter.mustSend(b),console.log("Sending responseToRequest to all"),virtualclass[b.et].vcAdapter.removeOperations({message:{et:b.et}}),
a=JSON.parse(b.data),virtualclass[b.et].initialiseDataWithEditor(a),virtualclass[b.et].vcAdapter.myOTrequestData=0)},isEidtorWithTeacher:function(){return roles.hasControls()&&("EditorRich"==virtualclass.currApp||"EditorCode"==virtualclass.currApp)},getWrappedOperations:function(a){a=this.vcAdapter&&this.vcAdapter.operations?c(this.vcAdapter.operations):[];return{eddata:"initVcEditor",data:JSON.stringify({operations:a}),et:this.etype,cf:"eddata"}},getStudentAllText:function(){return this.cm.getValue("\n")},
removeCodeMirror:function(){this.readonly=!1;var a=document.getElementById(this.UI.id);null!=a&&a.parentNode.removeChild(a);this.cm=""},setReadMode:function(){var a=JSON.parse(localStorage.getItem(this.etype));roles.hasAdmin()||(null!=a?a?(this.cm.setOption("readOnly",!1),a=!0):(this.cm.setOption("readOnly","nocursor"),a=!1):(this.cm.setOption("readOnly","nocursor"),a=!1),virtualclass.user.control.toggleDisplayWriteModeMsgBox(virtualclass.vutil.capitalizeFirstLetter(this.etype),a),virtualclass.vutil.setReadModeWhenTeacherIsDisConn(virtualclass.vutil.smallizeFirstLetter(this.etype)),
"iOS"==virtualclass.system.mybrowser.name&&virtualclass.system.isIPad()&&(a?this.enableEditorByOuterLayer():this.disableEditorByOuterLayer()))},writeBulkDocs:function(a){var c=b(a.operations);a.revision=0;if(this.cm){if(this.cm.getValue()!==a.str||""==a.str)this.vcAdapter=this.cmClient="",a.operations=[],a.doc="";this.createEditorClient(m,a);this.prvEdRev=a.revision}for(a=0;a<c.length;a++)virtualclass[this.etype].vcAdapter.server.receiveOperation(a,c[a]),this.vcAdapter.trigger("operation",c[a].wrapped.toJSON())},
initialiseDataWithEditor:function(a,c){b(a.operations);"undefined"!=typeof c&&c.hasOwnProperty("capp")&&(virtualclass.currApp=virtualclass.vutil.capitalizeFirstLetter(c.capp));this.removeCodeMirror();this.codemirrorWithLayout(g);virtualclass.dispvirtualclassLayout(virtualclass.currApp);this.writeBulkDocs(a);this.cm.refresh();this.setReadMode();a=virtualclass.vutil.capitalizeFirstLetter(virtualclass.currApp);"EditorRich"==a||"EditorCode"==a?(virtualclass.previous="virtualclass"+virtualclass.currApp,
virtualclass.system.setAppDimension(virtualclass.currApp)):(a=document.getElementById("virtualclassEditorRich"),null!=a&&(a.style.display="none"),a=document.getElementById("virtualclassEditorCode"),null!=a&&(a.style.display="none"));a=document.getElementById("virtualclassEditorTool");null!=a&&(a.style.pointerEvents="visible");otAdapter.myrequestData=0},removeEditorData:function(){"object"==typeof this.cm&&("object"==typeof this.vcAdapter&&(this.vcAdapter.operations.length=0),this.removeCodeMirror(),
localStorage.removeItem(this.etype+"_allEditorOperations"),localStorage.removeItem(this.etype+"_edOperationRev"))},saveIntoLocalStorage:function(){if("object"==typeof this.vcAdapter&&0<this.vcAdapter.operations.length){var a=this.getWrappedOperations();localStorage.removeItem(this.etype+"_allEditorOperations");localStorage.setItem(this.etype+"_allEditorOperations",JSON.stringify(a));localStorage.setItem(this.etype+"_edOperationRev",this.cmClient.revision)}},undoManager:function(a){setTimeout(function(){90==
a?document.querySelector(".vceditor-tb-undo").parentNode.click():89==a&&document.querySelector(".vceditor-tb-redo").parentNode.click()},0)}}}})(window);(function(d,c){d.Chat=function(){var b=null;return{userList:[],init:function(){this.chatroombox=null;this.chatWindow="private";this.counter=0;this.idList=[];this.commonChat=[];c.htab=[];c.htabIndex=[];this.vmstorage={};c("body").footerbar();"false"==localStorage.getItem("init")&&(c("#stickybar").removeClass("maximize").addClass("minimize"),c("#hide_bar input").removeClass("close").addClass("expand"));tabs=c("#tabs").tabs({cache:!0,activeOnAdd:!0});if(0==browserSupportsLocalStorage())alert(lang.sterror);
else{this.history();this.UI.privateChatBox.init();c("ul.tabs").on("click, focus","li",function(){c("li[aria-controls='"+c(this).attr("id")+"']").removeClass("ui-state-highlight")});console.log("chat local storage start ");var a=localStorage.getItem("chatEnable");null!=a&&"false"==a&&(document.querySelector("#chatWidget").classList.add("chat_disabled"),document.querySelector("#chatWidget").classList.remove("chat_enabled"))}},fetchChatUsers:function(){console.log("FetchUser congrea_get_enrolled_users");
var a=new FormData;a.append("action","fetchUser");virtualclass.xhr.send(a,d.webapi+"&user="+virtualclass.gObj.uid+"&methodname=congrea_get_enrolled_users",function(a){virtualclass.chat.userList=JSON.parse(a);updateOnlineUserText()})},setChatDisplay:function(){var a=document.querySelector("#virtualclassCont.congrea  #ta_chrm2"),b=document.querySelector("#virtualclassCont.congrea #congreaUserSearch"),c=localStorage.getItem("chatWindow");if(null!=c&&"common"==c)if(c=document.getElementById("chatrm")){c.classList.add("enable");
c.classList.remove("disable");document.getElementById("chatroom_bt2").classList.add("active");if(c=document.getElementById("memlist"))c.classList.remove("enable"),c.classList.contains("disable")||c.classList.add("disable"),c=document.getElementById("user_list"),c.classList.remove("active");if(b=document.querySelector("#virtualclassCont.congrea #congreaUserSearch"))b.style.display="none"}else{if(c=document.getElementById("memlist"))c.classList.add("enable"),c.classList.remove("disable"),c=document.getElementById("user_list"),
c.classList.add("active")}else if(null!=c&&"support"==c)(c=document.getElementById("congreaSupport"))&&c.classList.add("active");else{if(c=document.getElementById("memlist"))c.classList.add("enable"),c=document.getElementById("user_list"),c.classList.add("active");a&&(a.style.display="none")}document.querySelector("#virtualclassCont.congrea  .vmchat_bar_button").classList.contains("active")?(a&&(a.style.display="none"),b&&(b.style.display="block")):(a&&(a.style.display="block"),b&&(b.style.display=
"none"))},showChatListUsers:function(){var a=virtualclass.chat.userList;0<a.length&&(this._showChatUserList(a),displayChatOfflineUserList(a),document.querySelector("div#memlist").classList.add("enable"))},_showChatUserList:function(a){if(!document.getElementById("chat_div")){var f=document.createElement("div");f.id="chat_div";document.body.appendChild(f)}null==b&&(b=f=virtualclass.vutil.calculateChatHeight(),roles.hasControls()||virtualclass.videoHost.gObj.videoSwitch||(f+=230),virtualclass.vutil.setChatContHeight(f),
virtualclass.chat.boxHeight=f);c("#chat_div").memberlist({id:"chat_div",user:a,offset:"-1px",title:lang.online,userSent:function(a){return c("#chat_div").memberlist("option","boxManager").addUsr(a)}})},history:function(){var a=null;null!=localStorage.getItem(wbUser.sid)&&(a=JSON.parse(localStorage.getItem(wbUser.sid)),displayPvtChatHistory(a),a=localStorage.getItem("chatEnable"),null!=a&&"false"==a&&virtualclass.user.control.disbaleAllChatBox(),this.vmstorage=JSON.parse(localStorage.getItem(wbUser.sid)));
0<localStorage.length&&(displaycomChatHistory(),virtualclass.chat.removeChatHighLight("chatrm"),null!=a&&"false"==a&&virtualclass.user.control.disableCommonChat())},exportCommonChat:function(a){for(var b=[],c=virtualclass.chat.commonChat,d=0;d<c.length;d++)a<=c[d].time&&b.push(c[d]);return b},UI:{privateChatBox:{init:function(){c("#tabs").delegate("span.icon-close","click",this.close);c("#tabs").on("click","li a",this.toggle)},close:function(){var a=c(this).closest("li").attr("id").substring(5);c("#"+
a).chatbox("option").boxClosed(a);c("div#cb"+a+".ui-widget").hide();a=c(this).closest("li").remove().attr("aria-controls");c("#"+a).remove()},toggle:function(){var a=c(this).closest("li").attr("id").substring(5);c("#"+a).chatbox("toggleContentbox");"hidden"==localStorage.getItem(a)?localStorage.removeItem(a):localStorage.setItem(a,"hidden")}}},removedPrvLoggedInDetail:function(){c(".ui-memblist").remove();c(".ui-chatbox").remove();c("div#chatrm").remove();virtualclass.chat.chatroombox=null;console.log("Chat box is  null");
for(key in io.uniquesids)key!=io.cfg.userid&&(chatboxManager.delBox(key),c("li#tabcb"+key).remove());this.idList=0;c("#stickybar").removeClass("maximize").addClass("minimize");tabs.tabs("refresh")},removeCookieUserInfo:function(a){document.cookie="auth_user=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";document.cookie="auth_pass=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";document.cookie="path=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";display_error(a.message)},makeUserListEmpty:function(){c("#user_list .inner_bt #usertab_icon").css({background:"url("+
d.whiteboardPath+"images/offline.png)no-repeat top left"});c("#chatroom_bt .inner_bt #chatroom_text").text(lang.chatroom+" (0)");c("div#memlist").removeClass("enable")},removeChatHighLight:function(a){a=document.getElementById(a);if(null!=a){a=a.getElementsByClassName("ui-state-highlight");for(var b=0;b<a.length;b++)a[b].classList.remove("ui-state-highlight")}},openChatBox:function(){var a=document.querySelector("#memlist");null!=a&&(0<a.offsetWidth||0<a.offsetHeight||c("#chat_div").memberlist("option",
"boxManager").toggleBox())},enableTechSupport:function(a){var b=document.querySelector("#congreaSupport");b.setAttribute("data-tsid",a);b.classList.remove("notavailable");b.classList.add("available")},disableTechSupport:function(a){var b=document.querySelector("#congreaSupport");b.classList.add("notavailable");b.classList.remove("available");a=document.querySelector("#tabcb"+a+" .icon-close");null!=a&&a.click()},isTechSupportExist:function(a){var b=document.querySelector("#congreaSupport");if(null!=
b)return+b.dataset.tsid==+a}}}})(window,$);(function(d){d.widget("ui.footerbar",{options:{id:null,offset:0,width:"100%",barscroll:d(window).width()-430,supportId:"7",boxClosed:function(c){}},init:function(c){this.elem=c},widget:function(){return this.uiFooterbar},_create:function(){function c(){var a=[];virtualclass.connectedUsers.forEach(function(b){b.userid!=virtualclass.gObj.uid&&(b={id:b.userid,name:b.name.toLowerCase()},a.push(b))});var c=document.getElementById("congreaUserSearch").value;b(a,c.toLowerCase())}function b(a,b){a.forEach(function(a,
c){-1!=a.name.indexOf(b)?d("#ml"+a.id).show():d("#ml"+a.id).hide()})}var a=roles.hasAdmin(),f=virtualclass.getTemplate("stickycont","chat");d("#stickycontainer").append(f({control:a}));d("#chatroom_bt2 .inner_bt").click(function(){d("#chatroom_bt2").addClass("active");d("#user_list").removeClass("active");var a=document.querySelector("#appSettingCtrl"),b=document.querySelector("#virtualclassCont.congrea #appSettingDetail"),c=document.querySelector("#virtualclassCont.congrea #chatWidget");a.classList.contains("settingActive")&&
(a.classList.remove("settingActive"),a.classList.add("chatActive"));c.classList.remove("deactive");c.classList.contains("active")||c.classList.add("active");b.classList.remove("active");b.classList.remove("active");b.classList.contains("deactive")||b.classList.add("deactive");d("#chatroom_bt2").removeClass("ui-state-highlight");virtualclass.chat.chatWindow="common";0==d("ul#chat_room").length&&(a=document.createElement("ul"),a.id="chat_room",document.body.appendChild(a),virtualclass.chat.chatroombox=
d("#chat_room").chatroom({id:"chat_room",user:{name:"test"},title:lang.chatroom_header,messageSent:function(a,b){d("#chat_room").chatroom("option","boxManager").addMsg(a.name,b)}}),virtualclass.gObj.hasOwnProperty("chatEnable")&&!virtualclass.gObj.chatEnable&&(a=document.getElementById("chatrm"),null!=a&&virtualclass.user.control.makeElemDisable(a)),d("#chatwidget .vmchat_room_bt").attr("data-title",virtualclass.lang.getString("commonChat")));if(a=document.querySelector("#virtualclassCont.congrea #ta_chrm2"))a.style.display=
"block";if(a=document.querySelector("#virtualclassCont.congrea #memlist"))a.classList.remove("enable"),a.classList.contains("disable")||a.classList.add("disable");if(a=document.querySelector(".congrea .vmchat_search #congreaUserSearch"))a.style.display="none";if(a=document.querySelector("#virtualclassCont.congrea #chatrm"))a.classList.contains("enable")||a.classList.add("enable"),a.classList.remove("disable")});d("#user_list").click(function(){d("#chatroom_bt2").removeClass("active");d("#user_list").addClass("active");
var a=document.querySelector("#appSettingCtrl"),b=document.querySelector("#virtualclassCont.congrea #chatWidget"),c=document.querySelector("#virtualclassCont.congrea #appSettingDetail");a.classList.contains("settingActive")&&(a.classList.remove("settingActive"),a.classList.add("chatActive"));b.classList.remove("deactive");b.classList.contains("active")||b.classList.add("active");c.classList.remove("active");c.classList.contains("deactive")||c.classList.add("deactive");virtualclass.chat.chatWindow=
"private";this.classList.add("active");if(a=document.querySelector("#virtualclassCont.congrea #chatrm"))a.classList.remove("enable"),a.classList.contains("disable")||a.classList.add("disable");if(a=document.querySelector("#virtualclassCont.congrea #ta_chrm2"))a.style.display="none";if(a=document.querySelector(".congrea .vmchat_search #congreaUserSearch"))a.style.display="block";if(a=document.querySelector("#virtualclassCont.congrea #memlist"))a.classList.remove("disable"),a.classList.contains("enable")||
a.classList.add("enable")});d("#congreaUserSearch").keyup(function(){c(this.value)});this._setWidth(this.options.width);this.init(this)},destroy:function(){this.element.remove();this._destroy()},_setWidth:function(c){}})})(jQuery);(function(d){d.fn.clickToggle=function(c,b){var a=[c,b];this.data("toggleclicked",0);this.click(function(){var b=d(this).data(),c=b.toggleclicked;d.proxy(a[c],this)();b.toggleclicked=(c+1)%2});return this}})(jQuery);(function(d){d.widget("ui.memberlist",{options:{id:null,title:null,user:null,hidden:!1,offset:0,width:320,userSent:function(c){"7"!=c.userid&&this.boxManager.addUsr(c.name)},boxClosed:function(c){},boxManager:{init:function(c){this.elem=c},addUsr:function(c){if(null!=document.getElementById("ml"+c.userid))return!0;document.createElement("div");document.createDocumentFragment("div").id="tempId";c.userid!=wbUser.id&&(c.notSelf=!0);roles.hasControls()&&(c.isTeacher=!0);"t"==c.role?c.rl="teacher":"s"==
c.role&&(c.rl="student");console.log("Chat add user "+c.userid);return virtualclass.getTemplate("chatuser","chat")({peer:c})},highlightBox:function(){var c=this;c.elem.uiChatboxTitlebar.effect("highlight",{},300);c.elem.uiChatbox.effect("bounce",{times:3},300,function(){c.highlightLock=!1;c._scrollToBottom()})},toggleBox:function(){},_scrollToBottom:function(){}}},toggleContent:function(c){this.uiChatboxContent.toggle();this.uiChatboxContent.is(":visible")},widget:function(){return this.uiChatbox},
_create:function(){var c=(this.uiChatbox=d("<div></div>")).appendTo(document.getElementById("congreaChatCont")).addClass("ui-widget ui-corner-top ui-memblist").attr("id","memlist");uiChatboxContent=(this.uiChatboxContent=d("<div></div>")).addClass("ui-widget-content ui-memblist-content ").appendTo(c);uiChatboxLog=(this.uiChatboxLog=this.element).addClass("ui-widget-content ui-memblist-log").appendTo(uiChatboxContent).focusin(function(){var b=d(this).parent().prev();b.scrollTop(b.scrollHeight)});d(document).on("click",
"#chat_div .ui-memblist-usr .user-details a",function(b){b=d(this);var a=b.attr("href");"undefined"!=typeof a&&(a=a.replace("#",""),b=0<b.parent(".usern").length?b.html():b.siblings(".usern").find("a").html(),-1==d.inArray(a,virtualclass.chat.idList)&&(virtualclass.chat.counter++,virtualclass.chat.idList.push(a),virtualclass.chat.vmstorage.hasOwnProperty(a)||(virtualclass.chat.vmstorage[a]=[],virtualclass.chat.vmstorage[a].push({userid:a,name:b}))),chatboxManager.addBox(a,{dest:"dest"+virtualclass.chat.counter,
title:"box"+virtualclass.chat.counter,first_name:b,type:"privateChat"}),chatboxManager.init({user:{name:b},messageSent:function(a,b,c){d("#"+a).chatbox("option","boxManager").addMsg(b.name,c)}}),virtualclass.chat.vmstorage.hasOwnProperty(a)&&displayUserSinglePvtChatHistory(a),b=a=null)});this._setWidth(this.options.width);this._position(this.options.offset);this.options.boxManager.init(this);roles.hasAdmin()&&(virtualclass.user.UIaudioAll("congFooterCtr","uiMuteAll"),virtualclass.user.UIvideoAll("congFooterCtr",
"uiMuteAll"))},_setOption:function(c,b){if(null!=b)switch(c){case "hidden":b?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(b);break;case "width":this._setWidth(b)}d.Widget.prototype._setOption.apply(this,arguments)},_setWidth:function(c){this.uiChatboxLog.width(c+"px")},_position:function(c){this.uiChatbox.css("right",c)}})})(jQuery);(function(d){d.widget("ui.chatbox",{options:{id:null,title:null,user:null,hidden:!1,offset:0,width:230,messageSent:function(c,b,a){this.boxManager.addMsg(b.name,a)},boxClosed:function(c){},boxManager:{init:function(c){this.elem=c},addMsg:function(c,b){var a=this.elem.uiChatboxLog,f=document.createElement("div");a.append(f);a=!1;if(c){var g=document.createElement("b");d(g).text(c+": ");f.appendChild(g)}else a=!0;c=document.createElement(a?"i":"span");d(c).text(b);f.appendChild(c);d(f).addClass("ui-chatbox-msg");
d(f).fadeIn();this._scrollToBottom();this.elem.uiChatboxTitlebar.hasClass("ui-state-focus")||this.highlightLock||(this.highlightLock=!0,this.highlightBox())},highlightBox:function(){},toggleBox:function(){this.elem.uiChatbox.toggle()},_scrollToBottom:function(){var c=this.elem.uiChatboxLog;c.scrollTop(c.get(0).scrollHeight)}}},toggleContent:function(c){},toggleContentbox:function(c){this.uiChatboxContent.is(":visible")?(this.uiChatboxInputBox.focus(),d(d('#tabs ul li[id = "tabcb'+this.options.id+
'"]')).removeClass("ui-state-active")):d(d('#tabs ul li[id="tabcb'+this.options.id+'"]')).addClass("ui-state-active");this.uiChatbox.toggle("slide",{direction:"down"},1E3)},widget:function(){return this.uiChatbox},_create:function(){createTab(this.options.id,this.options.title);var c=this,b=c.options.title||"No Title",a=(c.uiChatbox=d("<div></div>")).appendTo(document.body).addClass("ui-widget ui-corner-top ui-chatbox").attr("id","cb"+c.options.id).focusin(function(){c.uiChatboxTitlebar.addClass("ui-state-focus")}).focusout(function(){c.uiChatboxTitlebar.removeClass("ui-state-focus")}),
f=(c.uiChatboxTitlebar=d("<div></div>")).addClass("ui-widget-header ui-corner-top ui-chatbox-titlebar ui-dialog-header").click(function(a){}).appendTo(a);(c.uiChatboxTitle=d("<span></span>")).html(b).appendTo(f);var g=(c.uiChatboxTitlebarClose=d('<a href="#"></a>')).addClass("ui-chatbox-icon ").attr("role","button").hover(function(){g.addClass("ui-state-hover")},function(){g.removeClass("ui-state-hover")}).click(function(b){delete virtualclass.chat.vmstorage[c.options.id][0].box;a.hide();c.options.boxClosed(c.options.id);
d("#tabcb"+c.options.id).remove();virtualclass.chat.idList&&virtualclass.chat.idList.length&&(b=virtualclass.chat.idList.indexOf(c.options.id),-1<b&&virtualclass.chat.idList.splice(b,1));return!1}).appendTo(f);d("<span ></span>").addClass("ui-icon icon-close").text("").appendTo(g);var h=(c.uiChatboxTitlebarMinimize=d('<a href = "#"></a>')).addClass("ui-chatbox-icon").attr("role","button").hover(function(){h.addClass("ui-state-hover")},function(){h.removeClass("ui-state-hover")}).click(function(a){c.toggleContentbox(a);
"hidden"==localStorage.getItem(c.options.id)?localStorage.removeItem(c.options.id):localStorage.setItem(c.options.id,"hidden");return!1}).appendTo(f);d("<span></span>").addClass("ui-icon icon-minus").text("").appendTo(h);b=(c.uiChatboxContent=d("<div></div>")).addClass("ui-widget-content ui-chatbox-content ").appendTo(a);(c.uiChatboxLog=c.element).addClass("ui-widget-content ui-chatbox-log").appendTo(b);var m=(c.uiChatboxInput=d("<div></div>")).addClass("ui-widget-content ui-chatbox-input").click(function(a){}).appendTo(b),
n=(c.uiChatboxInputBox=d("<textarea></textarea>")).addClass("ui-widget-content ui-chatbox-input-box ").prop("id","ta"+c.options.id).appendTo(m).keypress(function(a){if(a.keyCode&&a.keyCode==d.ui.keyCode.ENTER){msg=d.trim(d(this).val());if(0<msg.length){ioAdapter.mustSendUser({msg:msg,cf:"msg"},c.options.id);d("li[aria-controls='tabcb"+c.options.id+"']").removeClass("ui-state-highlight");d(this).val("");d("#"+c.options.id).chatbox("option").messageSent(c.options.id,{name:io.cfg.userobj.name},msg);
a=c.options.id;"undefined"==typeof virtualclass.chat.vmstorage[a]&&(virtualclass.chat.vmstorage[a]=[]);var b=(new Date).getTime();virtualclass.chat.vmstorage[a].push({userid:io.cfg.userid,name:io.cfg.userobj.name,msg:msg,time:b})}return!1}}).focusin(function(){n.addClass("ui-chatbox-input-focus");var a=d(this).parent().prev();a.scrollTop(a.get(0).scrollHeight)}).focusout(function(){n.removeClass("ui-chatbox-input-focus")});f.find("*").add(f).disableSelection();b.children().click(function(){c.uiChatboxInputBox.focus()});
c._setWidth(c.options.width);c._position(c.options.offset);c.options.boxManager.init(c);c.options.hidden||a.show();d(d('#tabs ul li[id = "tabcb'+c.options.id+'"]')).append(a)},_setOption:function(c,b){if(null!=b)switch(c){case "hidden":b?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(b);break;case "width":this._setWidth(b)}d.Widget.prototype._setOption.apply(this,arguments)},_setWidth:function(c){this.uiChatbox.width(c+"px");this.uiChatboxInputBox.css("width",c-11+
"px")},_position:function(c){}})})(jQuery);(function(d){d.widget("ui.chatroom",{options:{id:null,title:null,user:null,hidden:!1,offset:6,width:304,messageSent:function(c,b){this.boxManager.addMsg(c.name,b)},boxClosed:function(c){},boxManager:{init:function(c){this.elem=c},addMsg:function(c,b){var a=virtualclass.vutil.UTCtoLocalTime(b.time),f=b.msg,g=this.elem.uiChatboxLog,h=document.createElement("li");h.className="left clearfix";g.append(h);g=document.createElement("span");g.className="chat-img pull-left";h.appendChild(g);var m=document.createElement("img");
m.className="primary";m.src=whiteboardPath+"images/quality-support.png";g.appendChild(m);m=!1;g=document.createElement("div");g.className="commonChatCon chat-body clearfix";if(c){var n=document.createElement("a");n.className="primary-font";d(n).text(c);g.appendChild(n)}else m=!0;c=document.createElement(m?"i":"p");c.className="text";d(c).text(f);f=document.createElement("span");f.className="text-muted";f.innerHTML=a;g.appendChild(c);g.appendChild(f);h.appendChild(g);g.appendChild(c);h.dataset.msgtime=
b.time;d(h).addClass("ui-chatbox-msg");d(h).fadeIn();this._scrollToBottom()},highlightBox:function(){this.elem.uiChatboxTitlebar.addClass("ui-state-highlight");this.highlightLock=!1;this._scrollToBottom()},toggleBox:function(){this.elem.uiChatbox.toggle("slide",{direction:"down"},1E3)},_scrollToBottom:function(){var c=this.elem.uiChatboxLog;c.scrollTop(c.get(0).scrollHeight)}}},toggleContent:function(c){this.uiChatboxContent.toggle();this.uiChatboxContent.is(":visible")&&this.uiChatboxInputBox.focus()},
widget:function(){return this.uiChatbox},_create:function(){var c=null!=localStorage.getItem("chatEnable")?"true"==localStorage.chatEnable?"enable":"disable":"disable",b=this;c=(b.uiChatbox=d("<div></div>")).appendTo(document.getElementById("congreaChatCont")).addClass("ui-widget ui-corner-top ui-chatroom "+c).prop("id","chatrm");uiChatboxContent=(b.uiChatboxContent=d("<div></div>")).addClass("ui-widget-content ui-chatbox-content ").appendTo(c);uiChatboxLog=(b.uiChatboxLog=b.element).addClass("ui-widget-content ui-chatbox-log").appendTo(uiChatboxContent);
uiChatboxInputBox=(b.uiChatboxInputBox=d("<input></input>")).addClass("ui-widget-content ui-chatbox-input-box ").prop("id","ta_chrm2").prop("placeholder","Send message...").appendTo(document.querySelector(".congrea #congchatBarInput")).keydown(function(a){if(a.keyCode&&a.keyCode==d.ui.keyCode.ENTER){msg=d.trim(d(this).val());a=(new Date).getTime();var c={receiver:"chatroom",msg:msg,cf:"msg",time:a};0<msg.length&&(ioAdapter.mustSend(c),d(this).val(""),b.options.messageSent({name:io.cfg.userobj.name},
{msg:msg,time:a}),null!=localStorage.getItem("chatroom")?(c=JSON.parse(localStorage.getItem("chatroom")),a={userid:io.cfg.userid,name:io.cfg.userobj.name,msg:msg,time:a},c.push(a),localStorage.setItem("chatroom",JSON.stringify(c))):(a={userid:io.cfg.userid,name:io.cfg.userobj.name,msg:msg,time:a},localStorage.setItem("chatroom",JSON.stringify([a]))),virtualclass.chat.commonChat.push(a));return!1}}).focusin(function(){uiChatboxInputBox.addClass("ui-chatbox-input-focus")}).focusout(function(){uiChatboxInputBox.removeClass("ui-chatbox-input-focus")});
uiChatboxContent.children().click(function(){b.uiChatboxInputBox.focus()});b._setWidth(b.options.width);b._position(b.options.offset);b.options.boxManager.init(b);b.options.hidden||(c.show(),virtualclass.vutil.isPlayMode()&&disCommonChatInput())},_setOption:function(c,b){if(null!=b)switch(c){case "hidden":b?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(b);break;case "width":this._setWidth(b)}d.Widget.prototype._setOption.apply(this,arguments)},_setWidth:function(c){this.uiChatbox.width(c+
"px")},_position:function(c){this.uiChatbox.css("left",c)}})})(jQuery);Array.indexOf||(Array.prototype.indexOf=function(d){for(var c=0;c<this.length;c++)if(this[c]==d)return c;return-1});
var chatboxManager=function(){var d=[],c=[],b={width:230,gap:20,maxBoxes:5,messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b,c)}},a=function(a){var f=c.indexOf(a);if(-1!=f)for(c.splice(f,1),d.splice(f,1),diff=b.width+b.gap,a=f;a<c.length;a++)offset=$("#"+c[a]).chatbox("option","offset"),$("#"+c[a]).chatbox("option","offset",offset-diff);else alert("should not happen: "+a)},f=function(a,c,f){d.indexOf(c.userid);b.messageSent(a,c,f)};return{init:function(a){$.extend(b,a)},
addBox:function(g,h,m){m=c.indexOf(g);var n=d.indexOf(g);-1!=m?console.log("Do nothing"):-1!=n?($("#"+g).chatbox("option","offset",285+(b.width+b.gap)*c.length),$("#"+g).chatbox("option","boxManager").toggleBox(),c.push(g),m=$("#tabs li").index($("#tabcb"+g)),$($(".tabs li")[m]).css("display","list-item"),$("#tabs").tabs("option","active",m),$("#tabs").tabs("show")):(void 0==h.last_name&&(h.last_name=""),m=document.createElement("div"),m.setAttribute("id",g),$(m).chatbox({id:g,user:h,title:h.first_name+
" "+h.last_name,hidden:!1,width:b.width,offset:285+(b.width+b.gap)*c.length,messageSent:f,boxClosed:a}),d.push(g),c.push(g));"support"==h.class?0==$("#cb"+g+".support").length&&$("#cb"+g).addClass("support").removeClass("privateChat"):"privateChat"==h.class&&0==$("#cb"+g+".privateChat").length&&$("#cb"+g).addClass("privateChat").removeClass("support");virtualclass.chat.vmstorage.hasOwnProperty(g)&&(virtualclass.chat.vmstorage[g][0].box="opened")},delBox:function(a){c=$.grep(c,function(b){return a!=
b});d=$.grep(d,function(b){return a!=b})},dispatch:function(a,b){$("#"+a.userid).chatbox("option","boxManager").addMsg(a.name,b)}}}();var myChatBoxOpen=!1,chatResults=[],myDivResult="",checkChatDisabled=!1;
function displayChatUserList(d){for(var c=0;c<d.length;c++)null==document.getElementById("video"+d[c].userid)&&(myDivResult=$("#chat_div").memberlist("option").userSent(d[c])),"undefined"==typeof chat_div&&(chat_div=document.querySelector("#chat_div")),"boolean"!=typeof myDivResult&&(""==chat_div.innerHTML?chat_div.innerHTML=myDivResult:chat_div.insertAdjacentHTML("beforeend",myDivResult),myDivResult="",virtualclass.gObj.uid!=d[c].userid&&virtualclass.gObj.uid==virtualclass.vutil.whoIsTeacher()&&
virtualclass.user.initControlHandler(d[c].userid))}
function displayChatOfflineUserList(d){alert("display chat offline user");var c=document.querySelector("#melistcontainer");null==c&&(c=document.createDocumentFragment("div"),c.id="melistcontainer");for(var b=0;b<d.length;b++)virtualclass.vutil.alreadyConnected(d[b].userid)||d[b].userid==virtualclass.gObj.uid||null!=document.getElementById("video"+d[b].userid)||(myDivResult=$("#chat_div").memberlist("option").userSent(d[b]),virtualclass.gObj.video.addUserRole(myDivResult,d[b].role),c.appendChild(myDivResult));
console.log("display offline user");document.querySelector("#chat_div").appendChild(c)}
function updateOnlineUserText(){if(roles.hasAdmin())if(0<virtualclass.chat.userList.length){document.querySelector("#usertab_text").innerHTML="";var d=roles.hasAdmin()?"Users ("+virtualclass.connectedUsers.length+"/"+virtualclass.chat.userList.length+")":" Users ("+count+")",c=document.querySelector("#onlineusertext");null==c?document.querySelector("#usertab_text").innerHTML="<span id='onlineusertext' class='cgText'>"+d+"</span>":c.innerHTML=d}else"nothing"==virtualclass.chat.userList.nothing?document.querySelector("#user_list .inner_bt #usertab_text").innerHTML=
"<span class='cgText' id='onlineusertext'>Users ("+virtualclass.connectedUsers.length+")</span>":console.log("Chat list is not fetched yet.");else document.querySelector("#user_list .inner_bt #usertab_text").innerHTML="<span class='cgText' id='onlineusertext'>Users ("+virtualclass.connectedUsers.length+")</span>"}
function memberUpdate(d,c){if("removed"==c)c=document.querySelector("#ml"+d.removeUser),null!=c&&c.parentNode.removeChild(c),updateOnlineUserText();else{d=d.message;if(0<d.length){virtualclass.gObj.totalUser=[];for(var b=0;b<d.length;b++)virtualclass.gObj.totalUser.push(d[b].userid);virtualclass.gObj.totalUser.sort()}if(0<d.length){virtualclass.chat._showChatUserList(d);virtualclass.jId==virtualclass.gObj.uid&&(virtualclass.chat.openChatBox(),virtualclass.gObj.video.dispAllVideo("chat_div"),console.log("chat box is opened"));
document.createElement("div").id="tempCont";displayChatUserList(d);for(b=0;b<d.length;b++)if(d[b].userid==io.cfg.userid&&"undefined"!=typeof c&&"removed"!=c){var a=document.getElementById("video"+virtualclass.gObj.uid);virtualclass.gObj.hasOwnProperty("audIntDisable")||virtualclass.gObj.hasOwnProperty("vidIntDisable")||null!=a||(console.log("Media _handleUserMedia"),virtualclass.gObj.video._handleUserMedia(virtualclass.gObj.uid));a=document.getElementById("ml"+virtualclass.gObj.uid);null!=a&&a.classList.add("mySelf")}virtualclass.gObj.uid==
virtualclass.vutil.whoIsTeacher()&&virtualclass.raiseHand.moveUpInList()}else $("div#memlist").length&&$("div#memlist").remove();roles.hasAdmin()&&virtualclass.jId==virtualclass.gObj.uid?(virtualclass.chat.openChatBox(),"added"==c?virtualclass.chat.fetchChatUsers():virtualclass.chat.showChatListUsers(),virtualclass.chat.setChatDisplay()):virtualclass.jId==virtualclass.gObj.uid&&virtualclass.chat.setChatDisplay();c=document.querySelector("#memlist");null!=c&&null==document.querySelector("#chatroom_bt2.active")?
(c.classList.add("enable"),c.classList.remove("disable"),c=document.querySelector("#chatrm"),null!=c&&(c.classList.remove("enable"),c.classList.add("disable"))):(c.classList.remove("enable"),c.classList.add("disable"));c=document.querySelector("#virtualclassCont.congrea  .vmchat_bar_button");d=document.querySelector("#virtualclassCont.congrea #congreaUserSearch");b=document.querySelector("#virtualclassCont.congrea  #ta_chrm2");c.classList.contains("active")?(b&&(b.style.display="none"),d&&(d.style.display=
"block")):(b&&(b.style.display="block"),d&&(d.style.display="none"));updateOnlineUserText();virtualclass.connectedUsers.forEach(function(a){$("#ml"+a.userid).addClass("online").removeClass("offline")});c=document.querySelector("#chat_div .ui-memblist-usr.mySelf .videoSubWrapper video");null!=c&&c.play()}"display"==virtualclass.gObj.delayVid&&virtualclass.videoHost.setUserIcon(virtualclass.gObj.uid);virtualclass.gObj.delayVid=""}
function messageUpdate(d){var c=$.isPlainObject(d.message)?d.message.msg:d.message,b=d.toUser,a=d.fromUser,f=io.cfg.userid,g=(new Date).getTime();if("chatroom"==d.message.receiver&&(""==b||void 0==b))c={msg:c,time:d.message.time},virtualclass.chat.chatroombox||0!=$("ul#chat_room").length||(d=document.createElement("ul"),d.id="chat_room",document.body.appendChild(d),virtualclass.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:a,title:lang.chatroom_header,messageSent:function(a,b){$("#chat_room").chatroom("option",
"boxManager").addMsg(a.name,b)}})),$("#chat_room").chatroom("option").messageSent(a,c),d=localStorage.getItem("chatroom"),null!=d?(d=JSON.parse(d),c={userid:a.userid,name:a.name,msg:c,time:g},d.push(c),localStorage.setItem("chatroom",JSON.stringify(d))):(c={userid:a.userid,name:a.name,msg:c,time:g},localStorage.setItem("chatroom",JSON.stringify([c]))),virtualclass.chat.commonChat.push(c),0==$("#chatroom_bt2.active").length&&($("#chatroom_bt2").addClass("ui-state-highlight"),$("#chatrm").removeClass("enable"));
else if(void 0!=b&&""!=b){if(f==b.userid&&a.userid!=f){-1==$.inArray(a.userid,virtualclass.chat.idList)&&(virtualclass.chat.counter++,virtualclass.chat.idList.push(a.userid),virtualclass.chat.vmstorage.hasOwnProperty(a.userid)||(virtualclass.chat.vmstorage[a.userid]=[],virtualclass.chat.vmstorage[a.userid].push({userid:a.userid,name:a.name+" "+a.lname})));null==document.querySelector("#cb"+a.userid)&&(chatboxManager.addBox(a.userid,{dest:"dest"+virtualclass.chat.counter,title:"box"+virtualclass.chat.counter,
first_name:a.name,last_name:a.lname}),virtualclass.chat.vmstorage.hasOwnProperty(a.userid)&&1<virtualclass.chat.vmstorage[a.userid].length&&displayUserSinglePvtChatHistory(a.userid));chatboxManager.init({user:a,messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b.name,c)}});d=localStorage.getItem("chatEnable");null!=d&&"false"==d&&virtualclass.user.control.allChatDisable();$("#"+a.userid).chatbox("option").messageSent(a.userid,a,c);$("li[aria-controls='tabcb"+a.userid+"']").addClass("ui-state-highlight");
var h=a.userid}virtualclass.chat.vmstorage[h].push({userid:a.userid,name:a.name,msg:c,time:g})}}function statusUpdate(d,c,b){$("#"+d.userid).length&&($("#"+d.userid).chatbox("option").messageSent(d.userid,d,c),$("#ta"+d.userid).prop("disabled",b))}function common_chatbox_update(d,c){$("ul#chat_room").length&&$("#chat_room").chatroom("option").messageSent(d,c)}
function newStatus(d){$.each(d.message,function(c,b){null!=d.newuser&&b.userid==d.newuser&&(statusUpdate(b,"Online",!1),common_chatbox_update(b,"Online"))})}function createTab(d,c){var b=$("#tabs").tabs(),a=$("div#tabs ul li").length;tabId="tabcb"+d;addTab(b,tabId,a,c)}
function addTab(d,c,b,a){var f=$("#tab_content");b=a||"Tab "+b;c=$(("<li id = '"+c+"' class = 'ui-state-default ui-corner-bottom ui-tabs-active ui-state-active' aria-controls = '"+c+"'><a href = '#{href}' class = 'ui-tabs-anchor'>#{label}</a> <a href = '#' role = 'button'class = 'ui-corner-all ui-chatbox-icon'><span class = 'ui-icon icon-close'></span></a></li>").replace(/#\{href\}/g,"#"+c).replace(/#\{label\}/g,b));f.val();d.find(".ui-tabs-nav").append(c)}
function browserSupportsLocalStorage(){return"localStorage"in window&&null!=window.localStorage}
function displaycomChatHistory(){var d=localStorage.getItem("chatroom");if(null!=d){var c=document.createElement("ul");c.id="chat_room";document.body.appendChild(c);d=JSON.parse(d);virtualclass.chat.commonChat=d;$.each(d,function(b,a){1>b&&(virtualclass.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:a,title:"Common chat",messageSent:function(a,b){$("#chat_room").chatroom("option","boxManager").addMsg(a.name,b)}}));"object"==typeof a.msg?$("#chat_room").chatroom("option").messageSent(a,
a.msg):$("#chat_room").chatroom("option").messageSent(a,{msg:a.msg,time:a.time})})}"hidden"==localStorage.getItem("chatroom_status")&&$("#chatrm").hide()}
function displayPvtChatHistory(d){var c=!1;console.log(d);$.each(d,function(b,a){virtualclass.chat.counter++;virtualclass.chat.idList.push(b);$.each(a,function(a,d){1>a?(d.hasOwnProperty("box")&&(c=!0),c&&(b==virtualclass.chat.supportId&&(d.name="support"),chatboxManager.addBox(b,{dest:"dest"+virtualclass.chat.counter,title:"box"+virtualclass.chat.counter,first_name:d.name}),chatboxManager.init({messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b.name,c)}}))):c&&$("#"+b).chatbox("option").messageSent(b,
d,d.msg)});c=!1;b==virtualclass.chat.supportId&&(a=document.getElementById("cb"+virtualclass.chat.supportId))&&a.classList.add("support");"hidden"==localStorage.getItem(b)&&($("#cb"+b).hide(),$("#tabcb"+b).removeClass("ui-state-active"))})}function display_error(d){$("<div id = 'dialog' title = 'VmChat Error:'></div>").prependTo("#stickybar");$("#dialog").html(d);$("#dialog").dialog()}function clearAllChatBox(){$("#chatWidget .icon-close").trigger("click")}
function disCommonChatInput(){var d=document.getElementById("ta_chrm");null!=d&&(d.disabled=!0)}
function toggleCommonChatBox(){var d=$("#chatroom_bt2");"hidden"==localStorage.getItem("chatroom_status")?(localStorage.removeItem("chatroom_status"),d.attr("data-title",virtualclass.lang.getString("minCommonChat"))):(localStorage.setItem("chatroom_status","hidden"),d.attr("data-title",virtualclass.lang.getString("maxCommonChat")));d=document.getElementById("cc_arrow_button");null!=d&&(virtualclass.vutil.elemHasAnyClass("cc_arrow_button")?d.classList.contains("icon-arrow-up")?(d.classList.add("icon-arrow-down"),
d.classList.remove("icon-arrow-up")):(d.classList.add("icon-arrow-up"),d.classList.remove("icon-arrow-down")):d.className="icon-arrow-up");virtualclass.chat.chatroombox.chatroom("option","boxManager").toggleBox()}function sortUserList(d,c){return d.name<c.name?-1:d.name>c.name?1:0}function sortCommonChat(){var d=$("#chat_room");d.find(".ui-chatbox-msg").sort(function(c,b){return+c.dataset.msgtime-+b.dataset.msgtime}).appendTo(d)}
function displayUserSinglePvtChatHistory(d){$("#"+d+" .ui-chatbox-msg").remove();var c=virtualclass.chat.vmstorage[d];1<c.length&&$.each(c,function(b,a){0<b&&$("#"+d).chatbox("option").messageSent(d,a,a.msg)})};var lang={online:"Online users",whos:"Who's online",chatroom:"Chatroom",chatroom_header:"Common chat",error:"Something bad happend. Sorry!",wserror:"Browser does not support WebSocket",sterror:"This browser doesn't support Web Storage standard"};var precheck={currTest:"",init:function(){$("#myModal").modal({backdrop:"static",keyboard:!1});this.totalTest=["browser","bandWidth","webcam","speaker","mic"];this.currTest="browser";var d=document.querySelector("#virtualclassCont #preCheckcontainer");null!=d&&(d.style.display="block");d=document.querySelector("#virtualclassCont #virtualclassApp");null!=d&&(d.style.display="none");this.wholeSytemCheck();(d=document.querySelector("#preCheckcontainer .skip"))&&d.addEventListener("click",function(){if(localStorage.getItem("precheck")){var c=
document.getElementById("preCheckcontainer");c.style.display="none";c=document.getElementById("virtualclassApp");c.style.display="block";virtualclass.videoHost._resetPrecheck()}else virtualclass.popup.waitMsg(),virtualclass.makeReadySocket(),c=document.getElementById("preCheckcontainer"),c.style.display="none",c=document.getElementById("preCheckcontainer"),c.style.display="none",c=document.getElementById("virtualclassApp"),c.style.display="block",localStorage.setItem("precheck",!0),virtualclass.videoHost.afterSessionJoin();
if(c=document.getElementById("vcSpeakerCheckAudio"))c.pause(),c.currentTime=0;virtualclass.gObj.precheckScrn=!1})},cancelRequestAnimation:function(){virtualclass.precheck.hasOwnProperty("reqAnimationFrame")&&cancelAnimationFrame(virtualclass.precheck.reqAnimationFrame)},wholeSytemCheck:function(){this[this.totalTest[0]].perform()},_next:function(d,c){virtualclass.precheck.cancelRequestAnimation();var b=this[d].next;virtualclass.precheck.currTest=b;virtualclass.precheck.updateProgressBar(b);!this[b].hasOwnProperty("alreadyDone")||
this[b].hasOwnProperty("alreadyDone")&&"bandwidth"==b?this[b].perform():(virtualclass.precheck.display("#preCheckcontainer .precheck."+b),"speaker"==b?this[b]._play():"mic"==b&&this[b].visualize());virtualclass.precheck.hide("#preCheckcontainer .precheck."+d);"undefined"!=typeof c&&c();this[b].alreadyDone=!0},_prev:function(d,c){virtualclass.precheck.cancelRequestAnimation();var b=this[d].prev;virtualclass.precheck.hide("#preCheckcontainer .precheck."+d);virtualclass.precheck.display("#preCheckcontainer .precheck."+
b);document.querySelector("#preCheckcontainer  #preCheckProgress ."+d).classList.remove("active","current");document.querySelector("#preCheckcontainer  #preCheckProgress ."+b).classList.add("current");"speaker"==b?this[b]._play():"mic"==b&&this[b].visualize();"undefined"!=typeof c&&c()},display:function(d){document.querySelector(d).style.display="block"},hide:function(d){document.querySelector(d).style.display="none"},createMessage:function(d,c,b){var a=document.createElement("div");a.className=b;
a.innerHTML=c;document.querySelector(d).appendChild(a)},initHandler:function(d,c,b){d=document.querySelector(d);null!=d&&d.addEventListener("click",function(){this.classList.contains("next")?virtualclass.precheck._next(c):this.classList.contains("prev")&&virtualclass.precheck._prev(c);"undefined"!=typeof b&&b()})},browser:{curr:"browser",next:"bandwidth",perform:function(){virtualclass.precheck.display("#preCheckcontainer .precheck."+this.curr);if(0<virtualclass.error.length){var d=1<virtualclass.error.length?
virtualclass.error.join("<br />"):virtualclass.error[0];virtualclass.precheck.createMessage("#preCheckcontainer .precheck .result",d,"error")}d=virtualclass.lang.getString("congreainchrome");virtualclass.precheck.createMessage("#preCheckcontainer .precheck .result",d,"information");virtualclass.precheck.initHandler("#preCheckcontainer .precheck #"+this.curr+"Buttons .next",this.curr)}},bandwidth:{prev:"browser",curr:"bandwidth",next:"speaker",perform:function(){virtualclass.precheck.display("#preCheckcontainer .precheck."+
this.curr);var d=this,c="#preCheckcontainer .precheck."+this.curr+" .result";this.imageAddr="https://dl.congrea.com/bandwidth.jpg";this.downloadSize=1E6;d=this;this.measureConnectionSpeed(function(b){document.querySelector(c).innerHTML="";b=d.bandWidthInWords(b);c.innerHTML="";b=virtualclass.lang.getString(b+"BandWidthSpeed");virtualclass.precheck.createMessage(c,b,"information");virtualclass.precheck.initHandler("#preCheckcontainer .precheck #"+d.curr+"Buttons .prev",d.curr);virtualclass.precheck.initHandler("#preCheckcontainer .precheck #"+
d.curr+"Buttons .next",d.curr)})},bandWidthInWords:function(d){console.log("bandwidth speed "+d);600<d?(d="high",virtualclass.videoHost.gObj.MYSPEED=1):400<d?(d="medium",virtualclass.videoHost.gObj.MYSPEED=2):(virtualclass.videoHost.gObj.MYSPEED=3,d="low");ioAdapter.sendSpeed(virtualclass.videoHost.gObj.MYSPEED);return d},measureConnectionSpeed:function(d){var c=new Image,b=this;c.onload=function(){b.endTime=(new Date).getTime();var a=b.calculateSpeed();d(a)};c.onerror=function(a,b){ShowProgressMessage("Invalid image, or error downloading")};
this.startTime=(new Date).getTime();c.src=this.imageAddr+("?nnn="+this.startTime)},calculateSpeed:function(){var d=((8*this.downloadSize/((this.endTime-this.startTime)/1E3)).toFixed(2)/1024).toFixed(2);return Math.round(d)}},speaker:{prev:"bandwidth",curr:"speaker",next:"mic",perform:function(){var d=document.createElement("div");d.innerHTML=virtualclass.lang.getString("speakerTest");document.querySelector("#preCheckcontainer .precheck."+this.curr+" .result").appendChild(d);this._play()},_play:function(){virtualclass.precheck.display("#preCheckcontainer .precheck."+
this.curr);var d=document.getElementById("vcSpeakerCheckAudio");d.loop=!0;d.play();virtualclass.precheck.initHandler("#preCheckcontainer .precheck #"+this.curr+"Buttons .prev",this.curr,function(){d.pause();d.currentTime=0});virtualclass.precheck.initHandler("#preCheckcontainer .precheck #"+this.curr+"Buttons .next",this.curr,function(){d.pause();d.currentTime=0});virtualclass.precheck.cancelRequestAnimation()}},mic:{prev:"speaker",curr:"mic",next:"webcam",perform:function(){virtualclass.precheck.display("#preCheckcontainer .precheck."+
this.curr);this.visualize();var d="#preCheckcontainer .precheck."+this.curr,c=document.createElement("div");c.innerHTML=virtualclass.lang.getString("mictesting");document.querySelector(d+" .result").appendChild(c)},visualize:function(){function d(){virtualclass.precheck.reqAnimationFrame=requestAnimationFrame(d);virtualclass.gObj.video.audioVisual.analyser.getByteFrequencyData(f);b.fillStyle="rgb(0, 0, 0)";b.fillRect(0,0,WIDTH,HEIGHT+100);for(var c,h=0,m=0;m<a;m++)c=f[m],b.fillStyle="rgb(0, 128, 0)",
b.fillRect(h,c,100,c),h=1}var c=document.querySelector(".visualizer"),b=c.getContext("2d");c.setAttribute("width",60);c.setAttribute("height",200);WIDTH=c.width;HEIGHT=c.height;virtualclass.gObj.video.audioVisual.analyser.fftSize=256;var a=virtualclass.gObj.video.audioVisual.analyser.frequencyBinCount;console.log(a);var f=new Uint8Array(a);b.clearRect(0,0,WIDTH,HEIGHT);d();document.getElementById("audioVisualaizer").style.transform="rotate(-90deg)";virtualclass.precheck.initHandler("#preCheckcontainer .precheck #"+
this.curr+"Buttons .prev",this.curr);virtualclass.precheck.initHandler("#preCheckcontainer .precheck #"+this.curr+"Buttons .next",this.curr)}},webcam:{test:{1:"noWebCam",2:"nopermission",3:"webcambuys"},prev:"mic",curr:"webcam",perform:function(){var d="#preCheckcontainer .precheck."+this.curr,c=document.createElement("div");if(virtualclass.system.mediaDevices.hasWebcam)if(0<virtualclass.system.mediaDevices.webcamErr.length){var b=virtualclass.system.mediaDevices.webcamErr[virtualclass.system.mediaDevices.webcamErr.length-
1];if("PermissionDeniedError"==b||"SecurityError"==b||"nopermission"==b)b+="Ext","Firefox"==virtualclass.system.mybrowser.name&&(b+="FF");b=virtualclass.lang.getString(b);var a=c.className+" error"}else a=c.className+" general",c=document.createElement("div"),b=virtualclass.lang.getString("webcamerainfo");else a=c.className+" error",b=virtualclass.lang.getString("nowebcam");c.className=a;c.innerHTML=b;document.querySelector(d+" .result").appendChild(c);virtualclass.precheck.display(d);c.classList.contains("error")?
document.getElementById("webcamTempVideo").className="novideo":this.createVideo();virtualclass.precheck.initHandler("#preCheckcontainer .precheck #joinSession .prev",this.curr);d=document.querySelector("#joinSession .next");null!=d&&d.addEventListener("click",function(){virtualclass.popup.waitMsg();virtualclass.makeReadySocket();var a=document.getElementById("preCheckcontainer");a.style.display="none";a=document.getElementById("preCheckcontainer");a.style.display="none";document.getElementById("virtualclassApp").style.display=
"block";localStorage.setItem("precheck",!0);virtualclass.videoHost.afterSessionJoin()})},createVideo:function(){var d=document.getElementById("webcamTempVideo");d.width=320;d.height=240;"undefined"!=typeof cthis.video.tempStream&&(virtualclass.adpt.attachMediaStream(d,cthis.video.tempStream),d.muted=!0,null!=document.getElementById("webcamTempVideo")&&d.play())}},startSession:function(){document.getElementById("virtualclassApp").style.display="block";var d=document.getElementById("virtualclassPreCheck");
null!=d&&d.parentNode.removeChild(d)},updateProgressBar:function(d){document.querySelector("#progressbarScreen ."+d);for(var c=document.querySelectorAll("#preCheckProgress .progressbar li"),b=0;b<c.length;b++)if(c[b].classList.add("active"),c[b].classList.contains(d)){0<b&&c[b-1].classList.remove("current");c[b].classList.add("current");break}}};eval(function(d,c,b,a,f,g){f=function(a){return(a<c?"":f(parseInt(a/c)))+(35<(a%=c)?String.fromCharCode(a+29):a.toString(36))};if(!"".replace(/^/,String)){for(;b--;)g[f(b)]=a[b]||f(b);a=[function(a){return g[a]}];f=function(){return"\\w+"};b=1}for(;b--;)a[b]&&(d=d.replace(new RegExp("\\b"+f(b)+"\\b","g"),a[b]));return d}('(v(){o d="H+/";o e=I J(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,K,-1,-1,-1,L,M,N,O,P,Q,R,S,T,U,w,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,V,W,X,Y,Z,1a,-1,-1,-1,-1,-1,-1,1b,1c,1d,1e,1f,1g,1h,1i,1j,1k,1l,1m,1n,1o,1p,1q,1r,1s,1t,1u,1v,1w,1x,1y,1z,1A,-1,-1,-1,-1,-1);v A(a){o b,i,g;o c,h,f;g=a.B;i=0;b="";p(i<g){c=a.n(i++)&r;j(i==g){b+=d.k(c>>2);b+=d.k((c&x)<<4);b+="==";q}h=a.n(i++);j(i==g){b+=d.k(c>>2);b+=d.k(((c&x)<<4)|((h&C)>>4));b+=d.k((h&D)<<2);b+="=";q}f=a.n(i++);b+=d.k(c>>2);b+=d.k(((c&x)<<4)|((h&C)>>4));b+=d.k(((h&D)<<2)|((f&1B)>>6));b+=d.k(f&1C)}s b}v E(a){o b,h,f,l;o i,g,m;g=a.B;i=0;m="";p(i<g){t{b=e[a.n(i++)&r]}p(i<g&&b==-1);j(b==-1)q;t{h=e[a.n(i++)&r]}p(i<g&&h==-1);j(h==-1)q;m+=y.z((b<<2)|((h&1D)>>4));t{f=a.n(i++)&r;j(f==w)s m;f=e[f]}p(i<g&&f==-1);j(f==-1)q;m+=y.z(((h&1E)<<4)|((f&1F)>>2));t{l=a.n(i++)&r;j(l==w)s m;l=e[l]}p(i<g&&l==-1);j(l==-1)q;m+=y.z(((f&1G)<<6)|l)}s m}j(!u.F)u.F=A;j(!u.G)u.G=E})();',
62,105,"               c3 len c2  if charAt c4 out charCodeAt var while break 0xff return do window function 61 0x3 String fromCharCode base64encode length 0xF0 0xF base64decode btoa atob ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 new Array 62 63 52 53 54 55 56 57 58 59 60 20 21 22 23 24           25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 0xC0 0x3F 0x30 0XF 0x3C 0x03".split(" "),0,{}));function createRequestObject(){return"Microsoft Internet Explorer"==navigator.appName?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}var http=createRequestObject();function convertResponseBodyToText(d){for(var c={},b=0;256>b;b++)for(var a=0;256>a;a++)c[String.fromCharCode(b+256*a)]=String.fromCharCode(b)+String.fromCharCode(a);b=IEBinaryToArray_ByteStr(d);d=IEBinaryToArray_ByteStr_Last(d);return b.replace(/[\s\S]/g,function(a){return c[a]})+d}var IEBinaryToArray_ByteStr_Script="\x3c!-- IEBinaryToArray_ByteStr --\x3e\r\n<script type='text/vbscript'>\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n\tIEBinaryToArray_ByteStr = CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n\tDim lastIndex\r\n\tlastIndex = LenB(Binary)\r\n\tif lastIndex mod 2 Then\r\n\t\tIEBinaryToArray_ByteStr_Last = Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n\tElse\r\n\t\tIEBinaryToArray_ByteStr_Last = \"\"\r\n\tEnd If\r\nEnd Function\r\n\x3c/script>\r\n";
document.write(IEBinaryToArray_ByteStr_Script);
function loadfile2(d,c){"undefined"===typeof c&&(c="dec");"dec"===c?(http.open("get","http://localhost/google-webp/1.webp"),http.overrideMimeType?http.overrideMimeType("text/plain; charset=x-user-defined"):http.setRequestHeader("Accept-Charset","x-user-defined"),http.onreadystatechange=function(){if(4==http.readyState){var b="undefined"==typeof http.responseBody?http.responseText.split("").map(function(a){return String.fromCharCode(a.charCodeAt(0)&255)}).join(""):convertResponseBodyToText(http.responseBody);
"dec"===c&&WebPDecodeAndDraw(b)}},http.send(null)):"enc"===c&&ImageToCanvas("/images-enc/"+d)}
function loadfile(d,c,b){"undefined"===typeof type&&(type="dec");if("dec"===type){var a=new Image;a.src=d;http.open("get",a.src);http.overrideMimeType?http.overrideMimeType("text/plain; charset=x-user-defined"):http.setRequestHeader("Accept-Charset","x-user-defined");http.onreadystatechange=function(){if(4==http.readyState){var a="undefined"==typeof http.responseBody?http.responseText.split("").map(function(a){return String.fromCharCode(a.charCodeAt(0)&255)}).join(""):convertResponseBodyToText(http.responseBody);
"dec"===type&&WebPDecodeAndDraw(a,c,b)}};http.send(null)}else"enc"===type&&ImageToCanvas("/images-enc/"+filename)};function WebPDecDemo(d){function c(d,n,r,A,z,t,v,q,w,p,B,G,H){h=setTimeout(function(){t=t+z>A.length?A.length-z:t;memcpy(v,0,A,z,t);status=d.WebPIAppend(n,v,t);var m=p=d.WebPIDecGetRGB(n,r.last_y,r.width,r.height,r.stride);if(r.biHeight.value!=r.height.value||r.biWidth.value!=r.width.value){r.biHeight.value=r.height.value;r.biWidth.value=r.width.value;var J=r.biWidth.value;b.height=r.biHeight.value;b.width=J;a=b.getContext("2d");g=a.createImageData(b.width,b.height);f=g.data}if(m&&r.last_y.value!=
r.last_y_cache.value){J=r.biWidth.value;for(var D=r.last_y_cache.value;D<r.last_y.value;D++)for(var I=0;I<J;I++)f[4*I+4*J*D]=m[3*I+3*J*D],f[1+4*I+4*J*D]=m[1+3*I+3*J*D],f[2+4*I+4*J*D]=m[2+3*I+3*J*D],f[3+4*I+4*J*D]=255;a.putImageData(g,0,0);r.last_y_cache.value=r.last_y.value}z+=t;5==status&&h&&c(d,n,r,A,z,t,v,q,w,p,B,G,H);0==status&&(decSpeedResult.innerHTML="Speed result:<br />libwebpjs (Incremental decoding): finish in "+(new Date-G)+"ms")},H)}var b=document.getElementById(d),a=b.getContext("2d"),
f=null,g=null,h=null;document.createElement("img");WebPDecodeAndDraw=function(a,b,c){window.Worker&&webpToPng.postMessage({vdata:a,canid:b.id});window.Worker&&(webpToPng.onmessage=function(a){var b=document.querySelector("#"+a.data.canid),c=b.getContext("2d"),f=c.createImageData(b.width,b.height);b.height=a.data.bh;b.width=a.data.bw;f.data.set(a.data.vdata);c.putImageData(f,0,0);virtualclass.gObj.isReadyForVideo=!0;console.log("Total length "+a.data.tl)})};WebPIDecodeAndDraw=function(a){clearTimeout(h);
if(!isNaN(parseInt(IncrementalDecBufferSizeBtn.value))&&!isNaN(parseInt(IncrementalDecSleepBtn.value))){a=convertBinaryToArray(a);var b=parseInt(IncrementalDecBufferSizeBtn.value),f=Arr(b-1,0),d=parseInt(IncrementalDecSleepBtn.value),g=new WebPDecoder,m=g.WebPINew("MODE_RGB");c(g,m,{last_y:{value:null},last_y_cache:{value:null},width:{value:0},height:{value:0},biWidth:{value:0},biHeight:{value:0},stride:{value:0}},a,0,b,f,0,0,null,null,new Date,d);g.WebPIDelete(m);finishDecoding()}}};var BASE64_MARKER=";base64,",videoHost={gObj:{},setDefaultValue:function(d){virtualclass.videoHost.gObj.MYSPEED=d||1;virtualclass.videoHost.gObj.teacherVideoQuality=this.getTeacherVideoQuality()},init:function(d,c){this.sl=0;this.width=d;this.height=c;this.gObj.videoSwitch=1;this.allStdVideoOff=this.domReady=this.gObj.stdStopSmallVid=!1;roles.hasAdmin()?(this._init(),d=document.createElement("canvas"),d.id="dummyCanvas",d.width=40,d.height=40,document.querySelector("#virtualclassApp").appendChild(d),
WebPDecDemo("dummyCanvas"),this.domReady=!0):(this.setCanvasAttr("videoPartCan","videoParticipate"),WebPDecDemo("videoParticipate"),virtualclass.videoHost.UI.hideVideo());d=document.querySelector("#virtualclassAppRightPanel");if(null!=d)if(c=localStorage.getItem("tvideo"),null==c&&(c="show"),d.classList.add(c),roles.hasControls())(d=localStorage.getItem("videoSwitch"))&&"0"==d&&(virtualclass.connectedUsers&&virtualclass.connectedUsers.length?virtualclass.videoHost.setUserIcon(virtualclass.gObj.uid):
virtualclass.gObj.delayVid="display",virtualclass.videoHost.UI.hideVideo());else{if(d=JSON.parse(localStorage.getItem("stdVideoSwitch")))virtualclass.connectedUsers&&virtualclass.connectedUsers.length?virtualclass.videoHost.setUserIcon(virtualclass.gObj.uid):virtualclass.gObj.delayVid="display",virtualclass.videoHost.UI.hideVideo();console.log(d)}},renderSelfVideo:function(d){"undefined"==typeof virtualclass.gObj.video.tempStream&&(console.log("Media attached stream"),this.getMediaStream(d))},isDomReady:function(d){var c=
this;this.domReady?(null!=this.domreadyCheck&&clearTimeout(this.domreadyCheck),d()):this.domreadyCheck=setTimeout(function(){c.isDomReady(d)},1E3)},_init:function(){this.setCanvasAttr("vidHost","videoHost");this.setCanvasAttr("vidHostSlice","videoHostSlice");this.vidHostSlice.globalAlpha=.5;this.vidHostSlice.globalCompositeOperation="multiply"},videoHandler:function(d){if(d.classList.contains("on")){d.classList.remove("on");d.classList.add("off");virtualclass.videoHost.gObj.videoSwitch=0;d="off";
var c=document.querySelector(".videoSwitchCont");c.dataset.title="turn video on"}else d.classList.remove("off"),d.classList.add("on"),virtualclass.videoHost.gObj.videoSwitch=1,d="on",c=document.querySelector(".videoSwitchCont"),c.dataset.title="turn video off";ioAdapter.mustSend({congCtr:{videoSwitch:d},cf:"congController"})},onmessage:function(d){console.log(d);"on"==d.congCtr.videoSwitch?(virtualclass.videoHost.gObj.videoSwitch=1,this.UI.displayVideo(),localStorage.tvideo="show"):"off"==d.congCtr.videoSwitch&&
(virtualclass.videoHost.gObj.videoSwitch=0,this.UI.hideVideo(),localStorage.tvideo="hide")},stdVideoCtrlMsg:function(d){var c=d.fromUser.userid;d.message.stdVideoCtr.videoSwitch?this.setUserIcon(c):this.removeUserIcon(c)},toggleVideoMsg:function(d){var c=document.querySelector("#congCtrBar");"enable"==d?(c.style.pointerEvents="visible",c.style.opacity="1",virtualclass.videoHost.gObj.allStdVideoOff=!1):(c.style.pointerEvents="none",c.style.opacity="0.5",virtualclass.videoHost.gObj.allStdVideoOff=!0)},
toggleStdVideoIcon:function(d){var c=document.querySelector(".congrea .videoSwitchCont"),b=document.querySelector(".congrea #rightCtlr #videoSwitch");"enable"==d?(b.setAttribute("data-action","disable"),b.className="video on",c.setAttribute("data-title","Video off")):(b.setAttribute("data-action","enable"),b.className="video off",c.setAttribute("data-title","Video On"))},setUserIcon:function(d){var c=document.querySelector("#ml"+d+" .user-details a .videoWrapper");c&&c.parentNode.removeChild(c);c=
document.querySelector("#ml"+d+" .user-details a");document.querySelector("#ml"+d+" .user-details a img")||(d=document.createElement("img"),d.classList.add("media-object"),d.setAttribute("src",whiteboardPath+"images/quality-support.png"),c.appendChild(d),console.log("set User icon"))},removeUserIcon:function(d){console.log("Remove User icon");virtualclass.gObj.uid==d&&(d=cthis.video.createVideoElement(),virtualclass.gObj.video.util.imageReplaceWithVideo(virtualclass.gObj.uid,d),document.querySelector("#virtualclassCont #chat_div #ml"+
virtualclass.gObj.uid+" #tempVideo")||(cthis.video.insertTempVideo(d),cthis.video.tempVideoInit()),cthis.video.myVideo=document.getElementById("video"+virtualclass.gObj.uid),virtualclass.adpt.attachMediaStream(cthis.video.myVideo,cthis.video.tempStream))},fromLocalStorage:function(){var d="";if(roles.hasControls())d=localStorage.getItem("videoSwitch"),localStorage.removeItem("videoSwitch");else{var c=JSON.parse(localStorage.getItem("stdVideoSwitch"));localStorage.removeItem("stdVideoSwitch");var b=
JSON.parse(localStorage.getItem("allStdVideoOff"));virtualclass.videoHost.gObj.allStdVideoOff=b;localStorage.removeItem("stdVideoSwitch")}if("undefined"!=typeof d&&d)if(virtualclass.videoHost.gObj.videoSwitch=+d,roles.hasControls()){if(b=document.getElementById("videoSwitch"))+d?b.classList.contains("off")&&(b.classList.add("on"),b.classList.remove("off")):b.classList.contains("on")&&(b.classList.add("off"),b.classList.remove("on"))}else virtualclass.gObj.meetingMode||(+d?virtualclass.videoHost.UI.displayVideo():
virtualclass.videoHost.UI.hideVideo());roles.hasControls()||("undefined"!=typeof c&&c&&((virtualclass.videoHost.gObj.stdStopSmallVid=c)?virtualclass.videoHost.toggleStdVideoIcon("disable"):virtualclass.videoHost.toggleStdVideoIcon("enable")),virtualclass.videoHost.gObj.allStdVideoOff||!virtualclass.system.mediaDevices.hasWebcam?virtualclass.videoHost.toggleVideoMsg("disable"):virtualclass.videoHost.toggleVideoMsg("enable"))},setCanvasAttr:function(d,c){this[d]=document.getElementById(c);this[d].width=
this.width;this[d].height=this.height;this[d+"Con"]=this[d].getContext("2d")},getMediaStream:function(d){this.videoHostSrc=document.getElementById("videoHostSource");this.videoHostSrc.width=this.width;this.videoHostSrc.height=this.height;virtualclass.adpt.attachMediaStream(this.videoHostSrc,d);var c=this;setTimeout(function(){c.shareVideo()},2E3)},shareVideo:function(){this.imageSlices=this.getImageSlices(1,1);var d=this;setInterval(function(){d.gObj.videoSwitch&&io.webSocketConnected()&&virtualclass.system.mediaDevices.hasWebcam&&
d._shareVideo(d,1,1)},120)},_shareVideo:function(d,c,b){for(d.sl=0;d.sl<c*b;d.sl++){d.vidHostCon.drawImage(d.videoHostSrc,0,0,d.width,d.height);var a=d.imageSlices[d.sl],f=d.vidHostCon.getImageData(a.x,a.y,a.w,a.h);d.vidHostSliceCon.putImageData(f,a.x,a.y)}d.sl==c*b&&(virtualclass.system.webpSupport?(c=d.vidHostSlice.toDataURL("image/webp",.6),b=1):(c=d.vidHostSlice.toDataURL("image/jpeg",.3),b=0),d.vidHostSliceCon.clearRect(0,0,d.width,d.height),d.sendInBinary(c,b))},sendInBinary:function(d,c){d=
this.convertDataURIToBinary(d);c=new Int8Array([21,c]);var b=new Int8Array(d.length+c.length);b.set(c);b.set(d,c.length);ioAdapter.sendBinary(b)},convertDataURIToBinary:function(d){var c=d.indexOf(BASE64_MARKER)+BASE64_MARKER.length;d=d.substring(c);d=window.atob(d);c=d.length;var b=new Uint8Array(new ArrayBuffer(c));for(i=0;i<c;i++)b[i]=d.charCodeAt(i);return b},drawReceivedImage:function(d,c,b){"undefined"==typeof vid0eoPartCont&&(this.videoPartCan=document.getElementById("videoParticipate"),this.videoPartCont=
this.videoPartCan.getContext("2d"),videoPartCont=!0);var a=this;"undefined"!=typeof virtualclass.gObj.video.audio.Html5Audio?sampleRate=virtualclass.gObj.video.audio.Html5Audio.audioContext.sampleRate:"undefined"==typeof sampleRate&&(sampleRate=(new (window.AudioContext||window.webkitAudioContext)).sampleRate);virtualclass.gObj.isReadyForVideo&&document.querySelector("#virtualclassCont.congrea #videoHostContainer.hide")&&virtualclass.videoHost.UI.displayVideo();setTimeout(function(){if(virtualclass.isPlayMode||
3>virtualclass.videoHost.gObj.MYSPEED)if(virtualclass.system.webpSupport||"jpeg"==c){var f=new Image;f.onload=function(){a.videoPartCont.drawImage(f,b.x,b.y)};f.src=d}else virtualclass.gObj.isReadyForVideo&&(virtualclass.gObj.isReadyForVideo=!1,loadfile(d,a.videoPartCan,a.videoPartCont))},myVideoDelay=16382/sampleRate*3E3)},onError:function(d){console.log("MediaStream Error "+d)},getImageSlices:function(d,c){for(var b=[],a=d*c,f=Math.floor(this.vidHost.width/c),g=Math.floor(this.vidHost.height/d),
h=0;h<a;h++){var m=this._getSingleSliceImg(h,f,g,d,c);b.push(m)}return b},_getSingleSliceImg:function(d,c,b,a,f){0==d?f=d=0:(a=Math.floor(d/f),d=d%f*c,f=a*b);return{x:d,y:f,w:c,h:b}},Uint8ToString:function(d){for(var c=[],b=0;b<d.length;b+=32768)c.push(String.fromCharCode.apply(null,d.subarray(b,b+32768)));return c.join("")},getTeacherVideoQuality:function(){virtualclass.videoHost.gObj.teacherVideoQuality=16;var d=document.querySelector("#virtualclassCont.teacher #videoHostSource");null!=d&&""==d.src&&
(virtualclass.videoHost.gObj.teacherVideoQuality=0);return virtualclass.videoHost.gObj.teacherVideoQuality},afterSessionJoin:function(){var d=roles.hasAdmin()?1:virtualclass.videoHost.gObj.MYSPEED;this.setDefaultValue(d);virtualclass.network.initToPing(1E4);this.fromLocalStorage();this.resetPrecheck()},resetPrecheck:function(){this._resetPrecheck();var d=document.querySelector("#joinSession .next");if(null!=d){var c=document.createElement("button");d.parentNode.appendChild(c);d.parentNode.removeChild(d);
c.classList.add("precheckComplete","btn","btn-default");c.innerHTML=virtualclass.lang.getString("prechkcmplt")}document.querySelector("#joinSession .precheckComplete").addEventListener("click",function(){document.getElementById("preCheckcontainer").style.display="none";document.getElementById("virtualclassApp").style.display="block";virtualclass.videoHost._resetPrecheck()});(d=document.querySelector("#preCheckcontainer .skip"))&&d.addEventListener("click",function(){document.getElementById("preCheckcontainer").style.display=
"none";document.getElementById("virtualclassApp").style.display="block";virtualclass.videoHost._resetPrecheck()})},_resetPrecheck:function(){for(var d=document.querySelectorAll("#congProgressbar .active"),c=0;c<d.length;c++)0<c&&d[c].classList.remove("active");0<d.length&&(d=document.querySelectorAll("#myModal .precheck"),[].slice.call(d,0).forEach(function(b){b.style.display="none"}),(d=document.querySelector("#vcBrowserCheck .information"))&&d.parentNode.removeChild(d),virtualclass.precheck.totalTest&&
virtualclass.precheck.totalTest.forEach(function(b){b.hasOwnProperty("alreadyDone")&&b.removeAttribute("alreayDone")}))},UI:{displayVideo:function(d){"small"!=d&&(d=document.querySelector(".congrea #videoHostContainer"),d.classList.add("show"),d.classList.remove("hide"),d=document.querySelector(".congrea #virtualclassAppRightPanel"),d.classList.add("vidShow"),d.classList.remove("vidHide"))},hideVideo:function(d){"small"!=d&&(d=document.querySelector(".congrea #videoHostContainer"),d.classList.remove("show"),
d.classList.add("hide"),d=document.querySelector(".congrea #virtualclassAppRightPanel"),d.classList.add("vidHide"),d.classList.remove("vidShow"))}}};(function(d){var c=function(){return{coursePoll:[],sitePoll:[],setting:{showResult:!0,timer:!0,time:{digit:"2",unit:"minut"}},uid:0,currQid:0,currOption:{},dataToStd:{},count:{},save:0,newUserTime:{},list:[],listPoll:{},currResultView:"bar",tStamp:[],pollState:{},exportfilepath:d.exportfilepath,uniqueUsers:[],init:function(){this.pollState={};virtualclass.previrtualclass="virtualclassPoll";virtualclass.previous="virtualclassPoll";this.cmid=getUrlVars(exportfilepath).cmid;this.timer&&clearInterval(this.timer);
!roles.hasAdmin()||roles.isEducator()?roles.isStudent()?this.UI.defaultLayoutForStudent():(this.UI.container(),roles.hasControls()?ioAdapter.mustSend({poll:{pollMsg:"init"},cf:"poll"}):this.UI.defaultLayoutForStudent()):(this.UI.container(),ioAdapter.mustSend({poll:{pollMsg:"init"},cf:"poll"}));var b=JSON.parse(localStorage.getItem("pollState")),a;if(a=b){a:{for(var c in b)if(b.hasOwnProperty(c)){a=!1;break a}a=!0}a=!a}a?(console.log("storeddata if block"),this.storedDataHandle(b)):roles.hasControls()&&
(console.log("fetchlist"),this.interfaceToFetchList(this.cmid));localStorage.removeItem("pollState")},interfaceToSave:function(b,a){var c=this;a=new FormData;a.append("dataToSave",JSON.stringify(b));a.append("user",virtualclass.gObj.uid);virtualclass.xhr.send(a,d.webapi+"&methodname=poll_save",function(a){a=JSON.parse(a);var b={},f={};a.options.forEach(function(a){f[a.optid]=a.options});a.copied?(a.options=f,b.questionid=a.qid,b.category=a.category,b.createdby=a.createdby,b.questiontext=a.question,
b.creatorname=a.creatorname,b.options=a.options,c.publishPoll(b),c.interfaceToFetchList(b.category)):c.updatePollList(a);c.currQid=a.qid;c.currOption=f})},interfaceToEdit:function(b){var a=this,c=new FormData;c.append("editdata",JSON.stringify(b));c.append("user",virtualclass.gObj.uid);virtualclass.xhr.send(c,d.webapi+"&methodname=poll_update",function(b){b=JSON.parse(b);console.log(b);a.updatePollList(b)})},updatePollList:function(b){var a={},c={};b.options.forEach(function(a){c[a.id]=a.options});
a.questionid=b.qid;a.category=b.category;a.createdby=b.createdby;a.questiontext=b.question;a.creatorname=b.creatorname;a.options=c;this.currQid=b.qid;this.currOption=c;(a.category?this.coursePoll:this.sitePoll).push(a);this.interfaceToFetchList(a.category)},interfaceToFetchList:function(b){var a=this,c=new FormData;c.append("category",JSON.stringify(b));c.append("user",virtualclass.gObj.uid);virtualclass.recorder.items=[];virtualclass.xhr.send(c,d.webapi+"&methodname=poll_data_retrieve",function(c){c=
JSON.parse(c);for(var f=0;f<=c.length-1;f++){var d=c[f].options;for(g in d)c[f].options[g]=d[g].options,console.log("getContent "+c[f])}console.log(c);var g=c.pop();b?(a.coursePoll=c,a.displaycoursePollList()):(a.sitePoll=c,a.displaysitePollList(g))})},interfaceToDelete:function(b){var a=this,c=new FormData;c.append("qid",JSON.stringify(b));c.append("user",virtualclass.gObj.uid);virtualclass.xhr.send(c,d.webapi+"&methodname=poll_delete",function(b){b=JSON.parse(b);a.interfaceToFetchList(b)})},interfaceToDelOption:function(b){var a=
new FormData;a.append("id",JSON.stringify(b));a.append("user",virtualclass.gObj.uid);virtualclass.xhr.send(a,d.webapi+"&methodname=poll_option_drop",function(a){})},interfaceToSaveResult:function(b){var a=this,c=new FormData;c.append("saveResult",JSON.stringify(b));c.append("user",virtualclass.gObj.uid);virtualclass.xhr.send(c,d.webapi+"&methodname=poll_result",function(b){b&&(b=JSON.parse(b),a.interfaceToFetchList(b))})},storedDataHandle:function(b){"displaycoursePollList"==b.currScreen?this.reloadPollList(b,
"course"):"displaysitePollList"==b.currScreen?this.reloadPollList(b,"site"):"stdPublish"==b.currScreen?this.reloadStdPublish(b):"teacherPublish"==b.currScreen?this.loadTeacherScrn(b):"voted"==b.currScreen?(this.reloadVotedScrn(b),setTimeout(function(){var a=document.querySelector("#virtualclassCont.congrea.student #navigator #pollResult");a&&(a.style.display="none")},700)):"stdPublishResult"==b.currScreen&&this.reloadStdResult(b);localStorage.removeItem("pollState")},reloadPollList:function(b,a){var c=
document.getElementById("coursePollTab"),d=document.getElementById("sitePollTab"),h=0;"course"==a?(d.classList.remove("active"),c.classList.add("active"),h=this.cmid):(c.classList.remove("active"),d.classList.add("active"));this.interfaceToFetchList(h);b.currScreen=="display"+a+"PollList"},reloadStdPublish:function(b){this.dataRec=b.data.stdPoll;this.dataRec.newTime=b.data.timer;this.stdPublish();b={stdPoll:this.dataRec,timer:this.newUserTime};this.pollState.currScreen="stdPublish";this.pollState.data=
b},reloadVotedScrn:function(b){this.dataRec=b.data.stdPoll;this.dataRec.newTime=b.data.timer;(b=document.getElementById("stdPollMszLayout"))&&b.parentNode.removeChild(b);b=this.dataRec.setting.showResult?virtualclass.lang.getString("votesuccess"):virtualclass.lang.getString("votesuccessPbt");this.showMsg("mszBoxPoll",b,"alert-success");b={stdPoll:this.dataRec,timer:this.newUserTime};this.pollState.currScreen="voted";this.pollState.data=b},reloadStdResult:function(b){var a=document.getElementById("mszBoxPoll");
a&&(a.style.display="none");if(this.dataRec=b.data.stdPoll)this.dataRec.newTime=b.data.timer;this.count=b.data.count;this.currResultView=b.data.view;this.stdPublishResult(this.count);"bar"==this.currResultView?this.updateBarGraph():"pi"==this.currResultView&&(this.createPiChart(),this.updatePiChart());b={stdPoll:this.dataRec,timer:this.newUserTime,count:this.count,view:this.currResultView};this.pollState.currScreen="stdPublishResult";this.pollState.data=b},loadTeacherScrn:function(b){console.log("currentscreenpublish");
this.dataToStd.question=b.data.question;this.dataToStd.options=b.data.options;this.dataToStd.qId=b.data.qId;this.setting=b.data.setting;this.nTimer=this.newTime=this.newUserTime=b.data.newTime;this.count=b.data.count;this.currResultView=b.data.view;this.uniqueUsers=b.data.users;var a=b.data.pollType,c=document.getElementById("coursePollTab"),d=document.getElementById("sitePollTab"),h=0;"course"==a?(d.classList.remove("active"),c.classList.add("active"),h=this.cmid):(c.classList.remove("active"),d.classList.add("active"));
this.interfaceToFetchList(h);"yes"!=b.pollClosed&&this.reloadTeacherPublish(b);this.list=b.data.list;a={question:this.dataToStd.question,options:this.dataToStd.options,setting:this.setting,newTime:this.nTimer,count:this.count,view:this.currResultView,list:this.list,totalUsers:b.data.totalUsers,users:this.uniqueUsers,pollType:a};"undefined"!=typeof b.data.pollClosed&&"yes"!=b.pollClosed&&(this.UI.pollClosedUI(),b=virtualclass.lang.getString("Pclosed"),this.showMsg("resultLayoutHead",b,"alert-success"),
this.timer&&clearInterval(this.timer),this.testNoneVoted(),(b=document.getElementById("pollResultMsz"))&&b.parentNode.removeChild(b),a.pollClosed="yes",this.pollState.pollClosed="yes");this.pollState.data=a;this.pollState.currScreen="teacherPublish";localStorage.removeItem("pollState")},reloadTeacherPublish:function(b){var a=b.data.pollType;document.getElementById("bootstrapCont");$("#editPollModal").modal({backdrop:"static",keyboard:!1});$("#editPollModal").modal({show:!0});$("#editPollModal").on("hidden.bs.modal",
function(){$("#editPollModal").remove()});var c=this.setting.timer;this.UI.resultView(c,a);this.list=b.data.list;this.count=b.data.count;this.currResultView=b.data.view;var d=b.data.totalUsers;this.reloadGraph();this.noOfVotes(d);if(c)if(c=this.nTimer.min,d=this.nTimer.sec,c||1<d){var h=document.getElementById("timerWrapper");if(h){var m=document.createElement("div");m.id="timerCont";h.appendChild(m)}this.showTimer(virtualclass.poll.nTimer,0)}else{if(c||1>=d){if(h=document.getElementById("timerWrapper"))m=
document.createElement("div"),m.id="timerCont",h.appendChild(m);m.innerHTML=(10>c?"0"+c:c)+":"+(10>d?"00":d);this.testNoneVoted();(m=document.getElementById("pollResultMsz"))&&m.parentNode.removeChild(m)}}else c=b.data.newTime.min,d=b.data.newTime.sec,this.elapsedTimer(c,d);if(m=document.getElementById("modalClose"))m.removeAttribute("data-dismiss"),m.addEventListener("click",function(){virtualclass.poll.pollModalClose(a)});this.count=b.data.count;this.pollState.currScreen="teacherPublish"},pollModalClose:function(b){roles.hasControls()&&
virtualclass.poll.pollState.currScreen&&"teacherPublish"==virtualclass.poll.pollState.currScreen&&(virtualclass.poll.pollState.currScreen="course"==b?"displaycoursePollList":"displaysitePollList");var a=virtualclass.lang.getString("pclosetag");virtualclass.popup.confirmInput(a,this.resultCloseConfirm,b)},resultCloseConfirm:function(b){if(b){$("#editPollModal").remove();if(virtualclass.poll.timer){ioAdapter.mustSend({poll:{pollMsg:"stdPublishResult",data:virtualclass.poll.count},cf:"poll"});virtualclass.poll.resultToStorage();
var a={qid:virtualclass.poll.dataToStd.qId,list:virtualclass.poll.list}}virtualclass.poll.timer&&(virtualclass.poll.interfaceToSaveResult(a),clearInterval(virtualclass.poll.timer),virtualclass.poll.timer=0);if(b=document.getElementById("congreaPollVoters"))b.innerHTML=virtualclass.lang.getString("receivedVotes");virtualclass.poll.count={}}},resultToStorage:function(){var b=roles.hasControls()?this.dataToStd:this.dataRec;b&&(b={result:this.count,qid:b.qId,pollData:b},this.uid++,b.uid=this.uid,roles.hasControls()||
virtualclass.storage.pollStore(JSON.stringify(b)))},reloadGraph:function(){"bar"==this.currResultView?(this.showGraph(),this.updateBarGraph()):"pi"==this.currResultView?(this.createPiChart(),this.updatePiChart()):"list"==this.currResultView&&this.listView();var b=document.getElementsByClassName("emptyList"),a=document.getElementById("chart");if(0<this.list.length)for(a=0;a<b.length;a++)b[a].style.display="none";else a.style.display="none";if(b=document.querySelectorAll("#chartMenuCont button"))for(a=
0;a<b.length;a++)b[a].classList.remove("disabled")},saveInLocalStorage:function(){console.log("pollinlocalstorage"+this.pollState);console.log(this.pollState.data);console.log(this.pollState);localStorage.setItem("pollState",JSON.stringify(this.pollState))},onmessage:function(b,a){"stdPublish"==b.poll.pollMsg&&(this.dataRec=b.poll.data);console.log("student side "+b.poll.pollMsg);virtualclass.poll[b.poll.pollMsg].call(this,b.poll.data,a);"stdPublishResult"==b.poll.pollMsg&&this.resultToStorage()},
pollPopUp:function(b,a,c){for(var f=function(){console.log(this.id);virtualclass.poll.action(this.id,b,a,c)},d=(document.getElementById("editPollModal")?document.getElementById("editPollModal"):document.getElementById("qnPopup")).querySelectorAll(":scope .controls"),m=0;m<d.length;m++)d[m].addEventListener("click",f)},attachConfirmInit:function(b,a,c,d){this.action(b,a,c,d)},action:function(b,a,c,d){a(b,c,d)},displaycoursePollList:function(){var b=this;this.dispList("course");var a=document.querySelector("#listQnContcourse tbody");
if(a)for(;a.childNodes.length;)a.removeChild(a.lastChild);a=document.querySelector("#listQnContcourse");if(this.coursePoll.length){a&&(a.style.display="block");var c=document.querySelector("#mszBoxPoll");c.style.display="none";this.coursePoll.forEach(function(a,c){b.forEachPoll(a,c,"course")})}else{c=document.querySelector("#mszBoxPoll");var d=virtualclass.lang.getString("noPoll");c.style.display="block";c.innerHTML=d;a&&(a.style.display="none")}(a=document.getElementById("emptyListsite"))&&a.parentNode.removeChild(a);
this.dispNewPollBtn("course");"teacherPublish"!=this.pollState.currScreen&&(this.pollState.currScreen="displaycoursePollList")},displaysitePollList:function(b){var a=this;this.dispList("site");var c=document.querySelector("#listQnContsite tbody");if(c)for(;c.childNodes.length;)c.removeChild(c.lastChild);c=document.querySelector("#listQnContsite");if(this.sitePoll.length){this.sitePoll.forEach(function(c,f){a.forEachPoll(c,f,"site",b)});c&&(c.style.display="block");var d=document.querySelector("#mszBoxPoll");
d.style.display="none"}else{d=document.querySelector("#mszBoxPoll");var h=virtualclass.lang.getString("noPoll");"false"==b&&(h=virtualclass.lang.getString("noPollNoAdmin"));d.style.display="block";d.innerHTML=h;c&&(c.style.display="none")}(c=document.getElementById("emptyListcourse"))&&c.parentNode.removeChild(c);this.dispNewPollBtn("site",b);"teacherPublish"!=this.pollState.currScreen&&(this.pollState.currScreen="displaysitePollList")},dispList:function(b){var a=document.getElementById("mszBoxPoll");
0<a.childNodes.length&&a.childNodes[0].parentNode.removeChild(a.childNodes[0]);a="course"==b?"site":"course";this.hidePollList(a);var c=document.getElementById("listQnCont"+b);c?(c.style.display="table",(c=document.getElementById("newPollBtn"+b))&&c.classList.contains(a)&&(c.classList.remove(a),c.classList.add(b))):this.UI.layout2("layoutPollBody",b)},dispNewPollBtn:function(b,a){this.attachEvent("newPollBtn"+b,"click",this.newPollHandler,b);var c=document.getElementById("newPollBtn"+b);"site"==b?
(c.style.display="undefined"!=typeof a&&"true"==a?"table":"none",b=document.getElementById("newPollBtncourse")):(c.style.display="table",b=document.getElementById("newPollBtnsite"));b&&(b.style.display="none")},forEachPoll:function(b,a,c,d){var f={};f.questiontext=b.questiontext;f.creator=b.creatorname;f.pollType=c;f.index=a;var g=virtualclass.getTemplate("qn","poll");$("#listQnCont"+c+" .pollList").append(g({pollQn:f}));if("course"==c&&b.createdby==wbUser.id||"site"==c&&"true"==d){if(b.isPublished){if(d=
document.querySelector("#editQn"+c+a+" span"))d.setAttribute("title",virtualclass.lang.getString("etDisabledA")),d.style.cursor="default",d.classList.add("disabled")}else this.attachEvent("editQn"+c+a,"click",this.editHandler,b,c,a,b.createdby,b.questionid);this.attachEvent("deleteQn"+c+a,"click",this.deleteHandler,b,c,a)}else{if(d=document.querySelector("#editQn"+c+a+" span"))d.setAttribute("title",virtualclass.lang.getString("etDisabledCr")),d.style.cursor="default",d.classList.add("disabled");
d=document.querySelector("#deleteQn"+c+a+" span");d.setAttribute("title",virtualclass.lang.getString("dltDisabled"));d.style.cursor="default";d.classList.add("disabled")}this.attachEvent("publishQn"+c+a,"click",this.publishHandler,b,c,a);this.previewOnHover(b,c,a)},previewOnHover:function(b,a,c){var f={};f.questiontext=b.questiontext;f.options=b.options;var d=virtualclass.getTemplate("previewPopup","poll")({data:f});$(function(){$('.qnText[data-toggle="popover"]').popover({content:d,html:!0,container:"#qnText"+
a+c,delay:{show:1E3}})})},attachEvent:function(b,a,c,d,h,m,n,r,A){r=document.getElementById(b);null!=r&&r.addEventListener(a,function(){"undefined"!=typeof d?c(d,h,m,b,n,A):c(h,m,b,n,A)})},hidePollList:function(b){if(b=document.getElementById("listQnCont"+b))b.style.display="none"},editHandler:function(b,a,f){b=document.getElementById("mszBoxPoll");0<b.childNodes.length&&b.childNodes[0].parentNode.removeChild(b.childNodes[0]);b={};c="course"==a?virtualclass.poll.coursePoll[f]:virtualclass.poll.sitePoll[f];
b.options=c.options;b.questiontext=c.questiontext;var d=virtualclass.getTemplate("edit-modal","poll");$("#bootstrapCont").append(d({data:b}));virtualclass.poll.UI.editPoll(a,f);$("#editPollModal").modal({show:!0,backdrop:"static",keyboard:!1});$("#editPollModal").on("hidden.bs.modal",function(){$("#editPollModal").remove()})},stdResponse:function(b,a){this.updateResponse(b,a)},newPollHandler:function(b){var a=document.getElementById("createPollCont");$("#editPollModal").length&&$("#editPollModal").remove();
var c=virtualclass.getTemplate("modal","poll");$(a).append(c());$("#editPollModal").modal({backdrop:"static",keyboard:!1});$("#editPollModal").modal({show:!0});$("#editPollModal").on("hidden.bs.modal",function(){$("#editPollModal").remove()});virtualclass.poll.pollPopUp(virtualclass.poll.popupFn,void 0,b)},popupFn:function(b,a,c){virtualclass.poll[b].call(this.poll,a,c)},next:function(b,a){virtualclass.poll.pollSetting(a,b)},goBack:function(b,a){console.log("modal dismiss")},etSave:function(b,a,c){var f=
virtualclass.poll.isBlank();if(!f)return 0;f="course"==a?virtualclass.poll.coursePoll[b]:virtualclass.poll.sitePoll[b];var d="course"==a?virtualclass.poll.cmid:0,m=document.getElementById("q");document.getElementById("etSave").setAttribute("data-dismiss","modal");if("undefined"!=typeof b)virtualclass.poll.saveQuestion(m,b,a),virtualclass.poll.saveOption(b,a),virtualclass.poll.interfaceToEdit({questionid:f.questionid,question:f.questiontext,options:f.options,createdby:f.createdby},d);else if(f=virtualclass.poll.newPollSave("undefined",
a),!f)return 0;c||virtualclass.poll.hideModal(b);return 1},closePoll:function(b){var a=virtualclass.lang.getString("pclose");virtualclass.popup.confirmInput(a,virtualclass.poll.askConfirmClose,"close",b)},saveQuestion:function(b,a,c){"course"==c?(this.coursePoll[a].questiontext=b.value,this.coursePoll[a].creator=wbUser.name):(this.sitePoll[a].questiontext=b.value,this.sitePoll[a].creator=wbUser.name);console.log(this.coursePoll);document.getElementById("qnText"+c+a).innerHTML=b.value},saveOption:function(b,
a){var c=[],d=0,h;b="course"==a?this.coursePoll[b]:this.sitePoll[b];var m=document.getElementById("optsTxCont").querySelectorAll(":scope .opt");for(a=0;a<m.length;a++)c[a]=m[a].value;for(h in b.options)b.options[h]=c[d],d++;if(a>d)for(d,h=d;h<a;h++)b.options["noid"+d]=c[d],d++},hideModal:function(){$("editPollModal").modal("hide")},newPollSave:function(b,a){b=0;var c=[];if(!virtualclass.poll.isBlank())return 0;for(var d=document.getElementById("optsTxCont").querySelectorAll(":scope .opt"),h=0;h<d.length;h++)c.push(d[h].value);
d=document.getElementById("q");"course"==a&&(b=virtualclass.poll.cmid);virtualclass.poll.interfaceToSave({question:d.value,options:c,action:"newPollSave",category:b,copied:!1},b);return 1},isBlank:function(){document.getElementById("q");for(var b=document.getElementById("optsTxCont").querySelectorAll(":scope .opt"),a=0,c=0,d=0;d<b.length;d++)b[d].value?a++:c++;if(document.getElementById("q").value){if(2>a)return alert(virtualclass.lang.getString("minoption")),0;if(c)return alert(virtualclass.lang.getString("delblank")),
0}else return virtualclass.lang.getString("pollblank"),alert(virtualclass.lang.getString("pollblank")),0;return 1},saveNdPublish:function(b,a){var c=a+"Poll",d=document.getElementById("optsTxCont");d=d.querySelectorAll(":scope .opt");if("undefined"==typeof b){c=virtualclass.poll[c].length;var h=document.getElementById("q").value,m={};d=document.getElementById("optsTxCont");d=d.querySelectorAll(":scope .opt");for(var n=0;n<d.length;n++)m[n]=d[n].value;virtualclass.poll.dataToStd.question=h;virtualclass.poll.dataToStd.options=
m;(n=virtualclass.poll.newPollSave(c,a,!0))&&virtualclass.poll.pollSetting(a,c,!0)}else{m=virtualclass.poll[c][b];h=document.getElementById("q").value;m.question=h;h=0;for(n in m.options)m.options[n]=d[h].value,h++;virtualclass.poll[c][b].questiontext=document.getElementById("q").value;virtualclass.poll.dataToStd.question=virtualclass.poll[c][b].questiontext;virtualclass.poll.dataToStd.options=virtualclass.poll[c][b].options;(n=virtualclass.poll.etSave(b,a,void 0))&&virtualclass.poll.pollSetting(a,
b,!0)}b={type:"course",qid:b,pollqnOps:virtualclass.poll.dataToStd};virtualclass.poll.pollState.currScreen="setting";virtualclass.poll.pollState.data=b},pollCancel:function(){virtualclass.popup.closeElem()},reset:function(){$("#editPollModal").find("textArea").val("")},addMoreOption:function(b,a){virtualclass.poll.UI.createOption(b,a)},removeOption:function(b,a,c){var f=c.replace("remove","");c=document.getElementById(c);c.parentNode.parentNode.removeChild(c.parentNode);b="course"==b?virtualclass.poll.coursePoll[a]:
virtualclass.poll.sitePoll[a];"undefined"!==typeof b&&(delete b.options[f],virtualclass.poll.interfaceToDelOption(f))},publishHandler:function(b,a,c){var f=document.getElementById("mszBoxPoll");0<f.childNodes.length&&f.childNodes[0].parentNode.removeChild(f.childNodes[0]);b.isPublished?virtualclass.poll.duplicatePoll(b):virtualclass.poll.publishPoll(b,a,c)},duplicatePoll:function(b){var a=[],c;for(c in b.options)a.push(b.options[c]);virtualclass.poll.interfaceToSave({question:b.questiontext,options:a,
action:"newPollSave",category:b.category,copied:!0},b.category)},publishPoll:function(b,a){virtualclass.poll.dataToStd.question=b.questiontext;virtualclass.poll.dataToStd.qId=b.questionid;virtualclass.poll.dataToStd.options=b.options;var c=document.getElementById("layoutPollBody"),d=document.createElement("div");d.className="container";c.appendChild(d);(c=document.getElementById("editPollModal"))&&c.remove();c={};c.questiontext=b.questiontext;c.options=b.options;b=virtualclass.getTemplate("preview-modal",
"poll");$("#virtualclassApp #bootstrapCont").append(b({poll:c}));$("#editPollModal").modal({backdrop:"static",keyboard:!1});$("#editPollModal").modal({show:!0});virtualclass.poll.pollPreview(a);$("#editPollModal").on("hidden.bs.modal",function(){$("#editPollModal").remove()})},pollPreview:function(b){var a=document.getElementById("contFooter");virtualclass.poll.UI.previewFooterBtns(a,b)},publishHandler2:function(){virtualclass.poll.showMsg("mszBoxPoll","poll published","alert-success")},deleteHandler:function(b,
a,c){b=document.getElementById("mszBoxPoll").querySelectorAll(":scope .alert");0<b.length&&b[0].parentNode.removeChild(b[0]);b=virtualclass.lang.getString("pollDel");virtualclass.popup.confirmInput(b,virtualclass.poll.askConfirm,a,c)},showMsg:function(b,a,c){var f=document.getElementById(b);if(!f){var d=document.getElementById("layoutPollBody");f=document.createElement("div");f.id=b;d.appendChild(f)}b=document.createElement("div");b.className="alert  alert-dismissable";b.classList.add(c);b.innerHTML=
a;f.insertBefore(b,f.firstChild);a=document.createElement("button");a.className="close";a.setAttribute("data-dismiss","alert");a.innerHTML="&times";b.appendChild(a)},askConfirm:function(b,a,c){if(b){b=document.getElementById("contQn"+a+c);b.parentNode.removeChild(b);b=virtualclass.lang.getString("Pdsuccess");virtualclass.poll.showMsg("mszBoxPoll",b,"alert-success");b="course"==a?virtualclass.poll.coursePoll[c]:virtualclass.poll.sitePoll[c];var f=b.questionid;b="course"==a?virtualclass.poll.coursePoll:
virtualclass.poll.sitePoll;b.splice(c,1);virtualclass.poll.interfaceToDelete(f)}},askConfirmClose:function(b,a,c){if(b){(virtualclass.poll.setting.showResult&&roles.hasControls()||!roles.hasControls())&&ioAdapter.mustSend({poll:{pollMsg:"stdPublishResult",data:virtualclass.poll.count},cf:"poll"});virtualclass.poll.resultToStorage();virtualclass.poll.UI.pollClosedUI();virtualclass.poll.interfaceToSaveResult({qid:virtualclass.poll.dataToStd.qId,list:virtualclass.poll.list});b=virtualclass.lang.getString("Pclosed");
virtualclass.poll.showMsg("resultLayoutHead",b,"alert-success");virtualclass.poll.pollState.data.pollClosed="yes";clearInterval(virtualclass.poll.timer);b=virtualclass.poll.timer=0;for(var f in virtualclass.poll.count)virtualclass.poll.count[f]&&(b=1);if(b)f=document.getElementById("chart"),"list"!=virtualclass.poll.currResultView&&(f.style.display="block");else{virtualclass.poll.noneVoted(c);if(c=document.getElementById("resultLayoutHead"))for(f=0;f<c.childNodes.length;f++)c.childNodes[f].parentNode.removeChild(c.childNodes[f]);
f=document.getElementById("pollResultMsz");f.parentNode.removeChild(f);f=document.getElementById("chartMenuCont");f.parentNode.removeChild(f)}}},showStudentPollReport:function(b){virtualclass.poll.studentReportLayout(b);(b=document.getElementById("mszBoxPoll"))&&b.parentNode.removeChild(b)},studentReportLayout:function(b){for(var a=document.getElementById("layoutPollBody");1<a.childElementCount;)a.removeChild(a.lastChild);var c=document.createElement("div");a.appendChild(c);b=JSON.parse(b.pop().pollResult);
a=b.result;virtualclass.poll.count=a;virtualclass.poll.dataRec=b.pollData;virtualclass.poll.stdPublishResult(a,"true")},timerDisable:function(){document.getElementById("timer").classList.add("disabled")},stdPublish:function(){var b=document.getElementById("mszBoxPoll");b&&0<b.childNodes.length&&b.childNodes[0].parentNode.removeChild(b.childNodes[0]);virtualclass.poll.timer&&clearInterval(virtualclass.poll.timer);(b=document.getElementById("resultLayout"))&&b.parentNode.removeChild(b);(b=document.getElementById("stdPollContainer"))&&
b.parentNode.removeChild(b);if(b=document.querySelector(".congrea.student #virtualclassPoll #navigator #stdPollHeader"))b.style.display="block";b={};b.question=virtualclass.poll.dataRec.options;var a=virtualclass.getTemplate("pollStd","poll");$("#layoutPollBody").append(a({poll:b}));this.UI.stdPublishUI();virtualclass.poll.dataRec.setting.timer?(b=virtualclass.poll.dataRec.newTime,virtualclass.poll.newTimer=b,this.showTimer(b),b=document.querySelector("#timerLabel"),b.innerHTML=virtualclass.lang.getString("Rtime")):
(this.elapsedTimer(),b=virtualclass.lang.getString("Tmyclose"),virtualclass.poll.showMsg("stdContHead",b,"alert-success"),b=document.querySelector("#timerLabel"),b.innerHTML=virtualclass.lang.getString("ETime"));b=document.getElementById("stdQnCont");this.showQn(b);b=document.getElementById("stdOptionCont");this.showOption(b);(b=document.getElementById("btnVote"))&&b.addEventListener("click",virtualclass.poll.voted);b={stdPoll:virtualclass.poll.dataRec,timer:virtualclass.poll.newUserTime};if(a=document.querySelector("#virtualclassCont.congrea.student #navigator #pollResult"))a.style.display=
"none";virtualclass.poll.pollState.currScreen="stdPublish";virtualclass.poll.pollState.data=b},voted:function(){virtualclass.poll.pollState.currScreen="voted";if(!document.querySelector("#virtualclassCont.congrea #stdPollContainer #btnVote").classList.contains("disabled"))if(virtualclass.poll.saveSelected()){virtualclass.poll.timer&&clearInterval(virtualclass.poll.timer);var b=document.getElementById("stdPollMszLayout");b&&b.parentNode.removeChild(b);b=document.getElementById("stdPollContainer");
b.parentNode.removeChild(b);b=virtualclass.poll.dataRec.setting.showResult?virtualclass.lang.getString("votesuccess"):virtualclass.lang.getString("votesuccessPbt");virtualclass.poll.showMsg("mszBoxPoll",b,"alert-success");virtualclass.poll.sendResponse()}else alert("Select an option");b={stdPoll:virtualclass.poll.dataRec,timer:virtualclass.poll.newUserTime};virtualclass.poll.pollState.currScreen="voted";virtualclass.poll.pollState.data=b},sendResponse:function(){var b=virtualclass.vutil.whoIsTeacher();
ioAdapter.mustSendUser({poll:{pollMsg:"stdResponse",data:virtualclass.poll.responseId},cf:"poll"},b)},timeStamp:function(b){virtualclass.poll.newTimer=b},saveSelected:function(){for(var b=document.getElementById("stdOptionCont").querySelectorAll(":scope .opt"),a=0;a<b.length;a++)if(b[a].checked)return virtualclass.poll.responseId=b[a].id,1;if(a==b.length)return 0},elapsedTimer:function(b,a){var c=document.getElementById("timerLabel");c&&(c.innerHTML=virtualclass.lang.getString("ETime"));if(b||a)var d=
b,h=a;else d=h=0;if(roles.hasControls())m=document.getElementById("timerCont");else{if(b=document.getElementById("stdContHead")){var m=document.createElement("div");m.id="timerCont";b.appendChild(m)}d=virtualclass.poll.dataRec.newTime.min;h=virtualclass.poll.dataRec.newTime.sec}b=function(){console.log("timer"+virtualclass.poll.timer);m?(h++,60==h&&(h=0,d++,60==d&&(d=0)),virtualclass.poll.newUserTime.min=d,virtualclass.poll.newUserTime.sec=h,m.innerHTML=(10>d?"0"+d:d)+":"+(10>h?"0"+h:h)):clearInterval(virtualclass.poll.timer)};
b();virtualclass.poll.timer=setInterval(b,1E3)},showTimer:function(b,a){virtualclass.poll.timer&&clearInterval(virtualclass.poll.timer);var c=document.getElementById("timerCont");roles.hasControls()&&virtualclass.poll.pollState.data&&(virtualclass.poll.pollState.data.newTime=virtualclass.poll.newUserTime,console.log("test"+virtualclass.poll.pollState.data.newTime));var d=0,h=0;roles.hasControls()&&("undefined"!=typeof b.digit?(a=b.digit,b=b.unit,h=a,d=0,"minut"==b&&(d=a,h=0)):"undefined"!=typeof b.min&&
(d=b.min,h=b.sec));roles.hasControls()||!virtualclass.poll.newTimer.min&&!virtualclass.poll.newTimer.sec||(d=virtualclass.poll.newTimer.min,h=virtualclass.poll.newTimer.sec,virtualclass.poll.newTimer={});b=function(){c?(virtualclass.poll.newUserTime.min=d,virtualclass.poll.newUserTime.sec=h,c.innerHTML=(10>d?"0"+d:d)+":"+(10>h?"0"+h:h),console.log("testtimer"+virtualclass.poll.timer),h--,0>=h&&(h=59,d--,0>d&&(h=d=0,c.innerHTML=(10>d?"0"+d:d)+":"+(10>h?"0"+h:h),clearInterval(virtualclass.poll.timer),
virtualclass.poll.timerExpired()))):clearInterval(virtualclass.poll.timer)};if(d||h)b(),virtualclass.poll.timer=setInterval(b,1E3)},timerExpired:function(){var b=document.getElementById("btnVote");b&&b.classList.add("disabled");roles.hasControls()&&(virtualclass.poll.setting.showResult&&ioAdapter.mustSend({poll:{pollMsg:"stdPublishResult",data:virtualclass.poll.count},cf:"poll"}),virtualclass.poll.timer&&virtualclass.poll.interfaceToSaveResult({qid:virtualclass.poll.dataToStd.qId,list:virtualclass.poll.list}),
this.testNoneVoted());virtualclass.poll.timer=0;if(b=document.getElementById("congreaPollVoters"))b.innerHTML=virtualclass.lang.getString("rvtu");virtualclass.poll.pollState.data.pollClosed="yes"},testNoneVoted:function(){var b=0,a;for(a in virtualclass.poll.count)virtualclass.poll.count[a]&&(b=1);if(b)(a=document.getElementById("chart"))&&"list"!=virtualclass.poll.currResultView&&(a.style.display="block");else{this.noneVoted();if(b=document.getElementById("resultLayoutHead"))for(a=0;a<b.childNodes.length;a++)b.childNodes[a].parentNode.removeChild(b.childNodes[a]);
a=document.getElementById("pollResultMsz");a.parentNode.removeChild(a);a=document.getElementById("chartMenuCont");a.parentNode.removeChild(a)}},stdPublishResult:function(b,a){virtualclass.poll.count=b;virtualclass.poll.timer&&clearInterval(virtualclass.poll.timer);if(virtualclass.poll.dataRec||a)virtualclass.poll.dataRec.setting.showResult?this.resultDisplay(b):(this.noResultDisplay(),b=document.getElementById("resultLayoutHead"),virtualclass.poll.UI.resultNotShownUI(b),virtualclass.poll.pollState.currScreen=
"stdPublishResult",virtualclass.poll.pollState.data="noResult");virtualclass.poll.resultToStorage()},resultDisplay:function(b){var a=document.getElementById("resultLayout");a&&a.parentNode.removeChild(a);virtualclass.poll.UI.createResultLayout();document.getElementById("resultLayout");a=document.getElementById("timerWrapper");a.parentNode.removeChild(a);a=document.getElementById("resultLayout");a.classList.add("bootstrap","container");virtualclass.poll.count=b;(b=document.getElementById("mszBoxPoll"))&&
0<b.childNodes.length&&(b=b.querySelectorAll(":scope .alert"),0<b.length&&b[0].parentNode.removeChild(b[0]));(a=document.getElementById("chartMenuCont"))&&virtualclass.poll.UI.chartMenu(a);b=0;for(var c in virtualclass.poll.count)virtualclass.poll.count[c]&&(b=1);b?(virtualclass.poll.showGraph(),document.getElementById("chart").style.display="block"):this.noneVoted();c={stdPoll:virtualclass.poll.dataRec,timer:virtualclass.poll.newUserTime,count:virtualclass.poll.count};virtualclass.poll.pollState.currScreen=
"stdPublishResult";virtualclass.poll.pollState.data=c},noResultDisplay:function(){var b=document.getElementById("stdPollContainer");b&&b.parentNode.removeChild(b);virtualclass.poll.UI.createResultLayout();var a=document.getElementById("resultLayoutHead");if(a)for(b=0;b<a.childNodes.length;b++)a.childNodes[b].parentNode.removeChild(a.childNodes[b]);if(a=document.getElementById("resultLayoutBody"))for(b=0;b<a.childNodes.length;b++)a.childNodes[b].parentNode.removeChild(a.childNodes[b])},noneVoted:function(b){"undefined"!=
typeof virtualclass.poll.timer&&clearInterval(virtualclass.poll.timer);this.noResultDisplay();var a=document.querySelector("#resultLayoutHead");a&&(a.style.display="none");document.querySelector("#qnLabelCont");if(a=document.querySelector("#chartMenuCont"))a.style.display="none";a=document.getElementById("resultLayoutBody");var c=document.createElement("div");c.className="pollResultNotify";c.id="resultNote";a.appendChild(c);a.insertBefore(c,a.firstChild);c=virtualclass.lang.getString("Pclosed");virtualclass.poll.showMsg("resultNote",
c,"alert-error");c=document.getElementById("resultNote");var d=document.createElement("div");d.className="notifyText alert alert-info";d.id="congreaPollNote";d.innerHTML=virtualclass.lang.getString("Novote");c.appendChild(d);c=virtualclass.poll.dataRec;roles.hasControls()||this.showPollText(a,c);(a=document.getElementById("modalClose"))&&a.addEventListener("click",function(){$("#editPollModal").remove();roles.hasControls()&&b&&virtualclass.poll.pollState.currScreen&&"teacherPublish"==virtualclass.poll.pollState.currScreen&&
(virtualclass.poll.pollState.currScreen="course"==b?"displaycoursePollList":"displaysitePollList")})},showPollText:function(b){var a=roles.hasControls()?virtualclass.poll.dataToStd:virtualclass.poll.dataRec;b={};b.question=a.question;b.options=a.options;a=virtualclass.getTemplate("qnOptions","poll");$("#resultLayoutBody #optnNonVotd").append(a({poll:b}))},showQn:function(b){roles.hasControls()?b.innerHTML=virtualclass.poll.dataToStd.question:b.innerHTML=virtualclass.poll.dataRec.question},showOption:function(b){var a=
roles.hasControls()?virtualclass.poll.dataToStd:virtualclass.poll.dataRec,c=a.options,d;for(d in c){c=document.createElement("div");b.appendChild(c);var h=document.createElement("input");h.className="opt";h.setAttribute("name","option");h.setAttribute("value",d);h.setAttribute("type","radio");h.id=d;c.appendChild(h);h=document.createElement("span");h.className="stdoptn";c.appendChild(h);h.innerHTML=a.options[d]}},pollSetting:function(b,a,c){virtualclass.poll.UI.hidePrevious(a);null==document.getElementById("settingTx"+
a)&&virtualclass.poll.UI.pollSettingUI(a,b);"undefined"!=typeof c&&document.getElementById("publish").setAttribute("disable",!0);document.getElementById("publish").addEventListener("click",function(){virtualclass.poll.saveSetting(b,c)})},saveSetting:function(b,a){if(document.getElementById("radioBtn2")){var c=document.getElementById("radioBtn2").checked;virtualclass.poll.setting.timer=c}var d=document.getElementById("timer");if(d){virtualclass.poll.setting.time.digit=d.options[d.selectedIndex].value;
var h=document.getElementById("ut");virtualclass.poll.setting.time.unit=h.options[h.selectedIndex].value;h=Date.now();console.log("sender TimeStamp"+Date.now());virtualclass.poll.setting.time.timestamp=h}document.getElementById("pollCkbox")&&(h=document.getElementById("pollCkbox").checked,virtualclass.poll.setting.showResult=h);virtualclass.poll.UI.resultView(c,b);virtualclass.poll.currResultView="bar";c?virtualclass.poll.showTimer(virtualclass.poll.setting.time,0):virtualclass.poll.elapsedTimer();
"undefined"!=typeof a&&(virtualclass.poll.dataToStd.qId=virtualclass.poll.currQid,virtualclass.poll.dataToStd.options=virtualclass.poll.currOption);b={question:virtualclass.poll.dataToStd.question,options:virtualclass.poll.dataToStd.options,qId:virtualclass.poll.dataToStd.qId,setting:virtualclass.poll.setting,newTime:virtualclass.poll.newUserTime,count:virtualclass.poll.count,list:virtualclass.poll.list,users:virtualclass.poll.uniqueUsers,pollType:b};"undefined"!=typeof virtualclass.poll.afterReload&&
(b.newTime=virtualclass.poll.afterReload,delete virtualclass.poll.afterReload);d&&(ioAdapter.mustSend({poll:{pollMsg:"stdPublish",data:b},cf:"poll"}),console.log("to send"+b));b.view=virtualclass.poll.currResultView;virtualclass.poll.showGraph();virtualclass.poll.updateBarGraph();virtualclass.poll.pollState.currScreen="teacherPublish";virtualclass.poll.pollState.data=b},updateResponse:function(b,a){var c=document.getElementById("chart");c&&(c.style.display="block");if(c=document.getElementById("pollResultMsz"))c.style.display=
"none";c=document.querySelectorAll("#chartMenuCont button");for(var d=0;d<c.length;d++)c[d].classList.remove("disabled");c={};"undefined"==typeof virtualclass.poll.count[b]&&(virtualclass.poll.count[b]=0);virtualclass.poll.count[b]+=1;c[a.userid]=b;c.username=a.name;virtualclass.poll.list.push(c);"bar"==virtualclass.poll.currResultView?(virtualclass.poll.showGraph(),virtualclass.poll.updateBarGraph()):"pi"==virtualclass.poll.currResultView?virtualclass.poll.updatePiChart():"list"==virtualclass.poll.currResultView&&
virtualclass.poll.updateListResult()},noOfVotes:function(b){var a=virtualclass.hasOwnProperty("connectedUsers")?virtualclass.connectedUsers.length:0,c=0,d;for(d in virtualclass.poll.count)c+=virtualclass.poll.count[d];a=a?a-1:0;virtualclass.poll.pollState.data&&(virtualclass.poll.pollState.data.totalUsers=b?b:a);(b=virtualclass.poll.uniqueUsers.length?virtualclass.poll.uniqueUsers.length:0)&&(a=b);b=document.getElementById("receivedVotes");null!=b&&(b.innerHTML=c+"/"+a)},updateBarGraph:function(){var b=
document.getElementById("chart"),a=document.getElementById("pollResultMsz"),c=[],d=roles.hasControls()?virtualclass.poll.dataToStd:virtualclass.poll.dataRec,h;for(h in virtualclass.poll.count)c.push([d.options[h],virtualclass.poll.count[h]]),virtualclass.poll.count[h]&&(b&&(b.style.display="block"),a&&(a.style.display="none"));for(h in d.options)virtualclass.poll.count.hasOwnProperty(h)||(c.push([d.options[h],"0"]),virtualclass.poll.count[h]=0);virtualclass.poll.chart&&virtualclass.poll.chart.load({columns:c});
roles.hasControls()&&this.noOfVotes()},updatePiChart:function(){var b=document.getElementById("chart"),a=document.getElementById("pollResultMsz");this.noOfVotes();var c=roles.hasControls()?virtualclass.poll.dataToStd:virtualclass.poll.dataRec,d=[],h;for(h in virtualclass.poll.count)d.push([c.options[h],virtualclass.poll.count[h]]),virtualclass.poll.count[h]&&(b&&(b.style.display="block"),a&&(a.style.display="none"));for(h in c.options)virtualclass.poll.count.hasOwnProperty(h)||(d.push([c.options[h],
"0"]),virtualclass.poll.count[h]=0);virtualclass.poll.piChart&&virtualclass.poll.piChart.load({columns:d})},updateListResult:function(){this.noOfVotes();var b=virtualclass.poll.list.pop();virtualclass.poll.addResultListItem(b);virtualclass.poll.list.push(b);virtualclass.poll.pollState.data.list=virtualclass.poll.list},createPiChart:function(){var b=roles.hasControls()?virtualclass.poll.dataToStd:virtualclass.poll.dataRec;virtualclass.poll.currResultView="pi";var a=document.getElementById("chart");
a.style.display="none";var c=document.getElementById("listCont");c&&(c.style.display="none");c=[];var d=!1,h;for(h in virtualclass.poll.count)c.push([b.options[h],virtualclass.poll.count[h]]),virtualclass.poll.count[h]&&(d=!0);d&&(a.style.display="block");virtualclass.poll.piChart=c3.generate({data:{columns:c,transition:{duration:null},type:"pie",onclick:function(a,b){console.log("onclick",a,b)},onmouseover:function(a,b){console.log("onmouseover",a,b)},onmouseout:function(a,b){console.log("onmouseout",
a,b)}}});virtualclass.poll.currResultView="pi";"undefined"!=typeof virtualclass.poll.pollState.data&&(virtualclass.poll.pollState.data.view="pi")},listView:function(){virtualclass.poll.currResultView="list";document.getElementById("chart").style.display="none";var b=document.getElementById("resultLayoutBody"),a=document.getElementById("listCont");a.hasChildNodes()&&a.removeChild(a.childNodes[0]);0<virtualclass.poll.list.length&&(virtualclass.poll.createResponseTable(b),(b=document.getElementById("pollResultMsz"))&&
b.parentNode.removeChild(b));if(a=document.getElementById("listCont"))a.style.display="block"},createResponseTable:function(b){b=virtualclass.getTemplate("pollresultlist","poll");roles.hasAdmin();$("#virtualclassApp #listCont").append(b({}));virtualclass.poll.list.forEach(function(a,b){virtualclass.poll.addResultListItem(a,b)});virtualclass.poll.currResultView="list";"undefined"!=typeof virtualclass.poll.pollState.data&&(virtualclass.poll.pollState.data.view="list",virtualclass.poll.pollState.data.list=
virtualclass.poll.list)},addResultListItem:function(b){var a=virtualclass.poll.dataToStd.options,c=document.getElementById("resultList");for(h in b)if("username"!=h)var d=b[h];var h=document.createElement("tr");c.appendChild(h);c=document.createElement("td");c.innerHTML=b.username;h.appendChild(c);c=document.createElement("td");c.innerHTML=a[d];h.appendChild(c)},barGraph:function(){var b=document.getElementById("chart");b&&(b.style.display="block");virtualclass.poll.currResultView="bar";if(b=document.getElementById("listCont"))b.style.display=
"none";virtualclass.poll.showGraph();virtualclass.poll.updateBarGraph();virtualclass.poll.pollState.data.view="bar"},showGraph:function(){var b=roles.hasControls()?virtualclass.poll.dataToStd:virtualclass.poll.dataRec,a=[],c;for(c in virtualclass.poll.count)a.push([b.options[c],virtualclass.poll.count[c]]);b={type:"bar"};b.columns=a;if(a=document.getElementById("chart"))a.style.display="none";virtualclass.poll.chart=c3.generate({bindto:"#chart",data:b,bar:{width:100}})},UI:{id:"virtualclassPoll",
class:"virtualclass",container:function(){var b=document.getElementById(this.id);null!=b&&b.parentNode.removeChild(b);b=virtualclass.getTemplate("pollmain","poll");var a=roles.hasAdmin()?!0:!1;virtualclass.vutil.insertAppLayout(b({control:a}));if(roles.hasAdmin()){var c=document.querySelector("#coursePollTab"),d=document.querySelector("#sitePollTab");d.addEventListener("click",function(){c.classList.remove("active");d.classList.add("active");d.style.pointerEvents="none";c.style.pointerEvents="visible";
virtualclass.poll.interfaceToFetchList(0)});c.addEventListener("click",function(){d.classList.remove("active");c.classList.add("active");c.style.pointerEvents="none";d.style.pointerEvents="visible";virtualclass.poll.interfaceToFetchList(virtualclass.poll.cmid)})}else{document.querySelector("#virtualclassCont.congrea.student #navigator #pollResult").style.display="none";virtualclass.storage.getAllDataOfPoll(["pollStorage"],function(a){if(a){virtualclass.poll.previousResult=a;if(a=document.querySelector("#virtualclassCont.congrea.student #navigator #pollResult"))a.style.display=
"block";if(a=document.querySelector("#virtualclassCont.congrea.student #navigator #stdPollHeader"))a.style.display="none"}});var h=document.querySelector(".congrea.student #virtualclassPoll #navigator #pollResult");h.addEventListener("click",function(){virtualclass.poll.showStudentPollReport(virtualclass.poll.previousResult);h.classList.add("active")})}$(function(){$('[data-toggle="popover"]').popover()});$("#virtualclassPoll .navListTab").on("show.bs.popover",function(){$(this).data("bs.popover").tip().css({width:"140px"})})},
resultView:function(b,a){document.getElementById("layoutPoll");if(roles.hasControls()&&(this.createResultLayout(),!b)){var c=document.getElementById("resultLayoutHead");b=document.getElementById("closePoll");b||(b=document.createElement("button"),b.id="closePoll",b.className="btn btn-default",c.appendChild(b),b.innerHTML=virtualclass.lang.getString("closeVoting"),b.addEventListener("click",function(){virtualclass.poll.closePoll(a)}),c=document.createElement("i"),c.className="icon-close-poll",b.appendChild(c))}if(b=
document.getElementById("modalClose"))b.removeAttribute("data-dismiss"),b.addEventListener("click",function(){virtualclass.poll.pollModalClose(a)});virtualclass.poll.count={};virtualclass.poll.list=[]},createResultLayout:function(){var b=document.getElementById("resultLayout");b&&b.parentNode.removeChild(b);var a=roles.hasControls()?!0:!1;b={};b.control=a;if(roles.hasControls())for(b.question=virtualclass.poll.dataToStd.question,b.options=virtualclass.poll.dataToStd.options,a=virtualclass.getTemplate("result-modal",
"poll"),$("#editPollModal").length&&$("#editPollModal").remove(),$("#bootstrapCont").append(a({obj:b})),b=document.querySelectorAll("#chartMenuCont button"),a=0;a<b.length;a++)b[a].classList.add("disabled");else b.question=virtualclass.poll.dataRec.question,a=virtualclass.getTemplate("stdResult","poll"),$("#virtualclassPoll").append(a({obj:b}));this.resultLayoutBody()},resultNotShownUI:function(b){var a=document.createElement("div"),c=document.getElementById("mszBoxPoll");if(c)for(;0<c.childNodes.length;)c.removeChild(c.childNodes[0]);
b.appendChild(a);b=virtualclass.lang.getString("noResultStd");virtualclass.poll.showMsg("mszBoxPoll",b,"alert-success")},resultLayoutBody:function(b){if(b=document.querySelector("#qnLabelCont"))roles.hasControls()&&(b.innerHTML=virtualclass.poll.dataToStd.question),roles.hasControls()&&(this.chartMenu(),this.createResultMsgCont())},createResultMsgCont:function(b){document.getElementById("pollResultMsz").innerHTML=virtualclass.lang.getString("watstdrespo")},pollClosedUI:function(){var b=document.getElementById("closePoll");
b&&b.parentNode.removeChild(b);if(b=document.getElementById("congreaPollVoters"))b.innerHTML=virtualclass.lang.getString("rvtu");(b=document.getElementById("pollResultMsz"))&&b.parentNode.removeChild(b)},chartMenu:function(b){b=document.querySelector("#chartMenuCont #bar");b.addEventListener("click",virtualclass.poll.barGraph);document.querySelector("#chartMenuCont #pi").addEventListener("click",virtualclass.poll.createPiChart);roles.hasControls()&&(b=document.querySelector("#chartMenuCont #rList"),
b.addEventListener("click",virtualclass.poll.listView))},qnLabel:function(b){var a=document.createElement("div");a.id="chart";a.className="row";b.appendChild(a)},createNav:function(b){roles.hasControls()||document.querySelector(".congrea.student #virtualclassPoll #navigator a").addEventListener("click",function(){virtualclass.poll.showStudentPollReport()});$(function(){$('[data-toggle="popover"]').popover()})},createMszBox:function(b){var a=document.createElement("div");a.id="mszBoxPoll";a.className=
"row";b.appendChild(a)},createOption:function(b,a){for(var c=document.getElementById("optsTxCont").querySelectorAll(":scope .opt"),d=0,h=0;h<c.length;h++){d++;var m=c[h].id}var n=m?d:"0";c={};c.index=n;c.closeBtn=1<n?!0:!1;c=virtualclass.getTemplate("optioninput","poll")({close:c});document.getElementById("addMoreCont");$("#addMoreCont").before(c);c=document.getElementById("remove"+n);c.addEventListener("click",function(){virtualclass.poll.removeOption(a,b,"remove"+n)})},hidePrevious:function(b){(b=
document.getElementById("optsTxCont"))&&b.parentNode.removeChild(b);if(b=document.getElementById("reset"))b.style.display="none";b=document.getElementById("footerCtrCont");b.parentNode.removeChild(b)},editPoll:function(b,a){virtualclass.poll.UI.loadContent(b,a);virtualclass.poll.UI.footerBtns(b,a)},loadContent:function(b,a){document.getElementById("qnTxCont");virtualclass.poll.UI.editQn(b,a);var f=c.options;var d=0;if("object"==typeof f)for(var h in f)console.log(h),d++,virtualclass.poll.UI.editOptions(b,
a,h,d);else for(h=0;h<f.length;h++)virtualclass.poll.UI.editOptions(b,a,h,d)},previewFooterBtns:function(b,a,c){document.getElementById("footerCtrCont")&&virtualclass.poll.pollPopUp(virtualclass.poll.popupFn,c,a)},footerBtns:function(b,a){b&&virtualclass.poll.pollPopUp(virtualclass.poll.popupFn,a,b)},editQn:function(b,a){var c=document.querySelector("#qnTxCont #q");null==c&&(c.value=document.getElementById("qnText"+b+a).innerHTML);null==c||c.value||(c.value="course"==b?virtualclass.poll.coursePoll[a].questiontext:
virtualclass.poll.sitePoll[a].questiontext)},editOptions:function(b,a,c,d){document.getElementById("optsTxCont").style.display="block";document.getElementById("opt"+a+c);if(2<d){var f=document.createElement("a");f.id="remove"+c;f.className="close";f.innerHTML="&times";document.querySelector("#optsTxCont .inputWrapper #option"+c).parentNode.appendChild(f);f.addEventListener("click",function(){virtualclass.poll.removeOption(b,a,f.id)})}d=document.getElementById("option"+c);"course"==b?(c=virtualclass.poll.coursePoll[a].options[c],
d.value="object"==typeof c?c.options:c):(c=virtualclass.poll.sitePoll[a].options[c],d.value="object"==typeof c?c.options:c)},pollSettingUI:function(b,a){var c=virtualclass.getTemplate("setting-modal","poll");$("#editPollModal").empty();$("#editPollModal").append(c({time:function(a,b){var c=[];for(a=b-a+1;a--;)c[a]=b--;return c}(1,60)}));this.settingUIBody(b,a)},settingUIBody:function(b,a){this.addSettingHandlers()},addSettingHandlers:function(){document.getElementById("mode").addEventListener("click",
function(){var b=document.getElementById("radioBtn1"),a=document.getElementById("radioBtn2");b.checked?(b=document.getElementById("timer"),b.setAttribute("disabled",!0),b=document.getElementById("ut"),b.setAttribute("disabled",!0)):a.checked&&(b=document.getElementById("timer"),b.removeAttribute("disabled"),b=document.getElementById("ut"),b.removeAttribute("disabled"))})},defaultLayoutForStudent:function(){this.container();var b=document.getElementById("mszBoxPoll");if(null==document.getElementById("stdPollMszLayout")){var a=
document.createElement("div");a.id="stdPollMszLayout";a.innerHTML=virtualclass.lang.getString("pollmaybeshown");b.appendChild(a)}},stdPublishUI:function(){var b=document.getElementById("stdPollMszLayout");b&&b.parentNode.removeChild(b)},disableClose:function(){document.getElementById("pollClose").style.display="none"}},updateUsersOnPoll:function(){0>virtualclass.poll.uniqueUsers.indexOf(virtualclass.jId)&&(virtualclass.poll.uniqueUsers.push(virtualclass.jId),0<Object.keys(virtualclass.poll.count).length&&
virtualclass.poll.noOfVotes())}}};d.poll=c})(window);var dashBoard={userConfirmation:function(d,c){virtualclass.popup.confirmInput(d,function(b){c(b)})},close:function(){var d=document.querySelector("#congdashboard .modal-content button.close");null!=d&&(d.classList.remove("clicked"),d.click(),d=document.querySelector("#dashboardnav button"),null!=d&&d.classList.remove("clicked"))},isDashBoardExit:function(d){return null!=document.querySelector("#"+d+"Dashboard")},isDashBoardNavExist:function(){return null!=document.querySelector("#dashboardnav")},
actualCloseHandler:function(){var d=document.querySelector("#congdashboard .modal-content button.close");null!=d&&d.addEventListener("click",function(){var c=document.querySelector("#dashboardnav button");null!=c&&(c.classList.remove("clicked"),dashBoard.dashBoardClickTooltip("open"))})},clickCloseButton:function(){var d=document.querySelector("#dashboardnav button");null!=d&&d.classList.add("clicked")},dashBoardClickTooltip:function(d){var c=document.querySelector("#dashboardnav button");"Video"==
virtualclass.currApp?c.parentNode.setAttribute("data-title",virtualclass.lang.getString(d+"videoDashboard")):"SharePresentation"==virtualclass.currApp?c.parentNode.setAttribute("data-title",virtualclass.lang.getString(d+"SharePresentationdbHeading")):"DocumentShare"==virtualclass.currApp?c.parentNode.setAttribute("data-title",virtualclass.lang.getString(d+"dsDbheading")):console.log("dashboard tooltip not working properly")}};(function(d){d.videoUl=function(){return{videos:[],uploaderParam:{},videoObj:{},videoId:"",videoUrl:"",isfullscreen:!1,order:[],currPlaying:"",autoPlayFlag:1,status:0,yts:!1,online:!1,init:function(c,b){this.videoInit=!0;this.currPlaying="";this.pages={};virtualclass.previrtualclass="virtualclassVideo";virtualclass.previous="virtualclassVideo";this.autoPlayFlag=1;"undefined"!=typeof c&&("studentlayout"!=c.init&&(this.videoId=c.init.videoId||c.init,this.videoUrl=c.init.videoUrl,this.yts=c.init.yts,
this.online=c.init.online,this.isPaused=c.init.isPaused),"undefined"!=typeof c.isAutoplay&&(this.autoPlayFlag=c.isAutoplay));if(!roles.hasAdmin()||roles.isEducator()){if("undefined"!=typeof this.videoId||!roles.isStudent()||virtualclass.videoUl.yts)if(this.UI.container(),roles.hasControls())ioAdapter.mustSend({videoUl:{init:"studentlayout"},cf:"videoUl"}),ioAdapter.mustSend({videoUl:{init:{id:virtualclass.videoUl.videoId,videoUrl:virtualclass.videoUl.videoUrl},startFrom:virtualclass.videoUl.player.currentTime()},
cf:"videoUl"});else if("undefined"!=typeof c)if(c.hasOwnProperty("fromReload"))this.fromReload(this.videoId,this.videoUrl,b);else{if(void 0!=this.videoId&&"undefined"!=typeof this.videoId&&("object"!=typeof this.videoId||0!=this.videoId.yts)){var a=c.url||c.init.videoUrl;"undefined"!=typeof a&&""!=a&&"studentlayout"!=c.init&&("undefined"==typeof b?this.UI.displayVideo(c.id,a):this.UI.displayVideo(c.id,a,b))}}else if(b=document.getElementById("messageLayoutVideo"))b.style.display="block"}else this.UI.container(),
c=document.querySelector("#dashboardnav button"),null!=c&&c.click(),"undefined"!=typeof b?this.fromReload(this.videoId,this.videoUrl,b):ioAdapter.mustSend({videoUl:{init:"studentlayout"},cf:"videoUl"})},createPageModule:function(){virtualclass.videoUl.videos&&virtualclass.videoUl.videos.length&&virtualclass.videoUl.videos.forEach(function(c,b){virtualclass.videoUl.pages[c.id]=new virtualclass.page("videoList","video","virtualclassVideo","videoUl",c.status)})},reArrangeElements:function(c){var b=document.getElementById("listvideo"),
a=document.createElement("div");a.id="listvideo";a.className="videos";var f=this.getActiveVideos(),d=!1;for(j=0;j<f.length;j++)-1>=c.indexOf(f[j].fileuuid)&&(c.push(f[j].fileuuid),d=!0);d&&(virtualclass.videoUl.order=c,virtualclass.videoUl.sendOrder(virtualclass.videoUl.order));for(f=0;f<c.length;f++)(d=document.getElementById("linkvideo"+c[f]))&&a.appendChild(d);b.parentNode.replaceChild(a,b)},getActiveVideos:function(){for(var c=[],b=0;b<virtualclass.videoUl.videos.length;b++)virtualclass.videoUl.videos[b].hasOwnProperty("deleted")||
c.push(virtualclass.videoUl.videos[b]);return c},fromReload:function(c,b,a){virtualclass.videoUl.UI.container();b?virtualclass.videoUl.UI.displayVideo(c,b,a):(b={},b.init=c,virtualclass.yts.init(b,a))},saveVideosInLocalStr:function(){console.log(virtualclass.videoUl.order);console.log("videosinlocalstorage");console.log(virtualclass.videoUl.videos);localStorage.setItem("videoList",JSON.stringify(virtualclass.videoUl.videos));localStorage.setItem("videoOrder",JSON.stringify(virtualclass.videoUl.order))},
requestOrder:function(){virtualclass.vutil.requestOrder("vid",function(c){"Error"==c?console.log("page order retrieve failed"):"undefined"!=typeof c&&void 0!=c&&(virtualclass.videoUl.order=[],virtualclass.videoUl.order=c,0<virtualclass.videoUl.order.length&&virtualclass.videoUl.reArrangeElements(virtualclass.videoUl.order))})},afterDocStatus:function(c){},updateOrder:function(){var c=this.getActiveVideos();c.length!=this.order.length&&(this.order=c.map(function(b){return b.fileuuid}));this.sendOrder(this.order)},
afterUploadVideo:function(c,b,a){if(a=a.success){this.updateOrder();virtualclass.videoUl.order.push(virtualclass.gObj.file.uuid);virtualclass.videoUl.sendOrder(virtualclass.videoUl.order);virtualclass.videoUl.showUploadMsz("Video uploaded successfully","alert-success");for(c=0;c<virtualclass.gObj.uploadingFiles.length;c++)b={},b.filename=virtualclass.gObj.uploadingFiles[c].name+" (Processing...)",b.fileuuid=virtualclass.gObj.uploadingFiles[c].uuid,b.filetype="video",b.key_room=virtualclass.gObj.sessionInfo.key+
"_"+virtualclass.gObj.sessionInfo.room,b.noVideo=!0,console.log("File uploading "+b.filename),this.afterUploadFile(b);virtualclass.gObj.uploadingFiles=[];virtualclass.serverData.pollingStatus(virtualclass.videoUl.UI.awsVideoList)}else virtualclass.videoUl.showUploadMsz("video upload failed","alert-error");if(c=document.querySelector("#videoPopup .qq-upload-list-selector.qq-upload-list"))c.style.display="none"},showUploadMsz:function(c,b){var a=document.querySelector("#VideoDashboard #uploadMsz"),
f=document.querySelector("#VideoDashboard #uploadMsz .alert");f&&f.parentNode.removeChild(f);f=document.createElement("div");f.className="alert  alert-dismissable";f.classList.add(b);f.innerHTML=c;a.appendChild(f);c=document.createElement("button");c.className="close";c.setAttribute("data-dismiss","alert");c.innerHTML="&times";c.addEventListener("click",function(){var a=document.querySelector("#uploadMsz");a&&(a.style.display="none")});f.appendChild(c)},retrieveOrder:function(){this.requestOrder()},
afterUploadFile:function(c){var b=c.fileuuid;this.pages[b]=new virtualclass.page("videoList","video","virtualclassVideo","videoUl",c.status,c.filetype);if("video_yts"==c.filetype){var a=virtualclass.videoUl.getVideoId(c.URL);virtualclass.videoUl.UI.fetchYtsTitle(c,a)}this.pages[b].init(b,c.filename);this.videoDisplayHandler(c);b=document.getElementById("linkvideo"+c.fileuuid);if(a=document.getElementById("videoTitle"+c.fileuuid))a.innerHTML=c.filename;a=b.getElementsByClassName("status")[0];c.hasOwnProperty("disabled")?
(this._disable(c.fileuuid),b&&(b.classList.add("disable"),b.dataset.status=0)):(this._enable(c.fileuuid),b&&(b.classList.add("enable"),b.dataset.status=1));a.dataset.status=b.dataset.status;this.calculateHeight();c.hasOwnProperty("noVideo")&&b.classList.add("noVideo")},calculateHeight:function(){var c=document.querySelector("#listvideo"),b=document.querySelector(".congrea .qq-uploader-selector");console.log(c.offsetHeight);c=c.offsetHeight;console.log(b.offsetHeight);$(".qq-uploader-selector").css({minHeight:c})},
showVideos:function(c,b){roles.hasControls()&&virtualclass.videoUl.showVideoList();virtualclass.videoUl.videoUrl&&(virtualclass.videoUl.activeVideoClass(virtualclass.videoUl.videoId),virtualclass.vutil.showFinishBtn())},showVideoList:function(){document.getElementById("videoList");var c=document.getElementById("listvideo");if(c)for(var b=0;b<c.childNodes.length-1;b++)c.childNodes[b].parentNode.removeChild(c.childNodes[b]);virtualclass.videoUl.videos&&virtualclass.videoUl.videos.length&&virtualclass.videoUl.videos.forEach(function(a,
b){a.hasOwnProperty("deleted")||(b=document.querySelector("#linkvideo"+a.fileuuid),null!=b&&b.classList.remove("noVideo"),virtualclass.videoUl.afterUploadFile(a))});virtualclass.vutil.makeElementActive("#listvideo")},videoDisplayHandler:function(c){var b=document.getElementById("mainpvideo"+c.fileuuid);b&&!c.status?b.classList.contains("playDisable")||b.classList.add("playDisable"):b&&b.classList.contains("playDisable")&&b.classList.remove("playDisable");b&&b.addEventListener("click",function(){virtualclass.videoUl.isPaused=
!1;"video_yts"==c.filetype?(virtualclass.videoUl.yts=!0,virtualclass.videoUl.online=!1):"video_online"==c.filetype?(virtualclass.videoUl.yts=!1,virtualclass.videoUl.online=!0):(virtualclass.videoUl.yts=!1,virtualclass.videoUl.online=!1);var a=c.urls.main_video;virtualclass.videoUl.UI.displayVideo(c.fileuuid,a);virtualclass.videoUl.activeVideoClass(c.fileuuid);var b={};b.content_path=a;b.id=c.fileuuid;b.title=c.filename;b.type=c.filetype;virtualclass.videoUl.videoToStudent(b);virtualclass.videoUl.videoId=
c.fileuuid;virtualclass.vutil.showFinishBtn();virtualclass.dashBoard.close()})},activeVideoClass:function(c){for(var b=document.getElementsByClassName("controlCont"),a=0;a<b.length;a++)b[a].classList.contains("removeCtr")&&b[a].classList.remove("removeCtr");(b=document.getElementById("controlContvideo"+c))&&!b.classList.contains("removeCtr")&&b.classList.add("removeCtr");b=document.getElementsByClassName("linkvideo");for(a=0;a<b.length;a++)b[a].classList.contains("playing")&&b[a].classList.remove("playing");
(c=document.getElementById("linkvideo"+c))&&!c.classList.contains("playing")&&c.classList.add("playing")},shareVideo:function(c){var b={};virtualclass.videoUl.UI.displayVideo("no",c);b.instantVideo=!0;b.content_path=c;virtualclass.videoUl.videoToStudent(b)},destroyPl:function(){"object"==typeof virtualclass.videoUl.player&&("ScreenShare"==virtualclass.currApp&&ioAdapter.mustSend({video:"destroyPl",cf:"video"}),virtualclass.videoUl.player.dispose())},_rearrange:function(c){this.order=c;this.reArrangeElements(c);
this.sendOrder(this.order)},_editTitle:function(c,b,a){a=new FormData;var f={lc_content_id:c,action:"edit",title:b,user:virtualclass.gObj.uid};a=new FormData;for(var g in f)a.append(g,f[g]),console.log(f[g]);virtualclass.xhr.sendFormData(a,d.webapi+"&user="+virtualclass.gObj.uid+"&methodname=update_content_video",function(a){"ERROR"!=a&&(a=document.getElementById("videoTitle"+c))&&(a.innerHTML=b,a.style.display="inline",virtualclass.videoUl.videos&&virtualclass.videoUl.videos.length&&virtualclass.videoUl.videos.forEach(function(a,
f){a.id==c&&(console.log(a),a.title=b)}))})},sendOrder:function(c,b){virtualclass.vutil.sendOrder("vid",c)},onNewUser:function(c){console.log("videoUl");virtualclass.videoUl.videoId=c.videoUl.init.id;virtualclass.videoUl.videoUrl=c.videoUl.init.videoUrl;virtualclass.videoUl.UI.displayVideo(c.videoUl.init.id,c.videoUl.init.videoUrl,c.videoUl.startFrom)},onmessage:function(c){if("string"==typeof c.videoUl)if("play"==c.videoUl)this.playVideo(c),virtualclass.videoUl.isPaused=!1;else if("pause"==c.videoUl)this.pauseVideo(),
virtualclass.videoUl.isPaused=!0;else if("destroyPlayer"==c.videoUl)virtualclass.videoUl.destroyPlayer();else if("enterFullScreen"==c.videoUl)virtualclass.videoUl.enterFullScreen();else if("exitFullScreen"==c.videoUl)virtualclass.videoUl.exitFullScreen();else{if("videoDelete"==c.videoUl&&(c=document.querySelector("#videoPlayerCont"))){c.style.display="none";if(c=document.querySelector("#messageLayoutVideo"))c.style.display="block";virtualclass.videoUl.videoId=null;virtualclass.videoUl.videoUrl=null;
c=document.querySelector(".congrea #dispVideo video");var b=document.querySelector(".congrea #dispVideo iframe");(c=c?c:b)&&c.setAttribute("src","")}}else this.onmessageObj(c)},onmessageObj:function(c){c.videoUl.type&&("video_yts"==c.videoUl.type?(virtualclass.videoUl.yts=!0,virtualclass.videoUl.online=!1):"video_online"==c.videoUl.type?(virtualclass.videoUl.online=!0,virtualclass.videoUl.yts=!1):(virtualclass.videoUl.yts=!1,virtualclass.videoUl.online=!1));if(c.videoUl.hasOwnProperty("init"))if(virtualclass.videoUl.rec=
c.videoUl,console.log(virtualclass.videoUl.rec),"studentlayout"==c.videoUl.init){if(virtualclass.makeAppReady("Video",void 0,c.videoUl),c=document.getElementById("messageLayoutVideo"))c.style.display="block"}else c.videoUl.init.hasOwnProperty("videoUrl")&&(virtualclass.videoUl.videoId=c.videoUl.init.id,virtualclass.videoUl.videoUrl=c.videoUl.init.videoUrl,virtualclass.videoUl.UI.displayVideo(c.videoUl.init.id,c.videoUl.init.videoUrl,c.videoUl.startFrom));else c.videoUl.hasOwnProperty("content_path")?
(virtualclass.videoUl.videoId=c.videoUl.id,virtualclass.videoUl.videoUrl=c.videoUl.content_path,virtualclass.videoUl.title=c.videoUl.title,virtualclass.videoUl.UI.displayVideo(c.videoUl.id,virtualclass.videoUl.videoUrl)):c.videoUl.hasOwnProperty("play")&&(this.playVideo(c.videoUl.play),virtualclass.videoUl.isPaused=!1)},enablePlayer:function(){var c=document.getElementById("videoPlayerCont");c&&(c.style.display="block")},disablePlayer:function(){var c=document.getElementById("videoPlayerCont");c&&
(c.style.display="none")},destroyPlayer:function(){virtualclass.videoUl.player.dispose()},playVideo:function(c){virtualclass.videoUl.player.currentTime(c);virtualclass.videoUl.player.play()},pauseVideo:function(){virtualclass.videoUl.player.pause();virtualclass.videoUl.isPaused=!0},autoPlayList:function(c){var b=this.getActiveVideos();c=this.findNextObj(c);"object"!=typeof c?c<b.length&&(c=this.autoPlayList(c)):(b={},b.id=c.fileuuid,b.title=c.filename,b.type=c.filetype,virtualclass.videoUl.listEnd||
("video_online"==c.filetype?(virtualclass.videoUl.yts=!1,virtualclass.videoUl.online=!0,virtualclass.videoUl.UI.displayVideo(c.fileuuid,c.URL),virtualclass.videoUl.videoToStudent(c),this.activeVideoClass(c.id),b.content_path=c.URL):(virtualclass.videoUl.online=!1,"video_yts"==c.filetype?(virtualclass.videoUl.yts=!0,virtualclass.videoUl.UI.displayVideo(c.fileuuid,c.URL),b.content_path=c.URL):(virtualclass.videoUl.yts=!1,virtualclass.videoUl.UI.displayVideo(c.fileuuid,c.urls.main_video),b.content_path=
c.urls.main_video),virtualclass.videoUl.videoToStudent(b)),virtualclass.videoUl.player&&virtualclass.videoUl.player.ready(function(){this.play()}),this.activeVideoClass(c.fileuuid)))},findNextObj:function(c){for(var b=this.findNextVideoId(c),a=this.getActiveVideos(),f=0;f<a.length;f++)if(a[f].fileuuid==b)return"1"==document.getElementById("linkvideo"+a[f].fileuuid).getAttribute("data-status")?c=a[f]:c+1},findNextVideoId:function(c){var b=document.querySelectorAll("#listvideo .linkvideo");return c<
b.length?b[c].getAttribute("data-rid"):!1},findVideoIndex:function(c){for(var b=document.querySelectorAll("#listvideo .linkvideo"),a=0;a<b.length;a++)if(b[a].getAttribute("data-rid")==c)return c=a},_disable:function(c){document.querySelector("#linkvideo"+c).classList.add("playDisable");var b=document.getElementById("mainpvideo"+c);b.style.opacity=.3;b.style.pointerEvents="none";virtualclass.videoUl.videos&&virtualclass.videoUl.videos.length&&virtualclass.videoUl.videos.forEach(function(a,b){a.fileuuid==
c&&(a.disabled=0,a.status=0)})},_enable:function(c){document.querySelector("#linkvideo"+c).classList.remove("playDisable");var b=document.getElementById("mainpvideo"+c);b&&(b.style.opacity=1,b.style.pointerEvents="auto",virtualclass.videoUl.videos&&virtualclass.videoUl.videos.length&&virtualclass.videoUl.videos.forEach(function(a,b){a.fileuuid==c&&(delete a.disabled,a.status=1)}))},_delete:function(c){var b=this;virtualclass.xhrn.sendData({uuid:c,action:"delete",page:0},virtualclass.api.UpdateDocumentStatus,
function(a){b.afterDeleteCallback(a,c)})},afterDeleteCallback:function(c,b){if("ERROR"!=c&&(c=document.getElementById("linkvideo"+b))){c.parentNode.removeChild(c);if(virtualclass.videoUl.videoId==b&&(c=document.querySelector("#videoPlayerCont"))){c.style.display="none";ioAdapter.mustSend({videoUl:"videoDelete",cf:"videoUl"});virtualclass.videoUl.videoId=null;virtualclass.videoUl.videoUrl=null;c=document.querySelector(".congrea #dispVideo video");var a=document.querySelector(".congrea #dispVideo iframe");
(c=c?c:a)&&c.setAttribute("src","");virtualclass.vutil.removeFinishBtn()}virtualclass.videoUl.videos&&virtualclass.videoUl.videos.length&&virtualclass.videoUl.videos.forEach(function(a,c){a.fileuuid==b&&(c=virtualclass.videoUl.videos.indexOf(a),0<=c&&(virtualclass.videoUl.videos.splice(c,1),console.log(virtualclass.videoUl.videos)))});c=virtualclass.videoUl.order.indexOf(b);0<=c&&(virtualclass.videoUl.order.splice(c,1),console.log(virtualclass.videoUl.order),virtualclass.videoUl.sendOrder(virtualclass.videoUl.order));
virtualclass.videoUl.videos.length||virtualclass.vutil.removeFinishBtn()}},xhrOrderSend:function(c){virtualclass.xhrn.sendData({order:c.toString()},virtualclass.api.UpdateRoomMetaData,function(){virtualclass.serverData.fetchAllData(virtualclass.videoUl.UI.awsVideoList)})},videoToStudent:function(c){ioAdapter.mustSend({videoUl:c,cf:"videoUl"})},getVideoId:function(c){c=c.match(/^.*(?:(?:youtu\.be\/|v\/|vi\/|u\/\w\/|embed\/)|(?:(?:watch)?\?v(?:i)?=|&v(?:i)?=))([^#&\?]*).*/);return null!=c&&1<c.length&&
(c=c[1].substring(0,11),11==c.length)?c:!1},UI:{id:"virtualclassVideo",class:"bootstrap virtualclass",container:function(){if(!document.getElementById("virtualclassVideo")){var c={control:roles.hasAdmin()?!0:!1};virtualclass.vutil.insertAppLayout((0,JST["templates/videoupload/videoupload.hbs"])(c));document.getElementById(this.id)}!roles.hasControls()&&(c=document.getElementById("messageLayoutVideo"))&&(c.style.display="block")},createYoutubeUrlCont:function(c){var b=document.createElement("div");
b.id="listvideo";c.appendChild(b)},displayVideo:function(c,b,a){"object"==typeof virtualclass.videoUl.player&&virtualclass.videoUl.player.hasOwnProperty("dispose")&&virtualclass.videoUl.player.dispose();virtualclass.videoUl.videoUrl=b;virtualclass.videoUl.videoId=c;var f=document.getElementById("videoPlayerCont");f&&(f.style.display="block");$("iframe#player").length&&$("iframe#player").remove();virtualclass.videoUl.UI.switchDisplay(f,b);virtualclass.videoUl.UI.videojsPlayer(b,c,a)},videojsPlayer:function(c,
b,a){if(!virtualclass.videoUl.player){var f=videojs("dispVideo");if(roles.hasControls()){$(".vjs-autoPlay-button").length||virtualclass.videoUl.UI.appendAutoPlayButton(f);var d=document.getElementById("autoPlayListBtn");d&&(d.className=virtualclass.videoUl.autoPlayClass)}virtualclass.videoUl.player=f;virtualclass.videoUl.UI.attachPlayerHandler(virtualclass.videoUl.player,b,c)}virtualclass.videoUl.UI.onEndedHandler(virtualclass.videoUl.player,b,c);virtualclass.videoUl.UI.setPlayerUrl(virtualclass.videoUl.player,
c,a)},attachPlayerHandler:function(c,b,a){c.on("pause",function(a){console.log("paused");roles.hasControls()&&ioAdapter.mustSend({videoUl:"pause",cf:"videoUl"});virtualclass.videoUl.isPaused=!0});c.on("play",function(a){console.log("play");roles.hasControls()&&ioAdapter.mustSend({videoUl:{play:c.currentTime()},cf:"videoUl"});virtualclass.videoUl.isPaused=!1})},switchDisplay:function(c,b){var a=document.getElementById("dispVideo");a?a.style.display="block":virtualclass.videoUl.UI.createVideoElem(c);
a=document.getElementById("videoPlayerCont");c=document.getElementById("messageLayoutVideo");"undefined"==typeof b?(a.style.display="none",c?c.style.display="block":(a=document.createElement("div"),a.id="messageLayoutVideo")):(a.style.display="block",c&&(c.style.display="none"))},createVideoElem:function(c,b){b=virtualclass.videoUl.yts?"<video id=dispVideo class=video-js controls  preload=auto data-setup='{ techOrder: [youtube], sources: [{ type: video/youtube}] }' >":'<video id="dispVideo" class="video-js" controls  preload="auto" data-setup="{}" >';
$(c).append(b);c=document.createElement("p");c.setAttribute("class","vjs-no-js");document.getElementById("dispVideo").appendChild(c);b=document.createElement("a");b.setAttribute("href","https://videojs.com/html5-video-support/");b.setAttribute("target","_blank");b.innerHTML="supports HTML5 video";c.appendChild(b)},setPlayerUrl:function(c,b,a){c.poster_&&(c.poster_="");var f=document.querySelector("#dispVideo");virtualclass.videoUl.yts?(f.setAttribute("data-setup",'{ techOrder: [youtube],"preload": "auto"}'),
c.src({type:"video/youtube",src:b})):virtualclass.videoUl.online?(f.setAttribute("data-setup",'{"preload": "auto" }'),c.src({type:"video/webm",src:b}),c.src({type:"video/mp4",src:b})):(f.setAttribute("data-setup",'{"preload": "auto"}'),c.src({type:"application/x-mpegURL",withCredentials:!0,src:b}));c.ready(function(){virtualclass.videoUl.isPaused?this.paused():this.play();a&&this.currentTime(a)});console.log(a)},appendAutoPlayButton:function(c){virtualclass.videoUl.autoPlayClass=virtualclass.videoUl.autoPlayFlag?
"vjs-autoPlay-button vjs-control on":"vjs-autoPlay-button vjs-control off";c.controlBar.addChild("button",{el:videojs.createEl("button",{className:"vjs-autoPlay-button vjs-control on",id:"autoPlayListBtn",role:"button",title:"Auto Play",onclick:function(){virtualclass.videoUl.UI.autoPlayFn(this)}})})},autoPlayFn:function(c){c.classList.contains("off")?(virtualclass.videoUl.autoPlayFlag=1,c.classList.remove("off"),c.classList.add("on"),c.style.color="green"):(virtualclass.videoUl.autoPlayFlag=0,c.classList.remove("on"),
c.classList.add("off"),c.style.color="red")},onEndedHandler:function(c,b,a){c.off("ended");c.on("ended",function(f){virtualclass.videoUl.UI.onEnded(c,b,a)})},onEnded:function(c,b,a){c.reset();var f=document.querySelector("#dispVideo");virtualclass.videoUl.yts?(f.setAttribute("data-setup","{ techOrder: [youtube],controls: true,}"),c.src({type:"video/youtube",src:a})):virtualclass.videoUl.online?(f.setAttribute("data-setup",'{"preload": "auto", "controls": true, }'),c.src({type:"video/webm",src:a}),
c.src({type:"video/mp4",src:a})):(f.setAttribute("data-setup",'{"preload": "auto", "controls": true, }'),c.src({type:"application/x-mpegURL",withCredentials:!0,src:a}));console.log("ended"+b);a=document.querySelectorAll("#listvideo .linkvideo");for(var d=f=0;d<a.length;d++)if(a[d].getAttribute("data-rid")==b){f=d;break}virtualclass.videoUl.autoPlayFlag&&(c.poster_&&(c.poster_=""),virtualclass.videoUl.findNextVideoId(f+1)?virtualclass.videoUl.autoPlayList(f+1,a):virtualclass.videoUl.isPaused=!0)},
inputUrl:function(){document.getElementById("congreaShareVideoUrlCont");var c=document.getElementById("messageLayout");null!=c&&c.parentNode.removeChild(c);document.getElementById("submitURL").addEventListener("click",function(){var b=document.querySelector(".congrea #videourl");virtualclass.videoUl.UI.validateURL(b.value)&&($(".congrea #listvideo .playing").removeClass("playing"),$(".congrea #listvideo .removeCtr").removeClass("removeCtr"),b=virtualclass.vutil.createHashString(b.value)+virtualclass.vutil.randomString(32).slice(1,
-1),virtualclass.videoUl.UI.saveYtsUrl(b))});(c=document.querySelector(".congrea #newVideoBtn"))&&c.addEventListener("click",function(){var b=document.querySelector(".congrea #congreavideoContBody");b.style.display="block";b=document.querySelector(".congrea #listvideo");b.style.display="none"})},saveYtsUrl:function(c){var b=document.querySelector(".congrea #videourl"),a={};a.uuid=c;a.URL=b.value;a.title=b.value;c=virtualclass.api.addURL;"boolean"==typeof virtualclass.videoUl.getVideoId(b.value)?a.type=
"video_online":a.type="video_yts";virtualclass.xhrn.sendData(a,c,function(b){virtualclass.videoUl.updateOrder();virtualclass.videoUl.order.push(a.uuid);virtualclass.videoUl.sendOrder(virtualclass.videoUl.order);virtualclass.serverData.fetchAllData(virtualclass.videoUl.UI.awsVideoList)});document.querySelector(".congrea #videourl").value=""},fetchYtsTitle:function(c,b){$.getJSON("https://www.googleapis.com/youtube/v3/videos",{key:"AIzaSyCt1SQWwanpucKGFlzytu-mDdr6vRKzJGA",part:"snippet,statistics",
id:b},function(a){0===a.items.length?console.log("video not found"):(a=a.items[0].snippet.title,virtualclass.videoUl.UI.setYtsTitle(c,a))}).fail(function(a,b,c){console.log("unable to fetch you tube title");return"ERROR"})},validateURL:function(c){return null==c.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g)?(virtualclass.popup.validateurlPopup(),!1):!0},setYtsTitle:function(c,b){if(c=document.querySelector("#listvideo #videoTitle"+c.fileuuid))c.innerHTML=
b},removeinputURL:function(){var c=document.getElementById("youtubeUrlContainer");null!=c&&c.parentNode.removeChild(c)},popup:function(c){c={};0<$("#listvideo .linkvideo.playing").length&&(this.currPlaying=$("#listvideo .linkvideo.playing").attr("data-rid"));c.validation="avi flv wmv mov mp4 webm mkv vob ogv ogg drc mng qt yuv rm rmvb asf amv m4p m4v mpg mp2 mpeg mpe mpv m2v svi 3gp 3g2 mxf roq nsv f4v f4p f4a f4b".split(" ");c.cb=virtualclass.videoUl.afterUploadVideo;c.cthis="video";c.multiple=!1;
c.maxSize=209715200;c.requesteEndPoint=d.webapi+"&methodname=file_save&live_class_id="+virtualclass.gObj.congCourse+"&status=1&content_type_id=2&user="+virtualclass.gObj.uid;c.wrapper=document.getElementById("congreavideoContBody");virtualclass.fineUploader.uploaderFn(c);virtualclass.videoUl.UI.inputUrl();virtualclass.vutil.isBulkDataFetched()&&virtualclass.videoUl.videos.length?(virtualclass.videoUl.showVideos(virtualclass.videoUl.videos),0<virtualclass.videoUl.order.length&&virtualclass.videoUl.reArrangeElements(virtualclass.videoUl.order)):
virtualclass.serverData.fetchAllData(virtualclass.videoUl.UI.awsVideoList);(c=document.querySelector("#virtualclassCont.congrea #VideoDashboard .qq-uploader.qq-gallery"))&&c.setAttribute("qq-drop-area-text","Drop videos here");c=document.querySelector("#uploadMsz");var b=document.querySelector("#videoPopup .qq-upload-list-selector.qq-upload-list");b&&(b.style.display="block");var a=document.createElement("div");c.appendChild(a);a.appendChild(b);var f=$("#videoPopup .qq-upload-list-selector.qq-upload-button input");
$("#uploadVideo").click(function(){var a=document.querySelector("#uploadMsz");a&&(a.style.display="block");f.click()})},awsr:function(){this.postAjax(virtualclass.api.GetDocumentURLs,"Demo")},awsVideoList:function(){for(var c=virtualclass.awsData,b=[],a=0;a<c.length;a++)"video"!=c[a].filetype&&"video_yts"!=c[a].filetype&&"video_online"!=c[a].filetype||c[a].hasOwnProperty("deleted")||b.push(c[a]);console.log(b);virtualclass.videoUl.videos=b;virtualclass.serverData.rawData.video=b;virtualclass.videoUl.showVideos(b);
virtualclass.videoUl.retrieveOrder()}}}}})(window);(function(d){var c=function(){return{generateModal:function(b,a){var c=document.getElementById(b+"PopupCont");elem1Id="congreaVideoContBody";elem2Id="congreaShareVideoUrlCont";var d=document.createElement("div");d.id=b+"Popup";d.className="modal";d.role="dialog";d.style.display="none";d.setAttribute("tab-index","-1");d.setAttribute("area-hidden","true");c.appendChild(d);b=document.createElement("div");b.className="modal-dialog";d.appendChild(b);d=document.createElement("div");d.className="modal-content";
d.id="videoModalBody";b.appendChild(d);b=document.createElement("div");b.id="contHead";b.className="modal-header";d.appendChild(b);c=document.createElement("button");c.type="button";c.className="close";c.id="modalClose";c.setAttribute("data-dismiss","modal");c.innerHTML="&times";b.appendChild(c);var h=document.createElement("div");h.id="modalcontBody";h.className="modal-body";d.appendChild(h);a.forEach(function(a){virtualclass.fineUploader.createElems(h,a)});a=document.createElement("form");a.id=
"form1";d.appendChild(a);a=document.createElement("div");a.id="contFooter";a.className="modal-footer";d.appendChild(a)},createElems:function(b,a){var c=document.createElement("div");c.id=a;c.className="upload";b.appendChild(c)},initModal:function(b){$("#"+b+"Popup").modal({backdrop:"static",keyboard:!1});$("#"+b+"Popup").modal({show:!0});$("#"+b+"Popup").on("hidden.bs.modal",function(){$("#"+b+"Popup").remove()})},uploaderFn:function(b){new qq.s3.FineUploader({element:b.wrapper,template:"qq-template-gallery",
debug:!0,multiple:b.multiple,validation:{allowedExtensions:b.validation,minSizeLimit:4096,sizeLimit:b.maxSize},request:{endpoint:virtualclass.api.uploadMedia,accessKey:"AKIAJV7RJOFBDFVY62EQ"},signature:{endpoint:virtualclass.api.upload,version:4,customHeaders:{"x-api-key":wbUser.lkey,"x-congrea-authuser":wbUser.auth_user,"x-congrea-authpass":wbUser.auth_pass,"x-congrea-room":wbUser.room}},uploadSuccess:{endpoint:virtualclass.api.uploadSuccess,customHeaders:{"x-api-key":wbUser.lkey,"x-congrea-authuser":wbUser.auth_user,
"x-congrea-authpass":wbUser.auth_pass,"x-congrea-room":wbUser.room}},retry:{enableAuto:!1},cors:{allowXdr:!0,expected:!0,sendCredentials:!1},objectProperties:{key:function(a){var b=wbUser.lkey,c=wbUser.room;virtualclass.gObj.file={};virtualclass.gObj.file.uuid=this.getUuid(a);virtualclass.gObj.file.name=this.getName(a);var d={name:this.getName(a),uuid:this.getUuid(a)};virtualclass.gObj.uploadingFiles.push(d);virtualclass.gObj.sessionInfo={key:b,room:c};return b+"/"+c+"/"+virtualclass.gObj.file.uuid+
"/"+this.getName(a)}},callbacks:{onComplete:function(a,c,d){if("video"==b.cthis){b.cb.call(virtualclass.videoUl,a,c,d);if(a=document.querySelector("#videoPopup .qq-upload-list-selector.qq-upload-list"))a.style.display="none";virtualclass.vutil.makeElementActive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery");virtualclass.vutil.makeElementActive("#listvideo");a=document.querySelector("#uploadMsz .qq-upload-list-selector.qq-upload-list");null!=a&&(a.style.display="block");virtualclass.vutil.removeChildrens("#VideoDashboard #uploadMsz .qq-upload-list-selector.qq-upload-list li");
var f=document.querySelector("#VideoDashboard")}else"docs"==b.cthis&&(b.cb.call(virtualclass.dts,a,c,d),virtualclass.vutil.makeElementActive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery"),virtualclass.vutil.makeElementActive("#listdocs"),a=document.querySelector("#docsuploadContainer #docsUploadMsz .qq-upload-list-selector.qq-upload-list"),null!=a&&(a.style.display="block"),virtualclass.vutil.removeChildrens("#docsUploadMsz .qq-upload-list-selector.qq-upload-list li"),f=document.querySelector("#DocumentShareDashboard"));
null!=f&&f.classList.remove("uploading")},onError:function(){var a=document.querySelector(".dbContainer .alert");a&&a.parentNode.removeChild(a);if("video"==b.cthis){if(a=document.querySelector("#videoPopup .qq-upload-list-selector.qq-upload-list"))a.style.display="none";virtualclass.vutil.makeElementActive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery");virtualclass.vutil.makeElementActive("#listvideo")}else if("docs"==b.cthis){if(a=document.querySelector("#DocumentShareDashboard .qq-upload-list-selector.qq-upload-list"))a.style.display=
"none";virtualclass.vutil.makeElementActive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery");virtualclass.vutil.makeElementActive("#listdocs")}},onSubmitted:function(){if("video"==b.cthis)var a="#uploadMsz",c="#VideoDashboard";else"docs"==b.cthis&&(a="#docsUploadMsz",c="#DocumentShareDashboard");document.querySelector(c).classList.add("uploading");c=document.querySelector(a+" .close");null!=c&&c.click();c=document.querySelector(a);null!=c&&(c.style.display="block");document.querySelector(a+
" .qq-upload-list-selector.qq-upload-list").style.display="block"}}})},onDragEnter:function(b){"DocumentShare"==virtualclass.currApp?(virtualclass.vutil.makeElementDeactive("#listnotes"),virtualclass.vutil.makeElementActive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery")):"Video"==virtualclass.currApp&&(virtualclass.vutil.makeElementDeactive("#listvideo"),virtualclass.vutil.makeElementActive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery"))},onDragEnd:function(b){}}}();
d.fineUploader=c})(window);(function(d,c){var b=function(a,b,c,d,m,n){this.appId=c;this.id=null;this.parent="undefined"!=typeof a?a:null;this.status="undefined"!=typeof m?m:1;this.type=b;this.module=d;"video"==b&&(this.videoClass=n)};b.prototype.init=function(a,b){this.rid=a;this.id=this.type+a;"undefined"!=typeof b&&(this.title=b);roles.hasControls()&&(a=c.getElementById(this.parent),null==c.querySelector("#link"+this.id)&&this.createPageNav(a))};b.prototype.createPageNav=function(a){var b=c.getElementById("list"+this.type),
d="link"+this.type+this.rid;a={rid:this.rid,status:this.status,id:this.id,type:this.type,title:this.title,titleAction:1==this.status?"Hide":"Show"};if("video"==this.type){if(b=c.getElementById("listvideo")){a=this.UI.createPageNavLink2.call(this,b);var h=virtualclass.getTemplate("linkvideo","videoupload");$(b).append(h(a));b=c.getElementById(this.type+"Title"+this.rid);b.innerHTML=this.title;b.dataset.title=this.title;this.UI.controller.init(this,d)}}else if("docs"==this.type)h=virtualclass.getTemplate("docsNav",
virtualclass.dts.tempFolder),a.title=virtualclass.vutil.trimExtension(a.title),b.insertAdjacentHTML("beforeend",h(a)),this.UI.controller.init(this,d);else if("notes"==this.type){h=virtualclass.getTemplate("notesNav",virtualclass.dts.tempFolder);var m=virtualclass.dts.getNote(this.rid);a.content_path=m.thumbnail;b.insertAdjacentHTML("beforeend",h(a));this.UI.controller.init(this,d)}else"ppt"==this.type&&(b=c.getElementById("listppt"))&&(a=this.UI.createPageNavLink2.call(this,b),h=virtualclass.getTemplate("linkPpt",
"ppt"),$(b).append(h(a)),b=c.getElementById(this.type+"Title"+this.rid),b.innerHTML=this.title,b.dataset.title=this.title,this.UI.controller.init(this,d));d=c.getElementById("mainp"+this.id);this.createPageNavAttachEvent(d)};b.prototype.createPageNavAttachEvent=function(a){if("docs"==this.type){var b=virtualclass.dts;a=a.closest(".linkdocs");null!=a?a.onclick=b.docs.goToDocs(this.rid):alert("Element is null")}else"notes"==this.type&&(a.onclick=virtualclass.dts.docs.goToNavs(this.rid))};b.prototype.displayContent=
function(a,b){c.getElementById(a);a.appendChild(b)};b.prototype.sendUpdate=function(a){a.type=this.type;a.id=this.rid;b.prototype.xhrSend(a)};b.prototype.xhrSend=function(a){var b=new FormData,c;for(c in a)b.append(c,a[c]);virtualclass.xhr.sendFormData(b,d.webapi+"&user="+virtualclass.gObj.uid+("SharePresentation"!=virtualclass.currApp?"&methodname=update_content":"&methodname=update_content_video"),this.onServerResponse)};b.prototype.sendStatus2=function(a){"notes"==this.type?a.page_id=this.rid:
a.lc_content_id=this.rid;this.xhrSend(a)};b.prototype.sendStatus=function(a){if("notes"==this.type){var b=this.rid.split("_");a.uuid=b[0];a.page=parseInt(b[1])}else a.uuid=this.rid,a.page=0;virtualclass.xhrn.sendData(a,virtualclass.api.UpdateDocumentStatus,function(a){console.log("Msg "+a)})};b.prototype.rearrange=function(){var a=c.querySelectorAll("#list"+this.type+" .link"+this.type),b=[];if(null!=a)for(var d=0;d<a.length;d++)b.push(a[d].dataset.rid);0<b.length?(this.sendUpdate({content_order:b.toString(),
content_order_type:this.type}),"notes"==this.type?virtualclass.dts.reArrangeNotes(b):virtualclass[this.module]._rearrange(b)):console.log("Document share:- Element is missing")};b.prototype.disable=function(a){"notes"==this.type?virtualclass.dts._noteDisable(this.rid):virtualclass[this.module]._disable(this.rid)};b.prototype.enable=function(){"notes"==this.type?virtualclass.dts._noteEnable(this.rid):virtualclass[this.module]._enable(this.rid)};b.prototype.UI={mainPDiv:function(){var a=c.createElement("div");
a.className="mainp"+this.type;a.id="mainp"+this.id;a.className="mainpreview";if("notes"==this.type){a.innerHTML="";var b=c.createElement("img");b.className="thumbnail";b.id="thumbnail"+this.rid;var d=virtualclass.dts.getNote(this.rid);b.src=d.content_path;b.style.border="1px solid gray";b.style.width="70px";b.style.height="40px";b.style.padding="5px";a.appendChild(b);d=c.querySelectorAll("#list"+this.type+" .link"+this.type);d=null!=d?d.length:1;var h=c.createElement("span");h.className="thumbList tooltip2";
h.innerHTML=d;h.dataset.title=this.title;a.appendChild(b);a.appendChild(h)}else"docs"==this.type&&(a.innerHTML=this.title,a.dataset.title=this.title,a.className+=" tooltip2");a.dataset.screen=this.id;a.dataset.rid=this.rid;return a},createPageNavLink2:function(){var a=c.createElement("div");a.className="link"+this.type;a.id="link"+this.id;a.className="link"+this.type+" links";a.dataset.screen=this.id;a.dataset.rid=this.rid;a.type=this.type;a.dataset.selected=0;a.dataset.status=this.status;"video"==
this.type&&a.classList.add(this.videoClass);return a},createPageNavLink:function(a){var b={};b.type=this.type;b.className="link"+this.type;b.id="link"+this.id;b.className="link"+this.type+" links";b.dataset={};b.dataset.screen=this.id;b.dataset.rid=this.rid;b.dataset.selected=0;b.dataset.status=this.status;if("video"==this.type){b.type="video";var c=virtualclass.getTemplate("linkvideo","videoupload")}else c=JST["templates/linkdoc.hbs"];$(a).append(c(b))},mainView:function(a){c.getElementById(this.parent);
if(null==c.getElementById("screen-"+this.type)){a={hasControls:roles.hasControls(),cd:virtualclass.dts.docs.currDoc};var b=JST["templates/docMain.hbs"];$("#documentScreen").append(b(a))}return c.querySelector("#screen"+this.id+"   .pageContainer")},controller:{cthis:null,init:function(a,b){this.cthis=a;this.element(a,"status",this.cthis.status);this.element(a,"delete");"video"==a.type&&this.element(a,"edit");"docs"!=a.type&&this.dragDrop.init(this.cthis)},dragDrop:{cthis:null,source:null,init:function(a){var b=
this;this.cthis=a;var d=c.querySelector("#"+("link"+this.cthis.type+this.cthis.rid));d.setAttribute("draggable","true");d.addEventListener("dragstart",function(c){b.handleDragStart(c,a)},!1);d.addEventListener("dragenter",function(c){b.handleDragEnter(c,a)},!1);d.addEventListener("dragend",function(c){b.handleDragEnd(c,a)},!1)},isBefore:function(a,b){if(a&&b){if(a.parentNode==b.parentNode)for(;a;a=a.previousSibling)if(a===b)return!0;return!1}},handleDragStart:function(a,b){"video"===b.type?(virtualclass.vutil.makeElementDeactive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery"),
virtualclass.vutil.makeElementActive("#listvideo")):"notes"===this.cthis.type&&(virtualclass.vutil.makeElementDeactive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery"),virtualclass.vutil.makeElementActive("#listnotes"));a.target.classList.contains("link"+b.type)?this.source=a.target:this.source=a.target.closest(".link"+b.type);a.dataTransfer.effectAllowed="move";this.source&&this.source.classList.add("dragElem")},handleDragEnter:function(a,b){"video"==b.type?virtualclass.vutil.makeElementActive("#listvideo"):
"notes"==b.type&&virtualclass.vutil.makeElementActive("#listnotes");if(this.source){this.source.classList.add("dragElem");console.log("add dragelem");if("video"==b.type||"notes"==b.type||"ppt"==b.type){var f=c.querySelectorAll("#virtualclassCont.congrea .link"+b.type+".htn");for(var d=0;d<f.length;d++)f[d].classList.remove("htn")}f=a.target.closest(".link"+b.type);f.classList.add("htn");this.isBefore(this.source,f)?f.parentNode.insertBefore(this.source,f):(a=a.target.closest(".link"+b.type),a.parentNode.insertBefore(this.source,
a.nextSibling));if("video"==b.type||"notes"==b.type||"ppt"==b.type)for(f=c.querySelectorAll("#virtualclassCont.congrea .link"+b.type+":not(.dragElem)"),d=0;d<f.length;d++)f[d].classList.add("opaq")}},handleDragEnd:function(a,b){b.rearrange();this.source.classList.remove("dragElem");console.log("remove dragelem");if("video"==b.type||"notes"==b.type||"ppt"==b.type){"video"==b.type?virtualclass.vutil.makeElementActive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery"):"notes"==b.type&&virtualclass.vutil.makeElementActive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery");
virtualclass.vutil.makeElementActive("#list"+b.type);var f=c.querySelectorAll(" #virtualclassCont.congrea .link"+b.type+".opaq");for(a=0;a<f.length;a++)f[a].classList.remove("opaq");b=c.querySelectorAll(" #virtualclassCont.congrea .link"+b.type+".htn");for(a=0;a<b.length;a++)b[a].classList.remove("htn")}}},events:{status2:function(a,b){0==+a.dataset.status?(a.title="video"==b.type||"ppt"==b.type?"Disable":"Hide",b.status=1,b.enable()):(a.title="video"==b.type||"ppt"==b.type?"Enable":"Show",b.status=
0,b.disable());a.dataset.status=b.status;a.closest(".link"+b.type).dataset.status=b.status;a.querySelector(".statusanch").innerHTML="status"+a.dataset.status;b.sendStatus({action:"status",status:a.dataset.status})},status:function(a,b){0==+a.dataset.status?(a.title="video"==b.type||"ppt"==b.type?"Disable":"Hide",b.status=1,b.enable()):(a.title="video"==b.type||"ppt"==b.type?"Enable":"Show",b.status=0,b.disable());a.dataset.status=b.status;a.closest(".link"+b.type).dataset.status=b.status;a.querySelector(".statusanch").innerHTML=
"status"+a.dataset.status;b.sendStatus(0==b.status?{action:"disable"}:{action:"enable"})},delete:function(a,b,c){virtualclass.dashBoard.userConfirmation(virtualclass.lang.getString("deletepopup"),function(a){a&&("notes"==b.type?virtualclass[b.module]._deleteNote(b.rid,b.type):virtualclass[b.module]._delete(b.rid))});"DocumentShare"==virtualclass.currApp&&(a=c?c:d.event,a.stopPropagation&&a.stopPropagation(),null!=a.cancelBubble&&(a.cancelBubble=!0))},edit:function(a,b){if(!c.querySelector("#titleCont"+
b.rid)&&"video"==b.type){var f=c.querySelector("#virtualclassCont.congrea #videoTitle"+b.rid);a=f.innerHTML;f.style.display="none";var d=c.querySelector("#virtualclassCont.congrea #videoTitleCont"+b.rid+" .controls.edit"),m=c.createElement("div");m.setAttribute("class","titleCont");m.setAttribute("id","titleCont"+b.rid);f.parentNode.insertBefore(m,d);f=c.createElement("input");f.setAttribute("type","text");f.setAttribute("class","textInput");f.setAttribute("id","temp"+b.rid);f.setAttribute("placeholder",
a);m.appendChild(f);$(c).on("click",function(a){a.target.id!="temp"+b.rid&&a.target.id!="editVideoTitle"+b.rid&&(a=c.querySelector("#virtualclassCont.congrea #temp"+b.rid))&&(a.value||(a.value=b.title),a.value&&(virtualclass.videoUl._editTitle(b.rid,a.value,b.videoClass),a=c.querySelector("#virtualclassCont.congrea #titleCont"+b.rid),a.parentNode.removeChild(a)))})}}},element2:function(a,b,d){("video"==a.type?"status"==b?c.querySelector("#controlCont"+a.type+a.rid+" .status"):c.querySelector("#controlCont"+
a.type+a.rid+" .delete"):"status"==b?c.querySelector(".controls.status"):c.querySelector(".controls.delete")).onclick=this.goToEvent(this.cthis,b)},element:function(a,b,d){d="."+b;"status"==b||"delete"==b?(d=c.querySelector("#controlCont"+a.type+a.rid+" "+d),d.onclick=this.goToEvent(this.cthis,b)):"edit"==b&&(d=c.querySelector("#"+a.type+"TitleCont"+a.rid+" "+d),d.onclick=this.goToEvent(this.cthis,b),"video_yts"!=a.videoClass&&(d.style.pointerEvents="none",d.classList.add("editDisable")));var f=this;
if(d=c.querySelector("#link"+a.type+a.rid))f.hoverHandler(a),d.classList.add("showCtr"),d.addEventListener("mouseover",function(){f.hoverHandler(a)}),d.addEventListener("mouseout",function(){f.hoverHandler1(a)})},hoverHandler:function(a){(a="video"==a.type?c.querySelector("#VideoDashboard #link"+a.type+a.rid+" .controlCont"):"ppt"==a.type?c.querySelector("#SharePresentationDashboard #link"+a.type+a.rid+" .controlCont"):c.querySelector("#DocumentShareDashboard #link"+a.type+a.rid+" .controlCont"))&&
a.classList.add("showCtr")},hoverHandler1:function(a){"video"==a.type?(a=c.querySelector("#VideoDashboard #link"+a.type+a.rid+" .controlCont"),a.classList.remove("showCtr")):"ppt"==a.type&&(a=c.querySelector("#SharePresentationDashboard #link"+a.type+a.rid+" .controlCont"),a.classList.remove("showCtr"))},goToEvent:function(a,b){var c=this;return function(f){c.events[b](this,a,f)}}}};d.page=b})(window,document);(function(d){var c=!0;d.documentShare=function(){return{allPages:null,allNotes:null,allDocs:null,notes:null,order:[],tempFolder:"documentSharing",init:function(b){this.firstRequest=!1;c=!0;virtualclass.gObj.hasOwnProperty("dstAll")&&"string"==typeof virtualclass.gObj.dstAll?this.storageRawData=null:(null==virtualclass.gObj.dstAll||"undefined"!=typeof virtualclass.gObj.dstAll&&0==Object.keys(virtualclass.gObj.dstAll).length?(b=void 0,localStorage.removeItem("dtsdocs"),this.storageRawData=null):this.storageRawData=
"object"==typeof virtualclass.gObj.dstAll?virtualclass.gObj.dstAll:null,this.allNotes=virtualclass.gObj.dstAllNotes,roles.isStudent()&&(virtualclass.serverData.rawData.docs=this.storageRawData),setTimeout(function(){roles.hasControls()&&virtualclass.storage.dstAllStore(virtualclass.gObj.dstAll)},0));virtualclass.gObj.hasOwnProperty("docs")&&"string"==typeof virtualclass.gObj.docs?this.documents=null:this.documents="object"==typeof virtualclass.gObj.docs?virtualclass.gObj.docs:null;this.UI.container();
this.pages={};this.notes={};null!=this.documents&&(this.allNotes=this.documents);this.initAfterUpload(b);roles.hasControls()&&"undefined"==typeof b&&(ioAdapter.mustSend({dts:{init:"studentlayout"},cf:"dts"}),console.log(virtualclass.gObj.currWb+" Document share Teacher layout "));"undefined"!=typeof b?"layout"!=b.init&&"studentlayout"!=b.init?(null!=this.storageRawData&&this.rawToProperData(this.storageRawData,"fromStorage"),this.setNoteScreen(b)):c&&roles.isStudent()&&this.rawToProperData(this.storageRawData,
"fromStorage"):(b=JSON.parse(localStorage.getItem("dtsdocs")),null!=b?(null!=this.storageRawData&&this.rawToProperData(this.storageRawData,"fromStorage"),this.initAfterUpload(b),null!=b.slideNumber&&(this.setNoteScreen(b),b.slideNumber=null,localStorage.setItem("dtsdocs",JSON.stringify(b)))):null!=this.allDocs&&0<Object.keys(this.allDocs).length?(console.log("Do nothing"),this.afterFirstRequestDocs(virtualclass.serverData.rawData.docs,!0)):roles.hasControls()&&this.firstRequestDocs())},moveProgressbar:function(){var b=
document.querySelector("#docsUploadMsz"),a=document.querySelector("#docsuploadContainer .qq-upload-list-selector.qq-upload-list");if(a){a.style.display="block";var c=document.createElement("div");b.appendChild(c);c.appendChild(a)}},initAfterUpload:function(b){if("undefined"!=typeof b){for(var a in b.docs)this.afterUploadFile(b.docs[a].rid,"fromReload",b);b.hasOwnProperty("order")&&(this.order=JSON.parse(b.order))}},setNoteScreen:function(b){if(null==document.querySelector("#note"+b.slideNumber+".current.note")){var a=
this.getDocId(b.slideNumber);this.docs.executeScreen(a,"fromreload",void 0,b.slideNumber);this.setScreenByOrder(a)}},setScreenByOrder:function(b){if(null!=this.order&&0<this.order.length){for(var a=this.getAllNotes(this.order),c,d=0;d<a.length;d++)c=a[d].id.split("_")[0],this.setLinkSelected(c,1);document.querySelectorAll("#notesContainer .note");this.createNoteLayout(a,b);this.reArrangeNotes(this.order);for(d=0;d<this.order.length;d++)this.noteStatus(this.order[d],this.allNotes[this.order[d]].status),
console.log("Note status "+this.order[d]+" --\x3e"+this.allNotes[this.order[d]].status);this.storeInDocs(this.allNotes)}},createNoteLayout:function(b,a){if(0<b.length){if(null==document.querySelector("#screen-docs .pageContainer")){a={notes:b,hasControls:roles.hasControls(),cd:a};var c="screen";b=document.querySelector("#docScreenContainer")}else a={notes:b},c="notesMain",b=document.querySelector("#screen-docs #notesContainer");c=virtualclass.getTemplate(c,"documentSharing");a=c(a);null!=b?b.insertAdjacentHTML("beforeend",
a):alert("there is no such element");!roles.hasControls()&&(b=document.querySelector("#virtualclassAppLeftPanel.hideZoom"))&&(b.classList.remove("hideZoom"),b.classList.add("showZoom"))}},afterUploadFile:function(b,a,c){var f="undefined"!=typeof c?c.docs["docs"+b].status:1;"undefined"==typeof a&&roles.hasControls()?this.requestDocs(b):(a="docs"+b,"object"!=typeof this.pages[a]&&(this.pages[a]=new virtualclass.page("docScreenContainer","docs","virtualclassDocumentShare","dts",f),this.pages[a].init(b,
"undefined"!=typeof c?c.docs[a].title:this.allDocs[b].title)))},initDocs:function(b){if("object"!=typeof this.pages[b]){var a=0;if("true"==this.allDocs[b].status||1==this.allDocs[b].status)a=1;var c="docs"+b;this.pages[c]=new virtualclass.page("docScreenContainer","docs","virtualclassDocumentShare","dts",a);this.pages[c].init(b,this.allDocs[b].filename);this.upateInStorage()}},firstRequestDocs:function(){var b=this;virtualclass.vutil.isBulkDataFetched()?setTimeout(function(){ioAdapter.mustSend({dts:{fallDocs:virtualclass.serverData.rawData.docs},
cf:"dts"});b.afterFirstRequestDocs(virtualclass.serverData.rawData.docs)},0):virtualclass.serverData.fetchAllData(function(){ioAdapter.mustSend({dts:{fallDocs:virtualclass.serverData.rawData.docs},cf:"dts"});b.afterFirstRequestDocs(virtualclass.serverData.rawData.docs);b.firstRequest=!0})},fetchAllNotes:function(){var b={},a;for(a in virtualclass.dts.allDocs)for(var c=0;c<virtualclass.dts.allDocs[a].notesarr.length;c++)b[virtualclass.dts.allDocs[a].notesarr[c].id]=virtualclass.dts.allDocs[a].notesarr[c];
return b},fetchAllNotesAsArr:function(){var b=[],a;for(a in virtualclass.dts.allDocs)for(var c=0;c<virtualclass.dts.allDocs[a].notesarr.length;c++)b.push(virtualclass.dts.allDocs[a].notesarr[c]);return b},afterFirstRequestDocs:function(b,a){this.rawToProperData(b);virtualclass.storage.dstAllStore(b);for(var c in this.allDocs)this.allDocs[c].hasOwnProperty("deleted")||this.initDocs(this.allDocs[c].fileuuid);this.requestOrder(this.executeOrder)},rawToProperData:function(b,a){"undefined"==typeof notconvert&&
(this.allDocsTemp=b,this.allDocs=this.convertInObjects(this.allDocsTemp));this.allNotes="undefined"!=typeof a?virtualclass.gObj.dstAllNotes:this.fetchAllNotes()},afterRequestOrder:function(b){this.order.length=0;this.order=b;b=this.getDocId(this.order[0]);virtualclass.dts.allDocs.hasOwnProperty(b)&&(b="docs"+b,console.log("From database doc share order "+this.order.join(",")),this.setScreenByOrder(b),this.docs.currNote=this.order[0],this.docs.displayScreen(b,this.order[0]))},requestOrder:function(b){virtualclass.vutil.requestOrder("docs",
b)},executeOrder:function(b){if(void 0!=b&&"undefined"!=typeof b){var a=virtualclass.dts;0<b.length&&("Failed"==b||"Error"==b?(console.log("page order retrieve failed"),$("#congdashboard").modal(),virtualclass.dashBoard.clickCloseButton()):b&&roles.hasAdmin()&&(ioAdapter.mustSend({dts:{order_recived:b},cf:"dts"}),a.afterRequestOrder(b),a.createNoteNav()))}},getFilenameFromUploadingfiles:function(b){for(;0<virtualclass.gObj.uploadingFiles.length;)return virtualclass.gObj.uploadingFiles[0].name},requestDocs:function(b){var a=
{filename:this.getFilenameFromUploadingfiles(b),fileuuid:b,filepath:"somewhere",filetype:"doc",key_room:virtualclass.gObj.sessionInfo.key+"_"+virtualclass.gObj.sessionInfo.room,status:1};this.allDocs[b]=a;a=0;if("true"==this.allDocs[b].status||1==this.allDocs[b].status)a=1;var c="docs"+b;"object"!=typeof this.pages[c]&&(this.pages[c]=new virtualclass.page("docScreenContainer","docs","virtualclassDocumentShare","dts",a),this.pages[c].init(b,this.allDocs[b].filename),this.allDocs[b].hasOwnProperty("notes")||
document.querySelector("#linkdocs"+b).classList.add("noDocs"));ioAdapter.mustSend({dts:{allDocs:this.allDocs,doc:b},cf:"dts"});virtualclass.serverData.pollingStatus(virtualclass.dts.afterRequestNotes)},afterRequestNotes:function(){var b=virtualclass.dts;virtualclass.dts.afterFirstRequestDocs(virtualclass.serverData.rawData.docs);ioAdapter.mustSend({dts:{fallDocs:virtualclass.serverData.rawData.docs},cf:"dts"});b.removeNoDocsElem();b.allPages=virtualclass.dts.fetchAllNotesAsArr();b.allNotes=virtualclass.dts.fetchAllNotes();
b.storeInDocs(b.allNotes);virtualclass.storage.dstAllStore(virtualclass.serverData.rawData.docs);ioAdapter.mustSend({dts:{allNotes:b.allNotes},cf:"dts"})},removeNoDocsElem:function(){for(var b=document.querySelectorAll(".noDocs"),a=0;a<b.length;a++)b[a].classList.remove("noDocs")},requestNotes:function(b){var a=this;virtualclass.vutil.xhrSendWithForm({live_class_id:virtualclass.gObj.congCourse,notes_id:"all",user:virtualclass.gObj.uid},"retrieve_all_notes",function(c){c=JSON.parse(c);+c.status&&(a.allPages=
c.resultdata,a.allNotes=a.convertInObjects(a.allPages),a.storeInDocs(a.allNotes),ioAdapter.mustSend({dts:{allNotes:a.allNotes,doc:b},cf:"dts"}))})},firstRequestNotes:function(){var b=this;virtualclass.vutil.xhrSendWithForm({live_class_id:virtualclass.gObj.congCourse,notes_id:"all",user:virtualclass.gObj.uid},"retrieve_all_notes",function(a){a=JSON.parse(a);b.allPages=a.resultdata;b.allNotes=b.convertInObjects(b.allPages);b.storeInDocs(b.allNotes);ioAdapter.mustSend({dts:{fallNotes:b.allNotes},cf:"dts"});
b.requestOrder(b.executeOrder)})},requestSlidesOld:function(b){b=parseInt(b,10);console.log(virtualclass.gObj.currWb+" document share : request "+b);var a=this.getDocs(b),c=document.querySelector("#linkdocs"+b).dataset.selected;ioAdapter.mustSend({dts:{dres:b,ds:1-+c},cf:"dts"});return a},requestSlides:function(b){console.log(virtualclass.gObj.currWb+" document share : request "+b);var a=this.getDocs(b),c=document.querySelector("#linkdocs"+b).dataset.selected;ioAdapter.mustSend({dts:{dres:b,ds:1-
+c},cf:"dts"});return a},storeInDocs:function(b){virtualclass.storage.dstAllStore(virtualclass.serverData.rawData.docs)},removeWhiteboardFromStorage:function(b){virtualclass.storage.wbDataRemove(b)},getNotesOld:function(b){var a=[],c;for(c in this.allNotes)this.allNotes[c].lc_content_id==b&&a.push(this.allNotes[c]);return a},getNotes:function(b){return this.allDocs[b].notesarr},removePagesUI:function(b){b=this.getNotes(b);for(var a=0;a<b.length;a++)this._removePageUI(b[a].id);0>=this.order.length&&
(c=!0)},_removePageUI:function(b,a){a=this.order.indexOf(b);0<=a&&this.order.splice(a,1);a=document.querySelector("#notesContainer #note"+b);null!=a&&a.parentNode.removeChild(a);"object"==typeof virtualclass.wb["_doc_"+b+"_"+b]&&delete virtualclass.wb["_doc_"+b+"_"+b];this.removeNoteNav(b);this.reaArrangeThumbCount()},addPages:function(b){for(var a=0;a<b.length;)b[a].hasOwnProperty("deletedn")||null!=this.order&&-1>=this.order.indexOf(b[a].id)&&this.order.push(b[a].id),a++},toggleSlideWithOrder:function(b,
a){b=document.querySelector("#linkdocs"+b);if(null!=b){if(1==b.dataset.selected)return b.dataset.selected=0,!1;b.dataset.selected=1;return!0}console.log("Document sharing There is no Element")},setLinkSelected:function(b,a){b=document.querySelector("#linkdocs"+b);null!=b&&(b.dataset.selected=a)},onResponseFiles:function(b,a,f,d,h){c&&(this.docs.currNote="undefined"!=typeof d?d:a[0].id,c=!1);(roles.hasControls()?this.toggleSlideWithOrder(b,a):"undefined"!=typeof f?+f:1)?(this.addPages(a),b="string"!=
typeof b?"docs"+b:0<=b.indexOf("docs")?b:"docs"+b,this.createNoteLayout(a,b),"undefined"!=typeof d?this.docs.displayScreen(b,d):this.docs.displayScreen(b),"undefined"!=typeof h?this.createNoteNav(h):this.createNoteNav(),this.updateLinkNotes(this.docs.currNote),virtualclass.dts.setCurrentNav(this.docs.currNote),virtualclass.vutil.hideUploadMsg("docsuploadContainer"),virtualclass.vutil.addNoteClass()):(this.removePagesUI(b),virtualclass.dts.noteExist()||(virtualclass.vutil.showUploadMsg("docsuploadContainer"),
virtualclass.dts.docs.currNote=0,virtualclass.dts.docs.currDoc=void 0,virtualclass.gObj.currWb=null),virtualclass.dts.docSelected()||(a=JSON.parse(localStorage.getItem("dtsdocs")),null!=a&&(a.slideNumber=null,localStorage.setItem("dtsdocs",JSON.stringify(a))),roles.isStudent()&&(a=document.querySelector("#cont"+virtualclass.gObj.currWb),null!=a?a.style.display="block":(a=document.querySelector("#docScreenContainer"),null!=a&&a.classList.remove("noteDisplay"),a=document.querySelector("#virtualclassAppLeftPanel.hideZoom"),
d=document.querySelector("#virtualclassAppLeftPanel"),a||(d.classList.add("hideZoom"),d.classList.remove("showZoom"))))));null==document.querySelector("#listnotes .currentNav")&&(a=document.querySelector("#listnotes .linknotes"),null!=a&&(virtualclass.dts.currNote=a.dataset.rid,a=document.querySelector("#mainpnotes"+virtualclass.dts.currNote),null!=a&&a.click()));roles.hasAdmin()&&this.sendOrder(this.order)},selectFirstNote:function(){if(null==document.querySelector("#notesContainer .current")){var b=
document.querySelector("#notesContainer .note");null!=b&&(this.docs.currNote=b.dataset.slide,this.docs.currDoc="docs"+this.getDocId(b.dataset.slide),this.docs.note.getScreen(b))}},isDocumentExist:function(b){if("undefined"!=typeof b)return"layout"!=b.init&&"studentlayout"!=b.init?!0:!1},isDocAlreadyExist:function(b){for(var a=0;a<this.documents.length;a++)if(this.documents[a].id==b)return!0;return!1},UI:{id:"virtualclassDocumentShare",class:"virtualclass container",container:function(){if(null==document.getElementById(this.id)){roles.hasAdmin();
var b={control:roles.hasControls()},a=virtualclass.getTemplate("docsMain","documentSharing");virtualclass.vutil.insertAppLayout(a(b));null==document.querySelector("#congdashboard")&&(b=virtualclass.getTemplate("dashboard")({app:"DocumentShare"}),document.querySelector("#dashboardContainer").innerHTML=b)}null==document.querySelector("#DocumentShareDashboard")&&(b=document.createElement("div"),document.querySelector("#congdashboard .modal-body").appendChild(b),b.id="DocumentShareDashboard");null==document.querySelector("#docsDbCont")&&
(document.querySelector("#DocumentShareDashboard").innerHTML=virtualclass.vutil.getDocsDashBoard("DocumentShare"),roles.hasControls()&&(virtualclass.vutil.attachEventToUploadTab(),null==document.querySelector("#DocumentShareDashboard .qq-gallery")&&virtualclass.vutil.modalPopup("docs",["docsuploadContainer"])))},createMainContent:function(b,a,c){},createSlides:function(b,a){var c=document.querySelector("#notesContainer");null==c&&(c=document.createElement("div"),c.className="notes",c.id="notesContainer");
for(var d=0;d<a.length;d++)if(null==document.querySelector("#note"+a[d].id)){var h=document.createElement("div");h.id="note"+a[d].id;h.className="note";h.dataset.slide=a[d].id;h.dataset.status="true"==h.dataset.statuS||1==h.dataset.statuS?1:"false"==h.dataset.status||0==h.dataset.status?0:a[d].status}b.appendChild(c);roles.hasControls()&&(this.createNavigation(b,"prev"),this.createNavigation(b,"next"))},createNavigation:function(b,a){if(null==document.querySelector("#docs"+a)){var c=document.createElement("span");
c.className="nvgt "+a;c.id="docs"+a;b.appendChild(c)}},createDocsNav:function(b,a){var c=document.getElementById("listDocs");null==c&&(c=document.createElement("div"),c.id="listDocs",b.appendChild(c));b=this.createDocsNavLink(a);this.attachDocsNav(b,a);c.appendChild(b)},createDocsNavLink:function(b){var a=document.createElement("div");a.id="link"+b;a.className="linkdoc";a.innerHTML=b;a.dataset.screen=b;return a},attachDocsNav:function(b,a){b.onclick=virtualclass.dts.docs.goToDocs(a)}},createNoteNav:function(b){for(var a=
0;a<this.order.length;a++)if("object"!=typeof this.notes[this.order[a]]){var c="true"==this.allNotes[this.order[a]].status||1==+this.allNotes[this.order[a]].status?1:0;this.notes[this.order[a]]=new virtualclass.page("screen-docs","notes","virtualclassDocumentShare","dts",c);this.notes[this.order[a]].init(this.order[a],"note_"+this.allNotes[this.order[a]].lc_content_id+"_"+this.order[a]);"undefined"==typeof b&&this.noteStatus(this.order[a],c)}document.querySelector(".congrea.teacher  #dashboardContainer .modal-header button.enable")||
virtualclass.vutil.showFinishBtn();this.storeInDocs(this.allNotes)},createNoteNavAlt:function(b){for(var a=0;a<this.order.length;a++){var c="true"==this.allNotes[this.order[a]].status||1==+this.allNotes[this.order[a]].status?1:0;this.notes[this.order[a]]=new virtualclass.page("screen-docs","notes","virtualclassDocumentShare","dts",c);this.notes[this.order[a]].init(this.order[a],"note_"+this.allNotes[this.order[a]].lc_content_id+"_"+this.order[a]);"undefined"==typeof b&&this.noteStatus(this.order[a],
c)}"undefined"==typeof b&&this.storeInDocs(this.allNotes)},removeNoteNav:function(b){var a=document.querySelector("#linknotes"+b);null!=a&&a.parentNode.removeChild(a);"object"==typeof this.notes[b]&&delete this.notes[b]},docs:{num:0,currNote:0,curr:function(b,a){this.currDoc=b;virtualclass.dts.docs.num=b;var c=document.querySelector("#documentScreen .screen.current");null!=c&&c.classList.remove("current");document.querySelector("#screen-docs").classList.add("current");document.querySelector("#documentScreen").dataset.screen=
b;this.note="undefined"!=typeof a?new this.slide(a):new this.slide;this.note.init();this.note.currentSlide(this.currNote)},display:function(b){document.querySelector(b).style.display="block"},hide:function(b){document.querySelector(b).style.display="none"},goToDocs:function(b){var a=this;return function(){"object"==typeof virtualclass.dts.docs.note&&virtualclass.vutil.updateCurrentDoc(virtualclass.dts.docs.note.currNote);a.executeScreen(b);roles.hasControls()&&(Object.keys(virtualclass.dts.notes).length?
virtualclass.vutil.showFinishBtn():virtualclass.vutil.removeFinishBtn())}},goToNavs:function(b){var a=this;return function(){var c=document.querySelector("#linknotes"+b);null!=c?1==+c.dataset.status&&(a.currNote=b,a.note.currentSlide(b)):(a.currNote=b,a.note.currentSlide(b))}},studentExecuteScreen:function(b){var a=b.dres;this.currDoc=a;var c=virtualclass.dts.getDocs(a);if(null!=c)virtualclass.dts.onResponseFiles(a,c,b.ds)},executeScreen:function(b,a,c,d){this.currDoc=b;-1==b.indexOf("docs")&&(this.currDoc=
"docs"+b);var f=virtualclass.dts;if(roles.hasControls()&&"undefined"==typeof a)a=f.requestSlides(b),null!=a?(f.onResponseFiles(b,a),"undefined"!=typeof c&&c()):console.log("There is no data");else{"string"==typeof b&&-1<b.indexOf("docs")&&(b=b.split("docs")[1]);var g=f.getDocs(b);if(null!=g){if("undefined"==typeof a)f.onResponseFiles(b,g,void 0,d);else f.onResponseFiles(b,g,void 0,d,"fromReload");"undefined"!=typeof c&&c()}}},displayScreen:function(b,a){"undefined"!=typeof a?this.curr(b,a):this.curr(b)},
createWhiteboard:function(b){var a="_doc_"+b+"_"+b;console.log(virtualclass.gObj.currWb+" document share Create Whiteboard ");var c=document.createElement("div");c.id="cont";c.className="whiteboard";c.dataset.wid=a;c.id="cont"+c.dataset.wid;b=document.querySelector(".note[data-slide='"+b+"']");null!=b?(b.insertBefore(c,b.firstChild),virtualclass.vutil.createWhiteBoard(c.dataset.wid)):console.log("Element is null");virtualclass.previous=virtualclass.dtsConfig.id},slide:function(b){return{li_items:0,
imageNumber:0,currSlide:"undefined"!=typeof b?b:0,currNote:"undefined"!=typeof b?b:0,doc:1,init:function(a){var b=virtualclass.dts;a="#screen-docs";var c=document.querySelector(a+" .notes");this.doc=b.docs.num;if(null!=c){if(this.li_items=c.children,this.imageNumber=this.li_items.length,roles.hasControls()){c=document.querySelector(a+" .prev");a=document.querySelector(a+" .next");var d=this;c.onclick=function(){virtualclass.vutil.navWhiteboard(d,d.prevSlide,b)};a.onclick=function(){virtualclass.vutil.navWhiteboard(d,
d.nextSlide,b)}}}else alert("no element")},slideTo:function(a,b){var c=a.dataset.slide;virtualclass.vutil.updateCurrentDoc(c);this.displaySlide(a);roles.hasControls()&&"undefined"==typeof b&&setTimeout(function(){ioAdapter.mustSend({dts:{slideTo:c,docn:virtualclass.dts.docs.currDoc},cf:"dts"})},200)},displaySlide:function(a){var b=document.querySelector("#screen-docs .note.current");null!=b&&b.classList.remove("current");null!=a&&a.classList.add("current");virtualclass.vutil.addNoteClass()},prevSlide:function(a){var b=
a.docs.currNote,c=document.querySelector("#documentScreen #note"+b);null!=c&&(c=c.previousElementSibling,null!=c?(0==+c.dataset.status?(b=this.getActiveSlide(a,b,"prev"))?(this.getScreen(b,!0),a.docs.currNote=b.dataset.slide):alert("Thre is no page"):(this.getScreen(c,!0),a.docs.currNote=c.dataset.slide),"object"==typeof virtualclass.wb["_doc_"+a.docs.currNote+"_"+a.docs.currNote]&&system.setAppDimension(null,"resize")):alert("There is no previous element"))},getActiveSlide:function(a,b,c){b=document.querySelector("#documentScreen #note"+
b);if(null!=b)return b="next"==c?b.nextElementSibling:b.previousElementSibling,null!=b?0==+b.dataset.status?this.getActiveSlide(a,b.dataset.slide,c):b:!1},nextSlide:function(a){var b=a.docs.currNote;if(b!=a.order[a.order.length-1]){var c=document.querySelector("#documentScreen #note"+b);null!=c&&(nextSlide=c.nextElementSibling,null!=nextSlide&&(0==+nextSlide.dataset.status?(b=this.getActiveSlide(a,b,"next"))?(this.getScreen(b,!0),a.docs.currNote=b.dataset.slide):alert("Thre is no page"):(this.getScreen(nextSlide,
!0),a.docs.currNote=nextSlide.dataset.slide)))}else alert("There is no page")},isSlideAvailable:function(a,b){return a==b?!1:!0},currentSlide:function(a){var b=document.querySelector("#documentScreen #note"+a);null!=b?this.getScreen(b):console.log("Document-Sharing:-"+a+" is not found ");a=document.querySelector("#docScreenContainer");null!=a&&a.classList.add("noteDisplay")},isPdfRendered:function(){var a=document.querySelector("#canvas"+virtualclass.gObj.currWb);return null!=a?a.parentNode.dataset.hasOwnProperty("pdfrender"):
!1},getScreen:function(a,b){this.currNote=this.currSlide=a.dataset.slide;virtualclass.dts.currDoc=this.doc;this.slideTo(a);null!=virtualclass.wb[virtualclass.gObj.currWb]&&console.log("whiteboard ============ "+virtualclass.wb[virtualclass.gObj.currWb].gObj.queue.length);null!=virtualclass.wb[virtualclass.gObj.currWb]&&0<virtualclass.wb[virtualclass.gObj.currWb].gObj.queue.length&&(virtualclass.gObj.tempQueue[virtualclass.gObj.currWb]=virtualclass.wb[virtualclass.gObj.currWb].gObj.queue);this.isWhiteboardExist(this.currNote)?
this.isWhiteboardExist(this.currNote)&&!this.isPdfRendered(this.currNote)?(delete virtualclass.wb[virtualclass.gObj.currWb],virtualclass.dts.docs.createWhiteboard(this.currNote)):virtualclass.zoom.normalRender():virtualclass.dts.docs.createWhiteboard(this.currNote);virtualclass.vutil.updateCurrentDoc(this.currNote);virtualclass.dts.updateLinkNotes(this.currNote);setTimeout(function(){var b=virtualclass.dts.isFirstNote(a.id),c=virtualclass.dts.isLastNote(a.id),d=document.querySelector("#screen-docs .pageContainer");
b&&c?(d.classList.add("firstNote"),d.classList.add("lastNote")):b?(d.classList.remove("lastNote"),d.classList.add("firstNote")):c?(d.classList.remove("firstNote"),d.classList.add("lastNote")):(d.classList.remove("firstNote"),d.classList.remove("lastNote"))},0)},isWhiteboardExist:function(a){wbCont=document.querySelector("#"+("containerWb_doc_"+a+"_"+a));return null!=wbCont}}}},destroyDts:function(){var b=document.getElementById(virtualclass.dts.UI.id);null!=b?b.parentNode.removeChild(b):console.log("Element is null");
virtualclass.dts=null},screenIsCreated:function(b){return null!=document.getElementById("screen"+b)},convertInObjects:function(b){for(var a={},c=0;c<b.length;c++)a[b[c].fileuuid]=b[c];return a},onmessage:function(b){"object"!=typeof virtualclass.dts&&virtualclass.makeAppReady("DocumentShare",void 0,{init:"studentlayout"});var a=b.message.dts;a.hasOwnProperty("docn")&&-1==a.docn.indexOf("docs")&&(a.docn="docs"+a.docn);if(a.hasOwnProperty("allNotes"))this.allNotes=a.allNotes,this.storeInDocs(this.allNotes);
else if(a.hasOwnProperty("fallNotes"))this.allNotes=a.fallNotes,this.storeInDocs(this.allNotes),virtualclass.storage.dstAllStore(virtualclass.serverData.rawData.docs);else if(a.hasOwnProperty("allDocs"))this.allDocs=a.allDocs,this.afterUploadFile(a.doc);else if(a.hasOwnProperty("fallDocs")){var c=this;c.afterFirstRequestDocs(a.fallDocs);virtualclass.serverData.rawData.docs=a.fallDocs}else if(a.hasOwnProperty("dres"))this.docs.studentExecuteScreen(a),console.log(virtualclass.gObj.currWb+" document share :- Layout initialized");
else if(a.hasOwnProperty("slideTo"))if("object"!=typeof this.docs.note)c=this,this.docs.executeScreen(a.docn,void 0,function(){console.log("document share :- doc is not created");c.docs.note.currNote=a.slideTo;var b=document.querySelector("#note"+a.slideTo);c.docs.note.slideTo(b)},a.slideTo);else if("object"==typeof this.docs.note&&a.docn!=this.docs.num){this.docs.currNote=a.slideTo;this.docs.executeScreen(a.docn,void 0);var d=this;setTimeout(function(){d.docs.note.currentSlide(a.slideTo)},500)}else b=
document.querySelector("#note"+a.slideTo),null!=b?(this.docs.currNote=a.slideTo,this.docs.note.getScreen(b),console.log(virtualclass.gObj.currWb+" document share :- Normal Case")):alert("Note is null");else a.hasOwnProperty("dispScreen")?(b=a.dispScreen.sc,virtualclass.vutil.updateCurrentDoc(b,a.dispScreen.sn),virtualclass.dts.screenIsCreated(b)?(console.log(virtualclass.gObj.currWb+" document share :- Only display screen"),this.docs.displayScreen(b)):(console.log(virtualclass.gObj.currWb+" document share :- With screen Created"),
this.docs.executeScreen(b,void 0,void 0,a.dispScreen.sn),"object"==typeof this.docs.note&&this.docs.note.getScreen(a.dispScreen.sn))):a.hasOwnProperty("rmnote")?this._delete(a.rmnote):a.hasOwnProperty("rmsnote")?(this._removePageUI(a.rmsnote),this._removePageFromStructure(a.rmsnote)):a.hasOwnProperty("noteSt")?(this.noteStatus(a.note,a.noteSt),this.storeInDocs(this.allNotes)):a.hasOwnProperty("docSt")?this.docStatus(a.doc,a.docSt):a.hasOwnProperty("order_recived")&&this.afterRequestOrder(a.order_recived);
a.hasOwnProperty("dres")||virtualclass.vutil.resizeWindowIfBigger()},sendCurrentSlide:function(){if(virtualclass.dts.docs.hasOwnProperty("currDoc")){var b=virtualclass.dts.docs.currDoc;void 0!=b?null!=document.querySelector("#listnotes .note")&&(ioAdapter.mustSend({dts:{slideTo:virtualclass.dts.docs.note.currNote,docn:b},cf:"dts"}),console.log(virtualclass.gObj.currWb+" Document share send current slide")):console.log("Document sharing : doc number is undefined")}},sendCurrentDoc:function(){if(virtualclass.dts.docs.hasOwnProperty("currDoc"))if(void 0!=
b){var b;ioAdapter.mustSend({dts:{doc:virtualclass.dts.docs.currDoc},cf:"dts"});console.log(virtualclass.gObj.currWb+" Document share send current doc only")}else console.log("Document sharing : doc number is undefined")},consoleMessage:function(b){console.log(virtualclass.gObj.currWb+" "+b)},_rearrange:function(b){alert(b.toString())},reArrangeNotes:function(b){this.order=b;this.reArrangeElements(b);roles.hasAdmin()&&this.sendOrder(this.order)},sendOrder:function(b){virtualclass.vutil.sendOrder("docs",
b)},reaArrangeThumbCount:function(){for(var b=document.querySelectorAll("#listnotes .thumbList"),a=0;a<b.length;a++)b[a].innerHTML=a+1},reArrangeElements:function(b){var a=document.getElementById("notesContainer"),c=document.createElement("div");c.id="notesContainer";c.className="notes";for(var d=0;d<b.length;d++)c.appendChild(document.getElementById("note"+b[d]));a.parentNode.replaceChild(c,a);this.reaArrangeThumbCount()},_delete:function(b){var a=document.querySelector("#linkdocs"+b);null!=a&&a.parentNode.removeChild(a);
var c=this;virtualclass.xhrn.sendData({uuid:b,action:"delete",page:0},virtualclass.api.UpdateDocumentStatus,function(a){"ok"==JSON.parse(a).status&&c.sendOrder(c.order)});delete this.pages["docs"+b];this.removePagesUI(b);this.removePagesFromStructure(b);this.upateInStorage()},_deleteNote:function(b,a){this._removePageUI(b,a);this._removePageFromStructure(b,a);roles.hasControls()&&ioAdapter.mustSend({dts:{rmsnote:b},cf:"dts"});a=b.split("_");b=a[0];a=parseInt(a[1]);var c=this;virtualclass.xhrn.sendData({uuid:b,
action:"delete",page:a},virtualclass.api.UpdateDocumentStatus,function(a){"ok"==JSON.parse(a).status&&c.sendOrder(c.order)});a=!1;var d=virtualclass.dts.allDocs[b];if(null!=d)for(var h=0;h<d.notesarr.length;h++)if(!d.notesarr[h].hasOwnProperty("deletedn")){a=!0;break}a||this._delete(b)},removePagesFromStructure:function(b){this.allDocs[b].deleted="0";for(var a in this.allNotes)-1<this.allNotes[a].id.indexOf(b)&&this._removePageFromStructure(this.allNotes[a].id)},updateInAllDocs:function(b){var a=
b.split("_")[0];doc=this.allDocs[a];if("undefined"!=typeof doc.notes[b])for(doc.notes[b].deletedn=b,a=0;a<doc.notesarr.length;a++)doc.notesarr[a].id==b&&(doc.notesarr[a].deletedn=b);else console.log("The note with the id "+b+" is not available")},_removePageFromStructure:function(b){this.removeWhiteboardFromStorage("_doc_"+b+"_"+b);this.allNotes[b].deletedn=b;this.storeInDocs(this.allNotes);this.updateInAllDocs(b)},_disable:function(b){this.docStatus(b)},_enable:function(b){this.docStatus(b)},docStatus:function(b,
a){var c=document.querySelector("#linkdocs"+b+" .controls.status");null!=c?"undefined"==typeof a&&(a=1-+c.dataset.status):console.log("document share:- there is no element "+b);c=this.getDocs(b);for(var d=0;d<c.length;d++){var h=c[d].id;this.noteStatus(h,a);this.updatePageNavStatus(h,a)}this.storeInDocs(this.allNotes);roles.hasControls()&&ioAdapter.mustSend({dts:{docSt:a,doc:b},cf:"dts"})},updatePageNavStatus:function(b,a){var c=document.querySelector("#linknotes"+b);null!=c?(c.dataset.status=a,b=
c.querySelector(".controls.status"),b.dataset.status=a,b.querySelector(".statusanch").innerHTML="status"+a):console.log("Document share : there is no element #linknotes"+b)},_noteDisable:function(b){this.noteStatus(b);this.storeInDocs(this.allNotes);this.sendNoteStatus(b)},_noteEnable:function(b){this.noteStatus(b);this.storeInDocs(this.allNotes);this.sendNoteStatus(b)},sendNoteStatus:function(b){if(roles.hasControls()){var a=document.querySelector("#note"+b);null!=a?ioAdapter.mustSend({dts:{noteSt:a.dataset.status,
note:b},cf:"dts"}):console.log("Element is null")}},noteStatus:function(b,a){var c=document.querySelector("#note"+b);null!=c?(a="undefined"==typeof a?1-+c.dataset.status:1==a||"true"==a?1:0,c.dataset.status=a,a=this.allNotes[b],a.status=c.dataset.status,this.allNotes[b]=a):console.log("there is no element #note"+b)},getDocsOld:function(b){var a=[],c;for(c in this.allNotes)b==this.allNotes[c].lc_content_id&&a.push(this.allNotes[c]);return a},getDocs:function(b){console.log("--------------");if(null!=
this.allDocs&&"object"==typeof this.allDocs[b])return this.allDocs[b].notesarr;console.log("There is no document with the id "+b)},getDocId:function(b){return b.split("_")[0]},getAllNotes:function(b){var a=[];for(i=0;i<b.length;i++)a.push(this.allNotes[b[i]]);return a},getNote:function(b){return this.allNotes[b]},updateLinkNotes:function(b){var a=document.querySelector("#listnotes .currentNav");null!=a&&a.classList.remove("currentNav");this.setCurrentNav(b)},setCurrentNav:function(b){b=document.querySelector("#linknotes"+
b);null!=b&&b.classList.add("currentNav")},onAjaxResponse:function(b,a,c){if(c.hasOwnProperty("success")&&c.success){for(b=0;b<virtualclass.gObj.uploadingFiles.length;b++)this.afterUploadFile(virtualclass.gObj.uploadingFiles[b].uuid);virtualclass.gObj.uploadingFiles=[];this.showUploadMsz(virtualclass.lang.getString("docUploadSuccess"),"alert-success")}else"duplicate"==c.message?this.showUploadMsz(virtualclass.lang.getString("duplicateUploadMsg"),"alert-error"):c.hasOwnProperty("error")?this.showUploadMsz(c.error,
"alert-error"):this.showUploadMsz(virtualclass.lang.getString("someproblem"),"alert-error");if(b=document.querySelector("#DocumentShareDashboard .qq-upload-list-selector.qq-upload-list"))b.style.display="none";null!=document.querySelector("#listnotes")?(virtualclass.vutil.makeElementDeactive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery"),virtualclass.vutil.makeElementActive("#listnotes")):console.log("List note is null")},showUploadMsz:function(b,a){var c=document.querySelector("#DocumentShareDashboard #docsUploadMsz"),
d=document.querySelector("#DocumentShareDashboard #docsUploadMsz .alert");d&&d.parentNode.removeChild(d);d=document.createElement("div");d.className="alert  alert-dismissable";d.classList.add(a);d.innerHTML=b;c.appendChild(d);b=document.createElement("button");b.className="close";b.setAttribute("data-dismiss","alert");b.innerHTML="&times";d.appendChild(b)},setNoteDimension:function(b,a,c){var d=document.querySelector("#cont"+c);null!=d&&(d=document.querySelector("#"+d.parentNode.id+" .imageContainer img"),
d.style.width=b,d.style.height=a);system.setDocCanvasDimension(b,a,c);c=document.querySelector("#screen-docs .pageContainer");roles.hasAdmin()&&(a+=60);null!=c&&(c.style.width=b+"px",c.style.height=a+"px")},isFirstNote:function(b){var a=document.querySelector("#notesContainer .note");return null!=a&&b==a.id},isLastNote:function(b){var a=document.querySelectorAll("#notesContainer .note"),c=a[a.length-1];return 0<a.length&&c.id==b},noteExist:function(){return null!=document.querySelector("#notesContainer .note")},
docSelected:function(){return document.querySelector('#listdocs .linkdocs[data-selected="1"]')},isUploaderExist:function(){return null!=document.querySelector("#docsuploadContainer .qq-uploader-selector")},upateInStorage:function(){if(virtualclass.hasOwnProperty("dts")&&typeof virtualclass.dts.hasOwnProperty("pages")&&"object"==typeof virtualclass.dts.pages){var b={};b.docs=virtualclass.dts.pages;b.order=JSON.stringify(virtualclass.dts.order);b.slideNumber=0<virtualclass.dts.order.length?virtualclass.dts.docs.note.currNote:
null;localStorage.setItem("dtsdocs",JSON.stringify(b))}}}}})(window);/*
 SlickQuiz jQuery Plugin
 http://github.com/jewlofthelotus/SlickQuiz

 @updated August 9, 2014
 @version 1.5.164

 @author Julie Cameron - http://www.juliecameron.com
 @copyright (c) 2013 Quicken Loans - http://www.quickenloans.com
 @license MIT
*/
(function(d){d.slickQuiz=function(c,b){var a=this,f=d(c),g="#"+f.attr("id");c={checkAnswerText:"Check My Answer!",nextQuestionText:"Next &raquo;",backButtonText:"&laquo; Back",tryAgainText:"",questionCountText:"Question %current of %total",preventUnansweredText:"You must select at least one answer.",questionTemplateText:"%count. %text",scoreTemplateText:"%score / %total",nameTemplateText:"<span>Quiz: </span>%name",skipStartButton:!0,numberOfQuestions:null,randomSortQuestions:!1,randomSortAnswers:!0,
preventUnanswered:!1,disableScore:!1,disableRanking:!0,quizTime:0,displayDetailResult:!0,questionMode:"deferredfeedback",perQuestionResponseMessaging:void 0!=b.questionMode&&"deferredfeedback"!=b.questionMode?!0:!1,perQuestionResponseAnswers:void 0!=b.questionMode&&"deferredfeedback"!=b.questionMode?!0:!1,completionResponseMessaging:void 0!=b.questionMode&&"deferredfeedback"!=b.questionMode?!1:b.displayDetailResult,displayQuestionCount:!1,displayQuestionNumber:!0,submitQuestionText:"Submit",questionPerPage:50,
resultDisplayDetailed:!0,animationCallbacks:{setupQuiz:function(){},startQuiz:function(){},resetQuiz:function(){},checkAnswer:function(){},nextQuestion:function(){},backToQuestion:function(){},completeQuiz:function(){}},events:{onStartQuiz:function(a){},onCompleteQuiz:function(a){}}};var h="nextQuestion",m="."+h,n=g+" .startQuiz",r=g+" .quizName",A=g+" .quizArea",z=g+" .quizResults",t=g+" .quizResultsCopy",v=g+" .quizHeader",q=g+" .quizScore",w=g+" .quizLevel",p=d(n),B=d(r),G=d(A),H=d(z),M=d(t),J=
d(v);d(q);var D=d(w),I=0,P=0;r="";b&&"undefined"!=typeof b.disableNext&&("undefined"==typeof b.preventUnanswered&&(b.preventUnanswered=b.disableNext),r+="The 'disableNext' option has been deprecated, please use 'preventUnanswered' in it's place.\n\n");b&&"undefined"!=typeof b.disableResponseMessaging&&("undefined"==typeof b.preventUnanswered&&(b.perQuestionResponseMessaging=b.disableResponseMessaging),r+="The 'disableResponseMessaging' option has been deprecated, please use 'perQuestionResponseMessaging' and 'completionResponseMessaging' in it's place.\n\n");
b&&"undefined"!=typeof b.randomSort&&("undefined"==typeof b.randomSortQuestions&&(b.randomSortQuestions=b.randomSort),"undefined"==typeof b.randomSortAnswers&&(b.randomSortAnswers=b.randomSort),r+="The 'randomSort' option has been deprecated, please use 'randomSortQuestions' and 'randomSortAnswers' in it's place.\n\n");""!==r&&("undefined"!=typeof console?console.warn(r):alert(r));a.config=d.extend(c,b);var K=d.parseJSON(a.config.json?a.config.json:"undefined"!=typeof quizJSON?quizJSON:null),R=a.config.randomSortQuestions?
K.questions.sort(function(){return Math.round(Math.random())-.5}):K.questions,Z=R.length;a.config.numberOfQuestions&&Z>=a.config.numberOfQuestions&&(R=R.slice(0,a.config.numberOfQuestions),Z=R.length);var C={getKey:function(a){var b=[];for(i=0;i<a;i++)b[i]=d.Deferred();return b},turnKeyAndGo:function(a,b){d.when.apply(null,a).then(function(){b()})},getKeyNotch:function(a,b){return function(){a[b-1].resolve()}}};a.method={setupQuiz:function(b){var c=C.getKey(3);var f=C.getKeyNotch;a.config.quizTime&&
0<a.config.quizTime?d("#timeText").html('Time remaining <span id="qztime">'+a.config.quizTime+"</span>"):d("#timeText").html('Elapsed time <span id="qztime">00:00:00</span>');B.hide().html(a.config.nameTemplateText.replace("%name",K.info.name)).fadeIn(1E3,f(c,1));J.hide().prepend(d('<div class="quizDescription">'+K.info.main+"</div>")).fadeIn(1E3,f(c,2));a.config.tryAgainText&&""!==a.config.tryAgainText&&M.append('<p><a class="button tryAgain" href="#">'+a.config.tryAgainText+"</a></p>");var g=d('<ol class="questions"></ol>'),
m=1;for(i in R)if(R.hasOwnProperty(i)){var n=R[i],q=d('<li data-id="'+n.qid+'" class="question" id="question'+(m-1)+'"></li>');a.config.displayQuestionCount&&q.append('<div class="questionCount">'+a.config.questionCountText.replace("%current",'<span class="current">'+m+"</span>").replace("%total",'<span class="total">'+Z+"</span>")+"</div>");var r="";r=a.config.displayQuestionNumber?a.config.questionTemplateText.replace("%count",m).replace("%text",n.q):n.q;q.append('<div class="quesname"> <span class= "unflagged" title="flag this question for future reference"></span><span class="questext">'+
r+"</span></div>");var t=0;for(i in n.a)n.a.hasOwnProperty(i)&&(answer=n.a[i],answer.correct&&t++);r=d('<ul class="answers"></ul>');var v=a.config.randomSortAnswers?n.a.sort(function(){return Math.round(Math.random())-.5}):n.a,P=n.select_any?n.select_any:!1,w=n.force_checkbox?n.force_checkbox:!1,D="question"+(m-1);t=1<t&&!P||w?"checkbox":"radio";m==K.questions.length&&(h+=" lastQuestion");for(i in v)v.hasOwnProperty(i)&&(answer=v[i],optionId=D+"_"+i.toString(),P='<input id="'+optionId+'" class="ansck" name="'+
D+'" type="'+t+'" /> ',w='<label for="'+optionId+'">'+answer.option+"</label>",P=d("<li></li>").append(P).append(w),r.append(P));q.append(r);if(a.config.perQuestionResponseMessaging||a.config.completionResponseMessaging)r=d('<ul class="responses"></ul>'),r.append('<li class="correct">'+n.correct+"</li>"),r.append('<li class="incorrect">'+n.incorrect+"</li>"),q.append(r);a.config.backButtonText&&""!==a.config.backButtonText&&q.append('<a href="#" class="button backToQuestion">'+a.config.backButtonText+
"</a>");a.config.perQuestionResponseMessaging&&(q.append('<a href="#" class="button '+h+'">'+a.config.nextQuestionText+"</a>"),q.append('<a href="#" class="button checkAnswer">'+a.config.checkAnswerText+"</a>"));1>a.config.questionPerPage&&(a.config.questionPerPage=K.questions.length);m==K.questions.length?q.append('<a href="#" class="button '+h+' checkAnswer">'+a.config.submitQuestionText+"</a>"):(m==a.config.questionPerPage||0==m%a.config.questionPerPage)&&q.append('<a href="#" class="button '+
h+'" style = "display: list-item">'+a.config.nextQuestionText+"</a>");m<=a.config.questionPerPage?(q.show(),n=d(' <a href="#question'+(m-1)+'" class="qnbutton notyetanswered free thispage" title="Not yet answered" id="navquestion'+(m-1)+'">'+m+"</a>")):n=d(' <a href="#question'+(m-1)+'" class="qnbutton notyetanswered free" title="Not yet answered" id="navquestion'+(m-1)+'">'+m+"</a>");d("div#exam_navblock .content .qn_buttons").append(n);g.append(q);m++}G.append(g);a.config.skipStartButton||0==p.length?
(p.hide(),a.method.startQuiz.apply(this,[{callback:a.config.animationCallbacks.startQuiz}]),f(c,3).apply(null,[])):p.fadeIn(500,f(c,3));C.turnKeyAndGo(c,b&&b.callback?b.callback:function(){})},startQuiz:function(b){function c(a){var b=d(g+" .questions li").first();b.length&&b.fadeIn(500,function(){a&&a.callback&&a.callback()})}var f=C.getKey(1);var h=C.getKeyNotch;a.config.skipStartButton||0==p.length?c({callback:h(f,1)}):p.fadeOut(300,function(){c({callback:h(f,1)})});C.turnKeyAndGo(f,b&&b.callback?
b.callback:function(){});a.config.events&&a.config.events.onStartQuiz&&a.config.events.onStartQuiz.apply(null,[]);if((b=JSON.parse(localStorage.getItem("quizSt")))&&null!=b.qtime){var m=b.qtime.split(":");m=parseInt(m[2])+parseInt(m[1])+parseInt(m[0]);var n=a.config.quizTime-m}a.config.quizTime&&0<a.config.quizTime?(n=n?n:a.config.quizTime,m=document.querySelector("#qztime"),a.method.startTimer(n,m,"desc","vmQuiz")):(n=m?m:0,m=document.querySelector("#qztime"),a.method.startTimer(n,m,"asc","vmQuiz"))},
resetQuiz:function(b,c){var f=C.getKey(1);var h=C.getKeyNotch;H.fadeOut(300,function(){d(g+" input").prop("checked",!1).prop("disabled",!1);D.attr("class","quizLevel");d(g+" .question").removeClass("correctResponse").removeClass("incorrectResponse");d(g+" .answers li").removeClass("correct").removeClass("incorrect");d(g+" .question,"+g+" .responses,"+g+" .responses li,"+g+" "+m+","+g+" .backToQuestion").hide();d(g+" .questionCount,"+g+" .answers,"+g+" .checkAnswer").show();G.append(d(g+" .questions")).show();
h(f,1).apply(null,[]);a.method.startQuiz({callback:a.config.animationCallbacks.startQuiz},H)});C.turnKeyAndGo(f,c&&c.callback?c.callback:function(){})},checkAnswer:function(b,c){var f=C.getKey(2);var h=C.getKeyNotch;var m=d(d(b).parents(".question")[0]),n=m.find(".answers li"),p=n.find("input:checked"),q=parseInt(m.attr("id").replace(/(question)/,""),10),r=parseInt(m.attr("data-id")),t=R[q].a;q=R[q].select_any?R[q].select_any:!1;n.addClass("incorrect");var v=[];for(i in t)if(t.hasOwnProperty(i)){var P=
t[i],B=parseInt(i,10);P.correct?(v.push(B),"interactive"==a.config.questionMode&&n.eq(B).removeClass("incorrect").addClass("correct")):(-1<d.inArray(B,v)&&v.pop(B),n.eq(B).removeClass("wrong"))}var K=[];p.each(function(){var a=d(this).attr("id");K.push(parseInt(a.replace(/(question\d{1,}_)/,""),10))});if(a.config.preventUnanswered&&0===K.length)return alert(a.config.preventUnansweredText),!1;p=a.method.compareAnswers(v,K,q);d("a#nav"+m.attr("id")+".qnbutton").removeClass("notyetanswered").removeAttr("title");
p?(m.addClass("correctResponse"),"deferredfeedback"!=a.config.questionMode&&n.eq(K[0]).removeClass("incorrect").addClass("correct"),d("a#nav"+m.attr("id")+".qnbutton").removeClass("incorrect").addClass("correct"),a.method.sendQzdata(r,!0)):(m.removeClass("correctResponse"),"deferredfeedback"!=a.config.questionMode&&n.eq(K[0]).addClass("wrong"),d("a#nav"+m.attr("id")+".qnbutton").removeClass("correct").addClass("incorrect"),0<d(g+" .answers").find("input:checked").length&&a.method.sendQzdata(r,!1));
m.find(".responses li").hide();m.find(p?".correct":".incorrect").show();a.config.perQuestionResponseMessaging?("adaptive"!=a.config.questionMode&&(d(b).hide(),m.find(".answers li input[type=radio]").attr("disabled",!0)),a.config.perQuestionResponseAnswers||m.find(".answers").hide(),m.find(".responses").show(),m.find(".backToQuestion").length||h(f,2).apply(null,[])):(h(f,1).apply(null,[]),h(f,2).apply(null,[]));C.turnKeyAndGo(f,c&&c.callback?c.callback:function(){})},nextQuestion:function(b,c){var f=
C.getKey(1);var g=C.getKeyNotch;var h=d(d(b).parents(".question")[0]);b=h.next(".question");var m=h.find("input:checked");if(a.config.preventUnanswered&&0===m.length)return!1;d("a#navquestion0.qnbutton").removeClass("thispage");d("a#navquestion0.qnbutton").nextAll(".qnbutton").removeClass("thispage");b.length?h.fadeOut(300,function(){h.prevAll(".question").hide();if(h.nextAll(".question").length>a.config.questionPerPage){var b=parseInt(h.prevAll(".question").length)+parseInt(a.config.questionPerPage)+
1;h.nextUntil("li#question"+b+".question").show();d("li#question"+(b-1)+".question").find(".backToQuestion").show().end().fadeIn(500,g(f,1));d("a#nav"+h[0].id+".qnbutton").nextUntil("a#navquestion"+b+".qnbutton").addClass("thispage")}else h.nextAll(".question").show(),d("li#question"+(K.questions.length-1)+".question").find(".backToQuestion").show().end().length||g(f,1).apply(null,[]),d("a#nav"+h[0].id+".qnbutton").nextAll(".qnbutton").addClass("thispage")}):(g(f,1).apply(null,[]),a.method.completeQuiz({callback:a.config.animationCallbacks.completeQuiz}));
C.turnKeyAndGo(f,c&&c.callback?c.callback:function(){})},backToQuestion:function(b,c){var f=C.getKey(2);var g=C.getKeyNotch;var h=d(d(b).parents(".question")[0]),n=h.find(".answers");d("a#navquestion0.qnbutton").removeClass("thispage");d("a#navquestion0.qnbutton").nextAll(".qnbutton").removeClass("thispage");if("block"===n.css("display")){var p=h.prev(".question");d("li#question0.question").nextAll(".question").hide();if(h.prevAll(".question").length>=a.config.questionPerPage){b=1+Number(h.attr("id").replace(/^\D+/g,
""));var q=b%a.config.questionPerPage;b=0<q?b-q:b-a.config.questionPerPage;b>a.config.questionPerPage?(d("li#question"+b+".question").prevUntil("li#question"+(b-1-a.config.questionPerPage)+".question").show(),d("a#navquestion"+b+".qnbutton").prevUntil("a#navquestion"+(b-1-a.config.questionPerPage)+".qnbutton").addClass("thispage")):(d("li#question"+b+".question").prevAll(".question").show(),d("a#navquestion"+b+".qnbutton").prevAll(".qnbutton").addClass("thispage"))}else h.prevAll(".question").show();
h.fadeOut(300,function(){p.removeClass("correctResponse").removeClass("incorrectResponse");p.find(".responses, .responses li").hide();p.find(".answers").show();p.find(".checkAnswer").show();g(f,2).apply(null,[])})}else h.find(".responses").fadeOut(300,function(){h.removeClass("correctResponse").removeClass("incorrectResponse");h.find(".responses li").hide();n.fadeIn(500,g(f,1));h.find(".checkAnswer").fadeIn(500,g(f,2));h.find(m).hide();"question0"!=h.attr("id")?h.find(".backToQuestion").show():h.find(".backToQuestion").hide()});
C.turnKeyAndGo(f,c&&c.callback?c.callback:function(){})},diaplayQuestion:function(b,c){C.getKey(1);c=d("li"+b.hash+".question");c.next(".question");c=c.find("input:checked");if(a.config.preventUnanswered&&0===c.length)return!1;c=1+Number(b.id.replace(/^\D+/g,""));if(c>a.config.questionPerPage){var f=0<c%a.config.questionPerPage?parseInt(c/a.config.questionPerPage)+1:parseInt(c/a.config.questionPerPage);c=a.config.questionPerPage*(f-1);f*=a.config.questionPerPage;d("li#question0.question").hide();
d("li#question0").nextAll(".question").hide();d("a#navquestion0.qnbutton").nextAll(".qnbutton").removeClass("thispage");d("a#navquestion0.qnbutton").removeClass("thispage");c>=a.config.questionPerPage?(d("li#question"+(c-1)+".question").nextUntil("li#question"+f+".question").show(),d("a#navquestion"+(c-1)+".qnbutton").nextUntil("a#navquestion"+f+".qnbutton").addClass("thispage")):(d("li#question0.question").nextUntil("li#question"+a.config.questionPerPage+".question").show(),d("a#navquestion0.qnbutton").addClass("thispage"),
d("a#navquestion0.qnbutton").nextUntil("a#navquestion"+a.config.questionPerPage+".qnbutton").addClass("thispage"))}else d("li#question0").nextAll(".question").hide(),d("a#navquestion0.qnbutton").nextAll(".qnbutton").removeClass("thispage"),d("li#question0.question").show(),d("li#question0.question").nextUntil("li#question"+a.config.questionPerPage+".question").show(),d("a#navquestion0.qnbutton").addClass("thispage"),d("a#navquestion0.qnbutton").nextUntil("a#navquestion"+a.config.questionPerPage+".qnbutton").addClass("thispage");
window.location.href=b.hash},flagQuestion:function(a,b){b=d(d(a).parents(".question")[0]);d("a#nav"+b.attr("id")+".qnbutton").toggleClass("trafficlight");d(a).toggleClass("flagged")},startTimer:function(a,b,c,d){function f(){h="asc"==c?a+((Date.now()-g)/1E3|0):a-((Date.now()-g)/1E3|0);m=h/3600|0;n=h%3600/60|0;p=h%60|0;m=10>m?"0"+m:m;n=10>n?"0"+n:n;p=10>p?"0"+p:p;b.textContent=m+":"+n+":"+p;P=m+":"+n+":"+p;0>=h&&(g=0,clearInterval(I))}c="undefined"!==typeof c?c:"desc";var g=Date.now(),h,m,n,p;"asc"!==
c&&f();I=setInterval(f,1E3)},completeQuiz:function(b){var c=C.getKey(1);var f=C.getKeyNotch;var h=d(g+" .answers").find("input:checked").length,m=(Number(K.info.results)/Z).toFixed(3),n=d(g+" .correctResponse").length,p=n*m,r=parseInt(K.info.results);a.config.disableScore?d(q).remove():d(q+" span").html(a.config.scoreTemplateText.replace("%score",p.toFixed(2)).replace("%total",r.toFixed(2)));if(a.config.disableRanking)d(w).remove();else{var t=[K.info.level1,K.info.level2,K.info.level3,K.info.level4,
K.info.level5];m=a.method.calculateLevel(p);t=d.isNumeric(m)?t[m]:"";d(w+" span").html(t);d(w).addClass("level"+m)}G.fadeOut(300,function(){clearInterval(I);if(a.config.completionResponseMessaging)d(g+" .qnbutton").addClass("show"),d(g+" input").prop("disabled",!0),d(g+" .button:not(.tryAgain), "+g+" .questionCount").hide(),d(g+" .question, "+g+" .answers, "+g+" .responses").show(),H.append(d(g+" .questions")).fadeIn(500,f(c,1));else{if(a.config.quizTime&&0<a.config.quizTime){var b=P.split(":");b=
3600*+b[0]+60*+b[1]+ +b[2];b=parseInt(a.config.quizTime)-b;b=virtualclass.quiz.convertSecToTime(b)}else b=P;d(g+" .navblock").hide();H.prepend(d("<h4>Questions attempted: <span>"+h+"</span></h4>"));H.prepend(d("<h4>Correct answers: <span>"+n+"</span></h4>"));H.prepend(d("<h4>Maximum mark: <span>"+r.toFixed(2)+"</span></h4>"));H.prepend(d("<h4>Time taken: <span>"+b+"</span></h4>"));d(g+" #timeText").hide();H.prepend(d("<h4>Total no of questions: <span>"+Z+"</span></h4>"));H.fadeIn(500,f(c,1))}if(!roles.hasControls()){var m=
100*parseInt(p)/parseInt(K.info.results),q=virtualclass.vutil.whoIsTeacher();ioAdapter.mustSendUser({quiz:{quizMsg:"quizsubmitted",timetaken:b,quesattemptd:h,correctans:n,score:m,user:virtualclass.gObj.uid},cf:"quiz"},q);b={noofqus:Z,timetaken:b,quesattemptd:h,correctans:n,score:p,maxmarks:K.info.results};virtualclass.quiz.quizSt.screen="quizsubmitted";localStorage.setItem("qRep",JSON.stringify({grade:b,attemp:null}))}});C.turnKeyAndGo(c,b&&b.callback?b.callback:function(){});a.config.events&&a.config.events.onCompleteQuiz&&
a.config.events.onCompleteQuiz.apply(null,[{questionCount:Z,score:p}])},compareAnswers:function(a,b,c){return c?-1<d.inArray(b[0],a):0===d(a).not(b).length&&0===d(b).not(a).length},calculateLevel:function(b){b=(b/Z).toFixed(2);var c=null;a.method.inRange(0,.2,b)?c=4:a.method.inRange(.21,.4,b)?c=3:a.method.inRange(.41,.6,b)?c=2:a.method.inRange(.61,.8,b)?c=1:a.method.inRange(.81,1,b)&&(c=0);return c},inRange:function(a,b,c){return c>=a&&c<=b},sendQzdata:function(a,b){if(!roles.hasControls()){var c=
virtualclass.vutil.whoIsTeacher();ioAdapter.mustSendUser({quiz:{quizMsg:"quizAttempt",quizid:K.info.quiz,questionId:a,ans:b,user:virtualclass.gObj.uid},cf:"quiz"},c)}}};a.init=function(){a.method.setupQuiz.apply(null,[{callback:a.config.animationCallbacks.setupQuiz}]);p.on("click",function(b){b.preventDefault();this.disabled||d(this).hasClass("disabled")||a.method.startQuiz.apply(null,[{callback:a.config.animationCallbacks.startQuiz}])});d(g+" .tryAgain").on("click",function(b){b.preventDefault();
a.method.resetQuiz(this,{callback:a.config.animationCallbacks.resetQuiz})});d(g+" .checkAnswer").on("click",function(b){b.preventDefault();a.method.checkAnswer(this,{callback:a.config.animationCallbacks.checkAnswer})});if(!a.config.perQuestionResponseMessaging)d(g+" .ansck").on("click",function(b){a.method.checkAnswer(this,{callback:a.config.animationCallbacks.checkAnswer})});d("#exam_navblock .qn_buttons a").on("click",function(b){b.preventDefault();"none"==d("li"+this.hash+".question").css("display")?
a.method.diaplayQuestion(this,{callback:a.config.animationCallbacks.diaplayQuestion}):window.location.href=this.hash});d(g+" .quesname span.unflagged").on("click",function(b){b.preventDefault();a.method.flagQuestion(this,{callback:a.config.animationCallbacks.flagQuestion})});d(g+" .backToQuestion").on("click",function(b){b.preventDefault();a.method.backToQuestion(this,{callback:a.config.animationCallbacks.backToQuestion})});d(g+" "+m).on("click",function(b){b.preventDefault();a.method.nextQuestion(this,
{callback:a.config.animationCallbacks.nextQuestion})});var b=f.attr("id")+"-name";B.attr("id",b);f.attr({"aria-labelledby":b,"aria-live":"polite","aria-relevant":"additions",role:"form"});d(n+', [href = "#"]').attr("role","button")};a.init()};d.fn.slickQuiz=function(c){return this.each(function(){if(void 0===d(this).data("slickQuiz")){var b=new d.slickQuiz(this,c);d(this).data("slickQuiz",b)}})}})(jQuery);(function(d){d.quiz=function(){return{coursequiz:[],uid:virtualclass.gObj.uid,qzid:0,newUserTime:{},list:[],listQuiz:{},uniqueUsers:[],usersFinishedQz:[],quizJSON:{},attemptedUsers:{},cmid:2,exportfilepath:d.exportfilepath,quizSt:{},quizAttempted:{},qGrade:[],init:function(){virtualclass.previrtualclass="virtualclassQuiz";virtualclass.previous="virtualclassQuiz";this.cmid=getUrlVars(exportfilepath).cmid;!roles.hasAdmin()||roles.isEducator()?roles.isStudent()?this.UI.defaultLayoutForStudent():(this.UI.container(),
roles.hasControls()?ioAdapter.mustSend({quiz:{quizMsg:"init"},cf:"quiz"}):this.UI.defaultLayoutForStudent()):(this.UI.container(),ioAdapter.mustSend({quiz:{quizMsg:"init"},cf:"quiz"}));roles.hasControls()&&(console.log("fetchquizes"),this.interfaceToFetchList(this.cmid));var c=JSON.parse(localStorage.getItem("quizSt"));c&&this.storedDataHandle(c)},storedDataHandle:function(c){if("stdPublish"==c.screen){var b=this;virtualclass.storage.getQuizData(function(a){a=JSON.parse(a.qData);b.quizDisplay(a)})}else if("quizsubmitted"==
c.screen){var a=JSON.parse(localStorage.getItem("qRep"));this.UI.displayStudentResultScreen(a)}else"tchResultView"==c.screen&&(b=this,virtualclass.storage.getQuizData(function(a){if("undefined"!==typeof a&&a.hasOwnProperty("qData")&&a.hasOwnProperty("qDetail")){var d=JSON.parse(a.qDetail);c.hasOwnProperty("qtime")&&(d.timelimit=b.convertTimeToSec(c.qtime));b.quizJSON=a.qData;b.openQuizPopup(b.quizJSON,d.id);b.UI.resultView(d);b.tabContent();a.hasOwnProperty("qAttempt")&&(b.quizAttempted=JSON.parse(a.qAttempt),
b.displayAttemptOverview());a.hasOwnProperty("qGrade")&&(b.qGrade=JSON.parse(a.qGrade),b.displayGradeReport());"true"==c.qClosed&&(document.getElementById("closeQzBt").disabled=!0)}}),virtualclass.quiz.quizSt.screen=c.screen)},displayQuizList:function(){var c=!1;virtualclass.quiz.dispList("course");document.getElementById("listquizcourse");if(0<Object.keys(this.coursequiz).length){for(var b in this.coursequiz)this.coursequiz.hasOwnProperty(b)&&!+this.coursequiz[b].quizstatus&&(c=!0,this.displayQuizes(this.coursequiz[b],
b));this.UI.listHeader();if(c)c=document.querySelector("#virtualclassCont.congrea #layoutQuiz #headerContainer"),c.classList.contains("show")||c.classList.add("show");else if(c=document.querySelector("#virtualclassCont.congrea #layoutQuiz #mszBoxQuiz"))c.classList.add("show"),c.innerHTML=virtualclass.lang.getString("noQuiz")}else if(c=document.querySelector("#virtualclassCont.congrea #layoutQuiz #mszBoxQuiz"))c.classList.add("show"),c.innerHTML=virtualclass.lang.getString("noQuiz")},dispList:function(){document.getElementById("mszBoxQuiz");
var c=document.getElementById("listQzCont");c?c.style.display="block":(console.log("quiz layout 2"),this.UI.layout2("layoutQuizBody"))},interfaceToFetchList:function(c){c=new FormData;c.append("cmid",this.cmid);c.append("user",this.uid);var b=this;virtualclass.xhr.send(c,d.webapi+"&methodname=congrea_quiz",function(a){a=JSON.parse(a);if(0==a.status)document.getElementById("bootstrapQzCont").innerHTML=a.message;else{for(var c=0;c<=a.length-1;c++){var d=a[c].options,h;for(h in d)a[c].options[h]=d[h].options}b.coursequiz=
a;b.displayQuizList()}})},displayQuizes:function(c,b){this.UI.qzCont(b);this.UI.qzCtrCont(b);this.UI.qzTextCont(c,b);this.attachQZEvent("publishQz"+b,"click",this.publishHandler,c,b)},attachQZEvent:function(c,b,a,d,g){c=document.getElementById(c);null!=c&&c.addEventListener(b,function(){"undefined"!=typeof d?(console.log("attach time handler"),a(d,g)):console.log("quiz is missing no need of time")})},publishHandler:function(c,b){var a=document.getElementById("mszBoxQuiz");0<a.childNodes.length&&a.childNodes[0].parentNode.removeChild(a.childNodes[0]);
virtualclass.quiz.publishQuiz(c,b)},publishQuiz:function(c,b){this.openQuizPopup(c,b);this.quizPreview(c)},openQuizPopup:function(c,b){this.qzid=b;c=document.getElementById("layoutQuizBody");b=document.createElement("div");b.className="container";c.appendChild(b);(c=document.getElementById("editQuizModal"))&&c.remove();c=document.getElementById("bootstrapQzCont");virtualclass.quiz.UI.generateModal("editQuizModal",c);$("#editQuizModal").modal({backdrop:"static",keyboard:!1});$("#editQuizModal").modal({show:!0})},
showQn:function(c){roles.hasControls()?c.innerHTML="quiz question":c.innerHTML="quiz question for student"},action:function(c,b,a){b(c,a)},getQuizData:function(c){var b=this.coursequiz[c.id],a=new FormData;a.append("cmid",this.cmid);a.append("user",this.uid);a.append("qid",c.id);scope=this;virtualclass.xhr.send(a,d.webapi+"&methodname=congrea_get_quizdata",function(a){if(scope.isJson(a))scope.quizJSON=a,$("#slickQuiz").slickQuiz({json:scope.quizJSON,questionPerPage:b.questionsperpage,questionMode:b.preferredbehaviour,
quizTime:b.timelimit,displayDetailResult:!1});else{var c=document.getElementById("publishQzBt");c.parentNode.removeChild(c);document.getElementById("contQzBody").innerHTML=a}})},quizPopUp:function(c,b){console.log("quiz pop up");for(var a=function(){console.log(this.id);virtualclass.quiz.action(this.id,c,b)},d=(document.getElementById("editQuizModal")?document.getElementById("editQuizModal"):document.getElementById("qzPopup")).querySelectorAll(":scope .controls"),g=0;g<d.length;g++)d[g].addEventListener("click",
a)},quizPreview:function(c){console.log("quiz preview function");this.UI.modalContentUI();var b=document.getElementById("contQzHead"),a=document.createElement("div");a.id="QstnName";a.innerHTML=c.name;b.appendChild(a);a=document.getElementById("contQzBody");b=document.createElement("button");b.id="publishQzBt";b.classList.add("btn","btn-default","controls");b.innerHTML=virtualclass.lang.getString("PQuiz");a.appendChild(b);a=document.createElement("i");a.className="icon-publish";b.appendChild(a);this.getQuizData(c);
this.quizPopUp(this.popupFn,1)},popupFn:function(c,b){virtualclass.quiz[c].call(this.quiz,b)},publishQzBt:function(){var c=virtualclass.quiz,b=c.quizJSON,a=JSON.parse(b).questions.length;c.coursequiz[c.qzid].noOfQus=a;a=c.coursequiz[c.qzid];ioAdapter.mustSend({quiz:{quizMsg:"stdPublish",quizId:c.qzid,data:{json:b,questionPerPage:a.questionsperpage,questionMode:a.preferredbehaviour,quizTime:a.timelimit,displayDetailResult:!1}},cf:"quiz"});c.UI.resultView(a);c.tabContent();c.quizSt.screen="tchResultView";
virtualclass.storage.quizStorage("qDetail",JSON.stringify(a));virtualclass.storage.quizStorage("qData",b);b=new FormData;b.append("cmid",c.cmid);b.append("qzid",c.qzid);b.append("user",c.uid);virtualclass.xhr.send(b,d.webapi+"&methodname=congrea_add_quiz",function(a){"ture"!==a&&console.log("Quiz data not saved in congrea")})},closeQzBt:function(){ioAdapter.mustSend({quiz:{quizMsg:"stdShowResult",data:{qzid:virtualclass.quiz.qzid}},cf:"quiz"});clearInterval(CDTimer);document.getElementById("closeQzBt").disabled=
!0;var c=document.createElement("div");c.className="alert alert-info";c.innerHTML=virtualclass.lang.getString("QClosed");resultQzLayout.insertBefore(c,resultQzLayout.firstChild)},quizDisplay:function(c){var b=document.getElementById("mszBoxQuiz");b&&b.parentNode.removeChild(b);(b=document.getElementById("contQzBody"))&&b.parentNode.removeChild(b);b=document.getElementById("bootstrapQzCont");var a=virtualclass.view.customCreateElement("div","contQzBody","modal-body");b.appendChild(a);this.UI.modalContentUI();
$("#slickQuiz").slickQuiz(c)},saveInLocalStorage:function(){var c=virtualclass.quiz;null!=document.querySelector("#qztime")&&(c.quizSt.qtime=document.querySelector("#qztime").textContent,console.log("quiz="+c.quizSt.qtime));null!=document.querySelector("#elsTime")&&(c.quizSt.qtime=document.querySelector("#elsTime").textContent,console.log("quiz="+c.quizSt.qtime));console.log("quiz="+c.quizSt.screen);null!=document.getElementById("closeQzBt")&&1==document.getElementById("closeQzBt").disabled&&(c.quizSt.qClosed=
"true");c.quizSt&&localStorage.setItem("quizSt",JSON.stringify(c.quizSt));c.quizAttempted&&(console.log("attempt data ="+c.quizAttempted),virtualclass.storage.quizStorage("qAttempt",JSON.stringify(c.quizAttempted)))},onmessage:function(c,b){var a=virtualclass.quiz;"stdPublish"==c.quiz.quizMsg&&(a.dataRec=c.quiz.data,virtualclass.storage.quizStorage("qData",JSON.stringify(a.dataRec)),a.quizSt.screen="stdPublish",this.quizDisplay(c.quiz.data));if("stdShowResult"==c.quiz.quizMsg||"quizTimeEnd"==c.quiz.quizMsg){null!=
document.querySelector("#timeText")&&(document.querySelector("#timeText").textContent="Quiz has been closed");var d=document.querySelector("#slickQuiz .quizResults");d&&"block"!=d.style.display&&(d=document.querySelectorAll("#slickQuiz .nextQuestion"),d[d.length-1].click())}"quizClosed"==c.quiz.quizMsg&&(localStorage.removeItem("quizSt"),this.quizSt={},localStorage.removeItem("qRep"),virtualclass.storage.clearTableData("quizData"),this.UI.defaultLayoutForStudent());if("quizAttempt"==c.quiz.quizMsg&&
roles.hasControls()){"undefined"==typeof this.attemptedUsers[c.quiz.questionId]&&(this.attemptedUsers[c.quiz.questionId]={});d=c.quiz.user;"undefined"==typeof this.attemptedUsers[c.quiz.questionId][d]&&(this.attemptedUsers[c.quiz.questionId][d]={});this.attemptedUsers[c.quiz.questionId][d]=c.quiz.ans;d=Object.keys(this.attemptedUsers[c.quiz.questionId]).length;var g=0;for(h in this.attemptedUsers[c.quiz.questionId])1==this.attemptedUsers[c.quiz.questionId][h]&&g++;document.getElementById("usA_"+c.quiz.questionId).innerHTML=
d;var h=0;0<g&&(h=g/d*100);var m=document.getElementById("qPb_"+c.quiz.questionId);m.innerHTML=h+"% correct";m.style.width=h+"%";"undefined"==typeof this.quizAttempted[c.quiz.questionId]&&(this.quizAttempted[c.quiz.questionId]={});this.quizAttempted[c.quiz.questionId].uA=d;this.quizAttempted[c.quiz.questionId].cA=g}"quizsubmitted"==c.quiz.quizMsg&&roles.hasControls()&&(this.usersFinishedQz.push(c.quiz.user),b=b.name+" "+b.lname,this.gradeReport(this.usersFinishedQz.length,b,c.quiz.timetaken,c.quiz.score,
c.quiz.quesattemptd,c.quiz.correctans),this.qGrade.push({nm:b,tt:c.quiz.timetaken,sc:c.quiz.score,qAt:c.quiz.quesattemptd,ca:c.quiz.correctans}),virtualclass.storage.quizStorage("qGrade",JSON.stringify(a.qGrade)),this.saveGradeInDb(c.quiz.user,c.quiz.timetaken,c.quiz.score,c.quiz.quesattemptd,c.quiz.correctans))},saveGradeInDb:function(c,b,a,f,g){var h=virtualclass.quiz;b=this.convertTimeToSec(b);var m=new FormData;m.append("cmid",h.cmid);m.append("qzid",h.qzid);m.append("user",c);m.append("grade",
a);m.append("timetaken",b);m.append("qusattempted",f);m.append("currectans",g);virtualclass.xhr.send(m,d.webapi+"&methodname=congrea_quiz_result",function(a){"ture"!==a&&console.log("Quiz data not saved in congrea")})},displayAttemptOverview:function(){var c=virtualclass.quiz,b;for(b in c.quizAttempted)if(document.getElementById("usA_"+b).innerHTML=c.quizAttempted[b].uA,0<c.quizAttempted[b].cA){var a=(c.quizAttempted[b].cA/c.quizAttempted[b].uA*100).toFixed(2),d=document.getElementById("qPb_"+b);
d.innerHTML=a+"% correct";d.style.width=a+"%"}},displayGradeReport:function(){for(var c=virtualclass.quiz,b=0;b<c.qGrade.length;b++)c.gradeReport(b+1,c.qGrade[b].nm,c.qGrade[b].tt,c.qGrade[b].sc,c.qGrade[b].qAt,c.qGrade[b].ca)},attemptProgressReport:function(){var c=JSON.parse(virtualclass.quiz.quizJSON),b=virtualclass.view.customCreateElement("div","attemptQzBody","modal-body");c=c.questions;var a=1;for(i=0;i<c.length;i++){var d=virtualclass.view.customCreateElement("div","","q-area");b.appendChild(d);
var g=virtualclass.view.customCreateElement("span","","q-no");g.innerHTML=a;d.appendChild(g);g=virtualclass.view.customCreateElement("div","","qscolor");g.innerHTML=c[i].q;d.appendChild(g);g=virtualclass.view.customCreateElement("div");g.innerHTML="Users attempted : <span id='usA_"+c[i].qid+"'>0</span>";d.appendChild(g);g=this.UI.createProgressBar(c[i].qid,0);d.appendChild(g);a++}return b},tabContent:function(){var c=document.getElementById("resultQzLayout"),b=virtualclass.view.customCreateElement("div",
"","tab-content"),a=virtualclass.view.customCreateElement("div","qzOverv");a.className="tab-pane fade in active";var d=this.attemptProgressReport();a.appendChild(d);b.appendChild(a);a=virtualclass.view.customCreateElement("div","gdRpt");a.className="tab-pane fade";d=this.UI.gradeReportLayout();a.appendChild(d);b.appendChild(a);c.appendChild(b)},gradeReport:function(c,b,a,d,g,h){var f=document.getElementById("qzReTbody");if(f){var n=document.createElement("tr");f.appendChild(n);f=document.createElement("th");
f.scope="row";f.innerHTML=c;n.appendChild(f);c=document.createElement("td");c.innerHTML=b;n.appendChild(c);b=document.createElement("td");b.innerHTML=a;n.appendChild(b);a=document.createElement("td");a.innerHTML=d+"%";n.appendChild(a);d=document.createElement("td");d.innerHTML=g;n.appendChild(d);g=document.createElement("td");g.innerHTML=h;n.appendChild(g)}},quizTimer:function(c,b,a){function d(){h="asc"==a?c+((Date.now()-g)/1E3|0):c-((Date.now()-g)/1E3|0);m=h/3600|0;n=h%3600/60|0;r=h%60|0;m=10>m?
"0"+m:m;n=10>n?"0"+n:n;r=10>r?"0"+r:r;b.textContent=m+":"+n+":"+r;timeTakenQuiz=m+":"+n+":"+r;0>=h&&(g=0,clearInterval(CDTimer),ioAdapter.mustSend({quiz:{quizMsg:"quizTimeEnd",quizId:virtualclass.view.qzid},cf:"quiz"}))}a="undefined"!==typeof a?a:"desc";var g=Date.now(),h,m,n,r;"asc"!==a&&d();CDTimer=setInterval(d,1E3)},quizModalClose:function(){var c=this,b=virtualclass.lang.getString("rusureCquiz");virtualclass.popup.confirmInput(b,function(a){a&&(localStorage.removeItem("quizSt"),c.quizSt={},virtualclass.storage.clearTableData("quizData"),
localStorage.removeItem("qRep"),a=document.getElementById("editQuizModal"),a.parentNode.removeChild(a),c.attemptedUsers={},c.quizAttempted={},ioAdapter.mustSend({quiz:{quizMsg:"quizClosed",quizId:c.qzid},cf:"quiz"}))})},convertSecToTime:function(c){if(/^\d+$/.test(c)){var b=new Date(null);b.setSeconds(c);return b.toISOString().substr(11,8)}return"00:00:00"},convertTimeToSec:function(c){return c?(c=c.split(":"),3600*+c[0]+60*+c[1]+ +c[2]):0},isJson:function(c){try{JSON.parse(c)}catch(b){return!1}return!0},
UI:{id:"virtualclassQuiz",class:"virtualclass",container:function(){console.log("quiz layout check");var c=document.getElementById(this.id);null!=c&&c.parentNode.removeChild(c);c=virtualclass.view.customCreateElement("div",this.id,this.class);virtualclass.vutil.insertAppLayout(c);this.layout(c)},layout:function(c){var b=virtualclass.view.customCreateElement("div","layoutQuiz","bootstrap container-fluid quizLayout");c.appendChild(b);c=document.createElement("nav");c.className="nav navbar ";b.appendChild(c);
var a=virtualclass.view.customCreateElement("div","","vchead");a.innerHTML=virtualclass.lang.getString("Quiz");c.appendChild(a);c=virtualclass.view.customCreateElement("div","layoutQuizBody","quizMainCont");b.appendChild(c);this.createMszBox(c);this.createModalCont(c)},createModalCont:function(c){var b=virtualclass.view.customCreateElement("div","bootstrapQzCont","modalCont");c.appendChild(b)},layout2:function(c){c=document.getElementById(c);var b=document.getElementById("listQzCont");if(null==b){var a=
document.createElement("div");a.className="table-responsive";c.appendChild(a);b=virtualclass.view.customCreateElement("table","listQzCont","table table-bordered table-striped quizList");a.appendChild(b)}},listHeader:function(){var c=document.getElementById("listQzCont"),b=document.createElement("tr");b.classList.add("headerContainer");b.id="headerContainer";c.insertBefore(b,c.firstChild);c=document.createElement("th");c.classList.add("controlsHeader");c.innerHTML=virtualclass.lang.getString("Controls");
b.appendChild(c);var a=document.createElement("i");a.className="icon-setting";c.appendChild(a);c=document.createElement("th");c.classList.add("qnTextHeader");c.innerHTML=virtualclass.lang.getString("Quizes");b.appendChild(c);a=document.createElement("i");a.className="icon-help";c.appendChild(a);c=document.createElement("th");c.classList.add("timeHeader");c.innerHTML=virtualclass.lang.getString("Time");b.appendChild(c);a=document.createElement("i");a.className="icon-creator";c.appendChild(a);c=document.createElement("th");
c.classList.add("qperpageHeader");c.innerHTML=virtualclass.lang.getString("Quiz/page");b.appendChild(c)},createTab:function(){var c=document.createElement("ul");c.classList.add("nav","nav-tabs");var b=document.createElement("li");b.className="active";var a=document.createElement("a");a.setAttribute("data-toggle","tab");a.href="#qzOverv";a.innerHTML="Questions overview";b.appendChild(a);c.appendChild(b);b=document.createElement("li");a=document.createElement("a");a.setAttribute("data-toggle","tab");
a.href="#gdRpt";a.innerHTML=virtualclass.lang.getString("Greport");b.appendChild(a);c.appendChild(b);return c},resultView:function(c){document.getElementById("layoutQuiz");if(roles.hasControls()){this.createResultLayout();var b=parseInt(c.timelimit),a=0<b?"desc":"asc",d=document.getElementById("resultQzLayout"),g=virtualclass.view.customCreateElement("div","rsQzHead","row col-md-12");d.appendChild(g);var h=virtualclass.view.customCreateElement("div","","col-md-3");h.innerHTML="Time limit : <span> "+
virtualclass.quiz.convertSecToTime(c.timelimit)+"</span>";g.appendChild(h);h=virtualclass.view.customCreateElement("div","","col-md-3");h.innerHTML="No of questions : <span> "+c.noOfQus+"</span>";g.appendChild(h);c=virtualclass.view.customCreateElement("div","","col-md-4");c.innerHTML='Elapsed time : <span id="elsTime">00:00</span>';g.appendChild(c);c=virtualclass.view.customCreateElement("button","closeQzBt","");c.classList.add("btn","btn-default","controls");c.innerHTML=virtualclass.lang.getString("Cquiz");
g.appendChild(c);c.addEventListener("click",virtualclass.quiz.closeQzBt);virtualclass.quiz.quizTimer(b,document.getElementById("elsTime"),a);b=this.createTab();d.appendChild(b)}},createResultLayout:function(){var c=document.getElementById("resultQzLayout");c&&c.parentNode.removeChild(c);if(roles.hasControls()){c=document.getElementById("contQzHead");(pubbtn=document.getElementById("publishQzBt"))&&pubbtn.parentNode.removeChild(pubbtn);var b=document.querySelector("#contQzHead .close");b&&(b.parentNode.removeChild(b),
b=virtualclass.view.customCreateElement("div","modalQzClose","close"),b.type="button",b.innerHTML="&times",c.appendChild(b));if(c=document.getElementById("quizModalBody"))for(;1<c.childElementCount;)c.removeChild(c.lastChild);b=document.createElement("div");b.id="resultQzLayout";c.appendChild(b);document.getElementById("modalQzClose").addEventListener("click",function(){virtualclass.quiz.quizModalClose()})}},createProgressBar:function(c,b){var a=virtualclass.view.customCreateElement("div","","progress");
c=virtualclass.view.customCreateElement("div","qPb_"+c,"progress-bar");c.role="progressbar";c.setAttribute("setaria-valuenow",b);c.setAttribute("aria-valuemin","0");c.setAttribute("aria-valuemax","100");c.style="width:"+b+"%";c.innerHTML=b+"% Correct";a.appendChild(c);return a},gradeReportLayout:function(){var c=virtualclass.view.customCreateElement("div","gradeRpBody","modal-body"),b=virtualclass.view.customCreateElement("table","","table"),a=virtualclass.view.customCreateElement("thead","","thead-inverse"),
d=document.createElement("tr"),g=document.createElement("th");g.innerHTML="#";d.appendChild(g);g=document.createElement("th");g.innerHTML="Name";d.appendChild(g);g=document.createElement("th");g.innerHTML="Time taken";d.appendChild(g);g=document.createElement("th");g.innerHTML="Grade";d.appendChild(g);g=document.createElement("th");g.innerHTML="Q. attempted";d.appendChild(g);g=document.createElement("th");g.innerHTML="Correct";d.appendChild(g);a.appendChild(d);b.appendChild(a);a=virtualclass.view.customCreateElement("tbody",
"qzReTbody");b.appendChild(a);c.appendChild(b);return c},displayStudentResultScreen:function(c){var b=document.getElementById("mszBoxQuiz");if(b){var a=document.getElementById("stdQuizMszLayout");a&&b.removeChild(a);a=virtualclass.view.customCreateElement("div","resultDiv");b.appendChild(a);b=document.createElement("h4");b.innerHTML="Total no of questions  <span class='nfqh'>: &nbsp;  "+c.grade.noofqus+"</span>";a.appendChild(b);b=document.createElement("h4");b.innerHTML="Time taken <span class='tth'> : &nbsp;   "+
c.grade.timetaken+"</span>";a.appendChild(b);b=document.createElement("h4");b.innerHTML="Maximum mark <span class='mmh'>: &nbsp;  "+c.grade.maxmarks+"</span>";a.appendChild(b);b=document.createElement("h4");b.innerHTML="Correct answers <span class='cah'>: &nbsp;  "+c.grade.correctans+"</span>";a.appendChild(b);b=document.createElement("h4");b.innerHTML="Questions attempted <span class='qah'>: &nbsp;  "+c.grade.quesattemptd+"</span>";a.appendChild(b);b=document.createElement("h4");b.innerHTML="You Scored <span class='sch'>: &nbsp;  "+
c.grade.score+"</span>";a.appendChild(b);a.style.display="block"}},createMszBox:function(c){var b=virtualclass.view.customCreateElement("div","mszBoxQuiz","row");c.appendChild(b)},generateModal:function(c,b){c=virtualclass.view.customCreateElement("div",c,"modal");c.role="dialog";c.style.display="none";c.setAttribute("tab-index","-1");c.setAttribute("area-hidden","true");b.appendChild(c);var a=document.createElement("div");a.className="modal-dialog";c.appendChild(a);b=virtualclass.view.customCreateElement("div",
"quizModalBody","modal-content");a.appendChild(b);c=virtualclass.view.customCreateElement("div","contQzHead","modal-header");b.appendChild(c);a=virtualclass.view.customCreateElement("div","","close");a.type="button";a.setAttribute("data-dismiss","modal");a.innerHTML="&times";c.appendChild(a);c=virtualclass.view.customCreateElement("div","contQzBody","modal-body");b.appendChild(c)},modalContentUI:function(){var c=document.getElementById("contQzBody"),b=virtualclass.view.customCreateElement("div","slickQuiz",
"path-mod-congrea-quiz"),a=virtualclass.view.customCreateElement("h3","","quizName");b.appendChild(a);a=virtualclass.view.customCreateElement("P","timeText");b.appendChild(a);var d=virtualclass.view.customCreateElement("div","exam_navblock","navblock");b.appendChild(d);a=virtualclass.view.customCreateElement("div","","content");d.appendChild(a);d=virtualclass.view.customCreateElement("div","","qn_buttons multipages");a.appendChild(d);a=virtualclass.view.customCreateElement("div","","quizArea");b.appendChild(a);
d=virtualclass.view.customCreateElement("div","","quizHeader");a.appendChild(d);a=virtualclass.view.customCreateElement("a","","button startQuiz");a.href="#";a.innerHTML="Get Started!";d.appendChild(a);d=virtualclass.view.customCreateElement("div","","quizResults");b.appendChild(d);var g=virtualclass.view.customCreateElement("h3","","quizScore");g.innerHTML="You Scored: <span></span>";d.appendChild(g);g=virtualclass.view.customCreateElement("h3","","quizLevel");a.innerHTML="<strong>Ranking:</strong> <span></span>";
d.appendChild(g);a=virtualclass.view.customCreateElement("div","","quizResultsCopy");d.appendChild(a);c.appendChild(b)},qzCont:function(c){var b=document.getElementById("listQzCont");c=virtualclass.view.customCreateElement("tr","contQz"+c,"vcQuizCont");null!=b&&b.insertBefore(c,b.firstChild)},qzCtrCont:function(c){var b=document.getElementById("contQz"+c),a=virtualclass.view.customCreateElement("td","ctrQz"+c,"quizCtrCont");b.appendChild(a);b=document.createElement("a");b.href="#";b.id="publishQz"+
c;a.appendChild(b);c=document.createElement("span");c.className="icon-publish2";c.setAttribute("data-toggle","tooltip");c.setAttribute("title",virtualclass.lang.getString("quizreviewpublish"));b.appendChild(c)},qzTextCont:function(c,b){b=document.getElementById("contQz"+b);var a=document.createElement("td");a.classList.add("qnText");a.innerHTML=c.name;b.appendChild(a);a=document.createElement("td");a.classList.add("creator");var d=0<c.timelimit?virtualclass.quiz.convertSecToTime(c.timelimit):c.timelimit;
a.innerHTML=d;b.appendChild(a);a=document.createElement("td");a.classList.add("qperpage");a.innerHTML=c.questionsperpage;b.appendChild(a)},defaultLayoutForStudent:function(){this.container();var c=document.getElementById("mszBoxQuiz");if(null==document.getElementById("stdQuizMszLayout")){var b=virtualclass.view.customCreateElement("div","stdQuizMszLayout");b.innerHTML=virtualclass.lang.getString("quizmayshow");c.appendChild(b)}}}}}})(window);!function(){var d=Handlebars.template;(Handlebars.templates=Handlebars.templates||{})["docNotesMain.hbs"]=d({compiler:[7,">= 4.0.0"],main:function(c,b,a,d,g){var f;return'<div id="notesContainer" class="notes ddd">\n  '+c.escapeExpression((f=null!=(f=a.name||(null!=b?b.name:b))?f:a.helperMissing,"function"==typeof f?f.call(null!=b?b:c.nullContext||{},{name:"name",hash:{},data:g}):f))+"\n</div>"},useData:!0})}();(function(d){function c(a){console.log("multivideo, "+a)}function b(){console.log("multivideo, success setRemoteDescriptionSuccess")}function a(a){console.log("multivideo, error setRemoteDescriptionError"+a)}function f(a){console.log("multivideo, error handleCreateAnswerError"+a)}function g(){console.log("multivideo, success addIceCandidateSuccess")}function h(a){console.log("multivideo, error addIceCandidateError"+a)}function m(c,d){v[d]=new RTCPeerConnection(w);v[d].onicecandidate=n(d,"opc");v[d].onaddstream=
A(d);v[d].addStream(_localStream);v[d].setRemoteDescription(new RTCSessionDescription(c.sdp),b,a);console.log("multivideo, addStream and setRemoteDescription for"+d);v[d].createAnswer(function(a){v[d].setLocalDescription(a);console.log("multivideo setLocalDescription for "+d);ioAdapter.sendUser({cf:"mvid",sdp:a,answer:!0},d)},f)}function n(a,b){return function(c){console.log("multivideo, STEP 7(9), handleIceCandidate event");c.candidate?ioAdapter.sendUser({cf:"mvid",candidate:c.candidate,pt:b},a):
console.log("multivideo, STEP 10, End of candidates.")}}function r(a,b){userStreams[b]=a;virtualclass.multiVideo.removeUser(b);b=$("<div class='videoCont remoteVideo' data-userid='"+b+"' data-totaluser=''></div>");$video=$("<video  class='videoBox' autoplay></video>");$video.attr({src:d.URL.createObjectURL(a),autoplay:"autoplay"});b.append($video);$("#videosWrapper").append(b);virtualclass.multiVideo.updateVideoLength();console.log("multivideo, Remote stream added");b.click(function(){t.UI.displayMainVideo(this)})}
function A(a){return function(b){r(b.stream,a);_remoteStream=b.stream}}function z(a){q[a]=new RTCPeerConnection(w);q[a].onicecandidate=n(a,"apc");q[a].onaddstream=A(a);q[a].addStream(_localStream);console.log("multivideo, Set addStream for "+a);console.log("multivideo, Create offer for "+a);q[a].createOffer(function(b){q[a].setLocalDescription(b);console.log("multivideo, setLocalDescription with offer");ioAdapter.sendUser({cf:"mvid",sdp:b,offer:!0},a)},c)}userStreams={};var t={init:function(){this.UI.container();
this.start();var a=document.querySelector("#videosWrapper .videoCont.selfVideo");a.setAttribute("data-userid",virtualclass.gObj.uid);var b=this;userStreams[virtualclass.gObj.uid]=virtualclass.multiVideo.localStream;a.addEventListener("click",function(){b.UI.displayMainVideo(this)});this.updateVideoLength();a=document.querySelector("#speakerPressOnce");virtualclass.vutil.audioStatus(a,"true");a=localStorage.getItem("videoSwitch");null!=a&&"0"==a&&virtualclass.multiVideo.disableVideo()},_init:function(){var a=
document.querySelector("#videosWrapper .videoCont.selfVideo");this.UI.displayMainVideo(a);var b=this;setTimeout(function(){b.displayVideo();roles.hasControls()&&ioAdapter.mustSend({cf:"mvid",_init:!0})},2E3)},displayVideo:function(){document.querySelector("#virtualclassMultiVideo").style.display="block"},start:function(){console.log("Video First, multivideo");virtualclass.multiVideo.localStream=virtualclass.gObj.video.video.tempStream;_localStream=virtualclass.multiVideo.localStream;console.log("multivideo, add get user media ");
selfView=document.querySelector("#videoConfrence .multilocalVideo");virtualclass.adpt.attachMediaStream(selfView,virtualclass.multiVideo.localStream);this.initDone=!0},UI:{container:function(){if(null==document.querySelector("#virtualclassMultiVideo")){var a=virtualclass.getTemplate("multiVideoMain");virtualclass.vutil.insertAppLayout(a())}},displayMainVideoOld:function(a){var b=a.firstElementChild;if("MultiVideo"==virtualclass.currApp){var c=document.querySelector("#multiVidSelected"),d=c.getContext("2d");
"undefined"!=typeof earlierVideo&&clearInterval(earlierVideo);earlierVideo=setInterval(function(){d.drawImage(b,0,0,c.width,c.height)},28)}},displayMainVideo:function(a){if("MultiVideo"==virtualclass.currApp){var b=document.querySelector("#multiVidSelected");virtualclass.adpt.attachMediaStream(b,userStreams[a.dataset.userid])}}},removeUser:function(a){a=document.querySelector('#videosWrapper .videoCont[data-userid="'+a+'"]');null!=a&&a.parentNode.removeChild(a)},onUserRemove:function(a){this.removeUser(a);
this.updateVideoLength()},updateVideoLength:function(){var a=document.querySelectorAll("#videoConfrence .videoCont");document.querySelector("#videoConfrence").setAttribute("data-totalUser",4<a.length?"morethanfour":2<a.length?"four":1<a.length?"two":"one")},disableAudio:function(){var a=virtualclass.multiVideo.localStream.getAudioTracks();if(0===a.length)console.log("No local audio available.");else for(var b=0;b<a.length;++b)a[b].enabled=!a[b].enabled},disableVideo:function(){var a=virtualclass.multiVideo.localStream.getVideoTracks();
if(0===a.length)console.log("No local video available.");else{console.log("Toggling video mute state.");for(var b=0;b<a.length;++b)a[b].enabled=!a[b].enabled}}},v={},q={},w="firefox"===d.webrtcDetectedBrowser?{iceServers:[{url:"stun:23.21.150.121"}]}:{iceServers:[{url:"stun:stun.l.google.com:19302"}]};t.onmessage=function(c,d){if(c.hasOwnProperty("_init"))virtualclass.makeAppReady(virtualclass.apps.mv);else if(c.hasOwnProperty("offer"))m(c,d);else if(c.hasOwnProperty("candidate")){var f=new RTCIceCandidate(c.candidate);
"apc"==c.pt?v[d].addIceCandidate(f,g,h):q[d].addIceCandidate(f,g,h);console.log("multivideo addIcecandidate")}else c.hasOwnProperty("answer")&&(console.log("multivideo setRemoteDescription for"+d),q[d].setRemoteDescription(new RTCSessionDescription(c.sdp),b,a))};t.onUserJoin=function(a){z(a)};d.MultiVideo=t})(window);(function(d,c){"function"===typeof define&&define.amd?define("pdfjs-dist/build/pdf",["exports"],c):"undefined"!==typeof exports?c(exports):c(d.pdfjsDistBuildPdf={})})(this,function(d){var c="undefined"!==typeof document&&document.currentScript?document.currentScript.src:null,b={};(function(){(function(a,b){b(a.pdfjsSharedUtil={})})(this,function(a){function b(a){w>=q.warnings&&console.log("Warning: "+a)}function c(a){w>=q.errors&&(console.log("Error: "+a),console.log(d()));throw Error(a);}function d(){try{throw Error();
}catch(ua){return ua.stack?ua.stack.split("\n").slice(2).join("\n"):""}}function m(a,b){a||c(b)}function n(a){m("string"===typeof a,"Invalid argument for stringToBytes");for(var b=a.length,c=new Uint8Array(b),d=0;d<b;++d)c[d]=a.charCodeAt(d)&255;return c}function r(a){if(void 0!==a.length)return a.length;m(void 0!==a.byteLength);return a.byteLength}function A(a){return"number"===typeof a&&(a|0)===a}function z(){var a={};a.promise=new Promise(function(b,c){a.resolve=b;a.reject=c});return a}function t(a,
b,d){this.sourceName=a;this.targetName=b;this.comObj=d;this.callbackIndex=1;this.postMessageTransfers=!0;var f=this.callbacksCapabilities=Object.create(null),g=this.actionHandler=Object.create(null);this._onComObjOnMessage=function(a){var b=a.data;if(b.targetName===this.sourceName)if(b.isReply)if(a=b.callbackId,b.callbackId in f){var h=f[a];delete f[a];"error"in b?h.reject(b.error):h.resolve(b.data)}else c("Cannot resolve callback "+a);else if(b.action in g){var m=g[b.action];if(b.callbackId){var n=
this.sourceName,p=b.sourceName;Promise.resolve().then(function(){return m[0].call(m[1],b.data)}).then(function(a){d.postMessage({sourceName:n,targetName:p,isReply:!0,callbackId:b.callbackId,data:a})},function(a){a instanceof Error&&(a+="");d.postMessage({sourceName:n,targetName:p,isReply:!0,callbackId:b.callbackId,error:a})})}else m[0].call(m[1],b.data)}else c("Unknown action from worker: "+b.action)}.bind(this);d.addEventListener("message",this._onComObjOnMessage)}var v="undefined"!==typeof window?
window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this,q={errors:0,warnings:1,infos:5},w=q.warnings,p=function(){function a(a,b){this.name="PasswordException";this.message=a;this.code=b}a.prototype=Error();return a.constructor=a}(),B=function(){function a(a,b){this.name="UnknownErrorException";this.message=a;this.details=b}a.prototype=Error();return a.constructor=a}(),G=function(){function a(a){this.name="InvalidPDFException";this.message=a}a.prototype=Error();return a.constructor=
a}(),H=function(){function a(a){this.name="MissingPDFException";this.message=a}a.prototype=Error();return a.constructor=a}(),M=function(){function a(a,b){this.name="UnexpectedResponseException";this.message=a;this.status=b}a.prototype=Error();return a.constructor=a}(),J=function(){function a(a){this.message=a}a.prototype=Error();a.prototype.name="NotImplementedException";return a.constructor=a}(),D=function(){function a(a,b){this.begin=a;this.end=b;this.message="Missing data ["+a+", "+b+")"}a.prototype=
Error();a.prototype.name="MissingDataException";return a.constructor=a}(),I=function(){function a(a){this.message=a}a.prototype=Error();a.prototype.name="XRefParseException";return a.constructor=a}(),P=/\x00/g,K=function(){function a(d,f){this.buffer=d;this.byteLength=d.length;for(d=this.length=void 0===f?this.byteLength>>2:f;c<d;)Object.defineProperty(a.prototype,c,b(c)),c++}function b(a){return{get:function(){var b=this.buffer,c=a<<2;return(b[c]|b[c+1]<<8|b[c+2]<<16|b[c+3]<<24)>>>0},set:function(b){var c=
this.buffer,d=a<<2;c[d]=b&255;c[d+1]=b>>8&255;c[d+2]=b>>16&255;c[d+3]=b>>>24&255}}}a.prototype=Object.create(null);var c=0;return a}();a.Uint32ArrayView=K;var R=function(){function a(){}var b=["rgb(",0,",",0,",",0,")"];a.makeCssRgb=function(a,c,d){b[1]=a;b[3]=c;b[5]=d;return b.join("")};a.transform=function(a,b){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],a[0]*b[4]+a[2]*b[5]+a[4],a[1]*b[4]+a[3]*b[5]+a[5]]};a.applyTransform=function(a,b){return[a[0]*b[0]+
a[1]*b[2]+b[4],a[0]*b[1]+a[1]*b[3]+b[5]]};a.applyInverseTransform=function(a,b){var c=b[0]*b[3]-b[1]*b[2];return[(a[0]*b[3]-a[1]*b[2]+b[2]*b[5]-b[4]*b[3])/c,(-a[0]*b[1]+a[1]*b[0]+b[4]*b[1]-b[5]*b[0])/c]};a.getAxialAlignedBoundingBox=function(b,c){var d=a.applyTransform(b,c),f=a.applyTransform(b.slice(2,4),c),g=a.applyTransform([b[0],b[3]],c);b=a.applyTransform([b[2],b[1]],c);return[Math.min(d[0],f[0],g[0],b[0]),Math.min(d[1],f[1],g[1],b[1]),Math.max(d[0],f[0],g[0],b[0]),Math.max(d[1],f[1],g[1],b[1])]};
a.inverseTransform=function(a){var b=a[0]*a[3]-a[1]*a[2];return[a[3]/b,-a[1]/b,-a[2]/b,a[0]/b,(a[2]*a[5]-a[4]*a[3])/b,(a[4]*a[1]-a[5]*a[0])/b]};a.apply3dTransform=function(a,b){return[a[0]*b[0]+a[1]*b[1]+a[2]*b[2],a[3]*b[0]+a[4]*b[1]+a[5]*b[2],a[6]*b[0]+a[7]*b[1]+a[8]*b[2]]};a.singularValueDecompose2dScale=function(a){var b=[a[0],a[2],a[1],a[3]],c=a[0]*b[0]+a[1]*b[2],d=a[2]*b[1]+a[3]*b[3],f=(c+d)/2;a=Math.sqrt((c+d)*(c+d)-4*(c*d-(a[2]*b[0]+a[3]*b[2])*(a[0]*b[1]+a[1]*b[3])))/2;return[Math.sqrt(f+a||
1),Math.sqrt(f-a||1)]};a.normalizeRect=function(a){var b=a.slice(0);a[0]>a[2]&&(b[0]=a[2],b[2]=a[0]);a[1]>a[3]&&(b[1]=a[3],b[3]=a[1]);return b};a.intersect=function(b,c){function d(a,b){return a-b}var f=[b[0],b[2],c[0],c[2]].sort(d),g=[b[1],b[3],c[1],c[3]].sort(d),h=[];b=a.normalizeRect(b);c=a.normalizeRect(c);if(f[0]===b[0]&&f[1]===c[0]||f[0]===c[0]&&f[1]===b[0])h[0]=f[1],h[2]=f[2];else return!1;if(g[0]===b[1]&&g[1]===c[1]||g[0]===c[1]&&g[1]===b[1])h[1]=g[1],h[3]=g[2];else return!1;return h};a.sign=
function(a){return 0>a?-1:1};var c=" C CC CCC CD D DC DCC DCCC CM  X XX XXX XL L LX LXX LXXX XC  I II III IV V VI VII VIII IX".split(" ");a.toRoman=function(a,b){m(A(a)&&0<a,"The number should be a positive integer.");for(var d,f=[];1E3<=a;)a-=1E3,f.push("M");d=a/100|0;a%=100;f.push(c[d]);d=a/10|0;a%=10;f.push(c[10+d]);f.push(c[20+a]);a=f.join("");return b?a.toLowerCase():a};a.appendToArray=function(a,b){Array.prototype.push.apply(a,b)};a.prependToArray=function(a,b){Array.prototype.unshift.apply(a,
b)};a.extendObj=function(a,b){for(var c in b)a[c]=b[c]};a.getInheritableProperty=function(a,b){for(;a&&!a.has(b);)a=a.get("Parent");return a?a.get(b):null};a.inherit=function(a,b,c){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;for(var d in c)a.prototype[d]=c[d]};a.loadScript=function(a,b){var c=document.createElement("script"),d=!1;c.setAttribute("src",a);b&&(c.onload=function(){d||b();d=!0});document.getElementsByTagName("head")[0].appendChild(c)};return a}();K=function(){function a(a,
b,c,d,f,g){this.viewBox=a;this.scale=b;this.rotation=c;this.offsetX=d;this.offsetY=f;var h=(a[2]+a[0])/2,m=(a[3]+a[1])/2,n;c%=360;switch(0>c?c+360:c){case 180:c=-1;var p=n=0;var q=1;break;case 90:c=0;p=n=1;q=0;break;case 270:c=0;p=n=-1;q=0;break;default:c=1,p=n=0,q=-1}g&&(p=-p,q=-q);0===c?(d=Math.abs(m-a[1])*b+d,f=Math.abs(h-a[0])*b+f,g=Math.abs(a[3]-a[1])*b,a=Math.abs(a[2]-a[0])*b):(d=Math.abs(h-a[0])*b+d,f=Math.abs(m-a[1])*b+f,g=Math.abs(a[2]-a[0])*b,a=Math.abs(a[3]-a[1])*b);this.transform=[c*b,
n*b,p*b,q*b,d-c*b*h-p*b*m,f-n*b*h-q*b*m];this.width=g;this.height=a;this.fontScale=b}a.prototype={clone:function(b){b=b||{};var c="scale"in b?b.scale:this.scale,d="rotation"in b?b.rotation:this.rotation;return new a(this.viewBox.slice(),c,d,this.offsetX,this.offsetY,b.dontFlip)},convertToViewportPoint:function(a,b){return R.applyTransform([a,b],this.transform)},convertToViewportRectangle:function(a){var b=R.applyTransform([a[0],a[1]],this.transform);a=R.applyTransform([a[2],a[3]],this.transform);
return[b[0],b[1],a[0],a[1]]},convertToPdfPoint:function(a,b){return R.applyInverseTransform([a,b],this.transform)}};return a}();var Z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,
64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];(function(){function a(a){this._status=0;this._handlers=[];try{a.call(this,this._resolve.bind(this),this._reject.bind(this))}catch(aa){this._reject(aa)}}if(v.Promise)"function"!==typeof v.Promise.all&&(v.Promise.all=function(a){var b=0,c=[],d,f,g=new v.Promise(function(a,b){d=a;f=b});a.forEach(function(a,g){b++;a.then(function(a){c[g]=a;b--;0===b&&d(c)},f)});0===b&&d(c);return g}),"function"!==typeof v.Promise.resolve&&(v.Promise.resolve=
function(a){return new v.Promise(function(b){b(a)})}),"function"!==typeof v.Promise.reject&&(v.Promise.reject=function(a){return new v.Promise(function(b,c){c(a)})}),"function"!==typeof v.Promise.prototype.catch&&(v.Promise.prototype.catch=function(a){return v.Promise.prototype.then(void 0,a)});else{var c={handlers:[],running:!1,unhandledRejections:[],pendingRejectionCheck:!1,scheduleHandlers:function(a){0!==a._status&&(this.handlers=this.handlers.concat(a._handlers),a._handlers=[],this.running||
(this.running=!0,setTimeout(this.runHandlers.bind(this),0)))},runHandlers:function(){for(var a=Date.now()+1;0<this.handlers.length;){var b=this.handlers.shift(),c=b.thisPromise._status,d=b.thisPromise._value;try{1===c?"function"===typeof b.onResolve&&(d=b.onResolve(d)):"function"===typeof b.onReject&&(d=b.onReject(d),c=1,b.thisPromise._unhandledRejection&&this.removeUnhandeledRejection(b.thisPromise))}catch(ja){c=2,d=ja}b.nextPromise._updateStatus(c,d);if(Date.now()>=a)break}0<this.handlers.length?
setTimeout(this.runHandlers.bind(this),0):this.running=!1},addUnhandledRejection:function(a){this.unhandledRejections.push({promise:a,time:Date.now()});this.scheduleRejectionCheck()},removeUnhandeledRejection:function(a){a._unhandledRejection=!1;for(var b=0;b<this.unhandledRejections.length;b++)this.unhandledRejections[b].promise===a&&(this.unhandledRejections.splice(b),b--)},scheduleRejectionCheck:function(){this.pendingRejectionCheck||(this.pendingRejectionCheck=!0,setTimeout(function(){this.pendingRejectionCheck=
!1;for(var a=Date.now(),c=0;c<this.unhandledRejections.length;c++)if(500<a-this.unhandledRejections[c].time){var d=this.unhandledRejections[c].promise._value,f="Unhandled rejection: "+d;d.stack&&(f+="\n"+d.stack);b(f);this.unhandledRejections.splice(c);c--}this.unhandledRejections.length&&this.scheduleRejectionCheck()}.bind(this),500))}};a.all=function(b){function c(a){2!==g._status&&(m=[],f(a))}var d,f,g=new a(function(a,b){d=a;f=b}),h=b.length,m=[];if(0===h)return d(m),g;for(var n=0,p=b.length;n<
p;++n){var q=b[n],r=function(a){return function(b){2!==g._status&&(m[a]=b,h--,0===h&&d(m))}}(n);a.isPromise(q)?q.then(r,c):r(q)}return g};a.isPromise=function(a){return a&&"function"===typeof a.then};a.resolve=function(b){return new a(function(a){a(b)})};a.reject=function(b){return new a(function(a,c){c(b)})};a.prototype={_status:null,_value:null,_handlers:null,_unhandledRejection:null,_updateStatus:function(b,d){1!==this._status&&2!==this._status&&(1===b&&a.isPromise(d)?d.then(this._updateStatus.bind(this,
1),this._updateStatus.bind(this,2)):(this._status=b,this._value=d,2===b&&0===this._handlers.length&&(this._unhandledRejection=!0,c.addUnhandledRejection(this)),c.scheduleHandlers(this)))},_resolve:function(a){this._updateStatus(1,a)},_reject:function(a){this._updateStatus(2,a)},then:function(b,d){var f=new a(function(a,b){this.resolve=a;this.reject=b});this._handlers.push({thisPromise:this,onResolve:b,onReject:d,nextPromise:f});c.scheduleHandlers(this);return f},catch:function(a){return this.then(void 0,
a)}};v.Promise=a}})();var C=function(){function a(){this.started=Object.create(null);this.times=[];this.enabled=!0}a.prototype={time:function(a){this.enabled&&(a in this.started&&b("Timer is already running for "+a),this.started[a]=Date.now())},timeEnd:function(a){this.enabled&&(a in this.started||b("Timer has not been started for "+a),this.times.push({name:a,start:this.started[a],end:Date.now()}),delete this.started[a])},toString:function(){var a,b=this.times,c="",d=0;var f=0;for(a=b.length;f<a;++f){var g=
b[f].name;g.length>d&&(d=g.length)}f=0;for(a=b.length;f<a;++f){var h=b[f];g=h.end-h.start;for(h=h.name;h.length<d;)h+=" ";c+=h+" "+g+"ms\n"}return c}};return a}(),fa=function(a,b){if("undefined"!==typeof Blob)return new Blob([a],{type:b});var c=new MozBlobBuilder;c.append(a);return c.getBlob(b)},oa=function(){return function(a,b,c){if(!c&&"undefined"!==typeof URL&&URL.createObjectURL)return a=fa(a,b),URL.createObjectURL(a);b="data:"+b+";base64,";c=0;for(var d=a.length;c<d;c+=3){var f=a[c]&255,g=a[c+
1]&255,h=a[c+2]&255;b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="[f>>2]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="[(f&3)<<4|g>>4]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="[c+1<d?(g&15)<<2|h>>6:64]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="[c+2<d?h&63:64]}return b}}();t.prototype={on:function(a,b,d){var f=this.actionHandler;f[a]&&c('There is already an actionName called "'+a+'"');f[a]=[b,d]},send:function(a,
b,c){this.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:a,data:b},c)},sendWithPromise:function(a,b,c){var d=this.callbackIndex++;a={sourceName:this.sourceName,targetName:this.targetName,action:a,data:b,callbackId:d};b=z();this.callbacksCapabilities[d]=b;try{this.postMessage(a,c)}catch(qa){b.reject(qa)}return b.promise},postMessage:function(a,b){b&&this.postMessageTransfers?this.comObj.postMessage(a,b):this.comObj.postMessage(a)},destroy:function(){this.comObj.removeEventListener("message",
this._onComObjOnMessage)}};(function(a){function b(a){""==a&&(g.call(this),this._isInvalid=!0);return a.toLowerCase()}function c(a){var b=a.charCodeAt(0);return 32<b&&127>b&&-1==[34,35,60,62,63,96].indexOf(b)?a:encodeURIComponent(a)}function d(a){var b=a.charCodeAt(0);return 32<b&&127>b&&-1==[34,35,60,62,96].indexOf(b)?a:encodeURIComponent(a)}function f(a,f,h){function m(a){Ka.push(a)}var n=f||"scheme start",C=0,v="",P=!1,K=!1,Ka=[];a:for(;(void 0!=a[C-1]||0==C)&&!this._isInvalid;){var w=a[C];switch(n){case "scheme start":if(w&&
r.test(w))v+=w.toLowerCase(),n="scheme";else if(f){m("Invalid scheme.");break a}else{v="";n="no scheme";continue}break;case "scheme":if(w&&t.test(w))v+=w.toLowerCase();else if(":"==w){this._scheme=v;v="";if(f)break a;void 0!==p[this._scheme]&&(this._isRelative=!0);n="file"==this._scheme?"relative":this._isRelative&&h&&h._scheme==this._scheme?"relative or authority":this._isRelative?"authority first slash":"scheme data"}else if(f){void 0!=w&&m("Code point not allowed in scheme: "+w);break a}else{v=
"";C=0;n="no scheme";continue}break;case "scheme data":"?"==w?(this._query="?",n="query"):"#"==w?(this._fragment="#",n="fragment"):void 0!=w&&"\t"!=w&&"\n"!=w&&"\r"!=w&&(this._schemeData+=c(w));break;case "no scheme":if(h&&void 0!==p[h._scheme]){n="relative";continue}else m("Missing scheme."),g.call(this),this._isInvalid=!0;break;case "relative or authority":if("/"==w&&"/"==a[C+1])n="authority ignore slashes";else{m("Expected /, got: "+w);n="relative";continue}break;case "relative":this._isRelative=
!0;"file"!=this._scheme&&(this._scheme=h._scheme);if(void 0==w){this._host=h._host;this._port=h._port;this._path=h._path.slice();this._query=h._query;this._username=h._username;this._password=h._password;break a}else if("/"==w||"\\"==w)"\\"==w&&m("\\ is an invalid code point."),n="relative slash";else if("?"==w)this._host=h._host,this._port=h._port,this._path=h._path.slice(),this._query="?",this._username=h._username,this._password=h._password,n="query";else if("#"==w)this._host=h._host,this._port=
h._port,this._path=h._path.slice(),this._query=h._query,this._fragment="#",this._username=h._username,this._password=h._password,n="fragment";else{n=a[C+1];var B=a[C+2];if("file"!=this._scheme||!r.test(w)||":"!=n&&"|"!=n||void 0!=B&&"/"!=B&&"\\"!=B&&"?"!=B&&"#"!=B)this._host=h._host,this._port=h._port,this._username=h._username,this._password=h._password,this._path=h._path.slice(),this._path.pop();n="relative path";continue}break;case "relative slash":if("/"==w||"\\"==w)"\\"==w&&m("\\ is an invalid code point."),
n="file"==this._scheme?"file host":"authority ignore slashes";else{"file"!=this._scheme&&(this._host=h._host,this._port=h._port,this._username=h._username,this._password=h._password);n="relative path";continue}break;case "authority first slash":if("/"==w)n="authority second slash";else{m("Expected '/', got: "+w);n="authority ignore slashes";continue}break;case "authority second slash":n="authority ignore slashes";if("/"!=w){m("Expected '/', got: "+w);continue}break;case "authority ignore slashes":if("/"!=
w&&"\\"!=w){n="authority";continue}else m("Expected authority, got: "+w);break;case "authority":if("@"==w){P&&(m("@ already seen."),v+="%40");P=!0;for(w=0;w<v.length;w++)B=v[w],"\t"==B||"\n"==B||"\r"==B?m("Invalid whitespace in authority."):":"==B&&null===this._password?this._password="":(B=c(B),null!==this._password?this._password+=B:this._username+=B);v=""}else if(void 0==w||"/"==w||"\\"==w||"?"==w||"#"==w){C-=v.length;v="";n="host";continue}else v+=w;break;case "file host":if(void 0==w||"/"==w||
"\\"==w||"?"==w||"#"==w){2!=v.length||!r.test(v[0])||":"!=v[1]&&"|"!=v[1]?(0!=v.length&&(this._host=b.call(this,v),v=""),n="relative path start"):n="relative path";continue}else"\t"==w||"\n"==w||"\r"==w?m("Invalid whitespace in file host."):v+=w;break;case "host":case "hostname":if(":"!=w||K)if(void 0==w||"/"==w||"\\"==w||"?"==w||"#"==w){this._host=b.call(this,v);v="";n="relative path start";if(f)break a;continue}else"\t"!=w&&"\n"!=w&&"\r"!=w?("["==w?K=!0:"]"==w&&(K=!1),v+=w):m("Invalid code point in host/hostname: "+
w);else if(this._host=b.call(this,v),v="",n="port","hostname"==f)break a;break;case "port":if(/[0-9]/.test(w))v+=w;else if(void 0==w||"/"==w||"\\"==w||"?"==w||"#"==w||f){""!=v&&(v=parseInt(v,10),v!=p[this._scheme]&&(this._port=v+""),v="");if(f)break a;n="relative path start";continue}else"\t"==w||"\n"==w||"\r"==w?m("Invalid code point in port: "+w):(g.call(this),this._isInvalid=!0);break;case "relative path start":"\\"==w&&m("'\\' not allowed in path.");n="relative path";if("/"!=w&&"\\"!=w)continue;
break;case "relative path":if(void 0!=w&&"/"!=w&&"\\"!=w&&(f||"?"!=w&&"#"!=w))"\t"!=w&&"\n"!=w&&"\r"!=w&&(v+=c(w));else{"\\"==w&&m("\\ not allowed in relative path.");if(B=q[v.toLowerCase()])v=B;".."==v?(this._path.pop(),"/"!=w&&"\\"!=w&&this._path.push("")):"."==v&&"/"!=w&&"\\"!=w?this._path.push(""):"."!=v&&("file"==this._scheme&&0==this._path.length&&2==v.length&&r.test(v[0])&&"|"==v[1]&&(v=v[0]+":"),this._path.push(v));v="";"?"==w?(this._query="?",n="query"):"#"==w&&(this._fragment="#",n="fragment")}break;
case "query":f||"#"!=w?void 0!=w&&"\t"!=w&&"\n"!=w&&"\r"!=w&&(this._query+=d(w)):(this._fragment="#",n="fragment");break;case "fragment":void 0!=w&&"\t"!=w&&"\n"!=w&&"\r"!=w&&(this._fragment+=w)}C++}}function g(){this._username=this._schemeData=this._scheme="";this._password=null;this._port=this._host="";this._path=[];this._fragment=this._query="";this._isRelative=this._isInvalid=!1}function h(a,b){void 0===b||b instanceof h||(b=new h(String(b)));this._url=a;g.call(this);a=a.replace(/^[ \t\r\n\f]+|[ \t\r\n\f]+$/g,
"");f.call(this,a,null,b)}var m=!1;try{if("function"===typeof URL&&"object"===typeof URL.prototype&&"origin"in URL.prototype){var n=new URL("b","http://a");n.pathname="c%20d";m="http://a/c%20d"===n.href}}catch(Ja){}if(!m){var p=Object.create(null);p.ftp=21;p.file=0;p.gopher=70;p.http=80;p.https=443;p.ws=80;p.wss=443;var q=Object.create(null);q["%2e"]=".";q[".%2e"]="..";q["%2e."]="..";q["%2e%2e"]="..";var r=/[a-zA-Z]/,t=/[a-zA-Z0-9\+\-\.]/;h.prototype={toString:function(){return this.href},get href(){if(this._isInvalid)return this._url;
var a="";if(""!=this._username||null!=this._password)a=this._username+(null!=this._password?":"+this._password:"")+"@";return this.protocol+(this._isRelative?"//"+a+this.host:"")+this.pathname+this._query+this._fragment},set href(a){g.call(this);f.call(this,a)},get protocol(){return this._scheme+":"},set protocol(a){this._isInvalid||f.call(this,a+":","scheme start")},get host(){return this._isInvalid?"":this._port?this._host+":"+this._port:this._host},set host(a){!this._isInvalid&&this._isRelative&&
f.call(this,a,"host")},get hostname(){return this._host},set hostname(a){!this._isInvalid&&this._isRelative&&f.call(this,a,"hostname")},get port(){return this._port},set port(a){!this._isInvalid&&this._isRelative&&f.call(this,a,"port")},get pathname(){return this._isInvalid?"":this._isRelative?"/"+this._path.join("/"):this._schemeData},set pathname(a){!this._isInvalid&&this._isRelative&&(this._path=[],f.call(this,a,"relative path start"))},get search(){return this._isInvalid||!this._query||"?"==this._query?
"":this._query},set search(a){!this._isInvalid&&this._isRelative&&(this._query="?","?"==a[0]&&(a=a.slice(1)),f.call(this,a,"query"))},get hash(){return this._isInvalid||!this._fragment||"#"==this._fragment?"":this._fragment},set hash(a){this._isInvalid||(this._fragment="#","#"==a[0]&&(a=a.slice(1)),f.call(this,a,"fragment"))},get origin(){var a;if(this._isInvalid||!this._scheme)return"";switch(this._scheme){case "data":case "file":case "javascript":case "mailto":return"null"}return(a=this.host)?this._scheme+
"://"+a:""}};var C=a.URL;C&&(h.createObjectURL=function(a){return C.createObjectURL.apply(C,arguments)},h.revokeObjectURL=function(a){C.revokeObjectURL(a)});a.URL=h}})(v);a.FONT_IDENTITY_MATRIX=[.001,0,0,.001,0,0];a.IDENTITY_MATRIX=[1,0,0,1,0,0];a.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,
closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,
setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,
endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};a.VERBOSITY_LEVELS=q;a.UNSUPPORTED_FEATURES={unknown:"unknown",forms:"forms",javaScript:"javaScript",smask:"smask",shadingPattern:"shadingPattern",font:"font"};a.AnnotationBorderStyleType={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};
a.AnnotationFlag={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};a.AnnotationType={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};a.FontType={UNKNOWN:0,TYPE1:1,TYPE1C:2,CIDFONTTYPE0:3,CIDFONTTYPE0C:4,TRUETYPE:5,
CIDFONTTYPE2:6,TYPE3:7,OPENTYPE:8,TYPE0:9,MMTYPE1:10};a.ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};a.InvalidPDFException=G;a.MessageHandler=t;a.MissingDataException=D;a.MissingPDFException=H;a.NotImplementedException=J;a.PageViewport=K;a.PasswordException=p;a.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};a.StatTimer=C;a.StreamType={UNKNOWN:0,FLATE:1,LZW:2,DCT:3,JPX:4,JBIG:5,A85:6,AHX:7,CCF:8,RL:9};a.TextRenderingMode={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,
STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};a.UnexpectedResponseException=M;a.UnknownErrorException=B;a.Util=R;a.XRefParseException=I;a.arrayByteLength=r;a.arraysToBytes=function(a){if(1===a.length&&a[0]instanceof Uint8Array)return a[0];var b=0,c,d=a.length;for(c=0;c<d;c++){var f=a[c];var g=r(f);b+=g}var h=0;b=new Uint8Array(b);for(c=0;c<d;c++)f=a[c],f instanceof Uint8Array||(f="string"===typeof f?n(f):new Uint8Array(f)),g=f.byteLength,b.set(f,
h),h+=g;return b};a.assert=m;a.bytesToString=function(a){m(null!==a&&"object"===typeof a&&void 0!==a.length,"Invalid argument for bytesToString");var b=a.length;if(8192>b)return String.fromCharCode.apply(null,a);for(var c=[],d=0;d<b;d+=8192){var f=a.subarray(d,Math.min(d+8192,b));c.push(String.fromCharCode.apply(null,f))}return c.join("")};a.createBlob=fa;a.createPromiseCapability=z;a.createObjectURL=oa;a.deprecated=function(a){console.log("Deprecated API usage: "+a)};a.error=c;a.getLookupTableFactory=
function(a){var b;return function(){a&&(b=Object.create(null),a(b),a=null);return b}};a.getVerbosityLevel=function(){return w};a.globalScope=v;a.info=function(a){w>=q.infos&&console.log("Info: "+a)};a.isArray=function(a){return a instanceof Array};a.isArrayBuffer=function(a){return"object"===typeof a&&null!==a&&void 0!==a.byteLength};a.isBool=function(a){return"boolean"===typeof a};a.isEmptyObj=function(a){for(var b in a)return!1;return!0};a.isInt=A;a.isNum=function(a){return"number"===typeof a};
a.isString=function(a){return"string"===typeof a};a.isSameOrigin=function(a,b){try{var c=new URL(a);if(!c.origin||"null"===c.origin)return!1}catch(aa){return!1}a=new URL(b,c);return c.origin===a.origin};a.isValidUrl=function(a,b){if(!a||"string"!==typeof a)return!1;a=/^[a-z][a-z0-9+\-.]*(?=:)/i.exec(a);if(!a)return b;a=a[0].toLowerCase();switch(a){case "http":case "https":case "ftp":case "mailto":case "tel":return!0;default:return!1}};a.isLittleEndian=function(){var a=new Uint8Array(2);a[0]=1;return 1===
(new Uint16Array(a.buffer))[0]};a.isEvalSupported=function(){try{return new Function(""),!0}catch(ua){return!1}};a.loadJpegStream=function(a,c,d){var f=new Image;f.onload=function(){d.resolve(a,f)};f.onerror=function(){d.resolve(a,null);b("Error during JPEG image loading")};f.src=c};a.log2=function(a){for(var b=1,c=0;a>b;)b<<=1,c++;return c};a.readInt8=function(a,b){return a[b]<<24>>24};a.readUint16=function(a,b){return a[b]<<8|a[b+1]};a.readUint32=function(a,b){return(a[b]<<24|a[b+1]<<16|a[b+2]<<
8|a[b+3])>>>0};a.removeNullCharacters=function(a){return"string"!==typeof a?(b("The argument for removeNullCharacters must be a string."),a):a.replace(P,"")};a.setVerbosityLevel=function(a){w=a};a.shadow=function(a,b,c){Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!1});return c};a.string32=function(a){return String.fromCharCode(a>>24&255,a>>16&255,a>>8&255,a&255)};a.stringToBytes=n;a.stringToPDFString=function(a){var b,c=a.length,d=[];if("\u00fe"===a[0]&&"\u00ff"===a[1])for(b=
2;b<c;b+=2)d.push(String.fromCharCode(a.charCodeAt(b)<<8|a.charCodeAt(b+1)));else for(b=0;b<c;++b){var f=Z[a.charCodeAt(b)];d.push(f?String.fromCharCode(f):a.charAt(b))}return d.join("")};a.stringToUTF8String=function(a){return decodeURIComponent(escape(a))};a.utf8StringToString=function(a){return unescape(encodeURIComponent(a))};a.warn=b});(function(a,b){b(a.pdfjsDisplayDOMUtils={},a.pdfjsSharedUtil)})(this,function(a,b){function c(a){var c=b.globalScope.PDFJS;switch(a){case "pdfBug":return c?c.pdfBug:
!1;case "disableAutoFetch":return c?c.disableAutoFetch:!1;case "disableStream":return c?c.disableStream:!1;case "disableRange":return c?c.disableRange:!1;case "disableFontFace":return c?c.disableFontFace:!1;case "disableCreateObjectURL":return c?c.disableCreateObjectURL:!1;case "disableWebGL":return c?c.disableWebGL:!0;case "cMapUrl":return c?c.cMapUrl:null;case "cMapPacked":return c?c.cMapPacked:!1;case "postMessageTransfers":return c?c.postMessageTransfers:!0;case "workerSrc":return c?c.workerSrc:
null;case "disableWorker":return c?c.disableWorker:!1;case "maxImageSize":return c?c.maxImageSize:-1;case "imageResourcesPath":return c?c.imageResourcesPath:"";case "isEvalSupported":return c?c.isEvalSupported:!0;case "externalLinkTarget":if(!c)return r.NONE;switch(c.externalLinkTarget){case r.NONE:case r.SELF:case r.BLANK:case r.PARENT:case r.TOP:return c.externalLinkTarget}f("PDFJS.externalLinkTarget is invalid: "+c.externalLinkTarget);return c.externalLinkTarget=r.NONE;case "externalLinkRel":return c?
c.externalLinkRel:"noreferrer";case "enableStats":return!(!c||!c.enableStats);default:throw Error("Unknown default setting: "+a);}}var d=b.removeNullCharacters,f=b.warn,n=function(){function a(){}var b=["ms","Moz","Webkit","O"],c=Object.create(null);a.getProp=function(a,d){if(1===arguments.length&&"string"===typeof c[a])return c[a];d=d||document.documentElement;var f=d.style;if("string"===typeof f[a])return c[a]=a;var g=a.charAt(0).toUpperCase()+a.slice(1);for(var h=0,m=b.length;h<m;h++){var n=b[h]+
g;if("string"===typeof f[n])return c[a]=n}return c[a]="undefined"};a.setProp=function(a,b,c){a=this.getProp(a);"undefined"!==a&&(b.style[a]=c)};return a}(),r={NONE:0,SELF:1,BLANK:2,PARENT:3,TOP:4},A=["","_self","_blank","_parent","_top"];a.CustomStyle=n;a.addLinkAttributes=function(a,b){var f=b&&b.url;a.href=a.title=f?d(f):"";f&&(f=b.target,"undefined"===typeof f&&(f=c("externalLinkTarget")),a.target=A[f],b=b.rel,"undefined"===typeof b&&(b=c("externalLinkRel")),a.rel=b)};a.isExternalLinkTargetSet=
function(){switch(c("externalLinkTarget")){case r.NONE:return!1;case r.SELF:case r.BLANK:case r.PARENT:case r.TOP:return!0}};a.getFilenameFromUrl=function(a){var b=a.indexOf("#"),c=a.indexOf("?");b=Math.min(0<b?b:a.length,0<c?c:a.length);return a.substring(a.lastIndexOf("/",b)+1,b)};a.LinkTarget=r;a.hasCanvasTypedArrays=function(){var a=document.createElement("canvas");a.width=a.height=1;return"undefined"!==typeof a.getContext("2d").createImageData(1,1).data.buffer};a.getDefaultSetting=c});(function(a,
b){b(a.pdfjsDisplayFontLoader={},a.pdfjsSharedUtil)})(this,function(a,b){function c(a){this.docId=a;this.styleElement=null;this.nativeFontFaces=[];this.loadTestFontId=0;this.loadingContext={requests:[],nextRequestId:0}}var d=b.assert,f=b.bytesToString,n=b.string32,r=b.shadow,A=b.warn;c.prototype={insertRule:function(a){var b=this.styleElement;b||(b=this.styleElement=document.createElement("style"),b.id="PDFJS_FONT_STYLE_TAG_"+this.docId,document.documentElement.getElementsByTagName("head")[0].appendChild(b));
b=b.sheet;b.insertRule(a,b.cssRules.length)},clear:function(){var a=this.styleElement;a&&(a.parentNode.removeChild(a),a=this.styleElement=null);this.nativeFontFaces.forEach(function(a){document.fonts.delete(a)});this.nativeFontFaces.length=0},get loadTestFont(){return r(this,"loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))},
addNativeFontFace:function(a){this.nativeFontFaces.push(a);document.fonts.add(a)},bind:function(a,b){for(var d=[],f=[],g=[],h=function(a){return a.loaded.catch(function(b){A('Failed to load font "'+a.family+'": '+b)})},m=0,n=a.length;m<n;m++){var q=a[m];if(!q.attached&&!1!==q.loading)if(q.attached=!0,c.isFontLoadingAPISupported){if(q=q.createNativeFontFace())this.addNativeFontFace(q),g.push(h(q))}else{var r=q.createFontFaceRule();r&&(this.insertRule(r),d.push(r),f.push(q))}}var v=this.queueLoadingCallback(b);
c.isFontLoadingAPISupported?Promise.all(g).then(function(){v.complete()}):0<d.length&&!c.isSyncFontLoadingSupported?this.prepareFontLoadEvent(d,f,v):v.complete()},queueLoadingCallback:function(a){var b=this.loadingContext,c={id:"pdfjs-font-loading-"+b.nextRequestId++,complete:function(){d(!c.end,"completeRequest() cannot be called twice");for(c.end=Date.now();0<b.requests.length&&b.requests[0].end;){var a=b.requests.shift();setTimeout(a.callback,0)}},callback:a,started:Date.now()};b.requests.push(c);
return c},prepareFontLoadEvent:function(a,b,c){function d(a,b){return a.charCodeAt(b)<<24|a.charCodeAt(b+1)<<16|a.charCodeAt(b+2)<<8|a.charCodeAt(b+3)&255}function f(a,b,c,d){var f=a.substr(0,b);a=a.substr(b+c);return f+d+a}function g(a,b){q++;30<q?(A("Load test font never loaded."),b()):(m.font="30px "+a,m.fillText(".",0,20),0<m.getImageData(0,0,1,1).data[3]?b():setTimeout(g.bind(null,a,b)))}var h;a=document.createElement("canvas");a.width=1;a.height=1;var m=a.getContext("2d"),q=0;a="lt"+Date.now()+
this.loadTestFontId++;var r=this.loadTestFont;r=f(r,976,a.length,a);var t=d(r,16);var v=0;for(h=a.length-3;v<h;v+=4)t=t-1482184792+d(a,v)|0;v<a.length&&(t=t-1482184792+d(a+"XXX",v)|0);r=f(r,16,4,n(t));v="url(data:font/opentype;base64,"+btoa(r)+");";this.insertRule('@font-face { font-family:"'+a+'";src:'+v+"}");r=[];v=0;for(h=b.length;v<h;v++)r.push(b[v].loadedName);r.push(a);var w=document.createElement("div");w.setAttribute("style","visibility: hidden;width: 10px; height: 10px;position: absolute; top: 0px; left: 0px;");
v=0;for(h=r.length;v<h;++v)b=document.createElement("span"),b.textContent="Hi",b.style.fontFamily=r[v],w.appendChild(b);document.body.appendChild(w);g(a,function(){document.body.removeChild(w);c.complete()})}};c.isFontLoadingAPISupported="undefined"!==typeof document&&!!document.fonts;Object.defineProperty(c,"isSyncFontLoadingSupported",{get:function(){if("undefined"===typeof navigator)return r(c,"isSyncFontLoadingSupported",!0);var a=!1,b=/Mozilla\/5.0.*?rv:(\d+).*? Gecko/.exec(navigator.userAgent);
b&&14<=b[1]&&(a=!0);return r(c,"isSyncFontLoadingSupported",a)},enumerable:!0,configurable:!0});var z={get value(){return r(this,"value",b.isEvalSupported())}},t=function(){function a(a,b){this.compiledGlyphs=Object.create(null);for(var c in a)this[c]=a[c];this.options=b}a.prototype={createNativeFontFace:function(){if(!this.data)return null;if(this.options.disableFontFace)return this.disableFontFace=!0,null;var a=new FontFace(this.loadedName,this.data,{});this.options.fontRegistry&&this.options.fontRegistry.registerFont(this);
return a},createFontFaceRule:function(){if(!this.data)return null;if(this.options.disableFontFace)return this.disableFontFace=!0,null;var a=f(new Uint8Array(this.data)),b=this.loadedName;a="url(data:"+this.mimetype+";base64,"+btoa(a)+");";b='@font-face { font-family:"'+b+'";src:'+a+"}";this.options.fontRegistry&&this.options.fontRegistry.registerFont(this,a);return b},getPathGenerator:function(a,b){if(!(b in this.compiledGlyphs)){var c=a.get(this.loadedName+"_path_"+b),d;if(this.options.isEvalSupported&&
z.value){var f="";var g=0;for(d=c.length;g<d;g++){var h=c[g];a=void 0!==h.args?h.args.join(","):"";f+="c."+h.cmd+"("+a+");\n"}this.compiledGlyphs[b]=new Function("c","size",f)}else this.compiledGlyphs[b]=function(a,b){g=0;for(d=c.length;g<d;g++)h=c[g],"scale"===h.cmd&&(h.args=[b,-b]),a[h.cmd].apply(a,h.args)}}return this.compiledGlyphs[b]}};return a}();a.FontFaceObject=t;a.FontLoader=c});(function(a,b){b(a.pdfjsDisplayMetadata={},a.pdfjsSharedUtil)})(this,function(a,b){function c(a){return a.replace(/>\\376\\377([^<]+)/g,
function(a,b){a=b.replace(/\\([0-3])([0-7])([0-7])/g,function(a,b,c,d){return String.fromCharCode(64*b+8*c+1*d)});b="";for(var c=0;c<a.length;c+=2){var d=256*a.charCodeAt(c)+a.charCodeAt(c+1);b+="&#x"+(65536+d).toString(16).substring(1)+";"}return">"+b})}function d(a){"string"===typeof a?(a=c(a),a=(new DOMParser).parseFromString(a,"application/xml")):a instanceof Document||f("Metadata: Invalid metadata object");this.metaDocument=a;this.metadata=Object.create(null);this.parse()}var f=b.error;d.prototype=
{parse:function(){var a=this.metaDocument.documentElement;if("rdf:rdf"!==a.nodeName.toLowerCase())for(a=a.firstChild;a&&"rdf:rdf"!==a.nodeName.toLowerCase();)a=a.nextSibling;var b=a?a.nodeName.toLowerCase():null;if(a&&"rdf:rdf"===b&&a.hasChildNodes()){a=a.childNodes;var c,d;var f=0;for(c=a.length;f<c;f++)if(b=a[f],"rdf:description"===b.nodeName.toLowerCase()){var g=0;for(d=b.childNodes.length;g<d;g++)if("#text"!==b.childNodes[g].nodeName.toLowerCase()){var h=b.childNodes[g];var m=h.nodeName.toLowerCase();
this.metadata[m]=h.textContent.trim()}}}},get:function(a){return this.metadata[a]||null},has:function(a){return"undefined"!==typeof this.metadata[a]}};a.Metadata=d});(function(a,b){b(a.pdfjsDisplaySVG={},a.pdfjsSharedUtil)})(this,function(a,b){var c=b.FONT_IDENTITY_MATRIX,d=b.IDENTITY_MATRIX,f=b.ImageKind,n=b.OPS,r=b.Util,A=b.isNum,z=b.isArray,t=b.warn,v=b.createObjectURL,q=function(){function a(a,b,d,f){var g=f,h=b.length;d[g]=h>>24&255;d[g+1]=h>>16&255;d[g+2]=h>>8&255;d[g+3]=h&255;g+=4;d[g]=a.charCodeAt(0)&
255;d[g+1]=a.charCodeAt(1)&255;d[g+2]=a.charCodeAt(2)&255;d[g+3]=a.charCodeAt(3)&255;g+=4;d.set(b,g);g+=b.length;a=-1;for(f+=4;f<g;f++)a=a>>>8^c[(a^d[f])&255];f=a^-1;d[g]=f>>24&255;d[g+1]=f>>16&255;d[g+2]=f>>8&255;d[g+3]=f&255}for(var b=new Uint8Array([137,80,78,71,13,10,26,10]),c=new Int32Array(256),d=0;256>d;d++){for(var g=d,h=0;8>h;h++)g=g&1?3988292384^g>>1&2147483647:g>>1&2147483647;c[d]=g}return function(c,d){var g=void 0===c.kind?f.GRAYSCALE_1BPP:c.kind,h=c.width,m=c.height,n=c.data;switch(g){case f.GRAYSCALE_1BPP:var p=
0;var q=1;var r=h+7>>3;break;case f.RGB_24BPP:p=2;q=8;r=3*h;break;case f.RGBA_32BPP:p=6;q=8;r=4*h;break;default:throw Error("invalid format");}c=new Uint8Array((1+r)*m);var t=0,w=0,B;for(B=0;B<m;++B)c[t++]=0,c.set(n.subarray(w,w+r),t),w+=r,t+=r;if(g===f.GRAYSCALE_1BPP)for(B=t=0;B<m;B++)for(t++,g=0;g<r;g++)c[t++]^=255;h=new Uint8Array([h>>24&255,h>>16&255,h>>8&255,h&255,m>>24&255,m>>16&255,m>>8&255,m&255,q,p,0,0,0]);q=c.length;m=new Uint8Array(2+q+5*Math.ceil(q/65535)+4);g=0;m[g++]=120;m[g++]=156;
for(p=0;65535<q;)m[g++]=0,m[g++]=255,m[g++]=255,m[g++]=0,m[g++]=0,m.set(c.subarray(p,p+65535),g),g+=65535,p+=65535,q-=65535;m[g++]=1;m[g++]=q&255;m[g++]=q>>8&255;m[g++]=~q&255;m[g++]=(~q&65535)>>8&255;m.set(c.subarray(p),g);g+=c.length-p;q=1;for(r=p=0;r<c.length;++r)q=(q+(c[r]&255))%65521,p=(p+q)%65521;c=p<<16|q;m[g++]=c>>24&255;m[g++]=c>>16&255;m[g++]=c>>8&255;m[g++]=c&255;c=new Uint8Array(b.length+36+h.length+m.length);g=0;c.set(b,g);g+=b.length;a("IHDR",h,c,g);g+=12+h.length;a("IDATA",m,c,g);g+=
12+m.length;a("IEND",new Uint8Array(0),c,g);return v(c,"image/png",d)}}(),w=function(){function a(){this.fontSizeScale=1;this.fontWeight="normal";this.fontSize=0;this.textMatrix=d;this.fontMatrix=c;this.wordSpacing=this.charSpacing=this.lineY=this.lineX=this.y=this.x=this.leading=0;this.textHScale=1;this.textRise=0;this.strokeColor=this.fillColor="#000000";this.lineWidth=this.strokeAlpha=this.fillAlpha=1;this.lineCap=this.lineJoin="";this.miterLimit=0;this.dashArray=[];this.dashPhase=0;this.dependencies=
[];this.clipId="";this.pendingClip=!1;this.maskId=""}a.prototype={clone:function(){return Object.create(this)},setCurrentPoint:function(a,b){this.x=a;this.y=b}};return a}();b=function(){function a(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg","svg:svg");c.setAttributeNS(null,"version","1.1");c.setAttributeNS(null,"width",a+"px");c.setAttributeNS(null,"height",b+"px");c.setAttributeNS(null,"viewBox","0 0 "+a+" "+b);return c}function b(a){if(a===(a|0))return a.toString();a=a.toFixed(10);
var b=a.length-1;if("0"!==a[b])return a;do b--;while("0"===a[b]);return a.substr(0,"."===a[b]?b:b+1)}function f(a){if(0===a[4]&&0===a[5]){if(0===a[1]&&0===a[2])return 1===a[0]&&1===a[3]?"":"scale("+b(a[0])+" "+b(a[3])+")";if(a[0]===a[3]&&a[1]===-a[2])return"rotate("+b(180*Math.acos(a[0])/Math.PI)+")"}else if(1===a[0]&&0===a[1]&&0===a[2]&&1===a[3])return"translate("+b(a[4])+" "+b(a[5])+")";return"matrix("+b(a[0])+" "+b(a[1])+" "+b(a[2])+" "+b(a[3])+" "+b(a[4])+" "+b(a[5])+")"}function g(a,b,c){this.current=
new w;this.transformMatrix=d;this.transformStack=[];this.extraStack=[];this.commonObjs=a;this.objs=b;this.embedFonts=this.pendingEOFill=!1;this.embeddedFonts=Object.create(null);this.cssStyle=null;this.forceDataSchema=!!c}var h=["butt","round","square"],m=["miter","round","bevel"],D=0,I=0;g.prototype={save:function(){this.transformStack.push(this.transformMatrix);var a=this.current;this.extraStack.push(a);this.current=a.clone()},restore:function(){this.transformMatrix=this.transformStack.pop();this.current=
this.extraStack.pop();this.tgrp=document.createElementNS("http://www.w3.org/2000/svg","svg:g");this.tgrp.setAttributeNS(null,"transform",f(this.transformMatrix));this.pgrp.appendChild(this.tgrp)},group:function(a){this.save();this.executeOpTree(a);this.restore()},loadDependencies:function(a){var b=a.fnArray,c=b.length;a=a.argsArray;for(var d=this,f=0;f<c;f++)if(n.dependency===b[f])for(var g=a[f],h=0,m=g.length;h<m;h++){var p=g[h];var q="g_"===p.substring(0,2)?new Promise(function(a){d.commonObjs.get(p,
a)}):new Promise(function(a){d.objs.get(p,a)});this.current.dependencies.push(q)}return Promise.all(this.current.dependencies)},transform:function(a,b,c,d,g,h){this.transformMatrix=r.transform(this.transformMatrix,[a,b,c,d,g,h]);this.tgrp=document.createElementNS("http://www.w3.org/2000/svg","svg:g");this.tgrp.setAttributeNS(null,"transform",f(this.transformMatrix))},getSVG:function(b,c){this.svg=a(c.width,c.height);this.viewport=c;return this.loadDependencies(b).then(function(){this.transformMatrix=
d;this.pgrp=document.createElementNS("http://www.w3.org/2000/svg","svg:g");this.pgrp.setAttributeNS(null,"transform",f(c.transform));this.tgrp=document.createElementNS("http://www.w3.org/2000/svg","svg:g");this.tgrp.setAttributeNS(null,"transform",f(this.transformMatrix));this.defs=document.createElementNS("http://www.w3.org/2000/svg","svg:defs");this.pgrp.appendChild(this.defs);this.pgrp.appendChild(this.tgrp);this.svg.appendChild(this.pgrp);var a=this.convertOpList(b);this.executeOpTree(a);return this.svg}.bind(this))},
convertOpList:function(a){var b=a.argsArray,c=a.fnArray,d=c.length,f=[];a=[];for(var g in n)f[n[g]]=g;for(g=0;g<d;g++){var h=c[g];a.push({fnId:h,fn:f[h],args:b[g]})}b=[];c=[];d=a.length;for(f=0;f<d;f++)"save"===a[f].fn?(b.push({fnId:92,fn:"group",items:[]}),c.push(b),b=b[b.length-1].items):"restore"===a[f].fn?b=c.pop():b.push(a[f]);return b},executeOpTree:function(a){for(var b=a.length,c=0;c<b;c++){var d=a[c].fn,f=a[c].args;switch(a[c].fnId|0){case n.beginText:this.beginText();break;case n.setLeading:this.setLeading(f);
break;case n.setLeadingMoveText:this.setLeadingMoveText(f[0],f[1]);break;case n.setFont:this.setFont(f);break;case n.showText:this.showText(f[0]);break;case n.showSpacedText:this.showText(f[0]);break;case n.endText:this.endText();break;case n.moveText:this.moveText(f[0],f[1]);break;case n.setCharSpacing:this.setCharSpacing(f[0]);break;case n.setWordSpacing:this.setWordSpacing(f[0]);break;case n.setHScale:this.setHScale(f[0]);break;case n.setTextMatrix:this.setTextMatrix(f[0],f[1],f[2],f[3],f[4],f[5]);
break;case n.setLineWidth:this.setLineWidth(f[0]);break;case n.setLineJoin:this.setLineJoin(f[0]);break;case n.setLineCap:this.setLineCap(f[0]);break;case n.setMiterLimit:this.setMiterLimit(f[0]);break;case n.setFillRGBColor:this.setFillRGBColor(f[0],f[1],f[2]);break;case n.setStrokeRGBColor:this.setStrokeRGBColor(f[0],f[1],f[2]);break;case n.setDash:this.setDash(f[0],f[1]);break;case n.setGState:this.setGState(f[0]);break;case n.fill:this.fill();break;case n.eoFill:this.eoFill();break;case n.stroke:this.stroke();
break;case n.fillStroke:this.fillStroke();break;case n.eoFillStroke:this.eoFillStroke();break;case n.clip:this.clip("nonzero");break;case n.eoClip:this.clip("evenodd");break;case n.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case n.paintJpegXObject:this.paintJpegXObject(f[0],f[1],f[2]);break;case n.paintImageXObject:this.paintImageXObject(f[0]);break;case n.paintInlineImageXObject:this.paintInlineImageXObject(f[0]);break;case n.paintImageMaskXObject:this.paintImageMaskXObject(f[0]);
break;case n.paintFormXObjectBegin:this.paintFormXObjectBegin(f[0],f[1]);break;case n.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case n.closePath:this.closePath();break;case n.closeStroke:this.closeStroke();break;case n.closeFillStroke:this.closeFillStroke();break;case n.nextLine:this.nextLine();break;case n.transform:this.transform(f[0],f[1],f[2],f[3],f[4],f[5]);break;case n.constructPath:this.constructPath(f[0],f[1]);break;case n.endPath:this.endPath();break;case 92:this.group(a[c].items);
break;default:t("Unimplemented method "+d)}}},setWordSpacing:function(a){this.current.wordSpacing=a},setCharSpacing:function(a){this.current.charSpacing=a},nextLine:function(){this.moveText(0,this.current.leading)},setTextMatrix:function(a,c,d,f,g,h){var m=this.current;this.current.textMatrix=this.current.lineMatrix=[a,c,d,f,g,h];this.current.x=this.current.lineX=0;this.current.y=this.current.lineY=0;m.xcoords=[];m.tspan=document.createElementNS("http://www.w3.org/2000/svg","svg:tspan");m.tspan.setAttributeNS(null,
"font-family",m.fontFamily);m.tspan.setAttributeNS(null,"font-size",b(m.fontSize)+"px");m.tspan.setAttributeNS(null,"y",b(-m.y));m.txtElement=document.createElementNS("http://www.w3.org/2000/svg","svg:text");m.txtElement.appendChild(m.tspan)},beginText:function(){this.current.x=this.current.lineX=0;this.current.y=this.current.lineY=0;this.current.textMatrix=d;this.current.lineMatrix=d;this.current.tspan=document.createElementNS("http://www.w3.org/2000/svg","svg:tspan");this.current.txtElement=document.createElementNS("http://www.w3.org/2000/svg",
"svg:text");this.current.txtgrp=document.createElementNS("http://www.w3.org/2000/svg","svg:g");this.current.xcoords=[]},moveText:function(a,c){var d=this.current;this.current.x=this.current.lineX+=a;this.current.y=this.current.lineY+=c;d.xcoords=[];d.tspan=document.createElementNS("http://www.w3.org/2000/svg","svg:tspan");d.tspan.setAttributeNS(null,"font-family",d.fontFamily);d.tspan.setAttributeNS(null,"font-size",b(d.fontSize)+"px");d.tspan.setAttributeNS(null,"y",b(-d.y))},showText:function(a){var c=
this.current,d=c.fontSize;if(0!==d){var g=c.charSpacing,h=c.wordSpacing,m=c.fontDirection,n=c.textHScale*m,p=a.length,q=c.font.vertical,r=d*c.fontMatrix[0],t=0,v;for(v=0;v<p;++v){var w=a[v];if(null===w)t+=m*h;else if(A(w))t+=-w*d*.001;else{c.xcoords.push(c.x+t*n);var z=w.fontChar;t+=w.width*r+g*m;c.tspan.textContent+=z}}q?c.y-=t*n:c.x+=t*n;c.tspan.setAttributeNS(null,"x",c.xcoords.map(b).join(" "));c.tspan.setAttributeNS(null,"y",b(-c.y));c.tspan.setAttributeNS(null,"font-family",c.fontFamily);c.tspan.setAttributeNS(null,
"font-size",b(c.fontSize)+"px");"normal"!==c.fontStyle&&c.tspan.setAttributeNS(null,"font-style",c.fontStyle);"normal"!==c.fontWeight&&c.tspan.setAttributeNS(null,"font-weight",c.fontWeight);"#000000"!==c.fillColor&&c.tspan.setAttributeNS(null,"fill",c.fillColor);c.txtElement.setAttributeNS(null,"transform",f(c.textMatrix)+" scale(1, -1)");c.txtElement.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve");c.txtElement.appendChild(c.tspan);c.txtgrp.appendChild(c.txtElement);
this.tgrp.appendChild(c.txtElement)}},setLeadingMoveText:function(a,b){this.setLeading(-b);this.moveText(a,b)},addFontStyle:function(a){this.cssStyle||(this.cssStyle=document.createElementNS("http://www.w3.org/2000/svg","svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.appendChild(this.cssStyle));var b=v(a.data,a.mimetype,this.forceDataSchema);this.cssStyle.textContent+='@font-face { font-family: "'+a.loadedName+'"; src: url('+b+"); }\n"},setFont:function(a){var d=this.current,
f=this.commonObjs.get(a[0]);a=a[1];this.current.font=f;this.embedFonts&&f.data&&!this.embeddedFonts[f.loadedName]&&(this.addFontStyle(f),this.embeddedFonts[f.loadedName]=f);d.fontMatrix=f.fontMatrix?f.fontMatrix:c;var g=f.black?f.bold?"bolder":"bold":f.bold?"bold":"normal",h=f.italic?"italic":"normal";0>a?(a=-a,d.fontDirection=-1):d.fontDirection=1;d.fontSize=a;d.fontFamily=f.loadedName;d.fontWeight=g;d.fontStyle=h;d.tspan=document.createElementNS("http://www.w3.org/2000/svg","svg:tspan");d.tspan.setAttributeNS(null,
"y",b(-d.y));d.xcoords=[]},endText:function(){this.current.pendingClip?(this.cgrp.appendChild(this.tgrp),this.pgrp.appendChild(this.cgrp)):this.pgrp.appendChild(this.tgrp);this.tgrp=document.createElementNS("http://www.w3.org/2000/svg","svg:g");this.tgrp.setAttributeNS(null,"transform",f(this.transformMatrix))},setLineWidth:function(a){this.current.lineWidth=a},setLineCap:function(a){this.current.lineCap=h[a]},setLineJoin:function(a){this.current.lineJoin=m[a]},setMiterLimit:function(a){this.current.miterLimit=
a},setStrokeRGBColor:function(a,b,c){a=r.makeCssRgb(a,b,c);this.current.strokeColor=a},setFillRGBColor:function(a,b,c){a=r.makeCssRgb(a,b,c);this.current.fillColor=a;this.current.tspan=document.createElementNS("http://www.w3.org/2000/svg","svg:tspan");this.current.xcoords=[]},setDash:function(a,b){this.current.dashArray=a;this.current.dashPhase=b},constructPath:function(a,c){var d=this.current,f=d.x,g=d.y;d.path=document.createElementNS("http://www.w3.org/2000/svg","svg:path");for(var h=[],m=a.length,
p=0,q=0;p<m;p++)switch(a[p]|0){case n.rectangle:f=c[q++];g=c[q++];var r=c[q++],t=c[q++];r=f+r;t=g+t;h.push("M",b(f),b(g),"L",b(r),b(g),"L",b(r),b(t),"L",b(f),b(t),"Z");break;case n.moveTo:f=c[q++];g=c[q++];h.push("M",b(f),b(g));break;case n.lineTo:f=c[q++];g=c[q++];h.push("L",b(f),b(g));break;case n.curveTo:f=c[q+4];g=c[q+5];h.push("C",b(c[q]),b(c[q+1]),b(c[q+2]),b(c[q+3]),b(f),b(g));q+=6;break;case n.curveTo2:f=c[q+2];g=c[q+3];h.push("C",b(f),b(g),b(c[q]),b(c[q+1]),b(c[q+2]),b(c[q+3]));q+=4;break;
case n.curveTo3:f=c[q+2];g=c[q+3];h.push("C",b(c[q]),b(c[q+1]),b(f),b(g),b(f),b(g));q+=4;break;case n.closePath:h.push("Z")}d.path.setAttributeNS(null,"d",h.join(" "));d.path.setAttributeNS(null,"stroke-miterlimit",b(d.miterLimit));d.path.setAttributeNS(null,"stroke-linecap",d.lineCap);d.path.setAttributeNS(null,"stroke-linejoin",d.lineJoin);d.path.setAttributeNS(null,"stroke-width",b(d.lineWidth)+"px");d.path.setAttributeNS(null,"stroke-dasharray",d.dashArray.map(b).join(" "));d.path.setAttributeNS(null,
"stroke-dashoffset",b(d.dashPhase)+"px");d.path.setAttributeNS(null,"fill","none");this.tgrp.appendChild(d.path);d.pendingClip?(this.cgrp.appendChild(this.tgrp),this.pgrp.appendChild(this.cgrp)):this.pgrp.appendChild(this.tgrp);d.element=d.path;d.setCurrentPoint(f,g)},endPath:function(){this.current.pendingClip?(this.cgrp.appendChild(this.tgrp),this.pgrp.appendChild(this.cgrp)):this.pgrp.appendChild(this.tgrp);this.tgrp=document.createElementNS("http://www.w3.org/2000/svg","svg:g");this.tgrp.setAttributeNS(null,
"transform",f(this.transformMatrix))},clip:function(a){var b=this.current;b.clipId="clippath"+D;D++;this.clippath=document.createElementNS("http://www.w3.org/2000/svg","svg:clipPath");this.clippath.setAttributeNS(null,"id",b.clipId);var c=b.element.cloneNode();"evenodd"===a?c.setAttributeNS(null,"clip-rule","evenodd"):c.setAttributeNS(null,"clip-rule","nonzero");this.clippath.setAttributeNS(null,"transform",f(this.transformMatrix));this.clippath.appendChild(c);this.defs.appendChild(this.clippath);
b.pendingClip=!0;this.cgrp=document.createElementNS("http://www.w3.org/2000/svg","svg:g");this.cgrp.setAttributeNS(null,"clip-path","url(#"+b.clipId+")");this.pgrp.appendChild(this.cgrp)},closePath:function(){var a=this.current,b=a.path.getAttributeNS(null,"d");a.path.setAttributeNS(null,"d",b+"Z")},setLeading:function(a){this.current.leading=-a},setTextRise:function(a){this.current.textRise=a},setHScale:function(a){this.current.textHScale=a/100},setGState:function(a){for(var b=0,c=a.length;b<c;b++){var d=
a[b],f=d[1];switch(d[0]){case "LW":this.setLineWidth(f);break;case "LC":this.setLineCap(f);break;case "LJ":this.setLineJoin(f);break;case "ML":this.setMiterLimit(f);break;case "D":this.setDash(f[0],f[1]);break;case "Font":this.setFont(f)}}},fill:function(){var a=this.current;a.element.setAttributeNS(null,"fill",a.fillColor)},stroke:function(){var a=this.current;a.element.setAttributeNS(null,"stroke",a.strokeColor);a.element.setAttributeNS(null,"fill","none")},eoFill:function(){var a=this.current;
a.element.setAttributeNS(null,"fill",a.fillColor);a.element.setAttributeNS(null,"fill-rule","evenodd")},fillStroke:function(){this.stroke();this.fill()},eoFillStroke:function(){this.current.element.setAttributeNS(null,"fill-rule","evenodd");this.fillStroke()},closeStroke:function(){this.closePath();this.stroke()},closeFillStroke:function(){this.closePath();this.fillStroke()},paintSolidColorImageMask:function(){var a=this.current,b=document.createElementNS("http://www.w3.org/2000/svg","svg:rect");
b.setAttributeNS(null,"x","0");b.setAttributeNS(null,"y","0");b.setAttributeNS(null,"width","1px");b.setAttributeNS(null,"height","1px");b.setAttributeNS(null,"fill",a.fillColor);this.tgrp.appendChild(b)},paintJpegXObject:function(a,c,d){var f=this.current;a=this.objs.get(a);var g=document.createElementNS("http://www.w3.org/2000/svg","svg:image");g.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a.src);g.setAttributeNS(null,"width",a.width+"px");g.setAttributeNS(null,"height",a.height+
"px");g.setAttributeNS(null,"x","0");g.setAttributeNS(null,"y",b(-d));g.setAttributeNS(null,"transform","scale("+b(1/c)+" "+b(-1/d)+")");this.tgrp.appendChild(g);f.pendingClip?(this.cgrp.appendChild(this.tgrp),this.pgrp.appendChild(this.cgrp)):this.pgrp.appendChild(this.tgrp)},paintImageXObject:function(a){(a=this.objs.get(a))?this.paintInlineImageXObject(a):t("Dependent image isn't ready yet")},paintInlineImageXObject:function(a,c){var d=this.current,f=a.width,g=a.height;a=q(a,this.forceDataSchema);
var h=document.createElementNS("http://www.w3.org/2000/svg","svg:rect");h.setAttributeNS(null,"x","0");h.setAttributeNS(null,"y","0");h.setAttributeNS(null,"width",b(f));h.setAttributeNS(null,"height",b(g));d.element=h;this.clip("nonzero");h=document.createElementNS("http://www.w3.org/2000/svg","svg:image");h.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);h.setAttributeNS(null,"x","0");h.setAttributeNS(null,"y",b(-g));h.setAttributeNS(null,"width",b(f)+"px");h.setAttributeNS(null,"height",
b(g)+"px");h.setAttributeNS(null,"transform","scale("+b(1/f)+" "+b(-1/g)+")");c?c.appendChild(h):this.tgrp.appendChild(h);d.pendingClip?(this.cgrp.appendChild(this.tgrp),this.pgrp.appendChild(this.cgrp)):this.pgrp.appendChild(this.tgrp)},paintImageMaskXObject:function(a){var c=this.current,d=a.width,f=a.height,g=c.fillColor;c.maskId="mask"+I++;var h=document.createElementNS("http://www.w3.org/2000/svg","svg:mask");h.setAttributeNS(null,"id",c.maskId);var m=document.createElementNS("http://www.w3.org/2000/svg",
"svg:rect");m.setAttributeNS(null,"x","0");m.setAttributeNS(null,"y","0");m.setAttributeNS(null,"width",b(d));m.setAttributeNS(null,"height",b(f));m.setAttributeNS(null,"fill",g);m.setAttributeNS(null,"mask","url(#"+c.maskId+")");this.defs.appendChild(h);this.tgrp.appendChild(m);this.paintInlineImageXObject(a,h)},paintFormXObjectBegin:function(a,c){this.save();z(a)&&6===a.length&&this.transform(a[0],a[1],a[2],a[3],a[4],a[5]);if(z(c)&&4===c.length){a=c[2]-c[0];var d=c[3]-c[1],f=document.createElementNS("http://www.w3.org/2000/svg",
"svg:rect");f.setAttributeNS(null,"x",c[0]);f.setAttributeNS(null,"y",c[1]);f.setAttributeNS(null,"width",b(a));f.setAttributeNS(null,"height",b(d));this.current.element=f;this.clip("nonzero");this.endPath()}},paintFormXObjectEnd:function(){this.restore()}};return g}();a.SVGGraphics=b});(function(a,b){b(a.pdfjsDisplayAnnotationLayer={},a.pdfjsSharedUtil,a.pdfjsDisplayDOMUtils)})(this,function(a,b,c){function d(){}var f=b.AnnotationBorderStyleType,g=b.AnnotationType,r=b.Util,A=c.addLinkAttributes,
z=c.LinkTarget,t=c.getFilenameFromUrl,v=b.warn,q=c.CustomStyle,w=c.getDefaultSetting;d.prototype={create:function(a){switch(a.data.annotationType){case g.LINK:return new B(a);case g.TEXT:return new G(a);case g.WIDGET:return new H(a);case g.POPUP:return new M(a);case g.HIGHLIGHT:return new D(a);case g.UNDERLINE:return new I(a);case g.SQUIGGLY:return new P(a);case g.STRIKEOUT:return new K(a);case g.FILEATTACHMENT:return new R(a);default:return new p(a)}}};var p=function(){function a(a,b){this.isRenderable=
b||!1;this.data=a.data;this.layer=a.layer;this.page=a.page;this.viewport=a.viewport;this.linkService=a.linkService;this.downloadManager=a.downloadManager;this.imageResourcesPath=a.imageResourcesPath;b&&(this.container=this._createContainer())}a.prototype={_createContainer:function(){var a=this.data,b=this.page,c=this.viewport,d=document.createElement("section"),g=a.rect[2]-a.rect[0],h=a.rect[3]-a.rect[1];d.setAttribute("data-annotation-id",a.id);b=r.normalizeRect([a.rect[0],b.view[3]-a.rect[1]+b.view[1],
a.rect[2],b.view[3]-a.rect[3]+b.view[1]]);q.setProp("transform",d,"matrix("+c.transform.join(",")+")");q.setProp("transformOrigin",d,-b[0]+"px "+-b[1]+"px");if(0<a.borderStyle.width){d.style.borderWidth=a.borderStyle.width+"px";a.borderStyle.style!==f.UNDERLINE&&(g-=2*a.borderStyle.width,h-=2*a.borderStyle.width);c=a.borderStyle.horizontalCornerRadius;var m=a.borderStyle.verticalCornerRadius;(0<c||0<m)&&q.setProp("borderRadius",d,c+"px / "+m+"px");switch(a.borderStyle.style){case f.SOLID:d.style.borderStyle=
"solid";break;case f.DASHED:d.style.borderStyle="dashed";break;case f.BEVELED:v("Unimplemented border style: beveled");break;case f.INSET:v("Unimplemented border style: inset");break;case f.UNDERLINE:d.style.borderBottomStyle="solid"}a.color?d.style.borderColor=r.makeCssRgb(a.color[0]|0,a.color[1]|0,a.color[2]|0):d.style.borderWidth=0}d.style.left=b[0]+"px";d.style.top=b[1]+"px";d.style.width=g+"px";d.style.height=h+"px";return d},_createPopup:function(a,b,c){b||(b=document.createElement("div"),b.style.height=
a.style.height,b.style.width=a.style.width,a.appendChild(b));b=(new J({container:a,trigger:b,color:c.color,title:c.title,contents:c.contents,hideWrapper:!0})).render();b.style.left=a.style.width;a.appendChild(b)},render:function(){throw Error("Abstract method AnnotationElement.render called");}};return a}(),B=function(){function a(a){p.call(this,a,!0)}r.inherit(a,p,{render:function(){this.container.className="linkAnnotation";var a=document.createElement("a");A(a,{url:this.data.url,target:this.data.newWindow?
z.BLANK:void 0});this.data.url||(this.data.action?this._bindNamedAction(a,this.data.action):this._bindLink(a,this.data.dest||null));this.container.appendChild(a);return this.container},_bindLink:function(a,b){var c=this;a.href=this.linkService.getDestinationHash(b);a.onclick=function(){b&&c.linkService.navigateTo(b);return!1};b&&(a.className="internalLink")},_bindNamedAction:function(a,b){var c=this;a.href=this.linkService.getAnchorUrl("");a.onclick=function(){c.linkService.executeNamedAction(b);
return!1};a.className="internalLink"}});return a}(),G=function(){function a(a){p.call(this,a,!!(a.data.hasPopup||a.data.title||a.data.contents))}r.inherit(a,p,{render:function(){this.container.className="textAnnotation";var a=document.createElement("img");a.style.height=this.container.style.height;a.style.width=this.container.style.width;a.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg";a.alt="[{{type}} Annotation]";a.dataset.l10nId="text_annotation_type";a.dataset.l10nArgs=
JSON.stringify({type:this.data.name});this.data.hasPopup||this._createPopup(this.container,a,this.data);this.container.appendChild(a);return this.container}});return a}(),H=function(){function a(a){p.call(this,a,!a.data.hasAppearance&&!!a.data.fieldValue)}r.inherit(a,p,{render:function(){var a=document.createElement("div");a.textContent=this.data.fieldValue;a.style.textAlign=["left","center","right"][this.data.textAlignment];a.style.verticalAlign="middle";a.style.display="table-cell";var b=this.data.fontRefName?
this.page.commonObjs.getData(this.data.fontRefName):null;this._setTextStyle(a,b);this.container.appendChild(a);return this.container},_setTextStyle:function(a,b){a=a.style;a.fontSize=this.data.fontSize+"px";a.direction=0>this.data.fontDirection?"rtl":"ltr";b&&(a.fontWeight=b.black?b.bold?"900":"bold":b.bold?"bold":"normal",a.fontStyle=b.italic?"italic":"normal",a.fontFamily=(b.loadedName?'"'+b.loadedName+'", ':"")+(b.fallbackName||"Helvetica, sans-serif"))}});return a}(),M=function(){function a(a){p.call(this,
a,!(!a.data.title&&!a.data.contents))}r.inherit(a,p,{render:function(){this.container.className="popupAnnotation";var a=this.layer.querySelector('[data-annotation-id="'+this.data.parentId+'"]');if(!a)return this.container;var b=new J({container:this.container,trigger:a,color:this.data.color,title:this.data.title,contents:this.data.contents}),c=parseFloat(a.style.left),d=parseFloat(a.style.width);q.setProp("transformOrigin",this.container,-(c+d)+"px -"+a.style.top);this.container.style.left=c+d+"px";
this.container.appendChild(b.render());return this.container}});return a}(),J=function(){function a(a){this.container=a.container;this.trigger=a.trigger;this.color=a.color;this.title=a.title;this.contents=a.contents;this.hideWrapper=a.hideWrapper||!1;this.pinned=!1}a.prototype={render:function(){var a=document.createElement("div");a.className="popupWrapper";this.hideElement=this.hideWrapper?a:this.container;this.hideElement.setAttribute("hidden",!0);var b=document.createElement("div");b.className=
"popup";var c=this.color;c&&(b.style.backgroundColor=r.makeCssRgb(.7*(255-c[0])+c[0]|0,.7*(255-c[1])+c[1]|0,.7*(255-c[2])+c[2]|0));c=this._formatContents(this.contents);var d=document.createElement("h1");d.textContent=this.title;this.trigger.addEventListener("click",this._toggle.bind(this));this.trigger.addEventListener("mouseover",this._show.bind(this,!1));this.trigger.addEventListener("mouseout",this._hide.bind(this,!1));b.addEventListener("click",this._hide.bind(this,!0));b.appendChild(d);b.appendChild(c);
a.appendChild(b);return a},_formatContents:function(a){var b=document.createElement("p");a=a.split(/(?:\r\n?|\n)/);for(var c=0,d=a.length;c<d;++c)b.appendChild(document.createTextNode(a[c])),c<d-1&&b.appendChild(document.createElement("br"));return b},_toggle:function(){this.pinned?this._hide(!0):this._show(!0)},_show:function(a){a&&(this.pinned=!0);this.hideElement.hasAttribute("hidden")&&(this.hideElement.removeAttribute("hidden"),this.container.style.zIndex+=1)},_hide:function(a){a&&(this.pinned=
!1);this.hideElement.hasAttribute("hidden")||this.pinned||(this.hideElement.setAttribute("hidden",!0),--this.container.style.zIndex)}};return a}(),D=function(){function a(a){p.call(this,a,!!(a.data.hasPopup||a.data.title||a.data.contents))}r.inherit(a,p,{render:function(){this.container.className="highlightAnnotation";this.data.hasPopup||this._createPopup(this.container,null,this.data);return this.container}});return a}(),I=function(){function a(a){p.call(this,a,!!(a.data.hasPopup||a.data.title||
a.data.contents))}r.inherit(a,p,{render:function(){this.container.className="underlineAnnotation";this.data.hasPopup||this._createPopup(this.container,null,this.data);return this.container}});return a}(),P=function(){function a(a){p.call(this,a,!!(a.data.hasPopup||a.data.title||a.data.contents))}r.inherit(a,p,{render:function(){this.container.className="squigglyAnnotation";this.data.hasPopup||this._createPopup(this.container,null,this.data);return this.container}});return a}(),K=function(){function a(a){p.call(this,
a,!!(a.data.hasPopup||a.data.title||a.data.contents))}r.inherit(a,p,{render:function(){this.container.className="strikeoutAnnotation";this.data.hasPopup||this._createPopup(this.container,null,this.data);return this.container}});return a}(),R=function(){function a(a){p.call(this,a,!0);this.filename=t(a.data.file.filename);this.content=a.data.file.content}r.inherit(a,p,{render:function(){this.container.className="fileAttachmentAnnotation";var a=document.createElement("div");a.style.height=this.container.style.height;
a.style.width=this.container.style.width;a.addEventListener("dblclick",this._download.bind(this));this.data.hasPopup||!this.data.title&&!this.data.contents||this._createPopup(this.container,a,this.data);this.container.appendChild(a);return this.container},_download:function(){this.downloadManager?this.downloadManager.downloadData(this.content,this.filename,""):v("Download cannot be started due to unavailable download manager")}});return a}();b=function(){return{render:function(a){for(var b=new d,
c=0,f=a.annotations.length;c<f;c++){var g=a.annotations[c];g&&(g={data:g,layer:a.div,page:a.page,viewport:a.viewport,linkService:a.linkService,downloadManager:a.downloadManager,imageResourcesPath:a.imageResourcesPath||w("imageResourcesPath")},g=b.create(g),g.isRenderable&&a.div.appendChild(g.render()))}},update:function(a){for(var b=0,c=a.annotations.length;b<c;b++){var d=a.div.querySelector('[data-annotation-id="'+a.annotations[b].id+'"]');d&&q.setProp("transform",d,"matrix("+a.viewport.transform.join(",")+
")")}a.div.removeAttribute("hidden")}}}();a.AnnotationLayer=b});(function(a,b){b(a.pdfjsDisplayTextLayer={},a.pdfjsSharedUtil,a.pdfjsDisplayDOMUtils)})(this,function(a,b,c){var d=b.Util,f=b.createPromiseCapability,g=c.CustomStyle,r=c.getDefaultSetting;b=function(){function a(a,b,c,f){f=f[c.fontName];var g=document.createElement("div");a.push(g);if(h.test(c.str)){var m=d.transform(b.transform,c.transform);a=Math.atan2(m[1],m[0]);f.vertical&&(a+=Math.PI/2);var n=Math.sqrt(m[2]*m[2]+m[3]*m[3]),p=n;f.ascent?
p*=f.ascent:f.descent&&(p*=1+f.descent);if(0===a){var q=m[4];m=m[5]-p}else q=m[4]+p*Math.sin(a),m=m[5]-p*Math.cos(a);g.style.left=q+"px";g.style.top=m+"px";g.style.fontSize=n+"px";g.style.fontFamily=f.fontFamily;g.textContent=c.str;r("pdfBug")&&(g.dataset.fontName=c.fontName);0!==a&&(g.dataset.angle=180/Math.PI*a);1<c.str.length&&(g.dataset.canvasWidth=f.vertical?c.height*b.scale:c.width*b.scale)}else g.dataset.isWhitespace=!0}function b(a){if(!a._canceled){var b=a._container,c=a._textDivs;a=a._capability;
var d=c.length;if(!(1E5<d)){var f=document.createElement("canvas");f.mozOpaque=!0;f=f.getContext("2d",{alpha:!1});for(var h,m,n=0;n<d;n++){var q=c[n];if(void 0===q.dataset.isWhitespace){var r=q.style.fontSize,t=q.style.fontFamily;if(r!==h||t!==m)f.font=r+" "+t,h=r,m=t;r=f.measureText(q.textContent).width;0<r&&(b.appendChild(q),r=void 0!==q.dataset.canvasWidth?"scaleX("+q.dataset.canvasWidth/r+")":"",(t=q.dataset.angle)&&(r="rotate("+t+"deg) "+r),r&&g.setProp("transform",q,r))}}}a.resolve()}}function c(a,
b,c,d){this._textContent=a;this._container=b;this._viewport=c;this._textDivs=d=d||[];this._canceled=!1;this._capability=f();this._renderTimer=null}var h=/\S/;c.prototype={get promise(){return this._capability.promise},cancel:function(){this._canceled=!0;null!==this._renderTimer&&(clearTimeout(this._renderTimer),this._renderTimer=null);this._capability.reject("canceled")},_render:function(c){for(var d=this._textContent.items,f=this._textContent.styles,g=this._textDivs,h=this._viewport,m=0,n=d.length;m<
n;m++)a(g,h,d[m],f);if(c){var q=this;this._renderTimer=setTimeout(function(){b(q);q._renderTimer=null},c)}else b(this)}};return function(a){var b=new c(a.textContent,a.container,a.viewport,a.textDivs);b._render(a.timeout);return b}}();a.renderTextLayer=b});(function(a,b){b(a.pdfjsDisplayWebGL={},a.pdfjsSharedUtil,a.pdfjsDisplayDOMUtils)})(this,function(a,b,c){var d=b.shadow,f=c.getDefaultSetting;b=function(){function a(a,b,c){c=a.createShader(c);a.shaderSource(c,b);a.compileShader(c);if(!a.getShaderParameter(c,
a.COMPILE_STATUS))throw a=a.getShaderInfoLog(c),Error("Error during shader compilation: "+a);return c}function b(a,b){for(var c=a.createProgram(),d=0,f=b.length;d<f;++d)a.attachShader(c,b[d]);a.linkProgram(c);if(!a.getProgramParameter(c,a.LINK_STATUS))throw a=a.getProgramInfoLog(c),Error("Error during program linking: "+a);return c}function c(a,b,c){a.activeTexture(c);c=a.createTexture();a.bindTexture(a.TEXTURE_2D,c);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,b);return c}function g(){h||(m=document.createElement("canvas"),h=m.getContext("webgl",{premultipliedalpha:!1}))}var h,m,q=null,w=null;return{get isEnabled(){if(f("disableWebGL"))return!1;var a=!1;try{g(),a=!!h}catch(B){}return d(this,"isEnabled",a)},composeSMask:function(d,f,n){var p=d.width,
r=d.height;if(!q){g();var t=m;m=null;var v=h;h=null;var w=a(v,"  attribute vec2 a_position;                                      attribute vec2 a_texCoord;                                                                                                      uniform vec2 u_resolution;                                                                                                      varying vec2 v_texCoord;                                                                                                        void main() {                                                     vec2 clipSpace = (a_position / u_resolution) * 2.0 - 1.0;       gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);                                                                              v_texCoord = a_texCoord;                                      }                                                             ",
v.VERTEX_SHADER),z=a(v,"  precision mediump float;                                                                                                        uniform vec4 u_backdrop;                                        uniform int u_subtype;                                          uniform sampler2D u_image;                                      uniform sampler2D u_mask;                                                                                                       varying vec2 v_texCoord;                                                                                                        void main() {                                                     vec4 imageColor = texture2D(u_image, v_texCoord);               vec4 maskColor = texture2D(u_mask, v_texCoord);                 if (u_backdrop.a > 0.0) {                                         maskColor.rgb = maskColor.rgb * maskColor.a +                                   u_backdrop.rgb * (1.0 - maskColor.a);         }                                                               float lum;                                                      if (u_subtype == 0) {                                             lum = maskColor.a;                                            } else {                                                          lum = maskColor.r * 0.3 + maskColor.g * 0.59 +                        maskColor.b * 0.11;                                     }                                                               imageColor.a *= lum;                                            imageColor.rgb *= imageColor.a;                                 gl_FragColor = imageColor;                                    }                                                             ",
v.FRAGMENT_SHADER),B=b(v,[w,z]);v.useProgram(B);w={};w.gl=v;w.canvas=t;w.resolutionLocation=v.getUniformLocation(B,"u_resolution");w.positionLocation=v.getAttribLocation(B,"a_position");w.backdropLocation=v.getUniformLocation(B,"u_backdrop");w.subtypeLocation=v.getUniformLocation(B,"u_subtype");t=v.getAttribLocation(B,"a_texCoord");z=v.getUniformLocation(B,"u_image");B=v.getUniformLocation(B,"u_mask");var A=v.createBuffer();v.bindBuffer(v.ARRAY_BUFFER,A);v.bufferData(v.ARRAY_BUFFER,new Float32Array([0,
0,1,0,0,1,0,1,1,0,1,1]),v.STATIC_DRAW);v.enableVertexAttribArray(t);v.vertexAttribPointer(t,2,v.FLOAT,!1,0,0);v.uniform1i(z,0);v.uniform1i(B,1);q=w}v=q;w=v.canvas;t=v.gl;w.width=p;w.height=r;t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight);t.uniform2f(v.resolutionLocation,p,r);n.backdrop?t.uniform4f(v.resolutionLocation,n.backdrop[0],n.backdrop[1],n.backdrop[2],1):t.uniform4f(v.resolutionLocation,0,0,0,0);t.uniform1i(v.subtypeLocation,"Luminosity"===n.subtype?1:0);d=c(t,d,t.TEXTURE0);f=
c(t,f,t.TEXTURE1);n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n);t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,p,0,0,r,0,r,p,0,p,r]),t.STATIC_DRAW);t.enableVertexAttribArray(v.positionLocation);t.vertexAttribPointer(v.positionLocation,2,t.FLOAT,!1,0,0);t.clearColor(0,0,0,0);t.enable(t.BLEND);t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA);t.clear(t.COLOR_BUFFER_BIT);t.drawArrays(t.TRIANGLES,0,6);t.flush();t.deleteTexture(d);t.deleteTexture(f);t.deleteBuffer(n);return w},drawFigures:function(c,d,f,
n,q){if(!w){g();var p=m;m=null;var r=h;h=null;var t=a(r,"  attribute vec2 a_position;                                      attribute vec3 a_color;                                                                                                         uniform vec2 u_resolution;                                      uniform vec2 u_scale;                                           uniform vec2 u_offset;                                                                                                          varying vec4 v_color;                                                                                                           void main() {                                                     vec2 position = (a_position + u_offset) * u_scale;              vec2 clipSpace = (position / u_resolution) * 2.0 - 1.0;         gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);                                                                              v_color = vec4(a_color / 255.0, 1.0);                         }                                                             ",
r.VERTEX_SHADER),v=a(r,"  precision mediump float;                                                                                                        varying vec4 v_color;                                                                                                           void main() {                                                     gl_FragColor = v_color;                                       }                                                             ",r.FRAGMENT_SHADER);t=b(r,[t,
v]);r.useProgram(t);v={};v.gl=r;v.canvas=p;v.resolutionLocation=r.getUniformLocation(t,"u_resolution");v.scaleLocation=r.getUniformLocation(t,"u_scale");v.offsetLocation=r.getUniformLocation(t,"u_offset");v.positionLocation=r.getAttribLocation(t,"a_position");v.colorLocation=r.getAttribLocation(t,"a_color");w=v}p=w;r=p.canvas;t=p.gl;r.width=c;r.height=d;t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight);t.uniform2f(p.resolutionLocation,c,d);c=0;var z;var A=0;for(z=n.length;A<z;A++)switch(n[A].type){case "lattice":var B=
n[A].coords.length/n[A].verticesPerRow|0;c+=(B-1)*(n[A].verticesPerRow-1)*6;break;case "triangles":c+=n[A].coords.length}v=new Float32Array(2*c);d=new Uint8Array(3*c);var C=q.coords,G=q.colors,H=0,M=0;A=0;for(z=n.length;A<z;A++){B=n[A];var da=B.coords,X=B.colors;switch(B.type){case "lattice":var aa=B.verticesPerRow;B=da.length/aa|0;for(var qa=1;qa<B;qa++)for(var V=qa*aa+1,ja=1;ja<aa;ja++,V++)v[H]=C[da[V-aa-1]],v[H+1]=C[da[V-aa-1]+1],v[H+2]=C[da[V-aa]],v[H+3]=C[da[V-aa]+1],v[H+4]=C[da[V-1]],v[H+5]=
C[da[V-1]+1],d[M]=G[X[V-aa-1]],d[M+1]=G[X[V-aa-1]+1],d[M+2]=G[X[V-aa-1]+2],d[M+3]=G[X[V-aa]],d[M+4]=G[X[V-aa]+1],d[M+5]=G[X[V-aa]+2],d[M+6]=G[X[V-1]],d[M+7]=G[X[V-1]+1],d[M+8]=G[X[V-1]+2],v[H+6]=v[H+2],v[H+7]=v[H+3],v[H+8]=v[H+4],v[H+9]=v[H+5],v[H+10]=C[da[V]],v[H+11]=C[da[V]+1],d[M+9]=d[M+3],d[M+10]=d[M+4],d[M+11]=d[M+5],d[M+12]=d[M+6],d[M+13]=d[M+7],d[M+14]=d[M+8],d[M+15]=G[X[V]],d[M+16]=G[X[V]+1],d[M+17]=G[X[V]+2],H+=12,M+=18;break;case "triangles":for(B=0,aa=da.length;B<aa;B++)v[H]=C[da[B]],v[H+
1]=C[da[B]+1],d[M]=G[X[B]],d[M+1]=G[X[B]+1],d[M+2]=G[X[B]+2],H+=2,M+=3}}f?t.clearColor(f[0]/255,f[1]/255,f[2]/255,1):t.clearColor(0,0,0,0);t.clear(t.COLOR_BUFFER_BIT);f=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,f);t.bufferData(t.ARRAY_BUFFER,v,t.STATIC_DRAW);t.enableVertexAttribArray(p.positionLocation);t.vertexAttribPointer(p.positionLocation,2,t.FLOAT,!1,0,0);n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n);t.bufferData(t.ARRAY_BUFFER,d,t.STATIC_DRAW);t.enableVertexAttribArray(p.colorLocation);
t.vertexAttribPointer(p.colorLocation,3,t.UNSIGNED_BYTE,!1,0,0);t.uniform2f(p.scaleLocation,q.scaleX,q.scaleY);t.uniform2f(p.offsetLocation,q.offsetX,q.offsetY);t.drawArrays(t.TRIANGLES,0,c);t.flush();t.deleteBuffer(f);t.deleteBuffer(n);return r},clear:function(){q&&q.canvas&&(q.canvas.width=0,q.canvas.height=0);w&&w.canvas&&(w.canvas.width=0,w.canvas.height=0);w=q=null}}}();a.WebGLUtils=b});(function(a,b){b(a.pdfjsDisplayPatternHelper={},a.pdfjsSharedUtil,a.pdfjsDisplayWebGL)})(this,function(a,b,
c){var d=b.Util,f=b.info,g=b.isArray,r=b.error,A=c.WebGLUtils,z={RadialAxial:{fromIR:function(a){var b=a[1],c=a[2],d=a[3],f=a[4],g=a[5],h=a[6];return{type:"Pattern",getPattern:function(a){var m;"axial"===b?m=a.createLinearGradient(d[0],d[1],f[0],f[1]):"radial"===b&&(m=a.createRadialGradient(d[0],d[1],g,f[0],f[1],h));a=0;for(var n=c.length;a<n;++a){var p=c[a];m.addColorStop(p[0],p[1])}return m}}}}},t=function(){function a(a,b,c,d,f,g,h,m){var n=b.coords,p=b.colors,q=a.data;a=4*a.width;if(n[c+1]>n[d+
1]){var r=c;c=d;d=r;r=g;g=h;h=r}n[d+1]>n[f+1]&&(r=d,d=f,f=r,r=h,h=m,m=r);n[c+1]>n[d+1]&&(r=c,c=d,d=r,r=g,g=h,h=r);r=(n[c]+b.offsetX)*b.scaleX;c=(n[c+1]+b.offsetY)*b.scaleY;var t=(n[d]+b.offsetX)*b.scaleX;d=(n[d+1]+b.offsetY)*b.scaleY;var v=(n[f]+b.offsetX)*b.scaleX;b=(n[f+1]+b.offsetY)*b.scaleY;if(!(c>=b)){f=p[g];n=p[g+1];g=p[g+2];var w=p[h],z=p[h+1];h=p[h+2];var A=p[m],B=p[m+1];m=p[m+2];p=Math.round(b);for(var G,J,H,M,V,ja,Ha,Ia,ia,ra=Math.round(c);ra<=p;ra++){ra<d?(ia=ra<c?0:c===d?1:(c-ra)/(c-d),
G=r-(r-t)*ia,J=f-(f-w)*ia,H=n-(n-z)*ia,M=g-(g-h)*ia):(ia=ra>b?1:d===b?0:(d-ra)/(d-b),G=t-(t-v)*ia,J=w-(w-A)*ia,H=z-(z-B)*ia,M=h-(h-m)*ia);ia=ra<c?0:ra>b?1:(c-ra)/(c-b);V=r-(r-v)*ia;ja=f-(f-A)*ia;Ha=n-(n-B)*ia;Ia=g-(g-m)*ia;ia=Math.round(Math.min(G,V));for(var Za=Math.round(Math.max(G,V)),xa=a*ra+4*ia,Sa=ia;Sa<=Za;Sa++)ia=(G-Sa)/(G-V),ia=0>ia?0:1<ia?1:ia,q[xa++]=J-(J-ja)*ia|0,q[xa++]=H-(H-Ha)*ia|0,q[xa++]=M-(M-Ia)*ia|0,q[xa++]=255}}}return function(b,c,d,f,g,h,m){var n=Math.floor(b[0]),p=Math.floor(b[1]),
q=Math.ceil(b[2])-n;b=Math.ceil(b[3])-p;var t=Math.min(Math.ceil(Math.abs(q*c[0]*1.1)),3E3);c=Math.min(Math.ceil(Math.abs(b*c[1]*1.1)),3E3);q/=t;b/=c;d={coords:d,colors:f,offsetX:-n,offsetY:-p,scaleX:1/q,scaleY:1/b};f=t+4;var v=c+4;if(A.isEnabled)g=A.drawFigures(t,c,h,g,d),m=m.getCanvas("mesh",f,v,!1),m.context.drawImage(g,2,2);else{m=m.getCanvas("mesh",f,v,!1);f=m.context;c=f.createImageData(t,c);if(h){var w=c.data;t=0;for(v=w.length;t<v;t+=4)w[t]=h[0],w[t+1]=h[1],w[t+2]=h[2],w[t+3]=255}for(t=0;t<
g.length;t++){h=c;var z=g[t];v=d;w=z.coords;var B=z.colors;switch(z.type){case "lattice":var G=z.verticesPerRow;var H=Math.floor(w.length/G)-1,M=G-1;for(z=0;z<H;z++)for(var da=z*G,X=0;X<M;X++,da++)a(h,v,w[da],w[da+1],w[da+G],B[da],B[da+1],B[da+G]),a(h,v,w[da+G+1],w[da+1],w[da+G],B[da+G+1],B[da+1],B[da+G]);break;case "triangles":z=0;for(G=w.length;z<G;z+=3)a(h,v,w[z],w[z+1],w[z+2],B[z],B[z+1],B[z+2]);break;default:r("illigal figure")}}f.putImageData(c,2,2)}g=m.canvas;return{canvas:g,offsetX:n-2*q,
offsetY:p-2*b,scaleX:q,scaleY:b}}}();z.Mesh={fromIR:function(a){var b=a[2],c=a[3],f=a[4],g=a[5],h=a[6],m=a[8];return{type:"Pattern",getPattern:function(a,n,p){if(p)var q=d.singularValueDecompose2dScale(a.mozCurrentTransform);else if(q=d.singularValueDecompose2dScale(n.baseTransform),h){var r=d.singularValueDecompose2dScale(h);q=[q[0]*r[0],q[1]*r[1]]}q=t(g,q,b,c,f,p?null:m,n.cachedCanvases);p||(a.setTransform.apply(a,n.baseTransform),h&&a.transform.apply(a,h));a.translate(q.offsetX,q.offsetY);a.scale(q.scaleX,
q.scaleY);return a.createPattern(q.canvas,"no-repeat")}}}};z.Dummy={fromIR:function(){return{type:"Pattern",getPattern:function(){return"hotpink"}}}};b=function(){function a(a,b,c,d,f){this.operatorList=a[2];this.matrix=a[3]||[1,0,0,1,0,0];this.bbox=a[4];this.xstep=a[5];this.ystep=a[6];this.paintType=a[7];this.tilingType=a[8];this.color=b;this.canvasGraphicsFactory=d;this.baseTransform=f;this.type="Pattern";this.ctx=c}a.prototype={createPatternCanvas:function(a){var b=this.operatorList,c=this.bbox,
g=this.xstep,h=this.ystep,m=this.paintType,n=this.color,q=this.canvasGraphicsFactory;f("TilingType: "+this.tilingType);var r=c[0],t=c[1],v=c[2],z=c[3],A=[r,t],Z=[r+g,t+h],C=Z[0]-A[0];Z=Z[1]-A[1];var fa=d.singularValueDecompose2dScale(this.matrix),oa=d.singularValueDecompose2dScale(this.baseTransform);fa=[fa[0]*oa[0],fa[1]*oa[1]];C=Math.min(Math.ceil(Math.abs(C*fa[0])),3E3);Z=Math.min(Math.ceil(Math.abs(Z*fa[1])),3E3);fa=a.cachedCanvases.getCanvas("pattern",C,Z,!0);oa=fa.context;q=q.createCanvasGraphics(oa);
q.groupLevel=a.groupLevel;this.setFillAndStrokeStyleToContext(oa,m,n);this.setScale(C,Z,g,h);this.transformToScale(q);q.transform.apply(q,[1,0,0,1,-A[0],-A[1]]);this.clipBbox(q,c,r,t,v,z);q.executeOperatorList(b);return fa.canvas},setScale:function(a,b,c,d){this.scale=[a/c,b/d]},transformToScale:function(a){var b=this.scale;a.transform.apply(a,[b[0],0,0,b[1],0,0])},scaleToContext:function(){var a=this.scale;this.ctx.scale(1/a[0],1/a[1])},clipBbox:function(a,b,c,d,f,h){b&&g(b)&&4===b.length&&(a.ctx.rect(c,
d,f-c,h-d),a.clip(),a.endPath())},setFillAndStrokeStyleToContext:function(a,b,c){switch(b){case 1:b=this.ctx;a.fillStyle=b.fillStyle;a.strokeStyle=b.strokeStyle;break;case 2:b=d.makeCssRgb(c[0],c[1],c[2]);a.fillStyle=b;a.strokeStyle=b;break;default:r("Unsupported paint type: "+b)}},getPattern:function(a,b){b=this.createPatternCanvas(b);a=this.ctx;a.setTransform.apply(a,this.baseTransform);a.transform.apply(a,this.matrix);this.scaleToContext();return a.createPattern(b,"repeat")}};return a}();a.getShadingPatternFromIR=
function(a){var b=z[a[0]];b||r("Unknown IR type: "+a[0]);return b.fromIR(a)};a.TilingPattern=b});(function(a,b){b(a.pdfjsDisplayCanvas={},a.pdfjsSharedUtil,a.pdfjsDisplayDOMUtils,a.pdfjsDisplayPatternHelper,a.pdfjsDisplayWebGL)})(this,function(a,b,c,d,m){function f(a,b){var c=document.createElement("canvas");c.width=a;c.height=b;return c}function g(a){a.mozCurrentTransform||(a._originalSave=a.save,a._originalRestore=a.restore,a._originalRotate=a.rotate,a._originalScale=a.scale,a._originalTranslate=
a.translate,a._originalTransform=a.transform,a._originalSetTransform=a.setTransform,a._transformMatrix=a._transformMatrix||[1,0,0,1,0,0],a._transformStack=[],Object.defineProperty(a,"mozCurrentTransform",{get:function(){return this._transformMatrix}}),Object.defineProperty(a,"mozCurrentTransformInverse",{get:function(){var a=this._transformMatrix,b=a[0],c=a[1],d=a[2],f=a[3],g=a[4];a=a[5];var h=b*f-c*d,m=c*d-b*f;return[f/h,c/m,d/m,b/h,(f*g-d*a)/m,(c*g-b*a)/h]}}),a.save=function(){var a=this._transformMatrix;
this._transformStack.push(a);this._transformMatrix=a.slice(0,6);this._originalSave()},a.restore=function(){var a=this._transformStack.pop();a&&(this._transformMatrix=a,this._originalRestore())},a.translate=function(a,b){var c=this._transformMatrix;c[4]=c[0]*a+c[2]*b+c[4];c[5]=c[1]*a+c[3]*b+c[5];this._originalTranslate(a,b)},a.scale=function(a,b){var c=this._transformMatrix;c[0]*=a;c[1]*=a;c[2]*=b;c[3]*=b;this._originalScale(a,b)},a.transform=function(b,c,d,f,g,h){var m=this._transformMatrix;this._transformMatrix=
[m[0]*b+m[2]*c,m[1]*b+m[3]*c,m[0]*d+m[2]*f,m[1]*d+m[3]*f,m[0]*g+m[2]*h+m[4],m[1]*g+m[3]*h+m[5]];a._originalTransform(b,c,d,f,g,h)},a.setTransform=function(b,c,d,f,g,h){this._transformMatrix=[b,c,d,f,g,h];a._originalSetTransform(b,c,d,f,g,h)},a.rotate=function(a){var b=Math.cos(a),c=Math.sin(a),d=this._transformMatrix;this._transformMatrix=[d[0]*b+d[2]*c,d[1]*b+d[3]*c,d[0]*-c+d[2]*b,d[1]*-c+d[3]*b,d[4],d[5]];this._originalRotate(a)})}function h(a){var b=a.width,c=a.height,d,f=b+1,g=new Uint8Array(f*
(c+1)),h=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),m=b+7&-8,n=a.data,p=new Uint8Array(m*c),q=0;a=0;for(d=n.length;a<d;a++){var r=128;for(var t=n[a];0<r;)p[q++]=t&r?0:255,r>>=1}q=n=0;0!==p[q]&&(g[0]=1,++n);for(d=1;d<b;d++)p[q]!==p[q+1]&&(g[d]=p[q]?2:1,++n),q++;0!==p[q]&&(g[d]=2,++n);for(a=1;a<c;a++){q=a*m;r=a*f;p[q-m]!==p[q]&&(g[r]=p[q]?1:8,++n);t=(p[q]?4:0)+(p[q-m]?8:0);for(d=1;d<b;d++)t=(t>>2)+(p[q+1]?4:0)+(p[q-m+1]?8:0),h[t]&&(g[r+d]=h[t],++n),q++;p[q-m]!==p[q]&&(g[r+d]=p[q]?2:4,++n);if(1E3<
n)return null}q=m*(c-1);r=a*f;0!==p[q]&&(g[r]=8,++n);for(d=1;d<b;d++)p[q]!==p[q+1]&&(g[r+d]=p[q]?4:8,++n),q++;0!==p[q]&&(g[r+d]=4,++n);if(1E3<n)return null;h=new Int32Array([0,f,-1,0,-f,0,0,0,1]);var v=[];for(a=0;n&&a<=c;a++){m=a*f;for(p=m+b;m<p&&!g[m];)m++;if(m!==p){p=[m%f,a];q=g[m];d=m;do{r=h[q];do m+=r;while(!g[m]);r=g[m];5!==r&&10!==r?(q=r,g[m]=0):(q=r&51*q>>4,g[m]&=q>>2|q<<2);p.push(m%f);p.push(m/f|0);--n}while(d!==m);v.push(p);--a}}return function(a){a.save();a.scale(1/b,-1/c);a.translate(0,
-c);a.beginPath();for(var d=0,f=v.length;d<f;d++){var g=v[d];a.moveTo(g[0],g[1]);for(var h=2,m=g.length;h<m;h+=2)a.lineTo(g[h],g[h+1])}a.fill();a.beginPath();a.restore()}}var z=b.FONT_IDENTITY_MATRIX,t=b.IDENTITY_MATRIX,v=b.ImageKind,q=b.OPS,w=b.TextRenderingMode,p=b.Uint32ArrayView,B=b.Util,G=b.assert,H=b.info,M=b.isNum,J=b.isArray,D=b.isLittleEndian,I=b.error,P=b.shadow,K=b.warn,R=d.TilingPattern,Z=d.getShadingPatternFromIR,C=m.WebGLUtils,fa=c.hasCanvasTypedArrays,oa={get value(){return P(oa,"value",
fa())}},ua={get value(){return P(ua,"value",D())}},da=function(){function a(){this.cache=Object.create(null)}a.prototype={getCanvas:function(a,b,c,d){void 0!==this.cache[a]?(a=this.cache[a],a.canvas.width=b,a.canvas.height=c,a.context.setTransform(1,0,0,1,0,0)):(b=f(b,c),c=b.getContext("2d"),d&&g(c),this.cache[a]=a={canvas:b,context:c});return a},clear:function(){for(var a in this.cache){var b=this.cache[a];b.canvas.width=0;b.canvas.height=0;delete this.cache[a]}}};return a}(),X=function(){function a(a){this.alphaIsShape=
!1;this.fontSize=0;this.fontSizeScale=1;this.textMatrix=t;this.textMatrixScale=1;this.fontMatrix=z;this.wordSpacing=this.charSpacing=this.lineY=this.lineX=this.y=this.x=this.leading=0;this.textHScale=1;this.textRenderingMode=w.FILL;this.textRise=0;this.strokeColor=this.fillColor="#000000";this.patternFill=!1;this.lineWidth=this.strokeAlpha=this.fillAlpha=1;this.resumeSMaskCtx=this.activeSMask=null;this.old=a}a.prototype={clone:function(){return Object.create(this)},setCurrentPoint:function(a,b){this.x=
a;this.y=b}};return a}();b=function(){function a(a,b,c,d){this.ctx=a;this.current=new X;this.stateStack=[];this.pendingClip=null;this.pendingEOFill=!1;this.xobjs=this.res=null;this.commonObjs=b;this.objs=c;this.imageLayer=d;this.groupStack=[];this.baseTransform=this.processingType3=null;this.baseTransformStack=[];this.groupLevel=0;this.smaskStack=[];this.smaskCounter=0;this.tempSMask=null;this.cachedCanvases=new da;a&&g(a);this.cachedGetSinglePixelWidth=null}function b(a,b){if("undefined"!==typeof ImageData&&
b instanceof ImageData)a.putImageData(b,0,0);else{var c=b.height,d=b.width,f=c%16;c=(c-f)/16;var g=0===f?c:c+1,h=a.createImageData(d,16),m=0,n=b.data,q=h.data,r,t;if(b.kind===v.GRAYSCALE_1BPP){var w=n.byteLength;q=oa.value?new Uint32Array(q.buffer):new p(q);var z=q.length,Ka=d+7>>3,ba=ua.value||!oa.value?4278190080:255;for(r=0;r<g;r++){var A=r<c?16:f;for(t=b=0;t<A;t++){var B=w-m,D=0;B=B>Ka?d:8*B-7;for(var C=B&-8,F=0,N=0;D<C;D+=8)N=n[m++],q[b++]=N&128?4294967295:ba,q[b++]=N&64?4294967295:ba,q[b++]=
N&32?4294967295:ba,q[b++]=N&16?4294967295:ba,q[b++]=N&8?4294967295:ba,q[b++]=N&4?4294967295:ba,q[b++]=N&2?4294967295:ba,q[b++]=N&1?4294967295:ba;for(;D<B;D++)0===F&&(N=n[m++],F=128),q[b++]=N&F?4294967295:ba,F>>=1}for(;b<z;)q[b++]=0;a.putImageData(h,0,16*r)}}else if(b.kind===v.RGBA_32BPP){t=0;A=64*d;for(r=0;r<c;r++)q.set(n.subarray(m,m+A)),m+=A,a.putImageData(h,0,t),t+=16;r<g&&(q.set(n.subarray(m,m+d*f*4)),a.putImageData(h,0,t))}else if(b.kind===v.RGB_24BPP)for(A=16*d,r=0;r<g;r++){r>=c&&(A=f,A*=d);
b=0;for(t=A;t--;)q[b++]=n[m++],q[b++]=n[m++],q[b++]=n[m++],q[b++]=255;a.putImageData(h,0,16*r)}else I("bad image kind: "+b.kind)}}function c(a,b){var c=b.height,d=b.width,f=c%16;c=(c-f)/16;var g=0===f?c:c+1,h=a.createImageData(d,16),m=0;b=b.data;for(var n=h.data,p=0;p<g;p++){for(var q=p<c?16:f,r=3,t=0;t<q;t++)for(var v=0,w=0;w<d;w++){if(!v){var z=b[m++];v=128}n[r]=z&v?0:255;r+=4;v>>=1}a.putImageData(h,0,16*p)}}function d(a,b){for(var c="strokeStyle fillStyle fillRule globalAlpha lineWidth lineCap lineJoin miterLimit globalCompositeOperation font".split(" "),
d=0,f=c.length;d<f;d++){var g=c[d];void 0!==a[g]&&(b[g]=a[g])}void 0!==a.setLineDash?(b.setLineDash(a.getLineDash()),b.lineDashOffset=a.lineDashOffset):void 0!==a.mozDashOffset&&(b.mozDash=a.mozDash,b.mozDashOffset=a.mozDashOffset)}function f(a,b,c){for(var d=a.length,f=1/255,g=3;g<d;g+=4)b[g]=b[g]*(c?c[a[g]]:a[g])*f|0}function m(a,b,c){for(var d=a.length,f=3;f<d;f+=4){var g=77*a[f-3]+152*a[f-2]+28*a[f-1];b[f]=c?b[f]*c[g>>8]>>8:b[f]*g>>16}}function n(a,b,c){var d=b.canvas,g=b.context;a.setTransform(b.scaleX,
0,0,b.scaleY,b.offsetX,b.offsetY);var h=b.backdrop||null;if(!b.transferMap&&C.isEnabled)c=C.composeSMask(c.canvas,d,{subtype:b.subtype,backdrop:h}),a.setTransform(1,0,0,1,0,0),a.drawImage(c,b.offsetX,b.offsetY);else{var n=d.width,p=d.height,q=b.transferMap,r=!!h,t=r?h[0]:0,v=r?h[1]:0;h=r?h[2]:0;b="Luminosity"===b.subtype?m:f;for(var w=Math.min(p,Math.ceil(1048576/n)),z=0;z<p;z+=w){var ba=Math.min(w,p-z),Ka=g.getImageData(0,z,n,ba);ba=c.getImageData(0,z,n,ba);if(r)for(var A=Ka.data,B=t,db=v,D=h,F=
A.length,N=3;N<F;N+=4){var ea=A[N];if(0===ea)A[N-3]=B,A[N-2]=db,A[N-1]=D;else if(255>ea){var Da=255-ea;A[N-3]=A[N-3]*ea+B*Da>>8;A[N-2]=A[N-2]*ea+db*Da>>8;A[N-1]=A[N-1]*ea+D*Da>>8}}b(Ka.data,ba.data,q);g.putImageData(ba,0,z)}a.drawImage(d,0,0)}}var r=["butt","round","square"],A=["miter","round","bevel"],D={},fa={};a.prototype={beginDrawing:function(a,b,c){var d=this.ctx.canvas.width,f=this.ctx.canvas.height;this.ctx.save();this.ctx.fillStyle="rgb(255, 255, 255)";this.ctx.fillRect(0,0,d,f);this.ctx.restore();
c&&(c=this.cachedCanvases.getCanvas("transparent",d,f,!0),this.compositeCtx=this.ctx,this.transparentCanvas=c.canvas,this.ctx=c.context,this.ctx.save(),this.ctx.transform.apply(this.ctx,this.compositeCtx.mozCurrentTransform));this.ctx.save();a&&this.ctx.transform.apply(this.ctx,a);this.ctx.transform.apply(this.ctx,b.transform);this.baseTransform=this.ctx.mozCurrentTransform.slice();this.imageLayer&&this.imageLayer.beginLayout()},executeOperatorList:function(a,b,c,d){var f=a.argsArray;a=a.fnArray;
b=b||0;var g=f.length;if(g===b)return b;for(var h=10<g-b&&"function"===typeof c,m=h?Date.now()+15:0,n=0,p=this.commonObjs,r=this.objs,t;;){if(void 0!==d&&b===d.nextBreakPoint)return d.breakIt(b,c),b;t=a[b];if(t!==q.dependency)this[t].apply(this,f[b]);else{t=f[b];for(var v=0,w=t.length;v<w;v++){var z=t[v],ba="g"===z[0]&&"_"===z[1]?p:r;if(!ba.isResolved(z))return ba.get(z,c),b}}b++;if(b===g)return b;if(h&&10<++n){if(Date.now()>m)return c(),b;n=0}}},endDrawing:function(){null!==this.current.activeSMask&&
this.endSMaskGroup();this.ctx.restore();this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null);this.cachedCanvases.clear();C.clear();this.imageLayer&&this.imageLayer.endLayout()},setLineWidth:function(a){this.current.lineWidth=a;this.ctx.lineWidth=a},setLineCap:function(a){this.ctx.lineCap=r[a]},setLineJoin:function(a){this.ctx.lineJoin=A[a]},setMiterLimit:function(a){this.ctx.miterLimit=
a},setDash:function(a,b){var c=this.ctx;void 0!==c.setLineDash?(c.setLineDash(a),c.lineDashOffset=b):(c.mozDash=a,c.mozDashOffset=b)},setRenderingIntent:function(a){},setFlatness:function(a){},setGState:function(a){for(var b=0,c=a.length;b<c;b++){var d=a[b],f=d[1];switch(d[0]){case "LW":this.setLineWidth(f);break;case "LC":this.setLineCap(f);break;case "LJ":this.setLineJoin(f);break;case "ML":this.setMiterLimit(f);break;case "D":this.setDash(f[0],f[1]);break;case "RI":this.setRenderingIntent(f);break;
case "FL":this.setFlatness(f);break;case "Font":this.setFont(f[0],f[1]);break;case "CA":this.current.strokeAlpha=d[1];break;case "ca":this.current.fillAlpha=d[1];this.ctx.globalAlpha=d[1];break;case "BM":f&&f.name&&"Normal"!==f.name?(d=f.name.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()}).substring(1),this.ctx.globalCompositeOperation=d,this.ctx.globalCompositeOperation!==d&&K('globalCompositeOperation "'+d+'" is not supported')):this.ctx.globalCompositeOperation="source-over";break;case "SMask":this.current.activeSMask&&
(0<this.stateStack.length&&this.stateStack[this.stateStack.length-1].activeSMask===this.current.activeSMask?this.suspendSMaskGroup():this.endSMaskGroup()),this.current.activeSMask=f?this.tempSMask:null,this.current.activeSMask&&this.beginSMaskGroup(),this.tempSMask=null}}},beginSMaskGroup:function(){var a=this.current.activeSMask,b=this.cachedCanvases.getCanvas("smaskGroupAt"+this.groupLevel,a.canvas.width,a.canvas.height,!0),c=this.ctx,f=c.mozCurrentTransform;this.ctx.save();b=b.context;b.scale(1/
a.scaleX,1/a.scaleY);b.translate(-a.offsetX,-a.offsetY);b.transform.apply(b,f);a.startTransformInverse=b.mozCurrentTransformInverse;d(c,b);this.ctx=b;this.setGState([["BM","Normal"],["ca",1],["CA",1]]);this.groupStack.push(c);this.groupLevel++},suspendSMaskGroup:function(){var a=this.ctx;this.groupLevel--;this.ctx=this.groupStack.pop();n(this.ctx,this.current.activeSMask,a);this.ctx.restore();this.ctx.save();d(a,this.ctx);this.current.resumeSMaskCtx=a;var b=B.transform(this.current.activeSMask.startTransformInverse,
a.mozCurrentTransform);this.ctx.transform.apply(this.ctx,b);a.save();a.setTransform(1,0,0,1,0,0);a.clearRect(0,0,a.canvas.width,a.canvas.height);a.restore()},resumeSMaskGroup:function(){var a=this.ctx;this.ctx=this.current.resumeSMaskCtx;this.groupStack.push(a);this.groupLevel++},endSMaskGroup:function(){var a=this.ctx;this.groupLevel--;this.ctx=this.groupStack.pop();n(this.ctx,this.current.activeSMask,a);this.ctx.restore();d(a,this.ctx);a=B.transform(this.current.activeSMask.startTransformInverse,
a.mozCurrentTransform);this.ctx.transform.apply(this.ctx,a)},save:function(){this.ctx.save();var a=this.current;this.stateStack.push(a);this.current=a.clone();this.current.resumeSMaskCtx=null},restore:function(){this.current.resumeSMaskCtx&&this.resumeSMaskGroup();null===this.current.activeSMask||0!==this.stateStack.length&&this.stateStack[this.stateStack.length-1].activeSMask===this.current.activeSMask||this.endSMaskGroup();0!==this.stateStack.length&&(this.current=this.stateStack.pop(),this.ctx.restore(),
this.cachedGetSinglePixelWidth=this.pendingClip=null)},transform:function(a,b,c,d,f,g){this.ctx.transform(a,b,c,d,f,g);this.cachedGetSinglePixelWidth=null},constructPath:function(a,b){for(var c=this.ctx,d=this.current,f=d.x,g=d.y,h=0,m=0,n=a.length;h<n;h++)switch(a[h]|0){case q.rectangle:f=b[m++];g=b[m++];var p=b[m++],r=b[m++];0===p&&(p=this.getSinglePixelWidth());0===r&&(r=this.getSinglePixelWidth());p=f+p;r=g+r;this.ctx.moveTo(f,g);this.ctx.lineTo(p,g);this.ctx.lineTo(p,r);this.ctx.lineTo(f,r);
this.ctx.lineTo(f,g);this.ctx.closePath();break;case q.moveTo:f=b[m++];g=b[m++];c.moveTo(f,g);break;case q.lineTo:f=b[m++];g=b[m++];c.lineTo(f,g);break;case q.curveTo:f=b[m+4];g=b[m+5];c.bezierCurveTo(b[m],b[m+1],b[m+2],b[m+3],f,g);m+=6;break;case q.curveTo2:c.bezierCurveTo(f,g,b[m],b[m+1],b[m+2],b[m+3]);f=b[m+2];g=b[m+3];m+=4;break;case q.curveTo3:f=b[m+2];g=b[m+3];c.bezierCurveTo(b[m],b[m+1],f,g,f,g);m+=4;break;case q.closePath:c.closePath()}d.setCurrentPoint(f,g)},closePath:function(){this.ctx.closePath()},
stroke:function(a){a="undefined"!==typeof a?a:!0;var b=this.ctx,c=this.current.strokeColor;b.lineWidth=Math.max(.65*this.getSinglePixelWidth(),this.current.lineWidth);b.globalAlpha=this.current.strokeAlpha;c&&c.hasOwnProperty("type")&&"Pattern"===c.type?(b.save(),b.strokeStyle=c.getPattern(b,this),b.stroke(),b.restore()):b.stroke();a&&this.consumePath();b.globalAlpha=this.current.fillAlpha},closeStroke:function(){this.closePath();this.stroke()},fill:function(a){a="undefined"!==typeof a?a:!0;var b=
this.ctx,c=this.current.fillColor,d=!1;this.current.patternFill&&(b.save(),this.baseTransform&&b.setTransform.apply(b,this.baseTransform),b.fillStyle=c.getPattern(b,this),d=!0);this.pendingEOFill?(void 0!==b.mozFillRule?(b.mozFillRule="evenodd",b.fill(),b.mozFillRule="nonzero"):b.fill("evenodd"),this.pendingEOFill=!1):b.fill();d&&b.restore();a&&this.consumePath()},eoFill:function(){this.pendingEOFill=!0;this.fill()},fillStroke:function(){this.fill(!1);this.stroke(!1);this.consumePath()},eoFillStroke:function(){this.pendingEOFill=
!0;this.fillStroke()},closeFillStroke:function(){this.closePath();this.fillStroke()},closeEOFillStroke:function(){this.pendingEOFill=!0;this.closePath();this.fillStroke()},endPath:function(){this.consumePath()},clip:function(){this.pendingClip=D},eoClip:function(){this.pendingClip=fa},beginText:function(){this.current.textMatrix=t;this.current.textMatrixScale=1;this.current.x=this.current.lineX=0;this.current.y=this.current.lineY=0},endText:function(){var a=this.pendingTextPaths,b=this.ctx;if(void 0===
a)b.beginPath();else{b.save();b.beginPath();for(var c=0;c<a.length;c++){var d=a[c];b.setTransform.apply(b,d.transform);b.translate(d.x,d.y);d.addToPath(b,d.fontSize)}b.restore();b.clip();b.beginPath();delete this.pendingTextPaths}},setCharSpacing:function(a){this.current.charSpacing=a},setWordSpacing:function(a){this.current.wordSpacing=a},setHScale:function(a){this.current.textHScale=a/100},setLeading:function(a){this.current.leading=-a},setFont:function(a,b){var c=this.commonObjs.get(a),d=this.current;
c||I("Can't find font for "+a);d.fontMatrix=c.fontMatrix?c.fontMatrix:z;0!==d.fontMatrix[0]&&0!==d.fontMatrix[3]||K("Invalid font matrix for font "+a);0>b?(b=-b,d.fontDirection=-1):d.fontDirection=1;this.current.font=c;this.current.fontSize=b;if(!c.isType3Font){a=c.black?c.bold?"900":"bold":c.bold?"bold":"normal";d=c.italic?"italic":"normal";c='"'+(c.loadedName||"sans-serif")+'", '+c.fallbackName;var f=16>b?16:100<b?100:b;this.current.fontSizeScale=b/f;this.ctx.font=d+" "+a+" "+f+"px "+c}},setTextRenderingMode:function(a){this.current.textRenderingMode=
a},setTextRise:function(a){this.current.textRise=a},moveText:function(a,b){this.current.x=this.current.lineX+=a;this.current.y=this.current.lineY+=b},setLeadingMoveText:function(a,b){this.setLeading(-b);this.moveText(a,b)},setTextMatrix:function(a,b,c,d,f,g){this.current.textMatrix=[a,b,c,d,f,g];this.current.textMatrixScale=Math.sqrt(a*a+b*b);this.current.x=this.current.lineX=0;this.current.y=this.current.lineY=0},nextLine:function(){this.moveText(0,this.current.leading)},paintChar:function(a,b,c){var d=
this.ctx,f=this.current,g=f.font,h=f.textRenderingMode;f=f.fontSize/f.fontSizeScale;var m=h&w.FILL_STROKE_MASK;h=!!(h&w.ADD_TO_PATH_FLAG);if(g.disableFontFace||h)var n=g.getPathGenerator(this.commonObjs,a);g.disableFontFace?(d.save(),d.translate(b,c),d.beginPath(),n(d,f),m!==w.FILL&&m!==w.FILL_STROKE||d.fill(),m!==w.STROKE&&m!==w.FILL_STROKE||d.stroke(),d.restore()):(m!==w.FILL&&m!==w.FILL_STROKE||d.fillText(a,b,c),m!==w.STROKE&&m!==w.FILL_STROKE||d.strokeText(a,b,c));h&&(this.pendingTextPaths||(this.pendingTextPaths=
[])).push({transform:d.mozCurrentTransform,x:b,y:c,fontSize:f,addToPath:n})},get isFontSubpixelAAEnabled(){var a=document.createElement("canvas").getContext("2d");a.scale(1.5,1);a.fillText("I",0,10);a=a.getImageData(0,0,10,10).data;for(var b=!1,c=3;c<a.length;c+=4)if(0<a[c]&&255>a[c]){b=!0;break}return P(this,"isFontSubpixelAAEnabled",b)},showText:function(a){var b=this.current,c=b.font;if(c.isType3Font)return this.showType3Text(a);var d=b.fontSize;if(0!==d){var f=this.ctx,g=b.fontSizeScale,h=b.charSpacing,
m=b.wordSpacing,n=b.fontDirection,p=b.textHScale*n,q=a.length,r=c.vertical,t=r?1:-1,v=c.defaultVMetrics,z=d*b.fontMatrix[0],A=b.textRenderingMode===w.FILL&&!c.disableFontFace;f.save();f.transform.apply(f,b.textMatrix);f.translate(b.x,b.y+b.textRise);b.patternFill&&(f.fillStyle=b.fillColor.getPattern(f,this));0<n?f.scale(p,-1):f.scale(p,1);var B=b.lineWidth,D=b.textMatrixScale;if(0===D||0===B){if(D=b.textRenderingMode&w.FILL_STROKE_MASK,D===w.STROKE||D===w.FILL_STROKE)this.cachedGetSinglePixelWidth=
null,B=.65*this.getSinglePixelWidth()}else B/=D;1!==g&&(f.scale(g,g),B/=g);f.lineWidth=B;for(D=B=0;D<q;++D){var ba=a[D];if(M(ba))B+=t*ba*d/1E3;else{var C=!1,F=(ba.isSpace?m:0)+h,N=ba.fontChar,ea=ba.accent,Da=ba.width;if(r){var Ga=ba.vmetric||v;var ma=ba.vmetric?Ga[1]:.5*Da;ma=-ma*z;var Wa=Ga[2]*z;Da=Ga?-Ga[0]:Da;Ga=ma/g;Wa=(B+Wa)/g}else Ga=B/g,Wa=0;c.remeasure&&0<Da&&(ma=1E3*f.measureText(N).width/d*g,Da<ma&&this.isFontSubpixelAAEnabled?(ma=Da/ma,C=!0,f.save(),f.scale(ma,1),Ga/=ma):Da!==ma&&(Ga+=
(Da-ma)/2E3*d/g));if(ba.isInFont||c.missingFile)A&&!ea?f.fillText(N,Ga,Wa):(this.paintChar(N,Ga,Wa),ea&&(ba=Ga+ea.offset.x/g,N=Wa-ea.offset.y/g,this.paintChar(ea.fontChar,ba,N)));B+=Da*z+F*n;C&&f.restore()}}r?b.y-=B*p:b.x+=B*p;f.restore()}},showType3Text:function(a){var b=this.ctx,c=this.current,d=c.font,f=c.fontSize,g=c.fontDirection,h=d.vertical?1:-1,m=c.charSpacing,n=c.wordSpacing,p=c.textHScale*g,q=c.fontMatrix||z,r=a.length;if(c.textRenderingMode!==w.INVISIBLE&&0!==f){this.cachedGetSinglePixelWidth=
null;b.save();b.transform.apply(b,c.textMatrix);b.translate(c.x,c.y);b.scale(p,g);for(g=0;g<r;++g){var t=a[g];if(M(t))t=h*t*f/1E3,this.ctx.translate(t,0),c.x+=t*p;else{var v=(t.isSpace?n:0)+m,A=d.charProcOperatorList[t.operatorListId];A?(this.processingType3=t,this.save(),b.scale(f,f),b.transform.apply(b,q),this.executeOperatorList(A),this.restore(),t=B.applyTransform([t.width,0],q)[0]*f+v,b.translate(t,0),c.x+=t*p):K('Type3 character "'+t.operatorListId+'" is not available')}}b.restore();this.processingType3=
null}},setCharWidth:function(a,b){},setCharWidthAndBounds:function(a,b,c,d,f,g){this.ctx.rect(c,d,f-c,g-d);this.clip();this.endPath()},getColorN_Pattern:function(b){if("TilingPattern"===b[0]){var c=b[1],d=this.baseTransform||this.ctx.mozCurrentTransform.slice(),f=this;b=new R(b,c,this.ctx,{createCanvasGraphics:function(b){return new a(b,f.commonObjs,f.objs)}},d)}else b=Z(b);return b},setStrokeColorN:function(){this.current.strokeColor=this.getColorN_Pattern(arguments)},setFillColorN:function(){this.current.fillColor=
this.getColorN_Pattern(arguments);this.current.patternFill=!0},setStrokeRGBColor:function(a,b,c){a=B.makeCssRgb(a,b,c);this.ctx.strokeStyle=a;this.current.strokeColor=a},setFillRGBColor:function(a,b,c){a=B.makeCssRgb(a,b,c);this.ctx.fillStyle=a;this.current.fillColor=a;this.current.patternFill=!1},shadingFill:function(a){var b=this.ctx;this.save();a=Z(a);b.fillStyle=a.getPattern(b,this,!0);var c=b.mozCurrentTransformInverse;if(c){b=b.canvas;var d=b.width,f=b.height;b=B.applyTransform([0,0],c);a=B.applyTransform([0,
f],c);var g=B.applyTransform([d,0],c);c=B.applyTransform([d,f],c);d=Math.min(b[0],a[0],g[0],c[0]);f=Math.min(b[1],a[1],g[1],c[1]);this.ctx.fillRect(d,f,Math.max(b[0],a[0],g[0],c[0])-d,Math.max(b[1],a[1],g[1],c[1])-f)}else this.ctx.fillRect(-1E10,-1E10,2E10,2E10);this.restore()},beginInlineImage:function(){I("Should not call beginInlineImage")},beginImageData:function(){I("Should not call beginImageData")},paintFormXObjectBegin:function(a,b){this.save();this.baseTransformStack.push(this.baseTransform);
J(a)&&6===a.length&&this.transform.apply(this,a);this.baseTransform=this.ctx.mozCurrentTransform;J(b)&&4===b.length&&(this.ctx.rect(b[0],b[1],b[2]-b[0],b[3]-b[1]),this.clip(),this.endPath())},paintFormXObjectEnd:function(){this.restore();this.baseTransform=this.baseTransformStack.pop()},beginGroup:function(a){this.save();var b=this.ctx;a.isolated||H("TODO: Support non-isolated groups.");a.knockout&&K("Knockout groups not supported.");var c=b.mozCurrentTransform;a.matrix&&b.transform.apply(b,a.matrix);
G(a.bbox,"Bounding box is required.");var f=B.getAxialAlignedBoundingBox(a.bbox,b.mozCurrentTransform);f=B.intersect(f,[0,0,b.canvas.width,b.canvas.height])||[0,0,0,0];var g=Math.floor(f[0]),h=Math.floor(f[1]),m=Math.max(Math.ceil(f[2])-g,1),n=Math.max(Math.ceil(f[3])-h,1),p=f=1;4096<m&&(f=m/4096,m=4096);4096<n&&(p=n/4096,n=4096);var q="groupAt"+this.groupLevel;a.smask&&(q+="_smask_"+this.smaskCounter++%2);m=this.cachedCanvases.getCanvas(q,m,n,!0);n=m.context;n.scale(1/f,1/p);n.translate(-g,-h);n.transform.apply(n,
c);a.smask?this.smaskStack.push({canvas:m.canvas,context:n,offsetX:g,offsetY:h,scaleX:f,scaleY:p,subtype:a.smask.subtype,backdrop:a.smask.backdrop,transferMap:a.smask.transferMap||null,startTransformInverse:null}):(b.setTransform(1,0,0,1,0,0),b.translate(g,h),b.scale(f,p));d(b,n);this.ctx=n;this.setGState([["BM","Normal"],["ca",1],["CA",1]]);this.groupStack.push(b);this.groupLevel++;this.current.activeSMask=null},endGroup:function(a){this.groupLevel--;var b=this.ctx;this.ctx=this.groupStack.pop();
void 0!==this.ctx.imageSmoothingEnabled?this.ctx.imageSmoothingEnabled=!1:this.ctx.mozImageSmoothingEnabled=!1;a.smask?this.tempSMask=this.smaskStack.pop():this.ctx.drawImage(b.canvas,0,0);this.restore()},beginAnnotations:function(){this.save();this.current=new X;this.baseTransform&&this.ctx.setTransform.apply(this.ctx,this.baseTransform)},endAnnotations:function(){this.restore()},beginAnnotation:function(a,b,c){this.save();J(a)&&4===a.length&&(this.ctx.rect(a[0],a[1],a[2]-a[0],a[3]-a[1]),this.clip(),
this.endPath());this.transform.apply(this,b);this.transform.apply(this,c)},endAnnotation:function(){this.restore()},paintJpegXObject:function(a,b,c){var d=this.objs.get(a);if(d){this.save();var f=this.ctx;f.scale(1/b,-1/c);f.drawImage(d,0,0,d.width,d.height,0,-c,b,c);this.imageLayer&&(d=f.mozCurrentTransformInverse,f=this.getCanvasPosition(0,0),this.imageLayer.appendImage({objId:a,left:f[0],top:f[1],width:b/d[0],height:c/d[3]}));this.restore()}else K("Dependent image isn't ready yet")},paintImageMaskXObject:function(a){var b=
this.ctx,d=a.width,f=a.height,g=this.current.fillColor,m=this.current.patternFill,n=this.processingType3;n&&void 0===n.compiled&&(n.compiled=1E3>=d&&1E3>=f?h({data:a.data,width:d,height:f}):null);n&&n.compiled?n.compiled(b):(b=this.cachedCanvases.getCanvas("maskCanvas",d,f),n=b.context,n.save(),c(n,a),n.globalCompositeOperation="source-in",n.fillStyle=m?g.getPattern(n,this):g,n.fillRect(0,0,d,f),n.restore(),this.paintInlineImageXObject(b.canvas))},paintImageMaskXObjectRepeat:function(a,b,d,f){var g=
a.width,h=a.height,m=this.current.fillColor,n=this.current.patternFill,p=this.cachedCanvases.getCanvas("maskCanvas",g,h),q=p.context;q.save();c(q,a);q.globalCompositeOperation="source-in";q.fillStyle=n?m.getPattern(q,this):m;q.fillRect(0,0,g,h);q.restore();a=this.ctx;m=0;for(n=f.length;m<n;m+=2)a.save(),a.transform(b,0,0,d,f[m],f[m+1]),a.scale(1,-1),a.drawImage(p.canvas,0,0,g,h,0,-1,1,1),a.restore()},paintImageMaskXObjectGroup:function(a){for(var b=this.ctx,d=this.current.fillColor,f=this.current.patternFill,
g=0,h=a.length;g<h;g++){var m=a[g],n=m.width,p=m.height,q=this.cachedCanvases.getCanvas("maskCanvas",n,p),r=q.context;r.save();c(r,m);r.globalCompositeOperation="source-in";r.fillStyle=f?d.getPattern(r,this):d;r.fillRect(0,0,n,p);r.restore();b.save();b.transform.apply(b,m.transform);b.scale(1,-1);b.drawImage(q.canvas,0,0,n,p,0,-1,1,1);b.restore()}},paintImageXObject:function(a){(a=this.objs.get(a))?this.paintInlineImageXObject(a):K("Dependent image isn't ready yet")},paintImageXObjectRepeat:function(a,
b,c,d){if(a=this.objs.get(a)){for(var f=a.width,g=a.height,h=[],m=0,n=d.length;m<n;m+=2)h.push({transform:[b,0,0,c,d[m],d[m+1]],x:0,y:0,w:f,h:g});this.paintInlineImageXObjectGroup(a,h)}else K("Dependent image isn't ready yet")},paintInlineImageXObject:function(a){var c=a.width,d=a.height,f=this.ctx;this.save();f.scale(1/c,-1/d);var g=f.mozCurrentTransformInverse,h=g[0],m=g[1];h=Math.max(Math.sqrt(h*h+m*m),1);m=g[2];var n=g[3];m=Math.max(Math.sqrt(m*m+n*n),1);if(a instanceof HTMLElement||!a.data)n=
a;else{var p=this.cachedCanvases.getCanvas("inlineImage",c,d);var q=p.context;b(q,a);n=p.canvas}for(var r=c,t=d,v="prescale1";2<h&&1<r||2<m&&1<t;){var w=r,z=t;2<h&&1<r&&(w=Math.ceil(r/2),h/=r/w);2<m&&1<t&&(z=Math.ceil(t/2),m/=t/z);p=this.cachedCanvases.getCanvas(v,w,z);q=p.context;q.clearRect(0,0,w,z);q.drawImage(n,0,0,r,t,0,0,w,z);n=p.canvas;r=w;t=z;v="prescale1"===v?"prescale2":"prescale1"}f.drawImage(n,0,0,r,t,0,-d,c,d);this.imageLayer&&(f=this.getCanvasPosition(0,-d),this.imageLayer.appendImage({imgData:a,
left:f[0],top:f[1],width:c/g[0],height:d/g[3]}));this.restore()},paintInlineImageXObjectGroup:function(a,c){var d=this.ctx,f=a.width,g=a.height,h=this.cachedCanvases.getCanvas("inlineImage",f,g);b(h.context,a);for(var m=0,n=c.length;m<n;m++){var p=c[m];d.save();d.transform.apply(d,p.transform);d.scale(1,-1);d.drawImage(h.canvas,p.x,p.y,p.w,p.h,0,-1,1,1);this.imageLayer&&(p=this.getCanvasPosition(p.x,p.y),this.imageLayer.appendImage({imgData:a,left:p[0],top:p[1],width:f,height:g}));d.restore()}},paintSolidColorImageMask:function(){this.ctx.fillRect(0,
0,1,1)},paintXObject:function(){K("Unsupported 'paintXObject' command.")},markPoint:function(a){},markPointProps:function(a,b){},beginMarkedContent:function(a){},beginMarkedContentProps:function(a,b){},endMarkedContent:function(){},beginCompat:function(){},endCompat:function(){},consumePath:function(){var a=this.ctx;this.pendingClip&&(this.pendingClip===fa?void 0!==a.mozFillRule?(a.mozFillRule="evenodd",a.clip(),a.mozFillRule="nonzero"):a.clip("evenodd"):a.clip(),this.pendingClip=null);a.beginPath()},
getSinglePixelWidth:function(a){null===this.cachedGetSinglePixelWidth&&(a=this.ctx.mozCurrentTransformInverse,this.cachedGetSinglePixelWidth=Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1],a[2]*a[2]+a[3]*a[3])));return this.cachedGetSinglePixelWidth},getCanvasPosition:function(a,b){var c=this.ctx.mozCurrentTransform;return[c[0]*a+c[2]*b+c[4],c[1]*a+c[3]*b+c[5]]}};for(var Ja in q)a.prototype[q[Ja]]=a.prototype[Ja];return a}();a.CanvasGraphics=b;a.createScratchCanvas=f});(function(a,b){b(a.pdfjsDisplayAPI={},
a.pdfjsSharedUtil,a.pdfjsDisplayFontLoader,a.pdfjsDisplayCanvas,a.pdfjsDisplayMetadata,a.pdfjsDisplayDOMUtils)})(this,function(a,b,d,h,m,n,r){function f(a,b,c,d){if(a.destroyed)return Promise.reject(Error("Worker was destroyed"));b.disableAutoFetch=ja("disableAutoFetch");b.disableStream=ja("disableStream");b.chunkedViewerLoading=!!c;c&&(b.length=c.length,b.initialData=c.initialData);return a.messageHandler.sendWithPromise("GetDocRequest",{docId:d,source:b,disableRange:ja("disableRange"),maxImageSize:ja("maxImageSize"),
cMapUrl:ja("cMapUrl"),cMapPacked:ja("cMapPacked"),disableFontFace:ja("disableFontFace"),disableCreateObjectURL:ja("disableCreateObjectURL"),postMessageTransfers:ja("postMessageTransfers")&&!ia}).then(function(b){if(a.destroyed)throw Error("Worker was destroyed");return b})}var g=b.InvalidPDFException,t=b.MessageHandler,v=b.MissingPDFException,q=b.PageViewport,w=b.PasswordResponses,p=b.PasswordException,B=b.StatTimer,G=b.UnexpectedResponseException,H=b.UnknownErrorException,M=b.Util,J=b.createPromiseCapability,
D=b.error,I=b.deprecated,P=b.getVerbosityLevel,K=b.info,R=b.isArrayBuffer,Z=b.isSameOrigin,C=b.loadJpegStream,fa=b.stringToBytes,oa=b.globalScope,ua=b.warn,da=d.FontFaceObject,X=d.FontLoader,aa=h.CanvasGraphics,qa=h.createScratchCanvas,V=m.Metadata,ja=n.getDefaultSetting,Ha=!1,Ia,ia=!1;b=!1;"undefined"===typeof window&&(Ha=!0,"undefined"===typeof require.ensure&&(require.ensure=require("node-ensure")),b=!0);"undefined"!==typeof __webpack_require__&&(b=!0);"undefined"!==typeof requirejs&&requirejs.toUrl&&
(Ia=requirejs.toUrl("pdfjs-dist/build/pdf.worker.js"));d="undefined"!==typeof requirejs&&requirejs.load;var ra=b?function(a){require.ensure([],function(){var b=require("./pdf.worker.js");a(b.WorkerMessageHandler)})}:d?function(a){requirejs(["pdfjs-dist/build/pdf.worker"],function(b){a(b.WorkerMessageHandler)})}:null,Za=function(){function a(){this._capability=J();this._worker=this._transport=null;this.docId="d"+b++;this.destroyed=!1;this.onUnsupportedFeature=this.onProgress=this.onPassword=null}var b=
0;a.prototype={get promise(){return this._capability.promise},destroy:function(){this.destroyed=!0;return(this._transport?this._transport.destroy():Promise.resolve()).then(function(){this._transport=null;this._worker&&(this._worker.destroy(),this._worker=null)}.bind(this))},then:function(a,b){return this.promise.then.apply(this.promise,arguments)}};return a}(),xa=function(){function a(a,b){this.length=a;this.initialData=b;this._rangeListeners=[];this._progressListeners=[];this._progressiveReadListeners=
[];this._readyCapability=J()}a.prototype={addRangeListener:function(a){this._rangeListeners.push(a)},addProgressListener:function(a){this._progressListeners.push(a)},addProgressiveReadListener:function(a){this._progressiveReadListeners.push(a)},onDataRange:function(a,b){for(var c=this._rangeListeners,d=0,f=c.length;d<f;++d)c[d](a,b)},onDataProgress:function(a){this._readyCapability.promise.then(function(){for(var b=this._progressListeners,c=0,d=b.length;c<d;++c)b[c](a)}.bind(this))},onDataProgressiveRead:function(a){this._readyCapability.promise.then(function(){for(var b=
this._progressiveReadListeners,c=0,d=b.length;c<d;++c)b[c](a)}.bind(this))},transportReady:function(){this._readyCapability.resolve()},requestDataRange:function(a,b){throw Error("Abstract method PDFDataRangeTransport.requestDataRange");},abort:function(){}};return a}(),Sa=function(){function a(a,b,c){this.pdfInfo=a;this.transport=b;this.loadingTask=c}a.prototype={get numPages(){return this.pdfInfo.numPages},get fingerprint(){return this.pdfInfo.fingerprint},getPage:function(a){return this.transport.getPage(a)},
getPageIndex:function(a){return this.transport.getPageIndex(a)},getDestinations:function(){return this.transport.getDestinations()},getDestination:function(a){return this.transport.getDestination(a)},getPageLabels:function(){return this.transport.getPageLabels()},getAttachments:function(){return this.transport.getAttachments()},getJavaScript:function(){return this.transport.getJavaScript()},getOutline:function(){return this.transport.getOutline()},getMetadata:function(){return this.transport.getMetadata()},
getData:function(){return this.transport.getData()},getDownloadInfo:function(){return this.transport.downloadInfoCapability.promise},getStats:function(){return this.transport.getStats()},cleanup:function(){this.transport.startCleanup()},destroy:function(){return this.loadingTask.destroy()}};return a}(),Ja=function(){function a(a,b,c){this.pageIndex=a;this.pageInfo=b;this.transport=c;this.stats=new B;this.stats.enabled=ja("enableStats");this.commonObjs=c.commonObjs;this.objs=new db;this.pendingCleanup=
this.cleanupAfterRender=!1;this.intentStates=Object.create(null);this.destroyed=!1}a.prototype={get pageNumber(){return this.pageIndex+1},get rotate(){return this.pageInfo.rotate},get ref(){return this.pageInfo.ref},get view(){return this.pageInfo.view},getViewport:function(a,b){2>arguments.length&&(b=this.rotate);return new q(this.view,a,b,0,0)},getAnnotations:function(a){a=a&&a.intent||null;this.annotationsPromise&&this.annotationsIntent===a||(this.annotationsPromise=this.transport.getAnnotations(this.pageIndex,
a),this.annotationsIntent=a);return this.annotationsPromise},render:function(a){function b(a){var b=f.renderTasks.indexOf(g);0<=b&&f.renderTasks.splice(b,1);h.cleanupAfterRender&&(h.pendingCleanup=!0);h._tryCleanup();a?g.capability.reject(a):g.capability.resolve();c.timeEnd("Rendering");c.timeEnd("Overall")}var c=this.stats;c.time("Overall");this.pendingCleanup=!1;var d="print"===a.intent?"print":"display";this.intentStates[d]||(this.intentStates[d]=Object.create(null));var f=this.intentStates[d];
f.displayReadyCapability||(f.receivingOperatorList=!0,f.displayReadyCapability=J(),f.operatorList={fnArray:[],argsArray:[],lastChunk:!1},this.stats.time("Page Request"),this.transport.messageHandler.send("RenderPageRequest",{pageIndex:this.pageNumber-1,intent:d}));var g=new qb(b,a,this.objs,this.commonObjs,f.operatorList,this.pageNumber);g.useRequestAnimationFrame="print"!==d;f.renderTasks||(f.renderTasks=[]);f.renderTasks.push(g);d=g.task;a.continueCallback&&(I("render is used with continueCallback parameter"),
d.onContinue=a.continueCallback);var h=this;f.displayReadyCapability.promise.then(function(a){h.pendingCleanup?b():(c.time("Rendering"),g.initalizeGraphics(a),g.operatorListChanged())},function(a){b(a)});return d},getOperatorList:function(){function a(){if(b.operatorList.lastChunk){b.opListReadCapability.resolve(b.operatorList);var a=b.renderTasks.indexOf(c);0<=a&&b.renderTasks.splice(a,1)}}this.intentStates.oplist||(this.intentStates.oplist=Object.create(null));var b=this.intentStates.oplist;if(!b.opListReadCapability){var c=
{};c.operatorListChanged=a;b.receivingOperatorList=!0;b.opListReadCapability=J();b.renderTasks=[];b.renderTasks.push(c);b.operatorList={fnArray:[],argsArray:[],lastChunk:!1};this.transport.messageHandler.send("RenderPageRequest",{pageIndex:this.pageIndex,intent:"oplist"})}return b.opListReadCapability.promise},getTextContent:function(a){return this.transport.messageHandler.sendWithPromise("GetTextContent",{pageIndex:this.pageNumber-1,normalizeWhitespace:a&&a.normalizeWhitespace||!1})},_destroy:function(){this.destroyed=
!0;this.transport.pageCache[this.pageIndex]=null;var a=[];Object.keys(this.intentStates).forEach(function(b){"oplist"!==b&&this.intentStates[b].renderTasks.forEach(function(b){var c=b.capability.promise.catch(function(){});a.push(c);b.cancel()})},this);this.objs.clear();this.annotationsPromise=null;this.pendingCleanup=!1;return Promise.all(a)},destroy:function(){I("page destroy method, use cleanup() instead");this.cleanup()},cleanup:function(){this.pendingCleanup=!0;this._tryCleanup()},_tryCleanup:function(){this.pendingCleanup&&
!Object.keys(this.intentStates).some(function(a){a=this.intentStates[a];return 0!==a.renderTasks.length||a.receivingOperatorList},this)&&(Object.keys(this.intentStates).forEach(function(a){delete this.intentStates[a]},this),this.objs.clear(),this.annotationsPromise=null,this.pendingCleanup=!1)},_startRenderPage:function(a,b){b=this.intentStates[b];b.displayReadyCapability&&b.displayReadyCapability.resolve(a)},_renderPageChunk:function(a,b){b=this.intentStates[b];var c;var d=0;for(c=a.length;d<c;d++)b.operatorList.fnArray.push(a.fnArray[d]),
b.operatorList.argsArray.push(a.argsArray[d]);b.operatorList.lastChunk=a.lastChunk;for(d=0;d<b.renderTasks.length;d++)b.renderTasks[d].operatorListChanged();a.lastChunk&&(b.receivingOperatorList=!1,this._tryCleanup())}};return a}(),ba=function(){function a(){if("undefined"!==typeof Ia)return Ia;if(ja("workerSrc"))return ja("workerSrc");if(c)return c.replace(/\.js$/i,".worker.js");D("No PDFJS.workerSrc specified")}function b(){g||(g=J(),(ra||function(b){M.loadScript(a(),function(){b(window.pdfjsDistBuildPdfWorker.WorkerMessageHandler)})})(g.resolve));
return g.promise}function d(a){this.name=a;this.destroyed=!1;this._readyCapability=J();this._messageHandler=this._webWorker=this._port=null;this._initialize()}var f=0,g;d.prototype={get promise(){return this._readyCapability.promise},get port(){return this._port},get messageHandler(){return this._messageHandler},_initialize:function(){if(!Ha&&!ja("disableWorker")&&"undefined"!==typeof Worker){var b=a();try{Z(window.location.href,b)||(b=URL.createObjectURL(new Blob(["importScripts('"+(new URL(b,window.location)).href+
"');"])));var c=new Worker(b),d=new t("main","worker",c),f=function(){c.removeEventListener("error",g);d.destroy();c.terminate();this.destroyed?this._readyCapability.reject(Error("Worker was destroyed")):this._setupFakeWorker()}.bind(this),g=function(a){this._webWorker||f()}.bind(this);c.addEventListener("error",g);d.on("test",function(a){c.removeEventListener("error",g);this.destroyed?f():a&&a.supportTypedArray?(this._messageHandler=d,this._webWorker=this._port=c,a.supportTransfers||(ia=!0),this._readyCapability.resolve(),
d.send("configure",{verbosity:P()})):(this._setupFakeWorker(),d.destroy(),c.terminate())}.bind(this));d.on("console_log",function(a){console.log.apply(console,a)});d.on("console_error",function(a){console.error.apply(console,a)});d.on("ready",function(a){c.removeEventListener("error",g);if(this.destroyed)f();else try{h()}catch(jb){this._setupFakeWorker()}}.bind(this));var h=function(){var a=ja("postMessageTransfers")&&!ia;a=new Uint8Array([a?255:0]);try{d.send("test",a,[a.buffer])}catch(jb){K("Cannot use postMessage transfers"),
a[0]=0,d.send("test",a)}};h();return}catch(S){K("The worker has been disabled.")}}this._setupFakeWorker()},_setupFakeWorker:function(){Ha||ja("disableWorker")||(ua("Setting up fake worker."),Ha=!0);b().then(function(a){if(this.destroyed)this._readyCapability.reject(Error("Worker was destroyed"));else{var b={_listeners:[],postMessage:function(a){var b={data:a};this._listeners.forEach(function(a){a.call(this,b)},this)},addEventListener:function(a,b){this._listeners.push(b)},removeEventListener:function(a,
b){a=this._listeners.indexOf(b);this._listeners.splice(a,1)},terminate:function(){}};this._port=b;var c="fake"+f++,d=new t(c+"_worker",c,b);a.setup(d,b);this._messageHandler=new t(c,c+"_worker",b);this._readyCapability.resolve()}}.bind(this))},destroy:function(){this.destroyed=!0;this._webWorker&&(this._webWorker.terminate(),this._webWorker=null);this._port=null;this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}};return d}(),Ka=function(){function a(a,b,c){this.messageHandler=
a;this.loadingTask=b;this.pdfDataRangeTransport=c;this.commonObjs=new db;this.fontLoader=new X(b.docId);this.destroyed=!1;this.destroyCapability=null;this.pageCache=[];this.pagePromises=[];this.downloadInfoCapability=J();this.setupMessageHandler()}a.prototype={destroy:function(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0;this.destroyCapability=J();var a=[];this.pageCache.forEach(function(b){b&&a.push(b._destroy())});this.pageCache=[];this.pagePromises=[];var b=
this,c=this.messageHandler.sendWithPromise("Terminate",null);a.push(c);Promise.all(a).then(function(){b.fontLoader.clear();b.pdfDataRangeTransport&&(b.pdfDataRangeTransport.abort(),b.pdfDataRangeTransport=null);b.messageHandler&&(b.messageHandler.destroy(),b.messageHandler=null);b.destroyCapability.resolve()},this.destroyCapability.reject);return this.destroyCapability.promise},setupMessageHandler:function(){function a(a){b.send("UpdatePassword",a)}var b=this.messageHandler,c=this.pdfDataRangeTransport;
c&&(c.addRangeListener(function(a,c){b.send("OnDataRange",{begin:a,chunk:c})}),c.addProgressListener(function(a){b.send("OnDataProgress",{loaded:a})}),c.addProgressiveReadListener(function(a){b.send("OnDataRange",{chunk:a})}),b.on("RequestDataRange",function(a){c.requestDataRange(a.begin,a.end)},this));b.on("GetDoc",function(a){var b=a.pdfInfo;this.numPages=a.pdfInfo.numPages;a=this.loadingTask;this.pdfDocument=b=new Sa(b,this,a);a._capability.resolve(b)},this);b.on("NeedPassword",function(b){var c=
this.loadingTask;if(c.onPassword)return c.onPassword(a,w.NEED_PASSWORD);c._capability.reject(new p(b.message,b.code))},this);b.on("IncorrectPassword",function(b){var c=this.loadingTask;if(c.onPassword)return c.onPassword(a,w.INCORRECT_PASSWORD);c._capability.reject(new p(b.message,b.code))},this);b.on("InvalidPDF",function(a){this.loadingTask._capability.reject(new g(a.message))},this);b.on("MissingPDF",function(a){this.loadingTask._capability.reject(new v(a.message))},this);b.on("UnexpectedResponse",
function(a){this.loadingTask._capability.reject(new G(a.message,a.status))},this);b.on("UnknownError",function(a){this.loadingTask._capability.reject(new H(a.message,a.details))},this);b.on("DataLoaded",function(a){this.downloadInfoCapability.resolve(a)},this);b.on("PDFManagerReady",function(a){this.pdfDataRangeTransport&&this.pdfDataRangeTransport.transportReady()},this);b.on("StartRenderPage",function(a){if(!this.destroyed){var b=this.pageCache[a.pageIndex];b.stats.timeEnd("Page Request");b._startRenderPage(a.transparency,
a.intent)}},this);b.on("RenderPageChunk",function(a){this.destroyed||this.pageCache[a.pageIndex]._renderPageChunk(a.operatorList,a.intent)},this);b.on("commonobj",function(a){if(!this.destroyed){var b=a[0],c=a[1];if(!this.commonObjs.hasData(b))switch(c){case "Font":a=a[2];if("error"in a){var d=a.error;ua("Error during font loading: "+d);this.commonObjs.resolve(b,d);break}else{c=null;ja("pdfBug")&&oa.FontInspector&&oa.FontInspector.enabled&&(c={registerFont:function(a,b){oa.FontInspector.fontAdded(a,
b)}});var f=new da(a,{isEvalSuported:ja("isEvalSupported"),disableFontFace:ja("disableFontFace"),fontRegistry:c})}this.fontLoader.bind([f],function(a){this.commonObjs.resolve(b,f)}.bind(this));break;case "FontPath":this.commonObjs.resolve(b,a[2]);break;default:d("Got unknown common object type "+c)}}},this);b.on("obj",function(a){if(!this.destroyed){var b=a[0],c=a[2],d=this.pageCache[a[1]];if(!d.objs.hasData(b))switch(c){case "JpegStream":a=a[3];C(b,a,d.objs);break;case "Image":a=a[3];d.objs.resolve(b,
a);a&&"data"in a&&8E6<a.data.length&&(d.cleanupAfterRender=!0);break;default:D("Got unknown object type "+c)}}},this);b.on("DocProgress",function(a){if(!this.destroyed){var b=this.loadingTask;if(b.onProgress)b.onProgress({loaded:a.loaded,total:a.total})}},this);b.on("PageError",function(a){if(!this.destroyed){var b=this.pageCache[a.pageNum-1].intentStates[a.intent];b.displayReadyCapability?b.displayReadyCapability.reject(a.error):D(a.error);if(b.operatorList)for(b.operatorList.lastChunk=!0,a=0;a<
b.renderTasks.length;a++)b.renderTasks[a].operatorListChanged()}},this);b.on("UnsupportedFeature",function(a){if(!this.destroyed){a=a.featureId;var b=this.loadingTask;if(b.onUnsupportedFeature)b.onUnsupportedFeature(a);rb.notify(a)}},this);b.on("JpegDecode",function(a){if(this.destroyed)return Promise.reject("Worker was terminated");var b=a[0],c=a[1];return 3!==c&&1!==c?Promise.reject(Error("Only 3 components or 1 component can be returned")):new Promise(function(a,d){var f=new Image;f.onload=function(){var b=
f.width,d=f.height,g=b*d,h=4*g;g=new Uint8Array(g*c);var m=qa(b,d).getContext("2d");m.drawImage(f,0,0);m=m.getImageData(0,0,b,d).data;var n,p;if(3===c)for(p=n=0;n<h;n+=4,p+=3)g[p]=m[n],g[p+1]=m[n+1],g[p+2]=m[n+2];else if(1===c)for(p=n=0;n<h;n+=4,p++)g[p]=m[n];a({data:g,width:b,height:d})};f.onerror=function(){d(Error("JpegDecode failed to load image"))};f.src=b})},this)},getData:function(){return this.messageHandler.sendWithPromise("GetData",null)},getPage:function(a,b){if(0>=a||a>this.numPages||
(a|0)!==a)return Promise.reject(Error("Invalid page request"));var c=a-1;if(c in this.pagePromises)return this.pagePromises[c];a=this.messageHandler.sendWithPromise("GetPage",{pageIndex:c}).then(function(a){if(this.destroyed)throw Error("Transport destroyed");a=new Ja(c,a,this);return this.pageCache[c]=a}.bind(this));return this.pagePromises[c]=a},getPageIndex:function(a){return this.messageHandler.sendWithPromise("GetPageIndex",{ref:a})},getAnnotations:function(a,b){return this.messageHandler.sendWithPromise("GetAnnotations",
{pageIndex:a,intent:b})},getDestinations:function(){return this.messageHandler.sendWithPromise("GetDestinations",null)},getDestination:function(a){return this.messageHandler.sendWithPromise("GetDestination",{id:a})},getPageLabels:function(){return this.messageHandler.sendWithPromise("GetPageLabels",null)},getAttachments:function(){return this.messageHandler.sendWithPromise("GetAttachments",null)},getJavaScript:function(){return this.messageHandler.sendWithPromise("GetJavaScript",null)},getOutline:function(){return this.messageHandler.sendWithPromise("GetOutline",
null)},getMetadata:function(){return this.messageHandler.sendWithPromise("GetMetadata",null).then(function(a){return{info:a[0],metadata:a[1]?new V(a[1]):null}})},getStats:function(){return this.messageHandler.sendWithPromise("GetStats",null)},startCleanup:function(){this.messageHandler.sendWithPromise("Cleanup",null).then(function(){for(var a=0,b=this.pageCache.length;a<b;a++){var c=this.pageCache[a];c&&c.cleanup()}this.commonObjs.clear();this.fontLoader.clear()}.bind(this))}};return a}(),db=function(){function a(){this.objs=
Object.create(null)}a.prototype={ensureObj:function(a){if(this.objs[a])return this.objs[a];var b={capability:J(),data:null,resolved:!1};return this.objs[a]=b},get:function(a,b){if(b)return this.ensureObj(a).capability.promise.then(b),null;(b=this.objs[a])&&b.resolved||D("Requesting object that isn't resolved yet "+a);return b.data},resolve:function(a,b){a=this.ensureObj(a);a.resolved=!0;a.data=b;a.capability.resolve(b)},isResolved:function(a){var b=this.objs;return b[a]?b[a].resolved:!1},hasData:function(a){return this.isResolved(a)},
getData:function(a){var b=this.objs;return b[a]&&b[a].resolved?b[a].data:null},clear:function(){this.objs=Object.create(null)}};return a}(),Pb=function(){function a(a){this._internalRenderTask=a;this.onContinue=null}a.prototype={get promise(){return this._internalRenderTask.capability.promise},cancel:function(){this._internalRenderTask.cancel()},then:function(a,b){return this.promise.then.apply(this.promise,arguments)}};return a}(),qb=function(){function a(a,b,c,d,f,g){this.callback=a;this.params=
b;this.objs=c;this.commonObjs=d;this.operatorListIdx=null;this.operatorList=f;this.pageNumber=g;this.running=!1;this.graphicsReadyCallback=null;this.cancelled=this.useRequestAnimationFrame=this.graphicsReady=!1;this.capability=J();this.task=new Pb(this);this._continueBound=this._continue.bind(this);this._scheduleNextBound=this._scheduleNext.bind(this);this._nextBound=this._next.bind(this)}a.prototype={initalizeGraphics:function(a){if(!this.cancelled){ja("pdfBug")&&oa.StepperManager&&oa.StepperManager.enabled&&
(this.stepper=oa.StepperManager.create(this.pageNumber-1),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());var b=this.params;this.gfx=new aa(b.canvasContext,this.commonObjs,this.objs,b.imageLayer);this.gfx.beginDrawing(b.transform,b.viewport,a);this.operatorListIdx=0;this.graphicsReady=!0;this.graphicsReadyCallback&&this.graphicsReadyCallback()}},cancel:function(){this.running=!1;this.cancelled=!0;this.callback("cancelled")},operatorListChanged:function(){this.graphicsReady?
(this.stepper&&this.stepper.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound)},_continue:function(){this.running=!0;this.cancelled||(this.task.onContinue?this.task.onContinue.call(this.task,this._scheduleNextBound):this._scheduleNext())},_scheduleNext:function(){this.useRequestAnimationFrame&&"undefined"!==typeof window?window.requestAnimationFrame(this._nextBound):Promise.resolve(void 0).then(this._nextBound)},
_next:function(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),this.callback())))}};return a}(),rb=function(){var a=[];return{listen:function(b){I("Global UnsupportedManager.listen is used:  use PDFDocumentLoadingTask.onUnsupportedFeature instead");a.push(b)},notify:function(b){for(var c=
0,d=a.length;c<d;c++)a[c](b)}}}();a.version="1.5.188";a.build="0e2d50f";a.getDocument=function(a,b,c,d){var g=new Za;1<arguments.length&&I("getDocument is called with pdfDataRangeTransport, passwordCallback or progressCallback argument");b&&(b instanceof xa||(b=Object.create(b),b.length=a.length,b.initialData=a.initialData,b.abort||(b.abort=function(){})),a=Object.create(a),a.range=b);g.onPassword=c||null;g.onProgress=d||null;if("string"===typeof a)var h={url:a};else R(a)?h={data:a}:a instanceof xa?
h={range:a}:("object"!==typeof a&&D("Invalid parameter in getDocument, need either Uint8Array, string or a parameter object"),a.url||a.data||a.range||D("Invalid parameter object: need either .data, .range or .url"),h=a);var m={},n=null,p=null,q;for(q in h)if("url"===q&&"undefined"!==typeof window)m[q]=(new URL(h[q],window.location)).href;else if("range"===q)n=h[q];else if("worker"===q)p=h[q];else if("data"!==q||h[q]instanceof Uint8Array)m[q]=h[q];else{var r=h[q];"string"===typeof r?m[q]=fa(r):"object"!==
typeof r||null===r||isNaN(r.length)?R(r)?m[q]=new Uint8Array(r):D("Invalid PDF binary data: either typed array, string or array-like object is expected in the data property."):m[q]=new Uint8Array(r)}m.rangeChunkSize=m.rangeChunkSize||65536;p||(p=new ba,g._worker=p);var v=g.docId;p.promise.then(function(){if(g.destroyed)throw Error("Loading aborted");return f(p,m,n,v).then(function(a){if(g.destroyed)throw Error("Loading aborted");a=new t(v,a,p.port);var b=new Ka(a,g,n);g._transport=b;a.send("Ready",
null)})}).catch(g._capability.reject);return g};a.PDFDataRangeTransport=xa;a.PDFWorker=ba;a.PDFDocumentProxy=Sa;a.PDFPageProxy=Ja;a._UnsupportedManager=rb});(function(a,b){b(a.pdfjsDisplayGlobal={},a.pdfjsSharedUtil,a.pdfjsDisplayDOMUtils,a.pdfjsDisplayAPI,a.pdfjsDisplayAnnotationLayer,a.pdfjsDisplayTextLayer,a.pdfjsDisplayMetadata,a.pdfjsDisplaySVG)})(this,function(a,b,c,d,m,n,r,A){var f=b.globalScope,g=b.deprecated,h=b.warn,q=c.LinkTarget,w="undefined"===typeof window;f.PDFJS||(f.PDFJS={});var p=
f.PDFJS;p.version="1.5.188";p.build="0e2d50f";p.pdfBug=!1;void 0!==p.verbosity&&b.setVerbosityLevel(p.verbosity);delete p.verbosity;Object.defineProperty(p,"verbosity",{get:function(){return b.getVerbosityLevel()},set:function(a){b.setVerbosityLevel(a)},enumerable:!0,configurable:!0});p.VERBOSITY_LEVELS=b.VERBOSITY_LEVELS;p.OPS=b.OPS;p.UNSUPPORTED_FEATURES=b.UNSUPPORTED_FEATURES;p.isValidUrl=b.isValidUrl;p.shadow=b.shadow;p.createBlob=b.createBlob;p.createObjectURL=function(a,c){return b.createObjectURL(a,
c,p.disableCreateObjectURL)};Object.defineProperty(p,"isLittleEndian",{configurable:!0,get:function(){var a=b.isLittleEndian();return b.shadow(p,"isLittleEndian",a)}});p.removeNullCharacters=b.removeNullCharacters;p.PasswordResponses=b.PasswordResponses;p.PasswordException=b.PasswordException;p.UnknownErrorException=b.UnknownErrorException;p.InvalidPDFException=b.InvalidPDFException;p.MissingPDFException=b.MissingPDFException;p.UnexpectedResponseException=b.UnexpectedResponseException;p.Util=b.Util;
p.PageViewport=b.PageViewport;p.createPromiseCapability=b.createPromiseCapability;p.maxImageSize=void 0===p.maxImageSize?-1:p.maxImageSize;p.cMapUrl=void 0===p.cMapUrl?null:p.cMapUrl;p.cMapPacked=void 0===p.cMapPacked?!1:p.cMapPacked;p.disableFontFace=void 0===p.disableFontFace?!1:p.disableFontFace;p.imageResourcesPath=void 0===p.imageResourcesPath?"":p.imageResourcesPath;p.disableWorker=void 0===p.disableWorker?!1:p.disableWorker;p.workerSrc=void 0===p.workerSrc?null:p.workerSrc;p.disableRange=void 0===
p.disableRange?!1:p.disableRange;p.disableStream=void 0===p.disableStream?!1:p.disableStream;p.disableAutoFetch=void 0===p.disableAutoFetch?!1:p.disableAutoFetch;p.pdfBug=void 0===p.pdfBug?!1:p.pdfBug;p.postMessageTransfers=void 0===p.postMessageTransfers?!0:p.postMessageTransfers;p.disableCreateObjectURL=void 0===p.disableCreateObjectURL?!1:p.disableCreateObjectURL;p.disableWebGL=void 0===p.disableWebGL?!0:p.disableWebGL;p.externalLinkTarget=void 0===p.externalLinkTarget?q.NONE:p.externalLinkTarget;
p.externalLinkRel=void 0===p.externalLinkRel?"noreferrer":p.externalLinkRel;p.isEvalSupported=void 0===p.isEvalSupported?!0:p.isEvalSupported;var B=p.openExternalLinksInNewWindow;delete p.openExternalLinksInNewWindow;Object.defineProperty(p,"openExternalLinksInNewWindow",{get:function(){return p.externalLinkTarget===q.BLANK},set:function(a){a&&g('PDFJS.openExternalLinksInNewWindow, please use "PDFJS.externalLinkTarget = PDFJS.LinkTarget.BLANK" instead.');p.externalLinkTarget!==q.NONE?h("PDFJS.externalLinkTarget is already initialized"):
p.externalLinkTarget=a?q.BLANK:q.NONE},enumerable:!0,configurable:!0});B&&(p.openExternalLinksInNewWindow=B);p.getDocument=d.getDocument;p.PDFDataRangeTransport=d.PDFDataRangeTransport;p.PDFWorker=d.PDFWorker;Object.defineProperty(p,"hasCanvasTypedArrays",{configurable:!0,get:function(){var a=c.hasCanvasTypedArrays();return b.shadow(p,"hasCanvasTypedArrays",a)}});p.CustomStyle=c.CustomStyle;p.LinkTarget=q;p.addLinkAttributes=c.addLinkAttributes;p.getFilenameFromUrl=c.getFilenameFromUrl;p.isExternalLinkTargetSet=
c.isExternalLinkTargetSet;p.AnnotationLayer=m.AnnotationLayer;p.renderTextLayer=n.renderTextLayer;p.Metadata=r.Metadata;p.SVGGraphics=A.SVGGraphics;p.UnsupportedManager=d._UnsupportedManager;a.globalScope=f;a.isWorker=w;a.PDFJS=f.PDFJS})}).call(b);d.PDFJS=b.pdfjsDisplayGlobal.PDFJS;d.build=b.pdfjsDisplayAPI.build;d.version=b.pdfjsDisplayAPI.version;d.getDocument=b.pdfjsDisplayAPI.getDocument;d.PDFDataRangeTransport=b.pdfjsDisplayAPI.PDFDataRangeTransport;d.PDFWorker=b.pdfjsDisplayAPI.PDFWorker;d.renderTextLayer=
b.pdfjsDisplayTextLayer.renderTextLayer;d.AnnotationLayer=b.pdfjsDisplayAnnotationLayer.AnnotationLayer;d.CustomStyle=b.pdfjsDisplayDOMUtils.CustomStyle;d.PasswordResponses=b.pdfjsSharedUtil.PasswordResponses;d.InvalidPDFException=b.pdfjsSharedUtil.InvalidPDFException;d.MissingPDFException=b.pdfjsSharedUtil.MissingPDFException;d.SVGGraphics=b.pdfjsDisplaySVG.SVGGraphics;d.UnexpectedResponseException=b.pdfjsSharedUtil.UnexpectedResponseException;d.OPS=b.pdfjsSharedUtil.OPS;d.UNSUPPORTED_FEATURES=b.pdfjsSharedUtil.UNSUPPORTED_FEATURES;
d.isValidUrl=b.pdfjsSharedUtil.isValidUrl;d.createObjectURL=b.pdfjsSharedUtil.createObjectURL;d.removeNullCharacters=b.pdfjsSharedUtil.removeNullCharacters;d.shadow=b.pdfjsSharedUtil.shadow;d.createBlob=b.pdfjsSharedUtil.createBlob;d.getFilenameFromUrl=b.pdfjsDisplayDOMUtils.getFilenameFromUrl;d.addLinkAttributes=b.pdfjsDisplayDOMUtils.addLinkAttributes});(function(d){d.zoomWhiteboard=function(){return{init:function(){if(null==document.querySelector(" .zoomControler")){var c=document.querySelector("#virtualclassAppLeftPanel");if(null!=c){var b=virtualclass.getTemplate("zoomControl")({hasControls:roles.hasControls()});c.insertAdjacentHTML("beforeend",b);this._initScaleController();c=localStorage.getItem("wbcScale");null!=c&&(this.canvasScale=c,console.log("Canvas pdf scale "+this.canvasScale))}}(c=document.querySelector("#virtualclassAppLeftPanel .zoomControler .reloadNote span"))&&
("Whiteboard"==virtualclass.currApp?c.setAttribute("data-title","Reload whiteboard"):c.setAttribute("data-title",virtualclass.lang.getString("reloadDoc")))},_initScaleController:function(){var c=document.querySelector(".zoomControler"),b=this;b=this;c.querySelector(".zoomIn").addEventListener("click",function(){b.zoomAction("zoomIn")});c.querySelector(".zoomOut").addEventListener("click",function(){b.zoomAction("zoomOut")});c.querySelector(".fitScreen").addEventListener("click",function(){b.zoomAction("fitToScreen")});
c.querySelector(".reloadNote").addEventListener("click",function(){b.zoomAction("reload")})},zoomAction:function(c){var b=this;virtualclass.gObj.hasOwnProperty("zoomActionTime")&&clearTimeout(virtualclass.gObj.zoomActionTime);virtualclass.gObj.zoomActionTime=setTimeout(function(){"ScreenShare"==virtualclass.currApp?virtualclass.studentScreen[c].call(virtualclass.studentScreen):b[c].call(b)},200)},zoomIn:function(c){var b=virtualclass.gObj.currWb;if("object"==typeof virtualclass.wb[b]){var a=virtualclass.wb[b].vcan.main.canvas;
this.prvCanvasScale=this.canvasScale;this.canvasScale*=SCALE_FACTOR;console.log("Canvas pdf scale "+this.canvasScale);var d=virtualclass.vutil.getWidth(a)*SCALE_FACTOR,g=virtualclass.vutil.getHeight(a)*SCALE_FACTOR;"undefined"!=typeof c?virtualclass.pdfRender[b]._zoom.call(virtualclass.pdfRender[b],a,d,g,c):virtualclass.pdfRender[b]._zoom.call(virtualclass.pdfRender[b],a,d,g)}},zoomOut:function(){var c=virtualclass.gObj.currWb,b=virtualclass.wb[c].vcan.main.canvas,a=b.parentNode,d=b.parentNode.offsetWidth;
this.prvCanvasScale=this.canvasScale;this.canvasScale/=SCALE_FACTOR;console.log("Canvas pdf scale "+this.canvasScale);var g=virtualclass.vutil.getWidth(b)*(1/SCALE_FACTOR),h=virtualclass.vutil.getHeight(b)*(1/SCALE_FACTOR);g<=d&&a.classList.remove("scrollX");virtualclass.pdfRender[c]._zoomOut.call(virtualclass.pdfRender[c],b,g,h)},fitToScreen:function(){var c=virtualclass.gObj.currWb;if("undefined"!=typeof virtualclass.pdfRender[c]){var b=virtualclass.pdfRender[c].page,a=virtualclass.wb[virtualclass.gObj.currWb].vcan.main.canvas,
f=document.querySelector("#virtualclassCont");f=(null!=f?f.offsetWidth:d.innerWidth)-380;try{var g=b.getViewport((+f-100)/b.getViewport(1).width);this.prvCanvasScale=this.canvasScale;this.canvasScale=g.scale;console.log("Canvas pdf scale "+this.canvasScale);virtualclass.pdfRender[c]._fitToScreen.call(virtualclass.pdfRender[c],a,f,a.height)}catch(h){console.log("Error "+h)}}},reload:function(){virtualclass.zoom.normalRender()},normalRender:function(){"object"==typeof virtualclass.pdfRender[virtualclass.gObj.currWb].shownPdf&&
(null!=virtualclass.zoom.canvasScale?(virtualclass.zoom.canvasScale/=SCALE_FACTOR,console.log("Canvas pdf scale "+this.canvasScale),virtualclass.zoom.zoomIn("normalRender")):console.log("canvasScale is not defined yet."))},removeZoomController:function(){var c=document.querySelector("#virtualclassApp .zoomControler");null!=c&&c.parentNode.removeChild(c)}}}})(window);(function(d){d.pdfRender=function(){return{firstTime:!0,shownPdf:"",canvasWrapper:null,canvasId:null,canvas:null,pdfScale:1,url:"",init:function(c,b){console.log("PDF render init");var a=document.querySelector("#virtualclassCont");null!=a&&(a.classList.add("pdfRendering"),console.log("Add pdf rendering"));io.globallock=!1;virtualclass.gObj.firstNormalRender=!1;this.url="undefined"!=typeof b?virtualclass.dts.getNote(b).pdf:whiteboardPath+"example/sample.pdf";this.canvasWrapper=document.querySelector("#canvasWrapper"+
virtualclass.gObj.currWb);this.canvas=c;var d=this,g={};g.url=this.url;g.withCredentials=!0;g.disableAutoFetch=!0;virtualclass.gObj.hasOwnProperty("getDocumentTimeout")&&clearTimeout(virtualclass.gObj.getDocumentTimeout);virtualclass.gObj.getDocumentTimeout=setTimeout(function(){console.log("PDF render initiate 1");PDFJS.getDocument(g).then(function(a){d.displayPage(a,1,function(){},!0);d.shownPdf=a});roles.hasControls()||(d.topPosY=0,d.leftPosX=0);d.scrollEvent()},1E3)},updateScrollPosition:function(c,
b){"object"==typeof this.scroll[b]&&this.scroll[b].hasOwnProperty("b")?(this.scroll[b].b=c,this.scroll[b].c=this.scroll[b].b+this.scroll[b].studentVPm):console.log("Scroll b is undefined")},scrollEvent:function(){var c=this.canvasWrapper,b=c.scrollTop,a=c.scrollLeft;virtualclass.topPosY=b;virtualclass.leftPosX=a;this.topPosY=b;this.leftPosX=a;var d=this;c.onscroll=function(){d.onScroll(c)}},onScroll:function(c,b){b=c.scrollTop;var a=c.scrollLeft;0<b&&this._scroll(a,b,c,"Y");0<a&&this._scroll(a,b,
c,"X");roles.hasControls()||virtualclass.pdfRender[virtualclass.gObj.currWb].setScrollPosition({scX:a,scY:b})},_scroll:function(c,b,a,d){if(roles.hasControls())return this.topPosY=b,this.leftPosX=c,this.scrollPosition(a,d);if("Y"==d)var f=b;else"X"==d&&(f=c);this.updateScrollPosition(f,d);return null},scrollPosition:function(c,b){var a=this.canvas;if("Y"==b)var d=c.scrollTop,g=a.height;else"X"==b&&(d=c.scrollLeft,g=a.width);this["scrollPos"+b]=d/g*100;c=virtualclass.vutil.getElemM("canvasWrapper"+
virtualclass.gObj.currWb,b);this["actualVp"+b]=c;this["viewPort"+b]=c/g*100;g={};g["vp"+b]=this["viewPort"+b];g["sc"+b]=this["scrollPos"+b];return g},scroll:{caclculatePosition:function(c,b,a){c=this.type=a;null==this[c]&&(this[c]={});this[c].a=0;this[c].d=b;b="canvasWrapper"+virtualclass.gObj.currWb;a=document.querySelector("#"+b);null!=a&&("X"==this.type?this[c].b=a.scrollLeft:"Y"==this.type&&(this[c].b=a.scrollTop),this[c].studentVPm=virtualclass.vutil.getElemM(b,c),this[c].c=this[c].b+this[c].studentVPm)}},
setScrollPosition:function(c){c.hasOwnProperty("scY")&&null!=c.scY&&this.scroll.caclculatePosition(c.scY,this.canvas.height,"Y");c.hasOwnProperty("scX")&&null!=c.scX&&this.scroll.caclculatePosition(c.scX,this.canvas.width,"X")},customMoustPointer:function(c,b,a){this.scroll[b].e=a;this.scroll[b].e>this.scroll[b].c?(c=this.scroll[b].b+(this.scroll[b].d-this.scroll[b].c),c>this.scroll[b].e&&(c=this.scroll[b].e-(this.scroll[b].b+this.scroll[b].c)/2),console.log("custom mouse down pointer ay="+this.scroll[b].a+
" by="+this.scroll[b].b+" cy="+this.scroll[b].c+" dy="+this.scroll[b].d+" ey"+this.scroll[b].e+" scrollPos="+c),"Y"==b?this.canvasWrapper.scrollTop=c:(this.canvasWrapper.scrollLeft=c,console.log("Scroll left "+this.canvasWrapper.scrollLeft)),this.scroll[b].b=c,this.scroll[b].c=this.scroll[b].b+this.scroll[b].studentVPm):this.scroll[b].e<this.scroll[b].b&&(c=this.scroll[b].b-this.scroll[b].a,this.scroll[b].c-c<this.scroll[b].e&&(c=(this.scroll[b].b+this.scroll[b].c)/2-this.scroll[b].e),"Y"==b?this.canvasWrapper.scrollTop-=
c:this.canvasWrapper.scrollLeft-=c,this.scroll[b].b=c,this.scroll[b].c=this.scroll[b].b+this.scroll[b].studentVPm)},setCustomMoustPointer:function(c,b){var a="scrollDiv"+b+virtualclass.gObj.currWb,d=document.querySelector("#"+a+"mousePointer");null==d&&(d=document.createElement("div"),d.className="mousepointer",d.id=a+"mousePointer",a=document.querySelector("#scrollDiv"+b+virtualclass.gObj.currWb),null!=a&&a.appendChild(d));"Y"==b?d.style.top=c.y-this.scroll[b].a+"px":"X"==b&&(d.style.left=c.x-this.scroll[b].a+
"px")},sendScroll:function(){virtualclass.vutil.setDefaultScroll();console.log("Send scroll to everyone ")},sendCurrentScroll:function(c){var b={};if(null!=this.currentScroll){b=Object.assign(b,this.currentScroll);console.log("Send scroll first time "+this.currentScroll);var a=this;a.currentScrolltoUser=c;setTimeout(function(){a.currentScrolltoUser=c;b.cf="scf";b.toUser=c;virtualclass.vutil.beforeSend({toUser:c,cf:"scf",scY:b.scY,vpY:b.vpY},c);console.log("Send scroll "+b+"to user "+c);console.log("Send scroll "+
b)},2E3)}},renderPage:function(c,b){if(null!=virtualclass.gObj.currWb){var a=this.pdfScale;null!=virtualclass.zoom.canvasScale&&""!=virtualclass.zoom.canvasScale&&(0<virtualclass.zoom.canvasScale?a=virtualclass.zoom.canvasScale:console.log("Why negative value"));var d=virtualclass.gObj.currWb,g=virtualclass.wb[d].vcan.main.canvas;if(this.firstTime){var h=this.calculateScaleAtFirst(c,g);virtualclass.zoom.prvCanvasScale=virtualclass.zoom.canvasScale;null==virtualclass.zoom.canvasScale?virtualclass.zoom.canvasScale=
h.scale:h=c.getViewport(a)}else h=c.getViewport(a);a=g.getContext("2d");g.height=h.height;g.width=h.width+80;console.log("Pdf Canvas width "+g.width);console.log("Pdf Canvas height "+g.height);var m=this;c.render({canvasContext:a,viewport:h}).then(function(){console.log("PDF rendered actual 2");var a=g.toDataURL("image/jpeg");g.style.background="url("+a+")";g.parentNode.dataset.pdfrender=!0;g.style.backgroundRepeat="no-repeat";m[d]={pdfrender:!0};void 0!=b&&setTimeout(function(){m.initWhiteboardData(virtualclass.gObj.currWb);
document.querySelector("#virtualclassCont")},500);displayCb();"object"==typeof m.shownPdf?setTimeout(function(){io.globallock=!1;io.onRecJson(null);virtualclass.gObj.hasOwnProperty("pdfNormalTimeout")&&clearTimeout(virtualclass.gObj.pdfNormalTimeout);virtualclass.gObj.firstNormalRender||(virtualclass.gObj.pdfNormalTimeout=setTimeout(function(){console.log("pdfNormal render");null!=document.querySelector("#canvas"+virtualclass.gObj.currWb)&&(virtualclass.zoom.normalRender(),virtualclass.gObj.firstNormalRender=
!0,virtualclass.pdfRender[virtualclass.gObj.currWb].setScrollPosition({scX:1,scY:1}))},10));virtualclass.vutil.removeClass("virtualclassCont","resizeWindow")},10):console.log("We should have a PDF here")})}},displayPage:function(c,b,a,d){displayCb=a;var f=this;c.getPage(b).then(function(a){console.log("PDF is being rendered first time");f.page=a;"undefined"!=typeof d?f.renderPage(a,d):f.renderPage(a)})},initWhiteboardData:function(c){console.log("Init whiteboard with timeout");if("object"==typeof virtualclass.gObj.tempReplayObjs[c])if(0>=
virtualclass.gObj.tempReplayObjs[c].length){var b=this;setTimeout(function(){b.initWhiteboardData(c)},500)}else console.log("Pdf test, init whiteboard "),console.log("Start whiteboard replay from local storage"),virtualclass.wb[c].utility.replayFromLocalStroage(virtualclass.gObj.tempReplayObjs[c]),virtualclass.vutil.removeClass("virtualclassCont","pdfRendering");else virtualclass.storage.getWbData(c,function(){"object"==typeof virtualclass.gObj.tempReplayObjs[c]&&0<virtualclass.gObj.tempReplayObjs[c].length&&
(console.log("Start whiteboard replay from local storage"),virtualclass.wb[c].utility.replayFromLocalStroage(virtualclass.gObj.tempReplayObjs[c]))}),setTimeout(function(){virtualclass.vutil.removeClass("virtualclassCont","pdfRendering")},500)},_zoom:function(c,b,a,d){virtualclass.vutil.setHeight(virtualclass.gObj.currWb,c,a);virtualclass.vutil.setWidth(virtualclass.gObj.currWb,c,b);c=c.parentNode;a=virtualclass.vutil.getValueWithoutPixel(c.style.width);b>a&&c.classList.add("scrollX");var f=this;this.displayPage(this.shownPdf,
1,function(){if("undefined"==typeof d)for(wid in console.log("Zooming whiteboard"),virtualclass.pdfRender)f.zoomwhiteboardObjects(wid);else virtualclass.wb[virtualclass.gObj.currWb].vcan.renderAll()})},zoomwhiteboardObjects:function(c){var b=virtualclass.wb[c].vcan,a=b.main.children;if(0==a.length)virtualclass.wb[c].scale=null!=virtualclass.wb[c].scale?virtualclass.wb[c].scale*SCALE_FACTOR:1*SCALE_FACTOR;else for(var d in a){var g=a[d].scaleX*SCALE_FACTOR,h=a[d].scaleY*SCALE_FACTOR,m=a[d].x*SCALE_FACTOR,
n=a[d].y*SCALE_FACTOR;a[d].scaleX=g;a[d].scaleY=h;a[d].x=m;a[d].y=n;virtualclass.wb[c].scale=g;a[d].setCoords()}b.renderAll()},_zoomOut:function(c,b,a,d){virtualclass.vutil.setHeight(virtualclass.gObj.currWb,c,a);virtualclass.vutil.setWidth(virtualclass.gObj.currWb,c,b);var f=this;this.displayPage(this.shownPdf,1,function(){for(wid in virtualclass.pdfRender)f.zoomOutWhiteboardObjects(wid)})},zoomOutWhiteboardObjects:function(c){var b=virtualclass.wb[c].vcan,a=b.main.children,d;for(d in a){var g=1/
SCALE_FACTOR*a[d].scaleX,h=1/SCALE_FACTOR*a[d].scaleY,m=1/SCALE_FACTOR*a[d].x,n=1/SCALE_FACTOR*a[d].y;a[d].scaleX=g;a[d].scaleY=h;a[d].x=m;a[d].y=n;a[d].setCoords();virtualclass.wb[c].scale=g}b.renderAll()},_fitToScreen:function(c,b,a){virtualclass.vutil.setHeight(virtualclass.gObj.currWb,c,a);virtualclass.vutil.setWidth(virtualclass.gObj.currWb,c,b);var d=c.parentNode,g=virtualclass.vutil.getValueWithoutPixel(d.style.width),h=this;this.displayPage(this.shownPdf,1,function(){for(wid in virtualclass.pdfRender)h.fitToScreenWhiteboardObjects(wid)});
setTimeout(function(){b>g&&55<b-g?d.classList.add("scrollX"):d.classList.remove("scrollX")},500)},fitToScreenWhiteboardObjects:function(c){if("object"==typeof virtualclass.wb[c]){var b=virtualclass.wb[c].vcan,a=b.main.children;if(0<a.length)for(var d in a){var g=a[d].scaleX,h=a[d].scaleY,m=1*virtualclass.zoom.canvasScale/(1*virtualclass.zoom.prvCanvasScale),n=a[d].x*m,r=a[d].y*m;a[d].scaleX=g*m;a[d].scaleY=h*m;a[d].x=n;a[d].y=r;a[d].setCoords();virtualclass.wb[c].scale=g}b.renderAll()}else console.log("Whiteboard missing")},
isBiggerCanvasHeight:function(c){},isBiggerCanvasWidth:function(c){},calculateScaleAtFirst:function(c,b){b=document.querySelector("#virtualclassCont");c=c.getViewport(+((null!=b?b.offsetWidth:d.innerWidth)-480)/c.getViewport(1).width);this.firstTime=!1;return c},isWhiteboardAlreadyExist:function(c){return null!=this.canvas},defaultScroll:function(){alert("hello guys");null!=virtualclass.gObj.currWb&&(this.canvasWrapper.scrollTop=1)}}}})(window);(function(d){var c={initNavHandler:function(){var b=this,a=document.querySelector("#virtualclassWhiteboard.whiteboard .next");null!=a&&(a.onclick=function(){virtualclass.vutil.navWhiteboard(b,b.next);c.hasOwnProperty("setNextWhiteboardTime")&&clearTimeout(c.setNextWhiteboardTime);"Whiteboard"==virtualclass.currApp&&(c.setNextWhiteboardTime=setTimeout(function(){var a=document.querySelector(".zoomControler .fitScreen");null!=a&&a.click()},500))});a=document.querySelector("#virtualclassWhiteboard.whiteboard .prev");
null!=a&&(a.onclick=function(){virtualclass.vutil.navWhiteboard(b,b.prev);"object"==typeof virtualclass.wb[virtualclass.gObj.currWb]&&setTimeout(function(){console.log("whiteboard zoom normal render");virtualclass.zoom.normalRender()},200)})},displaySlide:function(b){this.hideElement();var a=document.querySelector("#note"+b);null!=a&&(a.classList.add("current"),virtualclass.gObj.currWb=b);this.identifyFirstNote(b)},hideElement:function(){var b=document.querySelector("#virtualclassWhiteboard.whiteboard .current");
null!=b&&(console.log("Whiteboard slide remove"),b.classList.remove("current"))},currentWhiteboard:function(b){null==document.querySelector("#canvas"+b)&&(this.hideElement(),virtualclass.vutil.createWhiteBoard(b),this.displaySlide(b),virtualclass.gObj.currWb=b)},next:function(){this.hideElement();var b=this.whiteboardWrapperExist("next");null==b?(virtualclass.gObj.wbCount++,virtualclass.gObj.wIds.push(virtualclass.gObj.wbCount),b="_doc_0_"+virtualclass.gObj.wbCount,this.whiteboardExist(b)||virtualclass.vutil.createWhiteBoard(b),
virtualclass.vutil.beforeSend({cf:"cwb",wbCount:virtualclass.gObj.wbCount})):(this.whiteboardExist(b)||virtualclass.vutil.createWhiteBoard(b),virtualclass.vutil.beforeSend({cf:"cwb",diswb:!0,wid:b}));this.setCurrSlideNumber(b);this.displaySlide(b);virtualclass.gObj.currWb=b},setCurrSlideNumber:function(b){b=b.split("_");0<b.length&&(virtualclass.gObj.currSlide=b[b.length-1])},prev:function(){this.hideElement();var b=this.whiteboardWrapperExist("prev");null!=b?(this.whiteboardExist(b)||virtualclass.vutil.createWhiteBoard(b),
this.displaySlide(b),virtualclass.gObj.currWb=b,virtualclass.vutil.beforeSend({cf:"cwb",diswb:!0,wid:virtualclass.gObj.currWb}),console.log("whiteboard slide send="+virtualclass.gObj.currWb)):alert("Elemennt is NULL");this.setCurrSlideNumber(b)},whiteboardExist:function(b){return null!=document.querySelector("#canvas"+b)},whiteboardWrapperExist:function(b){var a=virtualclass.gObj.currWb;if(null!=a){a=document.querySelector("#note"+a);if("prev"==b)var c=a.previousElementSibling;else"next"==b&&(c=a.nextElementSibling);
return null!=c?c.dataset.wbId:null}},readyElements:function(b){for(var a=document.querySelector("#virtualclassWhiteboard .whiteboardContainer"),c,d=0;d<b.length;d++){var h="_doc_0_"+b[d];c=document.querySelector("#note"+h);null==c&&(c=document.createElement("div"),c.id="note"+h,c.dataset.wbId=h,c.className="canvasContainer",a.appendChild(c))}},reArrangeElements:function(b){var a=document.querySelector("#virtualclassWhiteboard .whiteboardContainer"),c=document.createElement("div");c.className="whiteboardContainer";
for(var d,h=0;h<b.length;h++)d="note_doc_0_"+b[h],d=document.getElementById(d),null!=c&&null!=d?c.appendChild(d):console.log("Error temp div is null "+c);a.parentNode.replaceChild(c,a)},identifyFirstNote:function(b){var a=document.querySelector("#virtualclassWhiteboard");"_doc_0_0"==b?a.classList.add("firstNote"):a.classList.remove("firstNote")},removeAllContainers:function(){for(var b=document.querySelectorAll("#virtualclassWhiteboard .whiteboardContainer .canvasContainer"),a,c=0;c<b.length;c++)a=
b[c],a.parentNode.removeChild(a)}};d.wbCommon=c})(window);var serverData={rawData:{video:[],ppt:[],docs:[]},fetchAllData:function(d){console.log("Fetch all data");this.cb=d;this.requestData(virtualclass.api.GetDocumentURLs)},requestData:function(d){this.rawData={video:[],ppt:[],docs:[]};var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.open("POST",d);var b=this;c.onreadystatechange=function(){3<c.readyState&&200==c.status&&b.afterResponse(c.responseText)};c.setRequestHeader("x-api-key",wbUser.lkey);c.setRequestHeader("x-congrea-authuser",
wbUser.auth_user);c.setRequestHeader("x-congrea-authpass",wbUser.auth_pass);c.setRequestHeader("x-congrea-room",wbUser.room);c.setRequestHeader("Content-Type","application/json");c.send(null)},afterResponse:function(d){"ERROR"!=d&&(virtualclass.serverData.formatRawData(d),virtualclass.gObj.fetchedData=!0,"undefined"!=typeof virtualclass.serverData.cb&&virtualclass.serverData.cb())},formatRawData:function(d){d=JSON.parse(d);this.awsUrlArr(d)},awsUrlArr:function(d){this.rawData={video:[],ppt:[],docs:[]};
var c=[];d=d.Items;for(var b,a,f,g,h=0;h<d.length;h++)if(d[h].hasOwnProperty("filetype"))switch(d[h].filetype.S){case "doc":var m=this.processObj(d[h]);g=d[h].processed_data.M.commonpath.S;var n=parseInt(d[h].processed_data.M.count.N);if(null!=g&&null!=n){g="https://media.congrea.net/"+d[h].processed_data.M.commonpath.S;m.notes={};m.notesarr=[];var r=[],A=[];m.hasOwnProperty("deletednes")&&(r=m.deletednes);m.hasOwnProperty("disablednes")&&(A=m.disablednes);for(var z=1;z<=n;z++){b=z;a=3-(""+b).length;
f=(0<a?Array(++a).join("0"):"")+b;b=g+"/image/"+f+"."+d[h].processed_data.M.image.M.type.S;a=g+"/pdf/"+f+".pdf";f=g+"/thumbnail/"+f+"."+d[h].processed_data.M.thumbnail.M.type.S;var t=99<z?m.fileuuid+"_"+z:9<z?m.fileuuid+"_0"+z:m.fileuuid+"_00"+z;var v={};0<r.length&&-1<r.indexOf(z)&&(v.deletedn=t);v.id=t;v.pdf=a;v.image=b;v.thumbnail=f;0<A.length?-1<A.indexOf(z)?v.status=0:v.status=1:v.status=1;m.notes[t]=v;m.notesarr.push(v)}c.push(m);this.rawData.docs.push(m)}break;case "video":null!=d[h].processed_data&&
"COMPLETED"==d[h].processed_data.S&&(m=this.processObj(d[h]),n=m.filepath.substr(0,m.filepath.lastIndexOf("/")),m.urls={},m.urls.thumbnail={},m.urls.videos={},m.urls.main_video="https://media.congrea.net/"+n+"/video/play_video.m3u8",m.urls.videos["0400k"]="https://media.congrea.net/"+n+"/video/0400k/video.m3u8",m.urls.videos["0600k"]="https://media.congrea.net/"+n+"/video/0600k/video.m3u8",m.urls.videos["1000k"]="https://media.congrea.net/"+n+"/video/1000k/video.m3u8",m.urls.videos["1500k"]="https://media.congrea.net/"+
n+"/video/1500k/video.m3u8",m.urls.videos["2000k"]="https://media.congrea.net/"+n+"/video/2000k/video.m3u8",m.urls.thumbnail["0400k"]="https://media.congrea.net/"+n+"/video/0400k/thumbs/00001.png",m.urls.thumbnail["0600k"]="https://media.congrea.net/"+n+"/video/0600k/thumbs/00001.png",m.urls.thumbnail["1000k"]="https://media.congrea.net/"+n+"/video/1000k/thumbs/00001.png",m.urls.thumbnail["1500k"]="https://media.congrea.net/"+n+"/video/1500k/thumbs/00001.png",m.urls.thumbnail["2000k"]="https://media.congrea.net/"+
n+"/video/2000k/thumbs/00001.png",c.push(m),this.rawData.video.push(m));break;case "video_yts":console.log("Handle youtube");m=this.processVidUrlObj(d[h]);m.urls={};m.urls.main_video=m.URL;c.push(m);this.rawData.video.push(m);break;case "presentation":console.log("presentation data");m=this.processVidUrlObj(d[h]);m.urls={};m.urls.presentation=m.URL;c.push(m);this.rawData.ppt.push(m);break;case "video_online":console.log("Handle one line "),m=this.processVidUrlObj(d[h]),m.urls={},m.urls.main_video=
m.URL,c.push(m),this.rawData.video.push(m)}virtualclass.awsData=c},processObj:function(d){var c={};c.filename=d.filename.S;c.filepath=d.filepath.S;c.filetype=d.filetype.S;c.fileuuid=d.fileuuid.S;c.key_room=d.key_room.S;c.fileuuid=d.fileuuid.S;d.hasOwnProperty("deleted")&&("0"==d.deleted.NS[0]?c.deleted=d.deleted.NS[0]:c.deletednes=d.deleted.NS);d.hasOwnProperty("disabled")&&("0"==d.disabled.NS[0]?c.disabled=d.disabled.NS[0]:c.disablednes=d.disabled.NS);return c},processVidUrlObj:function(d){var c=
{};c.URL=d.URL.S;c.filename=c.URL;c.filetype=d.filetype.S;c.fileuuid=d.fileuuid.S;c.key_room=d.key_room.S;c.fileuuid=d.fileuuid.S;d.hasOwnProperty("deleted")&&(c.deleted=d.deleted.NS[0]);d.hasOwnProperty("disabled")&&(c.disabled=d.disabled.NS[0]);return c},pollingStatus:function(d){var c=virtualclass.api.GetDocumentStatus;virtualclass.gObj.hasOwnProperty("pollingDocumentStatus")&&clearTimeout(virtualclass.gObj.pollingDocumentStatus);var b=this;virtualclass.gObj.pollingDocumentStatus=setTimeout(function(){virtualclass.xhrn.sendData({uuid:virtualclass.gObj.file.uuid},
c,function(a){a=JSON.parse(a).Item;void 0!=a&&"undefined"!=typeof a&&(a.hasOwnProperty("processed_data")&&(a.processed_data.hasOwnProperty("S")&&"COMPLETED"==a.processed_data.S||a.processed_data.hasOwnProperty("M")&&a.processed_data.M.hasOwnProperty("pdf"))?(clearTimeout(virtualclass.gObj.pollingDocumentStatus),virtualclass.serverData.fetchAllData(d)):b.pollingStatus(d))})},5E3)}};var api={access:"https://api.congrea.net/data/access",upload:"https://api.congrea.net/t/upload",uploadSuccess:"https://api.congrea.net/t/uploadSuccess",uploadMedia:"https://uploadmedia.congrea.net",UpdateDocumentStatus:"https://api.congrea.net/t/UpdateDocumentStatus",GetDocumentURLs:"https://api.congrea.net/t/GetDocumentURLs",UpdateRoomMetaData:"https://api.congrea.net/t/UpdateRoomMetaData",GetRoomMetaData:"https://api.congrea.net/t/GetRoomMetaData",addURL:"https://api.congrea.net/t/addURL",GetDocumentStatus:"https://api.congrea.net/t/GetDocumentStatus"};(function(d,c){d.raiseHand=function(b){return{stdRhEnable:"enabled",rhCount:0,rhCountR:0,init:function(a){this.stdRhEnable="enabled";roles.hasControls()||(this.attachHandlerAtStudent(),this.stdRhEnable&&"disabled"==this.stdRhEnable&&(c.querySelector("#virtualclassCont.congrea #icHr").setAttribute("data-action","disable"),a=c.querySelector("#virtualclassCont.congrea #congHr"),a.classList.remove("enable"),a.classList.add("disable"),a.setAttribute("data-title",virtualclass.lang.getString("RaiseHandStdDisabled"))))},
disableRaiseHand:function(a){var b=c.getElementById(a+"contRaiseH");ioAdapter.mustSendUser({data:{action:"disable"},cf:"raiseHand"},a);b.classList.remove("enabled");b.classList.add("disabled");c.getElementById(a+"contrRaiseHandImg").setAttribute("data-raisehand-disable",!0);c.getElementById(a+"contRaiseAnch").setAttribute("data-title","disabled");b.style.pointerEvents="none";virtualclass.user.control.updateUser(a,"raiseHand",!1);virtualclass.raiseHand.moveDownInList(a);this.rhCount--;this.rhCount||
c.querySelector("#user_list .hand_bt").classList.remove("highlight");a=c.querySelector("#user_list .hand_bt  #notifyText");0<this.rhCount?a.innerHTML=this.rhCount:(b=c.querySelector("#user_list .hand_bt"),a.innerHTML="",b.classList.remove("congtooltip"),b.removeAttribute("data-title"),c.querySelector("#user_list .hand_bt").classList.remove("highlight"))},onMsgRec:function(a){var b=a.message;a=a.fromUser.userid;b.sd?(b=c.getElementById(a+"contrstdscreenImg"),null!=b&&b.setAttribute("data-dcolor","red")):
b.ext?(b=c.getElementById(a+"contrstdscreenImg"),null!=b&&b.setAttribute("data-dcolor","orange")):roles.hasControls()?this.msgRecAtTeacher(b.data):this.msgRecAtStudent(b.data)},msgRecAtTeacher:function(a){console.log("raiseStd"+a.action);var b=a.user,d=c.getElementById(b+"contRaiseH"),h=c.getElementById(b+"contRaiseAnch"),m=c.getElementById(b+"contrRaiseHandImg");"enable"==a.action?(this.enableRaiseHand(b),this.moveUpInList()):"disable"==a.action&&(virtualclass.user.control.updateUser(b,"raiseHand",
!1),d.classList.remove("enabled"),d.classList.add("disabled"),m.setAttribute("data-raisehand-disable",!0),h.setAttribute("data-title","disabled"),d.style.pointerEvents="none",this.moveDownInList(b),this.rhCount--,this.rhCount||c.querySelector("#user_list .hand_bt").classList.remove("highlight"));a=c.querySelector("#user_list .hand_bt  #notifyText");0<this.rhCount?a.innerHTML=this.rhCount:(b=c.querySelector("#user_list .hand_bt"),a.innerHTML="",b.classList.remove("congtooltip"),b.removeAttribute("data-title"))},
msgRecAtStudent:function(a){"disable"==a.action&&(this.stdRhEnable="enabled",a=c.getElementById("congHr"),a.classList.remove("disable"),a.classList.add("enable"),c.querySelector("#virtualclassCont.congrea #icHr").setAttribute("data-action","enable"),c.querySelector("#virtualclassCont.congrea #congHr").setAttribute("data-title",virtualclass.lang.getString("RaiseHandStdEnabled")))},moveUpInList:function(){for(var a=c.querySelectorAll("#virtualclassCont.congrea .controllerRaiseH"),b=0;b<a.length;b++)a[b].classList.contains("enabled")&&
0!=b&&a[b].closest(".ui-memblist-usr").parentNode.insertBefore(a[b].closest(".ui-memblist-usr"),a[0].closest(".ui-memblist-usr"))},moveDownInList:function(a){var b=c.querySelectorAll("#virtualclassCont.congrea .controllerRaiseH.enabled");a=c.getElementById(a+"contRaiseH");0<b.length&&a.closest(".ui-memblist-usr").parentNode.insertBefore(a.closest(".ui-memblist-usr"),b[b.length-1].closest(".ui-memblist-usr").nextSibling)},enableRaiseHand:function(a){this.rhCount++;this._enableRaiseHand(this.rhCount,
a)},_enableRaiseHand:function(a,b){var d=c.getElementById(b+"contRaiseH"),f=c.getElementById(b+"contRaiseAnch"),m=c.getElementById(b+"contrRaiseHandImg");virtualclass.user.control.updateUser(b,"raiseHand",!0);d.classList.remove("disabled");d.classList.add("enabled");m.setAttribute("data-raisehand-disable",!1);f.setAttribute("data-title",virtualclass.lang.getString("RaiseHandEnable"));d.style.pointerEvents="visible";b=c.querySelector("#user_list .hand_bt");b.classList.contains("highlight")||b.classList.add("highlight");
c.querySelector("#user_list .hand_bt  #notifyText").innerHTML=a;a=c.querySelector("#user_list .hand_bt");a.classList.contains("congtooltip")||a.classList.add("congtooltip");a.setAttribute("data-title",virtualclass.lang.getString("raiseHandNotify"))},_raiseHand:function(a){this.rhCountR++;this.rhCount=this.rhCountR;this._enableRaiseHand(this.rhCountR,a)},updateInStorage:function(){localStorage.setItem("stdRhEnable",this.stdRhEnable)},attachHandlerAtStudent:function(){var a=c.querySelector("#virtualclassCont.congrea #congHr");
a.addEventListener("click",function(){var b=c.querySelector("#virtualclassCont.congrea #icHr"),d=virtualclass.vutil.whoIsTeacher();ioAdapter.sendUser({data:{user:wbUser.id,action:b.getAttribute("data-action")},cf:"raiseHand"},d);"enable"==b.getAttribute("data-action")?(b.setAttribute("data-action","disable"),a.classList.remove("enable"),a.classList.add("disable"),b=c.querySelector("#virtualclassCont.congrea #congHr"),b.setAttribute("data-title",virtualclass.lang.getString("RaiseHandStdDisabled")),
virtualclass.raiseHand.stdRhEnable="disabled"):(b.setAttribute("data-action","enable"),a.classList.add("enable"),a.classList.remove("disable"),b=c.querySelector("#virtualclassCont.congrea #congHr"),b.setAttribute("data-title",virtualclass.lang.getString("RaiseHandStdEnabled")),virtualclass.raiseHand.stdRhEnable="enabled")})}}}()})(window,document);(function(d){d.colorSelector={makeThemeReady:function(){var c=virtualclassSetting.theme.selectedColor,b=this.calcBrightness(c);var a=125<b?"black":"white";var d={},g={},h={};h.fcolor=chroma(c).brighten().hex();h.scolor=chroma(c).brighten(1.8).hex();50>b?10>=b?(g.fcolor=chroma(c).brighten(2).hex(),g.scolor=chroma(c).brighten(3).hex()):(g.fcolor=chroma(c).darken().hex(),g.scolor=chroma(c).darken(2).hex()):180<b?(g.fcolor=chroma(c).darken(1.5).hex(),g.scolor=chroma(c).darken(1.1).hex(),h.fcolor=chroma(c).darken(.5).hex(),
h.scolor=chroma(c).darken(.8).hex()):(g.fcolor=chroma(c).darken(.8).hex(),g.scolor=chroma(c).darken(.6).hex(),h.fcolor=chroma(c).brighten().hex(),h.scolor=chroma(c).brighten(1.8).hex());d.fcolor=c;d.scolor=chroma(c).brighten().hex();g.frontColor=a;h.frontColor=a;this.makeThemeReadyMainCont(a,d,g,h);this.makeThemeReadyEditor(a,d,g,h);this.makeThemeReadyRightPanel(a,d,g,h);this.makeThemeReadyVideo(a,d,g,h,b);this.makeThemeReadyPoll(a,d,g,h,b);this.makeThemeReadyPresentation(a,d,g,h,b);this.makeThemeReadyDocument(a,
d,g,h);this.lightColorCustomize(a,d,g,h,b)},lightColorCustomize:function(c,b,a,d,g){218<=g&&(b.fcolor=chroma(b.fcolor).darken(.4).hex(),b.scolor=chroma(b.fcolor).darken().hex());c="0.05em solid "+b.fcolor;this.addCss("#virtualclassCont.congrea #virtualclassOptionsCont .appOptions, #virtualclassCont.congrea #audioWidget{border-top:"+c+" !important;}#virtualclassCont.congrea #virtualclassOptionsCont #virtualclassWhiteboardTool{border:0 !important;}#virtualclassCont.congrea .zoomControler div, #virtualclassCont.congrea #networkStatusContainer, #virtualclassCont.congrea #audioWidget li{border-right:"+
c+" !important;}#virtualclassCont.congrea .zoomControler,#virtualclassCont.congrea #networkStatusContainer, #virtualclassCont.congrea #alleditorRichContainer{border-left:"+c+" !important;}#virtualclassCont.congrea .containerWb .commandToolsWrapper .tool a ,#virtualclassCont.congrea #audioWidget li,#virtualclassCont.congrea #virtualclassAppRightPanel #chatWidget .chatBarTab li{border-right: 0.01em solid "+b.fcolor+"!important;}#virtualclassCont.congrea .btn.btn-default ,#virtualclassCont.congrea .vceditor-toolbar ,#virtualclassCont.congrea #virtualclassAppRightPanel #chatWidget .chatBarTab,#virtualclassCont.congrea #stickybar .footerCtr .vmchat_search #congreaUserSearch ,#virtualclassCont.congrea #layoutQuiz .navbar ,#virtualclassCont.congrea button ,#virtualclassCont.congrea #alleditorRichContainer ,#virtualclassCont.congrea .zoomControler ,#virtualclassCont.congrea .btn-default {background-image: linear-gradient(to bottom, "+
b.fcolor+" 0%,"+b.scolor+" 100%) !important;}")},calcBrightness:function(c){c=chroma(c).rgb();c=Math.round((299*parseInt(c[0])+587*parseInt(c[1])+114*parseInt(c[2]))/1E3);console.log("brightne"+c);return c},makeThemeReadyMainCont:function(c,b,a,d){this.addCss("#virtualclassCont.congrea .ui-widget-header{background-image: linear-gradient(to bottom, "+b.fcolor+" 0%,"+b.scolor+" 100%) !important} #virtualclassCont.congrea #virtualclassAppLeftPanel #dashboardnav .btn{background-image: linear-gradient(to bottom, "+
b.fcolor+" 0%,"+b.scolor+" 100%) !important} #virtualclassCont.congrea #virtualclassAppLeftPanel #dashboardnav .btn.clicked{background-image: linear-gradient(to bottom, "+a.fcolor+" 0%,"+a.scolor+" 100%) !important} #virtualclassCont.congrea #navigator, #virtualclassCont.congrea #layoutQuiz .navbar, #virtualclassCont.congrea .commandToolsWrapper, #virtualclassCont.congrea #playButton, #virtualclassCont.congrea #recordPlay .rv-vanilla-modal-body #downloadPcCont #downloadSessionText{background-image: linear-gradient(to bottom, "+
b.fcolor+" 0%,"+b.scolor+" 100%)} #virtualclassCont.congrea #virtualclassOptionsCont:first-child {background-image: linear-gradient(to right, "+b.fcolor+" 0%,"+b.scolor+" 100%)} #virtualclassCont.congrea .commandToolsWrapper{background-image: linear-gradient(to bottom, "+b.fcolor+" 0%,"+b.scolor+" 100%)} #virtualclassCont.congrea #virtualclassOptionsCont .appOptions.active, #virtualclassCont.congrea .commandToolsWrapper .tool.active a {background-image: radial-gradient(ellipse at center, "+a.fcolor+
" 0%,"+a.scolor+" 100%)} #virtualclassCont.congrea #virtualclassOptionsCont .appOptions:hover, #virtualclassCont.congrea .containerWb .commandToolsWrapper .tool a:hover, #virtualclassCont.congrea #confirmCancel #confirmCancelButton:hover, #virtualclassCont.congrea #alleditorRichContainer:hover, #virtualclassCont.congrea #confirm.popupWindow #confirmOk #confirmOkButton:hover{background-image: radial-gradient(ellipse at center, "+d.fcolor+" 0%,"+d.scolor+" 100%) !important}#virtualclassCont.congrea #confirm.popupWindow #confirmOk #confirmOkButton,#virtualclassCont.congrea #confirm.popupWindow #confirmCancel #confirmCancelButton{color:"+
c+"!important}#virtualclassCont.congrea .appOptions:hover .cgIcon:before{color:"+d.frontColor+"!important}#virtualclassCont.congrea .active .cgIcon:before{color:"+a.frontColor+"!important}#virtualclassCont.congrea .commandToolsWrapper .tool:hover .cgIcon:before{color:"+d.frontColor+"!important}#virtualclassCont.congrea .cgIcon:before{color:"+c+"!important}#virtualclassCont.congrea .cgText{color:"+c+"!important}#virtualclassCont.congrea .vchead{color:"+c+"!important}#virtualclassCont.congrea .icon-publish2:before{color:"+
a.fcolor+"!important}#virtualclassCont.congrea button ,#virtualclassCont.congrea .btn-default {background-image: linear-gradient(to bottom, "+b.fcolor+" 0%,"+b.scolor+" 100%) !important } #virtualclassCont.congrea #congdashboard .modal-header .close{opacity :1;}#virtualclassCont.congrea .modal-header .btn-default ,#virtualclassCont.congrea .modal .btn-default ,#virtualclassCont.congrea .precheck .btn-default {color :"+c+"!important} #virtualclassCont.congrea .vjs-control-bar .vjs-autoPlay-button {background:none !important ;}#virtualclassCont.congrea .vjs-control-bar .vjs-button {background:none !important ; border:none !important}#virtualclassCont.congrea  .zoomControler div:hover{background-image: radial-gradient(ellipse at center, "+
d.fcolor+" 0%,"+d.scolor+" 100%) !important}#virtualclassCont.congrea  #onlineusertext:before{color :"+c+"!important} #virtualclassCont.congrea  #recordPlay #playButton:before{color :"+c+"!important} #virtualclassCont.congrea #recordingHeaderContainer  {background-image: linear-gradient(to bottom, "+b.fcolor+" 0%,"+b.scolor+" 100%) !important ;color:"+c+"!important} #virtualclassCont.congrea  #virtualclassApp .playControllerMainCont {background-image: linear-gradient(to bottom, "+b.fcolor+" 0%,"+
b.scolor+" 100%) !important ;color:"+c+"!important} #virtualclassCont.congrea  .dbContainer .qq-cancel-button-selector{color :"+c+"!important} #virtualclassCont.congrea  #playController button{background-image:none !important;color:"+c+"!important}")},makeThemeReadyEditor:function(c,b,a,d){this.addCss("#virtualclassCont.congrea a.vceditor-btn{background-color: "+a.fcolor+"} #virtualclassCont.congrea a.vceditor-btn{color: "+a.frontColor+"} #virtualclassCont.congrea #alleditorRichContainer{background-color: "+
a.frontColor+"} #virtualclassCont.congrea .vceditor-toolbar{background-image: linear-gradient(to bottom, "+b.fcolor+" 0%,"+b.scolor+" 100%) !important} #virtualclassCont.congrea a.vceditor-btn:hover{color:"+d.frontColor+"!important}#virtualclassCont.congrea a.vceditor-btn:hover{background-image: radial-gradient(ellipse at center, "+d.fcolor+" 0%,"+d.scolor+" 100%) !important}#virtualclassCont.congrea .commandToolsWrapper .tool.active a{background-image: radial-gradient(ellipse at center, "+a.fcolor+
" 0%,"+a.scolor+" 100% !important)} #virtualclassCont .vceditor-dropdown-menu a:hover{background-color:"+b.fcolor+"!important}")},makeThemeReadyRightPanel:function(c,b,a,d){this.addCss("#virtualclassCont.congrea #recordPlay .rv-vanilla-modal-body #downloadPcCont #downloadSessionText,#virtualclassCont.congrea #virtualclassAppRightPanel #audioWidget{background-image: linear-gradient(to bottom, "+b.fcolor+" 0%,"+b.scolor+" 100%) !important}#virtualclassCont.congrea #chatWidget .chatBarTab{background: linear-gradient(to bottom, "+
b.fcolor+" 0%,"+b.scolor+" 100%) !important}#virtualclassCont.congrea #stickycontainer .inner_bt:hover, #virtualclassCont.congrea #stickycontainer .stdRaiseHand:hover, #virtualclassCont.congrea #stickycontainer #contrAudioAll:hover, #virtualclassCont.congrea #virtualclassAppRightPanel #mainAudioPanel li:hover, #virtualclassCont.congrea #virtualclassAppRightPanel #mainAudioPanel li a:hover,#virtualclassCont.congrea #audioWidget #speakerPressOnce:hover,#virtualclassCont.congrea #audioTest-box:hover,#virtualclassCont.congrea #playButton:hover, #virtualclassCont.congrea #alwaysPress:hover{background-image: radial-gradient(ellipse at center, "+
d.fcolor+" 0%,"+d.scolor+" 100%) !important}#virtualclassCont.congrea .vmchat_support.active ,#virtualclassCont.congrea .vmchat_room_bt.active,#virtualclassCont.congrea .vmchat_bar_button.active, #virtualclassCont.congrea #virtualclassAppRightPanel #audioWidget .settingActive,#virtualclassCont.congrea #virtualclassAppRightPanel #stickycontainer .handRaise.disable{background-image: radial-gradient(ellipse at center, "+a.fcolor+" 0%,"+a.scolor+" 100%) !important}#virtualclassCont.congrea #virtualclassAppRightPanel li:hover .cgIcon:before{color:"+
d.frontColor+"!important}#virtualclassCont.congrea #virtualclassAppRightPanel #appSettingCtrlAnchor span{color:"+c+"!important}#virtualclassCont.congrea #virtualclassAppRightPanel li:hover .cgText{color:"+d.frontColor+"!important}#virtualclassCont.congrea #virtualclassAppRightPanel .handRaise.enable #icHr:before{color:"+c+"!important}#virtualclassCont.congrea #virtualclassAppRightPanel .pre-check-btn{background-image: linear-gradient(to bottom, "+b.fcolor+" 0%,"+b.scolor+" 100%) !important ;color:"+
c+"!important} ")},makeThemeReadyVideo:function(c,b,a,d,g){var f=b.fcolor;180<g&&(f=a.fcolor);this.addCss("#virtualclassCont.congrea .ui-widget-header,#virtualclassCont.congrea #congdashboard .modal-header {background-image: linear-gradient(to bottom, "+b.fcolor+" 0%,"+b.scolor+" 100%) !important}#virtualclassCont.congrea #listvideo .linkvideo .videoTitleCont:before, #virtualclassCont.congrea #listvideo .linkvideo .controls .editanch:before, #virtualclassCont.congrea #listvideo .linkvideo .controls:before{color:"+
f+"!important}#virtualclassCont.congrea #listvideo .linkvideo .controls:hover:before{color:"+d.fcolor+"!important}#virtualclassCont.congrea #VideoDashboard button{color:"+c+"!important}#virtualclassCont.congrea #VideoDashboard button{border:1px solid"+c+"!important}{background-color: "+a.frontColor+"!important} #virtualclassCont.congrea #listvideo .linkvideo.playing{border:solid "+b.fcolor+" 1px!important}")},makeThemeReadyPoll:function(c,b,a,d,g){b=b.fcolor;180<g&&(b=a.fcolor);this.addCss("#virtualclassCont.congrea #virtualclassPoll .btn.btn-default, #virtualclassCont.congrea #virtualclassPoll #stdPollContainer #btnVote{color:"+
c+";}#virtualclassCont.congrea .bootstrap .pollNavBar > li > a {color:"+c+" ; }#virtualclassCont.congrea .bootstrap .navListTab:hover{color:"+d.frontColor+"!important;}#virtualclassCont.congrea #virtualclassPoll #chartMenuCont a, #virtualclassCont.congrea #virtualclassPoll .controlIcon:before{color:"+b+"!important}#virtualclassCont.congrea #virtualclassPoll .controlIcon:hover:before{color:"+d.fcolor+"!important}#virtualclassCont.congrea #virtualclassPoll #navigator #stdPollHeader{color:"+c+";}#virtualclassCont.congrea #virtualclassPoll .modal button.close ,#virtualclassCont.congrea  .alert .close {background-image: none !important ;background-color:none !important}")},
makeThemeReadyPresentation:function(c,b,a,d,g){b=b.fcolor;180<g&&(b=a.fcolor,d.fcolor=chroma(a.fcolor).darken());this.addCss("#virtualclassCont.congrea #SharePresentationDashboard .btn-default{color:"+c+"!important;}#virtualclassCont.congrea #virtualclassPoll #chartMenuCont a, #virtualclassCont.congrea #SharePresentationDashboard .controls:before{color:"+b+"!important}#virtualclassCont.congrea #SharePresentationDashboard .controls:hover:before{color:"+d.fcolor+"!important}")},makeThemeReadyDocument:function(c,
b,a,d){this.addCss("#virtualclassCont.congrea #DocumentShareDashboard #newDocBtn {background-image: linear-gradient(to bottom, "+b.fcolor+" 0%,"+b.scolor+" 100%) !important;color:"+c+"!important}")},addCss:function(c){var b=document.getElementsByTagName("head")[0],a=document.createElement("style");a.setAttribute("type","text/css");a.styleSheet?a.styleSheet.cssText=c:a.appendChild(document.createTextNode(c));b.appendChild(a)}}})(window);/*


 chroma.js - JavaScript library for color conversions

 Copyright (c) 2011-2017, Gregor Aisch
 All rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are met:

 1. Redistributions of source code must retain the above copyright notice, this
    list of conditions and the following disclaimer.

 2. Redistributions in binary form must reproduce the above copyright notice,
    this list of conditions and the following disclaimer in the documentation
    and/or other materials provided with the distribution.

 3. The name Gregor Aisch may not be used to endorse or promote products
    derived from this software without specific prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.


*/
(function(){var d,c,b=[].slice;var a=function(){var a;var b={};var c="Boolean Number String Function Array Date RegExp Undefined Null".split(" ");var d=0;for(a=c.length;d<a;d++){var f=c[d];b["[object "+f+"]"]=f.toLowerCase()}return function(a){a=Object.prototype.toString.call(a);return b[a]||"object"}}();var f=function(a,b,c){null==b&&(b=0);null==c&&(c=1);a<b&&(a=b);a>c&&(a=c);return a};var g=function(a){return 3<=a.length?[].slice.call(a):a[0]};var h=function(a){var b,c;a._clipped=!1;a._unclipped=
a.slice(0);for(b=c=0;3>c;b=++c)if(3>b){if(0>a[b]||255<a[b])a._clipped=!0;0>a[b]&&(a[b]=0);255<a[b]&&(a[b]=255)}else 3===b&&(0>a[b]&&(a[b]=0),1<a[b]&&(a[b]=1));a._clipped||delete a._unclipped;return a};var m=Math.PI;var n=Math.round;var r=Math.cos;var A=Math.floor;var z=Math.pow;var t=Math.log;var v=Math.sin;var q=Math.sqrt;var w=Math.atan2;var p=Math.max;var B=Math.abs;var G=2*m;var H=m/3;var M=m/180;var J=180/m;var D=function(){return arguments[0]instanceof C?arguments[0]:function(a,b,c){c.prototype=
a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(C,arguments,function(){})};D["default"]=D;var I=[];"undefined"!==typeof module&&null!==module&&null!=module.exports&&(module.exports=D);if("function"===typeof define&&define.amd)define([],function(){return D});else{var P="undefined"!==typeof exports&&null!==exports?exports:this;P.chroma=D}D.version="1.3.5";var K={};var R=[];var Z=!1;var C=function(){function a(){var a,b;var c=[];var d=0;for(b=arguments.length;d<b;d++){var f=arguments[d];
null!=f&&c.push(f)}1<c.length&&(a=c[c.length-1]);if(null!=K[a])this._rgb=h(K[a](g(c.slice(0,-1))));else{Z||(R=R.sort(function(a,b){return b.p-a.p}),Z=!0);b=0;for(f=R.length;b<f&&!(a=R[b],a=a.test.apply(a,c));b++);a&&(this._rgb=h(K[a].apply(K,c)))}null==this._rgb&&console.warn("unknown format: "+c);null==this._rgb&&(this._rgb=[0,0,0]);3===this._rgb.length&&this._rgb.push(1)}a.prototype.toString=function(){return this.hex()};a.prototype.clone=function(){return D(me._rgb)};return a}();D._input=K;D.brewer=
d={OrRd:"#fff7ec #fee8c8 #fdd49e #fdbb84 #fc8d59 #ef6548 #d7301f #b30000 #7f0000".split(" "),PuBu:"#fff7fb #ece7f2 #d0d1e6 #a6bddb #74a9cf #3690c0 #0570b0 #045a8d #023858".split(" "),BuPu:"#f7fcfd #e0ecf4 #bfd3e6 #9ebcda #8c96c6 #8c6bb1 #88419d #810f7c #4d004b".split(" "),Oranges:"#fff5eb #fee6ce #fdd0a2 #fdae6b #fd8d3c #f16913 #d94801 #a63603 #7f2704".split(" "),BuGn:"#f7fcfd #e5f5f9 #ccece6 #99d8c9 #66c2a4 #41ae76 #238b45 #006d2c #00441b".split(" "),YlOrBr:"#ffffe5 #fff7bc #fee391 #fec44f #fe9929 #ec7014 #cc4c02 #993404 #662506".split(" "),
YlGn:"#ffffe5 #f7fcb9 #d9f0a3 #addd8e #78c679 #41ab5d #238443 #006837 #004529".split(" "),Reds:"#fff5f0 #fee0d2 #fcbba1 #fc9272 #fb6a4a #ef3b2c #cb181d #a50f15 #67000d".split(" "),RdPu:"#fff7f3 #fde0dd #fcc5c0 #fa9fb5 #f768a1 #dd3497 #ae017e #7a0177 #49006a".split(" "),Greens:"#f7fcf5 #e5f5e0 #c7e9c0 #a1d99b #74c476 #41ab5d #238b45 #006d2c #00441b".split(" "),YlGnBu:"#ffffd9 #edf8b1 #c7e9b4 #7fcdbb #41b6c4 #1d91c0 #225ea8 #253494 #081d58".split(" "),Purples:"#fcfbfd #efedf5 #dadaeb #bcbddc #9e9ac8 #807dba #6a51a3 #54278f #3f007d".split(" "),
GnBu:"#f7fcf0 #e0f3db #ccebc5 #a8ddb5 #7bccc4 #4eb3d3 #2b8cbe #0868ac #084081".split(" "),Greys:"#ffffff #f0f0f0 #d9d9d9 #bdbdbd #969696 #737373 #525252 #252525 #000000".split(" "),YlOrRd:"#ffffcc #ffeda0 #fed976 #feb24c #fd8d3c #fc4e2a #e31a1c #bd0026 #800026".split(" "),PuRd:"#f7f4f9 #e7e1ef #d4b9da #c994c7 #df65b0 #e7298a #ce1256 #980043 #67001f".split(" "),Blues:"#f7fbff #deebf7 #c6dbef #9ecae1 #6baed6 #4292c6 #2171b5 #08519c #08306b".split(" "),PuBuGn:"#fff7fb #ece2f0 #d0d1e6 #a6bddb #67a9cf #3690c0 #02818a #016c59 #014636".split(" "),
Viridis:"#440154 #482777 #3f4a8a #31678e #26838f #1f9d8a #6cce5a #b6de2b #fee825".split(" "),Spectral:"#9e0142 #d53e4f #f46d43 #fdae61 #fee08b #ffffbf #e6f598 #abdda4 #66c2a5 #3288bd #5e4fa2".split(" "),RdYlGn:"#a50026 #d73027 #f46d43 #fdae61 #fee08b #ffffbf #d9ef8b #a6d96a #66bd63 #1a9850 #006837".split(" "),RdBu:"#67001f #b2182b #d6604d #f4a582 #fddbc7 #f7f7f7 #d1e5f0 #92c5de #4393c3 #2166ac #053061".split(" "),PiYG:"#8e0152 #c51b7d #de77ae #f1b6da #fde0ef #f7f7f7 #e6f5d0 #b8e186 #7fbc41 #4d9221 #276419".split(" "),
PRGn:"#40004b #762a83 #9970ab #c2a5cf #e7d4e8 #f7f7f7 #d9f0d3 #a6dba0 #5aae61 #1b7837 #00441b".split(" "),RdYlBu:"#a50026 #d73027 #f46d43 #fdae61 #fee090 #ffffbf #e0f3f8 #abd9e9 #74add1 #4575b4 #313695".split(" "),BrBG:"#543005 #8c510a #bf812d #dfc27d #f6e8c3 #f5f5f5 #c7eae5 #80cdc1 #35978f #01665e #003c30".split(" "),RdGy:"#67001f #b2182b #d6604d #f4a582 #fddbc7 #ffffff #e0e0e0 #bababa #878787 #4d4d4d #1a1a1a".split(" "),PuOr:"#7f3b08 #b35806 #e08214 #fdb863 #fee0b6 #f7f7f7 #d8daeb #b2abd2 #8073ac #542788 #2d004b".split(" "),
Set2:"#66c2a5 #fc8d62 #8da0cb #e78ac3 #a6d854 #ffd92f #e5c494 #b3b3b3".split(" "),Accent:"#7fc97f #beaed4 #fdc086 #ffff99 #386cb0 #f0027f #bf5b17 #666666".split(" "),Set1:"#e41a1c #377eb8 #4daf4a #984ea3 #ff7f00 #ffff33 #a65628 #f781bf #999999".split(" "),Set3:"#8dd3c7 #ffffb3 #bebada #fb8072 #80b1d3 #fdb462 #b3de69 #fccde5 #d9d9d9 #bc80bd #ccebc5 #ffed6f".split(" "),Dark2:"#1b9e77 #d95f02 #7570b3 #e7298a #66a61e #e6ab02 #a6761d #666666".split(" "),Paired:"#a6cee3 #1f78b4 #b2df8a #33a02c #fb9a99 #e31a1c #fdbf6f #ff7f00 #cab2d6 #6a3d9a #ffff99 #b15928".split(" "),
Pastel2:"#b3e2cd #fdcdac #cbd5e8 #f4cae4 #e6f5c9 #fff2ae #f1e2cc #cccccc".split(" "),Pastel1:"#fbb4ae #b3cde3 #ccebc5 #decbe4 #fed9a6 #ffffcc #e5d8bd #fddaec #f2f2f2".split(" ")};(function(){var a;var b=[];for(a in d)b.push(d[a.toLowerCase()]=d[a]);return b})();var fa={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",
cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",
darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",
lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",
magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",
orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",
slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};D.colors=fa;var oa=function(){var a=g(arguments);var b=a[0];var c=a[1];var d=a[2];b=(b+16)/116;var f=isNaN(c)?b:b+c/500;d=isNaN(d)?b:b-d/200;b=X.Yn*da(b);f=X.Xn*da(f);d=X.Zn*da(d);var h=ua(3.2404542*f-1.5371385*
b-.4985314*d);c=ua(-.969266*f+1.8760108*b+.041556*d);d=ua(.0556434*f-.2040259*b+1.0572252*d);return[h,c,d,3<a.length?a[3]:1]};var ua=function(a){return 255*(.00304>=a?12.92*a:1.055*z(a,1/2.4)-.055)};var da=function(a){return a>X.t1?a*a*a:X.t2*(a-X.t0)};var X={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452};var aa=function(){var a=g(arguments);a=ja(a[0],a[1],a[2]);var b=a[0];var c=a[1];return[116*c-16,500*(b-c),200*(c-a[2])]};var qa=function(a){return.04045>=
(a/=255)?a/12.92:z((a+.055)/1.055,2.4)};var V=function(a){return a>X.t3?z(a,1/3):a/X.t2+X.t0};var ja=function(){var a=g(arguments);var b=a[0];var c=a[1];var d=a[2];b=qa(b);c=qa(c);d=qa(d);a=V((.4124564*b+.3575761*c+.1804375*d)/X.Xn);var f=V((.2126729*b+.7151522*c+.072175*d)/X.Yn);c=V((.0193339*b+.119192*c+.9503041*d)/X.Zn);return[a,f,c]};D.lab=function(){return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(C,b.call(arguments).concat(["lab"]),function(){})};
K.lab=oa;C.prototype.lab=function(){return aa(this._rgb)};var Ha=function(a){var b;a=function(){var c;var d=[];var f=0;for(c=a.length;f<c;f++)b=a[f],d.push(D(b));return d}();if(2===a.length){var c=function(){var c;var d=[];var f=0;for(c=a.length;f<c;f++)b=a[f],d.push(b.lab());return d}();var d=c[0];var f=c[1];c=function(a){var b,c;var g=[];for(b=c=0;2>=c;b=++c)g.push(d[b]+a*(f[b]-d[b]));return D.lab.apply(D,g)}}else if(3===a.length){c=function(){var c;var d=[];var f=0;for(c=a.length;f<c;f++)b=a[f],
d.push(b.lab());return d}();d=c[0];f=c[1];var g=c[2];c=function(a){var b,c;var h=[];for(b=c=0;2>=c;b=++c)h.push((1-a)*(1-a)*d[b]+2*(1-a)*a*f[b]+a*a*g[b]);return D.lab.apply(D,h)}}else if(4===a.length){c=function(){var c;var d=[];var f=0;for(c=a.length;f<c;f++)b=a[f],d.push(b.lab());return d}();d=c[0];f=c[1];g=c[2];var h=c[3];c=function(a){var b,c;var m=[];for(b=c=0;2>=c;b=++c)m.push((1-a)*(1-a)*(1-a)*d[b]+3*(1-a)*(1-a)*a*f[b]+3*(1-a)*a*a*g[b]+a*a*a*h[b]);return D.lab.apply(D,m)}}else if(5===a.length){var m=
Ha(a.slice(0,3));var n=Ha(a.slice(2,5));c=function(a){return.5>a?m(2*a):n(2*(a-.5))}}return c};D.bezier=function(a){var b=Ha(a);b.scale=function(){return D.scale(b)};return b};D.cubehelix=function(b,c,d,f,g){null==b&&(b=300);null==c&&(c=-1.5);null==d&&(d=1);null==f&&(f=1);null==g&&(g=[0,1]);var m=0;if("array"===a(g))var n=g[1]-g[0];else n=0,g=[g,g];var p=function(a){var p=G*((b+120)/360+c*a);var F=z(g[0]+n*a,f);a=(0!==m?d[0]+a*m:d)*F*(1-F)/2;var q=r(p);p=v(p);return D(h([255*(F+a*(-.14861*q+1.78277*
p)),255*(F+a*(-.29227*q-.90649*p)),255*(F+1.97294*a*q)]))};p.start=function(a){if(null==a)return b;b=a;return p};p.rotations=function(a){if(null==a)return c;c=a;return p};p.gamma=function(a){if(null==a)return f;f=a;return p};p.hue=function(b){if(null==b)return d;d=b;"array"===a(d)?(m=d[1]-d[0],0===m&&(d=d[1])):m=0;return p};p.lightness=function(b){if(null==b)return g;"array"===a(b)?(g=b,n=b[1]-b[0]):(g=[b,b],n=0);return p};p.scale=function(){return D.scale(p)};p.hue(d);return p};D.random=function(){var a;
var b="#";for(a=0;6>a;++a)b+="0123456789abcdef".charAt(A(16*Math.random()));return new C(b)};I=[];var Ia=function(b,c,d,f){var g;null==d&&(d=.5);null==f&&(f="rgb");"object"!==a(b)&&(b=D(b));"object"!==a(c)&&(c=D(c));var h=0;for(g=I.length;h<g;h++){var m=I[h];if(f===m[0]){var n=m[1](b,c,d,f);break}}if(null==n)throw"color mode "+f+" is not supported";return n.alpha(b.alpha()+d*(c.alpha()-b.alpha()))};D.interpolate=Ia;C.prototype.interpolate=function(a,b,c){return Ia(this,a,b,c)};D.mix=Ia;C.prototype.mix=
C.prototype.interpolate;K.rgb=function(){var a;var b=g(arguments);var c=[];for(a in b){var d=b[a];c.push(d)}return c};D.rgb=function(){return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(C,b.call(arguments).concat(["rgb"]),function(){})};C.prototype.rgb=function(a){null==a&&(a=!0);return a?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)};C.prototype.rgba=function(a){null==a&&(a=!0);return a?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),
this._rgb[3]]:this._rgb.slice(0)};R.push({p:3,test:function(b){var c=g(arguments);if("array"===a(c)&&3===c.length||4===c.length&&"number"===a(c[3])&&0<=c[3]&&1>=c[3])return"rgb"}});K.lrgb=K.rgb;var ia=function(a){var b;var c=1/a.length;var d=[0,0,0,0];var f=0;for(b=a.length;f<b;f++){var g=a[f];g=g._rgb;d[0]+=z(g[0],2)*c;d[1]+=z(g[1],2)*c;d[2]+=z(g[2],2)*c;d[3]+=g[3]*c}d[0]=q(d[0]);d[1]=q(d[1]);d[2]=q(d[2]);return new C(d)};I.push(["lrgb",function(a,b,c,d){a=a._rgb;b=b._rgb;return new C(q(z(a[0],2)*
(1-c)+z(b[0],2)*c),q(z(a[1],2)*(1-c)+z(b[1],2)*c),q(z(a[2],2)*(1-c)+z(b[2],2)*c),d)}]);D.average=function(a,b){var c,d,f;null==b&&(b="rgb");var g=a.length;a=a.map(function(a){return D(a)});var h=a.splice(0,1)[0];if("lrgb"===b)return ia(a);var n=h.get(b);var p=[];var q=c=0;for(d in n)if(n[d]=n[d]||0,p.push(isNaN(n[d])?0:1),"h"===b.charAt(d)&&!isNaN(n[d])){var F=n[d]/180*m;c+=r(F);q+=v(F)}h=h.alpha();var t=0;for(f=a.length;t<f;t++){F=a[t];var N=F.get(b);h+=F.alpha();for(d in n)isNaN(N[d])||(n[d]+=N[d],
p[d]+=1,"h"===b.charAt(d)&&(F=n[d]/180*m,c+=r(F),q+=v(F)))}for(d in n)if(n[d]/=p[d],"h"===b.charAt(d)){for(F=w(q/p[d],c/p[d])/m*180;0>F;)F+=360;for(;360<=F;)F-=360;n[d]=F}return D(n,b).alpha(h/g)};var ra=function(a){if(a.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)){if(4===a.length||7===a.length)a=a.substr(1);3===a.length&&(a=a.split(""),a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);var b=parseInt(a,16);return[b>>16,b>>8&255,b&255,1]}if(a.match(/^#?([A-Fa-f0-9]{8})$/)){9===a.length&&(a=a.substr(1));b=parseInt(a,
16);var c=b>>24&255;var d=b>>16&255;a=b>>8&255;b=n((b&255)/255*100)/100;return[c,d,a,b]}if(null!=K.css&&(d=K.css(a)))return d;throw"unknown color: "+a;};var Za=function(a,b){null==b&&(b="rgb");var c=a[0];var d=a[1];var f=a[2];a=a[3];c=Math.round(c);d=Math.round(d);f=Math.round(f);var g="000000"+(c<<16|d<<8|f).toString(16);g=g.substr(g.length-6);var h="0"+n(255*a).toString(16);h=h.substr(h.length-2);return"#"+function(){switch(b.toLowerCase()){case "rgba":return g+h;case "argb":return h+g;default:return g}}()};
K.hex=function(a){return ra(a)};D.hex=function(){return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(C,b.call(arguments).concat(["hex"]),function(){})};C.prototype.hex=function(a){null==a&&(a="rgb");return Za(this._rgb,a)};R.push({p:4,test:function(b){if(1===arguments.length&&"string"===a(b))return"hex"}});var xa=function(){var a,b;var c=g(arguments);var d=c[0];var f=c[1];var h=c[2];if(0===f)var m=a=f=255*h;else{m=[0,0,0];a=[0,0,0];f=.5>h?h*(1+f):h+f-h*
f;h=2*h-f;d/=360;m[0]=d+1/3;m[1]=d;m[2]=d-1/3;for(d=b=0;2>=b;d=++b)0>m[d]&&(m[d]+=1),1<m[d]&&--m[d],a[d]=1>6*m[d]?h+6*(f-h)*m[d]:1>2*m[d]?f:2>3*m[d]?h+(f-h)*(2/3-m[d])*6:h;f=[n(255*a[0]),n(255*a[1]),n(255*a[2])];m=f[0];a=f[1];f=f[2]}return 3<c.length?[m,a,f,c[3]]:[m,a,f]};var Sa=function(a,b,c){void 0!==a&&3<=a.length&&(c=a,a=c[0],b=c[1],c=c[2]);a/=255;b/=255;c/=255;var d=Math.min(a,b,c);p=Math.max(a,b,c);var f=(p+d)/2;if(p===d){var g=0;var h=Number.NaN}else g=.5>f?(p-d)/(p+d):(p-d)/(2-p-d);a===p?
h=(b-c)/(p-d):b===p?h=2+(c-a)/(p-d):c===p&&(h=4+(a-b)/(p-d));h*=60;0>h&&(h+=360);return[h,g,f]};D.hsl=function(){return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(C,b.call(arguments).concat(["hsl"]),function(){})};K.hsl=xa;C.prototype.hsl=function(){return Sa(this._rgb)};var Ja=function(){var a=g(arguments);var b=a[0];var c=a[1];a=a[2];var d=Math.min(b,c,a);p=Math.max(b,c,a);d=p-d;var f=p/255;if(0===p){var h=Number.NaN;var m=0}else m=d/p,b===p&&(h=(c-
a)/d),c===p&&(h=2+(a-b)/d),a===p&&(h=4+(b-c)/d),h*=60,0>h&&(h+=360);return[h,m,f]};D.hsv=function(){return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(C,b.call(arguments).concat(["hsv"]),function(){})};K.hsv=function(){var a,b;var c=g(arguments);var d=c[0];var f=c[1];var h=c[2];h*=255;if(0===f)var m=b=a=h;else{360===d&&(d=0);360<d&&(d-=360);0>d&&(d+=360);d/=60;var n=A(d);var p=d-n;d=h*(1-f);var q=h*(1-f*p);f=h*(1-f*(1-p));switch(n){case 0:a=[h,f,d];m=a[0];
b=a[1];a=a[2];break;case 1:a=[q,h,d];m=a[0];b=a[1];a=a[2];break;case 2:a=[d,h,f];m=a[0];b=a[1];a=a[2];break;case 3:a=[d,q,h];m=a[0];b=a[1];a=a[2];break;case 4:a=[f,d,h];m=a[0];b=a[1];a=a[2];break;case 5:a=[h,d,q],m=a[0],b=a[1],a=a[2]}}return[m,b,a,3<c.length?c[3]:1]};C.prototype.hsv=function(){return Ja(this._rgb)};var ba=function(){var a=g(arguments);return(a[0]<<16)+(a[1]<<8)+a[2]};D.num=function(a){return new C(a,"num")};C.prototype.num=function(a){null==a&&(a="rgb");return ba(this._rgb,a)};K.num=
function(b){if("number"===a(b)&&0<=b&&16777215>=b)return[b>>16,b>>8&255,b&255,1];console.warn("unknown num color: "+b);return[0,0,0,1]};R.push({p:1,test:function(b){if(1===arguments.length&&"number"===a(b)&&0<=b&&16777215>=b)return"num"}});var Ka=function(){var a=g(arguments);var b=a[0];var c=a[1];a=a[2];var d=Math.min(b,c,a);p=Math.max(b,c,a);var f=p-d;if(0===f)var h=Number.NaN;else b===p&&(h=(c-a)/f),c===p&&(h=2+(a-b)/f),a===p&&(h=4+(b-c)/f),h*=60,0>h&&(h+=360);return[h,100*f/255,d/(255-f)*100]};
D.hcg=function(){return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(C,b.call(arguments).concat(["hcg"]),function(){})};K.hcg=function(){var a;var b=g(arguments);var c=b[0];var d=b[1];var f=b[2];d/=100;var h=h/100*255;var m=255*d;if(0===d)var n=h=a=f;else{360===c&&(c=0);360<c&&(c-=360);0>c&&(c+=360);c/=60;var p=A(c);c-=p;f*=1-d;d=f+m*(1-c);c=f+m*c;m=f+m;switch(p){case 0:a=[m,c,f];n=a[0];h=a[1];a=a[2];break;case 1:a=[d,m,f];n=a[0];h=a[1];a=a[2];break;case 2:a=
[f,m,c];n=a[0];h=a[1];a=a[2];break;case 3:a=[f,d,m];n=a[0];h=a[1];a=a[2];break;case 4:a=[c,f,m];n=a[0];h=a[1];a=a[2];break;case 5:a=[m,f,d],n=a[0],h=a[1],a=a[2]}}return[n,h,a,3<b.length?b[3]:1]};C.prototype.hcg=function(){return Ka(this._rgb)};var db=function(a){var b;a=a.toLowerCase();if(null!=D.colors&&D.colors[a])return ra(D.colors[a]);if(b=a.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){var c=b.slice(1,4);for(b=a=0;2>=a;b=++a)c[b]=+c[b];c[3]=1}else if(b=a.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(c=
b.slice(1,5),b=a=0;3>=a;b=++a)c[b]=+c[b];else if(b=a.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){c=b.slice(1,4);for(b=a=0;2>=a;b=++a)c[b]=n(2.55*c[b]);c[3]=1}else if(b=a.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){c=b.slice(1,5);for(b=a=0;2>=a;b=++a)c[b]=n(2.55*c[b]);c[3]=+c[3]}else if(b=a.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))c=
b.slice(1,4),c[1]*=.01,c[2]*=.01,c=xa(c),c[3]=1;else if(b=a.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))c=b.slice(1,4),c[1]*=.01,c[2]*=.01,c=xa(c),c[3]=+b[4];return c};var Pb=function(a){var b=1>a[3]?"rgba":"rgb";if("rgb"===b)return b+"("+a.slice(0,3).map(n).join(",")+")";if("rgba"===b)return b+"("+a.slice(0,3).map(n).join(",")+","+a[3]+")"};var qb=function(a){return n(100*a)/100};var rb=function(a,b){var c=1>b?"hsla":"hsl";a[0]=
qb(a[0]||0);a[1]=qb(100*a[1])+"%";a[2]=qb(100*a[2])+"%";"hsla"===c&&(a[3]=b);return c+"("+a.join(",")+")"};K.css=function(a){return db(a)};D.css=function(){return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(C,b.call(arguments).concat(["css"]),function(){})};C.prototype.css=function(a){null==a&&(a="rgb");if("rgb"===a.slice(0,3))return Pb(this._rgb);if("hsl"===a.slice(0,3))return rb(this.hsl(),this.alpha())};K.named=function(a){return ra(fa[a])};R.push({p:5,
test:function(a){if(1===arguments.length&&null!=fa[a])return"named"}});C.prototype.name=function(a){var b;arguments.length&&(fa[a]&&(this._rgb=ra(fa[a])),this._rgb[3]=1,this);var c=this.hex();for(b in fa)if(c===fa[b])return b;return c};var Jc=function(){var a=g(arguments);var b=a[0];var c=a[1];a=a[2];a*=M;return[b,r(a)*c,v(a)*c]};var Rb=function(){var a=g(arguments);var b=Jc(a[0],a[1],a[2]);var c=b[0];var d=b[1];b=b[2];b=oa(c,d,b);d=b[0];c=b[1];b=b[2];return[d,c,b,3<a.length?a[3]:1]};var Kc=function(){var a=
g(arguments);var b=a[0];var c=a[1];var d=a[2];a=q(c*c+d*d);c=(w(d,c)*J+360)%360;0===n(1E4*a)&&(c=Number.NaN);return[b,a,c]};var ib=function(){var a=g(arguments);var b=a[0];var c=a[1];a=a[2];a=aa(b,c,a);b=a[0];c=a[1];a=a[2];return Kc(b,c,a)};D.lch=function(){var a=g(arguments);return new C(a,"lch")};D.hcl=function(){var a=g(arguments);return new C(a,"hcl")};K.lch=Rb;K.hcl=function(){var a=g(arguments);return Rb([a[2],a[1],a[0]])};C.prototype.lch=function(){return ib(this._rgb)};C.prototype.hcl=function(){return ib(this._rgb).reverse()};
var Sb=function(a){null==a&&(a="rgb");var b=g(arguments);var c=b[0];var d=b[1];b=b[2];c/=255;d/=255;b/=255;var f=1-Math.max(c,Math.max(d,b));var h=1>f?1/(1-f):0;return[(1-c-f)*h,(1-d-f)*h,(1-b-f)*h,f]};var td=function(){var a=g(arguments);var b=a[0];var c=a[1];var d=a[2];var f=a[3];a=4<a.length?a[4]:1;return 1===f?[0,0,0,a]:[1<=b?0:255*(1-b)*(1-f),1<=c?0:255*(1-c)*(1-f),1<=d?0:255*(1-d)*(1-f),a]};K.cmyk=function(){return td(g(arguments))};D.cmyk=function(){return function(a,b,c){c.prototype=a.prototype;
c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(C,b.call(arguments).concat(["cmyk"]),function(){})};C.prototype.cmyk=function(){return Sb(this._rgb)};K.gl=function(){var a,b,c,d;var f=function(){var a=g(arguments);var c=[];for(b in a)d=a[b],c.push(d);return c}.apply(this,arguments);for(a=c=0;2>=c;a=++c)f[a]*=255;return f};D.gl=function(){return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(C,b.call(arguments).concat(["gl"]),function(){})};C.prototype.gl=
function(){var a=this._rgb;return[a[0]/255,a[1]/255,a[2]/255,a[3]]};var Mc=function(a,b,c){var d=g(arguments);a=d[0];b=d[1];c=d[2];a=Ma(a);b=Ma(b);c=Ma(c);return.2126*a+.7152*b+.0722*c};var Ma=function(a){a/=255;return.03928>=a?a/12.92:z((a+.055)/1.055,2.4)};I.push(["rgb",function(a,b,c,d){a=a._rgb;b=b._rgb;return new C(a[0]+c*(b[0]-a[0]),a[1]+c*(b[1]-a[1]),a[2]+c*(b[2]-a[2]),d)}]);C.prototype.luminance=function(a,b){null==b&&(b="rgb");if(!arguments.length)return Mc(this._rgb);if(0===a)this._rgb=
[0,0,0,this._rgb[3]];else if(1===a)this._rgb=[255,255,255,this._rgb[3]];else{var c=20;var d=function(f,g){var h=f.interpolate(g,.5,b);var m=h.luminance();return 1E-7>Math.abs(a-m)||!c--?h:m>a?d(f,h):d(h,g)};var f=Mc(this._rgb);this._rgb=(f>a?d(D("black"),this):d(this,D("white"))).rgba()}return this};var la=function(a){a/=100;if(66>a){var b=255;var c=-155.25485562709179-.44596950469579133*(c=a-2)+104.49216199393888*t(c);var d=20>a?0:-254.76935184120902+.8274096064007395*(d=a-10)+115.67994401066147*
t(d)}else b=351.97690566805693+.114206453784165*(b=a-55)-40.25366309332127*t(b),c=325.4494125711974+.07943456536662342*(c=a-50)-28.0852963507957*t(c),d=255;return[b,c,d]};var Na=function(){var a;var b=g(arguments);var c=b[0];b=b[2];var d=1E3;for(a=4E4;.4<a-d;){var f=.5*(a+d);var h=la(f);h[2]/h[0]>=b/c?a=f:d=f}return n(f)};D.temperature=D.kelvin=function(){return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(C,b.call(arguments).concat(["temperature"]),function(){})};
K.temperature=K.kelvin=K.K=la;C.prototype.temperature=function(){return Na(this._rgb)};C.prototype.kelvin=C.prototype.temperature;D.contrast=function(b,c){var d,f;if("string"===(d=a(b))||"number"===d)b=new C(b);if("string"===(f=a(c))||"number"===f)c=new C(c);b=b.luminance();c=c.luminance();return b>c?(b+.05)/(c+.05):(c+.05)/(b+.05)};D.distance=function(b,c,d){var f,g,h;null==d&&(d="lab");if("string"===(g=a(b))||"number"===g)b=new C(b);if("string"===(h=a(c))||"number"===h)c=new C(c);b=b.get(d);d=c.get(d);
g=0;for(f in b)c=(b[f]||0)-(d[f]||0),g+=c*c;return Math.sqrt(g)};D.deltaE=function(b,c,d,f){var g,h,n;null==d&&(d=1);null==f&&(f=1);if("string"===(g=a(b))||"number"===g)b=new C(b);if("string"===(h=a(c))||"number"===h)c=new C(c);g=b.lab();b=g[0];h=g[1];var p=g[2];c=c.lab();g=c[0];var t=c[1];var v=c[2];var z=q(h*h+p*p);var F=q(t*t+v*v);var A=16>b?.511:.040975*b/(1+.01765*b);c=.0638*z/(1+.0131*z)+.638;for(n=1E-6>z?0:180*w(p,h)/m;0>n;)n+=360;for(;360<=n;)n-=360;n=164<=n&&345>=n?.56+B(.2*r(m*(n+168)/180)):
.36+B(.4*r(m*(n+35)/180));var N=z*z*z*z;N=q(N/(N+1900));z-=F;h-=t;p-=v;d=(b-g)/(d*A);f=z/(f*c);b=c*(N*n+1-N);return q(d*d+f*f+(h*h+p*p-z*z)/(b*b))};C.prototype.get=function(a){var b=a.split(".");a=b[0];b=b[1];var c=this[a]();if(b){var d=a.indexOf(b);return-1<d?c[d]:console.warn("unknown channel "+b+" in mode "+a)}return c};C.prototype.set=function(b,c){var d=b.split(".");b=d[0];if(d=d[1]){var f=this[b]();var g=b.indexOf(d);if(-1<g)if("string"===a(c))switch(c.charAt(0)){case "+":f[g]+=+c;break;case "-":f[g]+=
+c;break;case "*":f[g]*=+c.substr(1);break;case "/":f[g]/=+c.substr(1);break;default:f[g]=+c}else f[g]=c;else console.warn("unknown channel "+d+" in mode "+b)}else f=c;return D(f,b).alpha(this.alpha())};C.prototype.clipped=function(){return this._rgb._clipped||!1};C.prototype.alpha=function(a){return arguments.length?D.rgb([this._rgb[0],this._rgb[1],this._rgb[2],a]):this._rgb[3]};C.prototype.darken=function(a){null==a&&(a=1);var b=this.lab();b[0]-=X.Kn*a;return D.lab(b).alpha(this.alpha())};C.prototype.brighten=
function(a){null==a&&(a=1);return this.darken(-a)};C.prototype.darker=C.prototype.darken;C.prototype.brighter=C.prototype.brighten;C.prototype.saturate=function(a){null==a&&(a=1);var b=this.lch();b[1]+=a*X.Kn;0>b[1]&&(b[1]=0);return D.lch(b).alpha(this.alpha())};C.prototype.desaturate=function(a){null==a&&(a=1);return this.saturate(-a)};C.prototype.premultiply=function(){var a=this.rgb();var b=this.alpha();return D(a[0]*b,a[1]*b,a[2]*b,b)};var sa=function(a,b,c){if(!sa[c])throw"unknown blend mode "+
c;return sa[c](a,b)};P=function(a){return function(b,c){c=D(c).rgb();b=D(b).rgb();return D(a(c,b),"rgb")}};var S=function(a){return function(b,c){var d,f;var g=[];for(d=f=0;3>=f;d=++f)g[d]=a(b[d],c[d]);return g}};sa.normal=P(S(function(a,b){return a}));sa.multiply=P(S(function(a,b){return a*b/255}));sa.screen=P(S(function(a,b){return 255*(1-(1-a/255)*(1-b/255))}));sa.overlay=P(S(function(a,b){return 128>b?2*a*b/255:255*(1-2*(1-a/255)*(1-b/255))}));sa.darken=P(S(function(a,b){return a>b?b:a}));sa.lighten=
P(S(function(a,b){return a>b?a:b}));sa.dodge=P(S(function(a,b){if(255===a)return 255;a=b/255*255/(1-a/255);return 255<a?255:a}));sa.burn=P(S(function(a,b){return 255*(1-(1-b/255)/(a/255))}));D.blend=sa;D.analyze=function(a){var b;var c={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0};var d=0;for(b=a.length;d<b;d++){var f=a[d];null==f||isNaN(f)||(c.values.push(f),c.sum+=f,f<c.min&&(c.min=f),f>c.max&&(c.max=f),c.count+=1)}c.domain=[c.min,c.max];c.limits=function(a,b){return D.limits(c,
a,b)};return c};D.scale=function(b,c){var d="rgb";var f=D("#ccc");var g=0;var h=[0,1];var m=[];var n=[0,0];var p=!1;var q=[];var r=!1;var t=0;var v=1;var w=!1;var A={};var F=!0;var B=1;var N=function(b){var c,d;null==b&&(b=["#fff","#000"]);null!=b&&"string"===a(b)&&null!=D.brewer&&(b=D.brewer[b]||D.brewer[b.toLowerCase()]||b);if("array"===a(b)){b=b.slice(0);var f=c=0;for(d=b.length-1;0<=d?c<=d:c>=d;f=0<=d?++c:--c){var g=b[f];"string"===a(g)&&(b[f]=D(g))}f=c=m.length=0;for(g=b.length-1;0<=g?c<=g:c>=
g;f=0<=g?++c:--c)m.push(f/(b.length-1))}J();return q=b};var C=function(a){var b;if(null!=p){var c=p.length-1;for(b=0;b<c&&a>=p[b];)b++;return b-1}return 0};var G=function(a){return a};var I=function(b,c){var g,h;null==c&&(c=!1);if(isNaN(b))return f;c||(p&&2<p.length?(b=C(b),b/=p.length-2):b=v!==t?(b-t)/(v-t):1);c||(b=G(b));1!==B&&(b=z(b,B));b=n[0]+b*(1-n[0]-n[1]);b=Math.min(1,Math.max(0,b));var r=Math.floor(1E4*b);if(F&&A[r])var w=A[r];else{if("array"===a(q))for(c=g=0,h=m.length-1;0<=h?g<=h:g>=h;c=
0<=h?++g:--g){var N=m[c];if(b<=N){w=q[c];break}if(b>=N&&c===m.length-1){w=q[c];break}if(b>N&&b<m[c+1]){b=(b-N)/(m[c+1]-N);w=D.interpolate(q[c],q[c+1],b,d);break}}else"function"===a(q)&&(w=q(b));F&&(A[r]=w)}return w};var J=function(){return A={}};N(b);var H=function(a){a=D(I(a));return r&&a[r]?a[r]():a};H.classes=function(b){if(null!=b){if("array"===a(b))p=b,h=[b[0],b[b.length-1]];else{var c=D.analyze(h);p=0===b?[c.min,c.max]:D.limits(c,"e",b)}return H}return p};H.domain=function(a){var b;if(!arguments.length)return h;
t=a[0];v=a[a.length-1];m=[];var c=q.length;if(a.length===c&&t!==v){var d=0;for(c=a.length;d<c;d++){var f=a[d];m.push((f-t)/(v-t))}}else for(f=b=0,d=c-1;0<=d?b<=d:b>=d;f=0<=d?++b:--b)m.push(f/(c-1));h=[t,v];return H};H.mode=function(a){if(!arguments.length)return d;d=a;J();return H};H.range=function(a,b){N(a,b);return H};H.out=function(a){r=a;return H};H.spread=function(a){if(!arguments.length)return g;g=a;return H};H.correctLightness=function(a){null==a&&(a=!0);w=a;J();G=w?function(a){var b=I(0,!0).lab()[0];
var c=I(1,!0).lab()[0];var d=b>c;var f=I(a,!0).lab()[0];b+=(c-b)*a;f-=b;var g=0;var h=1;for(c=20;.01<Math.abs(f)&&0<c--;)d&&(f*=-1),0>f?(g=a,a+=.5*(h-a)):(h=a,a+=.5*(g-a)),f=I(a,!0).lab()[0],f-=b;return a}:function(a){return a};return H};H.padding=function(b){return null!=b?("number"===a(b)&&(b=[b,b]),n=b,H):n};H.colors=function(a,c){var d,f,g;2>arguments.length&&(c="hex");var m=[];if(0===arguments.length)m=q.slice(0);else if(1===a)m=[H(.5)];else if(1<a){var n=h[0];var r=h[1]-n;m=function(){f=[];
for(var b=0;0<=a?b<a:b>a;0<=a?b++:b--)f.push(b);return f}.apply(this).map(function(b){return H(n+b/(a-1)*r)})}else{b=[];var t=[];if(p&&2<p.length)for(m=g=1,d=p.length;1<=d?g<d:g>d;m=1<=d?++g:--g)t.push(.5*(p[m-1]+p[m]));else t=h;m=t.map(function(a){return H(a)})}D[c]&&(m=m.map(function(a){return a[c]()}));return m};H.cache=function(a){return null!=a?(F=a,H):F};H.gamma=function(a){return null!=a?(B=a,H):B};return H};null==D.scales&&(D.scales={});D.scales.cool=function(){return D.scale([D.hsl(180,1,
.9),D.hsl(250,.7,.4)])};D.scales.hot=function(){return D.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")};D.analyze=function(b,c,d){var f;var g={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0};null==d&&(d=function(){return!0});var h=function(a){null==a||isNaN(a)||(g.values.push(a),g.sum+=a,a<g.min&&(g.min=a),a>g.max&&(g.max=a),g.count+=1)};var m=function(b,f){if(d(b,f))return null!=c&&"function"===a(c)?h(c(b)):null!=c&&"string"===a(c)||"number"===a(c)?h(b[c]):
h(b)};if("array"===a(b)){var n=0;for(f=b.length;n<f;n++){var p=b[n];m(p)}}else for(f in b)p=b[f],m(p,f);g.domain=[g.min,g.max];g.limits=function(a,b){return D.limits(g,a,b)};return g};D.limits=function(b,c,d){var f,g,h,m,n,q,r;null==c&&(c="equal");null==d&&(d=7);"array"===a(b)&&(b=D.analyze(b));var v=b.min;p=b.max;var w=b.values.sort(function(a,b){return a-b});if(1===d)return[v,p];b=[];"c"===c.substr(0,1)&&(b.push(v),b.push(p));if("e"===c.substr(0,1)){b.push(v);c=w=1;for(f=d-1;1<=f?w<=f:w>=f;c=1<=
f?++w:--w)b.push(v+c/d*(p-v));b.push(p)}else if("l"===c.substr(0,1)){if(0>=v)throw"Logarithmic scales are only possible for values > 0";f=Math.LOG10E*t(v);w=Math.LOG10E*t(p);b.push(v);c=m=1;for(n=d-1;1<=n?m<=n:m>=n;c=1<=n?++m:--m)b.push(z(10,f+c/d*(w-f)));b.push(p)}else if("q"===c.substr(0,1)){b.push(v);c=f=1;for(n=d-1;1<=n?f<=n:f>=n;c=1<=n?++f:--f)m=(w.length-1)*c/d,c=A(m),c===m?b.push(w[c]):(m-=c,b.push(w[c]*(1-m)+w[c+1]*m));b.push(p)}else if("k"===c.substr(0,1)){n=w.length;f=Array(n);var F=Array(d);
var C=!0;var H=0;var G=null;G=[];G.push(v);c=g=1;for(h=d-1;1<=h?g<=h:g>=h;c=1<=h?++g:--g)G.push(v+c/d*(p-v));for(G.push(p);C;){v=c=0;for(g=d-1;0<=g?c<=g:c>=g;v=0<=g?++c:--c)F[v]=0;c=g=0;for(q=n-1;0<=q?g<=q:g>=q;c=0<=q?++g:--g){var I=w[c];var N=Number.MAX_VALUE;v=C=0;for(r=d-1;0<=r?C<=r:C>=r;v=0<=r?++C:--C)h=B(G[v]-I),h<N&&(N=h,m=v);F[m]++;f[c]=m}g=Array(d);v=c=0;for(C=d-1;0<=C?c<=C:c>=C;v=0<=C?++c:--c)g[v]=null;c=C=0;for(h=n-1;0<=h?C<=h:C>=h;c=0<=h?++C:--C)v=f[c],g[v]=null===g[v]?w[c]:g[v]+w[c];v=
C=0;for(h=d-1;0<=h?C<=h:C>=h;v=0<=h?++C:--C)g[v]*=1/F[v];C=!1;v=h=0;for(N=d-1;0<=N?h<=N:h>=N;v=0<=N?++h:--h)if(g[v]!==G[c]){C=!0;break}G=g;H++;200<H&&(C=!1)}m={};v=c=0;for(G=d-1;0<=G?c<=G:c>=G;v=0<=G?++c:--c)m[v]=[];c=G=0;for(--n;0<=n?G<=n:G>=n;c=0<=n?++G:--G)v=f[c],m[v].push(w[c]);w=[];v=c=0;for(--d;0<=d?c<=d:c>=d;v=0<=d?++c:--c)w.push(m[v][0]),w.push(m[v][m[v].length-1]);w=w.sort(function(a,b){return a-b});b.push(w[0]);c=d=1;for(f=w.length-1;d<=f;c=d+=2)c=w[c],isNaN(c)||-1!==b.indexOf(c)||b.push(c)}return b};
var jb=function(){var a=g(arguments);var b=a[0];var c=a[1];a=a[2];G=2*Math.PI;b/=255;c/=255;a/=255;var d=Math.min(b,c,a);var f=(b+c+a)/3;d=1-d/f;0===d?b=0:(b=(b-c+(b-a))/2/Math.sqrt((b-c)*(b-c)+(b-a)*(c-a)),b=Math.acos(b),a>c&&(b=G-b),b/=G);return[360*b,d,f]};D.hsi=function(){return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(C,b.call(arguments).concat(["hsi"]),function(){})};K.hsi=function(a,b,c){var d=g(arguments);a=d[0];b=d[1];c=d[2];isNaN(a)&&(a=0);
a/=360;if(a<1/3){var h=(1-b)/3;var m=(1+b*r(G*a)/r(H-G*a))/3;var n=1-(h+m)}else a<2/3?(a-=1/3,m=(1-b)/3,n=(1+b*r(G*a)/r(H-G*a))/3,h=1-(m+n)):(a-=2/3,n=(1-b)/3,h=(1+b*r(G*a)/r(H-G*a))/3,m=1-(n+h));m=f(c*m*3);n=f(c*n*3);h=f(c*h*3);return[255*m,255*n,255*h,3<d.length?d[3]:1]};C.prototype.hsi=function(){return jb(this._rgb)};var Db=function(a,b,c,d){var f;if("hsl"===d){var g=a.hsl();var h=b.hsl()}else if("hsv"===d)g=a.hsv(),h=b.hsv();else if("hcg"===d)g=a.hcg(),h=b.hcg();else if("hsi"===d)g=a.hsi(),h=
b.hsi();else if("lch"===d||"hcl"===d)d="hcl",g=a.hcl(),h=b.hcl();if("h"===d.substr(0,1)){var m=g[0];var n=g[1];var p=g[2];var q=h[0];var r=h[1];var t=h[2]}isNaN(m)||isNaN(q)?isNaN(m)?isNaN(q)?a=Number.NaN:(a=q,1!==p&&0!==p||"hsv"===d||(f=r)):(a=m,1!==t&&0!==t||"hsv"===d||(f=n)):a=m+c*(q>m&&180<q-m?q-(m+360):q<m&&180<m-q?q+360-m:q-m);null==f&&(f=n+c*(r-n));return D[d](a,f,p+c*(t-p))};I=I.concat(function(){var a;var b="hsv hsl hsi hcl lch hcg".split(" ");var d=[];var f=0;for(a=b.length;f<a;f++)c=b[f],
d.push([c,Db]);return d}());I.push(["num",function(a,b,c,d){a=a.num();b=b.num();return D.num(a+(b-a)*c,"num")}]);I.push(["lab",function(a,b,c,d){a=a.lab();b=b.lab();return new C(a[0]+c*(b[0]-a[0]),a[1]+c*(b[1]-a[1]),a[2]+c*(b[2]-a[2]),d)}])}).call(this);(function(d,c){d.appSetting=function(b){return{init:function(){var a=c.querySelector("#virtualclassCont.congrea #appSettingCtrl"),b=c.querySelector("#virtualclassCont.congrea #chatWidget"),d=c.querySelector("#virtualclassCont.congrea #appSettingDetail"),h=c.querySelector("#virtualclassCont.congrea .vmchat_bar_button"),m=c.querySelector("#virtualclassCont.congrea .vmchat_room_bt");a&&a.addEventListener("click",function(){a.classList.contains("chatActive")?(a.classList.remove("chatActive"),a.classList.add("settingActive"),
b.classList.remove("active"),b.classList.add("deactive"),d.classList.add("active"),d.classList.remove("deactive"),h.classList.contains("active")&&h.classList.remove("active"),m.classList.contains("active")&&m.classList.remove("active"),virtualclass.appSetting.rtcIo(),virtualclass.appSettingMedia.init()):(a.classList.add("chatActive"),a.classList.remove("settingActive"),b.classList.remove("deactive"),b.classList.add("active"),d.classList.remove("active"),d.classList.add("deactive"),c.querySelector(".congrea #memlist.enable")&&
h.classList.add("active"),c.querySelector(".congrea #chatrm.enable")&&m.classList.add("active"))})},rtcIo:function(){if(!c.querySelector(".congrea #webRtcIoContainer")){var a=virtualclass.getTemplate("appSettingMedia");$("#virtualclassApp  #settingMedia").append(a())}}}}()})(window,document);(function(d,c){d.appSettingMedia=function(b){return{init:function(){this.type;this.videoElement=c.querySelector("#webRtcIoContainer video");this.audioInputSelect=c.querySelector("#webRtcIoContainer select#audioSource");this.audioOutputSelect=c.querySelector("#webRtcIoContainer select#audioOutput");this.videoSelect=c.querySelector("#webRtcIoContainer select#videoSource");this.mainVideoElement=c.querySelector("#videoHostSource");this.selectors=[this.audioInputSelect,this.audioOutputSelect,this.videoSelect];
this.audioOutputSelect.disabled=!("sinkId"in HTMLMediaElement.prototype);navigator.mediaDevices.enumerateDevices().then(virtualclass.appSettingMedia.gotDevices).catch(virtualclass.appSettingMedia.handleError);this.audioInputSelect.addEventListener("change",function(){virtualclass.appSettingMedia.start("audio")});this.audioOutputSelect.addEventListener("change",function(){virtualclass.appSettingMedia.changeAudioDestination()});this.videoSelect.addEventListener("change",function(){virtualclass.appSettingMedia.start("video")})},
gotDevices:function(a){var b=virtualclass.appSettingMedia.selectors.map(function(a){return a.value});virtualclass.appSettingMedia.selectors.forEach(function(a){for(;a.firstChild;)a.removeChild(a.firstChild)});for(var d=0;d!==a.length;++d){var h=a[d],m=c.createElement("option");m.value=h.deviceId;"audioinput"===h.kind?(m.text=h.label||"microphone "+(virtualclass.appSettingMedia.audioInputSelect.length+1),virtualclass.appSettingMedia.audioInputSelect.appendChild(m)):"audiooutput"===h.kind?(m.text=h.label||
"speaker "+(virtualclass.appSettingMedia.audioOutputSelect.length+1),virtualclass.appSettingMedia.audioOutputSelect.appendChild(m)):"videoinput"===h.kind?(m.text=h.label||"camera "+(virtualclass.appSettingMedia.videoSelect.length+1),virtualclass.appSettingMedia.videoSelect.appendChild(m)):console.log("Some other kind of source/device: ",h)}virtualclass.appSettingMedia.selectors.forEach(function(a,c){Array.prototype.slice.call(a.childNodes).some(function(a){return a.value===b[c]})&&(a.value=b[c])})},
attachSinkId:function(a,b){"undefined"!==typeof a.sinkId?a.setSinkId(b).then(function(){console.log("Success, audio output device attached: "+b)}).catch(function(a){var b=a;"SecurityError"===a.name&&(b="You need to use HTTPS for selecting audio output device: "+a);console.error(b);virtualclass.appSettingMedia.audioOutputSelect.selectedIndex=0}):console.warn("Browser does not support output device selection.")},changeAudioDestination:function(){virtualclass.appSettingMedia.attachSinkId(virtualclass.appSettingMedia.videoElement,
virtualclass.appSettingMedia.audioOutputSelect.value)},gotStream:function(a){d.stream=a;virtualclass.appSettingMedia.videoElement.srcObject=a;virtualclass.appSettingMedia.mainVideoElement.srcObject=a;virtualclass.gObj.video.stream=a;virtualclass.gObj.video.audio._manuPulateStream();return navigator.mediaDevices.enumerateDevices()},start:function(a){this.type=a;d.stream&&d.stream.getTracks().forEach(function(a){a.stop()});var b=virtualclass.appSettingMedia.audioInputSelect.value,g=virtualclass.appSettingMedia.videoSelect.value,
h={video:{}};h.video.deviceId=g?{exact:g}:void 0;"video"==a?(h.audio=!0,b=c.getElementById("audioSource"),b=b.options[b.selectedIndex].value,null!=b&&(h.audio={deviceId:b?{exact:b}:void 0})):h.audio={deviceId:b?{exact:b}:void 0};c.querySelector("#congreaVideoSettingCont").dataset.settingType=a;navigator.mediaDevices.getUserMedia(h).then(virtualclass.appSettingMedia.gotStream).then(virtualclass.appSettingMedia.gotDevices).catch(virtualclass.appSettingMedia.handleError)},handleError:function(a){console.log("navigator.getUserMedia error: ",
a)}}}()})(window,document);function Network(){this.sumLatency=this.latency=0;this.minLatency=999999;this.countLatency=0;this.avgLatency=1;this.MYSPEED_COUNTER_HIGH=this.MYSPEED_COUNTER_OK=0}Network.prototype.pingToServer=function(){if(io.webSocketConnected()){var d=Date.now();ioAdapter.sendPing(d)}};
Network.prototype.initToPing=function(d){var c=this;this.hasOwnProperty("initToPingTime")&&clearTimeout(this.initToPingTime);this.hasOwnProperty("sleepTime")&&clearTimeout(this.sleepTime);this.initToPingTime=setTimeout(function(){c.pingToServer();c.sleepTime=setTimeout(function(){c.latency=3E3;c.initToPing(5E3)},3E3)},d);this.variations()};
Network.prototype.variations=function(){this.latency&&3E3>this.latency&&0<this.latency&&(this.sumLatency+=this.latency,this.countLatency++,this.avgLatency=Math.round(this.sumLatency/this.countLatency),this.latency<this.minLatency&&10<this.latency&&(this.minLatency=this.latency));this.avgLatency>2*this.minLatency&&this.resetVariations();this.adaptiveMedia()};
Network.prototype.adaptiveMedia=function(){3>virtualclass.videoHost.gObj.MYSPEED&&(3E3<=this.latency||999999>this.minLatency&&this.latency>3*this.minLatency)?(this.MYSPEED_COUNTER_OK=0,this.MYSPEED_COUNTER_HIGH++,this.updateNetworkInfo("slow"),1==virtualclass.videoHost.gObj.MYSPEED&&3<=this.MYSPEED_COUNTER_HIGH?(this.MYSPEED_COUNTER_HIGH=0,this.setSpeed(2)):2==virtualclass.videoHost.gObj.MYSPEED&&4<=this.MYSPEED_COUNTER_HIGH&&(this.MYSPEED_COUNTER_HIGH=0,this.setSpeed(3))):1<virtualclass.videoHost.gObj.MYSPEED&&
999999>this.minLatency&&this.latency<2*this.minLatency?(this.MYSPEED_COUNTER_OK++,this.MYSPEED_COUNTER_HIGH=0,this.updateNetworkInfo("fast"),2<virtualclass.videoHost.gObj.MYSPEED&&4<=this.MYSPEED_COUNTER_OK?(this.MYSPEED_COUNTER_OK=0,this.setSpeed(2)):1<virtualclass.videoHost.gObj.MYSPEED&&10<=this.MYSPEED_COUNTER_OK&&(this.MYSPEED_COUNTER_OK=0,this.setSpeed(1))):(2E3<this.latency?this.updateNetworkInfo("slow"):this.updateNetworkInfo("fast"),this.MYSPEED_COUNTER_HIGH=this.MYSPEED_COUNTER_OK=0)};
Network.prototype.updateNetworkInfo=function(d){var c;1==virtualclass.videoHost.gObj.MYSPEED?c="high":2==virtualclass.videoHost.gObj.MYSPEED?c="medium":3==virtualclass.videoHost.gObj.MYSPEED&&(c="low");var b=document.getElementById("proposedSpeed");b&&(b.dataset.suggestion=c);if(c=document.getElementById("networkLatency"))c.dataset.latency=d,d=virtualclass.lang.getString("band"+d),c.dataset.title=d};
Network.prototype.setSpeed=function(d){virtualclass.videoHost.gObj.MYSPEED=d;ioAdapter.sendSpeed(virtualclass.videoHost.gObj.MYSPEED);console.log("Latency - CHANGE SPEED TO "+virtualclass.videoHost.gObj.MYSPEED);this.hideTeacherVideo();this.resetVariations()};Network.prototype.hideTeacherVideo=function(){if(roles.isStudent()&&3<=virtualclass.videoHost.gObj.MYSPEED){var d=document.querySelector("#videoParticipate"),c=d.getContext("2d");c.fillStyle="#000000";c.fillRect(0,0,d.offsetWidth,d.offsetHeight)}};
Network.prototype.resetVariations=function(){this.countLatency=this.sumLatency=0;this.avgLatency=1;this.minLatency=999999};Network.prototype.netWorkElementIsReady=function(){var d=document.querySelector("#networkStatusContainer");if(null==d){var c=this;virtualclass.gObj.connectingRoom=setTimeout(function(){c.netWorkElementIsReady()},1E3)}else d.classList.add("connecting-room"),clearTimeout(virtualclass.gObj.connectingRoom)};
